
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Site Description">
      
      
        <meta name="author" content="Project Team">
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>インフラ設計ガイド - Site Name</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Site Name" class="md-header__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Site Name
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              インフラ設計ガイド
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Site Name" class="md-nav__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Site Name
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="_1">インフラ設計ガイド<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="1">1. 概要<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 目的<a class="headerlink" href="#11" title="Permanent link">&para;</a></h3>
<p>Infrastructure as Code (IaC) によるインフラストラクチャの設計・構築・管理における規律とベストプラクティスを定義する。</p>
<h3 id="12">1.2 対象システム<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<ul>
<li>システム名: 会議室予約システム</li>
<li>クラウド基盤: AWS</li>
<li>IaC ツール: Terraform</li>
<li>アーキテクチャ: ヘキサゴナルアーキテクチャ</li>
</ul>
<h3 id="13">1.3 基本原則<a class="headerlink" href="#13" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjcyOHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MjgycHg7aGVpZ2h0OjcyOHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI4MiA3MjgiIHdpZHRoPSIyODJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPkluZnJhc3RydWN0dXJlIGFzIENvZGUgJiMyMjUyMjsmIzI2NDEyOyYjMjE0MDc7JiMyMTA2Mzs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMzguNjgzMyIgeD0iMTQuNjU4NCIgeT0iMjIuOTk1MSI+SW5mcmFzdHJ1Y3R1cmUgYXMgQ29kZSAmIzIyNTIyOyYjMjY0MTI7JiMyMTQwNzsmIzIxMDYzOzwvdGV4dD48L2c+PCEtLWVudGl0eSBjb2RlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImNvZGUiIGRhdGEtc291cmNlLWxpbmU9IjMiIGRhdGEtdWlkPSJlbnQwMDAyIiBpZD0iZW50aXR5X2NvZGUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzUuOTk5OCIgeD0iOTkiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxMDkiIHk9IjY3LjI5MiI+JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7JiMyMTI3MDs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgdmVyc2lvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJ2ZXJzaW9uIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV92ZXJzaW9uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExNy45OTk2IiB4PSI3IiB5PSIxNzIuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjE3IiB5PSIxOTUuNTkyIj4mIzEyNDk2OyYjMTI1NDA7JiMxMjQ3MjsmIzEyNTE5OyYjMTI1MzE7JiMzMTY0OTsmIzI5NzAyOzwvdGV4dD48L2c+PCEtLWVudGl0eSBhdXRvbWF0aW9uLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImF1dG9tYXRpb24iIGRhdGEtc291cmNlLWxpbmU9IjUiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iZW50aXR5X2F1dG9tYXRpb24iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjEuOTk5OCIgeD0iMzUiIHk9IjMwMC44ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEuOTk5OCIgeD0iNDUiIHk9IjMyMy44ODIiPiYjMzMyNTg7JiMyMTIwNTsmIzIxMjcwOzwvdGV4dD48L2c+PCEtLWVudGl0eSByZXByb2R1Y2libGUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0icmVwcm9kdWNpYmxlIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBkYXRhLXVpZD0iZW50MDAwNSIgaWQ9ImVudGl0eV9yZXByb2R1Y2libGUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjEuOTk5OCIgeD0iMzgiIHk9IjQyOS4xODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEuOTk5OCIgeD0iNDgiIHk9IjQ1Mi4xODIiPiYjMjA4Nzc7JiMyOTY5NDsmIzI0NjE1OzwvdGV4dD48L2c+PCEtLWVudGl0eSBtb2R1bGFyaXR5LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Im1vZHVsYXJpdHkiIGRhdGEtc291cmNlLWxpbmU9IjciIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iZW50aXR5X21vZHVsYXJpdHkiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTAzLjk5OTYiIHg9IjI2IiB5PSI1NTcuNDg2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjM2IiB5PSI1ODAuNDgyIj4mIzEyNTE0OyYjMTI0NzI7JiMxMjUxNzsmIzEyNTQwOyYjMTI1MjM7JiMyNDYxNTs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgdGVzdGluZy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJ0ZXN0aW5nIiBkYXRhLXNvdXJjZS1saW5lPSI4IiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImVudGl0eV90ZXN0aW5nIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjYxLjk5OTgiIHg9IjExMiIgeT0iNjg1Ljc3NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIxMjIiIHk9IjcwOC43NzIiPiYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OzwvdGV4dD48L2c+PCEtLWxpbmsgY29kZSB0byB2ZXJzaW9uLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImNvZGUiIGRhdGEtZW50aXR5LTI9InZlcnNpb24iIGRhdGEtc291cmNlLWxpbmU9IjEwIiBkYXRhLXVpZD0ibG5rOCIgaWQ9ImxpbmtfY29kZV92ZXJzaW9uIj48cGF0aCBkPSJNOTguNTUsNzguNDU2OSBDODQuNzksODUuOTE2OSA3MC43Nyw5Ni40MzY5IDYzLDExMC41OTY5IEM1Mi41NSwxMjkuNjM2OSA1NC42NjQ1LDE0OS41MTExIDU4Ljk0NDUsMTY2LjM4MTEiIGZpbGw9Im5vbmUiIGlkPSJjb2RlLXRvLXZlcnNpb24iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYwLjQyLDE3Mi4xOTY5LDYyLjA4MzksMTYyLjQ4OTYsNTkuMTkwNCwxNjcuMzUwNCw1NC4zMjk2LDE2NC40NTY5LDYwLjQyLDE3Mi4xOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjY0IiB5PSIxMjMuNjYzOCI+JiMxMjM3NzsmIzEyNDA5OyYjMTIzOTA7JiMxMjM5ODsmIzEyNDUyOyYjMTI1MzE7JiMxMjUwMTsmIzEyNTIxOyYjMTI0MzQ7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjgzLjUiIHk9IjEzOC43OTY2Ij4mIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTsmIzEyMzkxOyYjMjM0NTA7JiMzMjY4MTs8L3RleHQ+PC9nPjwhLS1saW5rIHZlcnNpb24gdG8gYXV0b21hdGlvbi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJ2ZXJzaW9uIiBkYXRhLWVudGl0eS0yPSJhdXRvbWF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgZGF0YS11aWQ9ImxuazkiIGlkPSJsaW5rX3ZlcnNpb25fYXV0b21hdGlvbiI+PHBhdGggZD0iTTY2LDIwOS4zMDY5IEM2NiwyMzMuNDI2OSA2NiwyNzAuNTc2OSA2NiwyOTQuNjI2OSIgZmlsbD0ibm9uZSIgaWQ9InZlcnNpb24tdG8tYXV0b21hdGlvbiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjYsMzAwLjYyNjksNzAsMjkxLjYyNjksNjYsMjk1LjYyNjksNjIsMjkxLjYyNjksNjYsMzAwLjYyNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSI2NyIgeT0iMjUxLjk1MzgiPiYjMjI3OTM7JiMyNjM1NjsmIzIzNjUzOyYjMjc1MDg7JiMxMjQzNDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMDAwMSIgeD0iNjciIHk9IjI2Ny4wODY2Ij4mIzM2ODYxOyYjMzYzMjE7JiMxMjUzOTsmIzMxNjQ5OyYjMjk3MDI7PC90ZXh0PjwvZz48IS0tbGluayBhdXRvbWF0aW9uIHRvIHJlcHJvZHVjaWJsZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJhdXRvbWF0aW9uIiBkYXRhLWVudGl0eS0yPSJyZXByb2R1Y2libGUiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBkYXRhLXVpZD0ibG5rMTAiIGlkPSJsaW5rX2F1dG9tYXRpb25fcmVwcm9kdWNpYmxlIj48cGF0aCBkPSJNNjYuNDIsMzM3LjU5NjkgQzY2Ljk5LDM2MS43MjY5IDY3Ljg2NTMsMzk4Ljg3ODYgNjguNDQ1Myw0MjIuOTI4NiIgZmlsbD0ibm9uZSIgaWQ9ImF1dG9tYXRpb24tdG8tcmVwcm9kdWNpYmxlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2OC41OSw0MjguOTI2OSw3Mi4zNzE5LDQxOS44MzMxLDY4LjQ2OTUsNDIzLjkyODMsNjQuMzc0Miw0MjAuMDI1OSw2OC41OSw0MjguOTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjY4Ljg2IiB5PSIzODAuMjUzOCI+JiMyNTE2MzsmIzIxMjA1OyYjMjAzMTY7JiMyNjk4OTsmIzEyNDM0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNiIgeD0iODguMzYiIHk9IjM5NS4zODY2Ij4mIzI1NDkwOyYjMzg1MDA7PC90ZXh0PjwvZz48IS0tbGluayByZXByb2R1Y2libGUgdG8gbW9kdWxhcml0eS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJyZXByb2R1Y2libGUiIGRhdGEtZW50aXR5LTI9Im1vZHVsYXJpdHkiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBkYXRhLXVpZD0ibG5rMTEiIGlkPSJsaW5rX3JlcHJvZHVjaWJsZV9tb2R1bGFyaXR5Ij48cGF0aCBkPSJNNzAuMjUsNDY1Ljg5NjkgQzcxLjk3LDQ5MC4wMjY5IDc0LjYyNDUsNTI3LjE4MiA3Ni4zMzQ1LDU1MS4yMzIiIGZpbGw9Im5vbmUiIGlkPSJyZXByb2R1Y2libGUtdG8tbW9kdWxhcml0eSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNzYuNzYsNTU3LjIxNjksODAuMTExNiw1NDcuOTU1OCw3Ni40MDU0LDU1Mi4yMjk1LDcyLjEzMTgsNTQ4LjUyMzIsNzYuNzYsNTU3LjIxNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSI4Mi4wNyIgeT0iNTA4LjU1MzgiPiYjMjE1MTY7JiMxMjM3NjsmIzI5ODcyOyYjMjI2NTk7JiMxMjQzNDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iNzUuNTciIHk9IjUyMy42ODY2Ij4mIzIwMzA5OyYjMjQyMzA7JiMxMjM5MTsmIzEyNDE4OyYjMjcwODM7JiMzMTY4OTs8L3RleHQ+PC9nPjwhLS1saW5rIG1vZHVsYXJpdHkgdG8gdGVzdGluZy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJtb2R1bGFyaXR5IiBkYXRhLWVudGl0eS0yPSJ0ZXN0aW5nIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgZGF0YS11aWQ9ImxuazEyIiBpZD0ibGlua19tb2R1bGFyaXR5X3Rlc3RpbmciPjxwYXRoIGQ9Ik03Mi45NSw1OTQuMDc2OSBDNjkuMSw2MTAuODc2OSA2NS45OSw2MzYuNTA2OSA3Niw2NTUuNzc2OSBDODMuNiw2NzAuNDI2OSA5Mi44NTUxLDY3OC41MDk2IDEwNi40MDUxLDY4Ni4yMTk2IiBmaWxsPSJub25lIiBpZD0ibW9kdWxhcml0eS10by10ZXN0aW5nIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMTEuNjIsNjg5LjE4NjksMTA1Ljc3NTksNjgxLjI1OTMsMTA3LjI3NDMsNjg2LjcxNDEsMTAxLjgxOTUsNjg4LjIxMjUsMTExLjYyLDY4OS4xODY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iOTAiIHk9IjYzNi44NDM4Ij4mIzIwODc3OyYjMjEwMzM7JiMyOTk5MjsmIzIxNDg3OyYjMzMwMjE7JiMxMjM5NDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjAwMDEiIHg9Ijc3IiB5PSI2NTEuOTc2NiI+JiMxMjQ2NzsmIzEyNTMxOyYjMTI1MDk7JiMxMjU0MDsmIzEyNDkzOyYjMTI1MzE7JiMxMjQ4ODsmIzIxMjcwOzwvdGV4dD48L2c+PCEtLWxpbmsgdGVzdGluZyB0byBjb2RlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9InRlc3RpbmciIGRhdGEtZW50aXR5LTI9ImNvZGUiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBkYXRhLXVpZD0ibG5rMTMiIGlkPSJsaW5rX3Rlc3RpbmdfY29kZSI+PHBhdGggZD0iTTE2Mi4zNyw2ODUuNzA2OSBDMTcwLjY5LDY3Ny4zODY5IDE3OS44OSw2NjYuODI2OSAxODYsNjU1Ljc3NjkgQzIwMy42Nyw2MjMuODI2OSAyMDgsNjEzLjE0NjkgMjA4LDU3Ni42MjY5IEMyMDgsMTg5LjczNjkgMjA4LDE4OS43MzY5IDIwOCwxODkuNzM2OSBDMjA4LDE1My4yMjY5IDIwNC43LDE0MS45NDY5IDE4NiwxMTAuNTk2OSBDMTc5LjM1LDk5LjQzNjkgMTczLjg3LDkzLjEyNDEgMTY0LjY1LDg1LjAzNDEiIGZpbGw9Im5vbmUiIGlkPSJ0ZXN0aW5nLXRvLWNvZGUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2MC4xNCw4MS4wNzY5LDE2NC4yNjY4LDkwLjAxOTQsMTYzLjg5ODMsODQuMzc0NiwxNjkuNTQzMiw4NC4wMDYxLDE2MC4xNCw4MS4wNzY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMDAwMSIgeD0iMjA5IiB5PSIzODAuMjUzOCI+JiMyMTY5NzsmIzM2MDc0OyYjMjA0NDU7JiMzNTM4ODsmIzEyMzkyOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSIyMDkiIHk9IjM5NS4zODY2Ij4mIzMyMTUzOyYjMzIxNTQ7JiMzMDM0MDsmIzI1OTEzOyYjMjE4OTI7PC90ZXh0PjwvZz48IS0tU1JDPVtOUDUxSlc4bjU4UnRGU040RkhUbXVTUUxUczBwbWNXY1dTNENuU0lUZEhmVzBZWDFDTzhRZVc0N0s1NDNHSzdIbXBwUVpoVW1oT3cySUhUVFZEenhfVnpZNndTaU95RlBTaXFpVGRDOWQ3Q2pteW1Rd3ZjYVBSM01iNV9TaVNDTXltaThrTE8yY3l3c241VjA2bTl6MC1ncHlrY0FtWENJTm05ZUxHN1UyejAwdzUwQ2hhR3JoeWJUb3l0UTZNU0gzV2p6TGdmN2V5bVNwZ0hEXzh6WC1PZXVVa1Z4V01QU1F5VkQ5N0M5VXBGclItc3J0amRIaHhrRHlCSGFLd1BodXhyYkUwX1UxNlhIQ3paQU9qbFBIYVg1Q01BbmpVWWJuZ2UxZjA1YTBrRzZvMDJ5aldtNGowd3ExcnVqeGxuczBJSFdXd1B1eHc3OEw1Ri11aVgxaEV0cHluNXh3bDN4YVBSM1pyZHVWME5xelJpWGo0MGhVSjZkckJiVmFhTkRQblV5U3d6clZiWnhSQkpINGdReWx5MWdRUktDdjRwSzdqYXJyVFB5TGNUSmNJSzBwLUQxSUpwdVE0NUdfYXlQSWl2Tk1CNGRKaGhpdzI2YUNvM3pkeUpvTkVoUzVOcWxva3ozYVFQNncxZ2JWcXAyT05fLVNIYnN0dTFxdXV1T0R5SXVBUGU3XzZKMkpXLSAtMDAwMF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h2 id="2">2. プロジェクト構造<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 ディレクトリ構造<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjMyMHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTU5OHB4O2hlaWdodDozMjBweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNTk4IDMyMCIgd2lkdGg9IjE1OThweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIHRlcnJhZm9ybS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0idGVycmFmb3JtIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfdGVycmFmb3JtIj48cGF0aCBkPSJNOC41LDYgTDg2LjE0NDUsNiBBMy43NSwzLjc1IDAgMCAxIDg4LjY0NDUsOC41IEw5NS42NDQ1LDI4LjI5NjkgTDE1ODguNSwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDE1OTEsMzAuNzk2OSBMMTU5MSwzMTEuMzEgQTIuNSwyLjUgMCAwIDEgMTU4OC41LDMxMy44MSBMOC41LDMxMy44MSBBMi41LDIuNSAwIDAgMSA2LDMxMS4zMSBMNiw4LjUgQTIuNSwyLjUgMCAwIDEgOC41LDYiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjYiIHgyPSI5NS42NDQ1IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzYuNjQ0NSIgeD0iMTAiIHk9IjIwLjk5NTEiPnRlcnJhZm9ybTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgbW9kdWxlcy0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0ibW9kdWxlcyIgZGF0YS1zb3VyY2UtbGluZT0iMiIgZGF0YS11aWQ9ImVudDAwMDMiIGlkPSJjbHVzdGVyX21vZHVsZXMiPjxwYXRoIGQ9Ik00MC41LDU3IEwxMDguMzIxMyw1NyBBMy43NSwzLjc1IDAgMCAxIDExMC44MjEzLDU5LjUgTDExNy44MjEzLDc5LjI5NjkgTDgyNy41LDc5LjI5NjkgQTIuNSwyLjUgMCAwIDEgODMwLDgxLjc5NjkgTDgzMCwyNzkuMzEgQTIuNSwyLjUgMCAwIDEgODI3LjUsMjgxLjgxIEw0MC41LDI4MS44MSBBMi41LDIuNSAwIDAgMSAzOCwyNzkuMzEgTDM4LDU5LjUgQTIuNSwyLjUgMCAwIDEgNDAuNSw1NyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMzgiIHgyPSIxMTcuODIxMyIgeTE9Ijc5LjI5NjkiIHkyPSI3OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY2LjgyMTMiIHg9IjQyIiB5PSI3MS45OTUxIj5tb2R1bGVzPC90ZXh0PjwvZz48IS0tY2x1c3RlciBlbnZpcm9ubWVudHMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9ImVudmlyb25tZW50cyIgZGF0YS1zb3VyY2UtbGluZT0iOSIgZGF0YS11aWQ9ImVudDAwMDkiIGlkPSJjbHVzdGVyX2Vudmlyb25tZW50cyI+PHBhdGggZD0iTTg3Mi41LDU3IEw5ODIuNDUxMiw1NyBBMy43NSwzLjc1IDAgMCAxIDk4NC45NTEyLDU5LjUgTDk5MS45NTEyLDc5LjI5NjkgTDEzNDUuNSw3OS4yOTY5IEEyLjUsMi41IDAgMCAxIDEzNDgsODEuNzk2OSBMMTM0OCwyNzkuMzEgQTIuNSwyLjUgMCAwIDEgMTM0NS41LDI4MS44MSBMODcyLjUsMjgxLjgxIEEyLjUsMi41IDAgMCAxIDg3MCwyNzkuMzEgTDg3MCw1OS41IEEyLjUsMi41IDAgMCAxIDg3Mi41LDU3IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI4NzAiIHgyPSI5OTEuOTUxMiIgeTE9Ijc5LjI5NjkiIHkyPSI3OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC45NTEyIiB4PSI4NzQiIHk9IjcxLjk5NTEiPmVudmlyb25tZW50czwvdGV4dD48L2c+PCEtLWVudGl0eSBleGFtcGxlcy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJleGFtcGxlcyIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGRhdGEtdWlkPSJlbnQwMDE0IiBpZD0iZW50aXR5X2V4YW1wbGVzIj48cGF0aCBkPSJNMTM3NC42LDU3LjIyIEwxNDE1LjYsNTcuMjIgQTMuNzUsMy43NSAwIDAgMSAxNDE4LjEsNTkuNzIgTDE0MjUuMSw3OC4yMiBMMTQ2Ny4zOTg4LDc4LjIyIEEyLjUsMi41IDAgMCAxIDE0NjkuODk4OCw4MC43MiBMMTQ2OS44OTg4LDEwOS4wMTY5IEEyLjUsMi41IDAgMCAxIDE0NjcuMzk4OCwxMTEuNTE2OSBMMTM3NC42LDExMS41MTY5IEEyLjUsMi41IDAgMCAxIDEzNzIuMSwxMDkuMDE2OSBMMTM3Mi4xLDU5LjcyIEEyLjUsMi41IDAgMCAxIDEzNzQuNiw1Ny4yMiIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTM3Mi4xIiB4Mj0iMTQyNS4xIiB5MT0iNzguMjIiIHkyPSI3OC4yMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY3Ljc5ODgiIHg9IjEzODIuMSIgeT0iOTguMjE1MSI+ZXhhbXBsZXM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgdGVzdC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJ0ZXN0IiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgZGF0YS11aWQ9ImVudDAwMTUiIGlkPSJlbnRpdHlfdGVzdCI+PHBhdGggZD0iTTE1MDcuNSw1Ny4yMiBMMTU0OC41LDU3LjIyIEEzLjc1LDMuNzUgMCAwIDEgMTU1MSw1OS43MiBMMTU1OCw3OC4yMiBMMTU3Mi41LDc4LjIyIEEyLjUsMi41IDAgMCAxIDE1NzUsODAuNzIgTDE1NzUsMTA5LjAxNjkgQTIuNSwyLjUgMCAwIDEgMTU3Mi41LDExMS41MTY5IEwxNTA3LjUsMTExLjUxNjkgQTIuNSwyLjUgMCAwIDEgMTUwNSwxMDkuMDE2OSBMMTUwNSw1OS43MiBBMi41LDIuNSAwIDAgMSAxNTA3LjUsNTcuMjIiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE1MDUiIHgyPSIxNTU4IiB5MT0iNzguMjIiIHkyPSI3OC4yMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2Ljg4NTciIHg9IjE1MTUiIHk9Ijk4LjIxNTEiPnRlc3Q8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbmV0d29ya2luZy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJuZXR3b3JraW5nIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBkYXRhLXVpZD0iZW50MDAwNCIgaWQ9ImVudGl0eV9uZXR3b3JraW5nIj48cGF0aCBkPSJNNjQuMjUsMjAzLjUxIEwxMDUuMjUsMjAzLjUxIEEzLjc1LDMuNzUgMCAwIDEgMTA3Ljc1LDIwNi4wMSBMMTE0Ljc1LDIyNC41MSBMMTY3Ljc1MzksMjI0LjUxIEEyLjUsMi41IDAgMCAxIDE3MC4yNTM5LDIyNy4wMSBMMTcwLjI1MzksMjU1LjMwNjkgQTIuNSwyLjUgMCAwIDEgMTY3Ljc1MzksMjU3LjgwNjkgTDY0LjI1LDI1Ny44MDY5IEEyLjUsMi41IDAgMCAxIDYxLjc1LDI1NS4zMDY5IEw2MS43NSwyMDYuMDEgQTIuNSwyLjUgMCAwIDEgNjQuMjUsMjAzLjUxIiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MS43NSIgeDI9IjExNC43NSIgeTE9IjIyNC41MSIgeTI9IjIyNC41MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjUwMzkiIHg9IjcxLjc1IiB5PSIyNDQuNTA1MSI+bmV0d29ya2luZzwvdGV4dD48L2c+PCEtLWVudGl0eSBjb21wdXRlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImNvbXB1dGUiIGRhdGEtc291cmNlLWxpbmU9IjQiIGRhdGEtdWlkPSJlbnQwMDA1IiBpZD0iZW50aXR5X2NvbXB1dGUiPjxwYXRoIGQ9Ik0yMDcuNjIsMjAzLjUxIEwyNDguNjIsMjAzLjUxIEEzLjc1LDMuNzUgMCAwIDEgMjUxLjEyLDIwNi4wMSBMMjU4LjEyLDIyNC41MSBMMjk0LjM4MjcsMjI0LjUxIEEyLjUsMi41IDAgMCAxIDI5Ni44ODI3LDIyNy4wMSBMMjk2Ljg4MjcsMjU1LjMwNjkgQTIuNSwyLjUgMCAwIDEgMjk0LjM4MjcsMjU3LjgwNjkgTDIwNy42MiwyNTcuODA2OSBBMi41LDIuNSAwIDAgMSAyMDUuMTIsMjU1LjMwNjkgTDIwNS4xMiwyMDYuMDEgQTIuNSwyLjUgMCAwIDEgMjA3LjYyLDIwMy41MSIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjA1LjEyIiB4Mj0iMjU4LjEyIiB5MT0iMjI0LjUxIiB5Mj0iMjI0LjUxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjEuNzYyNyIgeD0iMjE1LjEyIiB5PSIyNDQuNTA1MSI+Y29tcHV0ZTwvdGV4dD48L2c+PCEtLWVudGl0eSBkYXRhYmFzZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJkYXRhYmFzZSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgZGF0YS11aWQ9ImVudDAwMDYiIGlkPSJlbnRpdHlfZGF0YWJhc2UiPjxwYXRoIGQ9Ik0zMzQuMDUsMjAzLjUxIEwzNzUuMDUsMjAzLjUxIEEzLjc1LDMuNzUgMCAwIDEgMzc3LjU1LDIwNi4wMSBMMzg0LjU1LDIyNC41MSBMNDIzLjk1NzIsMjI0LjUxIEEyLjUsMi41IDAgMCAxIDQyNi40NTcyLDIyNy4wMSBMNDI2LjQ1NzIsMjU1LjMwNjkgQTIuNSwyLjUgMCAwIDEgNDIzLjk1NzIsMjU3LjgwNjkgTDMzNC4wNSwyNTcuODA2OSBBMi41LDIuNSAwIDAgMSAzMzEuNTUsMjU1LjMwNjkgTDMzMS41NSwyMDYuMDEgQTIuNSwyLjUgMCAwIDEgMzM0LjA1LDIwMy41MSIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzMxLjU1IiB4Mj0iMzg0LjU1IiB5MT0iMjI0LjUxIiB5Mj0iMjI0LjUxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjQuOTA3MiIgeD0iMzQxLjU1IiB5PSIyNDQuNTA1MSI+ZGF0YWJhc2U8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc2VjdXJpdHktLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0ic2VjdXJpdHkiIGRhdGEtc291cmNlLWxpbmU9IjYiIGRhdGEtdWlkPSJlbnQwMDA3IiBpZD0iZW50aXR5X3NlY3VyaXR5Ij48cGF0aCBkPSJNNDYzLjU1LDIwMy41MSBMNTA0LjU1LDIwMy41MSBBMy43NSwzLjc1IDAgMCAxIDUwNy4wNSwyMDYuMDEgTDUxNC4wNSwyMjQuNTEgTDU0NC40NDc1LDIyNC41MSBBMi41LDIuNSAwIDAgMSA1NDYuOTQ3NSwyMjcuMDEgTDU0Ni45NDc1LDI1NS4zMDY5IEEyLjUsMi41IDAgMCAxIDU0NC40NDc1LDI1Ny44MDY5IEw0NjMuNTUsMjU3LjgwNjkgQTIuNSwyLjUgMCAwIDEgNDYxLjA1LDI1NS4zMDY5IEw0NjEuMDUsMjA2LjAxIEEyLjUsMi41IDAgMCAxIDQ2My41NSwyMDMuNTEiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQ2MS4wNSIgeDI9IjUxNC4wNSIgeTE9IjIyNC41MSIgeTI9IjIyNC41MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljg5NzUiIHg9IjQ3MS4wNSIgeT0iMjQ0LjUwNTEiPnNlY3VyaXR5PC90ZXh0PjwvZz48IS0tZW50aXR5IG1vbml0b3JpbmctLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0ibW9uaXRvcmluZyIgZGF0YS1zb3VyY2UtbGluZT0iNyIgZGF0YS11aWQ9ImVudDAwMDgiIGlkPSJlbnRpdHlfbW9uaXRvcmluZyI+PHBhdGggZD0iTTU4NC4yOSwyMDMuNTEgTDYyNS4yOSwyMDMuNTEgQTMuNzUsMy43NSAwIDAgMSA2MjcuNzksMjA2LjAxIEw2MzQuNzksMjI0LjUxIEw2ODUuNzE1OCwyMjQuNTEgQTIuNSwyLjUgMCAwIDEgNjg4LjIxNTgsMjI3LjAxIEw2ODguMjE1OCwyNTUuMzA2OSBBMi41LDIuNSAwIDAgMSA2ODUuNzE1OCwyNTcuODA2OSBMNTg0LjI5LDI1Ny44MDY5IEEyLjUsMi41IDAgMCAxIDU4MS43OSwyNTUuMzA2OSBMNTgxLjc5LDIwNi4wMSBBMi41LDIuNSAwIDAgMSA1ODQuMjksMjAzLjUxIiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1ODEuNzkiIHgyPSI2MzQuNzkiIHkxPSIyMjQuNTEiIHkyPSIyMjQuNTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Ni40MjU4IiB4PSI1OTEuNzkiIHk9IjI0NC41MDUxIj5tb25pdG9yaW5nPC90ZXh0PjwvZz48IS0tZW50aXR5IGdsb2JhbC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJnbG9iYWwiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBkYXRhLXVpZD0iZW50MDAxMCIgaWQ9ImVudGl0eV9nbG9iYWwiPjxwYXRoIGQ9Ik05MDEuMTUsMjAzLjUxIEw5NDIuMTUsMjAzLjUxIEEzLjc1LDMuNzUgMCAwIDEgOTQ0LjY1LDIwNi4wMSBMOTUxLjY1LDIyNC41MSBMOTY4Ljg0NzMsMjI0LjUxIEEyLjUsMi41IDAgMCAxIDk3MS4zNDczLDIyNy4wMSBMOTcxLjM0NzMsMjU1LjMwNjkgQTIuNSwyLjUgMCAwIDEgOTY4Ljg0NzMsMjU3LjgwNjkgTDkwMS4xNSwyNTcuODA2OSBBMi41LDIuNSAwIDAgMSA4OTguNjUsMjU1LjMwNjkgTDg5OC42NSwyMDYuMDEgQTIuNSwyLjUgMCAwIDEgOTAxLjE1LDIwMy41MSIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iODk4LjY1IiB4Mj0iOTUxLjY1IiB5MT0iMjI0LjUxIiB5Mj0iMjI0LjUxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIuNjk3MyIgeD0iOTA4LjY1IiB5PSIyNDQuNTA1MSI+Z2xvYmFsPC90ZXh0PjwvZz48IS0tZW50aXR5IGRldi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJkZXYiIGRhdGEtc291cmNlLWxpbmU9IjExIiBkYXRhLXVpZD0iZW50MDAxMSIgaWQ9ImVudGl0eV9kZXYiPjxwYXRoIGQ9Ik0xMDA4LjUsMjAzLjUxIEwxMDQ5LjUsMjAzLjUxIEEzLjc1LDMuNzUgMCAwIDEgMTA1MiwyMDYuMDEgTDEwNTksMjI0LjUxIEwxMDczLjUsMjI0LjUxIEEyLjUsMi41IDAgMCAxIDEwNzYsMjI3LjAxIEwxMDc2LDI1NS4zMDY5IEEyLjUsMi41IDAgMCAxIDEwNzMuNSwyNTcuODA2OSBMMTAwOC41LDI1Ny44MDY5IEEyLjUsMi41IDAgMCAxIDEwMDYsMjU1LjMwNjkgTDEwMDYsMjA2LjAxIEEyLjUsMi41IDAgMCAxIDEwMDguNSwyMDMuNTEiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjEwMDYiIHgyPSIxMDU5IiB5MT0iMjI0LjUxIiB5Mj0iMjI0LjUxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjUuNzg1MiIgeD0iMTAxNiIgeT0iMjQ0LjUwNTEiPmRldjwvdGV4dD48L2c+PCEtLWVudGl0eSBzdGFnZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJzdGFnZSIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGRhdGEtdWlkPSJlbnQwMDEyIiBpZD0iZW50aXR5X3N0YWdlIj48cGF0aCBkPSJNMTExMy41LDIwMy41MSBMMTE1NC41LDIwMy41MSBBMy43NSwzLjc1IDAgMCAxIDExNTcsMjA2LjAxIEwxMTY0LDIyNC41MSBMMTE3OC41LDIyNC41MSBBMi41LDIuNSAwIDAgMSAxMTgxLDIyNy4wMSBMMTE4MSwyNTUuMzA2OSBBMi41LDIuNSAwIDAgMSAxMTc4LjUsMjU3LjgwNjkgTDExMTMuNSwyNTcuODA2OSBBMi41LDIuNSAwIDAgMSAxMTExLDI1NS4zMDY5IEwxMTExLDIwNi4wMSBBMi41LDIuNSAwIDAgMSAxMTEzLjUsMjAzLjUxIiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMTExIiB4Mj0iMTE2NCIgeTE9IjIyNC41MSIgeTI9IjIyNC41MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM4Ljg2MjMiIHg9IjExMjEiIHk9IjI0NC41MDUxIj5zdGFnZTwvdGV4dD48L2c+PCEtLWVudGl0eSBwcm9kLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9InByb2QiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBkYXRhLXVpZD0iZW50MDAxMyIgaWQ9ImVudGl0eV9wcm9kIj48cGF0aCBkPSJNMTIxOC41LDIwMy41MSBMMTI1OS41LDIwMy41MSBBMy43NSwzLjc1IDAgMCAxIDEyNjIsMjA2LjAxIEwxMjY5LDIyNC41MSBMMTI4My41LDIyNC41MSBBMi41LDIuNSAwIDAgMSAxMjg2LDIyNy4wMSBMMTI4NiwyNTUuMzA2OSBBMi41LDIuNSAwIDAgMSAxMjgzLjUsMjU3LjgwNjkgTDEyMTguNSwyNTcuODA2OSBBMi41LDIuNSAwIDAgMSAxMjE2LDI1NS4zMDY5IEwxMjE2LDIwNi4wMSBBMi41LDIuNSAwIDAgMSAxMjE4LjUsMjAzLjUxIiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMjE2IiB4Mj0iMTI2OSIgeTE9IjIyNC41MSIgeTI9IjIyNC41MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMyLjA5NDciIHg9IjEyMjYiIHk9IjI0NC41MDUxIj5wcm9kPC90ZXh0PjwvZz48IS0tbGluayBtb2R1bGVzIHRvIG5ldHdvcmtpbmctLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0ibW9kdWxlcyIgZGF0YS1lbnRpdHktMj0ibmV0d29ya2luZyIgZGF0YS1zb3VyY2UtbGluZT0iMTkiIGRhdGEtdWlkPSJsbmsxNiIgaWQ9ImxpbmtfbW9kdWxlc19uZXR3b3JraW5nIj48cGF0aCBkPSJNMzY0Ljg2LDg1LjM4IEMzNTguOSw4NS45MSAxNjgsMTAzLjQgMTMyLDE0MS41MSBDMTE2LjYyLDE1Ny43OSAxMTMuNDE4NSwxOTYuOTUzMSAxMTMuNjE4NSwyMTYuNDYzMSIgZmlsbD0ibm9uZSIgaWQ9Im1vZHVsZXMtdG8tbmV0d29ya2luZyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTEzLjY4LDIyMi40NjI3LDExNy41ODc1LDIxMy40MjIyLDExMy42Mjg3LDIxNy40NjMsMTA5LjU4OCwyMTMuNTA0MiwxMTMuNjgsMjIyLjQ2MjciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny44ODcyIiB4PSIxMzMiIHk9IjE1NC41NzY5Ij5WUEMmIzEyMjg5O1N1Ym5ldCYjMTIyODk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjIyMjIiIHg9IjE0Mi44MzI1IiB5PSIxNjkuNzA5NyI+Um91dGUgVGFibGU8L3RleHQ+PC9nPjwhLS1saW5rIG1vZHVsZXMgdG8gY29tcHV0ZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJtb2R1bGVzIiBkYXRhLWVudGl0eS0yPSJjb21wdXRlIiBkYXRhLXNvdXJjZS1saW5lPSIyMCIgZGF0YS11aWQ9ImxuazE3IiBpZD0ibGlua19tb2R1bGVzX2NvbXB1dGUiPjxwYXRoIGQ9Ik0zNjQuOTQsODUuMzcgQzM2Mi4zLDg1LjYgMjc3LjUzLDkzLjE4IDI0NywxNDEuNTEgQzIzNS40NywxNTkuNzggMjM2LjQ1MywxNzguODI0OSAyNDAuOTIzLDE5Ny40OTQ5IiBmaWxsPSJub25lIiBpZD0ibW9kdWxlcy10by1jb21wdXRlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNDIuMzIsMjAzLjMzLDI0NC4xMTQ1LDE5My42NDYsMjQxLjE1NTgsMTk4LjQ2NzQsMjM2LjMzNDQsMTk1LjUwODcsMjQyLjMyLDIwMy4zMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMy44MzUiIHg9IjI0OCIgeT0iMTYyLjA3NjkiPkVDMiYjMTIyODk7QVNHJiMxMjI4OTtBTEI8L3RleHQ+PC9nPjwhLS1saW5rIG1vZHVsZXMgdG8gZGF0YWJhc2UtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0ibW9kdWxlcyIgZGF0YS1lbnRpdHktMj0iZGF0YWJhc2UiIGRhdGEtc291cmNlLWxpbmU9IjIxIiBkYXRhLXVpZD0ibG5rMTgiIGlkPSJsaW5rX21vZHVsZXNfZGF0YWJhc2UiPjxwYXRoIGQ9Ik0zNjQuOTgsODUuNTEgQzM2NC40Nyw4OC40NCAzNTYuNDQsMTM1Ljk1IDM2MiwxNzMuNTEgQzM2My40NiwxODMuMzkgMzY0LjQ4MjYsMTg4LjIxMTkgMzY3LjQyMjYsMTk3LjQ2MTkiIGZpbGw9Im5vbmUiIGlkPSJtb2R1bGVzLXRvLWRhdGFiYXNlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNjkuMjQsMjAzLjE4LDM3MC4zMjU5LDE5My4zOTEyLDM2Ny43MjU1LDE5OC40MTQ5LDM2Mi43MDE4LDE5NS44MTQ0LDM2OS4yNCwyMDMuMTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTMuNzUiIHg9IjM2MyIgeT0iMTYyLjA3NjkiPlJEUyYjMTIyODk7RHluYW1vREI8L3RleHQ+PC9nPjwhLS1saW5rIG1vZHVsZXMgdG8gc2VjdXJpdHktLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0ibW9kdWxlcyIgZGF0YS1lbnRpdHktMj0ic2VjdXJpdHkiIGRhdGEtc291cmNlLWxpbmU9IjIyIiBkYXRhLXVpZD0ibG5rMTkiIGlkPSJsaW5rX21vZHVsZXNfc2VjdXJpdHkiPjxwYXRoIGQ9Ik0zNjUuMDYsODUuMzcgQzM2Ny40OCw4NS43NCA0NDUuMjEsOTcuOTQgNDgxLDE0MS41MSBDNDk1LjI1LDE1OC44NyA1MDAuMTE0NiwxODEuMzU3OSA1MDIuMjA0NiwyMDAuMzc3OSIgZmlsbD0ibm9uZSIgaWQ9Im1vZHVsZXMtdG8tc2VjdXJpdHkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUwMi44NiwyMDYuMzQyLDUwNS44NTMsMTk2Ljk1ODksNTAyLjMxMzksMjAxLjM3MTksNDk3LjkwMDksMTk3LjgzMjcsNTAyLjg2LDIwNi4zNDIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDEuMDk1NyIgeD0iNDk3LjU5IiB5PSIxNjIuMDc2OSI+SUFNJiMxMjI4OTtTZWN1cml0eSBHcm91cHM8L3RleHQ+PC9nPjwhLS1saW5rIG1vZHVsZXMgdG8gbW9uaXRvcmluZy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJtb2R1bGVzIiBkYXRhLWVudGl0eS0yPSJtb25pdG9yaW5nIiBkYXRhLXNvdXJjZS1saW5lPSIyMyIgZGF0YS11aWQ9ImxuazIwIiBpZD0ibGlua19tb2R1bGVzX21vbml0b3JpbmciPjxwYXRoIGQ9Ik0zNjUuMDQsODUuMzcgQzM2OC43Nyw4NS40NyA2MDcuNjMsOTIuMzUgNjQ4LDE0MS41MSBDNjYyLjA0LDE1OC42MSA2NTguNTkyOCwxOTkuNTQ5IDY1MC44MjI4LDIxOC43MjkiIGZpbGw9Im5vbmUiIGlkPSJtb2R1bGVzLXRvLW1vbml0b3JpbmciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY0OC41NywyMjQuMjksNjU1LjY1NjYsMjE3LjQ1MDQsNjUwLjQ0NzMsMjE5LjY1NTgsNjQ4LjI0MTksMjE0LjQ0NjYsNjQ4LjU3LDIyNC4yOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy42NjY1IiB4PSI2NTcuNTYiIHk9IjE2Mi4wNzY5Ij5DbG91ZFdhdGNoJiMxMjI4OTtTTlM8L3RleHQ+PC9nPjwhLS1saW5rIGVudmlyb25tZW50cyB0byBnbG9iYWwtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW52aXJvbm1lbnRzIiBkYXRhLWVudGl0eS0yPSJnbG9iYWwiIGRhdGEtc291cmNlLWxpbmU9IjI1IiBkYXRhLXVpZD0ibG5rMjEiIGlkPSJsaW5rX2Vudmlyb25tZW50c19nbG9iYWwiPjxwYXRoIGQ9Ik0xMDkyLjkyLDg1LjM2IEMxMDg5LjQ2LDg1LjI1IDk3OC4zNSw4Mi4xMSA5MzYsMTQxLjUxIEM5MjMuMzgsMTU5LjIxIDkyMy4zODQyLDE3OC40ODcyIDkyNi44MzQyLDE5Ny40MTcyIiBmaWxsPSJub25lIiBpZD0iZW52aXJvbm1lbnRzLXRvLWdsb2JhbCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTI3LjkxLDIwMy4zMiw5MzAuMjMxNSwxOTMuNzQ4Nyw5MjcuMDEzNSwxOTguNDAxLDkyMi4zNjExLDE5NS4xODMsOTI3LjkxLDIwMy4zMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjkzNyIgeT0iMTYyLjA3NjkiPiYjMjA4NDk7JiMzNjg5MDsmIzIyNzkzOyYjMjU5Njg7JiMxMjUzOTsmIzM1MzczOyYjMjM0NTA7PC90ZXh0PjwvZz48IS0tbGluayBlbnZpcm9ubWVudHMgdG8gZGV2LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudmlyb25tZW50cyIgZGF0YS1lbnRpdHktMj0iZGV2IiBkYXRhLXNvdXJjZS1saW5lPSIyNiIgZGF0YS11aWQ9ImxuazIyIiBpZD0ibGlua19lbnZpcm9ubWVudHNfZGV2Ij48cGF0aCBkPSJNMTA5Mi44OSw4NS40NCBDMTA5MC42Nyw4Ni45NCAxMDU0Ljg2LDExMS4zOSAxMDQzLDE0MS41MSBDMTAzNS4yNiwxNjEuMTcgMTAzNC43MjYzLDE3OS4yNzU2IDEwMzYuMzk2MywxOTcuMjk1NiIgZmlsbD0ibm9uZSIgaWQ9ImVudmlyb25tZW50cy10by1kZXYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwMzYuOTUsMjAzLjI3LDEwNDAuMTAyNCwxOTMuOTM5MywxMDM2LjQ4ODYsMTk4LjI5MTMsMTAzMi4xMzY2LDE5NC42Nzc1LDEwMzYuOTUsMjAzLjI3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iMTA0NCIgeT0iMTYyLjA3NjkiPiYjMzgyODM7JiMzMDMzMDsmIzI5ODcyOyYjMjI2NTk7PC90ZXh0PjwvZz48IS0tbGluayBlbnZpcm9ubWVudHMgdG8gc3RhZ2UtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW52aXJvbm1lbnRzIiBkYXRhLWVudGl0eS0yPSJzdGFnZSIgZGF0YS1zb3VyY2UtbGluZT0iMjciIGRhdGEtdWlkPSJsbmsyMyIgaWQ9ImxpbmtfZW52aXJvbm1lbnRzX3N0YWdlIj48cGF0aCBkPSJNMTA5My4wMSw4NS41MyBDMTA5My4xMSw4Ny4yIDEwOTQuMDMsMTAwLjkgMTA5NywxMTEuNTEgQzExMDYuMDgsMTQ0LjAyIDExMTkuMDc3OSwxNzQuMTU5MyAxMTMwLjIzNzksMTk3LjY3OTMiIGZpbGw9Im5vbmUiIGlkPSJlbnZpcm9ubWVudHMtdG8tc3RhZ2UiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjExMzIuODEsMjAzLjEsMTEzMi41NjU3LDE5My4yNTQyLDExMzAuNjY2NiwxOTguNTgyNywxMTI1LjMzOCwxOTYuNjgzNiwxMTMyLjgxLDIwMy4xIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjAwMDEiIHg9IjExMTkuMjUiIHk9IjE2Mi4wNzY5Ij4mIzEyNDczOyYjMTI0ODY7JiMxMjU0MDsmIzEyNDcyOyYjMTI1MzE7JiMxMjQ2NDsmIzI5ODcyOyYjMjI2NTk7PC90ZXh0PjwvZz48IS0tbGluayBlbnZpcm9ubWVudHMgdG8gcHJvZC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnZpcm9ubWVudHMiIGRhdGEtZW50aXR5LTI9InByb2QiIGRhdGEtc291cmNlLWxpbmU9IjI4IiBkYXRhLXVpZD0ibG5rMjQiIGlkPSJsaW5rX2Vudmlyb25tZW50c19wcm9kIj48cGF0aCBkPSJNMTA5Mi45OSw4NS40MiBDMTA5Mi43Niw4Ni40NSAxMDg5LjIyLDEwMy4xOSAxMDk3LDExMS41MSBDMTEzOC45OCwxNTYuNCAxMTg4LjY4LDk3LjkxIDEyMzIsMTQxLjUxIEMxMjQ4LDE1Ny42MiAxMjUxLjgzNTYsMTc3Ljc2MTUgMTI1Mi4yNzU2LDE5Ny40MDE1IiBmaWxsPSJub25lIiBpZD0iZW52aXJvbm1lbnRzLXRvLXByb2QiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyNTIuNDEsMjAzLjQsMTI1Ni4yMDc0LDE5NC4zMTI3LDEyNTIuMjk4LDE5OC40MDEzLDEyNDguMjA5NCwxOTQuNDkxOCwxMjUyLjQxLDIwMy40IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iMTI0OS41NiIgeT0iMTYyLjA3NjkiPiYjMjY0MTI7JiMzMDA1ODsmIzI5ODcyOyYjMjI2NTk7PC90ZXh0PjwvZz48IS0tU1JDPVtUUDdESWlEMDU4TnRVT2hHVkpTa05HWXJiSUFlSTJFd1NKRGZmWk1PcDhKOWY1ZjRnMHFBdWF3ZU83NGJCYUhLQWN4eVV2aVhoTnFCUm9RUF81M1NYN2xsLUl2cFNjdzdFWFBjVWVMWm5iMjdDaFVZOHJfRkVscjR3d0k0SXd0MG1SeEtxeGdXNGlvRkEza3FJTFMyVVBpSFJVZncwU1RJSmtqQ2luMTc5bDhKS0pNUHdrRHNtNnBVYndmZzJodzhwSWJKQi1ValRmZW5jRkhpSGVjQjJLei1lM1dlXzROTmVJUG85OTZLa0tGU0l5cFhOa3dCZXN2WU1MUlB0NkZLYWtFdUFCZXVIZ3dkOGJIRGZkQml5cEh5ZHlFTWZhQWtMYlNBVVVoQi1rdnNOR3BFWkMyNEFISnhmNEtYSjdxN2NHdWtSUUtubXlmUVZHZDhjajZDbG5raDlLaGIzTFloT0czR3cxRmFxYVFQS2hhM2pMeFJaRHpOV29RWldVVU51Rm04V0RTVDZiWHhZQlNGdWdxakd6REF3U1R5NFpRbXFWZFJWMzJFN1l3ZGV1YThsdHlWTndCTnlJOEZMbTF1VmRDcmtfc1FOSy1ZLXQySGFKUzFJV21fSE5XWG1YeW5fMTNYa25YRV9qazhwbUtCcXhsZHNVV2ZXVnUwXS0tPjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="22">2.2 命名規則<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<h4 id="221">2.2.1 リソース命名<a class="headerlink" href="#221" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">命名パターン</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{project}-{environment}-{service}-{resource}&quot;</span>

<span class="nt">例</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">VPC</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;meeting-room-prod-vpc&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Subnet</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;meeting-room-prod-public-subnet-1a&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Security Group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;meeting-room-prod-web-sg&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">RDS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;meeting-room-prod-postgres-primary&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ALB</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;meeting-room-prod-app-alb&quot;</span>
</code></pre></div>
<h4 id="222-terraform">2.2.2 Terraform ファイル命名<a class="headerlink" href="#222-terraform" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">標準ファイル構成</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">main.tf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">メインの構成定義</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">variables.tf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">入力変数定義</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">outputs.tf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">出力値定義</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">versions.tf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">プロバイダーバージョン指定</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">locals.tf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ローカル変数定義 (必要に応じて)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">data.tf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">データソース定義 (必要に応じて)</span>
</code></pre></div>
<h2 id="3">3. モジュール設計<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 モジュール化の原則<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIzODFweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjM5M3B4O2hlaWdodDozODFweDtiYWNrZ3JvdW5kOiMwMDAwMDA7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAzOTMgMzgxIiB3aWR0aD0iMzkzcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjMEYwRjA0IiBoZWlnaHQ9IjEiIHN0eWxlPSJzdHJva2U6IzBGMEYwNDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIxIiB4PSIwIiB5PSIwIi8+PHRleHQgZmlsbD0iIzMzRkYwMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGZvbnQtc3R5bGU9Iml0YWxpYyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI4LjAwOTgiIHg9IjUiIHk9IjE3Ij5QbGFudFVNTCAxLjIwMjUuNzwvdGV4dD48cmVjdCBmaWxsPSIjMzNGRjAyIiBoZWlnaHQ9IjIxLjI5NjkiIHN0eWxlPSJzdHJva2U6IzMzRkYwMjtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIzNTUuMDcyIiB4PSI1IiB5PSIyNi45Njg4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4MS4wMjI1IiB4PSI2IiB5PSI0MS45Njg4Ij5bRnJvbSBzdHJpbmcgKGxpbmUgMTgpIF08L3RleHQ+PHRleHQgZmlsbD0iIzMzRkYwMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQuODc0IiB4PSI1IiB5PSI2Mi4yNjU2Ij4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzMzRkYwMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjQyMjkiIHg9IjUiIHk9Ijc4LjU2MjUiPkBzdGFydHVtbDwvdGV4dD48dGV4dCBmaWxsPSIjMzNGRjAyIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzU1LjA3MiIgeD0iNSIgeT0iOTQuODU5NCI+cmVjdGFuZ2xlICImIzIxMzM2OyYjMTk5Njg7JiMzNjAxMjsmIzIwMjE5OyIgYXMgc2luZ2xlX3Jlc3BvbnNpYmlsaXR5IHs8L3RleHQ+PHRleHQgZmlsbD0iIzMzRkYwMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMzOC45Mzg1IiB4PSI1IiB5PSIxMTEuMTU2MyI+bm90ZSByaWdodCA6IDEmIzEyMzg4OyYjMTIzOTg7JiMxMjUxNDsmIzEyNDcyOyYjMTI1MTc7JiMxMjU0MDsmIzEyNTIzOyYjMTIzOTk7XG4xJiMxMjM4ODsmIzEyMzk4OyYjMzYwMTI7JiMyMDIxOTsmIzEyNDM0OyYjMjUzNDU7JiMxMjM4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzMzRkYwMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkuOTY2OCIgeD0iNSIgeT0iMTI3LjQ1MzEiPn08L3RleHQ+PHRleHQgZmlsbD0iIzMzRkYwMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQuODc0IiB4PSI1IiB5PSIxNDMuNzUiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMzNGRjAyIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjc3LjMzMzciIHg9IjUiIHk9IjE2MC4wNDY5Ij5yZWN0YW5nbGUgIiYjMjA4Nzc7JiMyMTAzMzsmIzI5OTkyOyYjMjQ2MTU7IiBhcyByZXVzYWJpbGl0eSB7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMzM0ZGMDIiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNDcuNDU2IiB4PSI1IiB5PSIxNzYuMzQzOCI+bm90ZSByaWdodCA6ICYjMzUwNzk7JiMyNTk2ODsmIzEyMzk4OyYjMjk4NzI7JiMyMjY1OTsmIzEyNTM5OyYjMTI1MDM7JiMxMjUyNTsmIzEyNDcyOyYjMTI0NTU7JiMxMjQ2MzsmIzEyNDg4OyYjMTIzOTE7XG4mIzIxMDMzOyYjMjk5OTI7JiMyMTQ4NzsmIzMzMDIxOzwvdGV4dD48dGV4dCBmaWxsPSIjMzNGRjAyIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOS45NjY4IiB4PSI1IiB5PSIxOTIuNjQwNiI+fTwvdGV4dD48dGV4dCBmaWxsPSIjMzNGRjAyIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNC44NzQiIHg9IjUiIHk9IjIwOC45Mzc1Ij4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzMzRkYwMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMyMi4zMDA1IiB4PSI1IiB5PSIyMjUuMjM0NCI+cmVjdGFuZ2xlICImIzI3MDgzOyYjMjUxMDQ7JiMyMTQ4NzsmIzMzMDIxOyYjMjQ2MTU7IiBhcyBjb25maWd1cmFiaWxpdHkgezwvdGV4dD48dGV4dCBmaWxsPSIjMzNGRjAyIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzMzLjQ1NjEiIHg9IjUiIHk9IjI0MS41MzEzIj5ub3RlIHJpZ2h0IDogJiMyMjc5MzsmIzI1OTY4OyYjMTIzOTU7JiMxMjQyNDsmIzEyNDI2OyYjMjEyMDU7JiMyMDMxNjsmIzEyNDM0O1xuJiMxMjQ1OTsmIzEyNDczOyYjMTI0Nzk7JiMxMjUxMDsmIzEyNDUyOyYjMTI0NzQ7JiMyMTQ4NzsmIzMzMDIxOzwvdGV4dD48dGV4dCBmaWxsPSIjMzNGRjAyIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOS45NjY4IiB4PSI1IiB5PSIyNTcuODI4MSI+fTwvdGV4dD48dGV4dCBmaWxsPSIjMzNGRjAyIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNC44NzQiIHg9IjUiIHk9IjI3NC4xMjUiPiYjMTYwOzwvdGV4dD48dGV4dCBmaWxsPSIjMzNGRjAyIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzAxLjg0NzMiIHg9IjUiIHk9IjI5MC40MjE5Ij5yZWN0YW5nbGUgIiYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMjM0ODE7JiMyNjEzMTsmIzI0NjE1OyIgYXMgdGVzdGFiaWxpdHkgezwvdGV4dD48dGV4dCBmaWxsPSIjMzNGRjAyIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjc3LjQ1NjMiIHg9IjUiIHk9IjMwNi43MTg4Ij5ub3RlIHJpZ2h0IDogJiMyOTQyMDsmIzMxNDM1OyYjMTIzNzU7JiMxMjM5MDsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODtcbiYjMTIzOTE7JiMxMjM2NTsmIzEyNDI3OyYjMzUzNzM7JiMzNTMzNjs8L3RleHQ+PHRleHQgZmlsbD0iIzMzRkYwMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkuOTY2OCIgeD0iNSIgeT0iMzIzLjAxNTYiPn08L3RleHQ+PHRleHQgZmlsbD0iIzMzRkYwMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQuODc0IiB4PSI1IiB5PSIzMzkuMzEyNSI+JiMxNjA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMzM0ZGMDIiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0LWRlY29yYXRpb249IndhdnkgdW5kZXJsaW5lIiB0ZXh0TGVuZ3RoPSIyNzkuNjAzNSIgeD0iNSIgeT0iMzU1LjYwOTQiPnNpbmdsZV9yZXNwb25zaWJpbGl0eSAtLSZndDsgcmV1c2FiaWxpdHk8L3RleHQ+PHRleHQgZmlsbD0iI0ZGMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM3Ni4yNDMyIiB4PSI5Ljg3NCIgeT0iMzcxLjkwNjMiPlN5bnRheCBFcnJvcj8gKEFzc3VtZWQgZGlhZ3JhbSB0eXBlOiBhY3Rpdml0eSk8L3RleHQ+PCEtLVNSQz1bVFQ3REppOTA1ME5XX0pwNVgzcUJqb3Z5NFhBM2Y2OEpDZllzQjhtbk9NT0loNVFZR0dhaVowaklCT1JWaTBBSC0zMjdRVmlPVGExQ0d5ZnNwZnR4dFJiWjZJTWRvQ2VMVy1QS2l4a1VyLUZQU0JyU3ZjWkhmaFFmV3JGQmkyLWhwM1JGcDhoZk5ENWhtZ2dFR0lzcFZFN0dPdGU0eGVFRjhOaUdTeVh0bzZfODBWWWFtRndZUktVOExsWjBhbkRvR3VZTEtYakR2TnY2Ql9zbTdjbktvd1pQbk1taHpjXzN6WkhmNlJNY2dZU1hidjBUbzk2TUhHMG5XTkoxV21CUlRiSUZhcllremhtbXk0QnRRSGxqbzVBTGRQbGJjZE0wTFZ4VFhYcjBrMTN0b2NrbEx3XzlVbWVDOFpiUkdGbjBsYTd1NDUtUDljSDNicWJOWkhUWHp0ZDdFZVJqNzIwWlJuV0RGRjBFLUNWX3hTSlowTldKbWVseGV4WmxRWVJ4YV9CdmFfR1lJTmdmRWpqeENUZFZXQXY5WktWSWUtZWlLX3E1XS0tPjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="32">3.2 会議室予約システム モジュール構成<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<h4 id="321">3.2.1 ネットワークモジュール<a class="headerlink" href="#321" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/networking/vpc/main.tf</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_vpc&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_cidr</span>
<span class="w">  </span><span class="na">enable_dns_hostnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="na">enable_dns_support</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-vpc&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_subnet&quot;</span><span class="w"> </span><span class="nv">&quot;public&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">var.public_subnet_cidrs</span><span class="p">)</span>

<span class="w">  </span><span class="na">vpc_id</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_vpc.main.id</span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">var.public_subnet_cidrs[count.index</span><span class="p">]</span>
<span class="w">  </span><span class="na">availability_zone</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.availability_zones[count.index</span><span class="p">]</span>
<span class="w">  </span><span class="na">map_public_ip_on_launch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-public-subnet-${count.index + 1}&quot;</span>
<span class="w">    </span><span class="na">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Public&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_subnet&quot;</span><span class="w"> </span><span class="nv">&quot;private&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">var.private_subnet_cidrs</span><span class="p">)</span>

<span class="w">  </span><span class="na">vpc_id</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_vpc.main.id</span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.private_subnet_cidrs[count.index</span><span class="p">]</span>
<span class="w">  </span><span class="na">availability_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.availability_zones[count.index</span><span class="p">]</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-private-subnet-${count.index + 1}&quot;</span>
<span class="w">    </span><span class="na">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Private&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_internet_gateway&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_vpc.main.id</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-igw&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_nat_gateway&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.enable_nat_gateway</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">aws_subnet.public</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span>

<span class="w">  </span><span class="na">allocation_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_eip.nat[count.index].id</span>
<span class="w">  </span><span class="na">subnet_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_subnet.public[count.index].id</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-nat-gw-${count.index + 1}&quot;</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_internet_gateway.main</span><span class="p">]</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_eip&quot;</span><span class="w"> </span><span class="nv">&quot;nat&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.enable_nat_gateway</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">aws_subnet.public</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span>

<span class="w">  </span><span class="na">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vpc&quot;</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-nat-eip-${count.index + 1}&quot;</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_internet_gateway.main</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="322">3.2.2 コンピュートモジュール<a class="headerlink" href="#322" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/compute/web-app/main.tf</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_launch_template&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name_prefix</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-lt&quot;</span>
<span class="w">  </span><span class="na">image_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.ami_id</span>
<span class="w">  </span><span class="na">instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.instance_type</span>
<span class="w">  </span><span class="na">key_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.key_name</span>

<span class="w">  </span><span class="na">vpc_security_group_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_security_group.web.id</span><span class="p">]</span>

<span class="w">  </span><span class="na">user_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">base64encode</span><span class="p">(</span><span class="nf">templatefile</span><span class="p">(</span><span class="s2">&quot;${path.module}/user_data.sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">database_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.database_url</span>
<span class="w">    </span><span class="na">app_version</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.app_version</span>
<span class="w">    </span><span class="na">environment</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
<span class="w">  </span><span class="p">}))</span>

<span class="w">  </span><span class="nb">tag_specifications</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">resource_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;instance&quot;</span>
<span class="w">    </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-instance&quot;</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="nb">precondition</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nf">contains</span><span class="p">([</span><span class="s2">&quot;t3.micro&quot;, &quot;t3.small&quot;, &quot;t3.medium&quot;</span><span class="p">],</span><span class="w"> </span><span class="nv">var.instance_type</span><span class="p">)</span>
<span class="w">      </span><span class="na">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Instance type must be t3.micro, t3.small, or t3.medium for cost optimization.&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_autoscaling_group&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-asg&quot;</span>
<span class="w">  </span><span class="na">vpc_zone_identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.subnet_ids</span>
<span class="w">  </span><span class="na">target_group_arns</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_lb_target_group.main.arn</span><span class="p">]</span>
<span class="w">  </span><span class="na">health_check_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ELB&quot;</span>
<span class="w">  </span><span class="na">health_check_grace_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>

<span class="w">  </span><span class="na">min_size</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.min_size</span>
<span class="w">  </span><span class="na">max_size</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.max_size</span>
<span class="w">  </span><span class="na">desired_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.desired_capacity</span>

<span class="w">  </span><span class="nb">launch_template</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_launch_template.main.id</span>
<span class="w">    </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$Latest&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">instance_refresh</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Rolling&quot;</span>
<span class="w">    </span><span class="nb">preferences</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">min_healthy_percentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span>
<span class="w">      </span><span class="na">instance_warmup</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">tag</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">key</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name&quot;</span>
<span class="w">    </span><span class="na">value</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-asg&quot;</span>
<span class="w">    </span><span class="na">propagate_at_launch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="err">dynamic</span><span class="w"> </span><span class="s2">&quot;tag&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="w">    </span><span class="nb">content</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">key</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="nv">tag.key</span>
<span class="w">      </span><span class="na">value</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nv">tag.value</span>
<span class="w">      </span><span class="na">propagate_at_launch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="nb">postcondition</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">self.availability_zones</span><span class="p">)</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="na">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Auto Scaling Group must span multiple AZs for high availability.&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lb&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-alb&quot;</span>
<span class="w">  </span><span class="na">internal</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">  </span><span class="na">load_balancer_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application&quot;</span>
<span class="w">  </span><span class="na">security_groups</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_security_group.alb.id</span><span class="p">]</span>
<span class="w">  </span><span class="na">subnets</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">var.subnet_ids</span>

<span class="w">  </span><span class="na">enable_deletion_protection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">false</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-alb&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lb_target_group&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-tg&quot;</span>
<span class="w">  </span><span class="na">port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">8080</span>
<span class="w">  </span><span class="na">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTP&quot;</span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span>

<span class="w">  </span><span class="nb">health_check</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">enabled</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="na">healthy_threshold</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="w">    </span><span class="na">unhealthy_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="w">    </span><span class="na">timeout</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<span class="w">    </span><span class="na">interval</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
<span class="w">    </span><span class="na">path</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/health&quot;</span>
<span class="w">    </span><span class="na">matcher</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;200&quot;</span>
<span class="w">    </span><span class="na">port</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;traffic-port&quot;</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTP&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-tg&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lb_listener&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">load_balancer_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lb.main.arn</span>
<span class="w">  </span><span class="na">port</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;80&quot;</span>
<span class="w">  </span><span class="na">protocol</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTP&quot;</span>

<span class="w">  </span><span class="nb">default_action</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">type</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;forward&quot;</span>
<span class="w">    </span><span class="na">target_group_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lb_target_group.main.arn</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="323">3.2.3 データベースモジュール<a class="headerlink" href="#323" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/database/postgresql/main.tf</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_subnet_group&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-subnet-group&quot;</span>
<span class="w">  </span><span class="na">subnet_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.subnet_ids</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-subnet-group&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_parameter_group&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;postgres15&quot;</span>
<span class="w">  </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-params&quot;</span>

<span class="w">  </span><span class="nb">parameter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;log_statement&quot;</span>
<span class="w">    </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;all&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">parameter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;log_min_duration_statement&quot;</span>
<span class="w">    </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1000&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-params&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_instance&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db&quot;</span>

<span class="w">  </span><span class="na">allocated_storage</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">var.allocated_storage</span>
<span class="w">  </span><span class="na">max_allocated_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.max_allocated_storage</span>
<span class="w">  </span><span class="na">storage_type</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gp3&quot;</span>
<span class="w">  </span><span class="na">storage_encrypted</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>

<span class="w">  </span><span class="na">engine</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;postgres&quot;</span>
<span class="w">  </span><span class="na">engine_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;15.4&quot;</span>
<span class="w">  </span><span class="na">instance_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.instance_class</span>

<span class="w">  </span><span class="na">db_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.database_name</span>
<span class="w">  </span><span class="na">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.database_username</span>
<span class="w">  </span><span class="na">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.database_password</span>

<span class="w">  </span><span class="na">db_subnet_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_db_subnet_group.main.name</span>
<span class="w">  </span><span class="na">vpc_security_group_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_security_group.database.id</span><span class="p">]</span>
<span class="w">  </span><span class="na">parameter_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_db_parameter_group.main.name</span>

<span class="w">  </span><span class="na">backup_retention_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.backup_retention_period</span>
<span class="w">  </span><span class="na">backup_window</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">var.backup_window</span>
<span class="w">  </span><span class="na">maintenance_window</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">var.maintenance_window</span>

<span class="w">  </span><span class="na">skip_final_snapshot</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span>
<span class="w">  </span><span class="na">final_snapshot_identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;prod&quot; ? &quot;${var.name_prefix}-db-final-snapshot&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">null</span>

<span class="w">  </span><span class="na">deletion_protection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">false</span>

<span class="w">  </span><span class="na">performance_insights_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">false</span>
<span class="w">  </span><span class="na">monitoring_interval</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db&quot;</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">prevent_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">    </span><span class="nb">precondition</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">var.allocated_storage</span><span class="w"> </span><span class="err">&gt;</span><span class="p">=</span><span class="w"> </span><span class="m">20</span>
<span class="w">      </span><span class="na">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Database must have at least 20GB of storage.&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_instance&quot;</span><span class="w"> </span><span class="nv">&quot;replica&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.create_replica</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span>

<span class="w">  </span><span class="na">identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-replica&quot;</span>

<span class="w">  </span><span class="na">replicate_source_db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_db_instance.main.identifier</span>
<span class="w">  </span><span class="na">instance_class</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.replica_instance_class</span>

<span class="w">  </span><span class="na">skip_final_snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="na">deletion_protection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-replica&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="33">3.3 入力検証とセキュリティ<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/compute/web-app/variables.tf</span>
<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;instance_type&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;EC2 instance type&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>

<span class="w">  </span><span class="nb">validation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">contains</span><span class="p">([</span>
<span class="w">      </span><span class="s2">&quot;t3.micro&quot;, &quot;t3.small&quot;, &quot;t3.medium&quot;, &quot;t3.large&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;m5.large&quot;, &quot;m5.xlarge&quot;, &quot;m5.2xlarge&quot;</span>
<span class="w">    </span><span class="p">],</span><span class="w"> </span><span class="nv">var.instance_type</span><span class="p">)</span>
<span class="w">    </span><span class="na">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Instance type must be a supported type for this application.&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;min_size&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Minimum number of instances in ASG&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span>

<span class="w">  </span><span class="nb">validation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">var.min_size</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="na">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Minimum size must be greater than 0 to avoid outages.&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">validation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">var.min_size</span><span class="w"> </span><span class="err">&lt;</span><span class="p">=</span><span class="w"> </span><span class="m">10</span>
<span class="w">    </span><span class="na">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Minimum size must be 10 or fewer for cost control.&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;environment&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Environment name&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>

<span class="w">  </span><span class="nb">validation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nf">contains</span><span class="p">([</span><span class="s2">&quot;dev&quot;, &quot;stage&quot;, &quot;prod&quot;</span><span class="p">],</span><span class="w"> </span><span class="nv">var.environment</span><span class="p">)</span>
<span class="w">    </span><span class="na">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Environment must be one of: dev, stage, prod.&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;vpc_cidr&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CIDR block for VPC&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>

<span class="w">  </span><span class="nb">validation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nf">can</span><span class="p">(</span><span class="nf">cidrhost</span><span class="p">(</span><span class="nv">var.vpc_cidr</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span>
<span class="w">    </span><span class="na">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;VPC CIDR must be a valid CIDR block.&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="4">4. 環境管理<a class="headerlink" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 環境分離戦略<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjUzNHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTI3M3B4O2hlaWdodDo1MzRweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjczIDUzNCIgd2lkdGg9IjEyNzNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIGdsb2JhbC0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iZ2xvYmFsIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfZ2xvYmFsIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjI1My42IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzI0IiB4PSIxMTcuMjYiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTAuMTc1OCIgeD0iMjU0LjE3MjEiIHk9IjIxLjk5NTEiPkdsb2JhbDwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgZGV2LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJkZXYiIGRhdGEtc291cmNlLWxpbmU9IjciIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iY2x1c3Rlcl9kZXYiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjU1LjU5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzE2IiB4PSI0ODEuMjYiIHk9IjE1Ny4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC45MTgiIHg9IjU4Ni44MDEiIHk9IjE3Mi4yOTUxIj5EZXZlbG9wbWVudDwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgc3RhZ2UtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9InN0YWdlIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMTAiIGlkPSJjbHVzdGVyX3N0YWdlIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIxOC41OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjI2MCIgeD0iMTIxLjI2IiB5PSIzMDkuNiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MS4wMzEzIiB4PSIyMjAuNzQ0NCIgeT0iMzI0LjU5NTEiPlN0YWdpbmc8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIHByb2QtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9InByb2QiIGRhdGEtc291cmNlLWxpbmU9IjE5IiBkYXRhLXVpZD0iZW50MDAxNCIgaWQ9ImNsdXN0ZXJfcHJvZCI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyMTguNTkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIzOTIiIHg9IjgzNy4yNiIgeT0iMzA5LjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYuMTQ2NSIgeD0iOTkwLjE4NjgiIHk9IjMyNC41OTUxIj5Qcm9kdWN0aW9uPC90ZXh0PjwvZz48IS0tZW50aXR5IGNvbW1vbl92YXJzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImNvbW1vbl92YXJzIiBkYXRhLXNvdXJjZS1saW5lPSIyIiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV9jb21tb25fdmFycyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3NS45OTk4IiB4PSIxNDEuMjYiIHk9IjUwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMTUxLjI2IiB5PSI3Mi45OTUxIj4mIzIwODQ5OyYjMzY4OTA7JiMyMjc5MzsmIzI1OTY4OzwvdGV4dD48L2c+PCEtLWVudGl0eSBnbG9iYWxfcmVzb3VyY2VzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Imdsb2JhbF9yZXNvdXJjZXMiIGRhdGEtc291cmNlLWxpbmU9IjMiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iZW50aXR5X2dsb2JhbF9yZXNvdXJjZXMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ1Ljk5OTUiIHg9IjI1Mi4yNiIgeT0iNTAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuOTk5NSIgeD0iMjYyLjI2IiB5PSI3Mi45OTUxIj4mIzEyNDY0OyYjMTI1MjU7JiMxMjU0MDsmIzEyNDk2OyYjMTI1MjM7JiMxMjUyMjsmIzEyNDc3OyYjMTI1NDA7JiMxMjQ3Mzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgaWFtX3BvbGljaWVzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImlhbV9wb2xpY2llcyIgZGF0YS1zb3VyY2UtbGluZT0iNCIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfaWFtX3BvbGljaWVzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwNi4yMzUxIiB4PSIxNTIuMTQiIHk9IjIwMC4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYuMjM1MSIgeD0iMTYyLjE0IiB5PSIyMjMuMjk1MSI+SUFNICYjMTI1MDk7JiMxMjUyMjsmIzEyNDcxOyYjMTI1NDA7PC90ZXh0PjwvZz48IS0tZW50aXR5IGRldl9hei0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJkZXZfYXoiIGRhdGEtc291cmNlLWxpbmU9IjgiIGRhdGEtdWlkPSJlbnQwMDA3IiBpZD0iZW50aXR5X2Rldl9heiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2Ny4xNjc4IiB4PSI1MjQuNjgiIHk9IjIwMC4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDcuMTY3OCIgeD0iNTM0LjY4IiB5PSIyMjMuMjk1MSI+JiMyMTMzNjsmIzE5OTY4O0FaPC90ZXh0PjwvZz48IS0tZW50aXR5IGRldl9pbnN0YW5jZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJkZXZfaW5zdGFuY2UiIGRhdGEtc291cmNlLWxpbmU9IjkiIGRhdGEtdWlkPSJlbnQwMDA4IiBpZD0iZW50aXR5X2Rldl9pbnN0YW5jZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDUuOTk5NSIgeD0iNjI3LjI2IiB5PSIyMDAuMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSI2MzcuMjYiIHk9IjIyMy4yOTUxIj4mIzIzNTY3OyYjMzUyMTU7JiMyNzE2OTsmIzEyNDUyOyYjMTI1MzE7JiMxMjQ3MzsmIzEyNDc5OyYjMTI1MzE7JiMxMjQ3Mzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZGV2X2RiLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImRldl9kYiIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGRhdGEtdWlkPSJlbnQwMDA5IiBpZD0iZW50aXR5X2Rldl9kYiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4Mi4zODQ2IiB4PSI1MjQuMDciIHk9IjM1Mi42Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjIuMzg0NiIgeD0iNTM0LjA3IiB5PSIzNzUuNTk1MSI+JiMzODI4MzsmIzMwMzMwOyYjMjk5OTI7REI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc3RhZ2VfYXotLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0ic3RhZ2VfYXoiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBkYXRhLXVpZD0iZW50MDAxMSIgaWQ9ImVudGl0eV9zdGFnZV9heiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4MS4xNjc4IiB4PSIxNjQuNjgiIHk9IjM1Mi42Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjEuMTY3OCIgeD0iMTc0LjY4IiB5PSIzNzUuNTk1MSI+JiMxMjUxMDsmIzEyNTIzOyYjMTI0ODE7QVo8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc3RhZ2VfaW5zdGFuY2UtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0ic3RhZ2VfaW5zdGFuY2UiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBkYXRhLXVpZD0iZW50MDAxMiIgaWQ9ImVudGl0eV9zdGFnZV9pbnN0YW5jZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3NS45OTk4IiB4PSIyODEuMjYiIHk9IjM1Mi42Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMjkxLjI2IiB5PSIzNzUuNTk1MSI+JiMyNjQxMjsmIzMwMDU4OyYjMzA0NTY7JiMyNDQwMzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgc3RhZ2VfZGItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0ic3RhZ2VfZGIiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBkYXRhLXVpZD0iZW50MDAxMyIgaWQ9ImVudGl0eV9zdGFnZV9kYiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDUuOTk5NSIgeD0iMTY0LjI2IiB5PSI0NjcuODkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuOTk5NSIgeD0iMTc0LjI2IiB5PSI0OTAuODg1MSI+JiMyNjQxMjsmIzMwMDU4OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMTIzOTg7JiMxMjQ2NzsmIzEyNTAwOyYjMTI1NDA7PC90ZXh0PjwvZz48IS0tZW50aXR5IHByb2RfYXotLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0icHJvZF9heiIgZGF0YS1zb3VyY2UtbGluZT0iMjAiIGRhdGEtdWlkPSJlbnQwMDE1IiBpZD0iZW50aXR5X3Byb2RfYXoiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQzLjc5ODUiIHg9Ijg2MS4zNiIgeT0iMzUyLjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjMuNzk4NSIgeD0iODcxLjM2IiB5PSIzNzUuNTk1MSI+JiMxMjUxMDsmIzEyNTIzOyYjMTI0ODE7QVogKyAmIzIwODg3OyYjMzgyNjM7JiMyMTI3MDs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgcHJvZF9pbnN0YW5jZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJwcm9kX2luc3RhbmNlIiBkYXRhLXNvdXJjZS1saW5lPSIyMSIgZGF0YS11aWQ9ImVudDAwMTYiIGlkPSJlbnRpdHlfcHJvZF9pbnN0YW5jZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDUuOTk5NSIgeD0iMTA0MC4yNiIgeT0iMzUyLjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuOTk5NSIgeD0iMTA1MC4yNiIgeT0iMzc1LjU5NTEiPiYjMzk2NDA7JiMyNDYxNTsmIzMzMDIxOyYjMTI0NTI7JiMxMjUzMTsmIzEyNDczOyYjMTI0Nzk7JiMxMjUzMTsmIzEyNDczOzwvdGV4dD48L2c+PCEtLWVudGl0eSBwcm9kX2RiLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9InByb2RfZGIiIGRhdGEtc291cmNlLWxpbmU9IjIyIiBkYXRhLXVpZD0iZW50MDAxNyIgaWQ9ImVudGl0eV9wcm9kX2RiIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE4MC42MzAyIiB4PSI4NjAuOTUiIHk9IjQ2Ny44OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2MC42MzAyIiB4PSI4NzAuOTUiIHk9IjQ5MC44ODUxIj4mIzEyNTI0OyYjMTI1MDM7JiMxMjUyMjsmIzEyNDU5OyArICYjMTI0OTY7JiMxMjQ4MzsmIzEyNDYzOyYjMTI0NTA7JiMxMjQ4MzsmIzEyNTAzOzwvdGV4dD48L2c+PCEtLWxpbmsgZ2xvYmFsIHRvIGRldi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJnbG9iYWwiIGRhdGEtZW50aXR5LTI9ImRldiIgZGF0YS1zb3VyY2UtbGluZT0iMjUiIGRhdGEtdWlkPSJsbmsxOCIgaWQ9ImxpbmtfZ2xvYmFsX2RldiI+PHBhdGggZD0iTTQ0MS4zMjQzLDkwLjUwNyBDNDQxLjQwMTQsOTAuNzExMiA0NDEuNDc4OSw5MC45MTY0IDQ0MS41NTY4LDkxLjEyMjggQzQ0MS44Njg1LDkxLjk0ODIgNDQyLjE4NjksOTIuNzkxMSA0NDIuNTExNCw5My42NTA1IEM0NDcuNzA0MSwxMDcuNDAwMyA0NTQuNDg4MSwxMjUuMzY0NCA0NjEuMjcxMiwxNDMuMzI2MyBDNDY4LjA1NDQsMTYxLjI4ODEgNDc0LjgzNjYsMTc5LjI0NzggNDgwLjAyNTUsMTkyLjk4ODkgQzQ4MC4zNDk4LDE5My44NDc3IDQ4MC42Njc5LDE5NC42OTAxIDQ4MC45NzkzLDE5NS41MTQ5IEM0ODEuMDU3MiwxOTUuNzIxMSA0NzkuMDE1LDE5MC4zMTMxIDQ3OS4wOTIxLDE5MC41MTcxIiBmaWxsPSJub25lIiBpZD0iZ2xvYmFsLXRvLWRldiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDgxLjIxMTcsMTk2LjEzMDIsNDgxLjc3NDQsMTg2LjI5NzQsNDc5LjQ0NTMsMTkxLjQ1MjYsNDc0LjI5MDIsMTg5LjEyMzYsNDgxLjIxMTcsMTk2LjEzMDIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC4wMDAxIiB4PSI0NTcuMjUiIHk9IjEyOS4zNjY5Ij4mIzIwODQ5OyYjMzY4OTA7JiMzNTM3MzsmIzIzNDUwOyYjMzIxNTM7JiMyNTIxNTs8L3RleHQ+PC9nPjwhLS1saW5rIGdsb2JhbCB0byBzdGFnZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJnbG9iYWwiIGRhdGEtZW50aXR5LTI9InN0YWdlIiBkYXRhLXNvdXJjZS1saW5lPSIyNiIgZGF0YS11aWQ9ImxuazE5IiBpZD0ibGlua19nbG9iYWxfc3RhZ2UiPjxwYXRoIGQ9Ik0xMTcuMDUzNCw5Mi4xOTA5IEMxMTMuNTgwOCw5My4xODIxIDExMC4xMTg1LDk0LjMzMTcgMTA2LjY2NTQsOTUuNjU0MiBDOTkuNzU5Miw5OC4yOTkzIDkyLjg4OTcsMTAxLjYzNjMgODYuMDQ4LDEwNS43ODIxIEM3Mi4zNjQ3LDExNC4wNzM5IDU4Ljc5MjUsMTI1LjYwMTMgNDUuMjYsMTQxLjMgQzYsMTg2Ljg1IDIzLjY5LDIyMC40NyA0NS4yNiwyNzYuNiBDNTUuMTA1LDMwMi4yMSA3NS42MDc1LDMyNS4xNzUgOTMuODkyNSwzNDEuODkzOCBDMTAzLjAzNSwzNTAuMjUzMSAxMTEuNjIzMSwzNTcuMDUwOSAxMTguMDQ3NSwzNjEuODM3IEMxMTguODUwNSwzNjIuNDM1MyAxMTkuNjE5OCwzNjMuMDAyMSAxMjAuMzUyMSwzNjMuNTM2NiBDMTIwLjUzNTEsMzYzLjY3MDMgMTIwLjcxNTksMzYzLjgwMTkgMTIwLjg5NDMsMzYzLjkzMTUgQzEyMC45ODM1LDM2My45OTYyIDExNi4yMTM0LDM2MC41NDAyIDExNi4zMDE0LDM2MC42MDQiIGZpbGw9Im5vbmUiIGlkPSJnbG9iYWwtdG8tc3RhZ2UiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyMS4xNjAxLDM2NC4xMjQzLDExNi4yMTg4LDM1NS42MDQ3LDExNy4xMTEyLDM2MS4xOTA3LDExMS41MjUxLDM2Mi4wODMsMTIxLjE2MDEsMzY0LjEyNDMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC4wMDAxIiB4PSI0Ni4yNiIgeT0iMjIzLjAxNjkiPiYjMjA4NDk7JiMzNjg5MDsmIzM1MzczOyYjMjM0NTA7JiMzMjE1MzsmIzI1MjE1OzwvdGV4dD48L2c+PCEtLWxpbmsgZ2xvYmFsIHRvIHByb2QtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZ2xvYmFsIiBkYXRhLWVudGl0eS0yPSJwcm9kIiBkYXRhLXNvdXJjZS1saW5lPSIyNyIgZGF0YS11aWQ9ImxuazIwIiBpZD0ibGlua19nbG9iYWxfcHJvZCI+PHBhdGggZD0iTTQ0MS40MzM3LDcwLjMzIEM0NDEuNjA0NSw3MC4zNTUxIDQ0MS43Nzc5LDcwLjM4MDYgNDQxLjk1MzgsNzAuNDA2NSBDNDQyLjY1NzQsNzAuNTEwMSA0NDMuNDAxMyw3MC42MiA0NDQuMTg0Niw3MC43MzYyIEM0NTAuNDUxMSw3MS42NjUzIDQ1OS4yMzk3LDcyLjk5NDEgNDcwLjA5MTksNzQuNyBDNDkxLjc5NjMsNzguMTExOSA1MjEuNzU1LDgzLjAzMjUgNTU2LjMsODkuMjgyNSBDNjI1LjM5LDEwMS43ODI1IDcxMi44MjUsMTE5LjYgNzg5LjI2LDE0MS4zIEM5NzcuNDYsMTk0LjczIDEwNzEuNjUsMTQ3Ljk0IDEyMDIuMjYsMjkzLjYgQzEyMDUuMDgsMjk2Ljc0MzggMTIwNy40OTU2LDMwMC4yNDI3IDEyMDkuNTYzNSwzMDMuOTY0NiBDMTIxMC4wODA0LDMwNC44OTUxIDEyMTAuNTc1NiwzMDUuODM5NSAxMjExLjA1LDMwNi43OTU4IEMxMjExLjI4NzIsMzA3LjI3NCAxMjExLjUxOTIsMzA3Ljc1NTEgMTIxMS43NDYsMzA4LjIzODkgQzEyMTEuODU5NSwzMDguNDgwOSAxMjExLjk3MTYsMzA4LjcyMzQgMTIxMi4wODI1LDMwOC45NjY3IEMxMjEyLjEzOCwzMDkuMDg4MyAxMjA5LjczMjksMzAzLjczNzcgMTIwOS43ODc3LDMwMy44NTk2IiBmaWxsPSJub25lIiBpZD0iZ2xvYmFsLXRvLXByb2QiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyMTIuMjQ3OSwzMDkuMzMyLDEyMTIuMjA1OSwyOTkuNDgzMywxMjEwLjE5NzcsMzA0Ljc3MTcsMTIwNC45MDkzLDMwMi43NjM1LDEyMTIuMjQ3OSwzMDkuMzMyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMTE4Ny4xMiIgeT0iMjIzLjAxNjkiPiYjMjA4NDk7JiMzNjg5MDsmIzM1MzczOyYjMjM0NTA7JiMzMjE1MzsmIzI1MjE1OzwvdGV4dD48L2c+PCEtLVNSQz1bWFBCQklpRDA1OFJ0RmFOZUxsZTJCZUhBR0xtOFdaaXQ4S3M3NENZYjk2YU5ZajNFZTU5S0FqWXg1cjJBYmp3aTU2bUxJbl9jY0FIdjJ6RDlCc2JpU05VNi1Wd1BSeXVQM1Y0NmZtV0lPYUF4YVhoWmYxMzN3T24wSS1QYUdyamljc1ZsSmhmZ3JoOU1lS2lYTmZMYkxNNUpkQVJ4RVMxVDg2cVd0cTFrVzNJMUQwMEY5cWx5d0prUnJQMms5WktVQk1OdDhsaUNhMFVRd1JpUDZYMHZjS3NlYWlZQkJkb3d1VVVaQThLYURJNFpuUTFlN0FLMnFqVmJkcTR3U1pKUlBSZFpmVXJrUmxvSWktZkZXNmowVWd1WXU5NU5wMUVZZWhpdVpfbXZmdFhmTHh4aVYzc3dDLVZZaU8zU2VTNDllWTlHbTNyMkdDamdHMXZmVXA5SkV1ZTRfQXB4YmJyZXM3UzNTdFpoV3JPZlVJWUcyemhnNE1Hd1c3ajB5aENrVWlhX2FXVVE2YV9vWGdXZ2I0Z3VveE1RcDJQWmRmVVNHai15QWl4ZldCN0pCNWxmcnA0UGhrYWVaUXBvMXo4MktnQUpSeGVOcVN6MzBCeTFWZnVLZkJJOFV1LU9fajVtVTlrRVZPbG5Ga1l1dFpPeExWa1pPY0w3VmlRUm03eUtWVnlndzFTMF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="42">4.2 グローバル変数管理<a class="headerlink" href="#42" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># environments/global/variables.tf</span>
<span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;meeting-room&quot;</span>

<span class="w">  </span><span class="nb">common_tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">local.project_name</span>
<span class="w">    </span><span class="na">ManagedBy</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform&quot;</span>
<span class="w">    </span><span class="na">Owner</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;platform-team&quot;</span>
<span class="w">    </span><span class="na">Repository</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;meeting-room-infrastructure&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">environments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span>
<span class="w">      </span><span class="na">instance_type</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;t3.micro&quot;</span>
<span class="w">      </span><span class="na">min_size</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="na">max_size</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="w">      </span><span class="na">desired_capacity</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">      </span><span class="na">db_instance_class</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;db.t3.micro&quot;</span>
<span class="w">      </span><span class="na">backup_retention</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">7</span>
<span class="w">      </span><span class="na">multi_az</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">      </span><span class="na">create_replica</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nb">stage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;stage&quot;</span>
<span class="w">      </span><span class="na">instance_type</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;t3.small&quot;</span>
<span class="w">      </span><span class="na">min_size</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="w">      </span><span class="na">max_size</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>
<span class="w">      </span><span class="na">desired_capacity</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="w">      </span><span class="na">db_instance_class</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;db.t3.small&quot;</span>
<span class="w">      </span><span class="na">backup_retention</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">7</span>
<span class="w">      </span><span class="na">multi_az</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="na">create_replica</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nb">prod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span>
<span class="w">      </span><span class="na">instance_type</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;t3.medium&quot;</span>
<span class="w">      </span><span class="na">min_size</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="w">      </span><span class="na">max_size</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">8</span>
<span class="w">      </span><span class="na">desired_capacity</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>
<span class="w">      </span><span class="na">db_instance_class</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;db.r6g.large&quot;</span>
<span class="w">      </span><span class="na">backup_retention</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
<span class="w">      </span><span class="na">multi_az</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">      </span><span class="na">create_replica</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">vpc_configs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">vpc_cidr</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.0/16&quot;</span>
<span class="w">      </span><span class="na">public_subnet_cidrs</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;10.0.1.0/24&quot;, &quot;10.0.2.0/24&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="na">private_subnet_cidrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;10.0.3.0/24&quot;, &quot;10.0.4.0/24&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="na">availability_zones</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ap-northeast-1a&quot;, &quot;ap-northeast-1c&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nb">stage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">vpc_cidr</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.1.0.0/16&quot;</span>
<span class="w">      </span><span class="na">public_subnet_cidrs</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;10.1.1.0/24&quot;, &quot;10.1.2.0/24&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="na">private_subnet_cidrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;10.1.3.0/24&quot;, &quot;10.1.4.0/24&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="na">availability_zones</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ap-northeast-1a&quot;, &quot;ap-northeast-1c&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nb">prod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">vpc_cidr</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.2.0.0/16&quot;</span>
<span class="w">      </span><span class="na">public_subnet_cidrs</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;10.2.1.0/24&quot;, &quot;10.2.2.0/24&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="na">private_subnet_cidrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;10.2.3.0/24&quot;, &quot;10.2.4.0/24&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="na">availability_zones</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ap-northeast-1a&quot;, &quot;ap-northeast-1c&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;project_config&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">local.project_name</span>
<span class="w">    </span><span class="na">tags</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">local.common_tags</span>
<span class="w">    </span><span class="na">environments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.environments</span>
<span class="w">    </span><span class="na">vpc_configs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.vpc_configs</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="43">4.3 環境固有の構成<a class="headerlink" href="#43" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># environments/prod/main.tf</span>
<span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&gt;= 1.0&quot;</span>

<span class="w">  </span><span class="kr">backend</span><span class="w"> </span><span class="nv">&quot;s3&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">bucket</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;meeting-room-terraform-state&quot;</span>
<span class="w">    </span><span class="na">key</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prod/terraform.tfstate&quot;</span>
<span class="w">    </span><span class="na">region</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ap-northeast-1&quot;</span>
<span class="w">    </span><span class="na">dynamodb_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;meeting-room-terraform-locks&quot;</span>
<span class="w">    </span><span class="na">encrypt</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hashicorp/aws&quot;</span>
<span class="w">      </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 5.0&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ap-northeast-1&quot;</span>

<span class="w">  </span><span class="nb">default_tags</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.common_tags</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># グローバル設定の読み込み</span>
<span class="kr">data</span><span class="w"> </span><span class="nc">&quot;terraform_remote_state&quot;</span><span class="w"> </span><span class="nv">&quot;global&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3&quot;</span>

<span class="w">  </span><span class="nb">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;meeting-room-terraform-state&quot;</span>
<span class="w">    </span><span class="na">key</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;global/terraform.tfstate&quot;</span>
<span class="w">    </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ap-northeast-1&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span>
<span class="w">  </span><span class="na">global_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.terraform_remote_state.global.outputs.project_config</span>
<span class="w">  </span><span class="na">env_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.global_config.environments[local.environment</span><span class="p">]</span>
<span class="w">  </span><span class="na">vpc_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.global_config.vpc_configs[local.environment</span><span class="p">]</span>
<span class="w">  </span><span class="na">common_tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">local.global_config.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.environment</span>
<span class="w">  </span><span class="p">})</span>
<span class="w">  </span><span class="na">name_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${local.global_config.name}-${local.environment}&quot;</span>
<span class="p">}</span>

<span class="c1"># ネットワークモジュール</span>
<span class="kr">module</span><span class="w"> </span><span class="nv">&quot;vpc&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../../modules/networking/vpc&quot;</span>

<span class="w">  </span><span class="na">name_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.name_prefix</span>

<span class="w">  </span><span class="na">vpc_cidr</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nv">local.vpc_config.vpc_cidr</span>
<span class="w">  </span><span class="na">public_subnet_cidrs</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">local.vpc_config.public_subnet_cidrs</span>
<span class="w">  </span><span class="na">private_subnet_cidrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.vpc_config.private_subnet_cidrs</span>
<span class="w">  </span><span class="na">availability_zones</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">local.vpc_config.availability_zones</span>

<span class="w">  </span><span class="na">enable_nat_gateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.common_tags</span>
<span class="p">}</span>

<span class="c1"># データベースモジュール</span>
<span class="kr">module</span><span class="w"> </span><span class="nv">&quot;database&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../../modules/database/postgresql&quot;</span>

<span class="w">  </span><span class="na">name_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.name_prefix</span>

<span class="w">  </span><span class="na">subnet_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.vpc.private_subnet_ids</span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">module.vpc.vpc_id</span>

<span class="w">  </span><span class="na">instance_class</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">local.env_config.db_instance_class</span>
<span class="w">  </span><span class="na">allocated_storage</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
<span class="w">  </span><span class="na">max_allocated_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>

<span class="w">  </span><span class="na">database_name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;meetingroom&quot;</span>
<span class="w">  </span><span class="na">database_username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.db_credentials.username</span>
<span class="w">  </span><span class="na">database_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.db_credentials.password</span>

<span class="w">  </span><span class="na">backup_retention_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.env_config.backup_retention</span>
<span class="w">  </span><span class="na">multi_az</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nv">local.env_config.multi_az</span>
<span class="w">  </span><span class="na">create_replica</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">local.env_config.create_replica</span>

<span class="w">  </span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.environment</span>
<span class="w">  </span><span class="na">tags</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">local.common_tags</span>
<span class="p">}</span>

<span class="c1"># Webアプリケーションモジュール</span>
<span class="kr">module</span><span class="w"> </span><span class="nv">&quot;web_app&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../../modules/compute/web-app&quot;</span>

<span class="w">  </span><span class="na">name_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.name_prefix</span>

<span class="w">  </span><span class="na">vpc_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">module.vpc.vpc_id</span>
<span class="w">  </span><span class="na">subnet_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.vpc.public_subnet_ids</span>

<span class="w">  </span><span class="na">instance_type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">local.env_config.instance_type</span>
<span class="w">  </span><span class="na">min_size</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">local.env_config.min_size</span>
<span class="w">  </span><span class="na">max_size</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">local.env_config.max_size</span>
<span class="w">  </span><span class="na">desired_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.env_config.desired_capacity</span>

<span class="w">  </span><span class="na">database_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;postgresql://${local.db_credentials.username}:${local.db_credentials.password}@${module.database.endpoint}/meetingroom&quot;</span>
<span class="w">  </span><span class="na">app_version</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.app_version</span>

<span class="w">  </span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.environment</span>
<span class="w">  </span><span class="na">tags</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">local.common_tags</span>

<span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">module.database</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Secrets Managerからのデータベース認証情報取得</span>
<span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_secretsmanager_secret_version&quot;</span><span class="w"> </span><span class="nv">&quot;db_credentials&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">secret_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${local.name_prefix}-db-credentials&quot;</span>
<span class="p">}</span>

<span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">db_credentials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsondecode</span><span class="p">(</span><span class="nv">data.aws_secretsmanager_secret_version.db_credentials.secret_string</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="5">5. セキュリティ設計<a class="headerlink" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 シークレット管理<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/security/secrets-manager/main.tf</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_secretsmanager_secret&quot;</span><span class="w"> </span><span class="nv">&quot;db_credentials&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-credentials&quot;</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Database credentials for ${var.name_prefix}&quot;</span>

<span class="w">  </span><span class="na">recovery_window_in_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-credentials&quot;</span>
<span class="w">    </span><span class="na">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Database&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_secretsmanager_secret_version&quot;</span><span class="w"> </span><span class="nv">&quot;db_credentials&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">secret_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_secretsmanager_secret.db_credentials.id</span>

<span class="w">  </span><span class="na">secret_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
<span class="w">    </span><span class="na">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.database_username</span>
<span class="w">    </span><span class="na">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.database_password</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">ignore_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">secret_string</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># 自動ローテーション（本番環境のみ）</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_secretsmanager_secret_rotation&quot;</span><span class="w"> </span><span class="nv">&quot;db_credentials&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span>

<span class="w">  </span><span class="na">secret_id</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_secretsmanager_secret.db_credentials.id</span>
<span class="w">  </span><span class="na">rotation_lambda_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.rotation_lambda_arn</span>

<span class="w">  </span><span class="nb">rotation_rules</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">automatically_after_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="52-iam">5.2 IAM ロール設計<a class="headerlink" href="#52-iam" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/security/iam/main.tf</span>
<span class="c1"># EC2インスタンス用のIAMロール</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;ec2_role&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-ec2-role&quot;</span>

<span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
<span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
<span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span>
<span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ec2.amazonaws.com&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="c1"># Secrets Manager読み取り権限</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_policy&quot;</span><span class="w"> </span><span class="nv">&quot;secrets_manager_policy&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-secrets-manager-policy&quot;</span>

<span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
<span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
<span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;secretsmanager:GetSecretValue&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;secretsmanager:DescribeSecret&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;arn:aws:secretsmanager:${var.region}:${var.account_id}:secret:${var.name_prefix}-db-credentials*&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;secrets_manager_attachment&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_policy.secrets_manager_policy.arn</span>
<span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.ec2_role.name</span>
<span class="p">}</span>

<span class="c1"># CloudWatch Logs権限</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_policy&quot;</span><span class="w"> </span><span class="nv">&quot;cloudwatch_logs_policy&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-cloudwatch-logs-policy&quot;</span>

<span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
<span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
<span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;logs:CreateLogGroup&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;logs:CreateLogStream&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;logs:PutLogEvents&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;logs:DescribeLogStreams&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;arn:aws:logs:${var.region}:${var.account_id}:log-group:/aws/ec2/${var.name_prefix}*&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;cloudwatch_logs_attachment&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_policy.cloudwatch_logs_policy.arn</span>
<span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.ec2_role.name</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_instance_profile&quot;</span><span class="w"> </span><span class="nv">&quot;ec2_profile&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-ec2-profile&quot;</span>
<span class="w">  </span><span class="na">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.ec2_role.name</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="53">5.3 セキュリティグループ設計<a class="headerlink" href="#53" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/security/security-groups/main.tf</span>
<span class="c1"># ALB用セキュリティグループ</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_security_group&quot;</span><span class="w"> </span><span class="nv">&quot;alb&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-alb-&quot;</span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span>

<span class="w">  </span><span class="nb">ingress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTP&quot;</span>
<span class="w">    </span><span class="na">from_port</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">80</span>
<span class="w">    </span><span class="na">to_port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">80</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
<span class="w">    </span><span class="na">cidr_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">ingress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTPS&quot;</span>
<span class="w">    </span><span class="na">from_port</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">443</span>
<span class="w">    </span><span class="na">to_port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">443</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
<span class="w">    </span><span class="na">cidr_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">egress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;All outbound&quot;</span>
<span class="w">    </span><span class="na">from_port</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="na">to_port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-1&quot;</span>
<span class="w">    </span><span class="na">cidr_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-alb-sg&quot;</span>
<span class="w">    </span><span class="na">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LoadBalancer&quot;</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Web層用セキュリティグループ</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_security_group&quot;</span><span class="w"> </span><span class="nv">&quot;web&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-web-&quot;</span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span>

<span class="w">  </span><span class="nb">ingress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">description</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTP from ALB&quot;</span>
<span class="w">    </span><span class="na">from_port</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">8080</span>
<span class="w">    </span><span class="na">to_port</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">8080</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
<span class="w">    </span><span class="na">security_groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_security_group.alb.id</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">ingress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SSH&quot;</span>
<span class="w">    </span><span class="na">from_port</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">22</span>
<span class="w">    </span><span class="na">to_port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">22</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
<span class="w">    </span><span class="na">cidr_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">var.vpc_cidr</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">egress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;All outbound&quot;</span>
<span class="w">    </span><span class="na">from_port</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="na">to_port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-1&quot;</span>
<span class="w">    </span><span class="na">cidr_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-web-sg&quot;</span>
<span class="w">    </span><span class="na">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;WebServer&quot;</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># データベース用セキュリティグループ</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_security_group&quot;</span><span class="w"> </span><span class="nv">&quot;database&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-&quot;</span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span>

<span class="w">  </span><span class="nb">ingress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">description</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PostgreSQL from Web&quot;</span>
<span class="w">    </span><span class="na">from_port</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">5432</span>
<span class="w">    </span><span class="na">to_port</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">5432</span>
<span class="w">    </span><span class="na">protocol</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
<span class="w">    </span><span class="na">security_groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_security_group.web.id</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-sg&quot;</span>
<span class="w">    </span><span class="na">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Database&quot;</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="6">6. 監視・ロギング<a class="headerlink" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61-cloudwatch">6.1 CloudWatch 監視<a class="headerlink" href="#61-cloudwatch" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/monitoring/cloudwatch/main.tf</span>
<span class="c1"># ALB監視</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_metric_alarm&quot;</span><span class="w"> </span><span class="nv">&quot;alb_response_time&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">alarm_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-alb-response-time&quot;</span>
<span class="w">  </span><span class="na">comparison_operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GreaterThanThreshold&quot;</span>
<span class="w">  </span><span class="na">evaluation_periods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2&quot;</span>
<span class="w">  </span><span class="na">metric_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TargetResponseTime&quot;</span>
<span class="w">  </span><span class="na">namespace</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS/ApplicationELB&quot;</span>
<span class="w">  </span><span class="na">period</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;300&quot;</span>
<span class="w">  </span><span class="na">statistic</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Average&quot;</span>
<span class="w">  </span><span class="na">threshold</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span>
<span class="w">  </span><span class="na">alarm_description</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;This metric monitors ALB response time&quot;</span>
<span class="w">  </span><span class="na">alarm_actions</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_sns_topic.alerts.arn</span><span class="p">]</span>

<span class="w">  </span><span class="nb">dimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">LoadBalancer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.alb_arn_suffix</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_metric_alarm&quot;</span><span class="w"> </span><span class="nv">&quot;alb_healthy_hosts&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">alarm_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-alb-healthy-hosts&quot;</span>
<span class="w">  </span><span class="na">comparison_operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LessThanThreshold&quot;</span>
<span class="w">  </span><span class="na">evaluation_periods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2&quot;</span>
<span class="w">  </span><span class="na">metric_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HealthyHostCount&quot;</span>
<span class="w">  </span><span class="na">namespace</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS/ApplicationELB&quot;</span>
<span class="w">  </span><span class="na">period</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;300&quot;</span>
<span class="w">  </span><span class="na">statistic</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Average&quot;</span>
<span class="w">  </span><span class="na">threshold</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">  </span><span class="na">alarm_description</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;This metric monitors healthy host count&quot;</span>
<span class="w">  </span><span class="na">alarm_actions</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_sns_topic.alerts.arn</span><span class="p">]</span>

<span class="w">  </span><span class="nb">dimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">TargetGroup</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.target_group_arn_suffix</span>
<span class="w">    </span><span class="na">LoadBalancer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.alb_arn_suffix</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="c1"># データベース監視</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_metric_alarm&quot;</span><span class="w"> </span><span class="nv">&quot;database_cpu&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">alarm_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-cpu&quot;</span>
<span class="w">  </span><span class="na">comparison_operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GreaterThanThreshold&quot;</span>
<span class="w">  </span><span class="na">evaluation_periods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2&quot;</span>
<span class="w">  </span><span class="na">metric_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CPUUtilization&quot;</span>
<span class="w">  </span><span class="na">namespace</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS/RDS&quot;</span>
<span class="w">  </span><span class="na">period</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;300&quot;</span>
<span class="w">  </span><span class="na">statistic</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Average&quot;</span>
<span class="w">  </span><span class="na">threshold</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;80&quot;</span>
<span class="w">  </span><span class="na">alarm_description</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;This metric monitors database CPU utilization&quot;</span>
<span class="w">  </span><span class="na">alarm_actions</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_sns_topic.alerts.arn</span><span class="p">]</span>

<span class="w">  </span><span class="nb">dimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">DBInstanceIdentifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.db_instance_id</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_metric_alarm&quot;</span><span class="w"> </span><span class="nv">&quot;database_connections&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">alarm_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-connections&quot;</span>
<span class="w">  </span><span class="na">comparison_operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GreaterThanThreshold&quot;</span>
<span class="w">  </span><span class="na">evaluation_periods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2&quot;</span>
<span class="w">  </span><span class="na">metric_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DatabaseConnections&quot;</span>
<span class="w">  </span><span class="na">namespace</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS/RDS&quot;</span>
<span class="w">  </span><span class="na">period</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;300&quot;</span>
<span class="w">  </span><span class="na">statistic</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Average&quot;</span>
<span class="w">  </span><span class="na">threshold</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;80&quot;</span>
<span class="w">  </span><span class="na">alarm_description</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;This metric monitors database connection count&quot;</span>
<span class="w">  </span><span class="na">alarm_actions</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_sns_topic.alerts.arn</span><span class="p">]</span>

<span class="w">  </span><span class="nb">dimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">DBInstanceIdentifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.db_instance_id</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="c1"># SNS通知設定</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_sns_topic&quot;</span><span class="w"> </span><span class="nv">&quot;alerts&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-alerts&quot;</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_sns_topic_subscription&quot;</span><span class="w"> </span><span class="nv">&quot;email_alerts&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">var.alert_email_addresses</span><span class="p">)</span>

<span class="w">  </span><span class="na">topic_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_sns_topic.alerts.arn</span>
<span class="w">  </span><span class="na">protocol</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;email&quot;</span>
<span class="w">  </span><span class="na">endpoint</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.alert_email_addresses[count.index</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># カスタムメトリクス</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_log_group&quot;</span><span class="w"> </span><span class="nv">&quot;app_logs&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/aws/ec2/${var.name_prefix}/application&quot;</span>
<span class="w">  </span><span class="na">retention_in_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.log_retention_days</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_log_group&quot;</span><span class="w"> </span><span class="nv">&quot;access_logs&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/aws/ec2/${var.name_prefix}/access&quot;</span>
<span class="w">  </span><span class="na">retention_in_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.log_retention_days</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="7">7. テスト戦略<a class="headerlink" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 単体テスト<a class="headerlink" href="#71" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// test/unit/vpc_test.go</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">test</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/gruntwork-io/terratest/modules/terraform&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/stretchr/testify/assert&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestVPCModule</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Parallel</span><span class="p">()</span>

<span class="w">    </span><span class="nx">terraformOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">WithDefaultRetryableErrors</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
<span class="w">        </span><span class="nx">TerraformDir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;../modules/networking/vpc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Vars</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">            </span><span class="s">&quot;name_prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test-vpc&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;vpc_cidr&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;10.0.0.0/16&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;public_subnet_cidrs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;10.0.1.0/24&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;10.0.2.0/24&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;private_subnet_cidrs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;10.0.3.0/24&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;10.0.4.0/24&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;availability_zones&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;ap-northeast-1a&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;ap-northeast-1c&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;enable_nat_gateway&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;Test&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;true&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;Environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
<span class="w">    </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">InitAndApply</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 出力値の検証</span>
<span class="w">    </span><span class="nx">vpcId</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Output</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vpc_id&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">NotEmpty</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">vpcId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;VPC ID should not be empty&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">publicSubnetIds</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">OutputList</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;public_subnet_ids&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Len</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">publicSubnetIds</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Should create 2 public subnets&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">privateSubnetIds</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">OutputList</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;private_subnet_ids&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Len</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">privateSubnetIds</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Should create 2 private subnets&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="72">7.2 統合テスト<a class="headerlink" href="#72" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// test/integration/full_stack_test.go</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">test</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>

<span class="w">    </span><span class="nx">http_helper</span><span class="w"> </span><span class="s">&quot;github.com/gruntwork-io/terratest/modules/http-helper&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/gruntwork-io/terratest/modules/random&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/gruntwork-io/terratest/modules/terraform&quot;</span>
<span class="w">    </span><span class="nx">test_structure</span><span class="w"> </span><span class="s">&quot;github.com/gruntwork-io/terratest/modules/test-structure&quot;</span>
<span class="p">)</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">envDir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;../environments/stage&quot;</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestFullStackDeployment</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Parallel</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// ステージベースのテスト実行</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">test_structure</span><span class="p">.</span><span class="nx">RunTestStage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cleanup&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">terraformOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">test_structure</span><span class="p">.</span><span class="nx">LoadTerraformOptions</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">envDir</span><span class="p">)</span>
<span class="w">        </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">test_structure</span><span class="p">.</span><span class="nx">RunTestStage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deploy&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">uniqueId</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">random</span><span class="p">.</span><span class="nx">UniqueId</span><span class="p">()</span>
<span class="w">        </span><span class="nx">terraformOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
<span class="w">            </span><span class="nx">TerraformDir</span><span class="p">:</span><span class="w"> </span><span class="nx">envDir</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Vars</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;app_version&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;test-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">uniqueId</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;integration_test&quot;</span><span class="p">:</span><span class="w">   </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;environment_suffix&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">uniqueId</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">test_structure</span><span class="p">.</span><span class="nx">SaveTerraformOptions</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">envDir</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
<span class="w">        </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">InitAndApply</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">test_structure</span><span class="p">.</span><span class="nx">RunTestStage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;validate&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">terraformOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">test_structure</span><span class="p">.</span><span class="nx">LoadTerraformOptions</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">envDir</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// ALB エンドポイントの取得</span>
<span class="w">        </span><span class="nx">albDnsName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Output</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;alb_dns_name&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">url</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;http://%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">albDnsName</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// ヘルスチェック</span>
<span class="w">        </span><span class="nx">http_helper</span><span class="p">.</span><span class="nx">HttpGetWithRetryWithCustomValidation</span><span class="p">(</span>
<span class="w">            </span><span class="nx">t</span><span class="p">,</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s/health&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">),</span>
<span class="w">            </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">            </span><span class="mi">30</span><span class="p">,</span>
<span class="w">            </span><span class="mi">10</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<span class="w">            </span><span class="kd">func</span><span class="p">(</span><span class="nx">statusCode</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">statusCode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">200</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="c1">// アプリケーション機能テスト</span>
<span class="w">        </span><span class="nx">http_helper</span><span class="p">.</span><span class="nx">HttpGetWithRetryWithCustomValidation</span><span class="p">(</span>
<span class="w">            </span><span class="nx">t</span><span class="p">,</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s/api/meeting-rooms&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">),</span>
<span class="w">            </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">            </span><span class="mi">10</span><span class="p">,</span>
<span class="w">            </span><span class="mi">5</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<span class="w">            </span><span class="kd">func</span><span class="p">(</span><span class="nx">statusCode</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">statusCode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">200</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="73">7.3 セキュリティテスト<a class="headerlink" href="#73" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// test/security/security_test.go</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">test</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/gruntwork-io/terratest/modules/terraform&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/stretchr/testify/assert&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestSecurityConfiguration</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Parallel</span><span class="p">()</span>

<span class="w">    </span><span class="nx">terraformOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">WithDefaultRetryableErrors</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
<span class="w">        </span><span class="nx">TerraformDir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;../environments/prod&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">PlanFilePath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./tfplan&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="c1">// terraform plan の実行</span>
<span class="w">    </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">InitAndPlan</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
<span class="w">    </span><span class="nx">plan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">ShowWithStruct</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// セキュリティ設定の検証</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;Database encryption&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">dbInstances</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">plan</span><span class="p">.</span><span class="nx">ResourcesByType</span><span class="p">[</span><span class="s">&quot;aws_db_instance&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">dbInstances</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">storageEncrypted</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">AttributeValues</span><span class="p">[</span><span class="s">&quot;storage_encrypted&quot;</span><span class="p">]</span>
<span class="w">            </span><span class="nx">assert</span><span class="p">.</span><span class="nx">True</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">storageEncrypted</span><span class="p">.(</span><span class="kt">bool</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Database storage should be encrypted&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;Security group rules&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">securityGroups</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">plan</span><span class="p">.</span><span class="nx">ResourcesByType</span><span class="p">[</span><span class="s">&quot;aws_security_group&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">sg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">securityGroups</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">ingress</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sg</span><span class="p">.</span><span class="nx">AttributeValues</span><span class="p">[</span><span class="s">&quot;ingress&quot;</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{})</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">rule</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">ingress</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">ruleMap</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rule</span><span class="p">.(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span>
<span class="w">                </span><span class="nx">cidrBlocks</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ruleMap</span><span class="p">[</span><span class="s">&quot;cidr_blocks&quot;</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{})</span>

<span class="w">                </span><span class="c1">// 0.0.0.0/0 からのSSH接続を禁止</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">ruleMap</span><span class="p">[</span><span class="s">&quot;from_port&quot;</span><span class="p">].(</span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">NotContains</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">cidrBlocks</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.0.0.0/0&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                        </span><span class="s">&quot;SSH should not be open to the world&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;Deletion protection&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">dbInstances</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">plan</span><span class="p">.</span><span class="nx">ResourcesByType</span><span class="p">[</span><span class="s">&quot;aws_db_instance&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">dbInstances</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">AttributeValues</span><span class="p">[</span><span class="s">&quot;identifier&quot;</span><span class="p">].(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;meeting-room-prod-db&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">deletionProtection</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">instance</span><span class="p">.</span><span class="nx">AttributeValues</span><span class="p">[</span><span class="s">&quot;deletion_protection&quot;</span><span class="p">]</span>
<span class="w">                </span><span class="nx">assert</span><span class="p">.</span><span class="nx">True</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">deletionProtection</span><span class="p">.(</span><span class="kt">bool</span><span class="p">),</span><span class="w"> </span>
<span class="w">                    </span><span class="s">&quot;Production database should have deletion protection enabled&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="8-cicd">8. CI/CD 統合<a class="headerlink" href="#8-cicd" title="Permanent link">&para;</a></h2>
<h3 id="81-github-actions">8.1 GitHub Actions ワークフロー<a class="headerlink" href="#81-github-actions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># .github/workflows/terraform.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Infrastructure</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">develop</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;terraform/**&#39;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;terraform/**&#39;</span><span class="p p-Indicator">]</span>

<span class="nt">env</span><span class="p">:</span>
<span class="w">  </span><span class="nt">TF_VERSION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.5.0</span>
<span class="w">  </span><span class="nt">TF_IN_AUTOMATION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">permissions</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
<span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">pull-requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">validate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Validate Terraform</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.TF_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Format Check</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform fmt -check -recursive ./terraform/</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Validate</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">find ./terraform -name &quot;*.tf&quot; -path &quot;*/modules/*&quot; -execdir terraform init -backend=false \;</span>
<span class="w">          </span><span class="no">find ./terraform -name &quot;*.tf&quot; -path &quot;*/modules/*&quot; -execdir terraform validate \;</span>

<span class="w">  </span><span class="nt">plan</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Plan Infrastructure</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39;</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">validate</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">dev</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">stage</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS credentials</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_ROLE_TO_ASSUME }}</span>
<span class="w">          </span><span class="nt">role-session-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform-${{ matrix.environment }}</span>
<span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ap-northeast-1</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.TF_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
<span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/${{ matrix.environment }}</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
<span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/${{ matrix.environment }}</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">terraform plan -out=tfplan -var=&quot;app_version=${{ github.sha }}&quot;</span>
<span class="w">          </span><span class="no">terraform show -no-color tfplan &gt; plan.txt</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Comment PR with Plan</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/github-script@v7</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">const fs = require(&#39;fs&#39;);</span>
<span class="w">            </span><span class="no">const plan = fs.readFileSync(&#39;./terraform/environments/${{ matrix.environment }}/plan.txt&#39;, &#39;utf8&#39;);</span>
<span class="w">            </span><span class="no">const truncatedPlan = plan.length &gt; 65000 ? plan.substring(0, 65000) + &quot;\n...truncated&quot; : plan;</span>

<span class="w">            </span><span class="no">github.rest.issues.createComment({</span>
<span class="w">              </span><span class="no">issue_number: context.issue.number,</span>
<span class="w">              </span><span class="no">owner: context.repo.owner,</span>
<span class="w">              </span><span class="no">repo: context.repo.repo,</span>
<span class="w">              </span><span class="no">body: `## Terraform Plan (${{ matrix.environment }})</span>

<span class="w">              </span><span class="no">\`\`\`</span>
<span class="w">              </span><span class="no">${truncatedPlan}</span>
<span class="w">              </span><span class="no">\`\`\`</span>
<span class="w">              </span><span class="no">`</span>
<span class="w">            </span><span class="no">});</span>

<span class="w">  </span><span class="nt">deploy-dev</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to Development</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.ref == &#39;refs/heads/develop&#39;</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">validate</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">development</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS credentials</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_ROLE_TO_ASSUME }}</span>
<span class="w">          </span><span class="nt">role-session-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform-dev</span>
<span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ap-northeast-1</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.TF_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
<span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/dev</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
<span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/dev</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform apply -auto-approve -var=&quot;app_version=${{ github.sha }}&quot;</span>

<span class="w">  </span><span class="nt">deploy-stage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to Staging</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.ref == &#39;refs/heads/main&#39;</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">validate</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS credentials</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_ROLE_TO_ASSUME }}</span>
<span class="w">          </span><span class="nt">role-session-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform-stage</span>
<span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ap-northeast-1</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.TF_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
<span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/stage</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
<span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/stage</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform apply -auto-approve -var=&quot;app_version=${{ github.sha }}&quot;</span>

<span class="w">  </span><span class="nt">deploy-prod</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to Production</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.ref == &#39;refs/heads/main&#39;</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">deploy-stage</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS credentials</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_ROLE_TO_ASSUME }}</span>
<span class="w">          </span><span class="nt">role-session-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform-prod</span>
<span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ap-northeast-1</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.TF_VERSION }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
<span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/prod</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
<span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/prod</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform plan -out=tfplan -var=&quot;app_version=${{ github.sha }}&quot;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Manual Approval Required</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">echo &quot;Production deployment requires manual approval&quot;</span>
<span class="w">          </span><span class="no">echo &quot;Review the plan and approve in GitHub Actions&quot;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
<span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/prod</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform apply tfplan</span>
</code></pre></div>
<h3 id="82-oidc">8.2 OIDC 設定<a class="headerlink" href="#82-oidc" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># terraform/iam-oidc/main.tf</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_openid_connect_provider&quot;</span><span class="w"> </span><span class="nv">&quot;github&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://token.actions.githubusercontent.com&quot;</span>

<span class="w">  </span><span class="na">client_id_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;sts.amazonaws.com&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">]</span>

<span class="w">  </span><span class="na">thumbprint_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;6938fd4d98bab03faadb97b34396831e3780aea1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;1c58a3a8518e8759bf075b76b750d4f2df264fcd&quot;</span>
<span class="w">  </span><span class="p">]</span>

<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;github-actions-oidc&quot;</span>
<span class="w">    </span><span class="na">ManagedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;github_actions&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;github-actions-terraform&quot;</span>

<span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
<span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
<span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRoleWithWebIdentity&quot;</span>
<span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="na">Federated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_openid_connect_provider.github.arn</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nb">Condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nb">StringEquals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;token.actions.githubusercontent.com:aud&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts.amazonaws.com&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">          </span><span class="nb">StringLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;token.actions.githubusercontent.com:sub&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repo:organization/meeting-room-infrastructure:*&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;github-actions-terraform&quot;</span>
<span class="w">    </span><span class="na">ManagedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy&quot;</span><span class="w"> </span><span class="nv">&quot;github_actions_terraform&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-permissions&quot;</span>
<span class="w">  </span><span class="na">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.github_actions.id</span>

<span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
<span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
<span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
<span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;ec2:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;rds:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;elasticloadbalancing:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;autoscaling:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;iam:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;s3:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;dynamodb:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;secretsmanager:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;logs:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;cloudwatch:*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;sns:*&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="9">9. コスト最適化<a class="headerlink" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="91">9.1 リソース最適化<a class="headerlink" href="#91" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/cost-optimization/spot-instances/main.tf</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_launch_template&quot;</span><span class="w"> </span><span class="nv">&quot;spot&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-spot-&quot;</span>

<span class="w">  </span><span class="na">image_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.ami_id</span>
<span class="w">  </span><span class="na">instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.instance_type</span>
<span class="w">  </span><span class="na">key_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.key_name</span>

<span class="w">  </span><span class="na">vpc_security_group_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_ids</span>

<span class="w">  </span><span class="nb">instance_market_options</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">market_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spot&quot;</span>
<span class="w">    </span><span class="nb">spot_options</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">spot_instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;one-time&quot;</span>
<span class="w">      </span><span class="na">max_price</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.spot_price</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">user_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.user_data</span>

<span class="w">  </span><span class="nb">tag_specifications</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">resource_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;instance&quot;</span>
<span class="w">    </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-spot-instance&quot;</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_autoscaling_group&quot;</span><span class="w"> </span><span class="nv">&quot;spot&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-spot-asg&quot;</span>

<span class="w">  </span><span class="na">vpc_zone_identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.subnet_ids</span>
<span class="w">  </span><span class="na">target_group_arns</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">var.target_group_arns</span>
<span class="w">  </span><span class="na">health_check_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ELB&quot;</span>

<span class="w">  </span><span class="na">min_size</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.min_size</span>
<span class="w">  </span><span class="na">max_size</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.max_size</span>
<span class="w">  </span><span class="na">desired_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.desired_capacity</span>

<span class="w">  </span><span class="nb">mixed_instances_policy</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">launch_template</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">launch_template_specification</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="na">launch_template_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_launch_template.spot.id</span>
<span class="w">        </span><span class="na">version</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$Latest&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nb">instances_distribution</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">on_demand_base_capacity</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.on_demand_base_capacity</span>
<span class="w">      </span><span class="na">on_demand_percentage_above_base_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.on_demand_percentage</span>
<span class="w">      </span><span class="na">spot_allocation_strategy</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;diversified&quot;</span>
<span class="w">      </span><span class="na">spot_instance_pools</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">tag</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">key</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name&quot;</span>
<span class="w">    </span><span class="na">value</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-spot-asg&quot;</span>
<span class="w">    </span><span class="na">propagate_at_launch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="92">9.2 スケジューリングと自動化<a class="headerlink" href="#92" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/scheduling/auto-shutdown/main.tf</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;auto_shutdown&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">filename</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;auto_shutdown.zip&quot;</span>
<span class="w">  </span><span class="na">function_name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-auto-shutdown&quot;</span>
<span class="w">  </span><span class="na">role</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.arn</span>
<span class="w">  </span><span class="na">handler</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda_function.lambda_handler&quot;</span>
<span class="w">  </span><span class="na">runtime</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;python3.9&quot;</span>
<span class="w">  </span><span class="na">timeout</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>

<span class="w">  </span><span class="na">source_code_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.auto_shutdown_zip.output_base64sha256</span>

<span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">ENVIRONMENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
<span class="w">      </span><span class="na">TAG_KEY</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AutoShutdown&quot;</span>
<span class="w">      </span><span class="na">TAG_VALUE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_event_rule&quot;</span><span class="w"> </span><span class="nv">&quot;auto_shutdown_schedule&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span>

<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-auto-shutdown&quot;</span>
<span class="w">  </span><span class="na">description</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Schedule for auto shutdown of development resources&quot;</span>
<span class="w">  </span><span class="na">schedule_expression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cron(0 18 ? * MON-FRI *)&quot;</span><span class="c1">  # 平日18時</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_event_target&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_target&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span>

<span class="w">  </span><span class="na">rule</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudwatch_event_rule.auto_shutdown_schedule[0].name</span>
<span class="w">  </span><span class="na">target_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AutoShutdownTarget&quot;</span>
<span class="w">  </span><span class="na">arn</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.auto_shutdown.arn</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_permission&quot;</span><span class="w"> </span><span class="nv">&quot;allow_cloudwatch&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span>

<span class="w">  </span><span class="na">statement_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AllowExecutionFromCloudWatch&quot;</span>
<span class="w">  </span><span class="na">action</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span>
<span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.auto_shutdown.function_name</span>
<span class="w">  </span><span class="na">principal</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;events.amazonaws.com&quot;</span>
<span class="w">  </span><span class="na">source_arn</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudwatch_event_rule.auto_shutdown_schedule[0].arn</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="10">10. 災害対策・冗長化<a class="headerlink" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="101-az">10.1 マルチ AZ 構成<a class="headerlink" href="#101-az" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjY1OHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6ODUzcHg7aGVpZ2h0OjY1OHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDg1MyA2NTgiIHdpZHRoPSI4NTNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIEFXUyBDbG91ZC0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iQVdTIENsb3VkIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfQVdTIENsb3VkIj48cGF0aCBkPSJNNDkuNTYzMSwzNy44Mjg1IEM2MS4zNTMzLDE1Ljg5OTEgNzguNjgsMjAuODU0NCA5MC45Njk3LDM3LjI4OTMgQzEwMS42MDMzLDE0LjM1ODggMTE5LjAyNywxNi45NDQyIDEzMy4wNjE3LDMzLjY4MDIgQzE0Ny4yOTk5LDE0Ljk5NzEgMTY1LjE2MDksMTUuNzE4OCAxNzcuNzQ2NiwzNS41OTUyIEMxOTEuNjI5NCw4LjI4ODcgMjEwLjI4MDQsOC4xNTQzIDIyNy44NzIxLDMxLjk1NzkgQzI0MC43NzgxLDE0LjI2MTYgMjUzLjY3NzcsOS43OTYyIDI2OC4wODc0LDMwLjM3ODEgQzI4MS4zMjcxLDYgMzAyLjM3MzUsNy45MzE4IDMxNS40NjA2LDMwLjUzMiBDMzI2LjU3NTUsMTIuMzQgMzQ1LjQ0ODgsMTMuMDUxNSAzNTUuNDMwOCwzMS43NTkzIEMzNjkuNTU2NSw2LjY2NyAzOTIuMjgyOSwxMC4yOTYzIDQwNS42NjI3LDMyLjU1MDYgQzQxNy4xOTMzLDExLjkwNzMgNDMzLjc4MDEsMTMuMjc3OSA0NDUuMTUyOCwzMi43MDYxIEM0NTkuMDU4OCwxMi42NTE5IDQ4Mi4zMzU2LDEyLjI2MTYgNDk0LjEzNTUsMzUuMTEwNyBDNTA2LjMzMjIsMTUuNzUzIDUyNC4wNDA1LDE4LjAwNTIgNTMyLjMwNTMsMzguODQ0NCBDNTQzLjM0NTEsMTAuOTkxNCA1NjguNTE1MywxMy44ODAzIDU4Mi41OTk2LDM1Ljc2NiBDNTkyLjkwODgsMTkuNTQzNiA2MTEuMjY1NCwyMC41NSA2MjAuNTgzMywzNi45MjEzIEM2NDAuNjg5MywxOC41MDY4IDY1Ni44ODA1LDE2Ljg2NTIgNjcwLjg2NjcsNDMuNzE5IEM2NzMuNzEyLDQwLjY0MTggNjc2LjczMzYsNDAuNzQ1OSA2NzguNDEwMyw0NC45MzI1IEM3MDIuNDMzMyw2NC43NjAyIDcwMS4zMjc1LDgyLjUwMjggNjczLjQxMzIsOTcuMzgyMSBDNjkzLjU3MDcsMTEwLjg1MzUgNjk1LjM4NiwxMjQuNDIyNyA2NzUuMjU3NSwxMzkuNjUxOSBDNzAwLjczODcsMTU0LjEyMjUgNjk2LjQ1NzYsMTc3LjcwNzYgNjcyLjg5MzYsMTg5Ljg2OTQgQzY5Ny4wMTMxLDIwMy40OTIyIDY5My4zNzY2LDIyNi4wNDI4IDY3Mi42NDA2LDIzOS40MzY2IEM2OTQuNTk0OSwyNTEuNDYyNSA2OTcuODU0NCwyNzEuNDY0MSA2NzQuNTYxOCwyODUuMzgxOSBDNjk5LjMyMzQsMjk5LjI2ODcgNjk3LjgxOTIsMzIxLjU0OSA2NzIuMjMyNiwzMzIuOTcxNSBDNjkyLjIxNDEsMzQyLjA2MDUgNjk3LjA5NDYsMzU4LjY1NDUgNjc5LjU4NDYsMzc0LjM5NzIgQzcwNC4xODczLDM5Mi4yMjMgNzAxLjgxNDEsNDA5LjE1MTMgNjc3Ljc4OTksNDI1LjI2MTQgQzcwMS42MTA5LDQzOS4xMDMyIDcwMS45NDc4LDQ1NC41ODQyIDY3OS4zOTMxLDQ3MC4wODQ3IEM3MDAuMjAxMyw0ODguMzI4NCA3MDEuODc2Nyw1MDIuNTgyOSA2NzUuMzY1Nyw1MTYuNzQyIEM2OTYuNDkzOCw1MzAuNjI3NiA3MDAuOTMyNiw1NTMuNDgzNiA2NzYuNDgyNyw1NjguMzU1NSBDNjkxLjg2MDMsNTg3LjkyODIgNjkwLjg5NjUsNjA3LjM1ODQgNjYzLjg2NjcsNjE1LjYwOSBDNjY4LjUwMjEsNjEzLjYzNjIgNjcxLjAwNzcsNjE0LjgzMTEgNjcxLjE0MzksNjIwLjExODYgQzY1OS40NDM4LDY0NC42MTA1IDYzNi45Mjg5LDY0MC4yMzIxIDYyNC4xMjc5LDYyMS4zMTA5IEM2MDcuMzg4NSw2NDQuODM4IDU5MS4xMDIxLDY0Mi45MDM5IDU3Ni40MjYzLDYxOS4yMjU1IEM1NjUuMDUwNSw2MzkuNTU4NSA1NDUuMTc5Nyw2MzkuODMxNyA1MzQuMTg2Nyw2MTguODM0MyBDNTI1LjE2MjQsNjQwLjE3MzYgNTA5LjYwNTQsNjQ0LjQyNDIgNDk0LjEzLDYyNS4yMDU3IEM0ODAuMjgxNCw2NDguNzkwNyA0NjAuODQ4Myw2NDkuODQ0MyA0NDYuODc3OSw2MjUuMzI1MiBDNDM0LjQ0NDcsNjUxLjk1NjYgNDExLjM2MjUsNjQ2LjM3MjYgMzk4LjE3MTEsNjI2LjExMjggQzM4NS43ODg1LDY0Ni42MjE5IDM2Ni4xNTQ5LDY0NS40NTAxIDM1NS40ODA3LDYyNC4zNTk1IEMzNDQuMjEyOSw2NDQuMTMyOCAzMjguNDY2OSw2MzkuNjE0NyAzMTcuMzIyNyw2MjQuMjI1NCBDMzAxLjk3OTcsNjQ5Ljg1OTQgMjc4LjY5Myw2NDMuNjI0NCAyNjYuMzY5NCw2MjEuMDM1IEMyNTQuOTkxOSw2NDAuNTgwMiAyMzYuNTIxLDYzOC4xNjkxIDIyNi4wNDUzLDYyMC4wNjkgQzIwOS41MDY5LDY0MS4xNDAxIDE5NC41ODEyLDY0My4zNjI4IDE3Ny44ODI4LDYyMC4yNDM0IEMxNjUuMjQzMiw2MzguNzIxMiAxNTEuNDgzLDYzOC41MjMxIDEzOS44OTEzLDYxOS4xOTA1IEMxMjMuNjI1LDYzOS40OTMgMTAzLjEwOTYsNjQzLjA5MzUgODguMzc1LDYxNy40NzIzIEM2OC4zNTQsNjM5LjQzNzggNDguNjE0OCw2MzQuNzIwNyAzNi44NjY3LDYwOC42MDkgQzM3LjY2MzEsNjA4LjY0MiAzNy44NDQxLDYwOS4xNzY5IDM3LjQ2NzEsNjA5LjgwMSBDMTYuNTUsNTk4LjE5NjggMjAuMTUwNyw1NzkuODY5OSAzNy40OTE0LDU2OC4yODgyIEMxMy41NzY0LDU1MS42NjY3IDE2LjIyMzQsNTM2Ljk3MjIgMzcuMjUxLDUyMC4xMjYzIEMxMS44MTI4LDUxMC41MTM2IDE0LjA2MjUsNDg4LjAwODQgMzIuODY4Nyw0NzQuMTc2MSBDMTEuNTE5MSw0NTQuODkxMSAxMS44MzAyLDQzOC40OTMyIDM0LjU5MDEsNDIwLjYyNjIgQzExLjc0ODgsNDA5LjU1OTkgNiwzODkuMTQ5NiAyOS45MDIyLDM3My40MzkzIEMxMS45MzcxLDM1OS44NTg4IDkuMTExLDM0NS45MDE1IDI4LjgxNTUsMzMxLjM0ODUgQzkuNzU1MywzMTIuOTMzMyA5LjA5MjUsMjk0LjA2MTIgMzMuNzk4MywyNzkuODgzNCBDOS43MjEyLDI2OS4zNDc3IDE0LjE1MDEsMjQ4LjMzMjUgMzEuNjQxOCwyMzUuNzY0OSBDMTMuMTkzOCwyMTcuOTk4MiAxNC4wNTg5LDIwMS4wODA4IDM5LjY0NTQsMTkxLjIyNzIgQzE2LjgxNjMsMTc5Ljg2ODIgMTMuODUxOCwxNjIuMTM3MyAzMy44NjA0LDE0NS4zNzM4IEMxMS4zNDIsMTI4LjE2MzkgMTEuNTMxMiwxMDcuNDEzIDM4LjUzMjksOTQuNzc2MSBDMTMuNDgwMiw3Mi4wNTI1IDE2LjYwNTcsNTQuNjM2NSA0My44NjY3LDM2LjcxOSBDNDYuMzA0OCwzNC41Mjc2IDQ4LjEzOTQsMzQuODEyNCA0OS41NjMxLDM3LjgyODUiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODUuOTE0MSIgeD0iMzEwLjkwOTciIHk9IjU0LjcxNDEiPkFXUyBDbG91ZDwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgcmVnaW9uLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJyZWdpb24iIGRhdGEtc291cmNlLWxpbmU9IjIiIGRhdGEtdWlkPSJlbnQwMDAzIiBpZD0iY2x1c3Rlcl9yZWdpb24iPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNTI3Ljg5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjAyIiB4PSI1Mi44NjY3IiB5PSI3MS43MTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgzLjEwMDYiIHg9IjI2Mi4zMTY0IiB5PSI4Ni43MTQxIj5SZWdpb246IGFwLW5vcnRoZWFzdC0xPC90ZXh0PjwvZz48IS0tY2x1c3RlciBhejEtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9ImF6MSIgZGF0YS1zb3VyY2UtbGluZT0iMyIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJjbHVzdGVyX2F6MSI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyNzguMDkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIxNzIiIHg9Ijc2Ljg2NjciIHk9IjI3Ny4wMTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU2Ljg1NzQiIHg9Ijg0LjQzOCIgeT0iMjkyLjAxNDEiPkF2YWlsYWJpbGl0eSBab25lIDFhPC90ZXh0PjwvZz48IS0tY2x1c3RlciBhejItLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9ImF6MiIgZGF0YS1zb3VyY2UtbGluZT0iOCIgZGF0YS11aWQ9ImVudDAwMDciIGlkPSJjbHVzdGVyX2F6MiI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI5Ny4yOSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjMwNSIgeD0iMjk4Ljg2NjciIHk9IjI3Ny4wMTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU1LjcwOSIgeD0iMzczLjUxMjIiIHk9IjI5Mi4wMTQxIj5BdmFpbGFiaWxpdHkgWm9uZSAxYzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgYWxiLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJhbGIiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBkYXRhLXVpZD0iZW50MDAxMCIgaWQ9ImNsdXN0ZXJfYWxiIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjExMy4zIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMjIyIiB4PSIzMTEuODY2NyIgeT0iMTIyLjcxOSIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIxNSIgeD0iNTEzLjg2NjciIHk9IjEyNy43MTkiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI0IiB4PSI1MTEuODY2NyIgeT0iMTI5LjcxOSIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjQiIHg9IjUxMS44NjY3IiB5PSIxMzMuNzE5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwNi4wODMiIHg9IjMxOS44MjUyIiB5PSIxNDguNzE0MSI+QXBwbGljYXRpb24gTG9hZCBCYWxhbmNlcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgczMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9InMzIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgZGF0YS11aWQ9ImVudDAwMTIiIGlkPSJjbHVzdGVyX3MzIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjEyMS4zIiByeD0iMzUiIHJ5PSIzNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjM0MiIgeD0iMjgwLjg2NjciIHk9IjQ0Ni4zMDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzkuMTMyOCIgeD0iNDEyLjMwMDMiIHk9IjQ2Ni4zMDQxIj5TMyBCdWNrZXQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgd2ViMS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJ3ZWIxIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBkYXRhLXVpZD0iZW50MDAwNSIgaWQ9ImVudGl0eV93ZWIxIj48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9Ijk3LjMzNjcsMzIyLjAxOSwxMDcuMzM2NywzMTIuMDE5LDIzMi4zOTczLDMxMi4wMTksMjMyLjM5NzMsMzQ4LjMxNTksMjIyLjM5NzMsMzU4LjMxNTksOTcuMzM2NywzNTguMzE1OSw5Ny4zMzY3LDMyMi4wMTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIyMi4zOTczIiB4Mj0iMjMyLjM5NzMiIHkxPSIzMjIuMDE5IiB5Mj0iMzEyLjAxOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijk3LjMzNjciIHgyPSIyMjIuMzk3MyIgeTE9IjMyMi4wMTkiIHkyPSIzMjIuMDE5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjIyLjM5NzMiIHgyPSIyMjIuMzk3MyIgeTE9IjMyMi4wMTkiIHkyPSIzNTguMzE1OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk1LjA2MDUiIHg9IjExMi4zMzY3IiB5PSIzNDUuMDE0MSI+V2ViIFNlcnZlciAxPC90ZXh0PjwvZz48IS0tZW50aXR5IGRiMS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJkYjEiIGRhdGEtc291cmNlLWxpbmU9IjUiIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iZW50aXR5X2RiMSI+PHBhdGggZD0iTTEzMy4yNzY3LDUwMy44MDkgQzEzMy4yNzY3LDQ5My44MDkgMTgyLjg2NzEsNDkzLjgwOSAxODIuODY3MSw0OTMuODA5IEMxODIuODY3MSw0OTMuODA5IDIzMi40NTc0LDQ5My44MDkgMjMyLjQ1NzQsNTAzLjgwOSBMMjMyLjQ1NzQsNTI5LjEwNTkgQzIzMi40NTc0LDUzOS4xMDU5IDE4Mi44NjcxLDUzOS4xMDU5IDE4Mi44NjcxLDUzOS4xMDU5IEMxODIuODY3MSw1MzkuMTA1OSAxMzMuMjc2Nyw1MzkuMTA1OSAxMzMuMjc2Nyw1MjkuMTA1OSBMMTMzLjI3NjcsNTAzLjgwOSIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTEzMy4yNzY3LDUwMy44MDkgQzEzMy4yNzY3LDUxMy44MDkgMTgyLjg2NzEsNTEzLjgwOSAxODIuODY3MSw1MTMuODA5IEMxODIuODY3MSw1MTMuODA5IDIzMi40NTc0LDUxMy44MDkgMjMyLjQ1NzQsNTAzLjgwOSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzkuMTgwNyIgeD0iMTQzLjI3NjciIHk9IjUzMC44MDQxIj5EQiBQcmltYXJ5PC90ZXh0PjwvZz48IS0tZW50aXR5IHdlYjItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0id2ViMiIgZGF0YS1zb3VyY2UtbGluZT0iOSIgZGF0YS11aWQ9ImVudDAwMDgiIGlkPSJlbnRpdHlfd2ViMiI+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI0NTIuMzM2NywzMjIuMDE5LDQ2Mi4zMzY3LDMxMi4wMTksNTg3LjM5NzMsMzEyLjAxOSw1ODcuMzk3MywzNDguMzE1OSw1NzcuMzk3MywzNTguMzE1OSw0NTIuMzM2NywzNTguMzE1OSw0NTIuMzM2NywzMjIuMDE5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1NzcuMzk3MyIgeDI9IjU4Ny4zOTczIiB5MT0iMzIyLjAxOSIgeTI9IjMxMi4wMTkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0NTIuMzM2NyIgeDI9IjU3Ny4zOTczIiB5MT0iMzIyLjAxOSIgeTI9IjMyMi4wMTkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1NzcuMzk3MyIgeDI9IjU3Ny4zOTczIiB5MT0iMzIyLjAxOSIgeTI9IjM1OC4zMTU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTUuMDYwNSIgeD0iNDY3LjMzNjciIHk9IjM0NS4wMTQxIj5XZWIgU2VydmVyIDI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZGIyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImRiMiIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGRhdGEtdWlkPSJlbnQwMDA5IiBpZD0iZW50aXR5X2RiMiI+PHBhdGggZD0iTTMxNC41MDY3LDMyMi41MTkgQzMxNC41MDY3LDMxMi41MTkgMzY1Ljg2NzYsMzEyLjUxOSAzNjUuODY3NiwzMTIuNTE5IEMzNjUuODY3NiwzMTIuNTE5IDQxNy4yMjg0LDMxMi41MTkgNDE3LjIyODQsMzIyLjUxOSBMNDE3LjIyODQsMzQ3LjgxNTkgQzQxNy4yMjg0LDM1Ny44MTU5IDM2NS44Njc2LDM1Ny44MTU5IDM2NS44Njc2LDM1Ny44MTU5IEMzNjUuODY3NiwzNTcuODE1OSAzMTQuNTA2NywzNTcuODE1OSAzMTQuNTA2NywzNDcuODE1OSBMMzE0LjUwNjcsMzIyLjUxOSIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTMxNC41MDY3LDMyMi41MTkgQzMxNC41MDY3LDMzMi41MTkgMzY1Ljg2NzYsMzMyLjUxOSAzNjUuODY3NiwzMzIuNTE5IEMzNjUuODY3NiwzMzIuNTE5IDQxNy4yMjg0LDMzMi41MTkgNDE3LjIyODQsMzIyLjUxOSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODIuNzIxNyIgeD0iMzI0LjUwNjciIHk9IjM0OS41MTQxIj5EQiBTdGFuZGJ5PC90ZXh0PjwvZz48IS0tZW50aXR5IGhjLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImhjIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgZGF0YS11aWQ9ImVudDAwMTEiIGlkPSJlbnRpdHlfaGMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMzLjQ4ODMiIHg9IjM0Ni4xMjY3IiB5PSIxNjUuNzE5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjQ1OS42MTUiIHk9IjE3MC43MTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjQ1Ny42MTUiIHk9IjE3Mi43MTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjQ1Ny42MTUiIHk9IjE3Ni43MTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5My40ODgzIiB4PSIzNjEuMTI2NyIgeT0iMTk4LjcxNDEiPkhlYWx0aCBDaGVjazwvdGV4dD48L2c+PCEtLWVudGl0eSBhc3NldHMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iYXNzZXRzIiBkYXRhLXNvdXJjZS1saW5lPSIxOCIgZGF0YS11aWQ9ImVudDAwMTMiIGlkPSJlbnRpdHlfYXNzZXRzIj48cGF0aCBkPSJNMzA3LjM0NjcsNDg5LjMwOSBMMzQ4LjM0NjcsNDg5LjMwOSBBMy43NSwzLjc1IDAgMCAxIDM1MC44NDY3LDQ5MS44MDkgTDM1Ny44NDY3LDUxMC4zMDkgTDQyMi4zODk3LDUxMC4zMDkgQTIuNSwyLjUgMCAwIDEgNDI0Ljg4OTcsNTEyLjgwOSBMNDI0Ljg4OTcsNTQxLjEwNTkgQTIuNSwyLjUgMCAwIDEgNDIyLjM4OTcsNTQzLjYwNTkgTDMwNy4zNDY3LDU0My42MDU5IEEyLjUsMi41IDAgMCAxIDMwNC44NDY3LDU0MS4xMDU5IEwzMDQuODQ2Nyw0OTEuODA5IEEyLjUsMi41IDAgMCAxIDMwNy4zNDY3LDQ4OS4zMDkiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMwNC44NDY3IiB4Mj0iMzU3Ljg0NjciIHkxPSI1MTAuMzA5IiB5Mj0iNTEwLjMwOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkwLjA0MyIgeD0iMzE0Ljg0NjciIHk9IjUzMC4zMDQxIj5TdGF0aWMgQXNzZXRzPC90ZXh0PjwvZz48IS0tZW50aXR5IGJhY2t1cC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJiYWNrdXAiIGRhdGEtc291cmNlLWxpbmU9IjE5IiBkYXRhLXVpZD0iZW50MDAxNCIgaWQ9ImVudGl0eV9iYWNrdXAiPjxwYXRoIGQ9Ik00NjIuNTU2Nyw0ODkuMzA5IEw1MDMuNTU2Nyw0ODkuMzA5IEEzLjc1LDMuNzUgMCAwIDEgNTA2LjA1NjcsNDkxLjgwOSBMNTEzLjA1NjcsNTEwLjMwOSBMNTc3LjE4MjcsNTEwLjMwOSBBMi41LDIuNSAwIDAgMSA1NzkuNjgyNyw1MTIuODA5IEw1NzkuNjgyNyw1NDEuMTA1OSBBMi41LDIuNSAwIDAgMSA1NzcuMTgyNyw1NDMuNjA1OSBMNDYyLjU1NjcsNTQzLjYwNTkgQTIuNSwyLjUgMCAwIDEgNDYwLjA1NjcsNTQxLjEwNTkgTDQ2MC4wNTY3LDQ5MS44MDkgQTIuNSwyLjUgMCAwIDEgNDYyLjU1NjcsNDg5LjMwOSIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDYwLjA1NjciIHgyPSI1MTMuMDU2NyIgeTE9IjUxMC4zMDkiIHkyPSI1MTAuMzA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODkuNjI2IiB4PSI0NzAuMDU2NyIgeT0iNTMwLjMwNDEiPkJhY2t1cCBEYXRhPC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR01OMjIiIGRhdGEtc291cmNlLWxpbmU9IjMyIiBkYXRhLXVpZD0iZW50MDAyMyIgaWQ9ImVudGl0eV9HTU4yMiI+PHBhdGggZD0iTTY5NS4zNjY3LDE2OC43MzkgTDY5NS4zNjY3LDIwOS4wMDQ2IEw4MjAuMzY2OSwyMDkuMDA0NiBMODIwLjM2NjksMTc4LjczOSBMODEwLjM2NjksMTY4LjczOSBMNjk1LjM2NjcsMTY4LjczOSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTgxMC4zNjY5LDE2OC43MzkgTDgxMC4zNjY5LDE3OC43MzkgTDgyMC4zNjY5LDE3OC43MzkgTDgxMC4zNjY5LDE2OC43MzkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iNzAxLjM2NjciIHk9IjE4NS44MDU5Ij4mIzEyNDg4OyYjMTI1MjE7JiMxMjUwMTsmIzEyNDUxOyYjMTI0ODM7JiMxMjQ2MzsmIzIwOTk4OyYjMjU5NTU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjcwMS4zNjY3IiB5PSIyMDAuOTM4NyI+JiMxMjUwNDsmIzEyNTIzOyYjMTI0NzM7JiMxMjQ4MTsmIzEyNDU1OyYjMTI0ODM7JiMxMjQ2Mzs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJHTU4yNSIgZGF0YS1zb3VyY2UtbGluZT0iMzMiIGRhdGEtdWlkPSJlbnQwMDI2IiBpZD0iZW50aXR5X0dNTjI1Ij48cGF0aCBkPSJNNjk1LjM2NjcsMzE1LjAyOSBMNjk1LjM2NjcsMzU1LjI5NDYgTDg0Ni4zNjY5LDM1NS4yOTQ2IEw4NDYuMzY2OSwzMjUuMDI5IEw4MzYuMzY2OSwzMTUuMDI5IEw2OTUuMzY2NywzMTUuMDI5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNODM2LjM2NjksMzE1LjAyOSBMODM2LjM2NjksMzI1LjAyOSBMODQ2LjM2NjksMzI1LjAyOSBMODM2LjM2NjksMzE1LjAyOSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC4wMDAyIiB4PSI3MDEuMzY2NyIgeT0iMzMyLjA5NTkiPiYjMzMyNTg7JiMyMTIwNTsmIzEyNTAxOyYjMTI0NTU7JiMxMjQ1MjsmIzEyNTIzOyYjMTI0NTg7JiMxMjU0MDsmIzEyNDk2OyYjMTI1NDA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY0LjQwOTciIHg9IjcwMS4zNjY3IiB5PSIzNDcuMjI4NyI+KE11bHRpLUFaKTwvdGV4dD48L2c+PCEtLWxpbmsgYWxiIHRvIHdlYjEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iYWxiIiBkYXRhLWVudGl0eS0yPSJ3ZWIxIiBkYXRhLXNvdXJjZS1saW5lPSIyNCIgZGF0YS11aWQ9ImxuazE1IiBpZD0ibGlua19hbGJfd2ViMSI+PHBhdGggZD0iTTUwOC45NzQ0LDIzNi4wMjY2IEM1MDguODY4NSwyMzYuMjI2IDUwOC43NjE2LDIzNi40MjQ5IDUwOC42NTM3LDIzNi42MjMyIEM1MDguNDM3OCwyMzcuMDE5OCA1MDguMjE3OCwyMzcuNDE0IDUwNy45OTM2LDIzNy44MDU1IEM1MDcuNTQ1MSwyMzguNTg4NiA1MDcuMDc5NiwyMzkuMzYxIDUwNi41OTY2LDI0MC4xMjEgQzUwNS42MzA2LDI0MS42NDA5IDUwNC41OTQzLDI0My4xMTA1IDUwMy40ODI2LDI0NC41MTQyIEM1MDEuMjU5MiwyNDcuMzIxNyA0OTguNzM0MiwyNDkuODY1MiA0OTUuODY2NywyNTIuMDE5IEM0NjAuNzM2NywyNzguMzk5IDM0MS4yMjY3LDI1Ny4zMjkgMjk4Ljg2NjcsMjY5LjAxOSBDMjY0LjMyNjcsMjc4LjU0OSAyMzMuMTcsMjkzLjg4NjUgMjA3LjA0LDMwOC42NTY1IiBmaWxsPSJub25lIiBpZD0iYWxiLXRvLXdlYjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIwMS44MTY3LDMxMS42MDksMjExLjYyLDMxMC42NjI1LDIwNi4xNjk1LDMwOS4xNDg2LDIwNy42ODM0LDMwMy42OTgxLDIwMS44MTY3LDMxMS42MDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgYWxiIHRvIHdlYjItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iYWxiIiBkYXRhLWVudGl0eS0yPSJ3ZWIyIiBkYXRhLXNvdXJjZS1saW5lPSIyNSIgZGF0YS11aWQ9ImxuazE2IiBpZD0ibGlua19hbGJfd2ViMiI+PHBhdGggZD0iTTUxOS44NjY3LDIzNi41MzMgQzUxOS44NjY3LDIzNi43MjggNTE5Ljg2NjcsMjM2LjkyMzQgNTE5Ljg2NjcsMjM3LjExOSBDNTE5Ljg2NjcsMjYyLjE1OSA1MTkuODY2NywyODUuNzU5IDUxOS44NjY3LDMwNS42MjkiIGZpbGw9Im5vbmUiIGlkPSJhbGItdG8td2ViMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTE5Ljg2NjcsMzExLjYyOSw1MjMuODY2NywzMDIuNjI5LDUxOS44NjY3LDMwNi42MjksNTE1Ljg2NjcsMzAyLjYyOSw1MTkuODY2NywzMTEuNjI5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIHdlYjEgdG8gZGIxLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IndlYjEiIGRhdGEtZW50aXR5LTI9ImRiMSIgZGF0YS1zb3VyY2UtbGluZT0iMjYiIGRhdGEtdWlkPSJsbmsxNyIgaWQ9Imxpbmtfd2ViMV9kYjEiPjxwYXRoIGQ9Ik0xNjcuMTA2NywzNTguNTA5IEMxNzAuNTc2NywzOTMuMDU5IDE3Ni41OTc2LDQ1My4wNDkgMTgwLjA0NzYsNDg3LjQyOSIgZmlsbD0ibm9uZSIgaWQ9IndlYjEtdG8tZGIxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxODAuNjQ2Nyw0OTMuMzk5LDE4My43MjgxLDQ4NC4wNDQ2LDE4MC4xNDc1LDQ4OC40MjQsMTc1Ljc2ODEsNDg0Ljg0MzQsMTgwLjY0NjcsNDkzLjM5OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayB3ZWIyIHRvIGRiMS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJ3ZWIyIiBkYXRhLWVudGl0eS0yPSJkYjEiIGRhdGEtc291cmNlLWxpbmU9IjI3IiBkYXRhLXVpZD0ibG5rMTgiIGlkPSJsaW5rX3dlYjJfZGIxIj48cGF0aCBkPSJNNDk3LjEyNjcsMzU4LjcwOSBDNDc0LjcyNjcsMzc5LjMxOSA0MzguNDk2Nyw0MDguNjE5IDQwMC44NjY3LDQyMi4zMDkgQzM1My45NjY3LDQzOS4zNzkgMzM1LjMxNjcsNDEyLjA3OSAyODguODY2Nyw0MzAuMzA5IEMyNTQuMTQ2Nyw0NDMuOTM5IDIyNi4wNjM2LDQ2OC44NTIzIDIwNi40NzM2LDQ4OS4yNDIzIiBmaWxsPSJub25lIiBpZD0id2ViMi10by1kYjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIwMi4zMTY3LDQ5My41NjksMjExLjQzNjUsNDg5Ljg1MDMsMjA1Ljc4MDgsNDg5Ljk2MzQsMjA1LjY2NzcsNDg0LjMwNzcsMjAyLjMxNjcsNDkzLjU2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBkYjEgdG8gZGIyLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImRiMSIgZGF0YS1lbnRpdHktMj0iZGIyIiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgZGF0YS11aWQ9ImxuazE5IiBpZD0ibGlua19kYjFfZGIyIj48cGF0aCBkPSJNMjA1LjIwNjcsNDkzLjU3OSBDMjQwLjM1NjcsNDU5LjEyOSAzMDMuOTIxMSwzOTYuODU4MiAzMzkuMTQxMSwzNjIuMzQ4MiIgZmlsbD0ibm9uZSIgaWQ9ImRiMS10by1kYjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM0My40MjY3LDM1OC4xNDksMzM0LjE5ODgsMzYxLjU5MDgsMzM5Ljg1NTQsMzYxLjY0ODQsMzM5Ljc5NzgsMzY3LjMwNDksMzQzLjQyNjcsMzU4LjE0OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0LjA3NDciIHg9IjMwNy42NzY3IiB5PSI0MDMuMzc1OSI+U3luY2hyb25vdXM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzIuNTIyIiB4PSIzMTMuNDUzMSIgeT0iNDE4LjUwODciPlJlcGxpY2F0aW9uPC90ZXh0PjwvZz48IS0tbGluayB3ZWIxIHRvIHMzLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IndlYjEiIGRhdGEtZW50aXR5LTI9InMzIiBkYXRhLXNvdXJjZS1saW5lPSIyOSIgZGF0YS11aWQ9ImxuazIwIiBpZD0ibGlua193ZWIxX3MzIj48cGF0aCBkPSJNMjIwLjA0NjcsMzU4LjY5OSBDMjQzLjg5NjcsMzY3LjUwOSAyNzIuMzY2NywzNzYuNzk5IDI5OC44NjY3LDM4Mi4zMDkgQzM0My4zODY3LDM5MS41NjkgMzU1LjgzNjcsMzgzLjk0OSA0MDAuODY2NywzOTAuMzA5IEM0MDMuNjA2NywzOTAuNjk5IDU5My44OTY3LDQyOC4zNzkgNTk1Ljg2NjcsNDMwLjMwOSBDNTk5LjIxNTUsNDMzLjYwMDIgNjAyLjAzMTksNDM3LjM0MzEgNjA0LjM5NTgsNDQxLjM3OTggQzYwNC45ODY3LDQ0Mi4zODkgNjA1LjU0OTQsNDQzLjQxNjUgNjA2LjA4NTEsNDQ0LjQ2IEM2MDYuMzUyOSw0NDQuOTgxNyA2MDQuMDE0Niw0NDAuMDk5NyA2MDQuMjY5LDQ0MC42MjkxIiBmaWxsPSJub25lIiBpZD0id2ViMS10by1zMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjA2Ljg2ODQsNDQ2LjAzNjgsNjA2LjU3NDUsNDM2LjE5MjMsNjA0LjcwMjMsNDQxLjUzMDQsNTk5LjM2NDIsNDM5LjY1ODIsNjA2Ljg2ODQsNDQ2LjAzNjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgd2ViMiB0byBzMy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJ3ZWIyIiBkYXRhLWVudGl0eS0yPSJzMyIgZGF0YS1zb3VyY2UtbGluZT0iMzAiIGRhdGEtdWlkPSJsbmsyMSIgaWQ9Imxpbmtfd2ViMl9zMyI+PHBhdGggZD0iTTU0Mi44NzY3LDM1OC40MzkgQzU2MC4wMDY3LDM3Ni4zMTkgNTgyLjYzNjcsNDAyLjg3OSA1OTUuODY2Nyw0MzAuMzA5IEM1OTcuOTA2Nyw0MzQuNTM5IDU5OS43MzEzLDQzOC45OTMyIDYwMS4zNjI2LDQ0My41NTUzIEM2MDEuNTY2NSw0NDQuMTI1NiA2MDEuNzY3NCw0NDQuNjk3NSA2MDEuOTY1Myw0NDUuMjcwOSBDNjAyLjA2NDMsNDQ1LjU1NzcgNjAwLjIzNTMsNDQwLjE2MjYgNjAwLjMzMjgsNDQwLjQ1MDEiIGZpbGw9Im5vbmUiIGlkPSJ3ZWIyLXRvLXMzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2MDIuMjYsNDQ2LjEzMjEsNjAzLjE1NzMsNDM2LjMyNDIsNjAwLjY1NCw0NDEuMzk3MSw1OTUuNTgxMiw0MzguODkzOCw2MDIuMjYsNDQ2LjEzMjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgYWxiIHRvIEdNTjIyLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImFsYiIgZGF0YS1lbnRpdHktMj0iR01OMjIiIGRhdGEtc291cmNlLWxpbmU9IjMyIiBkYXRhLXVpZD0ibG5rMjQiIGlkPSJsaW5rX2FsYl9HTU4yMiI+PHBhdGggZD0iTTUzMy45OTMsMTg4Ljg2OSBDNTM0LjkwNCwxODguODY5IDUzNS44MTUxLDE4OC44NjkgNTM2LjcyNjIsMTg4Ljg2OSBDNTM4LjU0ODMsMTg4Ljg2OSA1NDAuMzcwNCwxODguODY5IDU0Mi4xOTI1LDE4OC44NjkgQzU0OS40ODEsMTg4Ljg2OSA1NTYuNzY5MywxODguODY5IDU2NC4wNTc1LDE4OC44NjkgQzU3OC42MzM5LDE4OC44NjkgNTkzLjIwOTksMTg4Ljg2OSA2MDcuNzg1NSwxODguODY5IEM2MzYuOTM2NywxODguODY5IDY2Ni4wODY3LDE4OC44NjkgNjk1LjIzNjcsMTg4Ljg2OSIgZmlsbD0ibm9uZSIgaWQ9ImFsYi1HTU4yMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjwvZz48IS0tbGluayBkYjIgdG8gR01OMjUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZGIyIiBkYXRhLWVudGl0eS0yPSJHTU4yNSIgZGF0YS1zb3VyY2UtbGluZT0iMzMiIGRhdGEtdWlkPSJsbmsyNyIgaWQ9ImxpbmtfZGIyX0dNTjI1Ij48cGF0aCBkPSJNMzgxLjk0NjcsMzEyLjMxOSBDMzk3LjMzNjcsMjkyLjk4OSA0MjIuNTk2NywyNjcuMzU5IDQ1Mi4zNjY3LDI2MC41MTkgQzQ4MS4zODY3LDI1My44MzkgNTU3LjEzNjcsMjU0LjgyOSA1ODYuMzY2NywyNjAuNTE5IEM2MzkuMjc2NywyNzAuODA5IDY5Ni4yMTY3LDI5Ni4yNzkgNzMyLjYyNjcsMzE0LjYwOSIgZmlsbD0ibm9uZSIgaWQ9ImRiMi1HTU4yNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjwvZz48IS0tU1JDPVtYUDJuUVhtbjQ4UnhWT2ZYZ3dKT3VsUXdBbTl0VGs0WVdVMGozRVFRTVFyeUFxd001YWRoUzBhZmllQjRhMlJER05lN0o5bVlqSTVsOG5wbzYxYmZ1eENUMzZQWHFVWl92X3o2bXdKazZ5WmRIbk5pbk1DRXhwQjNjS0VyYVhwb0d4dUlNaXEwa3E5ZnVyZ0VyWE1KN0QyMklUOTMtX21DWFNIUUlFNHNTQW1MWG1hY0N4d1RhNUZmWGFuN2w4UUFjcERrTzRud20tajlyZzMzNll0Zi1tanVSU0dmY2FySTZuQlZQcXpHczN6QS1IWWJsQU1LM29hTDFKUnJCUU1DNUFQRkVtZktaWVhUOW1MMzVuX3ZLY0MzMnZJZTYzU1pJalE0a2NTX3UyWFQydGlqUC1sYVE1YUNqNHVSTjE2bGNpQVlQc2xrYWNZZHI3c1lQS0ZadkpJNzRtcGNyZDlkbl9IcXQxYU1vRFB6MV9pcVY5QmhMNUR5X0I4dUliNnk2RFR1aG9ZcFU5RWdrQ0R1aW9rUWRMMzIzQWdET2d0SElsVHNnR3h2eGpydDBOUHdycXpkc2g3Wk9DSWdUUTFGcVo5YzRGbnZ5RC0zdHVSWDhkV1ZYZnl0dm56X1JvLU1BbFlsbVZ5OG10Tm03eTltRU9oX1BPb0pfRmJxVFZEdmNwOGttXzBqVExxNV9vbHVCX0hWZ2NVbFVrYjRDSnotX1hTMF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="102">10.2 バックアップ戦略<a class="headerlink" href="#102" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># modules/backup/automated-backup/main.tf</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_backup_vault&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-backup-vault&quot;</span>
<span class="w">  </span><span class="na">kms_key_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_kms_key.backup.arn</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_kms_key&quot;</span><span class="w"> </span><span class="nv">&quot;backup&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KMS key for backup vault encryption&quot;</span>
<span class="w">  </span><span class="na">deletion_window_in_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-backup-kms&quot;</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_backup_plan&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-backup-plan&quot;</span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">rule_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;daily_backup&quot;</span>
<span class="w">    </span><span class="na">target_vault_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_backup_vault.main.name</span>
<span class="w">    </span><span class="na">schedule</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cron(0 2 ? * * *)&quot;</span><span class="c1">  # 毎日午前2時</span>

<span class="w">    </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">cold_storage_after</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
<span class="w">      </span><span class="na">delete_after</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">120</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">recovery_point_tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">BackupType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Daily&quot;</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">rule_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;weekly_backup&quot;</span>
<span class="w">    </span><span class="na">target_vault_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_backup_vault.main.name</span>
<span class="w">    </span><span class="na">schedule</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cron(0 2 ? * SUN *)&quot;</span><span class="c1">  # 毎週日曜日午前2時</span>

<span class="w">    </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">cold_storage_after</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
<span class="w">      </span><span class="na">delete_after</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">365</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">recovery_point_tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="nv">var.tags</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">BackupType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Weekly&quot;</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_backup_selection&quot;</span><span class="w"> </span><span class="nv">&quot;database&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">iam_role_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.backup.arn</span>
<span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.name_prefix}-db-backup-selection&quot;</span>
<span class="w">  </span><span class="na">plan_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_backup_plan.main.id</span>

<span class="w">  </span><span class="na">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="nv">var.rds_db_instance_arn</span>
<span class="w">  </span><span class="p">]</span>

<span class="w">  </span><span class="nb">condition</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">string_equals</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">key</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;aws:ResourceTag/Environment&quot;</span>
<span class="w">      </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="11_1">11. まとめ<a class="headerlink" href="#11_1" title="Permanent link">&para;</a></h2>
<h3 id="111">11.1 ベストプラクティス チェックリスト<a class="headerlink" href="#111" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">インフラコード品質</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">すべてのリソースがコードで定義されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">バージョン管理されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">適切なコメントとドキュメントがある</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">命名規則に従っている</span>

<span class="nt">モジュール設計</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">単一責任の原則に従っている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">再利用可能な設計になっている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">入力検証が実装されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">適切な出力値が定義されている</span>

<span class="nt">セキュリティ</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">シークレット管理が適切に実装されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IAM権限が最小権限になっている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">セキュリティグループが適切に設定されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">暗号化が有効になっている</span>

<span class="nt">運用</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">監視・アラートが設定されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ログ収集が実装されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">バックアップ戦略が定義されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">災害対策が考慮されている</span>

<span class="nt">テスト</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">単体テストが実装されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">統合テストが実装されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">セキュリティテストが実装されている</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CI/CDパイプラインが構築されている</span>
</code></pre></div>
<h3 id="112">11.2 継続的改善<a class="headerlink" href="#112" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9Ijk1MnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MjY2cHg7aGVpZ2h0Ojk1MnB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI2NiA5NTIiIHdpZHRoPSIyNjZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1lbnRpdHkgcGxhbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJwbGFuIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImVudGl0eV9wbGFuIj48ZWxsaXBzZSBjeD0iOTUuMjk3MyIgY3k9IjE0IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI5Ljc4NDIiIHg9IjgwLjQwNTIiIHk9IjQzLjk5NTEiPlBsYW48L3RleHQ+PC9nPjwhLS1lbnRpdHkgY29kZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJjb2RlIiBkYXRhLXNvdXJjZS1saW5lPSIyIiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV9jb2RlIj48ZWxsaXBzZSBjeD0iMjUuMjk3MyIgY3k9IjE2NCIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNS44NDA4IiB4PSI3LjM3NjkiIHk9IjE5My45OTUxIj5Db2RlPC90ZXh0PjwvZz48IS0tZW50aXR5IGJ1aWxkLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImJ1aWxkIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBkYXRhLXVpZD0iZW50MDAwNCIgaWQ9ImVudGl0eV9idWlsZCI+PGVsbGlwc2UgY3g9IjU0LjI5NzMiIGN5PSIzMTQiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzUuMTQzNiIgeD0iMzYuNzI1NSIgeT0iMzQzLjk5NTEiPkJ1aWxkPC90ZXh0PjwvZz48IS0tZW50aXR5IHRlc3QtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0idGVzdCIgZGF0YS1zb3VyY2UtbGluZT0iNCIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfdGVzdCI+PGVsbGlwc2UgY3g9IjYxLjI5NzMiIGN5PSI0NjQiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjkuOTQ4MiIgeD0iNDYuMzIzMiIgeT0iNDkzLjk5NTEiPlRlc3Q8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZGVwbG95LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImRlcGxveSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgZGF0YS11aWQ9ImVudDAwMDYiIGlkPSJlbnRpdHlfZGVwbG95Ij48ZWxsaXBzZSBjeD0iNjQuMjk3MyIgY3k9IjYxNCIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OS4wMjA1IiB4PSIzOS43ODcxIiB5PSI2NDMuOTk1MSI+RGVwbG95PC90ZXh0PjwvZz48IS0tZW50aXR5IG1vbml0b3ItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0ibW9uaXRvciIgZGF0YS1zb3VyY2UtbGluZT0iNiIgZGF0YS11aWQ9ImVudDAwMDciIGlkPSJlbnRpdHlfbW9uaXRvciI+PGVsbGlwc2UgY3g9IjczLjI5NzMiIGN5PSI3NjQiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTMuMjE3OCIgeD0iNDYuNjg4NCIgeT0iNzkzLjk5NTEiPk1vbml0b3I8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbGVhcm4tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0ibGVhcm4iIGRhdGEtc291cmNlLWxpbmU9IjciIGRhdGEtdWlkPSJlbnQwMDA4IiBpZD0iZW50aXR5X2xlYXJuIj48ZWxsaXBzZSBjeD0iMTIwLjI5NzMiIGN5PSI5MTQiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzkuNjIxMSIgeD0iMTAwLjQ4NjgiIHk9Ijk0My45OTUxIj5MZWFybjwvdGV4dD48L2c+PCEtLWxpbmsgcGxhbiB0byBjb2RlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9InBsYW4iIGRhdGEtZW50aXR5LTI9ImNvZGUiIGRhdGEtc291cmNlLWxpbmU9IjkiIGRhdGEtdWlkPSJsbms5IiBpZD0ibGlua19wbGFuX2NvZGUiPjxwYXRoIGNvZGVMaW5lPSI5IiBkPSJNODYuMzA3MywxOC43OCBDNjkuNzc3MywyNi4yOSAzNS4wMTczLDQ0LjgyIDIxLjI5NzMsNzMgQzcuODc3MywxMDAuNTYgMTUuNTQ4NCwxMzIuOTU5MiAyMC43MTg0LDE0OS4zMDkyIiBmaWxsPSJub25lIiBpZD0icGxhbi10by1jb2RlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMi41MjczLDE1NS4wMywyMy42Mjc3LDE0NS4yNDI4LDIxLjAxOTgsMTUwLjI2MjcsMTYsMTQ3LjY1NDgsMjIuNTI3MywxNTUuMDMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSI1NC43OTc0IiB5PSI4Ni4wNjY5Ij4mIzM1MjAxOyYjMjAyMTQ7JiMyMzQ1MDsmIzMyNjgxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuMDAwMSIgeD0iMjIuMjk3MyIgeT0iMTAxLjE5OTciPiYjMTI0NTA7JiMxMjU0MDsmIzEyNDYxOyYjMTI0ODY7JiMxMjQ2MzsmIzEyNDgxOyYjMTI1MTU7JiMzNTM3MzsmIzM1MzM2OzwvdGV4dD48L2c+PCEtLWxpbmsgY29kZSB0byBidWlsZC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJjb2RlIiBkYXRhLWVudGl0eS0yPSJidWlsZCIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGRhdGEtdWlkPSJsbmsxMCIgaWQ9ImxpbmtfY29kZV9idWlsZCI+PHBhdGggY29kZUxpbmU9IjEwIiBkPSJNMjYuODU3MywxNzIuOTYgQzMxLjg4NzMsMTk4LjY1IDQ2LjUzNDgsMjczLjM2MTcgNTEuNTc0OCwyOTkuMTExNyIgZmlsbD0ibm9uZSIgaWQ9ImNvZGUtdG8tYnVpbGQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUyLjcyNzMsMzA1LDU0LjkyNDEsMjk1LjM5OTMsNTEuNzY2OSwzMDAuMDkzMSw0Ny4wNzMxLDI5Ni45MzU5LDUyLjcyNzMsMzA1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMTMzMyIgeD0iNDMuMzk3MyIgeT0iMjM2LjA2NjkiPlRlcnJhZm9ybTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSI0My40NjM5IiB5PSIyNTEuMTk5NyI+JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7JiMyMDMxNjsmIzI1MTA0OzwvdGV4dD48L2c+PCEtLWxpbmsgYnVpbGQgdG8gdGVzdC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJidWlsZCIgZGF0YS1lbnRpdHktMj0idGVzdCIgZGF0YS1zb3VyY2UtbGluZT0iMTEiIGRhdGEtdWlkPSJsbmsxMSIgaWQ9ImxpbmtfYnVpbGRfdGVzdCI+PHBhdGggY29kZUxpbmU9IjExIiBkPSJNNTQuNjc3MywzMjIuOTYgQzU1Ljg4NzMsMzQ4LjY1IDU5LjQxMzQsNDIzLjI1NjcgNjAuNjMzNCw0NDkuMDA2NyIgZmlsbD0ibm9uZSIgaWQ9ImJ1aWxkLXRvLXRlc3QiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYwLjkxNzMsNDU1LDY0LjQ4NjksNDQ1LjgyMDgsNjAuNjgwNyw0NTAuMDA1Niw1Ni40OTU5LDQ0Ni4xOTk0LDYwLjkxNzMsNDU1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iNjUuOTI3MyIgeT0iMzg2LjA2NjkiPiYjMzg3NDU7JiMzMDM0MDsmIzM1Mjk5OyYjMjY1MTI7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjU5LjQyNzMiIHk9IjQwMS4xOTk3Ij4mIzIxMzM2OyYjMjAzMDc7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7PC90ZXh0PjwvZz48IS0tbGluayB0ZXN0IHRvIGRlcGxveS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJ0ZXN0IiBkYXRhLWVudGl0eS0yPSJkZXBsb3kiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBkYXRhLXVpZD0ibG5rMTIiIGlkPSJsaW5rX3Rlc3RfZGVwbG95Ij48cGF0aCBjb2RlTGluZT0iMTIiIGQ9Ik02MC45NjczLDQ3Mi45NSBDNjAuMzY3Myw0ODguNjQgNTkuMjU3Myw1MjQuNyA2MC4yOTczLDU1NSBDNjAuOTE3Myw1NzIuOTYgNjIuMDg3Myw1ODguMDAyNiA2My4wNTczLDU5OS4xNTI2IiBmaWxsPSJub25lIiBpZD0idGVzdC10by1kZXBsb3kiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYzLjU3NzMsNjA1LjEzLDY2Ljc4MjMsNTk1LjgxNzIsNjMuMTQ0LDYwMC4xNDg4LDU4LjgxMjQsNTk2LjUxMDUsNjMuNTc3Myw2MDUuMTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSI2Ny43OTczIiB5PSI1MzYuMDY2OSI+JiMzMjExMzsmIzIxNTEyOyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC4wMDAxIiB4PSI2MS4yOTczIiB5PSI1NTEuMTk5NyI+JiMyNjQxMjsmIzMwMDU4OyYjMTI0ODc7JiMxMjUwMzsmIzEyNTI1OyYjMTI0NTI7PC90ZXh0PjwvZz48IS0tbGluayBkZXBsb3kgdG8gbW9uaXRvci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJkZXBsb3kiIGRhdGEtZW50aXR5LTI9Im1vbml0b3IiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBkYXRhLXVpZD0ibG5rMTMiIGlkPSJsaW5rX2RlcGxveV9tb25pdG9yIj48cGF0aCBjb2RlTGluZT0iMTMiIGQ9Ik02NC43NzczLDYyMi45NiBDNjYuMzQ3Myw2NDguNjUgNzAuODg0NSw3MjMuMjYxIDcyLjQ0NDUsNzQ5LjAxMSIgZmlsbD0ibm9uZSIgaWQ9ImRlcGxveS10by1tb25pdG9yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3Mi44MDczLDc1NSw3Ni4yNTU4LDc0NS43NzQ2LDcyLjUwNSw3NTAuMDA5Miw2OC4yNzA0LDc0Ni4yNTg0LDcyLjgwNzMsNzU1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYiIHg9IjgzLjYwNzMiIHk9IjY4Ni4wNjY5Ij4mIzMwNDM1OyYjMzUyMjI7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjcwLjYwNzMiIHk9IjcwMS4xOTk3Ij4mIzEyNTI1OyYjMTI0NjQ7JiMyMTQ1NDsmIzM4NTk4OzwvdGV4dD48L2c+PCEtLWxpbmsgbW9uaXRvciB0byBsZWFybi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJtb25pdG9yIiBkYXRhLWVudGl0eS0yPSJsZWFybiIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGRhdGEtdWlkPSJsbmsxNCIgaWQ9ImxpbmtfbW9uaXRvcl9sZWFybiI+PHBhdGggY29kZUxpbmU9IjE0IiBkPSJNNzEuNjA3Myw3NzIuNzYgQzY4LjUwNzMsNzg4LjcxIDYzLjA2NzMsODI2LjEzIDczLjI5NzMsODU1IEM4MC45MTczLDg3Ni41IDk1Ljc3NTQsODkxLjg4MzYgMTA3LjEyNTQsOTAxLjg4MzYiIGZpbGw9Im5vbmUiIGlkPSJtb25pdG9yLXRvLWxlYXJuIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMTEuNjI3Myw5MDUuODUsMTA3LjUxODcsODk2Ljg5OSwxMDcuODc1Nyw5MDIuNTQ0NiwxMDIuMjMwMSw5MDIuOTAxNiwxMTEuNjI3Myw5MDUuODUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNiIgeD0iOTMuNzk3MyIgeT0iODM2LjA2NjkiPiYjMjA5OTg7JiMyNjUxMjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMDAwMSIgeD0iNzQuMjk3MyIgeT0iODUxLjE5OTciPiYjMjU5MTM7JiMyMTg5MjsmIzI4ODU3OyYjMjUyNzc7JiMyMDk4Njs8L3RleHQ+PC9nPjwhLS1saW5rIGxlYXJuIHRvIHBsYW4tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0ibGVhcm4iIGRhdGEtZW50aXR5LTI9InBsYW4iIGRhdGEtc291cmNlLWxpbmU9IjE1IiBkYXRhLXVpZD0ibG5rMTUiIGlkPSJsaW5rX2xlYXJuX3BsYW4iPjxwYXRoIGNvZGVMaW5lPSIxNSIgZD0iTTEyNC41NDczLDkwNS4yNCBDMTM1LjkyNzMsODgzLjY5IDE2Ni4yOTczLDgyMC45NyAxNjYuMjk3Myw3NjUgQzE2Ni4yOTczLDE2MyAxNjYuMjk3MywxNjMgMTY2LjI5NzMsMTYzIEMxNjYuMjk3MywxMjEuODIgMTYyLjk2NzMsMTA5LjcgMTQ0LjI5NzMsNzMgQzEzMy44OTczLDUyLjU2IDExOS4zNzI2LDM3LjIxNTggMTA4LjMzMjYsMjYuODU1OCIgZmlsbD0ibm9uZSIgaWQ9ImxlYXJuLXRvLXBsYW4iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwMy45NTczLDIyLjc1LDEwNy43ODMsMzEuODI1NSwxMDcuNjAzNCwyNi4xNzE1LDExMy4yNTc0LDI1Ljk5MTgsMTAzLjk1NzMsMjIuNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MS4wMDAxIiB4PSIxNjcuMjk3MyIgeT0iNDYxLjA2NjkiPiYjMTI1MDE7JiMxMjQ1MTsmIzEyNTQwOyYjMTI0ODk7JiMxMjQ5NjsmIzEyNDgzOyYjMTI0NjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjE4Ni43OTczIiB5PSI0NzYuMTk5NyI+JiMyNzQyNTsmIzI2Mzk5OyYjMzUzMzY7JiMzMDAxMTs8L3RleHQ+PC9nPjwhLS1TUkM9W0ZQM0RKaTlHNDhOdHpvYmtzRkMyQjVvZUlxclNpNkhKSXFyOElhaUFCYnBJSXcyUWc0cTRMNDJEclkwT3kyVDY0cUh5Y1U2c3ZJc3lDeU5rSml2eTl0RGN6OUFaY21SRng5Y1FiVTVRYkxVS09GaFF0UkFCMWhjdzRnY3hVTFdvWXNKbGVxaHpsNTZqYUxySjhkTXRaT2ZmN3Y1Vjk5YkVUY3NoTEJDVDZmS0pkU3ZzM0NyOTJmY2U2Q0RVRjlsVGUyZXluLURYVkpkX2FZLXp3N1RTaUMxejBGNDN4WEg0NHpuTjQ3S0dHSm9RbllFRktHMkpyNVA1eXVSWlEwVXNLeVJTMS1SNHlOOG4yM3NWOUdaMlU4RFlMcFZOS1F5SEZtTlhoTC1tdkVkTFNkNTFFc09XRjRPR3FpYmJZZXktdHdObGZLSjEyV1VKZ0ZDQ2VXTlk0aUdLdDRVc1haNnRGWGszX0kwVVRiS1pQRHhhLVRjZ3RzSl9PcUpmM21nS05mRXdYRXNQeDNPWVRuUVVCNkpoY29McDlFYkxFR3dZMHN3R2QwVjIxbzdLUHJIa1NYeUV4akhaZWxSeTNtMDBdLS0+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p>このインフラ設計ガイドに従うことで、会議室予約システムの安全で効率的なインフラストラクチャを構築・運用できます。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works" target="_blank" rel="noopener" title="GitHub Repository/claude-code-booster" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>