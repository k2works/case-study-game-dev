
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Site Description">
      
      
        <meta name="author" content="Project Team">
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>テスト戦略ガイド - Site Name</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Site Name" class="md-header__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Site Name
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              テスト戦略ガイド
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Site Name" class="md-nav__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Site Name
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="_1">テスト戦略ガイド<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">概要<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>よいソフトウェアを作るためのテスト戦略について説明する。アーキテクチャパターンに応じた適切なテスト戦略を選択し、変更を楽に安全にできて役に立つソフトウェアの実現を目指す。</p>
<h2 id="_3">テスト戦略の基本原則<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">よいソフトウェアとテスト<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>変更を楽に安全にできて役に立つソフトウェアを作るため、テストは以下の価値を提供する：</p>
<ol>
<li><strong>安全な変更</strong>: 既存機能を破壊することなく新機能を追加</li>
<li><strong>設計の改善</strong>: テスタブルなコードは良い設計の指標</li>
<li><strong>ドキュメント</strong>: テストコードは実行可能な仕様書</li>
<li><strong>品質の保証</strong>: バグの早期発見と予防</li>
</ol>
<h3 id="tdd">テスト駆動開発（TDD）<a class="headerlink" href="#tdd" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNUQVRFIiBoZWlnaHQ9IjM5N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MjgzcHg7aGVpZ2h0OjM5N3B4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI4MyAzOTciIHdpZHRoPSIyODNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxlbGxpcHNlIGN4PSIxMzUiIGN5PSIxNiIgZmlsbD0iIzIyMjIyMiIgcng9IjEwIiByeT0iMTAiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZyBpZD0iUmVkIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUwLjI2NTYiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwLjAwMDkiIHg9IjY1IiB5PSI4NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjY1IiB4Mj0iMjA1LjAwMDkiIHkxPSIxMTMuMjk2OSIgeTI9IjExMy4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuMjI3NSIgeD0iMTIxLjM4NjciIHk9IjEwNC45OTUxIj5SZWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIwLjAwMDkiIHg9IjcwIiB5PSIxMjkuNDM1NSI+JiMyMjgzMzsmIzI1OTQzOyYjMTIzNzc7JiMxMjQyNzsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsmIzEyNDM0OyYjMjYzNjA7JiMxMjM2Nzs8L3RleHQ+PC9nPjxnIGlkPSJHcmVlbiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MC4yNjU2IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExNi4wMDA3IiB4PSI3IiB5PSIyMTQuMjciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI3IiB4Mj0iMTIzLjAwMDciIHkxPSIyNDAuNTY2OSIgeTI9IjI0MC41NjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIuNzA0MSIgeD0iNDMuNjQ4MyIgeT0iMjMyLjI2NTEiPkdyZWVuPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2LjAwMDciIHg9IjEyIiB5PSIyNTYuNzA1NSI+JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7JiMxMjM2NDsmIzM2ODkwOyYjMTI0Mjc7JiMyMzQ1NTsmIzM1MDEzOzwvdGV4dD48L2c+PGcgaWQ9IlJlZmFjdG9yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUwLjI2NTYiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUyLjAwMSIgeD0iNjYiIHk9IjM0MS41MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjY2IiB4Mj0iMjE4LjAwMSIgeTE9IjM2Ny44MjY5IiB5Mj0iMzY3LjgyNjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1OS4zNTY0IiB4PSIxMTIuMzIyMyIgeT0iMzU5LjUyNTEiPlJlZmFjdG9yPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMi4wMDEiIHg9IjcxIiB5PSIzODMuOTY1NSI+JiMzNzMyNTsmIzM1MDc5OyYjMTI0MzQ7JiMzODUwMDsmIzIxNDM1OyYjMTIzNzU7JiMzNTM3MzsmIzM1MzM2OyYjMTI0MzQ7JiMyNTkxMzsmIzIxODkyOzwvdGV4dD48L2c+PCEtLWxpbmsgKnN0YXJ0KiB0byBSZWQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLnN0YXJ0LiIgZGF0YS1lbnRpdHktMj0iUmVkIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0ibG5rNCIgaWQ9ImxpbmtfLnN0YXJ0Ll9SZWQiPjxwYXRoIGQ9Ik0xMzUsMjYuMzcgQzEzNSw0MC4zMiAxMzUsNjEuMDMgMTM1LDgwLjc1IiBmaWxsPSJub25lIiBpZD0iKnN0YXJ0Ki10by1SZWQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNSw4Ni43NSwxMzksNzcuNzUsMTM1LDgxLjc1LDEzMSw3Ny43NSwxMzUsODYuNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgUmVkIHRvIEdyZWVuLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlJlZCIgZGF0YS1lbnRpdHktMj0iR3JlZW4iIGRhdGEtc291cmNlLWxpbmU9IjIiIGRhdGEtdWlkPSJsbms2IiBpZD0ibGlua19SZWRfR3JlZW4iPjxwYXRoIGQ9Ik04Mi44OSwxMzcuNjIgQzcxLjcyLDE0NS40NSA2MS4zNywxNTUuMjcgNTUsMTY3LjI3IEM0Ny40LDE4MS41OSA0OC4zMTA2LDE5My45ODMgNTIuODAwNiwyMDguMzUzIiBmaWxsPSJub25lIiBpZD0iUmVkLXRvLUdyZWVuIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NC41OSwyMTQuMDgsNTUuNzIzOCwyMDQuMjk2Niw1My4wOTg4LDIwOS4zMDc1LDQ4LjA4NzksMjA2LjY4MjUsNTQuNTksMjE0LjA4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjU2IiB5PSIxODAuMzM2OSI+JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7JiMxMjQzNDsmIzM2ODkwOyYjMTIzNzc7JiMyNjM2ODsmIzIzNTY3OyYjMjM0NTU7JiMzNTAxMzs8L3RleHQ+PC9nPjwhLS1saW5rIEdyZWVuIHRvIFJlZmFjdG9yLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkdyZWVuIiBkYXRhLWVudGl0eS0yPSJSZWZhY3RvciIgZGF0YS1zb3VyY2UtbGluZT0iMyIgZGF0YS11aWQ9ImxuazgiIGlkPSJsaW5rX0dyZWVuX1JlZmFjdG9yIj48cGF0aCBkPSJNNjYuNzQsMjY0Ljg0IEM2OC42NCwyNzkuMjQgNzIuNjQsMjk3LjM2IDgxLDMxMS41MyBDODcuNjIsMzIyLjc1IDkyLjgxMjQsMzI4Ljk4NjEgMTAyLjU3MjQsMzM3LjM4NjEiIGZpbGw9Im5vbmUiIGlkPSJHcmVlbi10by1SZWZhY3RvciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTA3LjEyLDM0MS4zLDEwMi45MDc4LDMzMi4zOTczLDEwMy4zMzAzLDMzOC4wMzg0LDk3LjY4OTIsMzM4LjQ2MDgsMTA3LjEyLDM0MS4zIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjAwMDEiIHg9IjgyIiB5PSIzMDcuNTk2OSI+JiMxMjUyMjsmIzEyNTAxOyYjMTI0NDk7JiMxMjQ2MzsmIzEyNDc5OyYjMTI1MjI7JiMxMjUzMTsmIzEyNDY0OzwvdGV4dD48L2c+PCEtLWxpbmsgUmVmYWN0b3IgdG8gUmVkLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlJlZmFjdG9yIiBkYXRhLWVudGl0eS0yPSJSZWQiIGRhdGEtc291cmNlLWxpbmU9IjQiIGRhdGEtdWlkPSJsbms5IiBpZD0ibGlua19SZWZhY3Rvcl9SZWQiPjxwYXRoIGQ9Ik0xNzEuMTQsMzQxLjE2IEMxNzkuMTQsMzMyLjY5IDE4Ni43NiwzMjIuNTMgMTkxLDMxMS41MyBDMjE0LjA2LDI1MS43MSAyMTYuMDQsMjI2LjMgMTkxLDE2Ny4yNyBDMTg2LjIsMTU1Ljk0IDE4Mi4xMTI3LDE0OS45Mjc4IDE3My4xOTI3LDE0MS41ODc4IiBmaWxsPSJub25lIiBpZD0iUmVmYWN0b3ItdG8tUmVkIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjguODEsMTM3LjQ5LDE3Mi42NTIzLDE0Ni41NTg1LDE3Mi40NjIzLDE0MC45MDQ4LDE3OC4xMTU5LDE0MC43MTQ4LDE2OC44MSwxMzcuNDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSIyMTAuMDQiIHk9IjI0My45NjY5Ij4mIzI3NDI1OyYjMTIzOTg7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7PC90ZXh0PjwvZz48IS0tU1JDPVtZelFBTFQzTGpMQzhJYXRYMGM4bXN4cWVESkxGbUtoWFNORlJ1d1FUWnZpeDdaVERVamFtd3Q3WnA2VHA2ZnZrdzctd1Jsd0JuUXJTNDZLR3BNYzlvSU52SE0wemdudXRKdHRTakYxbnFfaDdKVmwxdENzRmNwUG1tVEwwUkdFZ1ZSUGN1VUY2VE4xUmsyMllKdlRpVjNQckVqMm9ucXRUbzJ2dURkbDd1eVAtQmFwN0RWUTA3RFZLM05LTWFjRFVqbFUtTUQ4RVNsdEM5S194VFp6a2RGdlluVGVOQXkyY0pUZHZUNWVCMDAwMF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h4 id="tdd-3">TDD の 3 つの法則<a class="headerlink" href="#tdd-3" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>失敗する単体テストを書くまでプロダクションコードを書かない</strong></li>
<li><strong>コンパイルが通らない、または失敗する範囲を超えて単体テストを書かない</strong></li>
<li><strong>現在失敗している単体テストを通す以上にプロダクションコードを書かない</strong></li>
</ol>
<h2 id="_5">テスト形態とアーキテクチャパターン<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>アーキテクチャパターンに応じて、最適なテスト形態を選択する。</p>
<h3 id="_6">ピラミッド形テスト<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjQ2MHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MjYwcHg7aGVpZ2h0OjQ2MHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI2MCA0NjAiIHdpZHRoPSIyNjBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIEUyRS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iRTJFIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfRTJFIj48cmVjdCBmaWxsPSIjNENBRjUwIiBoZWlnaHQ9IjEyMi40IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMjQwIiB4PSI3IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi4zMDc0IiB4PSI3MC44NDYzIiB5PSIyMS45OTUxIj5FMkUmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsgKDUlKTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgSW50ZWdyYXRpb24tLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IkludGVncmF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJjbHVzdGVyX0ludGVncmF0aW9uIj48cmVjdCBmaWxsPSIjRkZDMTA3IiBoZWlnaHQ9IjEyMi40IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMjQwIiB4PSI3IiB5PSIxNjkuNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjEuMTgwNCIgeD0iNjYuNDA5OCIgeT0iMTg0LjM5NTEiPiYjMzIxMTM7JiMyMTUxMjsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsgKDE1JSk8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIFVuaXQtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IlVuaXQiIGRhdGEtc291cmNlLWxpbmU9IjIxIiBkYXRhLXVpZD0iZW50MDAwNiIgaWQ9ImNsdXN0ZXJfVW5pdCI+PHJlY3QgZmlsbD0iIzFFODhFNSIgaGVpZ2h0PSIxMjIuNCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjIyNyIgeD0iMjAiIHk9IjMzMS44Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0OS4xODAyIiB4PSI1OC45MDk5IiB5PSIzNDYuNzk1MSI+JiMxMjUxODsmIzEyNDkxOyYjMTI0ODM7JiMxMjQ4ODsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsgKDgwJSk8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJFMkVOb3RlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV9FMkVOb3RlIj48cGF0aCBkPSJNMzAuNTksNTAgTDMwLjU5LDEwNS4zOTg0IEwyMDMuNDEzNCwxMDUuMzk4NCBMMjAzLjQxMzQsNjAgTDE5My40MTM0LDUwIEwzMC41OSw1MCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTE5My40MTM0LDUwIEwxOTMuNDEzNCw2MCBMMjAzLjQxMzQsNjAgTDE5My40MTM0LDUwIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUxLjgyMzQiIHg9IjM2LjU5IiB5PSI2Ny4wNjY5Ij4tICYjMTI1MTg7JiMxMjU0MDsmIzEyNDcwOyYjMTI1NDA7JiMxMjQ3MTsmIzEyNDkwOyYjMTI1MjI7JiMxMjQ1ODsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEyLjgyMzQiIHg9IjM2LjU5IiB5PSI4Mi4xOTk3Ij4tICYjMjM0NTU7JiMyOTg3MjsmIzIyNjU5OyYjMTIzOTU7JiMzNjgxNzsmIzEyMzU2OyYjMjkzNjY7JiMyNDkwNzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMuODIzMyIgeD0iMzYuNTkiIHk9Ijk3LjMzMjUiPi0gJiMyNDYxNTsmIzMzMDIxOyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkludGVncmF0aW9uTm90ZSIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGRhdGEtdWlkPSJlbnQwMDA1IiBpZD0iZW50aXR5X0ludGVncmF0aW9uTm90ZSI+PHBhdGggZD0iTTMwLjU5LDIxMi40IEwzMC41OSwyNjcuNzk4NCBMMjAzLjQxMzQsMjY3Ljc5ODQgTDIwMy40MTM0LDIyMi40IEwxOTMuNDEzNCwyMTIuNCBMMzAuNTksMjEyLjQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xOTMuNDEzNCwyMTIuNCBMMTkzLjQxMzQsMjIyLjQgTDIwMy40MTM0LDIyMi40IEwxOTMuNDEzNCwyMTIuNCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MS44MjM0IiB4PSIzNi41OSIgeT0iMjI5LjQ2NjkiPi0gJiMxMjQ2NzsmIzEyNTMxOyYjMTI1MDk7JiMxMjU0MDsmIzEyNDkzOyYjMTI1MzE7JiMxMjQ4ODsmIzM4MjkxOyYjMTIzOTg7JiMzNjg5OTsmIzI1NjU4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OC4zODk3IiB4PSIzNi41OSIgeT0iMjQ0LjU5OTciPi0gQVBJJiMxMjM5ODsmIzI2OTA4OyYjMzUzODg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS44MjM0IiB4PSIzNi41OSIgeT0iMjU5LjczMjUiPi0gJiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7JiMxMjUwMTsmIzEyNTI1OyYjMTI1NDA7JiMxMjM5ODsmIzMwOTA2OyYjMzU0Njk7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iVW5pdE5vdGUiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImVudGl0eV9Vbml0Tm90ZSI+PHBhdGggZD0iTTQ0LjA5LDM3NC44IEw0NC4wOSw0MzAuMTk4NCBMMjAzLjkxMzQsNDMwLjE5ODQgTDIwMy45MTM0LDM4NC44IEwxOTMuOTEzNCwzNzQuOCBMNDQuMDksMzc0LjgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xOTMuOTEzNCwzNzQuOCBMMTkzLjkxMzQsMzg0LjggTDIwMy45MTM0LDM4NC44IEwxOTMuOTEzNCwzNzQuOCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOC44MjM0IiB4PSI1MC4wOSIgeT0iMzkxLjg2NjkiPi0gJiMyMDQ5MTsmIzEyMjkzOyYjMTIzOTg7JiMxMjQ2NzsmIzEyNTMxOyYjMTI1MDk7JiMxMjU0MDsmIzEyNDkzOyYjMTI1MzE7JiMxMjQ4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEyLjgyMzQiIHg9IjUwLjA5IiB5PSI0MDYuOTk5NyI+LSAmIzEyNDk5OyYjMTI0NzI7JiMxMjQ5MzsmIzEyNDczOyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg2LjgyMzMiIHg9IjUwLjA5IiB5PSI0MjIuMTMyNSI+LSAmIzIyNjU5OyYjMzAwMjg7JiMyMDUxNjsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODs8L3RleHQ+PC9nPjwhLS1saW5rIEUyRSB0byBJbnRlZ3JhdGlvbi0tPjwhLS1saW5rIEludGVncmF0aW9uIHRvIFVuaXQtLT48IS0tU1JDPVtUUDdWSVc5MTVDUmx6b2JNOHdXQkdJRjlncTJzNU9ISUtSbzhZOTFzaXVLT21IUXdZNjF0OXFpcW1IQXhBV0FKMmFDaDhZaW5WOVozX2w0amNiY3F0U25XNkN4Q3p5c1N0dHBaNFNHVDJPYmk4WGJUMm9WTmp4WnVRWnA5cFdKdUs4V0ZDZndIY2tBdlU2cDVmS1NZTkMyX3ZFWGZaa0RKZ1I2d284S1pHSl8zdkNMakVPRW9Vb0JodkhUdW0yVVdWRzhraWRGMXNOYWxjemJkb1V4NHNLQzZ2TUhuZkNMOG9WWE9tN1UwLXcxcnhWYVRTMGJtMnhKTXB1TjRldFRrcDhqZGxPNTFWUkc2dncwVWN3TWtLSVdKb0wza0JWcGJjNEthaUJHOVNfSUJxN254cVFqNTVzSFdKMWI1aWZaRFBzR2ZYX3VhdVYyd042RGt4SEttNlRVSzZyVmlrWll5aDg3UTZJZ3RIaEw3RkU1NGIyb0R2Zk5ycUJVVlVjZV9TVzJ1M2hYRFF4TFpEZGZNZ184Vmp2ckU2SjBjYnhsZUdfdUhWSGY5eWlKdEVqMUs3RDdnSVhjSzBjYXQ1VGpjZ3U3c0dOVGVZeFBUT3oyVXdEYTZEa2pka2pBU2RaQnpQal82aFlHODhqZUtTV1Y4ai1vRVl0NDdGRWNaWER5MF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h4 id="_7">適用対象<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>ドメインモデルパターン</strong></li>
<li><strong>イベント履歴式</strong></li>
<li><strong>ヘキサゴナルアーキテクチャ</strong></li>
</ul>
<h4 id="_8">特徴<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>ユニットテストに重点</strong>: 高品質なビジネスロジックの検証</li>
<li><strong>高速なフィードバック</strong>: 素早いテスト実行</li>
<li><strong>保守コストが低い</strong>: シンプルで理解しやすいテスト</li>
</ul>
<h4 id="_9">実装例<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<p><strong>ドメインモデルのユニットテスト</strong>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">予約をキャンセルできる</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">futureTimeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createFutureTimeSlot</span><span class="p">();</span>
<span class="w">    </span><span class="n">Reservation</span><span class="w"> </span><span class="n">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Reservation</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">        </span><span class="n">UserId</span><span class="p">.</span><span class="na">generate</span><span class="p">(),</span><span class="w"> </span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">(),</span><span class="w"> </span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="p">(</span><span class="s">&quot;会議&quot;</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Purpose</span><span class="p">(</span><span class="s">&quot;定例会議&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">futureTimeSlot</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="n">reservation</span><span class="p">.</span><span class="na">cancel</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">reservation</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">ReservationStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">@Test</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">開始2時間前を過ぎた予約はキャンセルできない</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">pastTimeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createPastTimeSlot</span><span class="p">();</span>
<span class="w">    </span><span class="n">Reservation</span><span class="w"> </span><span class="n">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Reservation</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">        </span><span class="n">UserId</span><span class="p">.</span><span class="na">generate</span><span class="p">(),</span><span class="w"> </span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">(),</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="p">(</span><span class="s">&quot;会議&quot;</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Purpose</span><span class="p">(</span><span class="s">&quot;定例会議&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">pastTimeSlot</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When &amp; Then</span>
<span class="w">    </span><span class="n">assertThatThrownBy</span><span class="p">(</span><span class="n">reservation</span><span class="p">::</span><span class="n">cancel</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">hasMessageContaining</span><span class="p">(</span><span class="s">&quot;2時間前まで&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_10">ダイヤモンド形テスト<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjQ0NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6Mjk5cHg7aGVpZ2h0OjQ0NXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI5OSA0NDUiIHdpZHRoPSIyOTlweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIEUyRS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iRTJFIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfRTJFIj48cmVjdCBmaWxsPSIjNENBRjUwIiBoZWlnaHQ9IjEwNy4yNiIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjI0MCIgeD0iNDYiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIyLjA0ODYiIHg9IjEwNC45NzU3IiB5PSIyMS45OTUxIj5FMkUmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsgKDIwJSk8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIEludGVncmF0aW9uLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJJbnRlZ3JhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iY2x1c3Rlcl9JbnRlZ3JhdGlvbiI+PHJlY3QgZmlsbD0iI0ZGQzEwNyIgaGVpZ2h0PSIxMjIuNCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjI3OSIgeD0iNyIgeT0iMTU0LjI2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMS4xODA0IiB4PSI4NS45MDk4IiB5PSIxNjkuMjU1MSI+JiMzMjExMzsmIzIxNTEyOyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyAoNTAlKTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgVW5pdC0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iVW5pdCIgZGF0YS1zb3VyY2UtbGluZT0iMjAiIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iY2x1c3Rlcl9Vbml0Ij48cmVjdCBmaWxsPSIjMUU4OEU1IiBoZWlnaHQ9IjEyMi40IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMjEzIiB4PSI3MyIgeT0iMzE2LjY2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0OS4xODAyIiB4PSIxMDQuOTA5OSIgeT0iMzMxLjY1NTEiPiYjMTI1MTg7JiMxMjQ5MTsmIzEyNDgzOyYjMTI0ODg7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7ICgzMCUpPC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iRTJFTm90ZSIgZGF0YS1zb3VyY2UtbGluZT0iNyIgZGF0YS11aWQ9ImVudDAwMDMiIGlkPSJlbnRpdHlfRTJFTm90ZSI+PHBhdGggZD0iTTY5LjU5LDUwIEw2OS41OSw5MC4yNjU2IEwyNDIuNDEzNCw5MC4yNjU2IEwyNDIuNDEzNCw2MCBMMjMyLjQxMzQsNTAgTDY5LjU5LDUwIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjMyLjQxMzQsNTAgTDIzMi40MTM0LDYwIEwyNDIuNDEzNCw2MCBMMjMyLjQxMzQsNTAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTEuODIzNCIgeD0iNzUuNTkiIHk9IjY3LjA2NjkiPi0gJiMxMjUxODsmIzEyNTQwOyYjMTI0NzA7JiMxMjU0MDsmIzEyNDcxOyYjMTI0OTA7JiMxMjUyMjsmIzEyNDU4OyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzguODIzNCIgeD0iNzUuNTkiIHk9IjgyLjE5OTciPi0gJiMxMjQ1NjsmIzEyNTMxOyYjMTI0ODk7JiMxMjQ4NDsmIzEyNTQwOyYjMTI0NTY7JiMxMjUzMTsmIzEyNDg5OyYjMjY5MDg7JiMzNTM4ODs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJJbnRlZ3JhdGlvbk5vdGUiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBkYXRhLXVpZD0iZW50MDAwNSIgaWQ9ImVudGl0eV9JbnRlZ3JhdGlvbk5vdGUiPjxwYXRoIGQ9Ik0zMS4wOSwxOTcuMjYgTDMxLjA5LDI1Mi42NTg0IEwyNDIuOTEzNSwyNTIuNjU4NCBMMjQyLjkxMzUsMjA3LjI2IEwyMzIuOTEzNSwxOTcuMjYgTDMxLjA5LDE5Ny4yNiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTIzMi45MTM1LDE5Ny4yNiBMMjMyLjkxMzUsMjA3LjI2IEwyNDIuOTEzNSwyMDcuMjYgTDIzMi45MTM1LDE5Ny4yNiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MS44MjM0IiB4PSIzNy4wOSIgeT0iMjE0LjMyNjkiPi0gJiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7JiMxMjQ1MDsmIzEyNDYzOyYjMTI0NzU7JiMxMjQ3MzsmIzIzNjUyOyYjMTIzOTg7JiMyNjkwODsmIzM1Mzg4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTAuODIzNSIgeD0iMzcuMDkiIHk9IjIyOS40NTk3Ij4tICYjMTI0ODg7JiMxMjUyMTsmIzEyNTMxOyYjMTI0NzA7JiMxMjQ2MzsmIzEyNDcxOyYjMTI1MTk7JiMxMjUzMTsmIzIyNjU5OyYjMzAwMjg7JiMxMjM5ODsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUxLjgyMzQiIHg9IjM3LjA5IiB5PSIyNDQuNTkyNSI+LSAmIzM1MDc5OyYjMjU5Njg7JiMxMjQ2NzsmIzEyNTMxOyYjMTI1MDk7JiMxMjU0MDsmIzEyNDkzOyYjMTI1MzE7JiMxMjQ4ODsmIzM2ODk5OyYjMjU2NTg7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iVW5pdE5vdGUiIGRhdGEtc291cmNlLWxpbmU9IjIyIiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImVudGl0eV9Vbml0Tm90ZSI+PHBhdGggZD0iTTk3LjI3LDM1OS42NiBMOTcuMjcsNDE1LjA1ODQgTDI0Mi43Mjg2LDQxNS4wNTg0IEwyNDIuNzI4NiwzNjkuNjYgTDIzMi43Mjg2LDM1OS42NiBMOTcuMjcsMzU5LjY2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjMyLjcyODYsMzU5LjY2IEwyMzIuNzI4NiwzNjkuNjYgTDI0Mi43Mjg2LDM2OS42NiBMMjMyLjcyODYsMzU5LjY2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEyLjgyMzQiIHg9IjEwMy4yNyIgeT0iMzc2LjcyNjkiPi0gJiMxMjQ5OTsmIzEyNDcyOyYjMTI0OTM7JiMxMjQ3MzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OS44MjMzIiB4PSIxMDMuMjciIHk9IjM5MS44NTk3Ij4tICYjMTI0OTY7JiMxMjUyMjsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3MTsmIzEyNTE5OyYjMTI1MzE7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNC40NTg2IiB4PSIxMDMuMjciIHk9IjQwNi45OTI1Ij4tICYjMjI1MjI7JiMyNjQxMjsmIzMwMzQwOyYjMTIzOTQ7Q1JVRCYjMjU4MDU7JiMyMDMxNjs8L3RleHQ+PC9nPjwhLS1saW5rIEUyRSB0byBJbnRlZ3JhdGlvbi0tPjwhLS1saW5rIEludGVncmF0aW9uIHRvIFVuaXQtLT48IS0tU1JDPVtUUDVUSW05MTU4Umx6clVpSGIwTldiZ0lMdTZpQW1ZYmlVOTVIOElxY21hbldZcnE0SzdFSURnNzg4V3RPR0djUFRBTkk1emN6NkRFaGxPbGNYZE1USk13TVN4Qy0gLXV2eHRGNmVNZlJBUUk5QXFmdUVRMmlSYVpIZlFXWUpkYmFscl9zMkd2SlpTYklEMUFxd1E2R3Y3NGxaRkl1OUNjbnM1MlRibThYZHJpR0NqZ2NkYTM5N0tycW9idVBvMTdXVG8wNVNTUmhkZnZyWWViVGFMdkZfQm1sZUJJa2NMZzRiZTlCMTc4RGYwbHVYTnpWV1BtMFFHOWtNWHNQMXBVMGo4NFMweWJuY3RhcXdqTDFlb2plSTFMUE8tNVdCNVJfa1RLaDVNcDlWQ0RhT1FIaG9LbjJKd05IN19uSEhmbEJvZmhkdXh5MHJtMF8wbHdXaE5rakVjR1ZwMlpDR3FWVWlkbUtZTmFlcVdxenpjZ2FOcGNaSlpsT2U5dXRBYS0wc3ZwZFdaS2RITHVOVld3bFo1QmRGcFEtakxDV1g4LXAyRVU2WDc2S3FZVlVWR0o2SDhrZTNGWUQzTUtUeGRiRFE2bWtiVFhCY0NXYzFSdGxOTlFDd2J0X0YwVlBmZ0o0V3FRdi1GclA3R2xBTmp3cmpmcklMR3NqZy1henY1Z3FSckVteHRfSW55QnowVzAwXS0tPjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h4 id="_11">適用対象<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>アクティブレコードパターン</strong></li>
<li><strong>レイヤードアーキテクチャ（データベース中心）</strong></li>
</ul>
<h4 id="_12">特徴<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>統合テストに重点</strong>: データアクセスロジックの検証</li>
<li><strong>データベーステスト</strong>: 実際のデータベース操作を含む</li>
<li><strong>中程度の実行速度</strong>: データベースアクセスを含むため</li>
</ul>
<h4 id="_13">実装例<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p><strong>データアクセス層の統合テスト</strong>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@Transactional</span>
<span class="kd">class</span> <span class="nc">ReservationRepositoryTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:15&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ReservationRepository</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">予約を保存して取得できる</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestReservation</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">reservation</span><span class="p">);</span>
<span class="w">        </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">reservation</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">found</span><span class="p">).</span><span class="na">isPresent</span><span class="p">();</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">found</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getTitle</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">reservation</span><span class="p">.</span><span class="na">getTitle</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">アクティブな予約のみ取得される</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">activeReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createActiveReservation</span><span class="p">();</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">cancelledReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createCancelledReservation</span><span class="p">();</span>
<span class="w">        </span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">activeReservation</span><span class="p">);</span>
<span class="w">        </span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">cancelledReservation</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">activeReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">findActiveByUserId</span><span class="p">(</span>
<span class="w">            </span><span class="n">activeReservation</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">activeReservations</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">activeReservations</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getId</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">activeReservation</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_14">逆ピラミッド形テスト<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjQ0NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MjYxcHg7aGVpZ2h0OjQ0NXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI2MSA0NDUiIHdpZHRoPSIyNjFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIEUyRS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iRTJFIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfRTJFIj48cmVjdCBmaWxsPSIjNENBRjUwIiBoZWlnaHQ9IjEyMi40IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMjQxIiB4PSI3IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMi4wNDg2IiB4PSI2Ni40NzU3IiB5PSIyMS45OTUxIj5FMkUmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsgKDcwJSk8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIEludGVncmF0aW9uLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJJbnRlZ3JhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iY2x1c3Rlcl9JbnRlZ3JhdGlvbiI+PHJlY3QgZmlsbD0iI0ZGQzEwNyIgaGVpZ2h0PSIxMDcuMjYiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIyMDAiIHg9IjQ4IiB5PSIxNjkuNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjEuMTgwNCIgeD0iODcuNDA5OCIgeT0iMTg0LjM5NTEiPiYjMzIxMTM7JiMyMTUxMjsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsgKDIwJSk8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIFVuaXQtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IlVuaXQiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBkYXRhLXVpZD0iZW50MDAwNiIgaWQ9ImNsdXN0ZXJfVW5pdCI+PHJlY3QgZmlsbD0iIzFFODhFNSIgaGVpZ2h0PSIxMjIuNCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjIxNCIgeD0iMzQiIHk9IjMxNi42NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDkuMTgwMiIgeD0iNjYuNDA5OSIgeT0iMzMxLjY1NTEiPiYjMTI1MTg7JiMxMjQ5MTsmIzEyNDgzOyYjMTI0ODg7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7ICgxMCUpPC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iRTJFTm90ZSIgZGF0YS1zb3VyY2UtbGluZT0iNyIgZGF0YS11aWQ9ImVudDAwMDMiIGlkPSJlbnRpdHlfRTJFTm90ZSI+PHBhdGggZD0iTTMxLjQxLDUwIEwzMS40MSwxMDUuMzk4NCBMMjA0LjU4MjUsMTA1LjM5ODQgTDIwNC41ODI1LDYwIEwxOTQuNTgyNSw1MCBMMzEuNDEsNTAiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xOTQuNTgyNSw1MCBMMTk0LjU4MjUsNjAgTDIwNC41ODI1LDYwIEwxOTQuNTgyNSw1MCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MS44MjM0IiB4PSIzNy40MSIgeT0iNjcuMDY2OSI+LSAmIzEyNTE4OyYjMTI1NDA7JiMxMjQ3MDsmIzEyNTQwOyYjMTI0NzE7JiMxMjQ5MDsmIzEyNTIyOyYjMTI0NTg7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MS44MjM0IiB4PSIzNy40MSIgeT0iODIuMTk5NyI+LSAmIzEyNTI3OyYjMTI1NDA7JiMxMjQ2MzsmIzEyNTAxOyYjMTI1MjU7JiMxMjU0MDsmIzIwODQwOyYjMjAzMDc7JiMxMjM5ODsmIzI2OTA4OyYjMzUzODg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Mi4xNzI1IiB4PSIzNy40MSIgeT0iOTcuMzMyNSI+LSBVSSYjMTIzNjM7JiMxMjQyNTsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzEyNTA1OyYjMTI1NDA7JiMxMjQ3MzsmIzEyNDE0OyYjMTIzOTE7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iSW50ZWdyYXRpb25Ob3RlIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfSW50ZWdyYXRpb25Ob3RlIj48cGF0aCBkPSJNNzEuNzQsMjEyLjQgTDcxLjc0LDI1Mi42NjU2IEwyMDQuMjYyMSwyNTIuNjY1NiBMMjA0LjI2MjEsMjIyLjQgTDE5NC4yNjIxLDIxMi40IEw3MS43NCwyMTIuNCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTE5NC4yNjIxLDIxMi40IEwxOTQuMjYyMSwyMjIuNCBMMjA0LjI2MjEsMjIyLjQgTDE5NC4yNjIxLDIxMi40IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjUyMjEiIHg9Ijc3Ljc0IiB5PSIyMjkuNDY2OSI+LSBBUEkgJiMxMjUyNDsmIzEyNTA1OyYjMTI1MjM7JiMxMjM5ODsmIzI2OTA4OyYjMzUzODg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk5LjgyMzMiIHg9Ijc3Ljc0IiB5PSIyNDQuNTk5NyI+LSAmIzEyNDY5OyYjMTI1NDA7JiMxMjQ5OTsmIzEyNDczOyYjMzgyOTE7JiMzNjg5OTsmIzI1NjU4OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IlVuaXROb3RlIiBkYXRhLXNvdXJjZS1saW5lPSIyMiIgZGF0YS11aWQ9ImVudDAwMDciIGlkPSJlbnRpdHlfVW5pdE5vdGUiPjxwYXRoIGQ9Ik01Ny41OSwzNTkuNjYgTDU3LjU5LDQxNS4wNTg0IEwyMDQuNDEzNCw0MTUuMDU4NCBMMjA0LjQxMzQsMzY5LjY2IEwxOTQuNDEzNCwzNTkuNjYgTDU3LjU5LDM1OS42NiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTE5NC40MTM0LDM1OS42NiBMMTk0LjQxMzQsMzY5LjY2IEwyMDQuNDEzNCwzNjkuNjYgTDE5NC40MTM0LDM1OS42NiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk5LjgyMzMiIHg9IjYzLjU5IiB5PSIzNzYuNzI2OSI+LSAmIzEyNDk2OyYjMTI1MjI7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0NzE7JiMxMjUxOTsmIzEyNTMxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuODIzNCIgeD0iNjMuNTkiIHk9IjM5MS44NTk3Ij4tICYjMTI1MTg7JiMxMjU0MDsmIzEyNDg2OyYjMTI0NTE7JiMxMjUyMjsmIzEyNDg2OyYjMTI0NTE7JiMzODMwNjsmIzI1OTY4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ni44MjMzIiB4PSI2My41OSIgeT0iNDA2Ljk5MjUiPi0gJiMzNTMzNjsmIzMxNjM5OyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7PC90ZXh0PjwvZz48IS0tbGluayBFMkUgdG8gSW50ZWdyYXRpb24tLT48IS0tbGluayBJbnRlZ3JhdGlvbiB0byBVbml0LS0+PCEtLVNSQz1bVFA1RkltOTE2OFZseW9iTTh3WTNlOUJlQVAxalhPTElLSm40SDRZeHNLQUNPMGlUOGNYdGcybWxXY1c0ZEo5SWhCRzhBeUZnbXhwdnhyaXFDd3BrUWRHUE5sUnRzdmJkZGQ0ZndldzZMSTZVYURWMllWS2pDUk9RSW1YcEZZYUthV0I4UFFMOUlPbjVMbm52OTJCd2w0NHhKdWNZYjRvRXFvS243MGJ1NFNnZnN0ZVFQX1BLbUl0djlJMmRPN1EwdjhNNWU3VC1xSXNhem1Od1VVUmRHdUlwa2NmYktKZVlabTNhM2FXTnA1VS1sVzZ2MEQ4MGlwN1BhTlRRRkFMaDZTV1pkTmlkelBfRjRYWkRfa3RyaUR3YmRQR0NIVzdDU28xZGxGaUR2OGVGN0oyLW1BV1g1SWkyRW51VEpTNEZzaS16T2p4MXhuX3BvclhOQ3hjcWhjTm43cWRzSkhtandxUlhrNG85N19adnpxdjRDRGtDWTlKZUtRREFRTkhTeEhTX19rRllOV2YwMjhMb3FGZDZUMmNpd0pDbFFxRW5TRUF0bzhIUUxnWlY2ZjBOc3BsUmtTZUJSMVhMUmxoYjl2ZUV3X2IxeXZBdkRqeVBXemNRdWNIRnd6ZE9ySEg1blBqQXpXMXhiZnFZYTVGVFI4LW5fRzgwXS0tPjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h4 id="_15">適用対象<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>トランザクションスクリプトパターン</strong></li>
<li><strong>単純なCRUDアプリケーション</strong></li>
</ul>
<h4 id="_16">特徴<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>E2Eテストに重点</strong>: エンドツーエンドの動作検証</li>
<li><strong>ユーザー視点</strong>: 実際のユーザー操作をシミュレート</li>
<li><strong>低速だが包括的</strong>: 全体的な動作を保証</li>
</ul>
<h4 id="_17">実装例<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<p><strong>E2Eテスト（Selenium WebDriver使用）</strong>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="nd">@Testcontainers</span>
<span class="kd">class</span> <span class="nc">ReservationE2ETest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:15&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TestRestTemplate</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">WebDriver</span><span class="w"> </span><span class="n">driver</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ChromeDriver</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">会議室を検索して予約できる</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given - ユーザーがログイン済み</span>
<span class="w">        </span><span class="n">loginAsTestUser</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When - 会議室検索ページにアクセス</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;http://localhost:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/rooms/search&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 検索条件を入力</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;capacity&quot;</span><span class="p">)).</span><span class="na">sendKeys</span><span class="p">(</span><span class="s">&quot;10&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">)).</span><span class="na">sendKeys</span><span class="p">(</span><span class="s">&quot;2024-12-01&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;startTime&quot;</span><span class="p">)).</span><span class="na">sendKeys</span><span class="p">(</span><span class="s">&quot;10:00&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;endTime&quot;</span><span class="p">)).</span><span class="na">sendKeys</span><span class="p">(</span><span class="s">&quot;12:00&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;searchButton&quot;</span><span class="p">)).</span><span class="na">click</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 検索結果から会議室を選択</span>
<span class="w">        </span><span class="n">WebElement</span><span class="w"> </span><span class="n">roomCard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">className</span><span class="p">(</span><span class="s">&quot;room-card&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">roomCard</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">className</span><span class="p">(</span><span class="s">&quot;reserve-button&quot;</span><span class="p">)).</span><span class="na">click</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 予約情報を入力</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">)).</span><span class="na">sendKeys</span><span class="p">(</span><span class="s">&quot;定例会議&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;purpose&quot;</span><span class="p">)).</span><span class="na">sendKeys</span><span class="p">(</span><span class="s">&quot;週次定例会議&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;submitButton&quot;</span><span class="p">)).</span><span class="na">click</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Then - 予約完了メッセージが表示される</span>
<span class="w">        </span><span class="n">WebElement</span><span class="w"> </span><span class="n">successMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">className</span><span class="p">(</span><span class="s">&quot;success-message&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">successMessage</span><span class="p">.</span><span class="na">getText</span><span class="p">()).</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;予約が完了しました&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">予約をキャンセルできる</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given - 事前に予約を作成</span>
<span class="w">        </span><span class="n">createTestReservation</span><span class="p">();</span>
<span class="w">        </span><span class="n">loginAsTestUser</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When - マイ予約ページにアクセス</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;http://localhost:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/my-reservations&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 予約をキャンセル</span>
<span class="w">        </span><span class="n">WebElement</span><span class="w"> </span><span class="n">reservationCard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">driver</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">className</span><span class="p">(</span><span class="s">&quot;reservation-card&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">reservationCard</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">className</span><span class="p">(</span><span class="s">&quot;cancel-button&quot;</span><span class="p">)).</span><span class="na">click</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 確認ダイアログでOK</span>
<span class="w">        </span><span class="n">driver</span><span class="p">.</span><span class="na">switchTo</span><span class="p">().</span><span class="na">alert</span><span class="p">().</span><span class="na">accept</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Then - キャンセル済み表示になる</span>
<span class="w">        </span><span class="n">WebElement</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservationCard</span><span class="p">.</span><span class="na">findElement</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="na">className</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">status</span><span class="p">.</span><span class="na">getText</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;キャンセル済み&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="_18">会議室予約システムのテスト戦略<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h2>
<h3 id="_19">アーキテクチャとテスト戦略の選択<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>会議室予約システムは<strong>ドメインモデルパターン</strong>と<strong>ヘキサゴナルアーキテクチャ</strong>を採用するため、<strong>ピラミッド形テスト</strong>が最適。</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjUyM3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTQ3OHB4O2hlaWdodDo1MjNweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNDc4IDUyMyIgd2lkdGg9IjE0NzhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIERvbWFpbi0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iRG9tYWluIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfRG9tYWluIj48cGF0aCBkPSJNMjkuNSw2IEwxMDAuNDk5Nyw2IEEzLjc1LDMuNzUgMCAwIDEgMTAyLjk5OTcsOC41IEwxMDkuOTk5NywyOC4yOTY5IEw0ODEuNSwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDQ4NCwzMC43OTY5IEw0ODQsMjQyLjc4IEEyLjUsMi41IDAgMCAxIDQ4MS41LDI0NS4yOCBMMjkuNSwyNDUuMjggQTIuNSwyLjUgMCAwIDEgMjcsMjQyLjc4IEwyNyw4LjUgQTIuNSwyLjUgMCAwIDEgMjkuNSw2IiBmaWxsPSIjOUMyN0IwIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIyNyIgeDI9IjEwOS45OTk3IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMzEiIHk9IjIwLjk5NTEiPiYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMyMzY1Mjs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIEFwcC0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iQXBwIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMDgiIGlkPSJjbHVzdGVyX0FwcCI+PHBhdGggZD0iTTY5Ny41LDYgTDgyNC40OTk1LDYgQTMuNzUsMy43NSAwIDAgMSA4MjYuOTk5NSw4LjUgTDgzMy45OTk1LDI4LjI5NjkgTDEyNTYuNSwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDEyNTksMzAuNzk2OSBMMTI1OSwyNDIuNzggQTIuNSwyLjUgMCAwIDEgMTI1Ni41LDI0NS4yOCBMNjk3LjUsMjQ1LjI4IEEyLjUsMi41IDAgMCAxIDY5NSwyNDIuNzggTDY5NSw4LjUgQTIuNSwyLjUgMCAwIDEgNjk3LjUsNiIgZmlsbD0iIzRDQUY1MCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNjk1IiB4Mj0iODMzLjk5OTUiIHkxPSIyOC4yOTY5IiB5Mj0iMjguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuOTk5NSIgeD0iNjk5IiB5PSIyMC45OTUxIj4mIzEyNDUwOyYjMTI1MDM7JiMxMjUyMjsmIzEyNDY1OyYjMTI1NDA7JiMxMjQ3MTsmIzEyNTE5OyYjMTI1MzE7JiMyMzY1Mjs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIEluZnJhLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJJbmZyYSIgZGF0YS1zb3VyY2UtbGluZT0iMTkiIGRhdGEtdWlkPSJlbnQwMDEyIiBpZD0iY2x1c3Rlcl9JbmZyYSI+PHBhdGggZD0iTTguNSwyODUuMjggTDE2My40OTkzLDI4NS4yOCBBMy43NSwzLjc1IDAgMCAxIDE2NS45OTkzLDI4Ny43OCBMMTcyLjk5OTMsMzA3LjU3NjkgTDQ5Ny41LDMwNy41NzY5IEEyLjUsMi41IDAgMCAxIDUwMCwzMTAuMDc2OSBMNTAwLDUxNC40OSBBMi41LDIuNSAwIDAgMSA0OTcuNSw1MTYuOTkgTDguNSw1MTYuOTkgQTIuNSwyLjUgMCAwIDEgNiw1MTQuNDkgTDYsMjg3Ljc4IEEyLjUsMi41IDAgMCAxIDguNSwyODUuMjgiIGZpbGw9IiNGRjk4MDAiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjYiIHgyPSIxNzIuOTk5MyIgeTE9IjMwNy41NzY5IiB5Mj0iMzA3LjU3NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUzLjk5OTMiIHg9IjEwIiB5PSIzMDAuMjc1MSI+JiMxMjQ1MjsmIzEyNTMxOyYjMTI1MDE7JiMxMjUyMTsmIzEyNDczOyYjMTI0ODg7JiMxMjUyMTsmIzEyNDYzOyYjMTI0ODE7JiMxMjUxNTsmIzIzNjUyOzwvdGV4dD48L2c+PCEtLWVudGl0eSBVc2VyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IlVzZXIiIGRhdGEtc291cmNlLWxpbmU9IjYiIGRhdGEtdWlkPSJlbnQwMDAzIiBpZD0iZW50aXR5X1VzZXIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzEuOTEwMiIgeD0iOTEuMDQiIHk9IjQ5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE0Mi45NTAyIiB5PSI1NCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTQwLjk1MDIiIHk9IjU2Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNDAuOTUwMiIgeT0iNjAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMS45MTAyIiB4PSIxMDYuMDQiIHk9IjgxLjk5NTEiPlVzZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUm9vbS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSb29tIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBkYXRhLXVpZD0iZW50MDAwNCIgaWQ9ImVudGl0eV9Sb29tIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjgwLjQ5NjEiIHg9IjE5OS43NSIgeT0iNDkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjYwLjI0NjEiIHk9IjU0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIyNTguMjQ2MSIgeT0iNTYiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjI1OC4yNDYxIiB5PSI2MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwLjQ5NjEiIHg9IjIxNC43NSIgeT0iODEuOTk1MSI+Um9vbTwvdGV4dD48L2c+PCEtLWVudGl0eSBSZXNlcnZhdGlvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSZXNlcnZhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iOCIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfUmVzZXJ2YXRpb24iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIzLjY4NTUiIHg9IjMxNi4xNiIgeT0iNDkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iNDE5Ljg0NTUiIHk9IjU0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI0MTcuODQ1NSIgeT0iNTYiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjQxNy44NDU1IiB5PSI2MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjY4NTUiIHg9IjMzMS4xNiIgeT0iODEuOTk1MSI+UmVzZXJ2YXRpb248L3RleHQ+PC9nPjwhLS1lbnRpdHkgQ29uZmxpY3RDaGVja2VyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkNvbmZsaWN0Q2hlY2tlciIgZGF0YS1zb3VyY2UtbGluZT0iOSIgZGF0YS11aWQ9ImVudDAwMDYiIGlkPSJlbnRpdHlfQ29uZmxpY3RDaGVja2VyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1MC41NDM5IiB4PSI1MC43MyIgeT0iMTc0Ljk4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE4MS4yNzM5IiB5PSIxNzkuOTgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE3OS4yNzM5IiB5PSIxODEuOTgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE3OS4yNzM5IiB5PSIxODUuOTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAuNTQzOSIgeD0iNjUuNzMiIHk9IjIwNy45NzUxIj5Db25mbGljdENoZWNrZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUmVzZXJ2YXRpb25MaW1pdENoZWNrZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUmVzZXJ2YXRpb25MaW1pdENoZWNrZXIiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImVudGl0eV9SZXNlcnZhdGlvbkxpbWl0Q2hlY2tlciI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMTUuODI3MSIgeD0iMjM2LjA5IiB5PSIxNzQuOTgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iNDMxLjkxNzEiIHk9IjE3OS45OCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNDI5LjkxNzEiIHk9IjE4MS45OCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNDI5LjkxNzEiIHk9IjE4NS45OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3NS44MjcxIiB4PSIyNTEuMDkiIHk9IjIwNy45NzUxIj5SZXNlcnZhdGlvbkxpbWl0Q2hlY2tlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBDcmVhdGVSZXNlcnZhdGlvblVzZUNhc2UtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQ3JlYXRlUmVzZXJ2YXRpb25Vc2VDYXNlIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgZGF0YS11aWQ9ImVudDAwMDkiIGlkPSJlbnRpdHlfQ3JlYXRlUmVzZXJ2YXRpb25Vc2VDYXNlIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIzMC45Mjc3IiB4PSI3MTguNTQiIHk9IjQ5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjkyOS40Njc3IiB5PSI1NCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iOTI3LjQ2NzciIHk9IjU2Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI5MjcuNDY3NyIgeT0iNjAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTAuOTI3NyIgeD0iNzMzLjU0IiB5PSI4MS45OTUxIj5DcmVhdGVSZXNlcnZhdGlvblVzZUNhc2U8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQ2FuY2VsUmVzZXJ2YXRpb25Vc2VDYXNlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkNhbmNlbFJlc2VydmF0aW9uVXNlQ2FzZSIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGRhdGEtdWlkPSJlbnQwMDEwIiBpZD0iZW50aXR5X0NhbmNlbFJlc2VydmF0aW9uVXNlQ2FzZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMzEuNTI5MyIgeD0iOTg0LjI0IiB5PSI0OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxMTk1Ljc2OTMiIHk9IjU0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMTkzLjc2OTMiIHk9IjU2Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMTkzLjc2OTMiIHk9IjYwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkxLjUyOTMiIHg9Ijk5OS4yNCIgeT0iODEuOTk1MSI+Q2FuY2VsUmVzZXJ2YXRpb25Vc2VDYXNlPC90ZXh0PjwvZz48IS0tZW50aXR5IFNlYXJjaFJvb21zVXNlQ2FzZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJTZWFyY2hSb29tc1VzZUNhc2UiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBkYXRhLXVpZD0iZW50MDAxMSIgaWQ9ImVudGl0eV9TZWFyY2hSb29tc1VzZUNhc2UiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTk2LjYxMTMiIHg9IjczNS42OSIgeT0iMTc0Ljk4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjkxMi4zMDEzIiB5PSIxNzkuOTgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjkxMC4zMDEzIiB5PSIxODEuOTgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjkxMC4zMDEzIiB5PSIxODUuOTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTYuNjExMyIgeD0iNzUwLjY5IiB5PSIyMDcuOTc1MSI+U2VhcmNoUm9vbXNVc2VDYXNlPC90ZXh0PjwvZz48IS0tZW50aXR5IFJlc2VydmF0aW9uQ29udHJvbGxlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSZXNlcnZhdGlvbkNvbnRyb2xsZXIiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBkYXRhLXVpZD0iZW50MDAxMyIgaWQ9ImVudGl0eV9SZXNlcnZhdGlvbkNvbnRyb2xsZXIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTkyLjg1ODQiIHg9IjI5LjU3IiB5PSIzMjguMjgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjAyLjQyODQiIHk9IjMzMy4yOCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjAwLjQyODQiIHk9IjMzNS4yOCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjAwLjQyODQiIHk9IjMzOS4yOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Mi44NTg0IiB4PSI0NC41NyIgeT0iMzYxLjI3NTEiPlJlc2VydmF0aW9uQ29udHJvbGxlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBSZXNlcnZhdGlvblJlcG9zaXRvcnktLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUmVzZXJ2YXRpb25SZXBvc2l0b3J5IiBkYXRhLXNvdXJjZS1saW5lPSIyMSIgZGF0YS11aWQ9ImVudDAwMTQiIGlkPSJlbnRpdHlfUmVzZXJ2YXRpb25SZXBvc2l0b3J5Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5OC43NTc4IiB4PSIyNTcuNjIiIHk9IjMyOC4yOCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSI0MzYuMzc3OCIgeT0iMzMzLjI4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI0MzQuMzc3OCIgeT0iMzM1LjI4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI0MzQuMzc3OCIgeT0iMzM5LjI4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU4Ljc1NzgiIHg9IjI3Mi42MiIgeT0iMzYxLjI3NTEiPlJlc2VydmF0aW9uUmVwb3NpdG9yeTwvdGV4dD48L2c+PCEtLWVudGl0eSBVc2VyUmVwb3NpdG9yeS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJVc2VyUmVwb3NpdG9yeSIgZGF0YS1zb3VyY2UtbGluZT0iMjIiIGRhdGEtdWlkPSJlbnQwMDE1IiBpZD0iZW50aXR5X1VzZXJSZXBvc2l0b3J5Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0Ni45ODI0IiB4PSI1Mi41MSIgeT0iNDQ2LjY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE3OS40OTI0IiB5PSI0NTEuNjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE3Ny40OTI0IiB5PSI0NTMuNjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE3Ny40OTI0IiB5PSI0NTcuNjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDYuOTgyNCIgeD0iNjcuNTEiIHk9IjQ3OS42ODUxIj5Vc2VyUmVwb3NpdG9yeTwvdGV4dD48L2c+PCEtLWVudGl0eSBSb29tUmVwb3NpdG9yeS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSb29tUmVwb3NpdG9yeSIgZGF0YS1zb3VyY2UtbGluZT0iMjMiIGRhdGEtdWlkPSJlbnQwMDE2IiBpZD0iZW50aXR5X1Jvb21SZXBvc2l0b3J5Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1NS41Njg0IiB4PSIyMzQuMjIiIHk9IjQ0Ni42OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIzNjkuNzg4NCIgeT0iNDUxLjY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIzNjcuNzg4NCIgeT0iNDUzLjY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIzNjcuNzg4NCIgeT0iNDU3LjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE1LjU2ODQiIHg9IjI0OS4yMiIgeT0iNDc5LjY4NTEiPlJvb21SZXBvc2l0b3J5PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR01OMTciIGRhdGEtc291cmNlLWxpbmU9IjI3IiBkYXRhLXVpZD0iZW50MDAxOCIgaWQ9ImVudGl0eV9HTU4xNyI+PHBhdGggZD0iTTUxMS4wOSwyOS4zMiBMNTExLjA5LDExNC45ODQxIEw2NzAuOTEzNCwxMTQuOTg0MSBMNjcwLjkxMzQsMzkuMzIgTDY2MC45MTM0LDI5LjMyIEw1MTEuMDksMjkuMzIiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik02NjAuOTEzNCwyOS4zMiBMNjYwLjkxMzQsMzkuMzIgTDY3MC45MTM0LDM5LjMyIEw2NjAuOTEzNCwyOS4zMiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzguNTI1IiB4PSI1MTcuMDkiIHk9IjQ2LjM4NjkiPiYjMTI1MTg7JiMxMjQ5MTsmIzEyNDgzOyYjMTI0ODg7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7ICg4MCUpPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk5LjgyMzMiIHg9IjUxNy4wOSIgeT0iNjEuNTE5NyI+LSAmIzIwNTE2OyYjMTI0NTg7JiMxMjUwMjsmIzEyNDcyOyYjMTI0NTU7JiMxMjQ2MzsmIzEyNDg4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ni44MjMzIiB4PSI1MTcuMDkiIHk9Ijc2LjY1MjUiPi0gJiMxMjQ1NjsmIzEyNTMxOyYjMTI0ODY7JiMxMjQ1MTsmIzEyNDg2OyYjMTI0NTE7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi44MjM0IiB4PSI1MTcuMDkiIHk9IjkxLjc4NTMiPi0gJiMxMjQ4OTsmIzEyNTEzOyYjMTI0NTI7JiMxMjUzMTsmIzEyNDY5OyYjMTI1NDA7JiMxMjQ5OTsmIzEyNDczOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzguODIzNCIgeD0iNTE3LjA5IiB5PSIxMDYuOTE4MSI+LSAmIzM4NTk4OyYjMzIwMDQ7JiMxMjM5ODsmIzEyNDk5OyYjMTI0NzI7JiMxMjQ5MzsmIzEyNDczOyYjMTI1MjM7JiMxMjU0MDsmIzEyNTIzOzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdNTjIwIiBkYXRhLXNvdXJjZS1saW5lPSIzNSIgZGF0YS11aWQ9ImVudDAwMjEiIGlkPSJlbnRpdHlfR01OMjAiPjxwYXRoIGQ9Ik0xMjg2LjA5LDM2Ljg4IEwxMjg2LjA5LDEwNy40MTEzIEwxNDcxLjkxMzQsMTA3LjQxMTMgTDE0NzEuOTEzNCw0Ni44OCBMMTQ2MS45MTM0LDM2Ljg4IEwxMjg2LjA5LDM2Ljg4IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTQ2MS45MTM0LDM2Ljg4IEwxNDYxLjkxMzQsNDYuODggTDE0NzEuOTEzNCw0Ni44OCBMMTQ2MS45MTM0LDM2Ljg4IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi41MjUiIHg9IjEyOTIuMDkiIHk9IjUzLjk0NjkiPiYjMzIxMTM7JiMyMTUxMjsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsgKDE1JSk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY0LjgyMzQiIHg9IjEyOTIuMDkiIHk9IjY5LjA3OTciPi0gJiMxMjUxODsmIzEyNTQwOyYjMTI0NzM7JiMxMjQ2NTsmIzEyNTQwOyYjMTI0NzM7JiMxMjM5ODsmIzMyMDY4OyYjMTI0MTU7JiMyMTUxMjsmIzEyNDMxOyYjMTIzNzk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOC44MjM0IiB4PSIxMjkyLjA5IiB5PSI4NC4yMTI1Ij4tICYjMTI0ODg7JiMxMjUyMTsmIzEyNTMxOyYjMTI0NzA7JiMxMjQ2MzsmIzEyNDcxOyYjMTI1MTk7JiMxMjUzMTsmIzIyNjU5OyYjMzAwMjg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOC44MjM0IiB4PSIxMjkyLjA5IiB5PSI5OS4zNDUzIj4tICYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMxMjQ2OTsmIzEyNTQwOyYjMTI0OTk7JiMxMjQ3MzsmIzM2ODk5OyYjMjU2NTg7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR01OMjMiIGRhdGEtc291cmNlLWxpbmU9IjQyIiBkYXRhLXVpZD0iZW50MDAyNCIgaWQ9ImVudGl0eV9HTU4yMyI+PHBhdGggZD0iTTUyNy41OSwzMTYuMTYgTDUyNy41OSwzODYuNjkxMiBMNjc0LjQxMzQsMzg2LjY5MTIgTDY3NC40MTM0LDMyNi4xNiBMNjY0LjQxMzQsMzE2LjE2IEw1MjcuNTksMzE2LjE2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNjY0LjQxMzQsMzE2LjE2IEw2NjQuNDEzNCwzMjYuMTYgTDY3NC40MTM0LDMyNi4xNiBMNjY0LjQxMzQsMzE2LjE2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4yODU3IiB4PSI1MzMuNTkiIHk9IjMzMy4yMjY5Ij5FMkUmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsgKDUlKTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAuMzg5OCIgeD0iNTMzLjU5IiB5PSIzNDguMzU5NyI+LSBBUEkmIzEyNDU2OyYjMTI1MzE7JiMxMjQ4OTsmIzEyNTA5OyYjMTI0NTI7JiMxMjUzMTsmIzEyNDg4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuODIzNCIgeD0iNTMzLjU5IiB5PSIzNjMuNDkyNSI+LSAmIzEyNTE4OyYjMTI1NDA7JiMxMjQ3MDsmIzEyNTQwOyYjMTI0NzE7JiMxMjQ5MDsmIzEyNTIyOyYjMTI0NTg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS44MjM0IiB4PSI1MzMuNTkiIHk9IjM3OC42MjUzIj4tICYjMTI0NzE7JiMxMjQ3MzsmIzEyNDg2OyYjMTI1MTI7JiMyMDg0MDsmIzIwMzA3OyYjMTIzOTg7JiMyMTIwNTsmIzIwMzE2OzwvdGV4dD48L2c+PCEtLWxpbmsgRG9tYWluIHRvIEdNTjE3LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkRvbWFpbiIgZGF0YS1lbnRpdHktMj0iR01OMTciIGRhdGEtc291cmNlLWxpbmU9IjI3IiBkYXRhLXVpZD0ibG5rMTkiIGlkPSJsaW5rX0RvbWFpbl9HTU4xNyI+PHBhdGggZD0iTTQ4NC4xMTk1LDcyLjE1IEM0ODQuMTY0NCw3Mi4xNSA0ODQuMjA5Myw3Mi4xNSA0ODQuMjU0MSw3Mi4xNSBDNDg0LjM0MzgsNzIuMTUgNDg0LjQzMzUsNzIuMTUgNDg0LjUyMzMsNzIuMTUgQzQ4NC43MDI3LDcyLjE1IDQ4NC44ODIxLDcyLjE1IDQ4NS4wNjE2LDcyLjE1IEM0ODcuOTMyNSw3Mi4xNSA0OTAuODAzOCw3Mi4xNSA0OTMuNjc1LDcyLjE1IEM0OTkuNDE3NSw3Mi4xNSA1MDUuMTYsNzIuMTUgNTEwLjksNzIuMTUiIGZpbGw9Im5vbmUiIGlkPSJEb21haW4tR01OMTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48L2c+PCEtLWxpbmsgQXBwIHRvIEdNTjIwLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkFwcCIgZGF0YS1lbnRpdHktMj0iR01OMjAiIGRhdGEtc291cmNlLWxpbmU9IjM1IiBkYXRhLXVpZD0ibG5rMjIiIGlkPSJsaW5rX0FwcF9HTU4yMCI+PHBhdGggZD0iTTEyNTkuMTE4Miw3Mi4xNSBDMTI1OS4xNjI4LDcyLjE1IDEyNTkuMjA3NSw3Mi4xNSAxMjU5LjI1MjIsNzIuMTUgQzEyNTkuNjA5NSw3Mi4xNSAxMjU5Ljk2NjgsNzIuMTUgMTI2MC4zMjQxLDcyLjE1IEMxMjYzLjE4MjUsNzIuMTUgMTI2Ni4wNDEzLDcyLjE1IDEyNjguOSw3Mi4xNSBDMTI3NC42MTc1LDcyLjE1IDEyODAuMzM1LDcyLjE1IDEyODYuMDUsNzIuMTUiIGZpbGw9Im5vbmUiIGlkPSJBcHAtR01OMjAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48L2c+PCEtLWxpbmsgSW5mcmEgdG8gR01OMjMtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iSW5mcmEiIGRhdGEtZW50aXR5LTI9IkdNTjIzIiBkYXRhLXNvdXJjZS1saW5lPSI0MiIgZGF0YS11aWQ9ImxuazI1IiBpZD0ibGlua19JbmZyYV9HTU4yMyI+PHBhdGggZD0iTTUwMC4wMjM1LDM1MS40MyBDNTAwLjA2ODcsMzUxLjQzIDUwMC4xMTM4LDM1MS40MyA1MDAuMTU4OSwzNTEuNDMgQzUwMC4yNDkxLDM1MS40MyA1MDAuMzM5NCwzNTEuNDMgNTAwLjQyOTYsMzUxLjQzIEM1MDAuNzkwNSwzNTEuNDMgNTAxLjE1MTQsMzUxLjQzIDUwMS41MTIzLDM1MS40MyBDNTA0LjM5OTcsMzUxLjQzIDUwNy4yODY5LDM1MS40MyA1MTAuMTczNywzNTEuNDMgQzUxNS45NDc1LDM1MS40MyA1MjEuNzIsMzUxLjQzIDUyNy40OSwzNTEuNDMiIGZpbGw9Im5vbmUiIGlkPSJJbmZyYS1HTU4yMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjwvZz48IS0tU1JDPVtWUDlUUW5EMTU4Umx6clRDQXU4RDJCNU9SMl9OUkdFMXNlSThMd01LT0pqZmJZT3hPTlNIZjBaRDcwdEhBWFBBekE4QXNXSFJLcjIyZlhfSXVleXZOS0ZfWEpFSlJCOVJyOWx6RUVfQ0VTenhwZmJPT3FON1BNRy16eTNDQmdyUWtTTFNXVG9PaXdSbHRLeVI0cUZIcEVTWnZRdmJQY1I2SWRPZktwMFpCUEVQY3FzZDNRREF4R3N3cGlXYW1XazRKb1pRMkRfM1Jka0lLOV9DeW1mcnQ2SXpKTUZ2YVMteTVNRXZtN2I1bFBaeVZLbTNYeGxvcC05a2lVcE9XTExZemlSV3M1WFZUMmhFTTdhUWhveHM0VHVYVDUxcTRTdkhkMjBTbjRaQ1FaTmNKMzlPN2dDMVktTU1LMVJyY0tBV2hpdEFWdktVQ2toUDlHTmtadTk5MzZLVmVPZG0xU0tQR2FEX1Y0RWU4UkdZY0FuUno2WVlkUGk5Y3g4N1dTVkJ2VWxzMndwQVZJVld0ZkVMR0hDSjBLS0wzcVdrYm1VQ1VDdndBSTJ5RTlvNmFLZVhWNFJPSFczRExuLTBhYmtwd1BqSmdQSG5jdUhSUkhHVFhCU2VKYjRTUUZ3NlpBQ3VyRXhhWlRSV2dPQW5rUUZlZ1VSM2hhbWZmUWt6VWxfN0N3bnpyUDVKWERVd3I5NC1Tc0dtVHVxZW1ra1NTYk9JaWpfaFhaam5sM2lwR3BvRFZ3eDJtcmNWb0hCemRZcHFJenFHUngyc2Z1X2Z2WWtnT3NMWGoxQnhxNi0gLSAtV192ckxSaHp5eEZWLUJmd0tkMFhVYzU2NXE0UC1RcEtQamF6V19IR1pIWXRDVkhXaHhLLXpoSGRKdEhZVWU4N3lGZFh2U05rejlJa0RzeWw3V191bFczXS0tPjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_20">テストレベル別の詳細戦略<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<h4 id="180">レベル1：ユニットテスト（80%）<a class="headerlink" href="#180" title="Permanent link">&para;</a></h4>
<p><strong>対象</strong>：ドメイン層の各コンポーネント</p>
<p><strong>値オブジェクトのテスト</strong>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">TimeSlotTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">有効な時間枠で作成できる</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">        </span><span class="n">assertThatCode</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TimeSlot</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">doesNotThrowAnyException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">営業時間外は例外が発生する</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// 営業時間前</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">        </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TimeSlot</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">hasMessageContaining</span><span class="p">(</span><span class="s">&quot;営業時間内&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@ParameterizedTest</span>
<span class="w">    </span><span class="nd">@CsvSource</span><span class="p">({</span>
<span class="w">        </span><span class="s">&quot;10:00, 12:00, 11:00, 13:00, true&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1">// 重複あり</span>
<span class="w">        </span><span class="s">&quot;10:00, 12:00, 12:00, 14:00, false&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// 重複なし（境界）</span>
<span class="w">        </span><span class="s">&quot;10:00, 12:00, 14:00, 16:00, false&quot;</span><span class="w">   </span><span class="c1">// 重複なし（離れている）</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">時間枠の重複判定が正しい</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">start1</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">end1</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">start2</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">end2</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">expected</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">slot1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTimeSlot</span><span class="p">(</span><span class="n">start1</span><span class="p">,</span><span class="w"> </span><span class="n">end1</span><span class="p">);</span>
<span class="w">        </span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">slot2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTimeSlot</span><span class="p">(</span><span class="n">start2</span><span class="p">,</span><span class="w"> </span><span class="n">end2</span><span class="p">);</span>

<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">slot1</span><span class="p">.</span><span class="na">overlaps</span><span class="p">(</span><span class="n">slot2</span><span class="p">)).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">expected</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>エンティティのテスト</strong>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">ReservationTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">予約作成時は確定状態になる</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createValidReservation</span><span class="p">();</span>

<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">reservation</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">ReservationStatus</span><span class="p">.</span><span class="na">CONFIRMED</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">reservation</span><span class="p">.</span><span class="na">getId</span><span class="p">()).</span><span class="na">isNotNull</span><span class="p">();</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">reservation</span><span class="p">.</span><span class="na">getCreatedAt</span><span class="p">()).</span><span class="na">isBeforeOrEqualTo</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">変更可能な予約はタイトルを変更できる</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createFutureReservation</span><span class="p">();</span>
<span class="w">        </span><span class="n">ReservationTitle</span><span class="w"> </span><span class="n">newTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="p">(</span><span class="s">&quot;新しいタイトル&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">reservation</span><span class="p">.</span><span class="na">changeTitle</span><span class="p">(</span><span class="n">newTitle</span><span class="p">);</span>

<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">reservation</span><span class="p">.</span><span class="na">getTitle</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">newTitle</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">開始2時間前を過ぎた予約は変更できない</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createNearFutureReservation</span><span class="p">();</span><span class="w"> </span><span class="c1">// 1時間後開始</span>

<span class="w">        </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">reservation</span><span class="p">.</span><span class="na">changeTitle</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="p">(</span><span class="s">&quot;新タイトル&quot;</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">hasMessageContaining</span><span class="p">(</span><span class="s">&quot;2時間前まで&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">キャンセルされた予約は再キャンセルできない</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createValidReservation</span><span class="p">();</span>
<span class="w">        </span><span class="n">reservation</span><span class="p">.</span><span class="na">cancel</span><span class="p">();</span><span class="w"> </span><span class="c1">// 一度キャンセル</span>

<span class="w">        </span><span class="n">assertThatThrownBy</span><span class="p">(</span><span class="n">reservation</span><span class="p">::</span><span class="n">cancel</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>ドメインサービスのテスト</strong>
<div class="highlight"><pre><span></span><code><span class="nd">@ExtendWith</span><span class="p">(</span><span class="n">MockitoExtension</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">ConflictCheckerTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Mock</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ReservationRepository</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ConflictChecker</span><span class="w"> </span><span class="n">conflictChecker</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">conflictChecker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConflictChecker</span><span class="p">(</span><span class="n">reservationRepository</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">重複する予約がない場合はfalseを返す</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">RoomId</span><span class="w"> </span><span class="n">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">();</span>
<span class="w">        </span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">newTimeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTimeSlot</span><span class="p">(</span><span class="s">&quot;10:00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;12:00&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">when</span><span class="p">(</span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">findActiveByRoomId</span><span class="p">(</span><span class="n">roomId</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasConflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conflictChecker</span><span class="p">.</span><span class="na">hasConflict</span><span class="p">(</span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">newTimeSlot</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">hasConflict</span><span class="p">).</span><span class="na">isFalse</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">完全に重複する場合はtrueを返す</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">RoomId</span><span class="w"> </span><span class="n">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">();</span>
<span class="w">        </span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">newTimeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTimeSlot</span><span class="p">(</span><span class="s">&quot;10:00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;12:00&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">existingReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createReservationWithTimeSlot</span><span class="p">(</span><span class="s">&quot;10:00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;12:00&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">when</span><span class="p">(</span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">findActiveByRoomId</span><span class="p">(</span><span class="n">roomId</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">existingReservation</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasConflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conflictChecker</span><span class="p">.</span><span class="na">hasConflict</span><span class="p">(</span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">newTimeSlot</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">hasConflict</span><span class="p">).</span><span class="na">isTrue</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">部分的に重複する場合はtrueを返す</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">RoomId</span><span class="w"> </span><span class="n">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">();</span>
<span class="w">        </span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">newTimeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTimeSlot</span><span class="p">(</span><span class="s">&quot;10:00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;12:00&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">existingReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createReservationWithTimeSlot</span><span class="p">(</span><span class="s">&quot;11:00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;13:00&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">when</span><span class="p">(</span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">findActiveByRoomId</span><span class="p">(</span><span class="n">roomId</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">existingReservation</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasConflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conflictChecker</span><span class="p">.</span><span class="na">hasConflict</span><span class="p">(</span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">newTimeSlot</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">hasConflict</span><span class="p">).</span><span class="na">isTrue</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="215">レベル2：統合テスト（15%）<a class="headerlink" href="#215" title="Permanent link">&para;</a></h4>
<p><strong>対象</strong>：アプリケーション層とインフラストラクチャ層の連携</p>
<p><strong>ユースケースの統合テスト</strong>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@Transactional</span>
<span class="kd">class</span> <span class="nc">CreateReservationUseCaseIntegrationTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:15&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CreateReservationUseCase</span><span class="w"> </span><span class="n">createReservationUseCase</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserRepository</span><span class="w"> </span><span class="n">userRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RoomRepository</span><span class="w"> </span><span class="n">roomRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ReservationRepository</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">有効な条件で予約を作成できる</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createAndSaveTestUser</span><span class="p">();</span>
<span class="w">        </span><span class="n">Room</span><span class="w"> </span><span class="n">room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createAndSaveTestRoom</span><span class="p">();</span>

<span class="w">        </span><span class="n">CreateReservationCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateReservationCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">userId</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">roomId</span><span class="p">(</span><span class="n">room</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">title</span><span class="p">(</span><span class="s">&quot;定例会議&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">purpose</span><span class="p">(</span><span class="s">&quot;週次定例会議&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">startTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">withHour</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="na">withMinute</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">endTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">withHour</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="na">withMinute</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="n">ReservationId</span><span class="w"> </span><span class="n">reservationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createReservationUseCase</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">reservationId</span><span class="p">).</span><span class="na">isNotNull</span><span class="p">();</span>

<span class="w">        </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">savedReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">reservationId</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">savedReservation</span><span class="p">).</span><span class="na">isPresent</span><span class="p">();</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">savedReservation</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getUserId</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">savedReservation</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getRoomId</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">room</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">savedReservation</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getStatus</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">ReservationStatus</span><span class="p">.</span><span class="na">CONFIRMED</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">重複する時間帯の予約は失敗する</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createAndSaveTestUser</span><span class="p">();</span>
<span class="w">        </span><span class="n">Room</span><span class="w"> </span><span class="n">room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createAndSaveTestRoom</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 既存の予約を作成</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">withHour</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="na">withMinute</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">endTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">withHour</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="na">withMinute</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">createAndSaveReservation</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">startTime</span><span class="p">,</span><span class="w"> </span><span class="n">endTime</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 重複する新しい予約</span>
<span class="w">        </span><span class="n">CreateReservationCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateReservationCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">userId</span><span class="p">(</span><span class="n">UserId</span><span class="p">.</span><span class="na">generate</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">roomId</span><span class="p">(</span><span class="n">room</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">startTime</span><span class="p">(</span><span class="n">startTime</span><span class="p">.</span><span class="na">plusMinutes</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span><span class="w"> </span><span class="c1">// 30分後開始（重複）</span>
<span class="w">            </span><span class="p">.</span><span class="na">endTime</span><span class="p">(</span><span class="n">endTime</span><span class="p">.</span><span class="na">plusMinutes</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">title</span><span class="p">(</span><span class="s">&quot;別の会議&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">purpose</span><span class="p">(</span><span class="s">&quot;別の用途&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When &amp; Then</span>
<span class="w">        </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">createReservationUseCase</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">ReservationConflictException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">同時予約数制限を超える場合は失敗する</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createAndSaveTestUser</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// ユーザーに既に3件の予約を作成（上限まで）</span>
<span class="w">        </span><span class="n">createMaxReservationsForUser</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>

<span class="w">        </span><span class="n">CreateReservationCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateReservationCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">userId</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">roomId</span><span class="p">(</span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">startTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="na">withHour</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="na">withMinute</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">endTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="na">withHour</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="na">withMinute</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">title</span><span class="p">(</span><span class="s">&quot;4件目の予約&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">purpose</span><span class="p">(</span><span class="s">&quot;制限超過テスト&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When &amp; Then</span>
<span class="w">        </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">createReservationUseCase</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">ReservationLimitExceededException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>リポジトリの統合テスト</strong>
<div class="highlight"><pre><span></span><code><span class="nd">@DataJpaTest</span>
<span class="nd">@Testcontainers</span>
<span class="kd">class</span> <span class="nc">ReservationRepositoryIntegrationTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:15&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TestEntityManager</span><span class="w"> </span><span class="n">entityManager</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ReservationRepository</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">アクティブな予約のみ取得される</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="p">.</span><span class="na">generate</span><span class="p">();</span>
<span class="w">        </span><span class="n">RoomId</span><span class="w"> </span><span class="n">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">();</span>

<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">activeReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createReservation</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">ReservationStatus</span><span class="p">.</span><span class="na">CONFIRMED</span><span class="p">);</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">cancelledReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createReservation</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">ReservationStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">);</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">completedReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createReservation</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">ReservationStatus</span><span class="p">.</span><span class="na">COMPLETED</span><span class="p">);</span>

<span class="w">        </span><span class="n">entityManager</span><span class="p">.</span><span class="na">persistAndFlush</span><span class="p">(</span><span class="n">activeReservation</span><span class="p">);</span>
<span class="w">        </span><span class="n">entityManager</span><span class="p">.</span><span class="na">persistAndFlush</span><span class="p">(</span><span class="n">cancelledReservation</span><span class="p">);</span>
<span class="w">        </span><span class="n">entityManager</span><span class="p">.</span><span class="na">persistAndFlush</span><span class="p">(</span><span class="n">completedReservation</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">activeReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">findActiveByUserId</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">activeReservations</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">activeReservations</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getId</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">activeReservation</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">指定日時範囲の予約が取得される</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">RoomId</span><span class="w"> </span><span class="n">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">();</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">targetDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">);</span>

<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">targetDateReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createReservationOnDate</span><span class="p">(</span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">targetDate</span><span class="p">);</span>
<span class="w">        </span><span class="n">Reservation</span><span class="w"> </span><span class="n">otherDateReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createReservationOnDate</span><span class="p">(</span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">targetDate</span><span class="p">.</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

<span class="w">        </span><span class="n">entityManager</span><span class="p">.</span><span class="na">persistAndFlush</span><span class="p">(</span><span class="n">targetDateReservation</span><span class="p">);</span>
<span class="w">        </span><span class="n">entityManager</span><span class="p">.</span><span class="na">persistAndFlush</span><span class="p">(</span><span class="n">otherDateReservation</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">reservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">findActiveByRoomIdAndDate</span><span class="p">(</span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">targetDate</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">reservations</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">reservations</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getId</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">targetDateReservation</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="3e2e5">レベル3：E2Eテスト（5%）<a class="headerlink" href="#3e2e5" title="Permanent link">&para;</a></h4>
<p><strong>対象</strong>：システム全体のユーザーシナリオ</p>
<p><strong>APIエンドポイントのE2Eテスト</strong>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@AutoConfigureMockMvc</span>
<span class="kd">class</span> <span class="nc">ReservationApiE2ETest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:15&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MockMvc</span><span class="w"> </span><span class="n">mockMvc</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="nd">@WithMockUser</span><span class="p">(</span><span class="n">roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MEMBER&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">予約作成から確認までの一連の流れ</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given - テストデータを準備</span>
<span class="w">        </span><span class="n">setupTestData</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When 1 - 利用可能な会議室を検索</span>
<span class="w">        </span><span class="n">MvcResult</span><span class="w"> </span><span class="n">searchResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mockMvc</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/rooms/search&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">param</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2024-01-15&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">param</span><span class="p">(</span><span class="s">&quot;startTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;10:00&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">param</span><span class="p">(</span><span class="s">&quot;endTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;12:00&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">param</span><span class="p">(</span><span class="s">&quot;minCapacity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;5&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">isOk</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">andReturn</span><span class="p">();</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">RoomSearchResult</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rooms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">readValue</span><span class="p">(</span>
<span class="w">            </span><span class="n">searchResult</span><span class="p">.</span><span class="na">getResponse</span><span class="p">().</span><span class="na">getContentAsString</span><span class="p">(),</span><span class="w"> </span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">TypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">RoomSearchResult</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{});</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">rooms</span><span class="p">).</span><span class="na">isNotEmpty</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When 2 - 会議室を予約</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rooms</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getRoomId</span><span class="p">();</span>
<span class="w">        </span><span class="n">CreateReservationRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateReservationRequest</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">roomId</span><span class="p">(</span><span class="n">roomId</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">title</span><span class="p">(</span><span class="s">&quot;定例会議&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">purpose</span><span class="p">(</span><span class="s">&quot;週次定例会議&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">startTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">endTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="n">MvcResult</span><span class="w"> </span><span class="n">createResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mockMvc</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">post</span><span class="p">(</span><span class="s">&quot;/api/reservations&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">content</span><span class="p">(</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">request</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">isCreated</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">andReturn</span><span class="p">();</span>

<span class="w">        </span><span class="n">ReservationResponse</span><span class="w"> </span><span class="n">createdReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">readValue</span><span class="p">(</span>
<span class="w">            </span><span class="n">createResult</span><span class="p">.</span><span class="na">getResponse</span><span class="p">().</span><span class="na">getContentAsString</span><span class="p">(),</span><span class="w"> </span>
<span class="w">            </span><span class="n">ReservationResponse</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// When 3 - 作成した予約を確認</span>
<span class="w">        </span><span class="n">mockMvc</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/reservations/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">createdReservation</span><span class="p">.</span><span class="na">getReservationId</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">isOk</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">jsonPath</span><span class="p">(</span><span class="s">&quot;$.title&quot;</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="s">&quot;定例会議&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">jsonPath</span><span class="p">(</span><span class="s">&quot;$.status&quot;</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="s">&quot;CONFIRMED&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">jsonPath</span><span class="p">(</span><span class="s">&quot;$.roomId&quot;</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="n">roomId</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// When 4 - ユーザーの予約一覧を確認</span>
<span class="w">        </span><span class="n">mockMvc</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/reservations/my&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpected</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">isOk</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">jsonPath</span><span class="p">(</span><span class="s">&quot;$&quot;</span><span class="p">).</span><span class="na">isArray</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">jsonPath</span><span class="p">(</span><span class="s">&quot;$[0].reservationId&quot;</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="n">createdReservation</span><span class="p">.</span><span class="na">getReservationId</span><span class="p">()));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="nd">@WithMockUser</span><span class="p">(</span><span class="n">roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MEMBER&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">予約キャンセルの一連の流れ</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given - 事前に予約を作成</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">reservationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestReservation</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When 1 - 予約をキャンセル</span>
<span class="w">        </span><span class="n">mockMvc</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;/api/reservations/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">reservationId</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpected</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">isNoContent</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Then - キャンセル状態になっていることを確認</span>
<span class="w">        </span><span class="n">mockMvc</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/reservations/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">reservationId</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpected</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">isOk</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">jsonPath</span><span class="p">(</span><span class="s">&quot;$.status&quot;</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="s">&quot;CANCELLED&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="nd">@WithMockUser</span><span class="p">(</span><span class="n">roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MEMBER&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">重複予約のエラーハンドリング</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given - 既存の予約を作成</span>
<span class="w">        </span><span class="n">createTestReservationAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// When - 重複する時間で予約を試行</span>
<span class="w">        </span><span class="n">CreateReservationRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateReservationRequest</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">roomId</span><span class="p">(</span><span class="s">&quot;test-room-id&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">title</span><span class="p">(</span><span class="s">&quot;重複する会議&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">purpose</span><span class="p">(</span><span class="s">&quot;重複テスト&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">startTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="c1">// 1時間後開始（重複）</span>
<span class="w">            </span><span class="p">.</span><span class="na">endTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Then - 適切なエラーレスポンスが返される</span>
<span class="w">        </span><span class="n">mockMvc</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">post</span><span class="p">(</span><span class="s">&quot;/api/reservations&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">content</span><span class="p">(</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">request</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">status</span><span class="p">().</span><span class="na">isConflict</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">jsonPath</span><span class="p">(</span><span class="s">&quot;$.error&quot;</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="s">&quot;RESERVATION_CONFLICT&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">andExpect</span><span class="p">(</span><span class="n">jsonPath</span><span class="p">(</span><span class="s">&quot;$.message&quot;</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="s">&quot;指定時間は既に予約されています&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_21">テスト実行戦略<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<h4 id="ci">継続的インテグレーション（CI）<a class="headerlink" href="#ci" title="Permanent link">&para;</a></h4>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjQ1NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NTg1cHg7aGVpZ2h0OjQ1NHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDU4NSA0NTQiIHdpZHRoPSI1ODVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxlbGxpcHNlIGN4PSIzNTguMDcwNiIgY3k9IjIwIiBmaWxsPSIjMjIyMjIyIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSIzMjQuMDcwNCIgeT0iNTAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSIzMzQuMDcwNCIgeT0iNzEuMTM4NyI+JiMxMjQ2NzsmIzEyNTExOyYjMTI0ODM7JiMxMjQ4ODs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOC4wMDA4IiB4PSIyOTQuMDcwMSIgeT0iMTAzLjk2ODgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDguMDAwOCIgeD0iMzA0LjA3MDEiIHk9IjEyNS4xMDc0Ij4mIzEyNTE4OyYjMTI0OTE7JiMxMjQ4MzsmIzEyNDg4OyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMjM0NTU7JiMzNDg5Mjs8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIzMDUuNjUxNywxNTcuOTM3NSw0MTAuNDg5NCwxNTcuOTM3NSw0MjIuNDg5NCwxNjkuOTM3NSw0MTAuNDg5NCwxODEuOTM3NSwzMDUuNjUxNywxODEuOTM3NSwyOTMuNjUxNywxNjkuOTM3NSwzMDUuNjUxNywxNTcuOTM3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjgzNzciIHg9IjMwNS42NTE3IiB5PSIxNzMuNzQ1NiI+JiMxMjUxODsmIzEyNDkxOyYjMTI0ODM7JiMxMjQ4ODsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsmIzI1MTA0OyYjMjExNTE7PzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOS4wMDgzIiB4PSIyNzQuNjQzNCIgeT0iMTY3LjM0MzMiPnllczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMy43MDE3IiB4PSI0MjIuNDg5NCIgeT0iMTY3LjM0MzMiPm5vPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDQuMDAwNiIgeD0iMTY2LjAwMjYiIHk9IjE5MS45Mzc1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODQuMDAwNiIgeD0iMTc2LjAwMjYiIHk9IjIxMy4wNzYyIj4mIzMyMTEzOyYjMjE1MTI7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7JiMyMzQ1NTsmIzM0ODkyOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjE3Ni41ODQsMjQ1LjkwNjMsMjU5LjQyMTksMjQ1LjkwNjMsMjcxLjQyMTksMjU3LjkwNjMsMjU5LjQyMTksMjY5LjkwNjMsMTc2LjU4NCwyNjkuOTA2MywxNjQuNTg0LDI1Ny45MDYzLDE3Ni41ODQsMjQ1LjkwNjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgyLjgzNzgiIHg9IjE3Ni41ODQiIHk9IjI2MS43MTQ0Ij4mIzMyMTEzOyYjMjE1MTI7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7JiMyNTEwNDsmIzIxMTUxOz88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkuMDA4MyIgeD0iMTQ1LjU3NTciIHk9IjI1NS4zMTIiPnllczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMy43MDE3IiB4PSIyNzEuNDIxOSIgeT0iMjU1LjMxMiI+bm88L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwMi43OTkzIiB4PSI1Ni40NjkiIHk9IjI3OS45MDYzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODIuNzk5MyIgeD0iNjYuNDY5IiB5PSIzMDEuMDQ0OSI+RTJFJiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7JiMyMzQ1NTsmIzM0ODkyOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjY3LjAwMDIsMzMzLjg3NSwxNDguNzM3MSwzMzMuODc1LDE2MC43MzcxLDM0NS44NzUsMTQ4LjczNzEsMzU3Ljg3NSw2Ny4wMDAyLDM1Ny44NzUsNTUuMDAwMiwzNDUuODc1LDY3LjAwMDIsMzMzLjg3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODEuNzM2OSIgeD0iNjcuMDAwMiIgeT0iMzQ5LjY4MzEiPkUyRSYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMjUxMDQ7JiMyMTE1MTs/PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5LjAwODMiIHg9IjM1Ljk5MTkiIHk9IjM0My4yODA4Ij55ZXM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMuNzAxNyIgeD0iMTYwLjczNzEiIHk9IjM0My4yODA4Ij5ubzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjguMDAwNCIgeD0iMTEiIHk9IjM2Ny44NzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSIyMSIgeT0iMzg5LjAxMzciPiYjMTI0ODc7JiMxMjUwMzsmIzEyNTI1OyYjMTI0NTI7PC90ZXh0PjxlbGxpcHNlIGN4PSI0NS4wMDAyIiBjeT0iNDMyLjg0MzgiIGZpbGw9Im5vbmUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGVsbGlwc2UgY3g9IjQ1LjAwMDIiIGN5PSI0MzIuODQzOCIgZmlsbD0iIzIyMjIyMiIgcng9IjYiIHJ5PSI2IiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyNi43OTk1IiB4PSIxMDcuMzM3NCIgeT0iMzY3Ljg3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNi43OTk1IiB4PSIxMTcuMzM3NCIgeT0iMzg5LjAxMzciPkUyRSYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMjI4MzM7JiMyNTk0MzsmIzM2ODkwOyYjMzA2OTM7PC90ZXh0PjxlbGxpcHNlIGN4PSIxNzAuNzM3MSIgY3k9IjQzMi44NDM4IiBmaWxsPSJub25lIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxlbGxpcHNlIGN4PSIxNzAuNzM3MSIgY3k9IjQzMi44NDM4IiBmaWxsPSIjMjIyMjIyIiByeD0iNiIgcnk9IjYiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI4LjAwMDgiIHg9IjI2NC4xMzY4IiB5PSIyNzkuOTA2MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC4wMDA4IiB4PSIyNzQuMTM2OCIgeT0iMzAxLjA0NDkiPiYjMzIxMTM7JiMyMTUxMjsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsmIzIyODMzOyYjMjU5NDM7JiMzNjg5MDsmIzMwNjkzOzwvdGV4dD48ZWxsaXBzZSBjeD0iMzI4LjEzNzMiIGN5PSIzNDQuODc1IiBmaWxsPSJub25lIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxlbGxpcHNlIGN4PSIzMjguMTM3MyIgY3k9IjM0NC44NzUiIGZpbGw9IiMyMjIyMjIiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTIuMDAxIiB4PSI0MjIuMTM3NyIgeT0iMTkxLjkzNzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzIuMDAxIiB4PSI0MzIuMTM3NyIgeT0iMjEzLjA3NjIiPiYjMTI1MTg7JiMxMjQ5MTsmIzEyNDgzOyYjMTI0ODg7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7JiMyMjgzMzsmIzI1OTQzOyYjMzY4OTA7JiMzMDY5Mzs8L3RleHQ+PGVsbGlwc2UgY3g9IjQ5OC4xMzgyIiBjeT0iMjU2LjkwNjMiIGZpbGw9Im5vbmUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGVsbGlwc2UgY3g9IjQ5OC4xMzgyIiBjeT0iMjU2LjkwNjMiIGZpbGw9IiMyMjIyMjIiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzNTguMDcwNiIgeDI9IjM1OC4wNzA2IiB5MT0iMzAiIHkyPSI1MCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzU0LjA3MDYsNDAsMzU4LjA3MDYsNTAsMzYyLjA3MDYsNDAsMzU4LjA3MDYsNDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzU4LjA3MDYiIHgyPSIzNTguMDcwNiIgeTE9IjgzLjk2ODgiIHkyPSIxMDMuOTY4OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzU0LjA3MDYsOTMuOTY4OCwzNTguMDcwNiwxMDMuOTY4OCwzNjIuMDcwNiw5My45Njg4LDM1OC4wNzA2LDk3Ljk2ODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDUuMDAwMiIgeDI9IjQ1LjAwMDIiIHkxPSI0MDEuODQzOCIgeTI9IjQyMS44NDM4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MS4wMDAyLDQxMS44NDM4LDQ1LjAwMDIsNDIxLjg0MzgsNDkuMDAwMiw0MTEuODQzOCw0NS4wMDAyLDQxNS44NDM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE3MC43MzcxIiB4Mj0iMTcwLjczNzEiIHkxPSI0MDEuODQzOCIgeTI9IjQyMS44NDM4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjYuNzM3MSw0MTEuODQzOCwxNzAuNzM3MSw0MjEuODQzOCwxNzQuNzM3MSw0MTEuODQzOCwxNzAuNzM3MSw0MTUuODQzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1NS4wMDAyIiB4Mj0iNDUuMDAwMiIgeTE9IjM0NS44NzUiIHkyPSIzNDUuODc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ1LjAwMDIiIHgyPSI0NS4wMDAyIiB5MT0iMzQ1Ljg3NSIgeTI9IjM2Ny44NzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQxLjAwMDIsMzU3Ljg3NSw0NS4wMDAyLDM2Ny44NzUsNDkuMDAwMiwzNTcuODc1LDQ1LjAwMDIsMzYxLjg3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNjAuNzM3MSIgeDI9IjE3MC43MzcxIiB5MT0iMzQ1Ljg3NSIgeTI9IjM0NS44NzUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTcwLjczNzEiIHgyPSIxNzAuNzM3MSIgeTE9IjM0NS44NzUiIHkyPSIzNjcuODc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjYuNzM3MSwzNTcuODc1LDE3MC43MzcxLDM2Ny44NzUsMTc0LjczNzEsMzU3Ljg3NSwxNzAuNzM3MSwzNjEuODc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEwNy44Njg2IiB4Mj0iMTA3Ljg2ODYiIHkxPSIzMTMuODc1IiB5Mj0iMzMzLjg3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTAzLjg2ODYsMzIzLjg3NSwxMDcuODY4NiwzMzMuODc1LDExMS44Njg2LDMyMy44NzUsMTA3Ljg2ODYsMzI3Ljg3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMjguMTM3MyIgeDI9IjMyOC4xMzczIiB5MT0iMzEzLjg3NSIgeTI9IjMzMy44NzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMyNC4xMzczLDMyMy44NzUsMzI4LjEzNzMsMzMzLjg3NSwzMzIuMTM3MywzMjMuODc1LDMyOC4xMzczLDMyNy44NzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTY0LjU4NCIgeDI9IjEwNy44Njg2IiB5MT0iMjU3LjkwNjMiIHkyPSIyNTcuOTA2MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDcuODY4NiIgeDI9IjEwNy44Njg2IiB5MT0iMjU3LjkwNjMiIHkyPSIyNzkuOTA2MyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTAzLjg2ODYsMjY5LjkwNjMsMTA3Ljg2ODYsMjc5LjkwNjMsMTExLjg2ODYsMjY5LjkwNjMsMTA3Ljg2ODYsMjczLjkwNjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjcxLjQyMTkiIHgyPSIzMjguMTM3MyIgeTE9IjI1Ny45MDYzIiB5Mj0iMjU3LjkwNjMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzI4LjEzNzMiIHgyPSIzMjguMTM3MyIgeTE9IjI1Ny45MDYzIiB5Mj0iMjc5LjkwNjMiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMyNC4xMzczLDI2OS45MDYzLDMyOC4xMzczLDI3OS45MDYzLDMzMi4xMzczLDI2OS45MDYzLDMyOC4xMzczLDI3My45MDYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjIxOC4wMDI5IiB4Mj0iMjE4LjAwMjkiIHkxPSIyMjUuOTA2MyIgeTI9IjI0NS45MDYzIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMTQuMDAyOSwyMzUuOTA2MywyMTguMDAyOSwyNDUuOTA2MywyMjIuMDAyOSwyMzUuOTA2MywyMTguMDAyOSwyMzkuOTA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0OTguMTM4MiIgeDI9IjQ5OC4xMzgyIiB5MT0iMjI1LjkwNjMiIHkyPSIyNDUuOTA2MyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDk0LjEzODIsMjM1LjkwNjMsNDk4LjEzODIsMjQ1LjkwNjMsNTAyLjEzODIsMjM1LjkwNjMsNDk4LjEzODIsMjM5LjkwNjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjkzLjY1MTciIHgyPSIyMTguMDAyOSIgeTE9IjE2OS45Mzc1IiB5Mj0iMTY5LjkzNzUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjE4LjAwMjkiIHgyPSIyMTguMDAyOSIgeTE9IjE2OS45Mzc1IiB5Mj0iMTkxLjkzNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIxNC4wMDI5LDE4MS45Mzc1LDIxOC4wMDI5LDE5MS45Mzc1LDIyMi4wMDI5LDE4MS45Mzc1LDIxOC4wMDI5LDE4NS45Mzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQyMi40ODk0IiB4Mj0iNDk4LjEzODIiIHkxPSIxNjkuOTM3NSIgeTI9IjE2OS45Mzc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ5OC4xMzgyIiB4Mj0iNDk4LjEzODIiIHkxPSIxNjkuOTM3NSIgeTI9IjE5MS45Mzc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0OTQuMTM4MiwxODEuOTM3NSw0OTguMTM4MiwxOTEuOTM3NSw1MDIuMTM4MiwxODEuOTM3NSw0OTguMTM4MiwxODUuOTM3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzNTguMDcwNiIgeDI9IjM1OC4wNzA2IiB5MT0iMTM3LjkzNzUiIHkyPSIxNTcuOTM3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzU0LjA3MDYsMTQ3LjkzNzUsMzU4LjA3MDYsMTU3LjkzNzUsMzYyLjA3MDYsMTQ3LjkzNzUsMzU4LjA3MDYsMTUxLjkzNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48IS0tU1JDPVtBb3Y5QjJoWHVoOXd0Qkp2U1ZGeW55dERadml4aDg3U3ZjTUZjeGlYdENWRFJPLVJUVzhQSnpWRFZ4Nm1udmdCQXBEREdHRWhZY1NUNHZ2c3BSVk5MMlo5SUNySnFBWENCVFJhaWRnLVRVRkoyUFljVzBuMWF5QWd0VE44NVFqVVA3Nmk2WHl0anB6a2Rsd3VVVXRaZllOTU5DS2ItR0xTZ0pkNWdHZVFVVmRlbll4UC02cGd6OVNEaXZ4Rk5tZkpjUFVJY09RaTdqcU5INloxN2VXdUQwODBdLS0+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h4 id="_22">テスト実行時間の目標<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>ユニットテスト</strong>: 30秒以内</li>
<li><strong>統合テスト</strong>: 2分以内  </li>
<li><strong>E2Eテスト</strong>: 10分以内</li>
<li><strong>全テスト</strong>: 15分以内</li>
</ul>
<h4 id="_23">並列実行戦略<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code># .github/workflows/test.yml
name: Test
on: [push, pull_request]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: &#39;21&#39;
      - run: ./mvnw test -Dtest=&quot;**/*Test&quot; # ユニットテストのみ

  integration-tests:
    runs-on: ubuntu-latest
    needs: unit-tests
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: &#39;21&#39;
      - run: ./mvnw test -Dtest=&quot;**/*IntegrationTest&quot;

  e2e-tests:
    runs-on: ubuntu-latest
    needs: integration-tests
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: &#39;21&#39;
      - run: ./mvnw test -Dtest=&quot;**/*E2ETest&quot;
</code></pre></div>
<h2 id="_24">テストデータ管理<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h2>
<h3 id="_25">テストデータ戦略<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<h4 id="_26">テストフィクスチャ<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h4>
<p><strong>Object Mother パターン</strong>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReservationFixture</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Reservation</span><span class="w"> </span><span class="nf">validReservation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Reservation</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">UserFixture</span><span class="p">.</span><span class="na">defaultUserId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">RoomFixture</span><span class="p">.</span><span class="na">defaultRoomId</span><span class="p">(),</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="p">(</span><span class="s">&quot;定例会議&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">Purpose</span><span class="p">(</span><span class="s">&quot;週次定例会議&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">TimeSlotFixture</span><span class="p">.</span><span class="na">tomorrowMorning</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Reservation</span><span class="w"> </span><span class="nf">reservationStartingAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">startTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Reservation</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">UserFixture</span><span class="p">.</span><span class="na">defaultUserId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">RoomFixture</span><span class="p">.</span><span class="na">defaultRoomId</span><span class="p">(),</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="p">(</span><span class="s">&quot;会議&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">Purpose</span><span class="p">(</span><span class="s">&quot;テスト用&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">TimeSlot</span><span class="p">(</span><span class="n">startTime</span><span class="p">,</span><span class="w"> </span><span class="n">startTime</span><span class="p">.</span><span class="na">plusHours</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Reservation</span><span class="w"> </span><span class="nf">pastReservation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Reservation</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">UserFixture</span><span class="p">.</span><span class="na">defaultUserId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">RoomFixture</span><span class="p">.</span><span class="na">defaultRoomId</span><span class="p">(),</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="p">(</span><span class="s">&quot;過去の会議&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">Purpose</span><span class="p">(</span><span class="s">&quot;過去のテスト&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">TimeSlotFixture</span><span class="p">.</span><span class="na">yesterday</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TimeSlotFixture</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">TimeSlot</span><span class="w"> </span><span class="nf">tomorrowMorning</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">withHour</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="na">withMinute</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TimeSlot</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="p">.</span><span class="na">plusHours</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">TimeSlot</span><span class="w"> </span><span class="nf">yesterday</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">minusDays</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">withHour</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="na">withMinute</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TimeSlot</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="p">.</span><span class="na">plusHours</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">TimeSlot</span><span class="w"> </span><span class="nf">nextWeek</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusWeeks</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">withHour</span><span class="p">(</span><span class="mi">14</span><span class="p">).</span><span class="na">withMinute</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TimeSlot</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="p">.</span><span class="na">plusHours</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="_27">テストビルダーパターン<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ReservationTestDataBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserFixture</span><span class="p">.</span><span class="na">defaultUserId</span><span class="p">();</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RoomId</span><span class="w"> </span><span class="n">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoomFixture</span><span class="p">.</span><span class="na">defaultRoomId</span><span class="p">();</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="p">(</span><span class="s">&quot;テスト会議&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Purpose</span><span class="w"> </span><span class="n">purpose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Purpose</span><span class="p">(</span><span class="s">&quot;テスト用途&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TimeSlotFixture</span><span class="p">.</span><span class="na">tomorrowMorning</span><span class="p">();</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ReservationTestDataBuilder</span><span class="w"> </span><span class="nf">withUserId</span><span class="p">(</span><span class="n">UserId</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ReservationTestDataBuilder</span><span class="w"> </span><span class="nf">withRoomId</span><span class="p">(</span><span class="n">RoomId</span><span class="w"> </span><span class="n">roomId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roomId</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ReservationTestDataBuilder</span><span class="w"> </span><span class="nf">withTitle</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTitle</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ReservationTestDataBuilder</span><span class="w"> </span><span class="nf">withTimeSlot</span><span class="p">(</span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">timeSlot</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timeSlot</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ReservationTestDataBuilder</span><span class="w"> </span><span class="nf">startingAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">startTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TimeSlot</span><span class="p">(</span><span class="n">startTime</span><span class="p">,</span><span class="w"> </span><span class="n">startTime</span><span class="p">.</span><span class="na">plusHours</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Reservation</span><span class="w"> </span><span class="nf">build</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Reservation</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">purpose</span><span class="p">,</span><span class="w"> </span><span class="n">timeSlot</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 使用例</span>
<span class="nd">@Test</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">特定の条件でのテスト</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Reservation</span><span class="w"> </span><span class="n">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReservationTestDataBuilder</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">withTitle</span><span class="p">(</span><span class="s">&quot;重要な会議&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">startingAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// テスト実行...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_28">データベーステストでのデータ管理<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<h4 id="testcontainers">Testcontainers によるデータベース環境<a class="headerlink" href="#testcontainers" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span>
<span class="nd">@Testcontainers</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DatabaseTestBase</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:15&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withDatabaseName</span><span class="p">(</span><span class="s">&quot;testdb&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withUsername</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withPassword</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withInitScript</span><span class="p">(</span><span class="s">&quot;test-schema.sql&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@DynamicPropertySource</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureProperties</span><span class="p">(</span><span class="n">DynamicPropertyRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.url&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getJdbcUrl</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.username&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getUsername</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.password&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getPassword</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_29">トランザクショナルテスト<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span>
<span class="nd">@Transactional</span>
<span class="nd">@Rollback</span>
<span class="kd">class</span> <span class="nc">TransactionalIntegrationTest</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DatabaseTestBase</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">データ変更テスト</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// テスト内でのデータ変更は自動でロールバックされる</span>
<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span>
<span class="w">        </span><span class="n">userRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// テスト実行...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_30">モックとスタブの活用<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h2>
<h3 id="_31">モッキング戦略<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<h4 id="_32">依存関係の分離<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@ExtendWith</span><span class="p">(</span><span class="n">MockitoExtension</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">CreateReservationUseCaseTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Mock</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">UserRepository</span><span class="w"> </span><span class="n">userRepository</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Mock</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">RoomRepository</span><span class="w"> </span><span class="n">roomRepository</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Mock</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">ReservationRepository</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Mock</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">ConflictChecker</span><span class="w"> </span><span class="n">conflictChecker</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Mock</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">ReservationLimitChecker</span><span class="w"> </span><span class="n">limitChecker</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@InjectMocks</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CreateReservationService</span><span class="w"> </span><span class="n">useCase</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">正常な予約作成</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserFixture</span><span class="p">.</span><span class="na">activeMember</span><span class="p">();</span>
<span class="w">        </span><span class="n">Room</span><span class="w"> </span><span class="n">room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoomFixture</span><span class="p">.</span><span class="na">availableRoom</span><span class="p">();</span>

<span class="w">        </span><span class="n">when</span><span class="p">(</span><span class="n">userRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">any</span><span class="p">(</span><span class="n">UserId</span><span class="p">.</span><span class="na">class</span><span class="p">))).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">user</span><span class="p">));</span>
<span class="w">        </span><span class="n">when</span><span class="p">(</span><span class="n">roomRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">any</span><span class="p">(</span><span class="n">RoomId</span><span class="p">.</span><span class="na">class</span><span class="p">))).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">room</span><span class="p">));</span>
<span class="w">        </span><span class="n">when</span><span class="p">(</span><span class="n">conflictChecker</span><span class="p">.</span><span class="na">hasConflict</span><span class="p">(</span><span class="n">any</span><span class="p">(),</span><span class="w"> </span><span class="n">any</span><span class="p">())).</span><span class="na">thenReturn</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="n">when</span><span class="p">(</span><span class="n">limitChecker</span><span class="p">.</span><span class="na">canUserMakeReservation</span><span class="p">(</span><span class="n">any</span><span class="p">())).</span><span class="na">thenReturn</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="n">ReservationId</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">createValidCommand</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">result</span><span class="p">).</span><span class="na">isNotNull</span><span class="p">();</span>
<span class="w">        </span><span class="n">verify</span><span class="p">(</span><span class="n">reservationRepository</span><span class="p">).</span><span class="na">save</span><span class="p">(</span><span class="n">any</span><span class="p">(</span><span class="n">Reservation</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_33">外部システムのモック<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@TestConfiguration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestExternalSystemConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Primary</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EmailService</span><span class="w"> </span><span class="nf">mockEmailService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">EmailService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span><span class="w">  </span>
<span class="w">    </span><span class="nd">@Primary</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">NotificationService</span><span class="w"> </span><span class="nf">mockNotificationService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">NotificationService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_34">性能テスト<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h2>
<h3 id="_35">性能テスト戦略<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<h4 id="jmeter">JMeter による負荷テスト<a class="headerlink" href="#jmeter" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;jmeterTestPlan</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.2&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;TestPlan</span><span class="w"> </span><span class="na">testname=</span><span class="s">&quot;会議室予約システム負荷テスト&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ThreadGroup</span><span class="w"> </span><span class="na">testname=</span><span class="s">&quot;予約作成負荷テスト&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;stringProp</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ThreadGroup.num_threads&quot;</span><span class="nt">&gt;</span>100<span class="nt">&lt;/stringProp&gt;</span>
<span class="w">      </span><span class="nt">&lt;stringProp</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ThreadGroup.ramp_time&quot;</span><span class="nt">&gt;</span>60<span class="nt">&lt;/stringProp&gt;</span>
<span class="w">      </span><span class="nt">&lt;stringProp</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ThreadGroup.duration&quot;</span><span class="nt">&gt;</span>300<span class="nt">&lt;/stringProp&gt;</span>

<span class="w">      </span><span class="nt">&lt;HTTPSamplerProxy</span><span class="w"> </span><span class="na">testname=</span><span class="s">&quot;予約作成API&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;stringProp</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;HTTPSampler.path&quot;</span><span class="nt">&gt;</span>/api/reservations<span class="nt">&lt;/stringProp&gt;</span>
<span class="w">        </span><span class="nt">&lt;stringProp</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;HTTPSampler.method&quot;</span><span class="nt">&gt;</span>POST<span class="nt">&lt;/stringProp&gt;</span>
<span class="w">        </span><span class="nt">&lt;elementProp</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;HTTPsampler.Arguments&quot;</span><span class="w"> </span><span class="na">elementType=</span><span class="s">&quot;Arguments&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;collectionProp&gt;</span>
<span class="w">            </span><span class="nt">&lt;elementProp</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="na">elementType=</span><span class="s">&quot;HTTPArgument&quot;</span><span class="nt">&gt;</span>
<span class="w">              </span><span class="nt">&lt;stringProp</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Argument.value&quot;</span><span class="nt">&gt;</span>{
<span class="w">                </span>&quot;roomId&quot;:<span class="w"> </span>&quot;${roomId}&quot;,
<span class="w">                </span>&quot;title&quot;:<span class="w"> </span>&quot;負荷テスト予約&quot;,
<span class="w">                </span>&quot;startTime&quot;:<span class="w"> </span>&quot;${startTime}&quot;,
<span class="w">                </span>&quot;endTime&quot;:<span class="w"> </span>&quot;${endTime}&quot;
<span class="w">              </span>}<span class="nt">&lt;/stringProp&gt;</span>
<span class="w">            </span><span class="nt">&lt;/elementProp&gt;</span>
<span class="w">          </span><span class="nt">&lt;/collectionProp&gt;</span>
<span class="w">        </span><span class="nt">&lt;/elementProp&gt;</span>
<span class="w">      </span><span class="nt">&lt;/HTTPSamplerProxy&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ThreadGroup&gt;</span>
<span class="w">  </span><span class="nt">&lt;/TestPlan&gt;</span>
<span class="nt">&lt;/jmeterTestPlan&gt;</span>
</code></pre></div>
<h4 id="junit">JUnit による性能テスト<a class="headerlink" href="#junit" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@Test</span>
<span class="nd">@Timeout</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">重複チェックは100ms以内に完了する</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given - 大量の予約データを準備</span>
<span class="w">    </span><span class="n">RoomId</span><span class="w"> </span><span class="n">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">();</span>
<span class="w">    </span><span class="n">setupLargeReservationDataset</span><span class="p">(</span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="n">TimeSlot</span><span class="w"> </span><span class="n">newTimeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TimeSlotFixture</span><span class="p">.</span><span class="na">tomorrowMorning</span><span class="p">();</span>
<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasConflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conflictChecker</span><span class="p">.</span><span class="na">hasConflict</span><span class="p">(</span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">newTimeSlot</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then - タイムアウトアノテーションにより100ms以内に完了することを検証</span>
<span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">hasConflict</span><span class="p">).</span><span class="na">isFalse</span><span class="p">();</span>
<span class="p">}</span>

<span class="nd">@ParameterizedTest</span>
<span class="nd">@ValueSource</span><span class="p">(</span><span class="n">ints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">})</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">予約数に関係なく検索性能が一定</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">reservationCount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="n">RoomId</span><span class="w"> </span><span class="n">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoomId</span><span class="p">.</span><span class="na">generate</span><span class="p">();</span>
<span class="w">    </span><span class="n">setupReservationDataset</span><span class="p">(</span><span class="n">roomId</span><span class="p">,</span><span class="w"> </span><span class="n">reservationCount</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When - 実行時間を計測</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">nanoTime</span><span class="p">();</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservationRepository</span><span class="p">.</span><span class="na">findActiveByRoomId</span><span class="p">(</span><span class="n">roomId</span><span class="p">);</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">endTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">nanoTime</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Then - 実行時間が予約数に比例して増加しないことを検証</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">executionTimeMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">endTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1_000_000</span><span class="p">;</span>
<span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">executionTimeMs</span><span class="p">).</span><span class="na">isLessThan</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span><span class="w"> </span><span class="c1">// 50ms以内</span>
<span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">results</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="n">reservationCount</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_36">カバレッジ戦略<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h2>
<h3 id="_37">コードカバレッジ目標<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ドメイン層</strong>: 90%以上</li>
<li><strong>アプリケーション層</strong>: 85%以上  </li>
<li><strong>インフラストラクチャ層</strong>: 70%以上</li>
<li><strong>全体</strong>: 80%以上</li>
</ul>
<h3 id="jacoco">JaCoCo設定<a class="headerlink" href="#jacoco" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;plugin&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.jacoco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>jacoco-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>0.8.8<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;executions&gt;</span>
<span class="w">        </span><span class="nt">&lt;execution&gt;</span>
<span class="w">            </span><span class="nt">&lt;goals&gt;</span>
<span class="w">                </span><span class="nt">&lt;goal&gt;</span>prepare-agent<span class="nt">&lt;/goal&gt;</span>
<span class="w">            </span><span class="nt">&lt;/goals&gt;</span>
<span class="w">        </span><span class="nt">&lt;/execution&gt;</span>
<span class="w">        </span><span class="nt">&lt;execution&gt;</span>
<span class="w">            </span><span class="nt">&lt;id&gt;</span>report<span class="nt">&lt;/id&gt;</span>
<span class="w">            </span><span class="nt">&lt;phase&gt;</span>test<span class="nt">&lt;/phase&gt;</span>
<span class="w">            </span><span class="nt">&lt;goals&gt;</span>
<span class="w">                </span><span class="nt">&lt;goal&gt;</span>report<span class="nt">&lt;/goal&gt;</span>
<span class="w">            </span><span class="nt">&lt;/goals&gt;</span>
<span class="w">        </span><span class="nt">&lt;/execution&gt;</span>
<span class="w">        </span><span class="nt">&lt;execution&gt;</span>
<span class="w">            </span><span class="nt">&lt;id&gt;</span>check<span class="nt">&lt;/id&gt;</span>
<span class="w">            </span><span class="nt">&lt;goals&gt;</span>
<span class="w">                </span><span class="nt">&lt;goal&gt;</span>check<span class="nt">&lt;/goal&gt;</span>
<span class="w">            </span><span class="nt">&lt;/goals&gt;</span>
<span class="w">            </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">                </span><span class="nt">&lt;rules&gt;</span>
<span class="w">                    </span><span class="nt">&lt;rule&gt;</span>
<span class="w">                        </span><span class="nt">&lt;element&gt;</span>PACKAGE<span class="nt">&lt;/element&gt;</span>
<span class="w">                        </span><span class="nt">&lt;limits&gt;</span>
<span class="w">                            </span><span class="nt">&lt;limit&gt;</span>
<span class="w">                                </span><span class="nt">&lt;counter&gt;</span>LINE<span class="nt">&lt;/counter&gt;</span>
<span class="w">                                </span><span class="nt">&lt;value&gt;</span>COVEREDRATIO<span class="nt">&lt;/value&gt;</span>
<span class="w">                                </span><span class="nt">&lt;minimum&gt;</span>0.80<span class="nt">&lt;/minimum&gt;</span>
<span class="w">                            </span><span class="nt">&lt;/limit&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/limits&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/rule&gt;</span>
<span class="w">                    </span><span class="nt">&lt;rule&gt;</span>
<span class="w">                        </span><span class="nt">&lt;element&gt;</span>CLASS<span class="nt">&lt;/element&gt;</span>
<span class="w">                        </span><span class="nt">&lt;includes&gt;</span>
<span class="w">                            </span><span class="nt">&lt;include&gt;</span>com.example.domain.*<span class="nt">&lt;/include&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/includes&gt;</span>
<span class="w">                        </span><span class="nt">&lt;limits&gt;</span>
<span class="w">                            </span><span class="nt">&lt;limit&gt;</span>
<span class="w">                                </span><span class="nt">&lt;counter&gt;</span>LINE<span class="nt">&lt;/counter&gt;</span>
<span class="w">                                </span><span class="nt">&lt;value&gt;</span>COVEREDRATIO<span class="nt">&lt;/value&gt;</span>
<span class="w">                                </span><span class="nt">&lt;minimum&gt;</span>0.90<span class="nt">&lt;/minimum&gt;</span>
<span class="w">                            </span><span class="nt">&lt;/limit&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/limits&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/rule&gt;</span>
<span class="w">                </span><span class="nt">&lt;/rules&gt;</span>
<span class="w">            </span><span class="nt">&lt;/configuration&gt;</span>
<span class="w">        </span><span class="nt">&lt;/execution&gt;</span>
<span class="w">    </span><span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div>
<h3 id="mutation-testing">変異テスト（Mutation Testing）<a class="headerlink" href="#mutation-testing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;plugin&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.pitest<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>pitest-maven<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>1.9.0<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">        </span><span class="nt">&lt;targetClasses&gt;</span>
<span class="w">            </span><span class="nt">&lt;param&gt;</span>com.example.domain.*<span class="nt">&lt;/param&gt;</span>
<span class="w">        </span><span class="nt">&lt;/targetClasses&gt;</span>
<span class="w">        </span><span class="nt">&lt;targetTests&gt;</span>
<span class="w">            </span><span class="nt">&lt;param&gt;</span>com.example.domain.*Test<span class="nt">&lt;/param&gt;</span>
<span class="w">        </span><span class="nt">&lt;/targetTests&gt;</span>
<span class="w">        </span><span class="nt">&lt;mutators&gt;</span>
<span class="w">            </span><span class="nt">&lt;mutator&gt;</span>STRONGER<span class="nt">&lt;/mutator&gt;</span>
<span class="w">        </span><span class="nt">&lt;/mutators&gt;</span>
<span class="w">        </span><span class="nt">&lt;mutationThreshold&gt;</span>75<span class="nt">&lt;/mutationThreshold&gt;</span>
<span class="w">    </span><span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div>
<h2 id="_38">まとめ<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h2>
<h3 id="_39">テスト戦略の要点<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>アーキテクチャに応じた適切な戦略選択</strong></li>
<li>ドメインモデル → ピラミッド形テスト</li>
<li>アクティブレコード → ダイヤモンド形テスト</li>
<li>
<p>トランザクションスクリプト → 逆ピラミッド形テスト</p>
</li>
<li>
<p><strong>TDD による品質向上</strong></p>
</li>
<li>Red-Green-Refactor サイクル</li>
<li>テストファーストによる設計改善</li>
<li>
<p>継続的なリファクタリング</p>
</li>
<li>
<p><strong>効率的なテスト実行</strong></p>
</li>
<li>高速なフィードバックループ</li>
<li>並列実行による時間短縮</li>
<li>
<p>CI/CD パイプラインとの統合</p>
</li>
<li>
<p><strong>適切なテスト範囲</strong></p>
</li>
<li>ドメイン層への重点的な投資</li>
<li>外部依存の適切な分離</li>
<li>実用的なカバレッジ目標</li>
</ol>
<h3 id="_40">継続的改善<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h3>
<p>テスト戦略は継続的に見直し、改善していく。以下の指標でテストの効果を測定：</p>
<ul>
<li><strong>欠陥検出率</strong>: テストで発見できる欠陥の割合</li>
<li><strong>回帰テスト効率</strong>: リグレッションの早期発見</li>
<li><strong>開発速度</strong>: テストによる開発スピードへの影響</li>
<li><strong>保守性</strong>: テストコード自体の保守しやすさ</li>
</ul>
<p>変更を楽に安全にできて役に立つソフトウェアを実現するため、テストは品質保証の手段であると同時に、設計改善のツールとして活用する。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works" target="_blank" rel="noopener" title="GitHub Repository/claude-code-booster" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>