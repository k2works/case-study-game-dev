
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Site Description">
      
      
        <meta name="author" content="Project Team">
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>実装戦略 - Site Name</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Site Name" class="md-header__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Site Name
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              実装戦略
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Site Name" class="md-nav__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Site Name
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="_1">実装戦略<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">概要<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>このドキュメントでは、ぷよぷよゲーム開発における具体的な実装戦略を定義します。CLAUDE.local.mdで指定されたTDD開発フローと、設計ドキュメントに基づいた段階的実装アプローチを採用します。</p>
<h2 id="_3">実装アプローチ<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="1">1. 関数型プログラミングアプローチの採用<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>本プロジェクトでは、以下の関数型プログラミングの原則を採用し、より堅牢で保守性の高いコードを実現します。</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjUyM3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDE4cHg7aGVpZ2h0OjUyM3B4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQxOCA1MjMiIHdpZHRoPSI0MThweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyID8/Pz8/Pz8/Pz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iLi4uLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfLi4uLi4uLi4uLi4uIj48cGF0aCBkPSJNOC41LDYgTDE3Ny40OTkzLDYgQTMuNzUsMy43NSAwIDAgMSAxNzkuOTk5Myw4LjUgTDE4Ni45OTkzLDI4LjI5NjkgTDQwOC41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgNDExLDMwLjc5NjkgTDQxMSw1MTQuMDYgQTIuNSwyLjUgMCAwIDEgNDA4LjUsNTE2LjU2IEw4LjUsNTE2LjU2IEEyLjUsMi41IDAgMCAxIDYsNTE0LjA2IEw2LDguNSBBMi41LDIuNSAwIDAgMSA4LjUsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE4Ni45OTkzIiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY3Ljk5OTMiIHg9IjEwIiB5PSIyMC45OTUxIj4mIzM4MzA2OyYjMjU5Njg7JiMyMjQxMTsmIzEyNTAzOyYjMTI1MjU7JiMxMjQ2NDsmIzEyNTIxOyYjMTI1MTE7JiMxMjUzMTsmIzEyNDY0OyYjMjE0MDc7JiMyMTA2Mzs8L3RleHQ+PC9nPjwhLS1jbGFzcyA/Pz8/IChQdXJlIEZ1bmN0aW9ucyktLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iLi4uLiAuUHVyZSBGdW5jdGlvbnMuIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV8uLi4uIC5QdXJlIEZ1bmN0aW9ucy4iPjxyZWN0IGZpbGw9IiNFOEY1RTgiIGhlaWdodD0iMTEzLjE4NzUiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwNy4xMTYiIHg9IjEwNC40NCIgeT0iNDEiLz48ZWxsaXBzZSBjeD0iMTE5LjQ0IiBjeT0iNTciIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTEyMi40MDg4LDYyLjY0MDYgUTEyMS44MzA2LDYyLjkzNzUgMTIxLjE5LDYzLjA3ODEgUTEyMC41NDk0LDYzLjIzNDQgMTE5Ljg0NjMsNjMuMjM0NCBRMTE3LjM0NjMsNjMuMjM0NCAxMTYuMDE4MSw2MS41OTM3IFExMTQuNzA1Niw1OS45Mzc1IDExNC43MDU2LDU2LjgxMjUgUTExNC43MDU2LDUzLjY4NzUgMTE2LjAxODEsNTIuMDMxMiBRMTE3LjM0NjMsNTAuMzc1IDExOS44NDYzLDUwLjM3NSBRMTIwLjU0OTQsNTAuMzc1IDEyMS4xOSw1MC41MzEyIFExMjEuODQ2Myw1MC42ODc1IDEyMi40MDg4LDUwLjk4NDQgTDEyMi40MDg4LDUzLjcwMzEgUTEyMS43ODM4LDUzLjEyNSAxMjEuMTksNTIuODU5NCBRMTIwLjU5NjMsNTIuNTc4MSAxMTkuOTcxMyw1Mi41NzgxIFExMTguNjI3NSw1Mi41NzgxIDExNy45NCw1My42NTYyIFExMTcuMjUyNSw1NC43MTg3IDExNy4yNTI1LDU2LjgxMjUgUTExNy4yNTI1LDU4LjkwNjIgMTE3Ljk0LDU5Ljk4NDQgUTExOC42Mjc1LDYxLjA0NjkgMTE5Ljk3MTMsNjEuMDQ2OSBRMTIwLjU5NjMsNjEuMDQ2OSAxMjEuMTksNjAuNzgxMiBRMTIxLjc4MzgsNjAuNSAxMjIuNDA4OCw1OS45MjE5IEwxMjIuNDA4OCw2Mi42NDA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc1LjExNiIgeD0iMTMzLjQ0IiB5PSI2MS44NDY3Ij4mIzMyMDIwOyYjMzE4ODM7JiMzODMwNjsmIzI1OTY4OyAoUHVyZSBGdW5jdGlvbnMpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjEwNS40NCIgeDI9IjMxMC41NTYiIHkxPSI3MyIgeTI9IjczIi8+PGVsbGlwc2UgY3g9IjExNS40NCIgY3k9Ijg2LjY0ODQiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMy43MyIgeD0iMTI0LjQ0IiB5PSI4OS45OTUxIj4mIzIxNTE2OyYjMTIzNzY7JiMyMDgzNzsmIzIxMTQ3OyYjODU5NDsmIzIxNTE2OyYjMTIzNzY7JiMyMDk4NjsmIzIxMTQ3OzwvdGV4dD48ZWxsaXBzZSBjeD0iMTE1LjQ0IiBjeT0iMTAyLjk0NTMiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjEyNC40NCIgeT0iMTA2LjI5MiI+JiMyMTEwMzsmIzIwMzE2OyYjMjk5OTI7JiMxMjM5NDsmIzEyMzc1OzwvdGV4dD48ZWxsaXBzZSBjeD0iMTE1LjQ0IiBjeT0iMTE5LjI0MjIiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjEyNC40NCIgeT0iMTIyLjU4ODkiPiYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMjM0ODE7JiMyNjEzMTsmIzI0NjE1OzwvdGV4dD48ZWxsaXBzZSBjeD0iMTE1LjQ0IiBjeT0iMTM1LjUzOTEiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjEyNC40NCIgeT0iMTM4Ljg4NTciPiYjMjAwMDY7JiMzNDg5MjsmIzIwOTY2OyYjMjk3MDI7JiMyMzQzMzsmIzIwODQwOzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMDUuNDQiIHgyPSIzMTAuNTU2IiB5MT0iMTQ2LjE4NzUiIHkyPSIxNDYuMTg3NSIvPjwvZz48IS0tY2xhc3MgPz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ii4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iZW50aXR5Xy4uLi4uLi4uLiI+PHJlY3QgZmlsbD0iI0U2RjNGRiIgaGVpZ2h0PSIxMTMuMTg3NSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTU3Ljk5OTUiIHg9IjIyIiB5PSIyMTQuMTgiLz48ZWxsaXBzZSBjeD0iMzciIGN5PSIyMzAuMTgiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTM5Ljk2ODgsMjM1LjgyMDYgUTM5LjM5MDYsMjM2LjExNzUgMzguNzUsMjM2LjI1ODEgUTM4LjEwOTQsMjM2LjQxNDQgMzcuNDA2MywyMzYuNDE0NCBRMzQuOTA2MywyMzYuNDE0NCAzMy41NzgxLDIzNC43NzM3IFEzMi4yNjU2LDIzMy4xMTc1IDMyLjI2NTYsMjI5Ljk5MjUgUTMyLjI2NTYsMjI2Ljg2NzUgMzMuNTc4MSwyMjUuMjExMiBRMzQuOTA2MywyMjMuNTU1IDM3LjQwNjMsMjIzLjU1NSBRMzguMTA5NCwyMjMuNTU1IDM4Ljc1LDIyMy43MTEyIFEzOS40MDYzLDIyMy44Njc1IDM5Ljk2ODgsMjI0LjE2NDQgTDM5Ljk2ODgsMjI2Ljg4MzEgUTM5LjM0MzgsMjI2LjMwNSAzOC43NSwyMjYuMDM5NCBRMzguMTU2MywyMjUuNzU4MSAzNy41MzEzLDIyNS43NTgxIFEzNi4xODc1LDIyNS43NTgxIDM1LjUsMjI2LjgzNjIgUTM0LjgxMjUsMjI3Ljg5ODcgMzQuODEyNSwyMjkuOTkyNSBRMzQuODEyNSwyMzIuMDg2MiAzNS41LDIzMy4xNjQ0IFEzNi4xODc1LDIzNC4yMjY5IDM3LjUzMTMsMjM0LjIyNjkgUTM4LjE1NjMsMjM0LjIyNjkgMzguNzUsMjMzLjk2MTIgUTM5LjM0MzgsMjMzLjY4IDM5Ljk2ODgsMjMzLjEwMTkgTDM5Ljk2ODgsMjM1LjgyMDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuOTk5NSIgeD0iNTEiIHk9IjIzNS4wMjY3Ij4mIzEyNDUyOyYjMTI1MTE7JiMxMjUxNzsmIzEyNTQwOyYjMTI0Nzk7JiMxMjQ5OTsmIzEyNTIyOyYjMTI0ODY7JiMxMjQ1MTs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjMiIHgyPSIxNzguOTk5NSIgeTE9IjI0Ni4xOCIgeTI9IjI0Ni4xOCIvPjxlbGxpcHNlIGN4PSIzMyIgY3k9IjI1OS44Mjg0IiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSI0MiIgeT0iMjYzLjE3NTEiPiYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMTIzOTg7JiMxOTk4MTsmIzIyNzkzOyYjMjQ2MTU7PC90ZXh0PjxlbGxpcHNlIGN4PSIzMyIgY3k9IjI3Ni4xMjUzIiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSI0MiIgeT0iMjc5LjQ3MiI+JiMyOTM2NjsmIzI0OTA3OyYjMjI3OTM7JiMyNjM1NjsmIzEyMzk4OyYjMzY4NjE7JiMzNjMyMTs8L3RleHQ+PGVsbGlwc2UgY3g9IjMzIiBjeT0iMjkyLjQyMjIiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjQyIiB5PSIyOTUuNzY4OSI+JiMxMjQ5NjsmIzEyNDY0OyYjMTIzOTg7JiMyMTA2NjsmIzI4MTg3OzwvdGV4dD48ZWxsaXBzZSBjeD0iMzMiIGN5PSIzMDguNzE5MSIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjk5OTUiIHg9IjQyIiB5PSIzMTIuMDY1NyI+JiMyMDAwNjsmIzM0ODkyOyYjMjA5NjY7JiMyOTcwMjsmIzEyMzk4OyYjMjM0MzM7JiMyMDg0MDsmIzI0NjE1OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMyIgeDI9IjE3OC45OTk1IiB5MT0iMzE5LjM2NzUiIHkyPSIzMTkuMzY3NSIvPjwvZz48IS0tY2xhc3MgPz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSIuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIyMSIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfLi4uLiI+PHJlY3QgZmlsbD0iI0ZGRTZDQyIgaGVpZ2h0PSIxMTMuMTg3NSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTc5Ljk5OTMiIHg9IjIxNSIgeT0iMjE0LjE4Ii8+PGVsbGlwc2UgY3g9IjI3Mi43NDk4IiBjeT0iMjMwLjE4IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0yNzUuNzE4NSwyMzUuODIwNiBRMjc1LjE0MDQsMjM2LjExNzUgMjc0LjQ5OTgsMjM2LjI1ODEgUTI3My44NTkyLDIzNi40MTQ0IDI3My4xNTYsMjM2LjQxNDQgUTI3MC42NTYsMjM2LjQxNDQgMjY5LjMyNzksMjM0Ljc3MzcgUTI2OC4wMTU0LDIzMy4xMTc1IDI2OC4wMTU0LDIyOS45OTI1IFEyNjguMDE1NCwyMjYuODY3NSAyNjkuMzI3OSwyMjUuMjExMiBRMjcwLjY1NiwyMjMuNTU1IDI3My4xNTYsMjIzLjU1NSBRMjczLjg1OTIsMjIzLjU1NSAyNzQuNDk5OCwyMjMuNzExMiBRMjc1LjE1NiwyMjMuODY3NSAyNzUuNzE4NSwyMjQuMTY0NCBMMjc1LjcxODUsMjI2Ljg4MzEgUTI3NS4wOTM1LDIyNi4zMDUgMjc0LjQ5OTgsMjI2LjAzOTQgUTI3My45MDYsMjI1Ljc1ODEgMjczLjI4MSwyMjUuNzU4MSBRMjcxLjkzNzMsMjI1Ljc1ODEgMjcxLjI0OTgsMjI2LjgzNjIgUTI3MC41NjIzLDIyNy44OTg3IDI3MC41NjIzLDIyOS45OTI1IFEyNzAuNTYyMywyMzIuMDg2MiAyNzEuMjQ5OCwyMzMuMTY0NCBRMjcxLjkzNzMsMjM0LjIyNjkgMjczLjI4MSwyMzQuMjI2OSBRMjczLjkwNiwyMzQuMjI2OSAyNzQuNDk5OCwyMzMuOTYxMiBRMjc1LjA5MzUsMjMzLjY4IDI3NS43MTg1LDIzMy4xMDE5IEwyNzUuNzE4NSwyMzUuODIwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjI5My4yNDk4IiB5PSIyMzUuMDI2NyI+JiMzOTY0MDsmIzM4NTQyOyYjMzgzMDY7JiMyNTk2ODs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjE2IiB4Mj0iMzkzLjk5OTMiIHkxPSIyNDYuMTgiIHkyPSIyNDYuMTgiLz48ZWxsaXBzZSBjeD0iMjI2IiBjeT0iMjU5LjgyODQiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS45OTk1IiB4PSIyMzUiIHk9IjI2My4xNzUxIj4mIzM4MzA2OyYjMjU5Njg7JiMxMjQzNDsmIzI0MzQxOyYjMjU5Njg7JiMxMjM5NTsmIzIxNDYyOyYjMTI0Mjc7PC90ZXh0PjxlbGxpcHNlIGN4PSIyMjYiIGN5PSIyNzYuMTI1MyIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUzLjk5OTMiIHg9IjIzNSIgeT0iMjc5LjQ3MiI+JiMzODMwNjsmIzI1OTY4OyYjMTI0MzQ7JiMyNTE0NzsmIzEyNDI2OyYjMjA1MTY7JiMxMjM5MjsmIzEyMzc1OyYjMTIzOTA7JiMzNjgyMDsmIzEyMzc3OzwvdGV4dD48ZWxsaXBzZSBjeD0iMjI2IiBjeT0iMjkyLjQyMjIiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjIzNSIgeT0iMjk1Ljc2ODkiPiYjMjUyNzc7JiMzNTkzNzsmIzIxMjcwOyYjMTIzOTg7JiMyMTUyMTsmIzE5OTc4OzwvdGV4dD48ZWxsaXBzZSBjeD0iMjI2IiBjeT0iMzA4LjcxOTEiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjIzNSIgeT0iMzEyLjA2NTciPiYjMjA4Nzc7JiMyMTAzMzsmIzI5OTkyOyYjMjQ2MTU7JiMxMjM5ODsmIzIwNDE5OyYjMzY5MTQ7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIxNiIgeDI9IjM5My45OTkzIiB5MT0iMzE5LjM2NzUiIHkyPSIzMTkuMzY3NSIvPjwvZz48IS0tY2xhc3MgPz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSIuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgZGF0YS11aWQ9ImVudDAwMDYiIGlkPSJlbnRpdHlfLi4uLiI+PHJlY3QgZmlsbD0iI0YwRTZGRiIgaGVpZ2h0PSIxMTMuMTg3NSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTY1Ljk5OTQiIHg9IjEyMiIgeT0iMzg3LjM3Ii8+PGVsbGlwc2UgY3g9IjE3Mi43NDk4IiBjeT0iNDAzLjM3IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0xNzUuNzE4Niw0MDkuMDEwNiBRMTc1LjE0MDQsNDA5LjMwNzUgMTc0LjQ5OTgsNDA5LjQ0ODEgUTE3My44NTkyLDQwOS42MDQ0IDE3My4xNTYxLDQwOS42MDQ0IFExNzAuNjU2MSw0MDkuNjA0NCAxNjkuMzI3OSw0MDcuOTYzNyBRMTY4LjAxNTQsNDA2LjMwNzUgMTY4LjAxNTQsNDAzLjE4MjUgUTE2OC4wMTU0LDQwMC4wNTc1IDE2OS4zMjc5LDM5OC40MDEyIFExNzAuNjU2MSwzOTYuNzQ1IDE3My4xNTYxLDM5Ni43NDUgUTE3My44NTkyLDM5Ni43NDUgMTc0LjQ5OTgsMzk2LjkwMTIgUTE3NS4xNTYxLDM5Ny4wNTc1IDE3NS43MTg2LDM5Ny4zNTQ0IEwxNzUuNzE4Niw0MDAuMDczMSBRMTc1LjA5MzYsMzk5LjQ5NSAxNzQuNDk5OCwzOTkuMjI5NCBRMTczLjkwNjEsMzk4Ljk0ODEgMTczLjI4MTEsMzk4Ljk0ODEgUTE3MS45MzczLDM5OC45NDgxIDE3MS4yNDk4LDQwMC4wMjYyIFExNzAuNTYyMyw0MDEuMDg4NyAxNzAuNTYyMyw0MDMuMTgyNSBRMTcwLjU2MjMsNDA1LjI3NjIgMTcxLjI0OTgsNDA2LjM1NDQgUTE3MS45MzczLDQwNy40MTY5IDE3My4yODExLDQwNy40MTY5IFExNzMuOTA2MSw0MDcuNDE2OSAxNzQuNDk5OCw0MDcuMTUxMiBRMTc1LjA5MzYsNDA2Ljg3IDE3NS43MTg2LDQwNi4yOTE5IEwxNzUuNzE4Niw0MDkuMDEwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjE5My4yNDk4IiB5PSI0MDguMjE2NyI+JiMzODMwNjsmIzI1OTY4OyYjMjE1MTI7JiMyNTEwNDs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTIzIiB4Mj0iMjg2Ljk5OTQiIHkxPSI0MTkuMzciIHkyPSI0MTkuMzciLz48ZWxsaXBzZSBjeD0iMTMzIiBjeT0iNDMzLjAxODQiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOS45OTk0IiB4PSIxNDIiIHk9IjQzNi4zNjUxIj4mIzM1MDc5OyYjMjU5Njg7JiMzODMwNjsmIzI1OTY4OyYjMTIzOTg7JiMzMjA2ODsmIzEyNDE1OyYjMjE1MTI7JiMxMjQzMTsmIzEyMzc5OzwvdGV4dD48ZWxsaXBzZSBjeD0iMTMzIiBjeT0iNDQ5LjMxNTMiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS45OTk1IiB4PSIxNDIiIHk9IjQ1Mi42NjIiPiYjMTI0OTc7JiMxMjQ1MjsmIzEyNTAzOyYjMTI1MjE7JiMxMjQ1MjsmIzEyNTMxOyYjMjA5NjY7JiMyOTcwMjs8L3RleHQ+PGVsbGlwc2UgY3g9IjEzMyIgY3k9IjQ2NS42MTIyIiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSIxNDIiIHk9IjQ2OC45NTg5Ij4mIzIzNDU5OyYjMzUzMjg7JiMzMDM0MDsmIzM1MzUyOyYjMzY4NDg7PC90ZXh0PjxlbGxpcHNlIGN4PSIxMzMiIGN5PSI0ODEuOTA5MSIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMTQyIiB5PSI0ODUuMjU1NyI+JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7JiMxMjM5ODsmIzIxNDg3OyYjMzU1MDE7JiMyNDYxNTs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTIzIiB4Mj0iMjg2Ljk5OTQiIHkxPSI0OTIuNTU3NSIgeTI9IjQ5Mi41NTc1Ii8+PC9nPjwhLS1saW5rID8/Pz8gKFB1cmUgRnVuY3Rpb25zKSB0byA/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLiAuUHVyZSBGdW5jdGlvbnMuIiBkYXRhLWVudGl0eS0yPSIuLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjM2IiBkYXRhLXVpZD0ibG5rNyIgaWQ9ImxpbmtfLi4uLiAuUHVyZSBGdW5jdGlvbnMuXy4uLi4uLi4uLiI+PHBhdGggY29kZUxpbmU9IjM2IiBkPSJNMTcyLjk2LDE1NC42NCBDMTYxLjA4LDE3My42NiAxNTAuOTkxLDE4OS44MDI2IDEzOS4xMTEsMjA4LjgwMjYiIGZpbGw9Im5vbmUiIGlkPSImIzMyMDIwOyYjMzE4ODM7JiMzODMwNjsmIzI1OTY4OyAoUHVyZSBGdW5jdGlvbnMpLXRvLSYjMTI0NTI7JiMxMjUxMTsmIzEyNTE3OyYjMTI1NDA7JiMxMjQ3OTsmIzEyNDk5OyYjMTI1MjI7JiMxMjQ4NjsmIzEyNDUxOyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM1LjkzLDIxMy44OSwxNDQuMDkzLDIwOC4zNzk2LDEzOC41ODA4LDIwOS42NTA1LDEzNy4zMDk4LDIwNC4xMzgzLDEzNS45MywyMTMuODkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8/PyB0byA/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ii4uLi4iIGRhdGEtZW50aXR5LTI9Ii4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjM3IiBkYXRhLXVpZD0ibG5rOCIgaWQ9ImxpbmtfLi4uLl8uLi4uIj48cGF0aCBjb2RlTGluZT0iMzciIGQ9Ik0yNzIuMjYsMzI3LjgzIEMyNjEuMTUsMzQ2Ljg1IDI1MS43NzY2LDM2Mi44OTkzIDI0MC42NzY2LDM4MS44OTkzIiBmaWxsPSJub25lIiBpZD0iJiMzOTY0MDsmIzM4NTQyOyYjMzgzMDY7JiMyNTk2ODstdG8tJiMzODMwNjsmIzI1OTY4OyYjMjE1MTI7JiMyNTEwNDsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzNy42NSwzODcuMDgsMjQ1LjY0MzcsMzgxLjMyNjcsMjQwLjE3MjIsMzgyLjc2MjgsMjM4LjczNjEsMzc3LjI5MTIsMjM3LjY1LDM4Ny4wOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA/Pz8/IChQdXJlIEZ1bmN0aW9ucykgdG8gPz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIuLi4uIC5QdXJlIEZ1bmN0aW9ucy4iIGRhdGEtZW50aXR5LTI9Ii4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjM4IiBkYXRhLXVpZD0ibG5rOSIgaWQ9ImxpbmtfLi4uLiAuUHVyZSBGdW5jdGlvbnMuXy4uLi4iPjxwYXRoIGNvZGVMaW5lPSIzOCIgZD0iTTIzOS43NiwxNTQuNjQgQzI1MC41NCwxNzMuNjYgMjU5LjYxMzMsMTg5LjY2OTEgMjcwLjM3MzMsMjA4LjY2OTEiIGZpbGw9Im5vbmUiIGlkPSImIzMyMDIwOyYjMzE4ODM7JiMzODMwNjsmIzI1OTY4OyAoUHVyZSBGdW5jdGlvbnMpLXRvLSYjMzk2NDA7JiMzODU0MjsmIzM4MzA2OyYjMjU5Njg7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNzMuMzMsMjEzLjg5LDI3Mi4zNzU2LDIwNC4wODc1LDI3MC44NjYxLDIwOS41MzkyLDI2NS40MTQ0LDIwOC4wMjk3LDI3My4zMywyMTMuODkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8/Pz8/Pz8/IHRvID8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLi4uIiBkYXRhLWVudGl0eS0yPSIuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIzOSIgZGF0YS11aWQ9ImxuazEwIiBpZD0ibGlua18uLi4uLi4uLi5fLi4uLiI+PHBhdGggY29kZUxpbmU9IjM5IiBkPSJNMTM1LjA1LDMyNy44MyBDMTQ2LjYxLDM0Ni44NSAxNTYuMzgzMywzNjIuOTUzIDE2Ny45MzMzLDM4MS45NTMiIGZpbGw9Im5vbmUiIGlkPSImIzEyNDUyOyYjMTI1MTE7JiMxMjUxNzsmIzEyNTQwOyYjMTI0Nzk7JiMxMjQ5OTsmIzEyNTIyOyYjMTI0ODY7JiMxMjQ1MTstdG8tJiMzODMwNjsmIzI1OTY4OyYjMjE1MTI7JiMyNTEwNDsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3MS4wNSwzODcuMDgsMTY5Ljc5MywzNzcuMzExNywxNjguNDUyOCwzODIuODA3NSwxNjIuOTU3LDM4MS40NjczLDE3MS4wNSwzODcuMDgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLVNSQz1bWkw5SEp6Zkc1N3hsaHdaVG9uUFppY0lQeU1kOTlFcXFhSzNPVjNRNGlTTGlPU2tPSnNHOWpyVVdCSVhMNFBXaUNxbmFZQjRvU0hqa2Fsd043TXZSX2lOa1JINDE0eFV0VS12dHBsYy15dnFwekpwd09aS012T0ZCOE43NTVyV0FYRld4dWZwcUs5cFpmV1JHZWotX19FcG5fRDhyRllpemFBR1hsaDN1UDQ0Q05PNkk5Q3h3VjRGRzVfMDcwcS03ZlQ5ek1Zbm50RGptdjVOdVBQR04taUtscmN3QlZDdTJCVzQtMFJhNS0wWm1GazBzVlBGRFZROWMxM3gxSEx3N3V0NVVpQ3lCemJkTUEtQmwxalZVSE5iZkJIUHZsX2VjNWh5ZFo0d0h1QVB2ZWtTMGJLZGdhNllMRi1kakdQWnZIS0U2Z2dVenhZVXhxMDNLMTVJWUZ1M0o4NXkwTGVYbk9QTHRoRUhOLWpkaHI5cmdaY0pnamZ1Y1hhZkkzVXUzVHdLN3Y5ZWh6WDNtOVNXY3UxdDBKUlZEV04zM2s4SEJhSGNhOGdGTnNJMHJyTUVuakh6TUFpbDJvWmM1N0JGaF9Bb3ctSmhwMTFiNHJRbkVQSzhGLXRTYmlJUk5nbGg3dlZ4VWZrVUlDQnVWZmk0M0dEdWNieGxpV092OWxXWG9UWElvYkR5V1FvSFAwcUp6QUc2Z0VzTzFxNFVRT3NiVHZya0x2OGdDTlRfZ1RKSGNQZGczQTRWS0pBZzRaTVJZVmw5aUw5QXRQcnNuNTVzT2swZ2NvUWJiQTN3V0h1UnpWSHNHSVREMXBXRWdrNFBpa01RTnM3c21IemtwVzc0UjFxdVpRVS1qRXVzb094UE9pam5jQmNFTElTb1ZFaXFKcG8yZ3ZyeWREM0Zwd0ZRclNYRnNrV0xadV9xVm5yV054bFBCa2lkbjVtMDBdLS0+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h4 id="11">1.1 純粋関数の実装<a class="headerlink" href="#11" title="Permanent link">&para;</a></h4>
<p>ぷよぷよゲームのドメインロジックは純粋関数として実装し、テスタビリティと予測可能性を確保します。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 純粋関数の例: ぷよの移動</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">direction</span><span class="o">:</span><span class="w"> </span><span class="kt">Direction</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">newPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">calculateNewPosition</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">direction</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">newPosition</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// 純粋関数の例: 連鎖検出</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">detectChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoGroup</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">getAllPuyos</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="nx">groupBy</span><span class="p">(</span><span class="nx">puyo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">findConnectedGroup</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">group</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">group</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">4</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// 純粋関数の例: スコア計算  </span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">calculateScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">chainCount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">puyoCount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">baseScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">puyoCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">chainBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">chainCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">chainCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">50</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">baseScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">chainBonus</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="12">1.2 イミュータブルなデータ構造<a class="headerlink" href="#12" title="Permanent link">&para;</a></h4>
<p>すべてのドメインオブジェクトはイミュータブルに設計し、状態変更時は新しいインスタンスを生成します。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// イミュータブルなField実装</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">grid</span><span class="o">:</span><span class="w"> </span><span class="kt">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// 新しいFieldインスタンスを返す</span>
<span class="w">  </span><span class="nx">placePuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">grid</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">row</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">      </span><span class="nx">row</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">cell</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">cell</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Field</span><span class="p">(</span><span class="nx">newGrid</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// 関数型スタイルでのぷよ削除</span>
<span class="w">  </span><span class="nx">removePuyos</span><span class="p">(</span><span class="nx">positions</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">[])</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">positionSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">(</span><span class="nx">positions</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">,</span><span class="si">${</span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">`</span><span class="p">));</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">grid</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">row</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">      </span><span class="nx">row</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">cell</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">        </span><span class="nx">positionSet</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">x</span><span class="si">}</span><span class="sb">,</span><span class="si">${</span><span class="nx">y</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">null</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">cell</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Field</span><span class="p">(</span><span class="nx">newGrid</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="13-lodash">1.3 Lodashによる関数型ユーティリティ<a class="headerlink" href="#13-lodash" title="Permanent link">&para;</a></h4>
<p>Lodash/fpを活用して、宣言的で読みやすいデータ変換処理を実装します。</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 関数合成による連鎖処理パイプライン</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">processChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">  </span><span class="nx">detectErasableGroups</span><span class="p">,</span>
<span class="w">  </span><span class="nx">groups</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">groups</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">group</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">4</span><span class="p">),</span>
<span class="w">  </span><span class="nx">erasableGroups</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">removeGroups</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">erasableGroups</span><span class="p">),</span>
<span class="w">    </span><span class="nx">score</span><span class="o">:</span><span class="w"> </span><span class="kt">calculateChainScore</span><span class="p">(</span><span class="nx">erasableGroups</span><span class="p">),</span>
<span class="w">    </span><span class="nx">chainCount</span><span class="o">:</span><span class="w"> </span><span class="kt">erasableGroups.length</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">);</span>

<span class="c1">// カリー化された関数の活用</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">filterPuyosByColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">((</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">,</span><span class="w"> </span><span class="nx">puyos</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">[])</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">puyos</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">puyo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span>
<span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">filterRedPuyos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filterPuyosByColor</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">filterBluePuyos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filterPuyosByColor</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">BLUE</span><span class="p">);</span>

<span class="c1">// 高階関数による抽象化</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">createPuyoTransformer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">transform</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">field</span><span class="p">.</span><span class="nx">mapPuyos</span><span class="p">(</span><span class="nx">transform</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">movePuyosDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createPuyoTransformer</span><span class="p">(</span><span class="nx">puyo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">moveDown</span><span class="p">())</span>
<span class="p">);</span>
</code></pre></div>
<h3 id="2-vs">2. インサイドアウト vs アウトサイドイン<a class="headerlink" href="#2-vs" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjY5NnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzQ2cHg7aGVpZ2h0OjY5NnB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM0NiA2OTYiIHdpZHRoPSIzNDZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxlbGxpcHNlIGN4PSIxNzMuMDAxIiBjeT0iMjAiIGZpbGw9IiMyMjIyMjIiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOC4wMDA4IiB4PSIxMDkuMDAwNiIgeT0iNTAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDguMDAwOCIgeD0iMTE5LjAwMDYiIHk9IjcxLjEzODciPiYjMTI1MTg7JiMxMjU0MDsmIzEyNDcwOyYjMTI1NDA7JiMxMjQ3MzsmIzEyNDg4OyYjMTI1NDA7JiMxMjUyMjsmIzEyNTQwOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjEzMi4xNTk0LDEwMy45Njg4LDIxMy44NDI3LDEwMy45Njg4LDIyNS44NDI3LDExNS45Njg4LDIxMy44NDI3LDEyNy45Njg4LDEzMi4xNTk0LDEyNy45Njg4LDEyMC4xNTk0LDExNS45Njg4LDEzMi4xNTk0LDEwMy45Njg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS42ODMzIiB4PSIxMzIuMTU5NCIgeT0iMTE5Ljc3NjkiPkNSVUQmIzIzNDU1OyYjMzUwMTM7JiMyODE2ODsmIzEyNDE1Oz88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEuOTk5OCIgeD0iOTguMTU5NSIgeT0iMTEzLjM3NDUiPiYjMTIzOTk7JiMxMjM1Njs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzIuOTk5OCIgeD0iMjI1Ljg0MjciIHk9IjExMy4zNzQ1Ij4mIzEyMzU2OyYjMTIzNTY7JiMxMjM2MDs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwNC4wMDA2IiB4PSIzNS4wMDAyIiB5PSIxMzcuOTY4OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0LjAwMDYiIHg9IjQ1LjAwMDIiIHk9IjE1OS4xMDc0Ij4mIzEyNDg5OyYjMTI1MTM7JiMxMjQ1MjsmIzEyNTMxOyYjMTI1MTQ7JiMxMjQ4NzsmIzEyNTIzOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE2LjAwMDciIHg9IjI5LjAwMDEiIHk9IjE5MS45Mzc1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTYuMDAwNyIgeD0iMzkuMDAwMSIgeT0iMjEzLjA3NjIiPiYjMTI0NTA7JiMxMjQ1NDsmIzEyNDg4OyYjMTI0Njk7JiMxMjQ1MjsmIzEyNDg5OyYjMTI0NTI7JiMxMjUzMTs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MC4wMDA5IiB4PSIxNyIgeT0iMjQ1LjkwNjMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAuMDAwOSIgeD0iMjciIHk9IjI2Ny4wNDQ5Ij4mIzEyNTAzOyYjMTI1MjQ7JiMxMjQ3NjsmIzEyNTMxOyYjMTI0ODY7JiMxMjU0MDsmIzEyNDcxOyYjMTI1MTk7JiMxMjUzMTsmIzIzNjUyOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODAuMDAwNSIgeD0iNDcuMDAwMyIgeT0iMjk5Ljg3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwLjAwMDUiIHg9IjU3LjAwMDMiIHk9IjMyMS4wMTM3Ij4mIzEyNDY5OyYjMTI1NDA7JiMxMjQ5OTsmIzEyNDczOyYjMjM2NTI7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4MC4wMDA1IiB4PSI0Ny4wMDAzIiB5PSIzNTMuODQzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwLjAwMDUiIHg9IjU3LjAwMDMiIHk9IjM3NC45ODI0Ij4mIzEyNDg5OyYjMTI1MTM7JiMxMjQ1MjsmIzEyNTMxOyYjMjM2NTI7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTIuMDAxIiB4PSIxMSIgeT0iNDA3LjgxMjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzIuMDAxIiB4PSIyMSIgeT0iNDI4Ljk1MTIiPiYjMTI0NTI7JiMxMjUzMTsmIzEyNTAxOyYjMTI1MjE7JiMxMjQ3MzsmIzEyNDg4OyYjMTI1MjE7JiMxMjQ2MzsmIzEyNDgxOyYjMTI1MTU7JiMyMzY1Mjs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkyLjAwMDUiIHg9IjQxLjAwMDIiIHk9IjQ2MS43ODEzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzIuMDAwNSIgeD0iNTEuMDAwMiIgeT0iNDgyLjkxOTkiPiYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMTI1MDU7JiMxMjU0MDsmIzEyNDczOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI4LjAwMDgiIHg9IjE5NS4wMDExIiB5PSIxMzcuOTY4OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC4wMDA4IiB4PSIyMDUuMDAxMSIgeT0iMTU5LjEwNzQiPiYjMzYwMDc7JiMzNDg4MDsmIzEyNDg5OyYjMTI1MTM7JiMxMjQ1MjsmIzEyNTMxOyYjMTI1MTQ7JiMxMjQ4NzsmIzEyNTIzOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE2LjAwMDciIHg9IjIwMS4wMDExIiB5PSIxOTEuOTM3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2LjAwMDciIHg9IjIxMS4wMDExIiB5PSIyMTMuMDc2MiI+JiMxMjQ1MjsmIzEyNTMxOyYjMTI0Njk7JiMxMjQ1MjsmIzEyNDg5OyYjMTI0NTA7JiMxMjQ1NDsmIzEyNDg4OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTIuMDAwNSIgeD0iMjEzLjAwMTIiIHk9IjI0NS45MDYzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzIuMDAwNSIgeD0iMjIzLjAwMTIiIHk9IjI2Ny4wNDQ5Ij4mIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzEyNTA1OyYjMTI1NDA7JiMxMjQ3Mzs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1Mi4wMDEiIHg9IjE4My4wMDEiIHk9IjI5OS44NzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzIuMDAxIiB4PSIxOTMuMDAxIiB5PSIzMjEuMDEzNyI+JiMxMjQ1MjsmIzEyNTMxOyYjMTI1MDE7JiMxMjUyMTsmIzEyNDczOyYjMTI0ODg7JiMxMjUyMTsmIzEyNDYzOyYjMTI0ODE7JiMxMjUxNTsmIzIzNjUyOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODAuMDAwNSIgeD0iMjE5LjAwMTMiIHk9IjM1My44NDM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjAuMDAwNSIgeD0iMjI5LjAwMTMiIHk9IjM3NC45ODI0Ij4mIzEyNDg5OyYjMTI1MTM7JiMxMjQ1MjsmIzEyNTMxOyYjMjM2NTI7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4MC4wMDA1IiB4PSIyMTkuMDAxMyIgeT0iNDA3LjgxMjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4wMDA1IiB4PSIyMjkuMDAxMyIgeT0iNDI4Ljk1MTIiPiYjMTI0Njk7JiMxMjU0MDsmIzEyNDk5OyYjMTI0NzM7JiMyMzY1Mjs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MC4wMDA5IiB4PSIxODkuMDAxMSIgeT0iNDYxLjc4MTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAuMDAwOSIgeD0iMTk5LjAwMTEiIHk9IjQ4Mi45MTk5Ij4mIzEyNTAzOyYjMTI1MjQ7JiMxMjQ3NjsmIzEyNTMxOyYjMTI0ODY7JiMxMjU0MDsmIzEyNDcxOyYjMTI1MTk7JiMxMjUzMTsmIzIzNjUyOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjE3My4wMDEsNTAxLjc1LDE4NS4wMDEsNTEzLjc1LDE3My4wMDEsNTI1Ljc1LDE2MS4wMDEsNTEzLjc1LDE3My4wMDEsNTAxLjc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjEzOS4zODA4LDU0NS43NSwyMDYuNjIxMiw1NDUuNzUsMjE4LjYyMTIsNTU3Ljc1LDIwNi42MjEyLDU2OS43NSwxMzkuMzgwOCw1NjkuNzUsMTI3LjM4MDgsNTU3Ljc1LDEzOS4zODA4LDU0NS43NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjcuMjQwNCIgeD0iMTM5LjM4MDgiIHk9IjU2MS41NTgxIj5BUEkmIzIzNDU1OyYjMzUwMTM7JiMyODE2ODsmIzEyNDE1Oz88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEuOTk5OCIgeD0iMTA1LjM4MSIgeT0iNTU1LjE1NTgiPiYjMTIzOTk7JiMxMjM1Njs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzIuOTk5OCIgeD0iMjE4LjYyMTIiIHk9IjU1NS4xNTU4Ij4mIzEyMzU2OyYjMTIzNTY7JiMxMjM2MDs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExNi4wMDA3IiB4PSI0Ny4wMDAzIiB5PSI1NzkuNzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ni4wMDA3IiB4PSI1Ny4wMDAzIiB5PSI2MDAuODg4NyI+JiMxMjQ1MjsmIzEyNTMxOyYjMTI0Njk7JiMxMjQ1MjsmIzEyNDg5OyYjMTI0NTA7JiMxMjQ1NDsmIzEyNDg4OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE2LjAwMDciIHg9IjE4My4wMDEiIHk9IjU3OS43NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2LjAwMDciIHg9IjE5My4wMDEiIHk9IjYwMC44ODg3Ij4mIzEyNDUwOyYjMTI0NTQ7JiMxMjQ4ODsmIzEyNDY5OyYjMTI0NTI7JiMxMjQ4OTsmIzEyNDUyOyYjMTI1MzE7PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTczLjAwMSw2MTkuNzE4OCwxODUuMDAxLDYzMS43MTg4LDE3My4wMDEsNjQzLjcxODgsMTYxLjAwMSw2MzEuNzE4OCwxNzMuMDAxLDYxOS43MTg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48ZWxsaXBzZSBjeD0iMTczLjAwMSIgY3k9IjY3NC43MTg4IiBmaWxsPSJub25lIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxlbGxpcHNlIGN4PSIxNzMuMDAxIiBjeT0iNjc0LjcxODgiIGZpbGw9IiMyMjIyMjIiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNzMuMDAxIiB4Mj0iMTczLjAwMSIgeTE9IjMwIiB5Mj0iNTAiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2OS4wMDEsNDAsMTczLjAwMSw1MCwxNzcuMDAxLDQwLDE3My4wMDEsNDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODcuMDAwNSIgeDI9Ijg3LjAwMDUiIHkxPSIxNzEuOTM3NSIgeTI9IjE5MS45Mzc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4My4wMDA1LDE4MS45Mzc1LDg3LjAwMDUsMTkxLjkzNzUsOTEuMDAwNSwxODEuOTM3NSw4Ny4wMDA1LDE4NS45Mzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg3LjAwMDUiIHgyPSI4Ny4wMDA1IiB5MT0iMjI1LjkwNjMiIHkyPSIyNDUuOTA2MyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODMuMDAwNSwyMzUuOTA2Myw4Ny4wMDA1LDI0NS45MDYzLDkxLjAwMDUsMjM1LjkwNjMsODcuMDAwNSwyMzkuOTA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Ny4wMDA1IiB4Mj0iODcuMDAwNSIgeTE9IjI3OS44NzUiIHkyPSIyOTkuODc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4My4wMDA1LDI4OS44NzUsODcuMDAwNSwyOTkuODc1LDkxLjAwMDUsMjg5Ljg3NSw4Ny4wMDA1LDI5My44NzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODcuMDAwNSIgeDI9Ijg3LjAwMDUiIHkxPSIzMzMuODQzOCIgeTI9IjM1My44NDM4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4My4wMDA1LDM0My44NDM4LDg3LjAwMDUsMzUzLjg0MzgsOTEuMDAwNSwzNDMuODQzOCw4Ny4wMDA1LDM0Ny44NDM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg3LjAwMDUiIHgyPSI4Ny4wMDA1IiB5MT0iMzg3LjgxMjUiIHkyPSI0MDcuODEyNSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODMuMDAwNSwzOTcuODEyNSw4Ny4wMDA1LDQwNy44MTI1LDkxLjAwMDUsMzk3LjgxMjUsODcuMDAwNSw0MDEuODEyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Ny4wMDA1IiB4Mj0iODcuMDAwNSIgeTE9IjQ0MS43ODEzIiB5Mj0iNDYxLjc4MTMiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgzLjAwMDUsNDUxLjc4MTMsODcuMDAwNSw0NjEuNzgxMyw5MS4wMDA1LDQ1MS43ODEzLDg3LjAwMDUsNDU1Ljc4MTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjU5LjAwMTUiIHgyPSIyNTkuMDAxNSIgeTE9IjE3MS45Mzc1IiB5Mj0iMTkxLjkzNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI1NS4wMDE1LDE4MS45Mzc1LDI1OS4wMDE1LDE5MS45Mzc1LDI2My4wMDE1LDE4MS45Mzc1LDI1OS4wMDE1LDE4NS45Mzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI1OS4wMDE1IiB4Mj0iMjU5LjAwMTUiIHkxPSIyMjUuOTA2MyIgeTI9IjI0NS45MDYzIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNTUuMDAxNSwyMzUuOTA2MywyNTkuMDAxNSwyNDUuOTA2MywyNjMuMDAxNSwyMzUuOTA2MywyNTkuMDAxNSwyMzkuOTA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNTkuMDAxNSIgeDI9IjI1OS4wMDE1IiB5MT0iMjc5Ljg3NSIgeTI9IjI5OS44NzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI1NS4wMDE1LDI4OS44NzUsMjU5LjAwMTUsMjk5Ljg3NSwyNjMuMDAxNSwyODkuODc1LDI1OS4wMDE1LDI5My44NzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjU5LjAwMTUiIHgyPSIyNTkuMDAxNSIgeTE9IjMzMy44NDM4IiB5Mj0iMzUzLjg0MzgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI1NS4wMDE1LDM0My44NDM4LDI1OS4wMDE1LDM1My44NDM4LDI2My4wMDE1LDM0My44NDM4LDI1OS4wMDE1LDM0Ny44NDM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI1OS4wMDE1IiB4Mj0iMjU5LjAwMTUiIHkxPSIzODcuODEyNSIgeTI9IjQwNy44MTI1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNTUuMDAxNSwzOTcuODEyNSwyNTkuMDAxNSw0MDcuODEyNSwyNjMuMDAxNSwzOTcuODEyNSwyNTkuMDAxNSw0MDEuODEyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNTkuMDAxNSIgeDI9IjI1OS4wMDE1IiB5MT0iNDQxLjc4MTMiIHkyPSI0NjEuNzgxMyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjU1LjAwMTUsNDUxLjc4MTMsMjU5LjAwMTUsNDYxLjc4MTMsMjYzLjAwMTUsNDUxLjc4MTMsMjU5LjAwMTUsNDU1Ljc4MTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTIwLjE1OTQiIHgyPSI4Ny4wMDA1IiB5MT0iMTE1Ljk2ODgiIHkyPSIxMTUuOTY4OCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Ny4wMDA1IiB4Mj0iODcuMDAwNSIgeTE9IjExNS45Njg4IiB5Mj0iMTM3Ljk2ODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgzLjAwMDUsMTI3Ljk2ODgsODcuMDAwNSwxMzcuOTY4OCw5MS4wMDA1LDEyNy45Njg4LDg3LjAwMDUsMTMxLjk2ODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjI1Ljg0MjciIHgyPSIyNTkuMDAxNSIgeTE9IjExNS45Njg4IiB5Mj0iMTE1Ljk2ODgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjU5LjAwMTUiIHgyPSIyNTkuMDAxNSIgeTE9IjExNS45Njg4IiB5Mj0iMTM3Ljk2ODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI1NS4wMDE1LDEyNy45Njg4LDI1OS4wMDE1LDEzNy45Njg4LDI2My4wMDE1LDEyNy45Njg4LDI1OS4wMDE1LDEzMS45Njg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg3LjAwMDUiIHgyPSI4Ny4wMDA1IiB5MT0iNDk1Ljc1IiB5Mj0iNTEzLjc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg3LjAwMDUiIHgyPSIxNjEuMDAxIiB5MT0iNTEzLjc1IiB5Mj0iNTEzLjc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNTEuMDAxLDUwOS43NSwxNjEuMDAxLDUxMy43NSwxNTEuMDAxLDUxNy43NSwxNTUuMDAxLDUxMy43NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNTkuMDAxNSIgeDI9IjI1OS4wMDE1IiB5MT0iNDk1Ljc1IiB5Mj0iNTEzLjc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI1OS4wMDE1IiB4Mj0iMTg1LjAwMSIgeTE9IjUxMy43NSIgeTI9IjUxMy43NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTk1LjAwMSw1MDkuNzUsMTg1LjAwMSw1MTMuNzUsMTk1LjAwMSw1MTcuNzUsMTkxLjAwMSw1MTMuNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTczLjAwMSIgeDI9IjE3My4wMDEiIHkxPSI4My45Njg4IiB5Mj0iMTAzLjk2ODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2OS4wMDEsOTMuOTY4OCwxNzMuMDAxLDEwMy45Njg4LDE3Ny4wMDEsOTMuOTY4OCwxNzMuMDAxLDk3Ljk2ODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTI3LjM4MDgiIHgyPSIxMDUuMDAwNiIgeTE9IjU1Ny43NSIgeTI9IjU1Ny43NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDUuMDAwNiIgeDI9IjEwNS4wMDA2IiB5MT0iNTU3Ljc1IiB5Mj0iNTc5Ljc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDEuMDAwNiw1NjkuNzUsMTA1LjAwMDYsNTc5Ljc1LDEwOS4wMDA2LDU2OS43NSwxMDUuMDAwNiw1NzMuNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjE4LjYyMTIiIHgyPSIyNDEuMDAxNCIgeTE9IjU1Ny43NSIgeTI9IjU1Ny43NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDEuMDAxNCIgeDI9IjI0MS4wMDE0IiB5MT0iNTU3Ljc1IiB5Mj0iNTc5Ljc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzcuMDAxNCw1NjkuNzUsMjQxLjAwMTQsNTc5Ljc1LDI0NS4wMDE0LDU2OS43NSwyNDEuMDAxNCw1NzMuNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTA1LjAwMDYiIHgyPSIxMDUuMDAwNiIgeTE9IjYxMy43MTg4IiB5Mj0iNjMxLjcxODgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTA1LjAwMDYiIHgyPSIxNjEuMDAxIiB5MT0iNjMxLjcxODgiIHkyPSI2MzEuNzE4OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTUxLjAwMSw2MjcuNzE4OCwxNjEuMDAxLDYzMS43MTg4LDE1MS4wMDEsNjM1LjcxODgsMTU1LjAwMSw2MzEuNzE4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDEuMDAxNCIgeDI9IjI0MS4wMDE0IiB5MT0iNjEzLjcxODgiIHkyPSI2MzEuNzE4OCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDEuMDAxNCIgeDI9IjE4NS4wMDEiIHkxPSI2MzEuNzE4OCIgeTI9IjYzMS43MTg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxOTUuMDAxLDYyNy43MTg4LDE4NS4wMDEsNjMxLjcxODgsMTk1LjAwMSw2MzUuNzE4OCwxOTEuMDAxLDYzMS43MTg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE3My4wMDEiIHgyPSIxNzMuMDAxIiB5MT0iNTI1Ljc1IiB5Mj0iNTQ1Ljc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjkuMDAxLDUzNS43NSwxNzMuMDAxLDU0NS43NSwxNzcuMDAxLDUzNS43NSwxNzMuMDAxLDUzOS43NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNzMuMDAxIiB4Mj0iMTczLjAwMSIgeTE9IjY0My43MTg4IiB5Mj0iNjYzLjcxODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2OS4wMDEsNjUzLjcxODgsMTczLjAwMSw2NjMuNzE4OCwxNzcuMDAxLDY1My43MTg4LDE3My4wMDEsNjU3LjcxODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48IS0tU1JDPVtBb3Y5QjJoWGlkaFNsRW5ueXZ4N0pUbDB2Q3g3cEhxV0hsQ2c4NmREYlBjY2VFNFM1RWhvVER0eTV1alJkLXRlVURvdXRydkplSUdaREt6MXV0N1otaVVEQlBlVzhwZVZEb3p5dEJKYVNWRmNueXNCN1pVdEZzdlVSR3FLUnJocWs2YVBvQ0ljaE0zUEplV1FhNUpwekNWRFFudXR4RzVoUUdGUmxWcm55dDhXei1kNjlNMnpNeTdrYzBucTRyRzRvSFFPNmVZREtueXRodUd2N1NYT194WXZ5TjdwT2ZZa1RoM1gtbnl0cHVKdXE5ZWhEUVN1NVVKeTVaM2cwRmhXblFSYkJuT3N1Rk83TTBKWDJRWXRTMVhGZkJpbVZPRmZPX28xYjlnTmFmYTZaWUY3MDR5MktPSkoydlkxV0psUTgxT01iLUdOMDAwMF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="2">2. 選択基準<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p><strong>インサイドアウトアプローチ（推奨）:</strong></p>
<ul>
<li>
<p><strong>対象:</strong> ドメインモデル（Puyo, Field, Game, Chain）</p>
</li>
<li>
<p><strong>理由:</strong> </p>
</li>
<li>
<p>新規プロジェクトでCRUD未実装</p>
</li>
<li>複雑なゲームロジックをドメイン中心で構築</li>
<li>テストファーストな開発が可能</li>
</ul>
<p><strong>アウトサイドインアプローチ（部分採用）:</strong></p>
<ul>
<li>
<p><strong>対象:</strong> UI インタラクション（キーボード、タッチ操作）</p>
</li>
<li>
<p><strong>理由:</strong></p>
</li>
<li>ユーザー体験を早期に確認</li>
<li>フィードバックループを短縮</li>
</ul>
<h2 id="tdd">TDD実装サイクル<a class="headerlink" href="#tdd" title="Permanent link">&para;</a></h2>
<h3 id="red-green-refactor">Red-Green-Refactorサイクル<a class="headerlink" href="#red-green-refactor" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjE1MTRweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjM5MnB4O2hlaWdodDoxNTE0cHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMzkyIDE1MTQiIHdpZHRoPSIzOTJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxlbGxpcHNlIGN4PSIyNDMuOTA2NCIgY3k9IjIwIiBmaWxsPSIjMjIyMjIyIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTUuNDYxNCIgeD0iMTg2LjE3NTciIHk9IjUwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTUuNDYxNCIgeD0iMTk2LjE3NTciIHk9IjcxLjEzODciPlRPRE8mIzEyNTIyOyYjMTI0NzM7JiMxMjQ4ODsmIzMwOTA2OyYjMzU0Njk7PC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQ0LjE3MTkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE2NS42ODQ0IiB4PSIxNjEuMDY0MiIgeT0iOTMuOTY4OCIvPjxwYXRoIGQ9Ik0yNDQuNTQzNyw5My45Njg4IEwyNDQuNTQzNywxMDMuMjY1NiBMMjM0LjU0MzcsMTEzLjI2NTYgTDE2MS4wNjQyLDExMy4yNjU2IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My40Nzk1IiB4PSIxNjQuMDY0MiIgeT0iMTA3Ljk2MzkiPlJlZCBQaGFzZTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA0LjAwMDYiIHg9IjE5MS45MDYxIiB5PSIxMzAuMjY1NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0LjAwMDYiIHg9IjIwMS45MDYxIiB5PSIxNTEuNDA0MyI+JiMyMjgzMzsmIzI1OTQzOyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMjAzMTY7JiMyNTEwNDs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOC4wMDA4IiB4PSIxNzkuOTA2IiB5PSIxODQuMjM0NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC4wMDA4IiB4PSIxODkuOTA2IiB5PSIyMDUuMzczIj4mIzI2Mzk5OyYjMjQ0NTM7JiMxMjM3NzsmIzEyNDI3OyYjMjEyMDU7JiMyMDMxNjsmIzEyNDM0OyYjMjM0NTA7JiMzMjY4MTs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MC4wMDA5IiB4PSIxNzMuOTA1OSIgeT0iMjM4LjIwMzEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAuMDAwOSIgeD0iMTgzLjkwNTkiIHk9IjI1OS4zNDE4Ij4mIzI2MzY4OyYjMjM1Njc7JiMzODQ4MDsmIzEyMzk4OyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMTI0NjU7JiMxMjU0MDsmIzEyNDczOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ1LjY4NDQiIHg9IjE3MS4wNjQyIiB5PSIyOTIuMTcxOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS42ODQ0IiB4PSIxODEuMDY0MiIgeT0iMzEzLjMxMDUiPiYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMjM0NTU7JiMzNDg5MjsgJiM4NTk0OyAmIzIyODMzOyYjMjU5NDM7JiMzMDkwNjsmIzM1NDY5OzwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjI0NC4xNzE5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxNzIuMDAxIiB4PSIxNTcuOTA1OSIgeT0iMzQ4LjE0MDYiLz48cGF0aCBkPSJNMjU2Ljg2MiwzNDguMTQwNiBMMjU2Ljg2MiwzNTcuNDM3NSBMMjQ2Ljg2MiwzNjcuNDM3NSBMMTU3LjkwNTksMzY3LjQzNzUiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg4Ljk1NjEiIHg9IjE2MC45MDU5IiB5PSIzNjIuMTM1NyI+R3JlZW4gUGhhc2U8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY4LjAwMDQiIHg9IjIwOS45MDYyIiB5PSIzODQuNDM3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4LjAwMDQiIHg9IjIxOS45MDYyIiB5PSI0MDUuNTc2MiI+JiMyNjM2ODsmIzIzNTY3OyYjMjM0NTU7JiMzNTAxMzs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1Mi4wMDEiIHg9IjE2Ny45MDU5IiB5PSI0MzguNDA2MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMi4wMDEiIHg9IjE3Ny45MDU5IiB5PSI0NTkuNTQ0OSI+JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7JiMxMjM2NDsmIzM2ODkwOyYjMTI0Mjc7JiMyNjM2ODsmIzIzNTY3OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUyLjAwMSIgeD0iMTY3LjkwNTkiIHk9IjQ5Mi4zNzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzIuMDAxIiB4PSIxNzcuOTA1OSIgeT0iNTEzLjUxMzciPiYjMzY4OTU7JiMyNDIzMDsmIzIwNzc4OyYjMjA4MDg7JiMxMjI4OTsmIzIxNjk3OyYjMzYwNzQ7JiMxMjM5OTsmIzIwMTA4OyYjMTIzOTg7JiMyNzQyNTs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0NS42ODQ0IiB4PSIxNzEuMDY0MiIgeT0iNTQ2LjM0MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuNjg0NCIgeD0iMTgxLjA2NDIiIHk9IjU2Ny40ODI0Ij4mIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsmIzIzNDU1OyYjMzQ4OTI7ICYjODU5NDsgJiMyNTEwNDsmIzIxMTUxOyYjMzA5MDY7JiMzNTQ2OTs8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyOTguMTQwNiIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTY1LjY4NDQiIHg9IjE2MS4wNjQyIiB5PSI2MDIuMzEyNSIvPjxwYXRoIGQ9Ik0yNzYuNjcyNiw2MDIuMzEyNSBMMjc2LjY3MjYsNjExLjYwOTQgTDI2Ni42NzI2LDYyMS42MDk0IEwxNjEuMDY0Miw2MjEuNjA5NCIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA1LjYwODQiIHg9IjE2NC4wNjQyIiB5PSI2MTYuMzA3NiI+UmVmYWN0b3IgUGhhc2U8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExNi4wMDA3IiB4PSIxODUuOTA2IiB5PSI2MzguNjA5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2LjAwMDciIHg9IjE5NS45MDYiIHk9IjY1OS43NDgiPiYjMTI1MjI7JiMxMjUwMTsmIzEyNDQ5OyYjMTI0NjM7JiMxMjQ3OTsmIzEyNTIyOyYjMTI1MzE7JiMxMjQ2NDs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwNC4wMDA2IiB4PSIxOTEuOTA2MSIgeT0iNjkyLjU3ODEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NC4wMDA2IiB4PSIyMDEuOTA2MSIgeT0iNzEzLjcxNjgiPiYjMzczMjU7JiMzNTA3OTsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTsmIzM4NTAwOyYjMjE0MzU7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4MC4wMDA1IiB4PSIyMDMuOTA2MiIgeT0iNzQ2LjU0NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4wMDA1IiB4PSIyMTMuOTA2MiIgeT0iNzY3LjY4NTUiPiYjMzUzNzM7JiMzNTMzNjsmIzEyMzk4OyYjMjU5MTM7JiMyMTg5Mjs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MC4wMDA5IiB4PSIxNzMuOTA1OSIgeT0iODAwLjUxNTYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAuMDAwOSIgeD0iMTgzLjkwNTkiIHk9IjgyMS42NTQzIj4mIzEyNDk3OyYjMTI1MDE7JiMxMjQ1NzsmIzEyNTQwOyYjMTI1MTA7JiMxMjUzMTsmIzEyNDczOyYjMjYzNjg7JiMzNjk2OTsmIzIxMjcwOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ1LjY4NDQiIHg9IjE3MS4wNjQyIiB5PSI4NTQuNDg0NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS42ODQ0IiB4PSIxODEuMDY0MiIgeT0iODc1LjYyMyI+JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7JiMyMzQ1NTsmIzM0ODkyOyAmIzg1OTQ7ICYjMjUxMDQ7JiMyMTE1MTsmIzMyMTczOyYjMjUzNDU7PC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNDE2LjEwOTQiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjM3MC41NDIxIiB4PSIxMSIgeT0iOTEwLjQ1MzEiLz48cGF0aCBkPSJNMTA0Ljk5OTYsOTEwLjQ1MzEgTDEwNC45OTk2LDkxOS43NSBMOTQuOTk5Niw5MjkuNzUgTDExLDkyOS43NSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODMuOTk5NiIgeD0iMTQiIHk9IjkyNC40NDgyIj4mIzIxNjk3OyYjMzYwNzQ7JiMxMjQ4MTsmIzEyNDU1OyYjMTI0ODM7JiMxMjQ2Mzs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwMC4xMTE5IiB4PSIxNDMuODUwNSIgeT0iOTQ2Ljc1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgwLjExMTkiIHg9IjE1My44NTA1IiB5PSI5NjcuODg4NyI+JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7JiMxMjM5ODsmIzI1OTcyOyYjMjQ0MTg7IChucG0gcnVuIGZvcm1hdCk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0Mi44NDIxIiB4PSIxNzIuNDg1NCIgeT0iMTAwMC43MTg4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIyLjg0MjEiIHg9IjE4Mi40ODU0IiB5PSIxMDIxLjg1NzQiPiYjMTI1MjI7JiMxMjUzMTsmIzEyNDg4OyAobnBtIHJ1biBsaW50KTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUzLjM3MTQiIHg9IjE2Ny4yMjA3IiB5PSIxMDU0LjY4NzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzMuMzcxNCIgeD0iMTc3LjIyMDciIHk9IjEwNzUuODI2MiI+JiMxMjQ5OTsmIzEyNTIzOyYjMTI0ODk7IChucG0gcnVuIGJ1aWxkKTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ2LjkwODUiIHg9IjE3MC40NTIyIiB5PSIxMTA4LjY1NjMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjYuOTA4NSIgeD0iMTgwLjQ1MjIiIHk9IjExMjkuNzk0OSI+JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7IChucG0gcnVuIHRlc3QpPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMjEzLjQ4NzQsMTE2Mi42MjUsMjc0LjMyNTQsMTE2Mi42MjUsMjg2LjMyNTQsMTE3NC42MjUsMjc0LjMyNTQsMTE4Ni42MjUsMjEzLjQ4NzQsMTE4Ni42MjUsMjAxLjQ4NzQsMTE3NC42MjUsMjEzLjQ4NzQsMTE2Mi42MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwLjgzOCIgeD0iMjEzLjQ4NzQiIHk9IjExNzguNDMzMSI+JiMxMjQ1NjsmIzEyNTIxOyYjMTI1NDA7JiMxMjM1NDsmIzEyNDI2Oz88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkuMDA4MyIgeD0iMTgyLjQ3OTEiIHk9IjExNzIuMDMwOCI+eWVzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzLjcwMTciIHg9IjI4Ni4zMjU0IiB5PSIxMTcyLjAzMDgiPm5vPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0NC4wMDAyIiB4PSIxMzAuMjcwOCIgeT0iMTE5Ni42MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNC4wMDAyIiB4PSIxNDAuMjcwOCIgeT0iMTIxNy43NjM3Ij4mIzIwNDYyOyYjMjc0OTE7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNTguNTQxNyIgeD0iMjMiIHk9IjEyNTAuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzOC41NDE3IiB4PSIzMyIgeT0iMTI3MS43MzI0Ij4mIzIwNDYyOyYjMjc0OTE7OyAtLSZndDsgOiYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5OyYjMTIzOTg7JiMyNTk3MjsmIzI0NDE4OyAobnBtIHJ1biBmb3JtYXQpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSIzMDEuNTQxNyIgeT0iMTE5Ni42MjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSIzMTEuNTQxNyIgeT0iMTIxNy43NjM3Ij4mIzEyNDY3OyYjMTI1MTE7JiMxMjQ4MzsmIzEyNDg4OzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjI0My45MDY0LDEyOTAuNTYyNSwyNTUuOTA2NCwxMzAyLjU2MjUsMjQzLjkwNjQsMTMxNC41NjI1LDIzMS45MDY0LDEzMDIuNTYyNSwyNDMuOTA2NCwxMjkwLjU2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDMuNDYxMyIgeD0iMTkyLjE3NTgiIHk9IjEzOTQuOTY0OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjQ2MTMiIHg9IjIwMi4xNzU4IiB5PSIxNDE2LjEwMzUiPiYjMjc0MjU7JiMxMjM5ODtUT0RPJiMzNjk4NDsmIzI1MjQ2OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjIxLjg5MTYiIHg9IjEzMi45NjA2IiB5PSIxNDQ4LjkzMzYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMDEuODkxNiIgeD0iMTQyLjk2MDYiIHk9IjE0NzAuMDcyMyI+JiMyNzQyNTsmIzEyMzk4O1RPRE8mIzM2OTg0OyYjMjUyNDY7OyAtLSZndDsgOiYjMjI4MzM7JiMyNTk0MzsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsmIzIwMzE2OyYjMjUxMDQ7PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMjEzLjczNDQsMTM0Ni41NjI1LDI3NC4wNzg0LDEzNDYuNTYyNSwyODYuMDc4NCwxMzU4LjU2MjUsMjc0LjA3ODQsMTM3MC41NjI1LDIxMy43MzQ0LDEzNzAuNTYyNSwyMDEuNzM0NCwxMzU4LjU2MjUsMjEzLjczNDQsMTM0Ni41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMy43MDE3IiB4PSIyNDcuOTA2NCIgeT0iMTM4MC43NzI5Ij5ubzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4zNDQxIiB4PSIyMTMuNzM0NCIgeT0iMTM2Mi4zNzA2Ij5UT0RPJiMyMzQzNjsmIzIwMTAyOz88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkuMDA4MyIgeD0iMjg2LjA3ODQiIHk9IjEzNTUuOTY4MyI+eWVzPC90ZXh0PjxlbGxpcHNlIGN4PSIzMjcuMDg2NyIgY3k9IjEzNTguNTYyNSIgZmlsbD0ibm9uZSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZWxsaXBzZSBjeD0iMzI3LjA4NjciIGN5PSIxMzU4LjU2MjUiIGZpbGw9IiMyMjIyMjIiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDMuOTA2NCIgeDI9IjI0My45MDY0IiB5MT0iMzAiIHkyPSI1MCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsNDAsMjQzLjkwNjQsNTAsMjQ3LjkwNjQsNDAsMjQzLjkwNjQsNDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9IjE2NC4yMzQ0IiB5Mj0iMTg0LjIzNDQiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzOS45MDY0LDE3NC4yMzQ0LDI0My45MDY0LDE4NC4yMzQ0LDI0Ny45MDY0LDE3NC4yMzQ0LDI0My45MDY0LDE3OC4yMzQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI0My45MDY0IiB4Mj0iMjQzLjkwNjQiIHkxPSIyMTguMjAzMSIgeTI9IjIzOC4yMDMxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzkuOTA2NCwyMjguMjAzMSwyNDMuOTA2NCwyMzguMjAzMSwyNDcuOTA2NCwyMjguMjAzMSwyNDMuOTA2NCwyMzIuMjAzMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDMuOTA2NCIgeDI9IjI0My45MDY0IiB5MT0iMjcyLjE3MTkiIHkyPSIyOTIuMTcxOSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsMjgyLjE3MTksMjQzLjkwNjQsMjkyLjE3MTksMjQ3LjkwNjQsMjgyLjE3MTksMjQzLjkwNjQsMjg2LjE3MTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9IjgzLjk2ODgiIHkyPSIxMzAuMjY1NiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsMTIwLjI2NTYsMjQzLjkwNjQsMTMwLjI2NTYsMjQ3LjkwNjQsMTIwLjI2NTYsMjQzLjkwNjQsMTI0LjI2NTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9IjQxOC40MDYzIiB5Mj0iNDM4LjQwNjMiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzOS45MDY0LDQyOC40MDYzLDI0My45MDY0LDQzOC40MDYzLDI0Ny45MDY0LDQyOC40MDYzLDI0My45MDY0LDQzMi40MDYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI0My45MDY0IiB4Mj0iMjQzLjkwNjQiIHkxPSI0NzIuMzc1IiB5Mj0iNDkyLjM3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsNDgyLjM3NSwyNDMuOTA2NCw0OTIuMzc1LDI0Ny45MDY0LDQ4Mi4zNzUsMjQzLjkwNjQsNDg2LjM3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDMuOTA2NCIgeDI9IjI0My45MDY0IiB5MT0iNTI2LjM0MzgiIHkyPSI1NDYuMzQzOCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsNTM2LjM0MzgsMjQzLjkwNjQsNTQ2LjM0MzgsMjQ3LjkwNjQsNTM2LjM0MzgsMjQzLjkwNjQsNTQwLjM0MzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9IjMyNi4xNDA2IiB5Mj0iMzg0LjQzNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzOS45MDY0LDM3NC40Mzc1LDI0My45MDY0LDM4NC40Mzc1LDI0Ny45MDY0LDM3NC40Mzc1LDI0My45MDY0LDM3OC40Mzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI0My45MDY0IiB4Mj0iMjQzLjkwNjQiIHkxPSI2NzIuNTc4MSIgeTI9IjY5Mi41NzgxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzkuOTA2NCw2ODIuNTc4MSwyNDMuOTA2NCw2OTIuNTc4MSwyNDcuOTA2NCw2ODIuNTc4MSwyNDMuOTA2NCw2ODYuNTc4MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDMuOTA2NCIgeDI9IjI0My45MDY0IiB5MT0iNzI2LjU0NjkiIHkyPSI3NDYuNTQ2OSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsNzM2LjU0NjksMjQzLjkwNjQsNzQ2LjU0NjksMjQ3LjkwNjQsNzM2LjU0NjksMjQzLjkwNjQsNzQwLjU0NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9Ijc4MC41MTU2IiB5Mj0iODAwLjUxNTYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzOS45MDY0LDc5MC41MTU2LDI0My45MDY0LDgwMC41MTU2LDI0Ny45MDY0LDc5MC41MTU2LDI0My45MDY0LDc5NC41MTU2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI0My45MDY0IiB4Mj0iMjQzLjkwNjQiIHkxPSI4MzQuNDg0NCIgeTI9Ijg1NC40ODQ0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzkuOTA2NCw4NDQuNDg0NCwyNDMuOTA2NCw4NTQuNDg0NCwyNDcuOTA2NCw4NDQuNDg0NCwyNDMuOTA2NCw4NDguNDg0NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDMuOTA2NCIgeDI9IjI0My45MDY0IiB5MT0iNTgwLjMxMjUiIHkyPSI2MzguNjA5NCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsNjI4LjYwOTQsMjQzLjkwNjQsNjM4LjYwOTQsMjQ3LjkwNjQsNjI4LjYwOTQsMjQzLjkwNjQsNjMyLjYwOTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9Ijk4MC43MTg4IiB5Mj0iMTAwMC43MTg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzkuOTA2NCw5OTAuNzE4OCwyNDMuOTA2NCwxMDAwLjcxODgsMjQ3LjkwNjQsOTkwLjcxODgsMjQzLjkwNjQsOTk0LjcxODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9IjEwMzQuNjg3NSIgeTI9IjEwNTQuNjg3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsMTA0NC42ODc1LDI0My45MDY0LDEwNTQuNjg3NSwyNDcuOTA2NCwxMDQ0LjY4NzUsMjQzLjkwNjQsMTA0OC42ODc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI0My45MDY0IiB4Mj0iMjQzLjkwNjQiIHkxPSIxMDg4LjY1NjMiIHkyPSIxMTA4LjY1NjMiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzOS45MDY0LDEwOTguNjU2MywyNDMuOTA2NCwxMTA4LjY1NjMsMjQ3LjkwNjQsMTA5OC42NTYzLDI0My45MDY0LDExMDIuNjU2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNTIuMjcwOSIgeDI9IjE1Mi4yNzA5IiB5MT0iMTIzMC41OTM4IiB5Mj0iMTI1MC41OTM4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDguMjcwOSwxMjQwLjU5MzgsMTUyLjI3MDksMTI1MC41OTM4LDE1Ni4yNzA5LDEyNDAuNTkzOCwxNTIuMjcwOSwxMjQ0LjU5MzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjAxLjQ4NzQiIHgyPSIxNTIuMjcwOSIgeTE9IjExNzQuNjI1IiB5Mj0iMTE3NC42MjUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTUyLjI3MDkiIHgyPSIxNTIuMjcwOSIgeTE9IjExNzQuNjI1IiB5Mj0iMTE5Ni42MjUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE0OC4yNzA5LDExODYuNjI1LDE1Mi4yNzA5LDExOTYuNjI1LDE1Ni4yNzA5LDExODYuNjI1LDE1Mi4yNzA5LDExOTAuNjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI4Ni4zMjU0IiB4Mj0iMzM1LjU0MTkiIHkxPSIxMTc0LjYyNSIgeTI9IjExNzQuNjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMzNS41NDE5IiB4Mj0iMzM1LjU0MTkiIHkxPSIxMTc0LjYyNSIgeTI9IjExOTYuNjI1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMzEuNTQxOSwxMTg2LjYyNSwzMzUuNTQxOSwxMTk2LjYyNSwzMzkuNTQxOSwxMTg2LjYyNSwzMzUuNTQxOSwxMTkwLjYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNTIuMjcwOSIgeDI9IjE1Mi4yNzA5IiB5MT0iMTI4NC41NjI1IiB5Mj0iMTMwMi41NjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE1Mi4yNzA5IiB4Mj0iMjMxLjkwNjQiIHkxPSIxMzAyLjU2MjUiIHkyPSIxMzAyLjU2MjUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIyMS45MDY0LDEyOTguNTYyNSwyMzEuOTA2NCwxMzAyLjU2MjUsMjIxLjkwNjQsMTMwNi41NjI1LDIyNS45MDY0LDEzMDIuNTYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMzUuNTQxOSIgeDI9IjMzNS41NDE5IiB5MT0iMTIzMC41OTM4IiB5Mj0iMTMwMi41NjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMzNS41NDE5IiB4Mj0iMjU1LjkwNjQiIHkxPSIxMzAyLjU2MjUiIHkyPSIxMzAyLjU2MjUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI2NS45MDY0LDEyOTguNTYyNSwyNTUuOTA2NCwxMzAyLjU2MjUsMjY1LjkwNjQsMTMwNi41NjI1LDI2MS45MDY0LDEzMDIuNTYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDMuOTA2NCIgeDI9IjI0My45MDY0IiB5MT0iMTE0Mi42MjUiIHkyPSIxMTYyLjYyNSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsMTE1Mi42MjUsMjQzLjkwNjQsMTE2Mi42MjUsMjQ3LjkwNjQsMTE1Mi42MjUsMjQzLjkwNjQsMTE1Ni42MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9Ijg4OC40NTMxIiB5Mj0iOTQ2Ljc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzkuOTA2NCw5MzYuNzUsMjQzLjkwNjQsOTQ2Ljc1LDI0Ny45MDY0LDkzNi43NSwyNDMuOTA2NCw5NDAuNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9IjE0MjguOTMzNiIgeTI9IjE0NDguOTMzNiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsMTQzOC45MzM2LDI0My45MDY0LDE0NDguOTMzNiwyNDcuOTA2NCwxNDM4LjkzMzYsMjQzLjkwNjQsMTQ0Mi45MzM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI0My45MDY0IiB4Mj0iMjQzLjkwNjQiIHkxPSIxMzcwLjU2MjUiIHkyPSIxMzk0Ljk2NDgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzOS45MDY0LDEzODQuOTY0OCwyNDMuOTA2NCwxMzk0Ljk2NDgsMjQ3LjkwNjQsMTM4NC45NjQ4LDI0My45MDY0LDEzODguOTY0OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyODYuMDc4NCIgeDI9IjMxNi4wODY3IiB5MT0iMTM1OC41NjI1IiB5Mj0iMTM1OC41NjI1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMDYuMDg2NywxMzU0LjU2MjUsMzE2LjA4NjcsMTM1OC41NjI1LDMwNi4wODY3LDEzNjIuNTYyNSwzMTAuMDg2NywxMzU4LjU2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQzLjkwNjQiIHgyPSIyNDMuOTA2NCIgeTE9IjE0ODIuOTAyMyIgeTI9IjE1MDIuOTAyMyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjM5LjkwNjQsMTQ5Mi45MDIzLDI0My45MDY0LDE1MDIuOTAyMywyNDcuOTA2NCwxNDkyLjkwMjMsMjQzLjkwNjQsMTQ5Ni45MDIzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI0My45MDY0IiB4Mj0iMjQzLjkwNjQiIHkxPSIxMzE0LjU2MjUiIHkyPSIxMzQ2LjU2MjUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzOS45MDY0LDEzMzYuNTYyNSwyNDMuOTA2NCwxMzQ2LjU2MjUsMjQ3LjkwNjQsMTMzNi41NjI1LDI0My45MDY0LDEzNDAuNTYyNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwhLS1TUkM9W1pQRkRKamowNThOdFZlZUhndFoxMnlISXNMSmdhV2hyMVRCNjRQUTI3VGJjS0xNTENaQ2FrQzZxNTFnZzg4R0xZRGVhUkdtZUxUTTRsdFZYUGVwejVmcVAxb1VqZUVma1ZDLXp6dG5kUjNqa21OUUxfOGxiZnlqMC1xMTZHQnN4dXQ3U3R6T0tmUzhybXBLaTRvc2l3NE5xVkJOV3cwbGVaUDlkZFZFZS1IYmVGSHNPTjFyNnRld2N2QUYzVzV0TjBCVTBSQjZqOWd5M3NNTlhtVHJySndmTFRsT1hRVXEwM2hEUDhFVDBCX2NQRHNINTVXUG5zcVV0ekxzS01qcVpsVnEzd2ZjanctT1NMY2VXWGF6Z3ktaTAtcWRyVzNFYjNLMjZtZkEtdXByOURNM1pCc29acHNlVUwzN1JtXzZtM19YcUNsT3ZQVkl6X0dXTXB5aVFtU0RPQXRnZnlDZ3J4M2FvU1JVcTJRR0R2MUo4Wk5tUzBaYUoxOWxSU01TcE9xZlE3VlItV2pWWnhZM2tVV0JZcXVaalJxWUVadDk5SnRPVW9HcVo3WWQxRlVSbF9ubHF2bzNveVQtV3F4R0swX2FBYjdBczVGUVVIUFd0VngyaE92R3BBc2w4TlpUSG9SQk4yZ3dnSklGbkhjeWNiV3JwQWtxMV9TT05wQUlOd3FRdmdDdXBwWkhOVHlJT0tLOHY4NXNXQ1h5Y0cxZkJBZDlOLUlsRWxUT1RMU2JGUmk5ZVNBOWIxeEl1LTBKejd3dlVUZEhVampIZmw0M2FmSHVOcEE5SDRsU1l4Q0xsbTQ5X0NndmRwZEE0Vm1UeWtMMEpfMmpnNzZhRmI1QU9IX3dDcjV3Y1M1b2hhaGgtMVcwMF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h2 id="_4">実装順序<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="phase-3">Phase 3: 開発フェーズ<a class="headerlink" href="#phase-3" title="Permanent link">&para;</a></h3>
<h4 id="iteration-1-mvp">Iteration 1: ゲーム基盤（MVP）<a class="headerlink" href="#iteration-1-mvp" title="Permanent link">&para;</a></h4>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9Ijg2OXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6Mjg5cHg7aGVpZ2h0Ojg2OXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI4OSA4NjkiIHdpZHRoPSIyODlweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIFdlZWsgMTogPz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJXZWVrIDEuIC4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNyIgZGF0YS11aWQ9ImVudDAwMDIiIGlkPSJjbHVzdGVyX1dlZWsgMS4gLi4uLi4uLi4uIj48cGF0aCBkPSJNMzguNSw2IEwyMzQuMzMwNSw2IEEzLjc1LDMuNzUgMCAwIDEgMjM2LjgzMDUsOC41IEwyNDMuODMwNSwyOC4yOTY5IEwyNDkuNSwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDI1MiwzMC43OTY5IEwyNTIsNDE5LjY4IEEyLjUsMi41IDAgMCAxIDI0OS41LDQyMi4xOCBMMzguNSw0MjIuMTggQTIuNSwyLjUgMCAwIDEgMzYsNDE5LjY4IEwzNiw4LjUgQTIuNSwyLjUgMCAwIDEgMzguNSw2IiBmaWxsPSIjRkZFNkNDIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIzNiIgeDI9IjI0My44MzA1IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk0LjgzMDUiIHg9IjQwIiB5PSIyMC45OTUxIj5XZWVrIDE6ICYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMxMjUxNDsmIzEyNDg3OyYjMTI1MjM7JiMyMzQ1NTsmIzM1MDEzOzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgV2VlayAyOiA/P1VJPz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJXZWVrIDIuIC4uVUkuLi4iIGRhdGEtc291cmNlLWxpbmU9IjEzIiBkYXRhLXVpZD0iZW50MDAxMCIgaWQ9ImNsdXN0ZXJfV2VlayAyLiAuLlVJLi4uIj48cGF0aCBkPSJNOC41LDQ0Ni4xOCBMMTY0LjkwNzksNDQ2LjE4IEEzLjc1LDMuNzUgMCAwIDEgMTY3LjQwNzksNDQ4LjY4IEwxNzQuNDA3OSw0NjguNDc2OSBMMjc5LjUsNDY4LjQ3NjkgQTIuNSwyLjUgMCAwIDEgMjgyLDQ3MC45NzY5IEwyODIsODU5Ljg3IEEyLjUsMi41IDAgMCAxIDI3OS41LDg2Mi4zNyBMOC41LDg2Mi4zNyBBMi41LDIuNSAwIDAgMSA2LDg1OS44NyBMNiw0NDguNjggQTIuNSwyLjUgMCAwIDEgOC41LDQ0Ni4xOCIgZmlsbD0iI0U2RjNGRiIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE3NC40MDc5IiB5MT0iNDY4LjQ3NjkiIHkyPSI0NjguNDc2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTUuNDA3OSIgeD0iMTAiIHk9IjQ2MS4xNzUxIj5XZWVrIDI6ICYjMjI1MjI7JiMyNjQxMjtVSSYjMTI1Mzk7JiMzMjExMzsmIzIxNTEyOzwvdGV4dD48L2c+PCEtLWVudGl0eSAxLiBQdXlvID8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSIxLiBQdXlvIC4uLiIgZGF0YS1zb3VyY2UtbGluZT0iOCIgZGF0YS11aWQ9ImVudDAwMDMiIGlkPSJlbnRpdHlfMS4gUHV5byAuLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM4LjQyMzYiIHg9Ijc0Ljc5IiB5PSI0MSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxOTMuMjEzNiIgeT0iNDYiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE5MS4yMTM2IiB5PSI0OCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTkxLjIxMzYiIHk9IjUyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTguNDIzNiIgeD0iODkuNzkiIHk9IjczLjk5NTEiPjEuIFB1eW8gJiMxMjQ2MzsmIzEyNTIxOyYjMTI0NzM7PC90ZXh0PjwvZz48IS0tZW50aXR5IDIuIEZpZWxkID8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSIyLiBGaWVsZCAuLi4iIGRhdGEtc291cmNlLWxpbmU9IjgiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iZW50aXR5XzIuIEZpZWxkIC4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzcuNTg5NyIgeD0iNzUuMjEiIHk9IjE0Ny4yOSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxOTIuNzk5NyIgeT0iMTUyLjI5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxOTAuNzk5NyIgeT0iMTU0LjI5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxOTAuNzk5NyIgeT0iMTU4LjI5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuNTg5NyIgeD0iOTAuMjEiIHk9IjE4MC4yODUxIj4yLiBGaWVsZCAmIzEyNDYzOyYjMTI1MjE7JiMxMjQ3Mzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgMy4gR2FtZSA/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iMy4gR2FtZSAuLi4iIGRhdGEtc291cmNlLWxpbmU9IjkiIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iZW50aXR5XzMuIEdhbWUgLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0NS45MzYzIiB4PSI3MS4wMyIgeT0iMjUzLjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE5Ni45NjYzIiB5PSIyNTguNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE5NC45NjYzIiB5PSIyNjAuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE5NC45NjYzIiB5PSIyNjQuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDUuOTM2MyIgeD0iODYuMDMiIHk9IjI4Ni41ODUxIj4zLiBHYW1lICYjMTI0NjM7JiMxMjUyMTsmIzEyNDczOzwvdGV4dD48L2c+PCEtLWVudGl0eSA0LiA/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iNC4gLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxMCIgZGF0YS11aWQ9ImVudDAwMDgiIGlkPSJlbnRpdHlfNC4gLi4uLi4uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE4My44MDcxIiB4PSI1Mi4xIiB5PSIzNTkuODkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjE1LjkwNzEiIHk9IjM2NC44OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjEzLjkwNzEiIHk9IjM2Ni44OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjEzLjkwNzEiIHk9IjM3MC44OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0My44MDcxIiB4PSI2Ny4xIiB5PSIzOTIuODg1MSI+NC4gJiMyMjUyMjsmIzI2NDEyOyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7PC90ZXh0PjwvZz48IS0tZW50aXR5IDUuIEdhbWVCb2FyZCA/Pz8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IjUuIEdhbWVCb2FyZCAuLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgZGF0YS11aWQ9ImVudDAwMTEiIGlkPSJlbnRpdHlfNS4gR2FtZUJvYXJkIC4uLi4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjQzLjMyNzciIHg9IjIyLjM0IiB5PSI0ODEuMTgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjQ1LjY2NzciIHk9IjQ4Ni4xOCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjQzLjY2NzciIHk9IjQ4OC4xOCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjQzLjY2NzciIHk9IjQ5Mi4xOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwMy4zMjc3IiB4PSIzNy4zNCIgeT0iNTE0LjE3NTEiPjUuIEdhbWVCb2FyZCAmIzEyNDY3OyYjMTI1MzE7JiMxMjUwOTsmIzEyNTQwOyYjMTI0OTM7JiMxMjUzMTsmIzEyNDg4OzwvdGV4dD48L2c+PCEtLWVudGl0eSA2LiA/Pz8/IChadXN0YW5kKS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSI2LiAuLi4uIC5adXN0YW5kLiIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGRhdGEtdWlkPSJlbnQwMDEyIiBpZD0iZW50aXR5XzYuIC4uLi4gLlp1c3RhbmQuIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE4Ni43NjczIiB4PSI1MC42MiIgeT0iNTg3LjQ4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjIxNy4zODczIiB5PSI1OTIuNDgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIxNS4zODczIiB5PSI1OTQuNDgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIxNS4zODczIiB5PSI1OTguNDgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDYuNzY3MyIgeD0iNjUuNjIiIHk9IjYyMC40NzUxIj42LiAmIzI5MzY2OyYjMjQ5MDc7JiMzMTY0OTsmIzI5NzAyOyAoWnVzdGFuZCk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgNy4gPz8/Pz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSI3LiAuLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgZGF0YS11aWQ9ImVudDAwMTQiIGlkPSJlbnRpdHlfNy4gLi4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTUuODA3MiIgeD0iNjYuMSIgeT0iNjkzLjc4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjIwMS45MDcyIiB5PSI2OTguNzgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE5OS45MDcyIiB5PSI3MDAuNzgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE5OS45MDcyIiB5PSI3MDQuNzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTUuODA3MiIgeD0iODEuMSIgeT0iNzI2Ljc3NTEiPjcuICYjMTI0NjE7JiMxMjU0MDsmIzEyNTA4OyYjMTI1NDA7JiMxMjQ4OTsmIzIwODM3OyYjMjExNDc7PC90ZXh0PjwvZz48IS0tZW50aXR5IDguID8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IjguIC4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgZGF0YS11aWQ9ImVudDAwMTYiIGlkPSJlbnRpdHlfOC4gLi4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI3LjgwNzMiIHg9IjgwLjEiIHk9IjgwMC4wNyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxODcuOTA3MyIgeT0iODA1LjA3Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxODUuOTA3MyIgeT0iODA3LjA3Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxODUuOTA3MyIgeT0iODExLjA3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODcuODA3MyIgeD0iOTUuMSIgeT0iODMzLjA2NTEiPjguICYjMzIxMTM7JiMyMTUxMjsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODs8L3RleHQ+PC9nPjwhLS1saW5rIDEuIFB1eW8gPz8/IHRvIDIuIEZpZWxkID8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIxLiBQdXlvIC4uLiIgZGF0YS1lbnRpdHktMj0iMi4gRmllbGQgLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI4IiBkYXRhLXVpZD0ibG5rNSIgaWQ9ImxpbmtfMS4gUHV5byAuLi5fMi4gRmllbGQgLi4uIj48cGF0aCBkPSJNMTQ0LDg3Ljc3IEMxNDQsMTA1LjI3IDE0NCwxMjMuMzcgMTQ0LDE0MC44NSIgZmlsbD0ibm9uZSIgaWQ9IjEuIFB1eW8gJiMxMjQ2MzsmIzEyNTIxOyYjMTI0NzM7LXRvLTIuIEZpZWxkICYjMTI0NjM7JiMxMjUyMTsmIzEyNDczOyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQ0LDE0Ni44NSwxNDgsMTM3Ljg1LDE0NCwxNDEuODUsMTQwLDEzNy44NSwxNDQsMTQ2Ljg1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIDIuIEZpZWxkID8/PyB0byAzLiBHYW1lID8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIyLiBGaWVsZCAuLi4iIGRhdGEtZW50aXR5LTI9IjMuIEdhbWUgLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI5IiBkYXRhLXVpZD0ibG5rNyIgaWQ9ImxpbmtfMi4gRmllbGQgLi4uXzMuIEdhbWUgLi4uIj48cGF0aCBkPSJNMTQ0LDE5NC4wNyBDMTQ0LDIxMS41NyAxNDQsMjI5LjY3IDE0NCwyNDcuMTUiIGZpbGw9Im5vbmUiIGlkPSIyLiBGaWVsZCAmIzEyNDYzOyYjMTI1MjE7JiMxMjQ3MzstdG8tMy4gR2FtZSAmIzEyNDYzOyYjMTI1MjE7JiMxMjQ3MzsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE0NCwyNTMuMTUsMTQ4LDI0NC4xNSwxNDQsMjQ4LjE1LDE0MCwyNDQuMTUsMTQ0LDI1My4xNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayAzLiBHYW1lID8/PyB0byA0LiA/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iMy4gR2FtZSAuLi4iIGRhdGEtZW50aXR5LTI9IjQuIC4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGRhdGEtdWlkPSJsbms5IiBpZD0ibGlua18zLiBHYW1lIC4uLl80LiAuLi4uLi4uLi4iPjxwYXRoIGQ9Ik0xNDQsMzAwLjM3IEMxNDQsMzE3Ljg2IDE0NCwzMzUuOTYgMTQ0LDM1My40NSIgZmlsbD0ibm9uZSIgaWQ9IjMuIEdhbWUgJiMxMjQ2MzsmIzEyNTIxOyYjMTI0NzM7LXRvLTQuICYjMjI1MjI7JiMyNjQxMjsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQ0LDM1OS40NSwxNDgsMzUwLjQ1LDE0NCwzNTQuNDUsMTQwLDM1MC40NSwxNDQsMzU5LjQ1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIDUuIEdhbWVCb2FyZCA/Pz8/Pz8/IHRvIDYuID8/Pz8gKFp1c3RhbmQpLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IjUuIEdhbWVCb2FyZCAuLi4uLi4uIiBkYXRhLWVudGl0eS0yPSI2LiAuLi4uIC5adXN0YW5kLiIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGRhdGEtdWlkPSJsbmsxMyIgaWQ9ImxpbmtfNS4gR2FtZUJvYXJkIC4uLi4uLi5fNi4gLi4uLiAuWnVzdGFuZC4iPjxwYXRoIGQ9Ik0xNDQsNTI3Ljk2IEMxNDQsNTQ1LjQ2IDE0NCw1NjMuNTYgMTQ0LDU4MS4wNCIgZmlsbD0ibm9uZSIgaWQ9IjUuIEdhbWVCb2FyZCAmIzEyNDY3OyYjMTI1MzE7JiMxMjUwOTsmIzEyNTQwOyYjMTI0OTM7JiMxMjUzMTsmIzEyNDg4Oy10by02LiAmIzI5MzY2OyYjMjQ5MDc7JiMzMTY0OTsmIzI5NzAyOyAoWnVzdGFuZCkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE0NCw1ODcuMDQsMTQ4LDU3OC4wNCwxNDQsNTgyLjA0LDE0MCw1NzguMDQsMTQ0LDU4Ny4wNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA2LiA/Pz8/IChadXN0YW5kKSB0byA3LiA/Pz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IjYuIC4uLi4gLlp1c3RhbmQuIiBkYXRhLWVudGl0eS0yPSI3LiAuLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgZGF0YS11aWQ9ImxuazE1IiBpZD0ibGlua182LiAuLi4uIC5adXN0YW5kLl83LiAuLi4uLi4uIj48cGF0aCBkPSJNMTQ0LDYzNC4yNiBDMTQ0LDY1MS43NSAxNDQsNjY5Ljg2IDE0NCw2ODcuMzQiIGZpbGw9Im5vbmUiIGlkPSI2LiAmIzI5MzY2OyYjMjQ5MDc7JiMzMTY0OTsmIzI5NzAyOyAoWnVzdGFuZCktdG8tNy4gJiMxMjQ2MTsmIzEyNTQwOyYjMTI1MDg7JiMxMjU0MDsmIzEyNDg5OyYjMjA4Mzc7JiMyMTE0NzsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE0NCw2OTMuMzQsMTQ4LDY4NC4zNCwxNDQsNjg4LjM0LDE0MCw2ODQuMzQsMTQ0LDY5My4zNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA3LiA/Pz8/Pz8/IHRvIDguID8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IjcuIC4uLi4uLi4iIGRhdGEtZW50aXR5LTI9IjguIC4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgZGF0YS11aWQ9ImxuazE3IiBpZD0ibGlua183LiAuLi4uLi4uXzguIC4uLi4uIj48cGF0aCBkPSJNMTQ0LDc0MC41NiBDMTQ0LDc1OC4wNSAxNDQsNzc2LjE1IDE0NCw3OTMuNjMiIGZpbGw9Im5vbmUiIGlkPSI3LiAmIzEyNDYxOyYjMTI1NDA7JiMxMjUwODsmIzEyNTQwOyYjMTI0ODk7JiMyMDgzNzsmIzIxMTQ3Oy10by04LiAmIzMyMTEzOyYjMjE1MTI7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDQsNzk5LjYzLDE0OCw3OTAuNjMsMTQ0LDc5NC42MywxNDAsNzkwLjYzLDE0NCw3OTkuNjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgNC4gPz8/Pz8/Pz8/IHRvIDUuIEdhbWVCb2FyZCA/Pz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IjQuIC4uLi4uLi4uLiIgZGF0YS1lbnRpdHktMj0iNS4gR2FtZUJvYXJkIC4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjE5IiBkYXRhLXVpZD0ibG5rMTgiIGlkPSJsaW5rXzQuIC4uLi4uLi4uLl81LiBHYW1lQm9hcmQgLi4uLi4uLiI+PHBhdGggZD0iTTE0NCw0MDYuNDcgQzE0NCw0MjcuOCAxNDQsNDUzLjcgMTQ0LDQ3NC45OSIgZmlsbD0ibm9uZSIgaWQ9IjQuICYjMjI1MjI7JiMyNjQxMjsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4Oy10by01LiBHYW1lQm9hcmQgJiMxMjQ2NzsmIzEyNTMxOyYjMTI1MDk7JiMxMjU0MDsmIzEyNDkzOyYjMTI1MzE7JiMxMjQ4ODsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE0NCw0ODAuOTksMTQ4LDQ3MS45OSwxNDQsNDc1Ljk5LDE0MCw0NzEuOTksMTQ0LDQ4MC45OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tU1JDPVtaTDFCSW05SDVEeFZOdDZxSklxU0tDbDJITTNjWDUwZ0dXSTluQU12c2cyRXVZR0hxTU9rRllEbWRvN3NNNEhmWDFJel9pclhkN3Y2cXVvNUxiQVJvLUx5Wl9Eem5vNm5iQW1tTTh3azFTQUhoTTFxREhnN0FMNEMtTzkxdVhZMldMWmk0bWR2SEF5ZVZZN1hZMVdGWjYyY1pYMHI4b2k1TWdHdks3VWViRC1KYkpJYVE1UGJYMUplVGVRYzZKV3Q2Q2swc21fOHd5V3hnNXFXeG9DX0dydjVWZ3R0c2NfZFBVVHVnMEVJUzBpR0EtdGQwUkxSdjVVZUZJTjF2TGc0WDRTMEtNUFBRR0dXbG1yampiVTA1UGZaTy1JVkN2aXhBdTNVVlh3cVJmMXRLTmo0cFlyNm5NR1dob045dVZUQTdsekdpMXY2X2NCU3QtZERjZEZhVzZRQkVObE5LZnVNRnlCcmhVUWRvNS1IN3JsX3NkMnZKbTJaeUowZTduY3paajZpbUZIY0lUc2JZWkhaMWZ3Q3NUZnZtUkprTWdPand3dGh2S2t6U005QTlxQXNTaTVxamNBRnJfcGg1QlJ1N3p0VTBHMDBdLS0+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h4 id="iteration-2">Iteration 2: 消去・連鎖システム<a class="headerlink" href="#iteration-2" title="Permanent link">&para;</a></h4>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9Ijg2OXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MjcycHg7aGVpZ2h0Ojg2OXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI3MiA4NjkiIHdpZHRoPSIyNzJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIFdlZWsgMTogPz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iV2VlayAxLiAuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfV2VlayAxLiAuLi4uIj48cGF0aCBkPSJNOC41LDYgTDEzNC4zMzA4LDYgQTMuNzUsMy43NSAwIDAgMSAxMzYuODMwOCw4LjUgTDE0My44MzA4LDI4LjI5NjkgTDI2MS41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgMjY0LDMwLjc5NjkgTDI2NCw0MTkuNjggQTIuNSwyLjUgMCAwIDEgMjYxLjUsNDIyLjE4IEw4LjUsNDIyLjE4IEEyLjUsMi41IDAgMCAxIDYsNDE5LjY4IEw2LDguNSBBMi41LDIuNSAwIDAgMSA4LjUsNiIgZmlsbD0iI0ZGRTZDQyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE0My44MzA4IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI0LjgzMDgiIHg9IjEwIiB5PSIyMC45OTUxIj5XZWVrIDE6ICYjMzY4OTk7JiMzNzc4MjsmIzI2OTA4OyYjMjA5ODY7PC90ZXh0PjwvZz48IS0tY2x1c3RlciBXZWVrIDI6ID8/Pz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJXZWVrIDIuIC4uLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgZGF0YS11aWQ9ImVudDAwMTAiIGlkPSJjbHVzdGVyX1dlZWsgMi4gLi4uLi4uLi4uLi4iPjxwYXRoIGQ9Ik0yOS41LDQ0Ni4xOCBMMjUzLjMzMDQsNDQ2LjE4IEEzLjc1LDMuNzUgMCAwIDEgMjU1LjgzMDQsNDQ4LjY4IEwyNjIuODMwNCw0NjguNDc2OSBMMjYyLjUsNDY4LjQ3NjkgQTIuNSwyLjUgMCAwIDEgMjY1LDQ3MC45NzY5IEwyNjUsODU5Ljg3IEEyLjUsMi41IDAgMCAxIDI2Mi41LDg2Mi4zNyBMMjkuNSw4NjIuMzcgQTIuNSwyLjUgMCAwIDEgMjcsODU5Ljg3IEwyNyw0NDguNjggQTIuNSwyLjUgMCAwIDEgMjkuNSw0NDYuMTgiIGZpbGw9IiNFNkYzRkYiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjI3IiB4Mj0iMjYyLjgzMDQiIHkxPSI0NjguNDc2OSIgeTI9IjQ2OC40NzY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyMi44MzA0IiB4PSIzMSIgeT0iNDYxLjE3NTEiPldlZWsgMjogJiMxMjQ3MzsmIzEyNDY3OyYjMTI0NTA7JiMxMjUzOTsmIzEyNDY2OyYjMTI1NDA7JiMxMjUxMjsmIzEyNDU4OyYjMTI1NDA7JiMxMjQ5NjsmIzEyNTQwOzwvdGV4dD48L2c+PCEtLWVudGl0eSAxLiA/Pz8/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iMS4gLi4uLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV8xLiAuLi4uLi4uLi4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjI1LjgwNjkiIHg9IjIyLjEiIHk9IjQxIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjIyNy45MDY5IiB5PSI0NiIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjI1LjkwNjkiIHk9IjQ4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIyMjUuOTA2OSIgeT0iNTIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODUuODA2OSIgeD0iMzcuMSIgeT0iNzMuOTk1MSI+MS4gJiMzNjg5OTsmIzMyMDgwOyYjMTI0MDc7JiMxMjQyNDsmIzI2OTA4OyYjMzIwMzQ7JiMxMjQ1MDsmIzEyNTIzOyYjMTI0Njg7JiMxMjUyMjsmIzEyNDc0OyYjMTI1MTI7PC90ZXh0PjwvZz48IS0tZW50aXR5IDIuID8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IjIuIC4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBkYXRhLXVpZD0iZW50MDAwNCIgaWQ9ImVudGl0eV8yLiAuLi4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjkuODA3MSIgeD0iNTAuMSIgeT0iMTQ3LjI5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE5OS45MDcxIiB5PSIxNTIuMjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE5Ny45MDcxIiB5PSIxNTQuMjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE5Ny45MDcxIiB5PSIxNTguMjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjkuODA3MSIgeD0iNjUuMSIgeT0iMTgwLjI4NTEiPjIuICYjMjgwNDA7JiMyMTQzNTsmIzIxMDI4OyYjMjM0NTA7JiMxMjUyNTsmIzEyNDcyOyYjMTI0ODM7JiMxMjQ2Mzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgMy4gPz8/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iMy4gLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjgiIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iZW50aXR5XzMuIC4uLi4uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE2OS44MDcxIiB4PSI1MC4xIiB5PSIyNTMuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTk5LjkwNzEiIHk9IjI1OC41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTk3LjkwNzEiIHk9IjI2MC41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTk3LjkwNzEiIHk9IjI2NC41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyOS44MDcxIiB4PSI2NS4xIiB5PSIyODYuNTg1MSI+My4gJiMzNzMyNTsmIzIxMTQ3OyYjMzY5Njk7JiMyOTk5MjsmIzEyNDcxOyYjMTI0NzM7JiMxMjQ4NjsmIzEyNTEyOzwvdGV4dD48L2c+PCEtLWVudGl0eSA0LiA/Pz8/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iNC4gLi4uLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI5IiBkYXRhLXVpZD0iZW50MDAwOCIgaWQ9ImVudGl0eV80LiAuLi4uLi4uLi4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjI1LjgwNjkiIHg9IjIyLjEiIHk9IjM1OS44OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIyMjcuOTA2OSIgeT0iMzY0Ljg5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIyMjUuOTA2OSIgeT0iMzY2Ljg5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIyMjUuOTA2OSIgeT0iMzcwLjg5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTg1LjgwNjkiIHg9IjM3LjEiIHk9IjM5Mi44ODUxIj40LiAmIzEyNDgxOyYjMTI0NTU7JiMxMjU0MDsmIzEyNTMxOyYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMxMjQ2OTsmIzEyNTQwOyYjMTI0OTk7JiMxMjQ3Mzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgNS4gPz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IjUuIC4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGRhdGEtdWlkPSJlbnQwMDExIiBpZD0iZW50aXR5XzUuIC4uLi4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxODMuODA3MSIgeD0iNDMuMSIgeT0iNDgxLjE4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjIwNi45MDcxIiB5PSI0ODYuMTgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIwNC45MDcxIiB5PSI0ODguMTgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIwNC45MDcxIiB5PSI0OTIuMTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuODA3MSIgeD0iNTguMSIgeT0iNTE0LjE3NTEiPjUuICYjMTI0NzM7JiMxMjQ2NzsmIzEyNDUwOyYjMzUzMzY7JiMzMTYzOTsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOzwvdGV4dD48L2c+PCEtLWVudGl0eSA2LiA/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iNi4gLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMTIiIGlkPSJlbnRpdHlfNi4gLi4uLi4uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MS44MDczIiB4PSI2NC4xIiB5PSI1ODcuNDgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTg1LjkwNzMiIHk9IjU5Mi40OCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTgzLjkwNzMiIHk9IjU5NC40OCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTgzLjkwNzMiIHk9IjU5OC40OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMS44MDczIiB4PSI3OS4xIiB5PSI2MjAuNDc1MSI+Ni4gJiMzNjg5OTsmIzM3NzgyOyYjMTI1MDg7JiMxMjU0MDsmIzEyNDkwOyYjMTI0NzM7PC90ZXh0PjwvZz48IS0tZW50aXR5IDcuID8/Pz8/Pz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSI3LiAuLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjE0IiBkYXRhLXVpZD0iZW50MDAxNCIgaWQ9ImVudGl0eV83LiAuLi4uLi4uLi4iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTgzLjgwNzEiIHg9IjQzLjEiIHk9IjY5My43OCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIyMDYuOTA3MSIgeT0iNjk4Ljc4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIyMDQuOTA3MSIgeT0iNzAwLjc4Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIyMDQuOTA3MSIgeT0iNzA0Ljc4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzLjgwNzEiIHg9IjU4LjEiIHk9IjcyNi43NzUxIj43LiAmIzEyNDY2OyYjMTI1NDA7JiMxMjUxMjsmIzEyNDU4OyYjMTI1NDA7JiMxMjQ5NjsmIzEyNTQwOyYjMjEwMjg7JiMyMzQ1MDs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgOC4gVUk/Pz8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IjguIFVJLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGRhdGEtdWlkPSJlbnQwMDE2IiBpZD0iZW50aXR5XzguIFVJLi4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzAuMTgzMiIgeD0iNDkuOTEiIHk9IjgwMC4wNyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIyMDAuMDkzMiIgeT0iODA1LjA3Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxOTguMDkzMiIgeT0iODA3LjA3Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxOTguMDkzMiIgeT0iODExLjA3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjE4MzIiIHg9IjY0LjkxIiB5PSI4MzMuMDY1MSI+OC4gVUkmIzMyMTEzOyYjMjE1MTI7JiMxMjUzOTsmIzMyMDgwOyYjMjY1MjQ7JiMzNDkyMDsmIzMxMDM0OzwvdGV4dD48L2c+PCEtLWxpbmsgMS4gPz8/Pz8/Pz8/Pz8/IHRvIDIuID8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IjEuIC4uLi4uLi4uLi4uLiIgZGF0YS1lbnRpdHktMj0iMi4gLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjciIGRhdGEtdWlkPSJsbms1IiBpZD0ibGlua18xLiAuLi4uLi4uLi4uLi5fMi4gLi4uLi4uLi4iPjxwYXRoIGQ9Ik0xMzUsODcuNzcgQzEzNSwxMDUuMjcgMTM1LDEyMy4zNyAxMzUsMTQwLjg1IiBmaWxsPSJub25lIiBpZD0iMS4gJiMzNjg5OTsmIzMyMDgwOyYjMTI0MDc7JiMxMjQyNDsmIzI2OTA4OyYjMzIwMzQ7JiMxMjQ1MDsmIzEyNTIzOyYjMTI0Njg7JiMxMjUyMjsmIzEyNDc0OyYjMTI1MTI7LXRvLTIuICYjMjgwNDA7JiMyMTQzNTsmIzIxMDI4OyYjMjM0NTA7JiMxMjUyNTsmIzEyNDcyOyYjMTI0ODM7JiMxMjQ2MzsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNSwxNDYuODUsMTM5LDEzNy44NSwxMzUsMTQxLjg1LDEzMSwxMzcuODUsMTM1LDE0Ni44NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayAyLiA/Pz8/Pz8/PyB0byAzLiA/Pz8/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSIyLiAuLi4uLi4uLiIgZGF0YS1lbnRpdHktMj0iMy4gLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjgiIGRhdGEtdWlkPSJsbms3IiBpZD0ibGlua18yLiAuLi4uLi4uLl8zLiAuLi4uLi4uLiI+PHBhdGggZD0iTTEzNSwxOTQuMDcgQzEzNSwyMTEuNTcgMTM1LDIyOS42NyAxMzUsMjQ3LjE1IiBmaWxsPSJub25lIiBpZD0iMi4gJiMyODA0MDsmIzIxNDM1OyYjMjEwMjg7JiMyMzQ1MDsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOy10by0zLiAmIzM3MzI1OyYjMjExNDc7JiMzNjk2OTsmIzI5OTkyOyYjMTI0NzE7JiMxMjQ3MzsmIzEyNDg2OyYjMTI1MTI7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzUsMjUzLjE1LDEzOSwyNDQuMTUsMTM1LDI0OC4xNSwxMzEsMjQ0LjE1LDEzNSwyNTMuMTUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgMy4gPz8/Pz8/Pz8gdG8gNC4gPz8/Pz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IjMuIC4uLi4uLi4uIiBkYXRhLWVudGl0eS0yPSI0LiAuLi4uLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjkiIGRhdGEtdWlkPSJsbms5IiBpZD0ibGlua18zLiAuLi4uLi4uLl80LiAuLi4uLi4uLi4uLi4iPjxwYXRoIGQ9Ik0xMzUsMzAwLjM3IEMxMzUsMzE3Ljg2IDEzNSwzMzUuOTYgMTM1LDM1My40NSIgZmlsbD0ibm9uZSIgaWQ9IjMuICYjMzczMjU7JiMyMTE0NzsmIzM2OTY5OyYjMjk5OTI7JiMxMjQ3MTsmIzEyNDczOyYjMTI0ODY7JiMxMjUxMjstdG8tNC4gJiMxMjQ4MTsmIzEyNDU1OyYjMTI1NDA7JiMxMjUzMTsmIzEyNDg5OyYjMTI1MTM7JiMxMjQ1MjsmIzEyNTMxOyYjMTI0Njk7JiMxMjU0MDsmIzEyNDk5OyYjMTI0NzM7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzUsMzU5LjQ1LDEzOSwzNTAuNDUsMTM1LDM1NC40NSwxMzEsMzUwLjQ1LDEzNSwzNTkuNDUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgNS4gPz8/Pz8/Pz8/IHRvIDYuID8/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSI1LiAuLi4uLi4uLi4iIGRhdGEtZW50aXR5LTI9IjYuIC4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGRhdGEtdWlkPSJsbmsxMyIgaWQ9ImxpbmtfNS4gLi4uLi4uLi4uXzYuIC4uLi4uLiI+PHBhdGggZD0iTTEzNSw1MjcuOTYgQzEzNSw1NDUuNDYgMTM1LDU2My41NiAxMzUsNTgxLjA0IiBmaWxsPSJub25lIiBpZD0iNS4gJiMxMjQ3MzsmIzEyNDY3OyYjMTI0NTA7JiMzNTMzNjsmIzMxNjM5OyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7LXRvLTYuICYjMzY4OTk7JiMzNzc4MjsmIzEyNTA4OyYjMTI1NDA7JiMxMjQ5MDsmIzEyNDczOyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM1LDU4Ny4wNCwxMzksNTc4LjA0LDEzNSw1ODIuMDQsMTMxLDU3OC4wNCwxMzUsNTg3LjA0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIDYuID8/Pz8/PyB0byA3LiA/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iNi4gLi4uLi4uIiBkYXRhLWVudGl0eS0yPSI3LiAuLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjE0IiBkYXRhLXVpZD0ibG5rMTUiIGlkPSJsaW5rXzYuIC4uLi4uLl83LiAuLi4uLi4uLi4iPjxwYXRoIGQ9Ik0xMzUsNjM0LjI2IEMxMzUsNjUxLjc1IDEzNSw2NjkuODYgMTM1LDY4Ny4zNCIgZmlsbD0ibm9uZSIgaWQ9IjYuICYjMzY4OTk7JiMzNzc4MjsmIzEyNTA4OyYjMTI1NDA7JiMxMjQ5MDsmIzEyNDczOy10by03LiAmIzEyNDY2OyYjMTI1NDA7JiMxMjUxMjsmIzEyNDU4OyYjMTI1NDA7JiMxMjQ5NjsmIzEyNTQwOyYjMjEwMjg7JiMyMzQ1MDsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNSw2OTMuMzQsMTM5LDY4NC4zNCwxMzUsNjg4LjM0LDEzMSw2ODQuMzQsMTM1LDY5My4zNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA3LiA/Pz8/Pz8/Pz8gdG8gOC4gVUk/Pz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IjcuIC4uLi4uLi4uLiIgZGF0YS1lbnRpdHktMj0iOC4gVUkuLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgZGF0YS11aWQ9ImxuazE3IiBpZD0ibGlua183LiAuLi4uLi4uLi5fOC4gVUkuLi4uLi4uIj48cGF0aCBkPSJNMTM1LDc0MC41NiBDMTM1LDc1OC4wNSAxMzUsNzc2LjE1IDEzNSw3OTMuNjMiIGZpbGw9Im5vbmUiIGlkPSI3LiAmIzEyNDY2OyYjMTI1NDA7JiMxMjUxMjsmIzEyNDU4OyYjMTI1NDA7JiMxMjQ5NjsmIzEyNTQwOyYjMjEwMjg7JiMyMzQ1MDstdG8tOC4gVUkmIzMyMTEzOyYjMjE1MTI7JiMxMjUzOTsmIzMyMDgwOyYjMjY1MjQ7JiMzNDkyMDsmIzMxMDM0OyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM1LDc5OS42MywxMzksNzkwLjYzLDEzNSw3OTQuNjMsMTMxLDc5MC42MywxMzUsNzk5LjYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIDQuID8/Pz8/Pz8/Pz8/PyB0byA1LiA/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iNC4gLi4uLi4uLi4uLi4uIiBkYXRhLWVudGl0eS0yPSI1LiAuLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjE4IiBkYXRhLXVpZD0ibG5rMTgiIGlkPSJsaW5rXzQuIC4uLi4uLi4uLi4uLl81LiAuLi4uLi4uLi4iPjxwYXRoIGQ9Ik0xMzUsNDA2LjQ3IEMxMzUsNDI3LjggMTM1LDQ1My43IDEzNSw0NzQuOTkiIGZpbGw9Im5vbmUiIGlkPSI0LiAmIzEyNDgxOyYjMTI0NTU7JiMxMjU0MDsmIzEyNTMxOyYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMxMjQ2OTsmIzEyNTQwOyYjMTI0OTk7JiMxMjQ3MzstdG8tNS4gJiMxMjQ3MzsmIzEyNDY3OyYjMTI0NTA7JiMzNTMzNjsmIzMxNjM5OyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzUsNDgwLjk5LDEzOSw0NzEuOTksMTM1LDQ3NS45OSwxMzEsNDcxLjk5LDEzNSw0ODAuOTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLVNSQz1bWkw1VEltOTE1N3NWTnA3UWlta2tQVTUzQng4QktJMDR1T0Q4QkJjUVI5ZGFHbXlIdjBwYTlZSDJPTDBJUVdrUGFMNWc3emdfa1FvaF93QlBzUThDcXJ3Nm9wdHRkN0ZsNkxUQ1pJVEpBV3ZCcWg5dEZIWFEyUXRZNkxjTV9DNFdTbHQwbjJ6Q3lpaS1NS09lZW9MSlFNTE5zU1FQSklNc2l2VEM5TjFTc1NnZTJBTUwzS3I5Z0RXVExiS0RVbUR1VTdXekI5SndIamRDVFRxWkxsaWV1WExpdEVlSzhWaTJINlRKTGhpNmYwUnEzYVdSUTBEODVzV2JZWnNVSEhtSDFUbl9yaXIycHpHRGl0YTF6MXg4QXIwQXYyNkE5ZzhFdHlWU1NZVGNfZEFPbFJORXdhMk92bmxHOHppMUpLR1RfZ28wV01RMXQwMXoxemUyVVdvcTJpSW1RekJYcExGNllRQTN0cGM4ME1vQmFIUV9oR1ZhWUt6TlczSHVLTUlsVW9IaDVpd1N5NHFRcjdNaFVKeGM5aF9tY0ozR0NmVkF5bXQtdzNrU1VManVwMFBFUzhteVBTMUhNSDNtc2ZCTFVKSUJFWms5X003X2dab2VyWXNab21GdVRyZ0VzZkhaRm0wMF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h2 id="_5">ドメイン層実装戦略<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="1_1">1. 関数型ドメインモデル<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h3>
<h4 id="11_1">1.1 純粋関数による値オブジェクト<a class="headerlink" href="#11_1" title="Permanent link">&para;</a></h4>
<p>関数型アプローチでは、値オブジェクトを純粋関数とイミュータブルデータで実装します。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 関数型スタイルのPuyo実装</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">PuyoData</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ファクトリ関数（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoData</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">validatePuyoColor</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span>
<span class="w">  </span><span class="nx">validatePosition</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">({</span><span class="w"> </span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="p">});</span>
<span class="p">};</span>

<span class="c1">// 純粋関数による操作</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoData</span><span class="p">,</span><span class="w"> </span><span class="nx">newPosition</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoData</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">newPosition</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isPuyoEqual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo1</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoData</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo2</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoData</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">puyo1</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">puyo2</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">isPositionEqual</span><span class="p">(</span><span class="nx">puyo1</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo2</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isPuyoAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoData</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">isPositionEqual</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isSameColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoData</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">color</span><span class="p">;</span>

<span class="c1">// TDDテストの例</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;関数型Puyo操作&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;createPuyoは不変なPuyoデータを生成する&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">isFrozen</span><span class="p">(</span><span class="nx">puyo</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;movePuyoは新しいPuyoインスタンスを返す&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">3</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">movedPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">newPosition</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">movedPuyo</span><span class="p">.</span><span class="nx">position</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">newPosition</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">({</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// 元のpuyoは変更されない</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">movedPuyo</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">puyo</span><span class="p">);</span><span class="w"> </span><span class="c1">// 新しいインスタンス</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="12-lodashfp">1.2 Lodash/fpによるデータ変換<a class="headerlink" href="#12-lodashfp" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 関数合成によるPuyo操作パイプライン</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">processPuyoGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">  </span><span class="c1">// ぷよリストを色でグループ化</span>
<span class="w">  </span><span class="nx">fp</span><span class="p">.</span><span class="nx">groupBy</span><span class="p">((</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">),</span>

<span class="w">  </span><span class="c1">// 各グループを連結ぷよ検索</span>
<span class="w">  </span><span class="nx">fp</span><span class="p">.</span><span class="nx">mapValues</span><span class="p">(</span><span class="nx">findConnectedPuyos</span><span class="p">),</span>

<span class="w">  </span><span class="c1">// 4個以上のグループのみフィルター</span>
<span class="w">  </span><span class="nx">fp</span><span class="p">.</span><span class="nx">pickBy</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">group</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">4</span><span class="p">),</span>

<span class="w">  </span><span class="c1">// フラットな配列に変換</span>
<span class="w">  </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flatten</span>
<span class="p">);</span>

<span class="c1">// カリー化された検索関数</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">findPuyosBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">predicate</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoData</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kt">boolean</span><span class="p">,</span><span class="w"> </span><span class="nx">puyos</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoData</span><span class="p">[])</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">puyos</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">predicate</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">findPuyosByColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">findPuyosBy</span><span class="p">(</span><span class="nx">isSameColor</span><span class="p">);</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">findPuyosAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">findPuyosBy</span><span class="p">(</span><span class="nx">isPuyoAt</span><span class="p">);</span>

<span class="c1">// 使用例</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">redPuyos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">findPuyosByColor</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">)(</span><span class="nx">allPuyos</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">puyosAtPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">findPuyosAt</span><span class="p">({</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="w"> </span><span class="p">})(</span><span class="nx">allPuyos</span><span class="p">);</span>
</code></pre></div>
<h3 id="2-entities">2. エンティティ（Entities）<a class="headerlink" href="#2-entities" title="Permanent link">&para;</a></h3>
<h4 id="field">Field実装例<a class="headerlink" href="#field" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Red: 失敗テスト</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Field&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;空のフィールドを作成できる&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given &amp; When</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Field</span><span class="p">.</span><span class="nx">createEmpty</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">getWidth</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">6</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">getHeight</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">12</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;指定位置にPuyoを配置できる&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Field</span><span class="p">.</span><span class="nx">createEmpty</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Position</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">placePuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">newField</span><span class="p">.</span><span class="nx">getPuyoAt</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Position</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">))).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">puyo</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Green: 最小実装</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kr">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">grid</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)[][],</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">12</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">createEmpty</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="mf">12</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">map</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="mf">6</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="kc">null</span><span class="p">));</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Field</span><span class="p">(</span><span class="nx">grid</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">isEmpty</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">grid</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">row</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">cell</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">cell</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">placePuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">copyGrid</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">();</span>
<span class="w">    </span><span class="nx">newGrid</span><span class="p">[</span><span class="nx">pos</span><span class="p">.</span><span class="nx">getY</span><span class="p">()][</span><span class="nx">pos</span><span class="p">.</span><span class="nx">getX</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">puyo</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Field</span><span class="p">(</span><span class="nx">newGrid</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">getPuyoAt</span><span class="p">(</span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">grid</span><span class="p">[</span><span class="nx">position</span><span class="p">.</span><span class="nx">getY</span><span class="p">()][</span><span class="nx">position</span><span class="p">.</span><span class="nx">getX</span><span class="p">()];</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3-domain-services">3. ドメインサービス（Domain Services）<a class="headerlink" href="#3-domain-services" title="Permanent link">&para;</a></h3>
<h4 id="chaindetectionservice">ChainDetectionService実装例<a class="headerlink" href="#chaindetectionservice" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Red: 失敗テスト</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ChainDetectionService&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;4つ以上の同色ぷよが隣接している場合、消去対象として検出される&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createFieldWithPattern</span><span class="p">([</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="p">]);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ChainDetectionService</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">detectErasableGroups</span><span class="p">(</span><span class="nx">field</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">size</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">4</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">color</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Green: 最小実装</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ChainDetectionService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">detectErasableGroups</span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoGroup</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">visited</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">erasableGroups</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoGroup</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">getHeight</span><span class="p">();</span><span class="w"> </span><span class="nx">y</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">getWidth</span><span class="p">();</span><span class="w"> </span><span class="nx">x</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Position</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">getPuyoAt</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">visited</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">toString</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">findConnectedGroup</span><span class="p">(</span>
<span class="w">            </span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">getColor</span><span class="p">(),</span><span class="w"> </span><span class="nx">visited</span>
<span class="w">          </span><span class="p">);</span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">erasableGroups</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">group</span><span class="p">);</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">erasableGroups</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">findConnectedGroup</span><span class="p">(</span>
<span class="w">    </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nx">startPos</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nx">visited</span><span class="o">:</span><span class="w"> </span><span class="kt">Set</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span>
<span class="w">  </span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoGroup</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 深度優先探索による連結ぷよ検索</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PuyoGroup</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">startPos</span><span class="p">];</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span><span class="o">!</span><span class="p">;</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">visited</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">currentPos</span><span class="p">.</span><span class="nx">toString</span><span class="p">()))</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">getPuyoAt</span><span class="p">(</span><span class="nx">currentPos</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">puyo</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">getColor</span><span class="p">()</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>

<span class="w">      </span><span class="nx">visited</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">currentPos</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">      </span><span class="nx">group</span><span class="p">.</span><span class="nx">addPuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// 隣接位置をスタックに追加</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentPos</span><span class="p">.</span><span class="nx">getNeighbors</span><span class="p">();</span>
<span class="w">      </span><span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">neighbors</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">pos</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">        </span><span class="nx">field</span><span class="p">.</span><span class="nx">isValidPosition</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">        </span><span class="o">!</span><span class="nx">visited</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
<span class="w">      </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">group</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_6">アプリケーション層実装戦略<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<h3 id="1-game-service">1. ゲームサービス（Game Service）<a class="headerlink" href="#1-game-service" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Red: 失敗テスト</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;GameService&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;ゲーム開始時に初期状態が正しく設定される&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createMockGameRepository</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GameService</span><span class="p">(</span><span class="nx">gameRepository</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">startNewGame</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">getGame</span><span class="p">(</span><span class="nx">gameId</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">getState</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">GameState</span><span class="p">.</span><span class="nx">READY</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">getScore</span><span class="p">().</span><span class="nx">getCurrent</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">getField</span><span class="p">().</span><span class="nx">isEmpty</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;プレイヤー入力を処理してゲーム状態を更新できる&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GameService</span><span class="p">(</span><span class="nx">createMockGameRepository</span><span class="p">());</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">startNewGame</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MovePuyoCommand</span><span class="p">(</span><span class="nx">Direction</span><span class="p">.</span><span class="nx">LEFT</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">handlePlayerInput</span><span class="p">(</span><span class="nx">gameId</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">isSuccess</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">getEvents</span><span class="p">()).</span><span class="nx">toContainEqual</span><span class="p">(</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">.</span><span class="nx">objectContaining</span><span class="p">({</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;PuyoMovedEvent&#39;</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Green: 最小実装</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">GameService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">gameRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">GameRepository</span><span class="p">,</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">chainDetectionService</span><span class="o">:</span><span class="w"> </span><span class="kt">ChainDetectionService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ChainDetectionService</span><span class="p">()</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="nx">startNewGame</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">GameId</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">GameId</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Game</span><span class="p">.</span><span class="nx">startNew</span><span class="p">(</span><span class="nx">gameId</span><span class="p">);</span>

<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">gameRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">game</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">gameId</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">handlePlayerInput</span><span class="p">(</span><span class="nx">gameId</span><span class="o">:</span><span class="w"> </span><span class="kt">GameId</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">InputCommand</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">gameRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">gameId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">game</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">GameResult</span><span class="p">.</span><span class="nx">failure</span><span class="p">(</span><span class="s1">&#39;Game not found&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">game</span><span class="p">.</span><span class="nx">handleInput</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">gameRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">game</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">GameResult</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="nx">events</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">getGame</span><span class="p">(</span><span class="nx">gameId</span><span class="o">:</span><span class="w"> </span><span class="kt">GameId</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Game</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">gameRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">gameId</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_7">プレゼンテーション層実装戦略<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<h3 id="1-react">1. Reactコンポーネント設計<a class="headerlink" href="#1-react" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// React Testing Library を使用したコンポーネントテスト</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;GameBoardComponent&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;フィールドの状態を正しく表示する&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createFieldWithPattern</span><span class="p">([</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">GameBoard</span><span class="w"> </span><span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">field</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByTestId</span><span class="p">(</span><span class="s1">&#39;puyo-0-0&#39;</span><span class="p">)).</span><span class="nx">toHaveClass</span><span class="p">(</span><span class="s1">&#39;puyo-red&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByTestId</span><span class="p">(</span><span class="s1">&#39;puyo-1-0&#39;</span><span class="p">)).</span><span class="nx">toHaveClass</span><span class="p">(</span><span class="s1">&#39;puyo-green&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByTestId</span><span class="p">(</span><span class="s1">&#39;puyo-0-1&#39;</span><span class="p">)).</span><span class="nx">toHaveClass</span><span class="p">(</span><span class="s1">&#39;puyo-blue&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByTestId</span><span class="p">(</span><span class="s1">&#39;puyo-1-1&#39;</span><span class="p">)).</span><span class="nx">toHaveClass</span><span class="p">(</span><span class="s1">&#39;puyo-yellow&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;キーボード入力を適切に処理する&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockHandleInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>
<span class="w">    </span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">GameBoard</span><span class="w"> </span><span class="nx">onInput</span><span class="o">=</span><span class="p">{</span><span class="nx">mockHandleInput</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="nx">fireEvent</span><span class="p">.</span><span class="nx">keyDown</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ArrowLeft&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockHandleInput</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">.</span><span class="nx">objectContaining</span><span class="p">({</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;MOVE_LEFT&#39;</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// コンポーネント実装</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">GameBoardProps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">;</span>
<span class="w">  </span><span class="nx">currentPuyo?</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">;</span>
<span class="w">  </span><span class="nx">onInput</span><span class="o">?:</span><span class="w"> </span><span class="p">(</span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">InputCommand</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">GameBoard</span><span class="o">:</span><span class="w"> </span><span class="kt">React.FC</span><span class="o">&lt;</span><span class="nx">GameBoardProps</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">field</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">currentPuyo</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onInput</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// キーボード入力ハンドリング</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleKeyDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="kt">KeyboardEvent</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mapKeyToCommand</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">command</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">onInput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">onInput</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleKeyDown</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleKeyDown</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">onInput</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;game-board&quot;</span><span class="w"> </span><span class="nx">data</span><span class="o">-</span><span class="nx">testid</span><span class="o">=</span><span class="s2">&quot;game-board&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">({</span><span class="w"> </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="kt">field.getHeight</span><span class="p">()</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">        </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">({</span><span class="w"> </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="kt">field.getWidth</span><span class="p">()</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Position</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
<span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">getPuyoAt</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>

<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span>
<span class="w">              </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="sb">`</span><span class="si">${</span><span class="nx">x</span><span class="si">}</span><span class="sb">-</span><span class="si">${</span><span class="nx">y</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">              </span><span class="nx">data</span><span class="o">-</span><span class="nx">testid</span><span class="o">=</span><span class="p">{</span><span class="sb">`puyo-</span><span class="si">${</span><span class="nx">x</span><span class="si">}</span><span class="sb">-</span><span class="si">${</span><span class="nx">y</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">              </span><span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="sb">`cell </span><span class="si">${</span><span class="nx">puyo</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`puyo-</span><span class="si">${</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">getColor</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;empty&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">}</span>
<span class="w">            </span><span class="o">/&gt;</span>
<span class="w">          </span><span class="p">);</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="2-zustand">2. 関数型状態管理（Zustand）<a class="headerlink" href="#2-zustand" title="Permanent link">&para;</a></h3>
<p>関数型アプローチでは、状態更新を純粋関数で行い、Immer等を使用してイミュータブルな更新を実現します。</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">immer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zustand/middleware/immer&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 関数型スタイルのゲーム状態</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">GameState</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">currentGame</span><span class="o">:</span><span class="w"> </span><span class="kt">GameData</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">gameStatus</span><span class="o">:</span><span class="w"> </span><span class="kt">GameStatus</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">history</span><span class="o">:</span><span class="w"> </span><span class="kt">GameData</span><span class="p">[];</span>
<span class="p">}</span>

<span class="c1">// ゲーム状態管理のアクション</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">GameActions</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">startNewGame</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">handleInput</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">InputCommand</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">resetGame</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="w">  </span><span class="nx">undoMove</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 純粋関数による状態更新関数</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">gameStateReducers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">startNewGame</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">GameState</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="p">...</span><span class="nx">state</span><span class="p">,</span>
<span class="w">    </span><span class="nx">currentGame</span><span class="o">:</span><span class="w"> </span><span class="kt">createInitialGame</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">gameStatus</span><span class="o">:</span><span class="w"> </span><span class="kt">GameStatus.PLAYING</span><span class="p">,</span>
<span class="w">    </span><span class="nx">history</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">}),</span>

<span class="w">  </span><span class="nx">updateGame</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">GameState</span><span class="p">,</span><span class="w"> </span><span class="nx">newGame</span><span class="o">:</span><span class="w"> </span><span class="kt">GameData</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="p">...</span><span class="nx">state</span><span class="p">,</span>
<span class="w">    </span><span class="nx">currentGame</span><span class="o">:</span><span class="w"> </span><span class="kt">newGame</span><span class="p">,</span>
<span class="w">    </span><span class="nx">history</span><span class="o">:</span><span class="w"> </span><span class="p">[...</span><span class="nx">state</span><span class="p">.</span><span class="nx">history</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">currentGame</span><span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// 最新10手を保持</span>
<span class="w">  </span><span class="p">}),</span>

<span class="w">  </span><span class="nx">resetGame</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">GameState</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">currentGame</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span><span class="p">,</span>
<span class="w">    </span><span class="nx">gameStatus</span><span class="o">:</span><span class="w"> </span><span class="kt">GameStatus.NOT_STARTED</span><span class="p">,</span>
<span class="w">    </span><span class="nx">history</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">}),</span>

<span class="w">  </span><span class="nx">undoMove</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">GameState</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameState</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">previousGame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">history</span><span class="p">[</span><span class="nx">state</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">previousGame</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">state</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">...</span><span class="nx">state</span><span class="p">,</span>
<span class="w">      </span><span class="nx">currentGame</span><span class="o">:</span><span class="w"> </span><span class="kt">previousGame</span><span class="p">,</span>
<span class="w">      </span><span class="nx">history</span><span class="o">:</span><span class="w"> </span><span class="kt">state.history.slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Zustandストアの作成</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">useGameStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">GameState</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">GameActions</span><span class="o">&gt;</span><span class="p">()(</span>
<span class="w">  </span><span class="nx">immer</span><span class="p">((</span><span class="nx">set</span><span class="p">,</span><span class="w"> </span><span class="nx">get</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="c1">// 初期状態</span>
<span class="w">    </span><span class="nx">currentGame</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span><span class="p">,</span>
<span class="w">    </span><span class="nx">gameStatus</span><span class="o">:</span><span class="w"> </span><span class="kt">GameStatus.NOT_STARTED</span><span class="p">,</span>
<span class="w">    </span><span class="nx">history</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>

<span class="w">    </span><span class="c1">// アクション（純粋関数を使用）</span>
<span class="w">    </span><span class="nx">startNewGame</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">set</span><span class="p">(</span><span class="nx">gameStateReducers</span><span class="p">.</span><span class="nx">startNewGame</span><span class="p">),</span>

<span class="w">    </span><span class="nx">handleInput</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">InputCommand</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">currentGame</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">get</span><span class="p">();</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">currentGame</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">      </span><span class="c1">// 純粋関数によるゲーム状態更新</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">newGame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">processGameCommand</span><span class="p">(</span><span class="nx">currentGame</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">);</span>
<span class="w">      </span><span class="nx">set</span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">gameStateReducers</span><span class="p">.</span><span class="nx">updateGame</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="nx">newGame</span><span class="p">));</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">resetGame</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">set</span><span class="p">(</span><span class="nx">gameStateReducers</span><span class="p">.</span><span class="nx">resetGame</span><span class="p">),</span>
<span class="w">    </span><span class="nx">undoMove</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">set</span><span class="p">(</span><span class="nx">gameStateReducers</span><span class="p">.</span><span class="nx">undoMove</span><span class="p">)</span>
<span class="w">  </span><span class="p">}))</span>
<span class="p">);</span>

<span class="c1">// 純粋関数によるゲーム処理</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">processGameCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">game</span><span class="o">:</span><span class="w"> </span><span class="kt">GameData</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">InputCommand</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameData</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">    </span><span class="nx">validateCommand</span><span class="p">(</span><span class="nx">command</span><span class="p">),</span>
<span class="w">    </span><span class="nx">applyCommand</span><span class="p">(</span><span class="nx">command</span><span class="p">),</span>
<span class="w">    </span><span class="nx">checkForChains</span><span class="p">,</span>
<span class="w">    </span><span class="nx">updateScore</span><span class="p">,</span>
<span class="w">    </span><span class="nx">checkGameOver</span>
<span class="w">  </span><span class="p">)(</span><span class="nx">game</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// コンポーネントでの使用（関数型スタイル）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">GameContainer</span><span class="o">:</span><span class="w"> </span><span class="kt">React.FC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useGameStore</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">GameView</span><span class="w"> </span>
<span class="w">      </span><span class="nx">gameState</span><span class="o">=</span><span class="p">{</span><span class="nx">gameState</span><span class="p">}</span>
<span class="w">      </span><span class="nx">onInput</span><span class="o">=</span><span class="p">{</span><span class="nx">gameState</span><span class="p">.</span><span class="nx">handleInput</span><span class="p">}</span>
<span class="w">      </span><span class="nx">onStart</span><span class="o">=</span><span class="p">{</span><span class="nx">gameState</span><span class="p">.</span><span class="nx">startNewGame</span><span class="p">}</span>
<span class="w">      </span><span class="nx">onReset</span><span class="o">=</span><span class="p">{</span><span class="nx">gameState</span><span class="p">.</span><span class="nx">resetGame</span><span class="p">}</span>
<span class="w">      </span><span class="nx">onUndo</span><span class="o">=</span><span class="p">{</span><span class="nx">gameState</span><span class="p">.</span><span class="nx">undoMove</span><span class="p">}</span>
<span class="w">    </span><span class="o">/&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// 純粋コンポーネント</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">GameView</span><span class="o">:</span><span class="w"> </span><span class="kt">React.FC</span><span class="o">&lt;</span><span class="nx">GameViewProps</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">gameState</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onInput</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onStart</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onReset</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onUndo</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">gameState</span><span class="p">.</span><span class="nx">gameStatus</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">GameStatus</span><span class="p">.</span><span class="nx">NOT_STARTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">StartScreen</span><span class="w"> </span><span class="nx">onStart</span><span class="o">=</span><span class="p">{</span><span class="nx">onStart</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">GameBoard</span><span class="w"> </span>
<span class="w">        </span><span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">gameState</span><span class="p">.</span><span class="nx">currentGame</span><span class="o">?</span><span class="p">.</span><span class="nx">field</span><span class="p">}</span>
<span class="w">        </span><span class="nx">currentPuyo</span><span class="o">=</span><span class="p">{</span><span class="nx">gameState</span><span class="p">.</span><span class="nx">currentGame</span><span class="o">?</span><span class="p">.</span><span class="nx">currentPuyo</span><span class="p">}</span>
<span class="w">        </span><span class="nx">onInput</span><span class="o">=</span><span class="p">{</span><span class="nx">onInput</span><span class="p">}</span>
<span class="w">      </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">GameControls</span><span class="w"> </span>
<span class="w">        </span><span class="nx">onReset</span><span class="o">=</span><span class="p">{</span><span class="nx">onReset</span><span class="p">}</span>
<span class="w">        </span><span class="nx">onUndo</span><span class="o">=</span><span class="p">{</span><span class="nx">onUndo</span><span class="p">}</span>
<span class="w">        </span><span class="nx">canUndo</span><span class="o">=</span><span class="p">{</span><span class="nx">gameState</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">}</span>
<span class="w">      </span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">ScoreDisplay</span><span class="w"> </span><span class="nx">score</span><span class="o">=</span><span class="p">{</span><span class="nx">gameState</span><span class="p">.</span><span class="nx">currentGame</span><span class="o">?</span><span class="p">.</span><span class="nx">score</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="_8">関数型テスト戦略実装<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="1_2">1. 純粋関数のテスト<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h3>
<p>関数型プログラミングでは、純粋関数が中心となるため、テストが非常に簡潔になります。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 純粋関数のテスト例</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;純粋関数のテスト&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;movePuyo: 純粋関数は同じ入力に対して常に同じ出力を返す&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Direction</span><span class="p">.</span><span class="nx">LEFT</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">direction</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">direction</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result1</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">result2</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result1</span><span class="p">.</span><span class="nx">position</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">({</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;calculateScore: 副作用がないため簡単にテストできる&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given &amp; When &amp; Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">calculateScore</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">40</span><span class="p">);</span><span class="w">  </span><span class="c1">// 基本スコア</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">calculateScore</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">90</span><span class="p">);</span><span class="w">  </span><span class="c1">// 2連鎖ボーナス</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">calculateScore</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">240</span><span class="p">);</span><span class="w"> </span><span class="c1">// 3連鎖ボーナス</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="2-property-based-testing">2. Property-Based Testing<a class="headerlink" href="#2-property-based-testing" title="Permanent link">&para;</a></h3>
<p>関数型プログラミングと相性の良いProperty-Based Testingを活用します。</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">fc</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fast-check&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Property-Based Testing&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;movePuyo: 移動後のぷよは元の色を保持する&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fc</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span>
<span class="w">      </span><span class="nx">fc</span><span class="p">.</span><span class="nx">constantFrom</span><span class="p">(...</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">)),</span><span class="w"> </span><span class="c1">// 色の生成</span>
<span class="w">      </span><span class="nx">fc</span><span class="p">.</span><span class="nx">record</span><span class="p">({</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">fc.integer</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">),</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">fc.integer</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">11</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="c1">// 位置の生成</span>
<span class="w">      </span><span class="nx">fc</span><span class="p">.</span><span class="nx">constantFrom</span><span class="p">(...</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">Direction</span><span class="p">)),</span><span class="w"> </span><span class="c1">// 方向の生成</span>
<span class="w">      </span><span class="p">(</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">direction</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">movedPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">direction</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">movedPuyo</span><span class="p">.</span><span class="nx">color</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span><span class="w"> </span><span class="c1">// 色は変わらない</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">movedPuyo</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">puyo</span><span class="p">);</span><span class="w">    </span><span class="c1">// 新しいインスタンス</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">));</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;処理チェーンの結合法則&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fc</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span>
<span class="w">      </span><span class="nx">fc</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">record</span><span class="p">({</span><span class="w"> </span>
<span class="w">        </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">fc.constantFrom</span><span class="p">(...</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">)),</span>
<span class="w">        </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">fc.record</span><span class="p">({</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">fc.integer</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">),</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">fc.integer</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">11</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="w">      </span><span class="p">})),</span>
<span class="w">      </span><span class="p">(</span><span class="nx">puyoDataList</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">puyoDataList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">position</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// 処理チェーンが結合法則を満たすことを確認</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">process1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span><span class="nx">filterRedPuyos</span><span class="p">,</span><span class="w"> </span><span class="nx">movePuyosDown</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">process2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span><span class="nx">movePuyosDown</span><span class="p">,</span><span class="w"> </span><span class="nx">filterRedPuyos</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 特定の条件下で結果が同じになることを確認</span>
<span class="w">        </span><span class="c1">// (この例では、赤ぷよ以外は移動に影響しない前提)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">puyos</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">puyo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">expect</span><span class="p">(</span><span class="nx">process1</span><span class="p">(</span><span class="nx">puyos</span><span class="p">)).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">process2</span><span class="p">(</span><span class="nx">puyos</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">));</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="3">3. 関数型テストデータビルダー<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">GameTestDataBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">game</span><span class="o">:</span><span class="w"> </span><span class="kt">Game</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Game</span><span class="p">.</span><span class="nx">startNew</span><span class="p">(</span><span class="nx">GameId</span><span class="p">.</span><span class="nx">generate</span><span class="p">());</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">withField</span><span class="p">(</span><span class="nx">pattern</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[][])</span><span class="o">:</span><span class="w"> </span><span class="nx">GameTestDataBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">FieldFactory</span><span class="p">.</span><span class="nx">createFromPattern</span><span class="p">(</span><span class="nx">pattern</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">withField</span><span class="p">(</span><span class="nx">field</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">withScore</span><span class="p">(</span><span class="nx">score</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameTestDataBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">withScore</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Score</span><span class="p">(</span><span class="nx">score</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">));</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">withState</span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">GameState</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameTestDataBuilder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">withState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">build</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">Game</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ファクトリヘルパー</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">FieldFactory</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">createFromPattern</span><span class="p">(</span><span class="nx">pattern</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[][])</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Field</span><span class="p">.</span><span class="nx">createEmpty</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">pattern</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span><span class="w"> </span><span class="nx">row</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">row</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">fieldAcc</span><span class="p">,</span><span class="w"> </span><span class="nx">cell</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cell</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">mapCharToColor</span><span class="p">(</span><span class="nx">cell</span><span class="p">);</span>
<span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Position</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">));</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nx">fieldAcc</span><span class="p">.</span><span class="nx">placePuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fieldAcc</span><span class="p">;</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="nx">acc</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="nx">field</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">mapCharToColor</span><span class="p">(</span><span class="nx">char</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">colorMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s1">&#39;R&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;G&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">GREEN</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;B&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">BLUE</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;Y&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">YELLOW</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;P&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">PURPLE</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">colorMap</span><span class="p">[</span><span class="kr">char</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2_1">2. 統合テスト<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ゲーム統合テスト&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;完全なゲームフローが正しく動作する&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given: ゲーム開始</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GameService</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">InMemoryGameRepository</span><span class="p">());</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gameService</span><span class="p">.</span><span class="nx">startNewGame</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// When: 一連のプレイヤー操作を実行</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">gameService</span><span class="p">.</span><span class="nx">handlePlayerInput</span><span class="p">(</span><span class="nx">gameId</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MovePuyoCommand</span><span class="p">(</span><span class="nx">Direction</span><span class="p">.</span><span class="nx">LEFT</span><span class="p">));</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">gameService</span><span class="p">.</span><span class="nx">handlePlayerInput</span><span class="p">(</span><span class="nx">gameId</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RotatePuyoCommand</span><span class="p">());</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">gameService</span><span class="p">.</span><span class="nx">handlePlayerInput</span><span class="p">(</span><span class="nx">gameId</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">QuickDropCommand</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// Then: ゲーム状態が期待通りに更新される</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gameService</span><span class="p">.</span><span class="nx">getGame</span><span class="p">(</span><span class="nx">gameId</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">getState</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">GameState</span><span class="p">.</span><span class="nx">PLACING_NEXT_PUYO</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">getField</span><span class="p">().</span><span class="nx">isEmpty</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;連鎖が正しく発生してスコアが加算される&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given: 連鎖が発生しやすい初期フィールド</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">FieldFactory</span><span class="p">.</span><span class="nx">createFromPattern</span><span class="p">([</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">      </span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">]</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GameTestDataBuilder</span><span class="p">()</span>
<span class="w">      </span><span class="p">.</span><span class="nx">withField</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">withScore</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">build</span><span class="p">();</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GameService</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">InMemoryGameRepository</span><span class="p">());</span>
<span class="w">    </span><span class="nx">gameService</span><span class="p">.</span><span class="nx">saveGame</span><span class="p">(</span><span class="nx">game</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When: 連鎖を発生させる操作</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">redPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Position</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">));</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">placePuyoCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PlacePuyoCommand</span><span class="p">(</span><span class="nx">redPuyo</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">gameService</span><span class="p">.</span><span class="nx">handlePlayerInput</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">getId</span><span class="p">(),</span><span class="w"> </span><span class="nx">placePuyoCommand</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then: 連鎖が発生してスコアが加算される</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">updatedGame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gameService</span><span class="p">.</span><span class="nx">getGame</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">getId</span><span class="p">());</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">updatedGame</span><span class="p">.</span><span class="nx">getScore</span><span class="p">().</span><span class="nx">getCurrent</span><span class="p">()).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">getEvents</span><span class="p">()).</span><span class="nx">toContainEqual</span><span class="p">(</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">.</span><span class="nx">objectContaining</span><span class="p">({</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ChainOccurredEvent&#39;</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="_9">コミット戦略<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<h3 id="todo">TODOベースのコミット<a class="headerlink" href="#todo" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjU5NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzgycHg7aGVpZ2h0OjU5NXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc4MiA1OTUiIHdpZHRoPSI3ODJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxlbGxpcHNlIGN4PSI0MDguNTI0NiIgY3k9IjIwIiBmaWxsPSIjMjIyMjIyIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3OS40NjExIiB4PSIzNjguNzk0MSIgeT0iNTAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1OS40NjExIiB4PSIzNzguNzk0MSIgeT0iNzEuMTM4NyI+VE9ETyYjMzY5ODQ7JiMyNTI0Njs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIxNS4yOTM1IiB4PSIzMDAuODc3OSIgeT0iMTAzLjk2ODgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTUuMjkzNSIgeD0iMzEwLjg3NzkiIHk9IjEyNS4xMDc0Ij5SZWQtR3JlZW4tUmVmYWN0b3IgJiMxMjQ2OTsmIzEyNDUyOyYjMTI0NjM7JiMxMjUyMzsmIzIzNDU1OyYjMzQ4OTI7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5Mi4wMDA1IiB4PSIzNjIuNTI0MyIgeT0iMTU3LjkzNzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi4wMDA1IiB4PSIzNzIuNTI0MyIgeT0iMTc5LjA3NjIiPiYjMjE2OTc7JiMzNjA3NDsmIzEyNDgxOyYjMTI0NTU7JiMxMjQ4MzsmIzEyNDYzOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjM4Ni42Njk3LDIxMS45MDYzLDQzMC4zNzk1LDIxMS45MDYzLDQ0Mi4zNzk1LDIyMy45MDYzLDQzMC4zNzk1LDIzNS45MDYzLDM4Ni42Njk3LDIzNS45MDYzLDM3NC42Njk3LDIyMy45MDYzLDM4Ni42Njk3LDIxMS45MDYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0My43MDk4IiB4PSIzODYuNjY5NyIgeT0iMjI3LjcxNDQiPiYjMjE2OTc7JiMzNjA3NDtPSz88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkuMDA4MyIgeD0iMzU1LjY2MTQiIHk9IjIyMS4zMTIiPnllczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMy43MDE3IiB4PSI0NDIuMzc5NSIgeT0iMjIxLjMxMiI+bm88L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzOS40NjE2IiB4PSI0MC41OTg4IiB5PSIyNDUuOTA2MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExOS40NjE2IiB4PSI1MC41OTg4IiB5PSIyNjcuMDQ0OSI+VE9ETyYjMjEzMzY7JiMyMDMwMTsmIzEyMzkxOyYjMTI0Njc7JiMxMjUxMTsmIzEyNDgzOyYjMTI0ODg7PC90ZXh0PjxwYXRoIGQ9Ik0yMjkuNjU5MiwyOTkuODc1IEwyMjkuNjU5MiwzNjEuNDA2MyBMMjA5LjY1OTIsMzY1LjQwNjMgTDIyOS42NTkyLDM2OS40MDYzIEwyMjkuNjU5Miw0MzAuOTM3NSBBMCwwIDAgMCAwIDIyOS42NTkyLDQzMC45Mzc1IEw2MTEuNTA0NCw0MzAuOTM3NSBBMCwwIDAgMCAwIDYxMS41MDQ0LDQzMC45Mzc1IEw2MTEuNTA0NCwzMDkuODc1IEw2MDEuNTA0NCwyOTkuODc1IEwyMjkuNjU5MiwyOTkuODc1IEEwLDAgMCAwIDAgMjI5LjY1OTIsMjk5Ljg3NSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTYwMS41MDQ0LDI5OS44NzUgTDYwMS41MDQ0LDMwOS44NzUgTDYxMS41MDQ0LDMwOS44NzUgTDYwMS41MDQ0LDI5OS44NzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MS4xNTA1IiB4PSIyMzUuNjU5MiIgeT0iMzE2Ljk0MTkiPmZlYXQ6ICYjMTI0MDc7JiMxMjQyNDsmIzIyMjM4OyYjMzY1Nzg7JiMyNzIzMTsmIzMzMDIxOyYjMTI0MzQ7JiMyMzQ1NTsmIzM1MDEzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0LjEzMjMiIHg9IjIzNS42NTkyIiB5PSIzMzIuMDc0NyI+JiMxNjA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwMC42ODEzIiB4PSIyMzUuNjU5MiIgeT0iMzQ3LjIwNzUiPi0gUHV5byAmIzEyNDYzOyYjMTI1MjE7JiMxMjQ3MzsmIzEyMzk1OyYjMjIyMzg7JiMzNjU3ODsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOyYjMzY4NjE7JiMyMTE1Mjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc3LjgyMzQiIHg9IjIzNS42NTkyIiB5PSIzNjIuMzQwMyI+LSAmIzM0OTA5OyYjMzEzNjE7JiMyMTAyODsmIzIzNDUwOyYjMTI0MzQ7JiMzMjc3MTsmIzI0OTQyOyYjMTIzNzU7JiMxMjM4MzsmIzIyMjM4OyYjMzY1Nzg7JiMyMDk2NjsmIzI5NzAyOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMTkuNzE4IiB4PSIyMzUuNjU5MiIgeT0iMzc3LjQ3MzEiPi0gJiMyMTMzNjsmIzIwMzA3OyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMzY4NjE7JiMyMTE1MjsmIzY1Mjg4OyYjMTI0NTk7JiMxMjQ5NjsmIzEyNTI0OyYjMTI0ODM7JiMxMjQ3Mjs5NSUmIzY1Mjg5OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0LjEzMjMiIHg9IjIzNS42NTkyIiB5PSIzOTIuNjA2Ij4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzYwLjg0NTIiIHg9IjIzNS42NTkyIiB5PSI0MDcuNzM4OCI+JiMxMjkzMDI7IEdlbmVyYXRlZCB3aXRoIFtDbGF1ZGUgQ29kZV0oaHR0cHM6Ly9jbGF1ZGUuYWkvY29kZSk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzM4LjQ1NyIgeD0iMjM1LjY1OTIiIHk9IjQyMi44NzE2Ij5Dby1BdXRob3JlZC1CeTogQ2xhdWRlICZsdDtub3JlcGx5QGFudGhyb3BpYy5jb20mZ3Q7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxOTguNjU5MiIgeD0iMTEiIHk9IjM0OC40MjE5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc4LjY1OTIiIHg9IjIxIiB5PSIzNjkuNTYwNSI+QW5ndWxhciYjMTI0NzM7JiMxMjQ3OTsmIzEyNDUyOyYjMTI1MjM7JiMxMjUxMzsmIzEyNDgzOyYjMTI0NzU7JiMxMjU0MDsmIzEyNDcyOyYjMjAzMTY7JiMyNTEwNDs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ0LjAwMDIiIHg9IjY3NC43MTk1IiB5PSIyNDUuOTA2MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI0LjAwMDIiIHg9IjY4NC43MTk1IiB5PSIyNjcuMDQ0OSI+JiMyMDQ2MjsmIzI3NDkxOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUwLjQzMDQiIHg9IjYyMS41MDQ0IiB5PSIyOTkuODc1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjQzMDQiIHg9IjYzMS41MDQ0IiB5PSIzMjEuMDEzNyI+JiMyMDQ2MjsmIzI3NDkxOzsgLS0mZ3Q7IDomIzIxNjk3OyYjMzYwNzQ7JiMxMjQ4MTsmIzEyNDU1OyYjMTI0ODM7JiMxMjQ2Mzs8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI0MDguNTI0Niw0MzYuOTM3NSw0MjAuNTI0Niw0NDguOTM3NSw0MDguNTI0Niw0NjAuOTM3NSwzOTYuNTI0Niw0NDguOTM3NSw0MDguNTI0Niw0MzYuOTM3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE3My4zNTE5IiB4PSIzMjEuODQ4NyIgeT0iNTI5LjMzOTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTMuMzUxOSIgeD0iMzMxLjg0ODciIHk9IjU1MC40Nzg1Ij4mIzI3NDI1OyYjMTIzOTg7VE9ETzsgLS0mZ3Q7IDpUT0RPJiMzNjk4NDsmIzI1MjQ2OzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjM3OC4zNTI2LDQ4MC45Mzc1LDQzOC42OTY3LDQ4MC45Mzc1LDQ1MC42OTY3LDQ5Mi45Mzc1LDQzOC42OTY3LDUwNC45Mzc1LDM3OC4zNTI2LDUwNC45Mzc1LDM2Ni4zNTI2LDQ5Mi45Mzc1LDM3OC4zNTI2LDQ4MC45Mzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOS4wMDgzIiB4PSI0MTIuNTI0NiIgeT0iNTE1LjE0NzkiPnllczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4zNDQxIiB4PSIzNzguMzUyNiIgeT0iNDk2Ljc0NTYiPiYjMjc0MjU7JiMxMjM5ODtUT0RPPzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMy43MDE3IiB4PSI0NTAuNjk2NyIgeT0iNDkwLjM0MzMiPm5vPC90ZXh0PjxlbGxpcHNlIGN4PSI0ODYuMzk4MyIgY3k9IjQ5Mi45Mzc1IiBmaWxsPSJub25lIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxlbGxpcHNlIGN4PSI0ODYuMzk4MyIgY3k9IjQ5Mi45Mzc1IiBmaWxsPSIjMjIyMjIyIiByeD0iNiIgcnk9IjYiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDA4LjUyNDYiIHgyPSI0MDguNTI0NiIgeTE9IjMwIiB5Mj0iNTAiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwNC41MjQ2LDQwLDQwOC41MjQ2LDUwLDQxMi41MjQ2LDQwLDQwOC41MjQ2LDQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQwOC41MjQ2IiB4Mj0iNDA4LjUyNDYiIHkxPSI4My45Njg4IiB5Mj0iMTAzLjk2ODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwNC41MjQ2LDkzLjk2ODgsNDA4LjUyNDYsMTAzLjk2ODgsNDEyLjUyNDYsOTMuOTY4OCw0MDguNTI0Niw5Ny45Njg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQwOC41MjQ2IiB4Mj0iNDA4LjUyNDYiIHkxPSIxMzcuOTM3NSIgeTI9IjE1Ny45Mzc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MDQuNTI0NiwxNDcuOTM3NSw0MDguNTI0NiwxNTcuOTM3NSw0MTIuNTI0NiwxNDcuOTM3NSw0MDguNTI0NiwxNTEuOTM3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTAuMzI5NiIgeDI9IjExMC4zMjk2IiB5MT0iMjc5Ljg3NSIgeTI9IjM0OC40MjE5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDYuMzI5NiwzMzguNDIxOSwxMTAuMzI5NiwzNDguNDIxOSwxMTQuMzI5NiwzMzguNDIxOSwxMTAuMzI5NiwzNDIuNDIxOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2OTYuNzE5NiIgeDI9IjY5Ni43MTk2IiB5MT0iMjc5Ljg3NSIgeTI9IjI5OS44NzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY5Mi43MTk2LDI4OS44NzUsNjk2LjcxOTYsMjk5Ljg3NSw3MDAuNzE5NiwyODkuODc1LDY5Ni43MTk2LDI5My44NzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzc0LjY2OTciIHgyPSIxMTAuMzI5NiIgeTE9IjIyMy45MDYzIiB5Mj0iMjIzLjkwNjMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTEwLjMyOTYiIHgyPSIxMTAuMzI5NiIgeTE9IjIyMy45MDYzIiB5Mj0iMjQ1LjkwNjMiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwNi4zMjk2LDIzNS45MDYzLDExMC4zMjk2LDI0NS45MDYzLDExNC4zMjk2LDIzNS45MDYzLDExMC4zMjk2LDIzOS45MDYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ0Mi4zNzk1IiB4Mj0iNjk2LjcxOTYiIHkxPSIyMjMuOTA2MyIgeTI9IjIyMy45MDYzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjY5Ni43MTk2IiB4Mj0iNjk2LjcxOTYiIHkxPSIyMjMuOTA2MyIgeTI9IjI0NS45MDYzIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2OTIuNzE5NiwyMzUuOTA2Myw2OTYuNzE5NiwyNDUuOTA2Myw3MDAuNzE5NiwyMzUuOTA2Myw2OTYuNzE5NiwyMzkuOTA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTAuMzI5NiIgeDI9IjExMC4zMjk2IiB5MT0iMzgyLjM5MDYiIHkyPSI0NDguOTM3NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTAuMzI5NiIgeDI9IjM5Ni41MjQ2IiB5MT0iNDQ4LjkzNzUiIHkyPSI0NDguOTM3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzg2LjUyNDYsNDQ0LjkzNzUsMzk2LjUyNDYsNDQ4LjkzNzUsMzg2LjUyNDYsNDUyLjkzNzUsMzkwLjUyNDYsNDQ4LjkzNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNjk2LjcxOTYiIHgyPSI2OTYuNzE5NiIgeTE9IjMzMy44NDM4IiB5Mj0iNDQ4LjkzNzUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNjk2LjcxOTYiIHgyPSI0MjAuNTI0NiIgeTE9IjQ0OC45Mzc1IiB5Mj0iNDQ4LjkzNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQzMC41MjQ2LDQ0NC45Mzc1LDQyMC41MjQ2LDQ0OC45Mzc1LDQzMC41MjQ2LDQ1Mi45Mzc1LDQyNi41MjQ2LDQ0OC45Mzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQwOC41MjQ2IiB4Mj0iNDA4LjUyNDYiIHkxPSIxOTEuOTA2MyIgeTI9IjIxMS45MDYzIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MDQuNTI0NiwyMDEuOTA2Myw0MDguNTI0NiwyMTEuOTA2Myw0MTIuNTI0NiwyMDEuOTA2Myw0MDguNTI0NiwyMDUuOTA2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0MDguNTI0NiIgeDI9IjQwOC41MjQ2IiB5MT0iNTA0LjkzNzUiIHkyPSI1MjkuMzM5OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDA0LjUyNDYsNTE5LjMzOTgsNDA4LjUyNDYsNTI5LjMzOTgsNDEyLjUyNDYsNTE5LjMzOTgsNDA4LjUyNDYsNTIzLjMzOTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDUwLjY5NjciIHgyPSI0NzUuMzk4MyIgeTE9IjQ5Mi45Mzc1IiB5Mj0iNDkyLjkzNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ2NS4zOTgzLDQ4OC45Mzc1LDQ3NS4zOTgzLDQ5Mi45Mzc1LDQ2NS4zOTgzLDQ5Ni45Mzc1LDQ2OS4zOTgzLDQ5Mi45Mzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQwOC41MjQ2IiB4Mj0iNDA4LjUyNDYiIHkxPSI1NjMuMzA4NiIgeTI9IjU4My4zMDg2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MDQuNTI0Niw1NzMuMzA4Niw0MDguNTI0Niw1ODMuMzA4Niw0MTIuNTI0Niw1NzMuMzA4Niw0MDguNTI0Niw1NzcuMzA4NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0MDguNTI0NiIgeDI9IjQwOC41MjQ2IiB5MT0iNDYwLjkzNzUiIHkyPSI0ODAuOTM3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDA0LjUyNDYsNDcwLjkzNzUsNDA4LjUyNDYsNDgwLjkzNzUsNDEyLjUyNDYsNDcwLjkzNzUsNDA4LjUyNDYsNDc0LjkzNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48IS0tU1JDPVtSUDkxUnpDbTVDVmxfWEktOEJNN2hBU1RJRDVXNTZhNzNhS0pEeUdYSWptYktjVE5ZSWxLNnhRcjRJT2NMS25ZMkJRNWllZmZ3bk9FNHJnZGpVZzdVS3FNSmtDWnUyR0pHdVlSelZuX2xfVnQtcGxXYmktSC1ScHZmRmJKWkRFaldwZW9MdWJaaEZZNEs2RUxqMm9SQ24tM18wNW8yRjh4ZzU0SUh6ZFdkVE9iRW84eEZtNGJHMXcxS2xnc1pobU1oZkpydmpFN0xTblRHZDZiSHU5Z0VJRlBfWllWUmVDdTBkYUVBaWd4TEFYSG90SWpzeFB5YTlTV1BfYWFERzhyQUExTmUyT1duX0ZmTlhoc3d1V29KaDNsaFJhU2pPWjVKR3BZMGNJT1YzeDhoaHdjbnI2Y2ZZM1Z2bnVGRG4wb3lCRGtaLTcyLTc1RTV3REkyVWZDR3FsTnNNb1FSN3RIc2NvbVZ0cVlhZDJPbjl5cTk3a2pxZXFPbjJ3OGdFbkF0ZG94eGN6Z1BWNkU3TDJSRUxFNTlVNWM0ZUJLbGxrV0pXbG8tRnhZbFBsOU11SC1IU0NGVThMR3Via1NFRllMbnJ0eWVqNnNrV3gxM1VRR2JuTU55cXZXcmNmc0tMb21sOWdqd3JOS09DUG9ieGxDcnZheXhmZHVqa2ExclBMRWtfVjhlanByTVNVcDVzb3NsZUc4VE4yLThLSlEwUzRMb2xKVXZ4Q3VGSmtpX3BiV21yWjJfbXJGVHRrajhpQnFUMDBZcFhGeDl5SXhZcmxFdHBfZFJjWjBNUVY0X0dPMF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_10">コミットメッセージ規約<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;

&lt;body&gt;

&lt;footer&gt;
</code></pre></div>
<p><strong>Type:</strong>
- <code>feat</code>: 新機能追加
- <code>fix</code>: バグ修正<br />
- <code>refactor</code>: リファクタリング
- <code>test</code>: テスト追加・修正
- <code>docs</code>: ドキュメント更新
- <code>style</code>: コード整形
- <code>chore</code>: ビルド・設定変更</p>
<p><strong>Scope:</strong>
- <code>domain</code>: ドメイン層
- <code>app</code>: アプリケーション層
- <code>ui</code>: プレゼンテーション層
- <code>infra</code>: インフラストラクチャ層</p>
<h2 id="_11">エラーハンドリング戦略<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<h3 id="1_3">1. ドメインエラー<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// ドメインエラーの定義</span>
<span class="k">export</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">DomainError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">abstract</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="k">abstract</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;warning&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">InvalidPuyoPlacementError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">DomainError</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;INVALID_PUYO_PLACEMENT&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">severity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;warning&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">,</span><span class="w"> </span><span class="nx">reason</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="sb">`Cannot place puyo at </span><span class="si">${</span><span class="nx">position</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">reason</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">GameOverError</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">DomainError</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;GAME_OVER&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">severity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">finalScore</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">(</span><span class="sb">`Game over with final score: </span><span class="si">${</span><span class="nx">finalScore</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ドメイン層での使用</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Game</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">handleInput</span><span class="p">(</span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">InputCommand</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">DomainEvent</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="kr">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;MOVE_PUYO&#39;</span><span class="o">:</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleMovePuyo</span><span class="p">(</span><span class="nx">command</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">MovePuyoCommand</span><span class="p">);</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;PLACE_PUYO&#39;</span><span class="o">:</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handlePlacePuyo</span><span class="p">(</span><span class="nx">command</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">PlacePuyoCommand</span><span class="p">);</span>
<span class="w">        </span><span class="nx">default</span><span class="o">:</span>
<span class="w">          </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">InvalidCommandError</span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="kr">type</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">DomainError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="ow">new</span><span class="w"> </span><span class="nx">GameErrorEvent</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">)];</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span><span class="w"> </span><span class="c1">// 予期しないエラーは再スロー</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">handlePlacePuyo</span><span class="p">(</span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">PlacePuyoCommand</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">DomainEvent</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">command</span><span class="p">.</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">.</span><span class="nx">canPlacePuyoAt</span><span class="p">(</span><span class="nx">position</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">InvalidPuyoPlacementError</span><span class="p">(</span>
<span class="w">        </span><span class="nx">position</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="s1">&#39;Position is already occupied&#39;</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 正常処理...</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="ow">new</span><span class="w"> </span><span class="nx">PuyoPlacedEvent</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">.</span><span class="nx">puyo</span><span class="p">)];</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2_2">2. アプリケーション層エラー処理<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">GameService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">handlePlayerInput</span><span class="p">(</span>
<span class="w">    </span><span class="nx">gameId</span><span class="o">:</span><span class="w"> </span><span class="kt">GameId</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">InputCommand</span>
<span class="w">  </span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">GameResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">gameRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">gameId</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">game</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">GameResult</span><span class="p">.</span><span class="nx">failure</span><span class="p">(</span><span class="s1">&#39;Game not found&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;GAME_NOT_FOUND&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">game</span><span class="p">.</span><span class="nx">handleInput</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">gameRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">game</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// ドメインイベントをアプリケーションイベントに変換</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">publishAll</span><span class="p">(</span><span class="nx">events</span><span class="p">);</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">GameResult</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="nx">events</span><span class="p">);</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">DomainError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">GameResult</span><span class="p">.</span><span class="nx">failure</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="c1">// 予期しないエラーはログに記録して汎用エラーを返す</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Unexpected error in GameService&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">GameResult</span><span class="p">.</span><span class="nx">failure</span><span class="p">(</span><span class="s1">&#39;Internal server error&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;INTERNAL_ERROR&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">GameResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kr">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">,</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">events</span><span class="o">:</span><span class="w"> </span><span class="kt">DomainEvent</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">errorMessage?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">errorCode?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">success</span><span class="p">(</span><span class="nx">events</span><span class="o">:</span><span class="w"> </span><span class="kt">DomainEvent</span><span class="p">[])</span><span class="o">:</span><span class="w"> </span><span class="nx">GameResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GameResult</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">events</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">failure</span><span class="p">(</span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GameResult</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">isSuccess</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">success</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="nx">getEvents</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">DomainEvent</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">[...</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">];</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="nx">getErrorMessage</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">errorMessage</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="nx">getErrorCode</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">errorCode</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_12">パフォーマンス最適化戦略<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<h3 id="1-react_1">1. メモ化とReactの最適化<a class="headerlink" href="#1-react_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// コンポーネントの最適化</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">GameBoard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="o">&lt;</span><span class="nx">GameBoardProps</span><span class="o">&gt;</span><span class="p">(({</span><span class="w"> </span>
<span class="w">  </span><span class="nx">field</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">currentPuyo</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">onInput</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 重い計算のメモ化</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fieldCells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">getCells</span><span class="p">().</span><span class="nx">map</span><span class="p">((</span><span class="nx">row</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">row</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">        </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">x</span><span class="si">}</span><span class="sb">-</span><span class="si">${</span><span class="nx">y</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">puyo</span><span class="p">,</span>
<span class="w">        </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nx">Position</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
<span class="w">      </span><span class="p">}))</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">field</span><span class="p">]);</span>

<span class="w">  </span><span class="c1">// イベントハンドラのメモ化</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">handleKeyDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="kt">KeyboardEvent</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mapKeyToCommand</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">command</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">onInput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">onInput</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">onInput</span><span class="p">]);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleKeyDown</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleKeyDown</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">handleKeyDown</span><span class="p">]);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;game-board&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">{</span><span class="nx">fieldCells</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">        </span><span class="nx">row</span><span class="p">.</span><span class="nx">map</span><span class="p">(({</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">PuyoCell</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">key</span><span class="p">}</span><span class="w"> </span><span class="nx">puyo</span><span class="o">=</span><span class="p">{</span><span class="nx">puyo</span><span class="p">}</span><span class="w"> </span><span class="nx">position</span><span class="o">=</span><span class="p">{</span><span class="nx">position</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">        </span><span class="p">))</span>
<span class="w">      </span><span class="p">)}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// 比較関数をカスタマイズ</span>
<span class="nx">GameBoard</span><span class="p">.</span><span class="nx">displayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;GameBoard&#39;</span><span class="p">;</span>
</code></pre></div>
<h3 id="2_3">2. バンドル最適化<a class="headerlink" href="#2_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 動的インポートによる遅延ロード</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">GameSettingsModal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lazy</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./GameSettingsModal&#39;</span><span class="p">));</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">GameHistoryModal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lazy</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">import</span><span class="p">(</span><span class="s1">&#39;./GameHistoryModal&#39;</span><span class="p">));</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">GameContainer</span><span class="o">:</span><span class="w"> </span><span class="kt">React.FC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">showSettings</span><span class="p">,</span><span class="w"> </span><span class="nx">setShowSettings</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">GameBoard</span><span class="w"> </span><span class="o">/&gt;</span>

<span class="w">      </span><span class="o">&lt;</span><span class="nx">Suspense</span><span class="w"> </span><span class="nx">fallback</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Loading</span><span class="p">...</span><span class="o">&lt;</span><span class="err">/div&gt;}&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="nx">showSettings</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">GameSettingsModal</span><span class="w"> </span><span class="nx">onClose</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setShowSettings</span><span class="p">(</span><span class="kc">false</span><span class="p">)}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">        </span><span class="p">)}</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/Suspense&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="3_1">3. 関数型テストデータビルダー<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h3>
<p>関数型アプローチでは、テストデータ生成も純粋関数で行います。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 関数型テストデータビルダー</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createTestGame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">overrides</span><span class="o">:</span><span class="w"> </span><span class="kt">Partial</span><span class="o">&lt;</span><span class="nx">GameData</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="o">:</span><span class="w"> </span><span class="nx">GameData</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">createEmptyField</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">currentPuyo</span><span class="o">:</span><span class="w"> </span><span class="kt">createRandomPuyoPair</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">nextPuyo</span><span class="o">:</span><span class="w"> </span><span class="kt">createRandomPuyoPair</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">score</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
<span class="w">  </span><span class="nx">chainCount</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
<span class="w">  </span><span class="nx">gameStatus</span><span class="o">:</span><span class="w"> </span><span class="kt">GameStatus.PLAYING</span><span class="p">,</span>
<span class="w">  </span><span class="p">...</span><span class="nx">overrides</span>
<span class="p">});</span>

<span class="c1">// パターンベースのフィールド生成</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createFieldFromPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pattern</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[][])</span><span class="o">:</span><span class="w"> </span><span class="nx">FieldData</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">pattern</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">row</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">row</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="kr">char</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="kr">char</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">charToColor</span><span class="p">(</span><span class="kr">char</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">);</span>

<span class="c1">// 関数合成によるテストシナリオ生成</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createChainScenario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">  </span><span class="nx">createFieldFromPattern</span><span class="p">([</span>
<span class="w">    </span><span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">]</span>
<span class="w">  </span><span class="p">]),</span>
<span class="w">  </span><span class="nx">field</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">createTestGame</span><span class="p">({</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="p">}),</span>
<span class="w">  </span><span class="nx">game</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="p">...</span><span class="nx">game</span><span class="p">,</span><span class="w"> </span><span class="nx">currentPuyo</span><span class="o">:</span><span class="w"> </span><span class="kt">createPuyo</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">3</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">})</span>
<span class="p">);</span>

<span class="c1">// 使用例</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;連鎖テストシナリオ&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;3連鎖が正しく動作する&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createChainScenario</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">processGameCommand</span><span class="p">(</span><span class="nx">gameData</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;PLACE_PUYO&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Then</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">chainCount</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">3</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">score</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="_13">パフォーマンス最適化（関数型）<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<h3 id="1_4">1. メモ化による計算最適化<a class="headerlink" href="#1_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">memoize</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/memoize&#39;</span><span class="p">;</span>

<span class="c1">// 重い計算の結果をメモ化</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">findConnectedPuyos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">memoize</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">FieldData</span><span class="p">,</span><span class="w"> </span><span class="nx">startPosition</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoData</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 計算集約的な連結探索</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">searchConnectedPuyos</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">startPosition</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="c1">// キーの生成関数</span>
<span class="w">  </span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">fieldToString</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">color</span><span class="si">}</span><span class="sb">`</span>
<span class="p">);</span>

<span class="c1">// React.useMemoとの組み合わせ</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">GameBoard</span><span class="o">:</span><span class="w"> </span><span class="kt">React.FC</span><span class="o">&lt;</span><span class="nx">GameBoardProps</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">currentPuyo</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">renderedCells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMemo</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">field</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">row</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">puyo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">renderPuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">renderEmptyCell</span><span class="p">())</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="p">[</span><span class="nx">field</span><span class="p">]</span><span class="w"> </span><span class="c1">// fieldが変更されたときのみ再計算</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;game-board&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">renderedCells</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="2_4">2. 関数合成による効率的なパイプライン<a class="headerlink" href="#2_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 効率的なデータ処理パイプライン</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">optimizedChainProcess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">  </span><span class="c1">// 1パスで複数の処理を実行</span>
<span class="w">  </span><span class="nx">field</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span><span class="w"> </span><span class="nx">row</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">row</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">acc</span><span class="p">.</span><span class="nx">puyosByColor</span><span class="p">[</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">acc</span><span class="p">.</span><span class="nx">puyosByColor</span><span class="p">[</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
<span class="w">        </span><span class="nx">acc</span><span class="p">.</span><span class="nx">puyosByColor</span><span class="p">[</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">].</span><span class="nx">push</span><span class="p">({</span><span class="w"> </span><span class="nx">puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="nx">acc</span><span class="p">.</span><span class="nx">totalCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">acc</span><span class="p">;</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">puyosByColor</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="nx">totalCount</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="w"> </span><span class="p">}),</span>

<span class="w">  </span><span class="c1">// 連結検索を色ごとに並列実行</span>
<span class="w">  </span><span class="p">({</span><span class="w"> </span><span class="nx">puyosByColor</span><span class="p">,</span><span class="w"> </span><span class="nx">totalCount</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">erasableGroups</span><span class="o">:</span><span class="w"> </span><span class="kt">Object.entries</span><span class="p">(</span><span class="nx">puyosByColor</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">map</span><span class="p">(([</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">puyos</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">findConnectedGroups</span><span class="p">(</span><span class="nx">puyos</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="nx">flat</span><span class="p">()</span>
<span class="w">      </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">group</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">4</span><span class="p">),</span>
<span class="w">    </span><span class="nx">totalCount</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">);</span>
</code></pre></div>
<h2 id="_14">まとめ<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>この関数型プログラミング実装戦略により以下を実現：</p>
<ol>
<li><strong>関数型原則</strong>: 純粋関数・イミュータビリティ・高階関数・関数合成の採用</li>
<li><strong>テスタビリティ</strong>: 副作用のない純粋関数による簡潔なテスト</li>
<li><strong>保守性</strong>: 予測可能で理解しやすいコード構造</li>
<li><strong>並行処理安全性</strong>: 共有状態変更のない安全な並行処理</li>
<li><strong>宣言的記述</strong>: Lodash/fpによる読みやすいデータ変換</li>
<li><strong>型安全性</strong>: TypeScriptによる厳密な型チェック</li>
</ol>
<h3 id="_15">関数型アプローチの利点<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>バグ削減</strong>: イミュータビリティにより予期しない副作用を防止</li>
<li><strong>テスト効率</strong>: 純粋関数は入力・出力が明確でテストが簡単</li>
<li><strong>並行処理</strong>: 状態共有がないため競合状態が発生しない</li>
<li><strong>デバッグ容易性</strong>: データフローが明確で追跡しやすい</li>
<li><strong>再利用性</strong>: 汎用的な純粋関数は様々な場面で再利用可能</li>
</ul>
<p>次のPhase 3（開発）では、この関数型プログラミング戦略に基づいて、Lodash/fpを活用したぷよぷよゲームの実装を進めていきます。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works" target="_blank" rel="noopener" title="GitHub Repository/claude-code-booster" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>