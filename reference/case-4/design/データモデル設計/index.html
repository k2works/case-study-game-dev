
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Site Description">
      
      
        <meta name="author" content="Project Team">
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>データモデル設計（関数型アプローチ） - Site Name</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Site Name" class="md-header__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Site Name
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              データモデル設計（関数型アプローチ）
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Site Name" class="md-nav__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Site Name
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="_1">データモデル設計（関数型アプローチ）<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">概要<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>ぷよぷよゲームのデータモデル設計を関数型プログラミングの原則に基づいて定義します。純粋関数、イミュータブルなデータ構造、Lodash/fpを活用した宣言的な操作により、型安全性と保守性を確保します。</p>
<h2 id="_3">設計原則<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="1">1. 関数型データモデリング<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjY0NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NTY2cHg7aGVpZ2h0OjY0NHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDU2NiA2NDQiIHdpZHRoPSI1NjZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyID8/Pz8/Pz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfLi4uLi4uLi4uIj48cGF0aCBkPSJNOC41LDYgTDEzNS40OTk1LDYgQTMuNzUsMy43NSAwIDAgMSAxMzcuOTk5NSw4LjUgTDE0NC45OTk1LDI4LjI5NjkgTDMyMS41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgMzI0LDMwLjc5NjkgTDMyNCw1NDguMDYgQTIuNSwyLjUgMCAwIDEgMzIxLjUsNTUwLjU2IEw4LjUsNTUwLjU2IEEyLjUsMi41IDAgMCAxIDYsNTQ4LjA2IEw2LDguNSBBMi41LDIuNSAwIDAgMSA4LjUsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE0NC45OTk1IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI1Ljk5OTUiIHg9IjEwIiB5PSIyMC45OTUxIj4mIzM4MzA2OyYjMjU5Njg7JiMyMjQxMTsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzEyNTE0OyYjMTI0ODc7JiMxMjUyMzs8L3RleHQ+PC9nPjwhLS1jbGFzcyBJbW11dGFibGUgRGF0YS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJJbW11dGFibGUgRGF0YSIgZGF0YS1zb3VyY2UtbGluZT0iNiIgZGF0YS11aWQ9ImVudDAwMDMiIGlkPSJlbnRpdHlfSW1tdXRhYmxlIERhdGEiPjxyZWN0IGZpbGw9IiNFOEY1RTgiIGhlaWdodD0iMTEzLjE4NzUiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE2My42NDg0IiB4PSIxNDQuMTgiIHk9IjQxIi8+PGVsbGlwc2UgY3g9IjE2Ny4yOTU4IiBjeT0iNTciIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTE3MC4yNjQ2LDYyLjY0MDYgUTE2OS42ODY0LDYyLjkzNzUgMTY5LjA0NTgsNjMuMDc4MSBRMTY4LjQwNTIsNjMuMjM0NCAxNjcuNzAyMSw2My4yMzQ0IFExNjUuMjAyMSw2My4yMzQ0IDE2My44NzM5LDYxLjU5MzggUTE2Mi41NjE0LDU5LjkzNzUgMTYyLjU2MTQsNTYuODEyNSBRMTYyLjU2MTQsNTMuNjg3NSAxNjMuODczOSw1Mi4wMzEzIFExNjUuMjAyMSw1MC4zNzUgMTY3LjcwMjEsNTAuMzc1IFExNjguNDA1Miw1MC4zNzUgMTY5LjA0NTgsNTAuNTMxMyBRMTY5LjcwMjEsNTAuNjg3NSAxNzAuMjY0Niw1MC45ODQ0IEwxNzAuMjY0Niw1My43MDMxIFExNjkuNjM5Niw1My4xMjUgMTY5LjA0NTgsNTIuODU5NCBRMTY4LjQ1MjEsNTIuNTc4MSAxNjcuODI3MSw1Mi41NzgxIFExNjYuNDgzMyw1Mi41NzgxIDE2NS43OTU4LDUzLjY1NjMgUTE2NS4xMDgzLDU0LjcxODggMTY1LjEwODMsNTYuODEyNSBRMTY1LjEwODMsNTguOTA2MyAxNjUuNzk1OCw1OS45ODQ0IFExNjYuNDgzMyw2MS4wNDY5IDE2Ny44MjcxLDYxLjA0NjkgUTE2OC40NTIxLDYxLjA0NjkgMTY5LjA0NTgsNjAuNzgxMyBRMTY5LjYzOTYsNjAuNSAxNzAuMjY0Niw1OS45MjE5IEwxNzAuMjY0Niw2Mi42NDA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEzLjYxMzMiIHg9IjE4My4wOTkzIiB5PSI2MS44NDY3Ij5JbW11dGFibGUgRGF0YTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNDUuMTgiIHgyPSIzMDYuODI4NCIgeTE9IjczIiB5Mj0iNzMiLz48ZWxsaXBzZSBjeD0iMTU1LjE4IiBjeT0iODYuNjQ4NCIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM3LjY0ODQiIHg9IjE2NC4xOCIgeT0iODkuOTk1MSI+cmVhZG9ubHkgcHJvcGVydGllczwvdGV4dD48ZWxsaXBzZSBjeD0iMTU1LjE4IiBjeT0iMTAyLjk0NTMiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjE2NC4xOCIgeT0iMTA2LjI5MiI+JiMyNzA4MzsmIzM2ODk2OyYjMzAzNDA7JiMyMDg0OTsmIzI2Mzc3OzwvdGV4dD48ZWxsaXBzZSBjeD0iMTU1LjE4IiBjeT0iMTE5LjI0MjIiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjE2NC4xOCIgeT0iMTIyLjU4ODkiPiYjMjc3MDQ7JiMzMjE1NDsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzI3MDgzOyYjMzY4OTY7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE0NS4xOCIgeDI9IjMwNi44Mjg0IiB5MT0iMTI5Ljg5MDYiIHkyPSIxMjkuODkwNiIvPjxlbGxpcHNlIGN4PSIxNTUuMTgiIGN5PSIxNDMuNTM5MSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0Ljg0MjgiIHg9IjE2NC4xOCIgeT0iMTQ2Ljg4NTciPk9iamVjdC5mcmVlemUoKTwvdGV4dD48L2c+PCEtLWNsYXNzIFB1cmUgRnVuY3Rpb25zLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IlB1cmUgRnVuY3Rpb25zIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJlbnRpdHlfUHVyZSBGdW5jdGlvbnMiPjxyZWN0IGZpbGw9IiNFNkYzRkYiIGhlaWdodD0iMTEzLjE4NzUiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzNS43NDIyIiB4PSIxNzIuMTMiIHk9IjIzMS4xOSIvPjxlbGxpcHNlIGN4PSIxODcuMTMiIGN5PSIyNDcuMTkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTE5MC4wOTg4LDI1Mi44MzA2IFExODkuNTIwNiwyNTMuMTI3NSAxODguODgsMjUzLjI2ODEgUTE4OC4yMzk0LDI1My40MjQ0IDE4Ny41MzYzLDI1My40MjQ0IFExODUuMDM2MywyNTMuNDI0NCAxODMuNzA4MSwyNTEuNzgzOCBRMTgyLjM5NTYsMjUwLjEyNzUgMTgyLjM5NTYsMjQ3LjAwMjUgUTE4Mi4zOTU2LDI0My44Nzc1IDE4My43MDgxLDI0Mi4yMjEzIFExODUuMDM2MywyNDAuNTY1IDE4Ny41MzYzLDI0MC41NjUgUTE4OC4yMzk0LDI0MC41NjUgMTg4Ljg4LDI0MC43MjEzIFExODkuNTM2MywyNDAuODc3NSAxOTAuMDk4OCwyNDEuMTc0NCBMMTkwLjA5ODgsMjQzLjg5MzEgUTE4OS40NzM4LDI0My4zMTUgMTg4Ljg4LDI0My4wNDk0IFExODguMjg2MywyNDIuNzY4MSAxODcuNjYxMywyNDIuNzY4MSBRMTg2LjMxNzUsMjQyLjc2ODEgMTg1LjYzLDI0My44NDYzIFExODQuOTQyNSwyNDQuOTA4OCAxODQuOTQyNSwyNDcuMDAyNSBRMTg0Ljk0MjUsMjQ5LjA5NjMgMTg1LjYzLDI1MC4xNzQ0IFExODYuMzE3NSwyNTEuMjM2OSAxODcuNjYxMywyNTEuMjM2OSBRMTg4LjI4NjMsMjUxLjIzNjkgMTg4Ljg4LDI1MC45NzEzIFExODkuNDczOCwyNTAuNjkgMTkwLjA5ODgsMjUwLjExMTkgTDE5MC4wOTg4LDI1Mi44MzA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAzLjc0MjIiIHg9IjIwMS4xMyIgeT0iMjUyLjAzNjciPlB1cmUgRnVuY3Rpb25zPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE3My4xMyIgeDI9IjMwNi44NzIyIiB5MT0iMjYzLjE5IiB5Mj0iMjYzLjE5Ii8+PGVsbGlwc2UgY3g9IjE4My4xMyIgY3k9IjI3Ni44Mzg0IiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSIxOTIuMTMiIHk9IjI4MC4xODUxIj4mIzIxNDQyOyYjMjkwMzE7JiMzNjg3OTsmIzM2OTQyOyYjMjQ2MTU7PC90ZXh0PjxlbGxpcHNlIGN4PSIxODMuMTMiIGN5PSIyOTMuMTM1MyIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMTkyLjEzIiB5PSIyOTYuNDgyIj4mIzIxMTAzOyYjMjAzMTY7JiMyOTk5MjsmIzEyMzk0OyYjMTIzNzU7PC90ZXh0PjxlbGxpcHNlIGN4PSIxODMuMTMiIGN5PSIzMDkuNDMyMiIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMTkyLjEzIiB5PSIzMTIuNzc4OSI+JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7JiMyMjc5MzsmIzI1NTYzOzwvdGV4dD48ZWxsaXBzZSBjeD0iMTgzLjEzIiBjeT0iMzI1LjcyOTEiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjE5Mi4xMyIgeT0iMzI5LjA3NTciPiYjMjE1MTI7JiMyNTEwNDsmIzIxNDg3OyYjMzMwMjE7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE3My4xMyIgeDI9IjMwNi44NzIyIiB5MT0iMzM2LjM3NzUiIHkyPSIzMzYuMzc3NSIvPjwvZz48IS0tY2xhc3MgRGF0YSBQaXBlbGluZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJEYXRhIFBpcGVsaW5lIiBkYXRhLXNvdXJjZS1saW5lPSIyMCIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfRGF0YSBQaXBlbGluZSI+PHJlY3QgZmlsbD0iI0ZGRTZDQyIgaGVpZ2h0PSIxMTMuMTg3NSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI0Ljk3NTYiIHg9IjYwLjUxIiB5PSI0MjEuMzgiLz48ZWxsaXBzZSBjeD0iNzUuNTEiIGN5PSI0MzcuMzgiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTc4LjQ3ODgsNDQzLjAyMDYgUTc3LjkwMDYsNDQzLjMxNzUgNzcuMjYsNDQzLjQ1ODEgUTc2LjYxOTQsNDQzLjYxNDQgNzUuOTE2Myw0NDMuNjE0NCBRNzMuNDE2Myw0NDMuNjE0NCA3Mi4wODgxLDQ0MS45NzM4IFE3MC43NzU2LDQ0MC4zMTc1IDcwLjc3NTYsNDM3LjE5MjUgUTcwLjc3NTYsNDM0LjA2NzUgNzIuMDg4MSw0MzIuNDExMyBRNzMuNDE2Myw0MzAuNzU1IDc1LjkxNjMsNDMwLjc1NSBRNzYuNjE5NCw0MzAuNzU1IDc3LjI2LDQzMC45MTEzIFE3Ny45MTYzLDQzMS4wNjc1IDc4LjQ3ODgsNDMxLjM2NDQgTDc4LjQ3ODgsNDM0LjA4MzEgUTc3Ljg1MzgsNDMzLjUwNSA3Ny4yNiw0MzMuMjM5NCBRNzYuNjY2Myw0MzIuOTU4MSA3Ni4wNDEzLDQzMi45NTgxIFE3NC42OTc1LDQzMi45NTgxIDc0LjAxLDQzNC4wMzYzIFE3My4zMjI1LDQzNS4wOTg4IDczLjMyMjUsNDM3LjE5MjUgUTczLjMyMjUsNDM5LjI4NjMgNzQuMDEsNDQwLjM2NDQgUTc0LjY5NzUsNDQxLjQyNjkgNzYuMDQxMyw0NDEuNDI2OSBRNzYuNjY2Myw0NDEuNDI2OSA3Ny4yNiw0NDEuMTYxMyBRNzcuODUzOCw0NDAuODggNzguNDc4OCw0NDAuMzAxOSBMNzguNDc4OCw0NDMuMDIwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyLjk3NTYiIHg9Ijg5LjUxIiB5PSI0NDIuMjI2NyI+RGF0YSBQaXBlbGluZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MS41MSIgeDI9IjE4NC40ODU2IiB5MT0iNDUzLjM4IiB5Mj0iNDUzLjM4Ii8+PGVsbGlwc2UgY3g9IjcxLjUxIiBjeT0iNDY3LjAyODQiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjgwLjUxIiB5PSI0NzAuMzc1MSI+JiMxMjQ1OTsmIzEyNTIyOyYjMTI1NDA7JiMyMTI3MDs8L3RleHQ+PGVsbGlwc2UgY3g9IjcxLjUxIiBjeT0iNDgzLjMyNTMiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjgwLjUxIiB5PSI0ODYuNjcyIj4mIzM3MDk2OyYjMjA5OTg7JiMzNjk2OTsmIzI5OTkyOzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MS41MSIgeDI9IjE4NC40ODU2IiB5MT0iNDkzLjk3MzgiIHkyPSI0OTMuOTczOCIvPjxlbGxpcHNlIGN4PSI3MS41MSIgY3k9IjUwNy42MjIyIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1OC4wMjM0IiB4PSI4MC41MSIgeT0iNTEwLjk2ODkiPmZwLmZsb3coKTwvdGV4dD48ZWxsaXBzZSBjeD0iNzEuNTEiIGN5PSI1MjMuOTE5MSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTkuNDY1OCIgeD0iODAuNTEiIHk9IjUyNy4yNjU3Ij5mcC5waXBlKCk8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJHTU45IiBkYXRhLXNvdXJjZS1saW5lPSIzMyIgZGF0YS11aWQ9ImVudDAwMTAiIGlkPSJlbnRpdHlfR01OOSI+PHBhdGggZD0iTTM0MywyNjcuNjUgTDM0MywzMDcuOTE1NiBBMCwwIDAgMCAwIDM0MywzMDcuOTE1NiBMNTU5LjAwMDIsMzA3LjkxNTYgQTAsMCAwIDAgMCA1NTkuMDAwMiwzMDcuOTE1NiBMNTU5LjAwMDIsMjc3LjY1IEw1NDkuMDAwMiwyNjcuNjUgTDQzMS42OSwyNjcuNjUgTDI5Mi45LDE1NC41NSBMNDIzLjY5LDI2Ny42NSBMMzQzLDI2Ny42NSBBMCwwIDAgMCAwIDM0MywyNjcuNjUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik01NDkuMDAwMiwyNjcuNjUgTDU0OS4wMDAyLDI3Ny42NSBMNTU5LjAwMDIsMjc3LjY1IEw1NDkuMDAwMiwyNjcuNjUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Ni4wMDAyIiB4PSIzNDkiIHk9IjI4NC43MTY5Ij4mIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzEyMzk5OyYjMjc3NzA7JiMxMjM3NTsmIzEyMzkwOyYjMjI3OTM7JiMyNjM1NjsmIzEyMzczOyYjMTI0Mjg7JiMxMjM3ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk1LjAwMDIiIHg9IjM0OSIgeT0iMjk5Ljg0OTciPiYjMjYwMzI7JiMxMjM3NTsmIzEyMzU2OyYjMTI0NTI7JiMxMjUzMTsmIzEyNDczOyYjMTI0Nzk7JiMxMjUzMTsmIzEyNDczOyYjMTIzNjQ7JiMyMDMxNjsmIzI1MTA0OyYjMTIzNzM7JiMxMjQyODsmIzEyNDI3OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdNTjEyIiBkYXRhLXNvdXJjZS1saW5lPSIzOCIgZGF0YS11aWQ9ImVudDAwMTMiIGlkPSJlbnRpdHlfR01OMTIiPjxwYXRoIGQ9Ik0zNDAuNSw0NTcuODQgTDM0MC41LDQ5OC4xMDU2IEEwLDAgMCAwIDAgMzQwLjUsNDk4LjEwNTYgTDQ2NS41MDAxLDQ5OC4xMDU2IEEwLDAgMCAwIDAgNDY1LjUwMDEsNDk4LjEwNTYgTDQ2NS41MDAxLDQ2Ny44NCBMNDU1LjUwMDEsNDU3Ljg0IEwzOTAuMTEsNDU3Ljg0IEwyODguNDYsMzQ0Ljc0IEwzODIuMTEsNDU3Ljg0IEwzNDAuNSw0NTcuODQgQTAsMCAwIDAgMCAzNDAuNSw0NTcuODQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00NTUuNTAwMSw0NTcuODQgTDQ1NS41MDAxLDQ2Ny44NCBMNDY1LjUwMDEsNDY3Ljg0IEw0NTUuNTAwMSw0NTcuODQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIzNDYuNSIgeT0iNDc0LjkwNjkiPiYjMjE1MTY7JiMxMjM3NjsmIzIwODM3OyYjMjExNDc7JiMxMjM5NTsmIzEyMzk5OyYjMjQxMjA7JiMxMjM5NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMzQ2LjUiIHk9IjQ5MC4wMzk3Ij4mIzIxNTE2OyYjMTIzNzY7JiMyMDk4NjsmIzIxMTQ3OyYjMTI0MzQ7JiMzNjgyMDsmIzEyMzc3OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdNTjE1IiBkYXRhLXNvdXJjZS1saW5lPSI0MyIgZGF0YS11aWQ9ImVudDAwMTYiIGlkPSJlbnRpdHlfR01OMTUiPjxwYXRoIGQ9Ik02MC41LDU5Ny41NiBMNjAuNSw2MzcuODI1NiBBMCwwIDAgMCAwIDYwLjUsNjM3LjgyNTYgTDE4NS41MDAxLDYzNy44MjU2IEEwLDAgMCAwIDAgMTg1LjUwMDEsNjM3LjgyNTYgTDE4NS41MDAxLDYwNy41NiBMMTc1LjUwMDEsNTk3LjU2IEwxMjcsNTk3LjU2IEwxMjMsNTM0Ljk5IEwxMTksNTk3LjU2IEw2MC41LDU5Ny41NiBBMCwwIDAgMCAwIDYwLjUsNTk3LjU2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTc1LjUwMDEsNTk3LjU2IEwxNzUuNTAwMSw2MDcuNTYgTDE4NS41MDAxLDYwNy41NiBMMTc1LjUwMDEsNTk3LjU2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iNjYuNSIgeT0iNjE0LjYyNjkiPiYjMzUwNzk7JiMyNTk2ODsmIzEyMzk4OyYjMzIwMjA7JiMzMTg4MzsmIzM4MzA2OyYjMjU5Njg7JiMxMjQzNDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjAwMDEiIHg9IjY2LjUiIHk9IjYyOS43NTk3Ij4mIzMyMDY4OyYjMTI0MTU7JiMyMTUxMjsmIzEyNDMxOyYjMTIzNzk7JiMxMjM5MDsmIzIwOTY2OyYjMjk3MDI7PC90ZXh0PjwvZz48IS0tbGluayBJbW11dGFibGUgRGF0YSB0byBQdXJlIEZ1bmN0aW9ucy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJJbW11dGFibGUgRGF0YSIgZGF0YS1lbnRpdHktMj0iUHVyZSBGdW5jdGlvbnMiIGRhdGEtc291cmNlLWxpbmU9IjI4IiBkYXRhLXVpZD0ibG5rNiIgaWQ9ImxpbmtfSW1tdXRhYmxlIERhdGFfUHVyZSBGdW5jdGlvbnMiPjxwYXRoIGNvZGVMaW5lPSIyOCIgZD0iTTIzMC4xNiwxNTQuNTUgQzIzMS45NSwxNzguNiAyMzMuNTk0OCwyMDAuNjc2NSAyMzUuMzg0OCwyMjQuNzM2NSIgZmlsbD0ibm9uZSIgaWQ9IkltbXV0YWJsZSBEYXRhLXRvLVB1cmUgRnVuY3Rpb25zIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzUuODMsMjMwLjcyLDIzOS4xNTEyLDIyMS40NDgsMjM1LjQ1OSwyMjUuNzMzOCwyMzEuMTczMywyMjIuMDQxNiwyMzUuODMsMjMwLjcyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYiIHg9IjIzNC40MiIgeT0iMTk3LjI1NjkiPiYjMjU4MDU7JiMyMDMxNjs8L3RleHQ+PC9nPjwhLS1saW5rIFB1cmUgRnVuY3Rpb25zIHRvIERhdGEgUGlwZWxpbmUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iUHVyZSBGdW5jdGlvbnMiIGRhdGEtZW50aXR5LTI9IkRhdGEgUGlwZWxpbmUiIGRhdGEtc291cmNlLWxpbmU9IjI5IiBkYXRhLXVpZD0ibG5rNyIgaWQ9ImxpbmtfUHVyZSBGdW5jdGlvbnNfRGF0YSBQaXBlbGluZSI+PHBhdGggY29kZUxpbmU9IjI5IiBkPSJNMjA1LjIxLDM0NC43NCBDMTkwLjI2LDM2OC43OSAxNzUuOTg3MiwzOTEuNzQ0MSAxNjEuMDI3Miw0MTUuODE0MSIgZmlsbD0ibm9uZSIgaWQ9IlB1cmUgRnVuY3Rpb25zLXRvLURhdGEgUGlwZWxpbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE1Ny44Niw0MjAuOTEsMTY2LjAwODEsNDE1LjM3NzYsMTYwLjQ5OTQsNDE2LjY2MzQsMTU5LjIxMzYsNDExLjE1NDYsMTU3Ljg2LDQyMC45MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2IiB4PSIxODYuMDEiIHk9IjM4Ny40NDY5Ij4mIzIxNTEyOyYjMjUxMDQ7PC90ZXh0PjwvZz48IS0tbGluayBEYXRhIFBpcGVsaW5lIHRvIEltbXV0YWJsZSBEYXRhLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkRhdGEgUGlwZWxpbmUiIGRhdGEtZW50aXR5LTI9IkltbXV0YWJsZSBEYXRhIiBkYXRhLXNvdXJjZS1saW5lPSIzMCIgZGF0YS11aWQ9ImxuazgiIGlkPSJsaW5rX0RhdGEgUGlwZWxpbmVfSW1tdXRhYmxlIERhdGEiPjxwYXRoIGNvZGVMaW5lPSIzMCIgZD0iTTkzLjUsNDIxLjA1IEM3MC42NywzNjkuNzMgNDcuMjEsMjkyLjU4IDc1LDIzMS4xOSBDODkuNjgsMTk4Ljc3IDExMS45Mjk5LDE3NC44Njk1IDEzOS4wNDk5LDE1My4zNDk1IiBmaWxsPSJub25lIiBpZD0iRGF0YSBQaXBlbGluZS10by1JbW11dGFibGUgRGF0YSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQzLjc1LDE0OS42MiwxMzQuMjEzNiwxNTIuMDgwOSwxMzkuODMzMywxNTIuNzI4LDEzOS4xODYzLDE1OC4zNDc3LDE0My43NSwxNDkuNjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC4wMDAxIiB4PSI3NiIgeT0iMjkyLjM0NjkiPiYjMjYwMzI7JiMxMjM3NTsmIzEyMzU2OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48L2c+PCEtLVNSQz1bVkxEVlJ6OUc1Ny1fZC1Ba2xjWU14U011QjdpbU1QMGM5MGlHQ3Z6RFdPajFlTXNXbkVYWW1jclhXQTJHb0wxWENNUjFDS1NZSkFWMW5PS0ZTeHFqX0hRVVRqM0Rha3BqekZwRUZSeV9FTHJBYTZIQTlsWjF2bFJjdXExYUFfOEd0bWdrWV9VMndzWGYxZWNGbWU3aksySmltTWxZTkw3cXU2V2U2am1BWE9EcE0xSTNRdTQwR2dlS1ZvT3o4TFltc3VWY19lWF9nWjZacDhtX0o5eW11ejJqMW1CVUdWNnFiQ2pYOFBKOXYzS2ZiV09mYVlPOXJtTmplNk1TOUw5MmFUQ2xpOWZMTDlCTEtZRzd0S1ppQU9iaGd5YWk4SV85eEpsR0NWaXJrXzNQd1hIdndUR3lnM2dUcVRad3JWNnVCbVZHQXBHZFprUXB1MzRsbnhNSzhrUzRscnM3ZDNUcWd6SXQybXNSbFpLQlZRVEo3Vnd6RUIxUW51b1VDRmVVRVh1MXhyTkRIalVQUUxSQ0lmQ3RYYkZadVhnVk9tejdLb2Y5R3RnMkZwdzdCZ2NrOWpGQVN6U0ZyMmhDa1pOSjF5bXUwSFBVUnlFZFJIcHBvZ3ZEbHU4Q3MweUMybzZraERuVkRCWTFwTlRsRzNyUUdEbm5keHdEY0dfYTF6blhGbzdpUmV5VzQ0UUJOWTA4b09mNlM0cEhEMk0zYlVKMkF0SHI2N0hlZGZ3eHh1LVM3QmpkWkV1cGxTdmUxcnFqcmRsQy1DN3F0LXVia0dNaldueUdFUGxNUXVaODJVcEdCZkJ4SjJGVVhGS1ZVRWFCVnpyYlQwMEktN1dDbkhtZWRwazBsWlVUajFaelVDRllfX0QxcXJ1UHBmeEhSelBQb19mVWtfbUJPMC1vVlhPUGRLMmdKNnltc2RNaWJlLWl2Z3d0LVh5MF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="2-value-object">2. 関数型Value Objectパターン<a class="headerlink" href="#2-value-object" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 関数型アプローチでのValue Object</span>
<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">ValueObject</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Readonly</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>

<span class="c1">// イミュータブルなデータ作成ヘルパー</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createImmutable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">T</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">object</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">ValueObject</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">(</span><span class="nx">fp</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>

<span class="c1">// 等価性チェック（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isEqual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="kt">ValueObject</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="kt">ValueObject</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">fp</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">);</span>

<span class="c1">// データ更新（新しいインスタンスを返す）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">updateValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">T</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">object</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">obj</span><span class="o">:</span><span class="w"> </span><span class="kt">ValueObject</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="p">[],</span>
<span class="w">  </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">ValueObject</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">createImmutable</span><span class="p">(</span><span class="nx">fp</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="p">));</span>

<span class="c1">// 複数の更新を適用</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">applyUpdates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">T</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">object</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">obj</span><span class="o">:</span><span class="w"> </span><span class="kt">ValueObject</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">updates</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="p">[],</span><span class="w"> </span><span class="nx">any</span><span class="p">]</span><span class="o">&gt;</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">ValueObject</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">createImmutable</span><span class="p">(</span>
<span class="w">    </span><span class="nx">updates</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">path</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">acc</span><span class="p">),</span><span class="w"> </span><span class="nx">obj</span><span class="p">)</span>
<span class="w">  </span><span class="p">);</span>
</code></pre></div>
<h2 id="_4">ドメインモデル階層<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjY5NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTY2MXB4O2hlaWdodDo2OTVweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNjYxIDY5NSIgd2lkdGg9IjE2NjFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIEFnZ3JlZ2F0ZXMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IkFnZ3JlZ2F0ZXMiIGRhdGEtc291cmNlLWxpbmU9IjYiIGRhdGEtdWlkPSJlbnQwMDAyIiBpZD0iY2x1c3Rlcl9BZ2dyZWdhdGVzIj48cGF0aCBkPSJNNzk5LjUsNiBMODkxLjc2NjYsNiBBMy43NSwzLjc1IDAgMCAxIDg5NC4yNjY2LDguNSBMOTAxLjI2NjYsMjguMjk2OSBMMTAwOC41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgMTAxMSwzMC43OTY5IEwxMDExLDIxNi41NyBBMi41LDIuNSAwIDAgMSAxMDA4LjUsMjE5LjA3IEw3OTkuNSwyMTkuMDcgQTIuNSwyLjUgMCAwIDEgNzk3LDIxNi41NyBMNzk3LDguNSBBMi41LDIuNSAwIDAgMSA3OTkuNSw2IiBmaWxsPSIjRTZGRkU2IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI3OTciIHgyPSI5MDEuMjY2NiIgeTE9IjI4LjI5NjkiIHkyPSIyOC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjI2NjYiIHg9IjgwMSIgeT0iMjAuOTk1MSI+QWdncmVnYXRlczwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgRW50aXRpZXMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IkVudGl0aWVzIiBkYXRhLXNvdXJjZS1saW5lPSIxOCIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJjbHVzdGVyX0VudGl0aWVzIj48cGF0aCBkPSJNOC41LDI0My4wNyBMNjkuODQwOCwyNDMuMDcgQTMuNzUsMy43NSAwIDAgMSA3Mi4zNDA4LDI0NS41NyBMNzkuMzQwOCwyNjUuMzY2OSBMMzYxLjUsMjY1LjM2NjkgQTIuNSwyLjUgMCAwIDEgMzY0LDI2Ny44NjY5IEwzNjQsNDA0Ljc2IEEyLjUsMi41IDAgMCAxIDM2MS41LDQwNy4yNiBMOC41LDQwNy4yNiBBMi41LDIuNSAwIDAgMSA2LDQwNC43NiBMNiwyNDUuNTcgQTIuNSwyLjUgMCAwIDEgOC41LDI0My4wNyIgZmlsbD0iI0ZGRTZDQyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9Ijc5LjM0MDgiIHkxPSIyNjUuMzY2OSIgeTI9IjI2NS4zNjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwLjM0MDgiIHg9IjEwIiB5PSIyNTguMDY1MSI+RW50aXRpZXM8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIFZhbHVlIE9iamVjdHMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IlZhbHVlIE9iamVjdHMiIGRhdGEtc291cmNlLWxpbmU9IjM0IiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImNsdXN0ZXJfVmFsdWUgT2JqZWN0cyI+PHBhdGggZD0iTTM5MC41LDI1MS4yMiBMNTAwLjQ1OCwyNTEuMjIgQTMuNzUsMy43NSAwIDAgMSA1MDIuOTU4LDI1My43MiBMNTA5Ljk1OCwyNzMuNTE2OSBMOTk3LjUsMjczLjUxNjkgQTIuNSwyLjUgMCAwIDEgMTAwMCwyNzYuMDE2OSBMMTAwMCw2ODUuOTUgQTIuNSwyLjUgMCAwIDEgOTk3LjUsNjg4LjQ1IEwzOTAuNSw2ODguNDUgQTIuNSwyLjUgMCAwIDEgMzg4LDY4NS45NSBMMzg4LDI1My43MiBBMi41LDIuNSAwIDAgMSAzOTAuNSwyNTEuMjIiIGZpbGw9IiNFNkYzRkYiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjM4OCIgeDI9IjUwOS45NTgiIHkxPSIyNzMuNTE2OSIgeTI9IjI3My41MTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC45NTgiIHg9IjM5MiIgeT0iMjY2LjIxNTEiPlZhbHVlIE9iamVjdHM8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIERvbWFpbiBTZXJ2aWNlcy0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iRG9tYWluIFNlcnZpY2VzIiBkYXRhLXNvdXJjZS1saW5lPSI2MiIgZGF0YS11aWQ9ImVudDAwMTUiIGlkPSJjbHVzdGVyX0RvbWFpbiBTZXJ2aWNlcyI+PHBhdGggZD0iTTEwMjYuNSwyNzUuNjcgTDExNTguOTQ4MiwyNzUuNjcgQTMuNzUsMy43NSAwIDAgMSAxMTYxLjQ0ODIsMjc4LjE3IEwxMTY4LjQ0ODIsMjk3Ljk2NjkgTDE2NTEuNSwyOTcuOTY2OSBBMi41LDIuNSAwIDAgMSAxNjU0LDMwMC40NjY5IEwxNjU0LDM3Mi4xNyBBMi41LDIuNSAwIDAgMSAxNjUxLjUsMzc0LjY3IEwxMDI2LjUsMzc0LjY3IEEyLjUsMi41IDAgMCAxIDEwMjQsMzcyLjE3IEwxMDI0LDI3OC4xNyBBMi41LDIuNSAwIDAgMSAxMDI2LjUsMjc1LjY3IiBmaWxsPSIjRjBFNkZGIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxMDI0IiB4Mj0iMTE2OC40NDgyIiB5MT0iMjk3Ljk2NjkiIHkyPSIyOTcuOTY2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzEuNDQ4MiIgeD0iMTAyOCIgeT0iMjkwLjY2NTEiPkRvbWFpbiBTZXJ2aWNlczwvdGV4dD48L2c+PCEtLWNsYXNzIEdhbWUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR2FtZSIgZGF0YS1zb3VyY2UtbGluZT0iNyIgZGF0YS11aWQ9ImVudDAwMDMiIGlkPSJlbnRpdHlfR2FtZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxNjIuMDc4MSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTgxLjIyMzYiIHg9IjgxMy4zOSIgeT0iNDEiLz48ZWxsaXBzZSBjeD0iODc4LjkxMjUiIGN5PSI1NyIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNODgxLjg4MTIsNjIuNjQwNiBRODgxLjMwMzEsNjIuOTM3NSA4ODAuNjYyNSw2My4wNzgxIFE4ODAuMDIxOCw2My4yMzQ0IDg3OS4zMTg3LDYzLjIzNDQgUTg3Ni44MTg3LDYzLjIzNDQgODc1LjQ5MDYsNjEuNTkzOCBRODc0LjE3ODEsNTkuOTM3NSA4NzQuMTc4MSw1Ni44MTI1IFE4NzQuMTc4MSw1My42ODc1IDg3NS40OTA2LDUyLjAzMTMgUTg3Ni44MTg3LDUwLjM3NSA4NzkuMzE4Nyw1MC4zNzUgUTg4MC4wMjE4LDUwLjM3NSA4ODAuNjYyNSw1MC41MzEzIFE4ODEuMzE4Nyw1MC42ODc1IDg4MS44ODEyLDUwLjk4NDQgTDg4MS44ODEyLDUzLjcwMzEgUTg4MS4yNTYyLDUzLjEyNSA4ODAuNjYyNSw1Mi44NTk0IFE4ODAuMDY4Nyw1Mi41NzgxIDg3OS40NDM3LDUyLjU3ODEgUTg3OC4xLDUyLjU3ODEgODc3LjQxMjUsNTMuNjU2MyBRODc2LjcyNSw1NC43MTg4IDg3Ni43MjUsNTYuODEyNSBRODc2LjcyNSw1OC45MDYzIDg3Ny40MTI1LDU5Ljk4NDQgUTg3OC4xLDYxLjA0NjkgODc5LjQ0MzcsNjEuMDQ2OSBRODgwLjA2ODcsNjEuMDQ2OSA4ODAuNjYyNSw2MC43ODEzIFE4ODEuMjU2Miw2MC41IDg4MS44ODEyLDU5LjkyMTkgTDg4MS44ODEyLDYyLjY0MDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS42Nzg3IiB4PSI4OTkuNDEyNSIgeT0iNjEuODQ2NyI+R2FtZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4MTQuMzkiIHgyPSI5OTMuNjEzNiIgeTE9IjczIiB5Mj0iNzMiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI4MjEuMzkiIHk9IjgzLjY0ODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Ni42Mzc3IiB4PSI4MzMuMzkiIHk9Ijg5Ljk5NTEiPmlkOiBHYW1lSWQ8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iODIxLjM5IiB5PSI5OS45NDUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzIuNzA3IiB4PSI4MzMuMzkiIHk9IjEwNi4yOTIiPmZpZWxkOiBGaWVsZDwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI4MjEuMzkiIHk9IjExNi4yNDIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU1LjIyMzYiIHg9IjgzMy4zOSIgeT0iMTIyLjU4ODkiPmN1cnJlbnRQdXlvOiBQdXlvUGFpcjwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI4MjEuMzkiIHk9IjEzMi41MzkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM1LjQyNjgiIHg9IjgzMy4zOSIgeT0iMTM4Ljg4NTciPm5leHRQdXlvOiBQdXlvUGFpcjwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI4MjEuMzkiIHk9IjE0OC44MzU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYuNjExMyIgeD0iODMzLjM5IiB5PSIxNTUuMTgyNiI+c2NvcmU6IFNjb3JlPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjgyMS4zOSIgeT0iMTY1LjEzMjgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjMuMzY4MiIgeD0iODMzLjM5IiB5PSIxNzEuNDc5NSI+c3RhdGU6IEdhbWVTdGF0ZTwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI4MjEuMzkiIHk9IjE4MS40Mjk3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODcuMDY5MyIgeD0iODMzLjM5IiB5PSIxODcuNzc2NCI+Y2hhaW46IENoYWluPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgxNC4zOSIgeDI9Ijk5My42MTM2IiB5MT0iMTk1LjA3ODEiIHkyPSIxOTUuMDc4MSIvPjwvZz48IS0tY2xhc3MgRmllbGQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iRmllbGQiIGRhdGEtc291cmNlLWxpbmU9IjE5IiBkYXRhLXVpZD0iZW50MDAwNSIgaWQ9ImVudGl0eV9GaWVsZCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMTMuMTg3NSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM0LjQzMTYiIHg9IjIxLjc4IiB5PSIyNzguMDciLz48ZWxsaXBzZSBjeD0iNjguMDc5OCIgY3k9IjI5NC4wNyIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNzEuMDQ4NiwyOTkuNzEwNiBRNzAuNDcwNCwzMDAuMDA3NSA2OS44Mjk4LDMwMC4xNDgxIFE2OS4xODkyLDMwMC4zMDQ0IDY4LjQ4NjEsMzAwLjMwNDQgUTY1Ljk4NjEsMzAwLjMwNDQgNjQuNjU3OSwyOTguNjYzOCBRNjMuMzQ1NCwyOTcuMDA3NSA2My4zNDU0LDI5My44ODI1IFE2My4zNDU0LDI5MC43NTc1IDY0LjY1NzksMjg5LjEwMTMgUTY1Ljk4NjEsMjg3LjQ0NSA2OC40ODYxLDI4Ny40NDUgUTY5LjE4OTIsMjg3LjQ0NSA2OS44Mjk4LDI4Ny42MDEzIFE3MC40ODYxLDI4Ny43NTc1IDcxLjA0ODYsMjg4LjA1NDQgTDcxLjA0ODYsMjkwLjc3MzEgUTcwLjQyMzYsMjkwLjE5NSA2OS44Mjk4LDI4OS45Mjk0IFE2OS4yMzYxLDI4OS42NDgxIDY4LjYxMTEsMjg5LjY0ODEgUTY3LjI2NzMsMjg5LjY0ODEgNjYuNTc5OCwyOTAuNzI2MyBRNjUuODkyMywyOTEuNzg4OCA2NS44OTIzLDI5My44ODI1IFE2NS44OTIzLDI5NS45NzYzIDY2LjU3OTgsMjk3LjA1NDQgUTY3LjI2NzMsMjk4LjExNjkgNjguNjExMSwyOTguMTE2OSBRNjkuMjM2MSwyOTguMTE2OSA2OS44Mjk4LDI5Ny44NTEzIFE3MC40MjM2LDI5Ny41NyA3MS4wNDg2LDI5Ni45OTE5IEw3MS4wNDg2LDI5OS43MTA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzMuMzMyIiB4PSI4OC41Nzk4IiB5PSIyOTguOTE2NyI+RmllbGQ8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjIuNzgiIHgyPSIxNTUuMjExNiIgeTE9IjMxMC4wNyIgeTI9IjMxMC4wNyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI5Ljc4IiB5PSIzMjAuNzE4NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY4LjI5MSIgeD0iNDEuNzgiIHk9IjMyNy4wNjUxIj5pZDogRmllbGRJZDwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOS43OCIgeT0iMzM3LjAxNTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS45NjY4IiB4PSI0MS43OCIgeT0iMzQzLjM2MiI+Z3JpZDogR3JpZDwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOS43OCIgeT0iMzUzLjMxMjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDIuMzk1NSIgeD0iNDEuNzgiIHk9IjM1OS42NTg5Ij53aWR0aDogbnVtYmVyPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI5Ljc4IiB5PSIzNjkuNjA5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC40MzE2IiB4PSI0MS43OCIgeT0iMzc1Ljk1NTciPmhlaWdodDogbnVtYmVyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIyLjc4IiB4Mj0iMTU1LjIxMTYiIHkxPSIzODMuMjU3NSIgeTI9IjM4My4yNTc1Ii8+PC9nPjwhLS1jbGFzcyBDaGFpbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJDaGFpbiIgZGF0YS1zb3VyY2UtbGluZT0iMjYiIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iZW50aXR5X0NoYWluIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjExMy4xODc1IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTYuNjIxMSIgeD0iMTkxLjY5IiB5PSIyNzguMDciLz48ZWxsaXBzZSBjeD0iMjQ1Ljc1NTQiIGN5PSIyOTQuMDciIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTI0OC43MjQyLDI5OS43MTA2IFEyNDguMTQ2MSwzMDAuMDA3NSAyNDcuNTA1NCwzMDAuMTQ4MSBRMjQ2Ljg2NDgsMzAwLjMwNDQgMjQ2LjE2MTcsMzAwLjMwNDQgUTI0My42NjE3LDMwMC4zMDQ0IDI0Mi4zMzM2LDI5OC42NjM4IFEyNDEuMDIxMSwyOTcuMDA3NSAyNDEuMDIxMSwyOTMuODgyNSBRMjQxLjAyMTEsMjkwLjc1NzUgMjQyLjMzMzYsMjg5LjEwMTMgUTI0My42NjE3LDI4Ny40NDUgMjQ2LjE2MTcsMjg3LjQ0NSBRMjQ2Ljg2NDgsMjg3LjQ0NSAyNDcuNTA1NCwyODcuNjAxMyBRMjQ4LjE2MTcsMjg3Ljc1NzUgMjQ4LjcyNDIsMjg4LjA1NDQgTDI0OC43MjQyLDI5MC43NzMxIFEyNDguMDk5MiwyOTAuMTk1IDI0Ny41MDU0LDI4OS45Mjk0IFEyNDYuOTExNywyODkuNjQ4MSAyNDYuMjg2NywyODkuNjQ4MSBRMjQ0Ljk0MjksMjg5LjY0ODEgMjQ0LjI1NTQsMjkwLjcyNjMgUTI0My41Njc5LDI5MS43ODg4IDI0My41Njc5LDI5My44ODI1IFEyNDMuNTY3OSwyOTUuOTc2MyAyNDQuMjU1NCwyOTcuMDU0NCBRMjQ0Ljk0MjksMjk4LjExNjkgMjQ2LjI4NjcsMjk4LjExNjkgUTI0Ni45MTE3LDI5OC4xMTY5IDI0Ny41MDU0LDI5Ny44NTEzIFEyNDguMDk5MiwyOTcuNTcgMjQ4LjcyNDIsMjk2Ljk5MTkgTDI0OC43MjQyLDI5OS43MTA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzkuOTkwMiIgeD0iMjY2LjI1NTQiIHk9IjI5OC45MTY3Ij5DaGFpbjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxOTIuNjkiIHgyPSIzNDcuMzExMSIgeTE9IjMxMC4wNyIgeTI9IjMxMC4wNyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjE5OS42OSIgeT0iMzIwLjcxODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NC45NDkyIiB4PSIyMTEuNjkiIHk9IjMyNy4wNjUxIj5pZDogQ2hhaW5JZDwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIxOTkuNjkiIHk9IjMzNy4wMTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI5LjUzNDIiIHg9IjIxMS42OSIgeT0iMzQzLjM2MiI+c3RlcHM6IENoYWluU3RlcFtdPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjE5OS42OSIgeT0iMzUzLjMxMjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzAuNjIxMSIgeD0iMjExLjY5IiB5PSIzNTkuNjU4OSI+bXVsdGlwbGllcjogbnVtYmVyPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjE5OS42OSIgeT0iMzY5LjYwOTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkuODc1IiB4PSIyMTEuNjkiIHk9IjM3NS45NTU3Ij5pc0FjdGl2ZTogYm9vbGVhbjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxOTIuNjkiIHgyPSIzNDcuMzExMSIgeTE9IjM4My4yNTc1IiB5Mj0iMzgzLjI1NzUiLz48L2c+PCEtLWNsYXNzIFB1eW8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUHV5byIgZGF0YS1zb3VyY2UtbGluZT0iMzUiIGRhdGEtdWlkPSJlbnQwMDA4IiBpZD0iZW50aXR5X1B1eW8iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iODAuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ1LjYyODkiIHg9IjQwNS4xOSIgeT0iNDUxLjI2Ii8+PGVsbGlwc2UgY3g9IjQ1Ni42NzE0IiBjeT0iNDY3LjI2IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00NTkuNjQwMiw0NzIuOTAwNiBRNDU5LjA2MjEsNDczLjE5NzUgNDU4LjQyMTQsNDczLjMzODEgUTQ1Ny43ODA4LDQ3My40OTQ0IDQ1Ny4wNzc3LDQ3My40OTQ0IFE0NTQuNTc3Nyw0NzMuNDk0NCA0NTMuMjQ5Niw0NzEuODUzOCBRNDUxLjkzNzEsNDcwLjE5NzUgNDUxLjkzNzEsNDY3LjA3MjUgUTQ1MS45MzcxLDQ2My45NDc1IDQ1My4yNDk2LDQ2Mi4yOTEzIFE0NTQuNTc3Nyw0NjAuNjM1IDQ1Ny4wNzc3LDQ2MC42MzUgUTQ1Ny43ODA4LDQ2MC42MzUgNDU4LjQyMTQsNDYwLjc5MTMgUTQ1OS4wNzc3LDQ2MC45NDc1IDQ1OS42NDAyLDQ2MS4yNDQ0IEw0NTkuNjQwMiw0NjMuOTYzMSBRNDU5LjAxNTIsNDYzLjM4NSA0NTguNDIxNCw0NjMuMTE5NCBRNDU3LjgyNzcsNDYyLjgzODEgNDU3LjIwMjcsNDYyLjgzODEgUTQ1NS44NTg5LDQ2Mi44MzgxIDQ1NS4xNzE0LDQ2My45MTYzIFE0NTQuNDgzOSw0NjQuOTc4OCA0NTQuNDgzOSw0NjcuMDcyNSBRNDU0LjQ4MzksNDY5LjE2NjMgNDU1LjE3MTQsNDcwLjI0NDQgUTQ1NS44NTg5LDQ3MS4zMDY5IDQ1Ny4yMDI3LDQ3MS4zMDY5IFE0NTcuODI3Nyw0NzEuMzA2OSA0NTguNDIxNCw0NzEuMDQxMyBRNDU5LjAxNTIsNDcwLjc2IDQ1OS42NDAyLDQ3MC4xODE5IEw0NTkuNjQwMiw0NzIuOTAwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0LjE2NiIgeD0iNDc3LjE3MTQiIHk9IjQ3Mi4xMDY3Ij5QdXlvPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQwNi4xOSIgeDI9IjU0OS44MTg5IiB5MT0iNDgzLjI2IiB5Mj0iNDgzLjI2Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iNDEzLjE5IiB5PSI0OTMuOTA4NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNC4zNTg0IiB4PSI0MjUuMTkiIHk9IjUwMC4yNTUxIj5jb2xvcjogUHV5b0NvbG9yPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjQxMy4xOSIgeT0iNTEwLjIwNTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkuNjI4OSIgeD0iNDI1LjE5IiB5PSI1MTYuNTUyIj5wb3NpdGlvbjogUG9zaXRpb248L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDA2LjE5IiB4Mj0iNTQ5LjgxODkiIHkxPSI1MjMuODUzOCIgeTI9IjUyMy44NTM4Ii8+PC9nPjwhLS1jbGFzcyBQb3NpdGlvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJQb3NpdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iNDAiIGRhdGEtdWlkPSJlbnQwMDA5IiBpZD0iZW50aXR5X1Bvc2l0aW9uIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjgwLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijk4LjA5MTgiIHg9IjQyOC45NSIgeT0iNTkxLjg2Ii8+PGVsbGlwc2UgY3g9IjQ0OC45Mzc0IiBjeT0iNjA3Ljg2IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00NTEuOTA2MSw2MTMuNTAwNiBRNDUxLjMyOCw2MTMuNzk3NSA0NTAuNjg3NCw2MTMuOTM4MSBRNDUwLjA0NjcsNjE0LjA5NDQgNDQ5LjM0MzYsNjE0LjA5NDQgUTQ0Ni44NDM2LDYxNC4wOTQ0IDQ0NS41MTU1LDYxMi40NTM4IFE0NDQuMjAzLDYxMC43OTc1IDQ0NC4yMDMsNjA3LjY3MjUgUTQ0NC4yMDMsNjA0LjU0NzUgNDQ1LjUxNTUsNjAyLjg5MTMgUTQ0Ni44NDM2LDYwMS4yMzUgNDQ5LjM0MzYsNjAxLjIzNSBRNDUwLjA0NjcsNjAxLjIzNSA0NTAuNjg3NCw2MDEuMzkxMyBRNDUxLjM0MzYsNjAxLjU0NzUgNDUxLjkwNjEsNjAxLjg0NDQgTDQ1MS45MDYxLDYwNC41NjMxIFE0NTEuMjgxMSw2MDMuOTg1IDQ1MC42ODc0LDYwMy43MTk0IFE0NTAuMDkzNiw2MDMuNDM4MSA0NDkuNDY4Niw2MDMuNDM4MSBRNDQ4LjEyNDksNjAzLjQzODEgNDQ3LjQzNzQsNjA0LjUxNjMgUTQ0Ni43NDk5LDYwNS41Nzg4IDQ0Ni43NDk5LDYwNy42NzI1IFE0NDYuNzQ5OSw2MDkuNzY2MyA0NDcuNDM3NCw2MTAuODQ0NCBRNDQ4LjEyNDksNjExLjkwNjkgNDQ5LjQ2ODYsNjExLjkwNjkgUTQ1MC4wOTM2LDYxMS45MDY5IDQ1MC42ODc0LDYxMS42NDEzIFE0NTEuMjgxMSw2MTEuMzYgNDUxLjkwNjEsNjEwLjc4MTkgTDQ1MS45MDYxLDYxMy41MDA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuMDA4OCIgeD0iNDY0LjA0NTciIHk9IjYxMi43MDY3Ij5Qb3NpdGlvbjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MjkuOTUiIHgyPSI1MjYuMDQxOCIgeTE9IjYyMy44NiIgeTI9IjYyMy44NiIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjQzNi45NSIgeT0iNjM0LjUwODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi4wOTE4IiB4PSI0NDguOTUiIHk9IjY0MC44NTUxIj54OiBudW1iZXI8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iNDM2Ljk1IiB5PSI2NTAuODA1MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcyLjA5MTgiIHg9IjQ0OC45NSIgeT0iNjU3LjE1MiI+eTogbnVtYmVyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQyOS45NSIgeDI9IjUyNi4wNDE4IiB5MT0iNjY0LjQ1MzgiIHkyPSI2NjQuNDUzOCIvPjwvZz48IS0tY2xhc3MgUHV5b1BhaXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUHV5b1BhaXIiIGRhdGEtc291cmNlLWxpbmU9IjQ1IiBkYXRhLXVpZD0iZW50MDAxMCIgaWQ9ImVudGl0eV9QdXlvUGFpciI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI5Ni44OTA2IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDkuNTUyNyIgeD0iNDA0LjIyIiB5PSIyODYuMjIiLz48ZWxsaXBzZSBjeD0iNDQ0Ljc0MzkiIGN5PSIzMDIuMjIiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTQ0Ny43MTI2LDMwNy44NjA2IFE0NDcuMTM0NSwzMDguMTU3NSA0NDYuNDkzOSwzMDguMjk4MSBRNDQ1Ljg1MzMsMzA4LjQ1NDQgNDQ1LjE1MDEsMzA4LjQ1NDQgUTQ0Mi42NTAxLDMwOC40NTQ0IDQ0MS4zMjIsMzA2LjgxMzggUTQ0MC4wMDk1LDMwNS4xNTc1IDQ0MC4wMDk1LDMwMi4wMzI1IFE0NDAuMDA5NSwyOTguOTA3NSA0NDEuMzIyLDI5Ny4yNTEzIFE0NDIuNjUwMSwyOTUuNTk1IDQ0NS4xNTAxLDI5NS41OTUgUTQ0NS44NTMzLDI5NS41OTUgNDQ2LjQ5MzksMjk1Ljc1MTMgUTQ0Ny4xNTAxLDI5NS45MDc1IDQ0Ny43MTI2LDI5Ni4yMDQ0IEw0NDcuNzEyNiwyOTguOTIzMSBRNDQ3LjA4NzYsMjk4LjM0NSA0NDYuNDkzOSwyOTguMDc5NCBRNDQ1LjkwMDEsMjk3Ljc5ODEgNDQ1LjI3NTEsMjk3Ljc5ODEgUTQ0My45MzE0LDI5Ny43OTgxIDQ0My4yNDM5LDI5OC44NzYzIFE0NDIuNTU2NCwyOTkuOTM4OCA0NDIuNTU2NCwzMDIuMDMyNSBRNDQyLjU1NjQsMzA0LjEyNjMgNDQzLjI0MzksMzA1LjIwNDQgUTQ0My45MzE0LDMwNi4yNjY5IDQ0NS4yNzUxLDMwNi4yNjY5IFE0NDUuOTAwMSwzMDYuMjY2OSA0NDYuNDkzOSwzMDYuMDAxMyBRNDQ3LjA4NzYsMzA1LjcyIDQ0Ny43MTI2LDMwNS4xNDE5IEw0NDcuNzEyNiwzMDcuODYwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwLjgzMyIgeD0iNDY0LjQxNTgiIHk9IjMwNy4wNjY3Ij5QdXlvUGFpcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MDUuMjIiIHgyPSI1NTIuNzcyNyIgeTE9IjMxOC4yMiIgeTI9IjMxOC4yMiIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjQxMi4yMiIgeT0iMzI4Ljg2ODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC4zMTI1IiB4PSI0MjQuMjIiIHk9IjMzNS4yMTUxIj5tYWluOiBQdXlvPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjQxMi4yMiIgeT0iMzQ1LjE2NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OC4zODY3IiB4PSI0MjQuMjIiIHk9IjM1MS41MTIiPnN1YjogUHV5bzwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI0MTIuMjIiIHk9IjM2MS40NjIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIzLjU1MjciIHg9IjQyNC4yMiIgeT0iMzY3LjgwODkiPnJvdGF0aW9uOiBSb3RhdGlvbjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MDUuMjIiIHgyPSI1NTIuNzcyNyIgeTE9IjM3NS4xMTA2IiB5Mj0iMzc1LjExMDYiLz48L2c+PCEtLWNsYXNzIFNjb3JlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IlNjb3JlIiBkYXRhLXNvdXJjZS1saW5lPSI1MSIgZGF0YS11aWQ9ImVudDAwMTEiIGlkPSJlbnRpdHlfU2NvcmUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iOTYuODkwNiIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTU5Ljg0NzciIHg9IjgyNC4wOCIgeT0iMjg2LjIyIi8+PGVsbGlwc2UgY3g9Ijg3OS45OTQ2IiBjeT0iMzAyLjIyIiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik04ODIuOTYzMywzMDcuODYwNiBRODgyLjM4NTIsMzA4LjE1NzUgODgxLjc0NDYsMzA4LjI5ODEgUTg4MS4xMDM5LDMwOC40NTQ0IDg4MC40MDA4LDMwOC40NTQ0IFE4NzcuOTAwOCwzMDguNDU0NCA4NzYuNTcyNywzMDYuODEzOCBRODc1LjI2MDIsMzA1LjE1NzUgODc1LjI2MDIsMzAyLjAzMjUgUTg3NS4yNjAyLDI5OC45MDc1IDg3Ni41NzI3LDI5Ny4yNTEzIFE4NzcuOTAwOCwyOTUuNTk1IDg4MC40MDA4LDI5NS41OTUgUTg4MS4xMDM5LDI5NS41OTUgODgxLjc0NDYsMjk1Ljc1MTMgUTg4Mi40MDA4LDI5NS45MDc1IDg4Mi45NjMzLDI5Ni4yMDQ0IEw4ODIuOTYzMywyOTguOTIzMSBRODgyLjMzODMsMjk4LjM0NSA4ODEuNzQ0NiwyOTguMDc5NCBRODgxLjE1MDgsMjk3Ljc5ODEgODgwLjUyNTgsMjk3Ljc5ODEgUTg3OS4xODIxLDI5Ny43OTgxIDg3OC40OTQ2LDI5OC44NzYzIFE4NzcuODA3MSwyOTkuOTM4OCA4NzcuODA3MSwzMDIuMDMyNSBRODc3LjgwNzEsMzA0LjEyNjMgODc4LjQ5NDYsMzA1LjIwNDQgUTg3OS4xODIxLDMwNi4yNjY5IDg4MC41MjU4LDMwNi4yNjY5IFE4ODEuMTUwOCwzMDYuMjY2OSA4ODEuNzQ0NiwzMDYuMDAxMyBRODgyLjMzODMsMzA1LjcyIDg4Mi45NjMzLDMwNS4xNDE5IEw4ODIuOTYzMywzMDcuODYwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM5LjUxODYiIHg9IjkwMC40OTQ2IiB5PSIzMDcuMDY2NyI+U2NvcmU8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iODI1LjA4IiB4Mj0iOTgyLjkyNzciIHkxPSIzMTguMjIiIHkyPSIzMTguMjIiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI4MzIuMDgiIHk9IjMyOC44Njg0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0Ljg2NDMiIHg9Ijg0NC4wOCIgeT0iMzM1LjIxNTEiPmN1cnJlbnQ6IG51bWJlcjwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI4MzIuMDgiIHk9IjM0NS4xNjUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjg0NzciIHg9Ijg0NC4wOCIgeT0iMzUxLjUxMiI+aGlnaFNjb3JlOiBudW1iZXI8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iODMyLjA4IiB5PSIzNjEuNDYyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS4xNTkyIiB4PSI4NDQuMDgiIHk9IjM2Ny44MDg5Ij5jb21ibzogbnVtYmVyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgyNS4wOCIgeDI9Ijk4Mi45Mjc3IiB5MT0iMzc1LjExMDYiIHkyPSIzNzUuMTEwNiIvPjwvZz48IS0tY2xhc3MgR2FtZUlkLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdhbWVJZCIgZGF0YS1zb3VyY2UtbGluZT0iNTciIGRhdGEtdWlkPSJlbnQwMDEyIiBpZD0iZW50aXR5X0dhbWVJZCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0OCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODYuNjk0MyIgeD0iNTg4LjY1IiB5PSIzMTAuNjciLz48ZWxsaXBzZSBjeD0iNjAzLjY1IiBjeT0iMzI2LjY3IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik02MDYuNjE4OCwzMzIuMzEwNiBRNjA2LjA0MDYsMzMyLjYwNzUgNjA1LjQsMzMyLjc0ODEgUTYwNC43NTk0LDMzMi45MDQ0IDYwNC4wNTYzLDMzMi45MDQ0IFE2MDEuNTU2MywzMzIuOTA0NCA2MDAuMjI4MSwzMzEuMjYzOCBRNTk4LjkxNTYsMzI5LjYwNzUgNTk4LjkxNTYsMzI2LjQ4MjUgUTU5OC45MTU2LDMyMy4zNTc1IDYwMC4yMjgxLDMyMS43MDEzIFE2MDEuNTU2MywzMjAuMDQ1IDYwNC4wNTYzLDMyMC4wNDUgUTYwNC43NTk0LDMyMC4wNDUgNjA1LjQsMzIwLjIwMTMgUTYwNi4wNTYzLDMyMC4zNTc1IDYwNi42MTg4LDMyMC42NTQ0IEw2MDYuNjE4OCwzMjMuMzczMSBRNjA1Ljk5MzgsMzIyLjc5NSA2MDUuNCwzMjIuNTI5NCBRNjA0LjgwNjMsMzIyLjI0ODEgNjA0LjE4MTMsMzIyLjI0ODEgUTYwMi44Mzc1LDMyMi4yNDgxIDYwMi4xNSwzMjMuMzI2MyBRNjAxLjQ2MjUsMzI0LjM4ODggNjAxLjQ2MjUsMzI2LjQ4MjUgUTYwMS40NjI1LDMyOC41NzYzIDYwMi4xNSwzMjkuNjU0NCBRNjAyLjgzNzUsMzMwLjcxNjkgNjA0LjE4MTMsMzMwLjcxNjkgUTYwNC44MDYzLDMzMC43MTY5IDYwNS40LDMzMC40NTEzIFE2MDUuOTkzOCwzMzAuMTcgNjA2LjYxODgsMzI5LjU5MTkgTDYwNi42MTg4LDMzMi4zMTA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuNjk0MyIgeD0iNjE3LjY1IiB5PSIzMzEuNTE2NyI+R2FtZUlkPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjU4OS42NSIgeDI9IjY3NC4zNDQzIiB5MT0iMzQyLjY3IiB5Mj0iMzQyLjY3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNTg5LjY1IiB4Mj0iNjc0LjM0NDMiIHkxPSIzNTAuNjciIHkyPSIzNTAuNjciLz48L2c+PCEtLWNsYXNzIEZpZWxkSWQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iRmllbGRJZCIgZGF0YS1zb3VyY2UtbGluZT0iNTgiIGRhdGEtdWlkPSJlbnQwMDEzIiBpZD0iZW50aXR5X0ZpZWxkSWQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijc4LjM0NzciIHg9IjcxMC44MyIgeT0iMzEwLjY3Ii8+PGVsbGlwc2UgY3g9IjcyNS44MyIgY3k9IjMyNi42NyIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNzI4Ljc5ODgsMzMyLjMxMDYgUTcyOC4yMjA2LDMzMi42MDc1IDcyNy41OCwzMzIuNzQ4MSBRNzI2LjkzOTQsMzMyLjkwNDQgNzI2LjIzNjMsMzMyLjkwNDQgUTcyMy43MzYzLDMzMi45MDQ0IDcyMi40MDgxLDMzMS4yNjM4IFE3MjEuMDk1NiwzMjkuNjA3NSA3MjEuMDk1NiwzMjYuNDgyNSBRNzIxLjA5NTYsMzIzLjM1NzUgNzIyLjQwODEsMzIxLjcwMTMgUTcyMy43MzYzLDMyMC4wNDUgNzI2LjIzNjMsMzIwLjA0NSBRNzI2LjkzOTQsMzIwLjA0NSA3MjcuNTgsMzIwLjIwMTMgUTcyOC4yMzYzLDMyMC4zNTc1IDcyOC43OTg4LDMyMC42NTQ0IEw3MjguNzk4OCwzMjMuMzczMSBRNzI4LjE3MzgsMzIyLjc5NSA3MjcuNTgsMzIyLjUyOTQgUTcyNi45ODYzLDMyMi4yNDgxIDcyNi4zNjEzLDMyMi4yNDgxIFE3MjUuMDE3NSwzMjIuMjQ4MSA3MjQuMzMsMzIzLjMyNjMgUTcyMy42NDI1LDMyNC4zODg4IDcyMy42NDI1LDMyNi40ODI1IFE3MjMuNjQyNSwzMjguNTc2MyA3MjQuMzMsMzI5LjY1NDQgUTcyNS4wMTc1LDMzMC43MTY5IDcyNi4zNjEzLDMzMC43MTY5IFE3MjYuOTg2MywzMzAuNzE2OSA3MjcuNTgsMzMwLjQ1MTMgUTcyOC4xNzM4LDMzMC4xNyA3MjguNzk4OCwzMjkuNTkxOSBMNzI4Ljc5ODgsMzMyLjMxMDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0Ni4zNDc3IiB4PSI3MzkuODMiIHk9IjMzMS41MTY3Ij5GaWVsZElkPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjcxMS44MyIgeDI9Ijc4OC4xNzc3IiB5MT0iMzQyLjY3IiB5Mj0iMzQyLjY3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNzExLjgzIiB4Mj0iNzg4LjE3NzciIHkxPSIzNTAuNjciIHkyPSIzNTAuNjciLz48L2c+PCEtLWNsYXNzIENoYWluSWQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQ2hhaW5JZCIgZGF0YS1zb3VyY2UtbGluZT0iNTkiIGRhdGEtdWlkPSJlbnQwMDE0IiBpZD0iZW50aXR5X0NoYWluSWQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg1LjAwNTkiIHg9IjU4OS41IiB5PSI0NjcuNTYiLz48ZWxsaXBzZSBjeD0iNjA0LjUiIGN5PSI0ODMuNTYiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTYwNy40Njg4LDQ4OS4yMDA2IFE2MDYuODkwNiw0ODkuNDk3NSA2MDYuMjUsNDg5LjYzODEgUTYwNS42MDk0LDQ4OS43OTQ0IDYwNC45MDYzLDQ4OS43OTQ0IFE2MDIuNDA2Myw0ODkuNzk0NCA2MDEuMDc4MSw0ODguMTUzOCBRNTk5Ljc2NTYsNDg2LjQ5NzUgNTk5Ljc2NTYsNDgzLjM3MjUgUTU5OS43NjU2LDQ4MC4yNDc1IDYwMS4wNzgxLDQ3OC41OTEzIFE2MDIuNDA2Myw0NzYuOTM1IDYwNC45MDYzLDQ3Ni45MzUgUTYwNS42MDk0LDQ3Ni45MzUgNjA2LjI1LDQ3Ny4wOTEzIFE2MDYuOTA2Myw0NzcuMjQ3NSA2MDcuNDY4OCw0NzcuNTQ0NCBMNjA3LjQ2ODgsNDgwLjI2MzEgUTYwNi44NDM4LDQ3OS42ODUgNjA2LjI1LDQ3OS40MTk0IFE2MDUuNjU2Myw0NzkuMTM4MSA2MDUuMDMxMyw0NzkuMTM4MSBRNjAzLjY4NzUsNDc5LjEzODEgNjAzLDQ4MC4yMTYzIFE2MDIuMzEyNSw0ODEuMjc4OCA2MDIuMzEyNSw0ODMuMzcyNSBRNjAyLjMxMjUsNDg1LjQ2NjMgNjAzLDQ4Ni41NDQ0IFE2MDMuNjg3NSw0ODcuNjA2OSA2MDUuMDMxMyw0ODcuNjA2OSBRNjA1LjY1NjMsNDg3LjYwNjkgNjA2LjI1LDQ4Ny4zNDEzIFE2MDYuODQzOCw0ODcuMDYgNjA3LjQ2ODgsNDg2LjQ4MTkgTDYwNy40Njg4LDQ4OS4yMDA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTMuMDA1OSIgeD0iNjE4LjUiIHk9IjQ4OC40MDY3Ij5DaGFpbklkPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjU5MC41IiB4Mj0iNjczLjUwNTkiIHkxPSI0OTkuNTYiIHkyPSI0OTkuNTYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1OTAuNSIgeDI9IjY3My41MDU5IiB5MT0iNTA3LjU2IiB5Mj0iNTA3LjU2Ii8+PC9nPjwhLS1jbGFzcyBDaGFpbkRldGVjdGlvblNlcnZpY2UtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQ2hhaW5EZXRlY3Rpb25TZXJ2aWNlIiBkYXRhLXNvdXJjZS1saW5lPSI2MyIgZGF0YS11aWQ9ImVudDAwMTYiIGlkPSJlbnRpdHlfQ2hhaW5EZXRlY3Rpb25TZXJ2aWNlIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxOTEuNzQyMiIgeD0iMTA0MC4xMyIgeT0iMzEwLjY3Ii8+PGVsbGlwc2UgY3g9IjEwNTUuMTMiIGN5PSIzMjYuNjciIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTEwNTguMDk4OCwzMzIuMzEwNiBRMTA1Ny41MjA2LDMzMi42MDc1IDEwNTYuODgsMzMyLjc0ODEgUTEwNTYuMjM5NCwzMzIuOTA0NCAxMDU1LjUzNjMsMzMyLjkwNDQgUTEwNTMuMDM2MywzMzIuOTA0NCAxMDUxLjcwODEsMzMxLjI2MzggUTEwNTAuMzk1NiwzMjkuNjA3NSAxMDUwLjM5NTYsMzI2LjQ4MjUgUTEwNTAuMzk1NiwzMjMuMzU3NSAxMDUxLjcwODEsMzIxLjcwMTMgUTEwNTMuMDM2MywzMjAuMDQ1IDEwNTUuNTM2MywzMjAuMDQ1IFExMDU2LjIzOTQsMzIwLjA0NSAxMDU2Ljg4LDMyMC4yMDEzIFExMDU3LjUzNjMsMzIwLjM1NzUgMTA1OC4wOTg4LDMyMC42NTQ0IEwxMDU4LjA5ODgsMzIzLjM3MzEgUTEwNTcuNDczOCwzMjIuNzk1IDEwNTYuODgsMzIyLjUyOTQgUTEwNTYuMjg2MywzMjIuMjQ4MSAxMDU1LjY2MTMsMzIyLjI0ODEgUTEwNTQuMzE3NSwzMjIuMjQ4MSAxMDUzLjYzLDMyMy4zMjYzIFExMDUyLjk0MjUsMzI0LjM4ODggMTA1Mi45NDI1LDMyNi40ODI1IFExMDUyLjk0MjUsMzI4LjU3NjMgMTA1My42MywzMjkuNjU0NCBRMTA1NC4zMTc1LDMzMC43MTY5IDEwNTUuNjYxMywzMzAuNzE2OSBRMTA1Ni4yODYzLDMzMC43MTY5IDEwNTYuODgsMzMwLjQ1MTMgUTEwNTcuNDczOCwzMzAuMTcgMTA1OC4wOTg4LDMyOS41OTE5IEwxMDU4LjA5ODgsMzMyLjMxMDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTkuNzQyMiIgeD0iMTA2OS4xMyIgeT0iMzMxLjUxNjciPkNoYWluRGV0ZWN0aW9uU2VydmljZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMDQxLjEzIiB4Mj0iMTIzMC44NzIyIiB5MT0iMzQyLjY3IiB5Mj0iMzQyLjY3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTA0MS4xMyIgeDI9IjEyMzAuODcyMiIgeTE9IjM1MC42NyIgeTI9IjM1MC42NyIvPjwvZz48IS0tY2xhc3MgR3Jhdml0eVNlcnZpY2UtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR3Jhdml0eVNlcnZpY2UiIGRhdGEtc291cmNlLWxpbmU9IjY0IiBkYXRhLXVpZD0iZW50MDAxNyIgaWQ9ImVudGl0eV9HcmF2aXR5U2VydmljZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0OCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM0Ljg3NCIgeD0iMTI2Ni41NiIgeT0iMzEwLjY3Ii8+PGVsbGlwc2UgY3g9IjEyODEuNTYiIGN5PSIzMjYuNjciIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTEyODQuNTI4OCwzMzIuMzEwNiBRMTI4My45NTA2LDMzMi42MDc1IDEyODMuMzEsMzMyLjc0ODEgUTEyODIuNjY5NCwzMzIuOTA0NCAxMjgxLjk2NjMsMzMyLjkwNDQgUTEyNzkuNDY2MywzMzIuOTA0NCAxMjc4LjEzODEsMzMxLjI2MzggUTEyNzYuODI1NiwzMjkuNjA3NSAxMjc2LjgyNTYsMzI2LjQ4MjUgUTEyNzYuODI1NiwzMjMuMzU3NSAxMjc4LjEzODEsMzIxLjcwMTMgUTEyNzkuNDY2MywzMjAuMDQ1IDEyODEuOTY2MywzMjAuMDQ1IFExMjgyLjY2OTQsMzIwLjA0NSAxMjgzLjMxLDMyMC4yMDEzIFExMjgzLjk2NjMsMzIwLjM1NzUgMTI4NC41Mjg4LDMyMC42NTQ0IEwxMjg0LjUyODgsMzIzLjM3MzEgUTEyODMuOTAzOCwzMjIuNzk1IDEyODMuMzEsMzIyLjUyOTQgUTEyODIuNzE2MywzMjIuMjQ4MSAxMjgyLjA5MTMsMzIyLjI0ODEgUTEyODAuNzQ3NSwzMjIuMjQ4MSAxMjgwLjA2LDMyMy4zMjYzIFExMjc5LjM3MjUsMzI0LjM4ODggMTI3OS4zNzI1LDMyNi40ODI1IFExMjc5LjM3MjUsMzI4LjU3NjMgMTI4MC4wNiwzMjkuNjU0NCBRMTI4MC43NDc1LDMzMC43MTY5IDEyODIuMDkxMywzMzAuNzE2OSBRMTI4Mi43MTYzLDMzMC43MTY5IDEyODMuMzEsMzMwLjQ1MTMgUTEyODMuOTAzOCwzMzAuMTcgMTI4NC41Mjg4LDMyOS41OTE5IEwxMjg0LjUyODgsMzMyLjMxMDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDIuODc0IiB4PSIxMjk1LjU2IiB5PSIzMzEuNTE2NyI+R3Jhdml0eVNlcnZpY2U8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTI2Ny41NiIgeDI9IjE0MDAuNDM0IiB5MT0iMzQyLjY3IiB5Mj0iMzQyLjY3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTI2Ny41NiIgeDI9IjE0MDAuNDM0IiB5MT0iMzUwLjY3IiB5Mj0iMzUwLjY3Ii8+PC9nPjwhLS1jbGFzcyBTY29yZUNhbGN1bGF0aW9uU2VydmljZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJTY29yZUNhbGN1bGF0aW9uU2VydmljZSIgZGF0YS1zb3VyY2UtbGluZT0iNjUiIGRhdGEtdWlkPSJlbnQwMDE4IiBpZD0iZW50aXR5X1Njb3JlQ2FsY3VsYXRpb25TZXJ2aWNlIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMDEuMzYwNCIgeD0iMTQzNi4zMiIgeT0iMzEwLjY3Ii8+PGVsbGlwc2UgY3g9IjE0NTEuMzIiIGN5PSIzMjYuNjciIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTE0NTQuMjg4OCwzMzIuMzEwNiBRMTQ1My43MTA2LDMzMi42MDc1IDE0NTMuMDcsMzMyLjc0ODEgUTE0NTIuNDI5NCwzMzIuOTA0NCAxNDUxLjcyNjMsMzMyLjkwNDQgUTE0NDkuMjI2MywzMzIuOTA0NCAxNDQ3Ljg5ODEsMzMxLjI2MzggUTE0NDYuNTg1NiwzMjkuNjA3NSAxNDQ2LjU4NTYsMzI2LjQ4MjUgUTE0NDYuNTg1NiwzMjMuMzU3NSAxNDQ3Ljg5ODEsMzIxLjcwMTMgUTE0NDkuMjI2MywzMjAuMDQ1IDE0NTEuNzI2MywzMjAuMDQ1IFExNDUyLjQyOTQsMzIwLjA0NSAxNDUzLjA3LDMyMC4yMDEzIFExNDUzLjcyNjMsMzIwLjM1NzUgMTQ1NC4yODg4LDMyMC42NTQ0IEwxNDU0LjI4ODgsMzIzLjM3MzEgUTE0NTMuNjYzOCwzMjIuNzk1IDE0NTMuMDcsMzIyLjUyOTQgUTE0NTIuNDc2MywzMjIuMjQ4MSAxNDUxLjg1MTMsMzIyLjI0ODEgUTE0NTAuNTA3NSwzMjIuMjQ4MSAxNDQ5LjgyLDMyMy4zMjYzIFExNDQ5LjEzMjUsMzI0LjM4ODggMTQ0OS4xMzI1LDMyNi40ODI1IFExNDQ5LjEzMjUsMzI4LjU3NjMgMTQ0OS44MiwzMjkuNjU0NCBRMTQ1MC41MDc1LDMzMC43MTY5IDE0NTEuODUxMywzMzAuNzE2OSBRMTQ1Mi40NzYzLDMzMC43MTY5IDE0NTMuMDcsMzMwLjQ1MTMgUTE0NTMuNjYzOCwzMzAuMTcgMTQ1NC4yODg4LDMyOS41OTE5IEwxNDU0LjI4ODgsMzMyLjMxMDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjkuMzYwNCIgeD0iMTQ2NS4zMiIgeT0iMzMxLjUxNjciPlNjb3JlQ2FsY3VsYXRpb25TZXJ2aWNlPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE0MzcuMzIiIHgyPSIxNjM2LjY4MDQiIHkxPSIzNDIuNjciIHkyPSIzNDIuNjciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNDM3LjMyIiB4Mj0iMTYzNi42ODA0IiB5MT0iMzUwLjY3IiB5Mj0iMzUwLjY3Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgR2FtZSB0byBGaWVsZC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJHYW1lIiBkYXRhLWVudGl0eS0yPSJGaWVsZCIgZGF0YS1zb3VyY2UtbGluZT0iNjkiIGRhdGEtdWlkPSJsbmsxOSIgaWQ9ImxpbmtfR2FtZV9GaWVsZCI+PHBhdGggY29kZUxpbmU9IjY5IiBkPSJNODAxLjE2MzIsMTMwLjAzMjIgQzYzMC42ODMyLDE0Mi43NDIyIDI4Mi4zMSwxNzUuMDkgMTc0LDIzNS4wNyBDMTU1LjMyLDI0NS40MiAxMzguODUsMjYxLjU3IDEyNS41LDI3Ny44MiIgZmlsbD0ibm9uZSIgaWQ9IkdhbWUtYmFja3RvLUZpZWxkIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4MTMuMTMsMTI5LjE0LDgwNi44NDkyLDEyNS41OTcyLDgwMS4xNjMyLDEzMC4wMzIyLDgwNy40NDQsMTMzLjU3NSw4MTMuMTMsMTI5LjE0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgR2FtZSB0byBQdXlvUGFpci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJHYW1lIiBkYXRhLWVudGl0eS0yPSJQdXlvUGFpciIgZGF0YS1zb3VyY2UtbGluZT0iNzAiIGRhdGEtdWlkPSJsbmsyMCIgaWQ9ImxpbmtfR2FtZV9QdXlvUGFpciI+PHBhdGggY29kZUxpbmU9IjcwIiBkPSJNODAxLjQ2MzIsMTQzLjUzNjEgQzczMS4zMDMyLDE2MC4xNTYxIDY0NS42MSwxODcuMDEgNTcxLDIzNS4wNyBDNTUwLjA0LDI0OC41OCA1MzAuNiwyNjcuOTEgNTE1LjA0LDI4NS44OCIgZmlsbD0ibm9uZSIgaWQ9IkdhbWUtYmFja3RvLVB1eW9QYWlyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4MTMuMTQsMTQwLjc3LDgwNi4zNzk1LDEzOC4yNjA4LDgwMS40NjMyLDE0My41MzYxLDgwOC4yMjM2LDE0Ni4wNDUzLDgxMy4xNCwxNDAuNzciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBHYW1lIHRvIFNjb3JlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkdhbWUiIGRhdGEtZW50aXR5LTI9IlNjb3JlIiBkYXRhLXNvdXJjZS1saW5lPSI3MSIgZGF0YS11aWQ9ImxuazIxIiBpZD0ibGlua19HYW1lX1Njb3JlIj48cGF0aCBjb2RlTGluZT0iNzEiIGQ9Ik05MDQsMjE1LjU3IEM5MDQsMjQzLjMzIDkwNCwyNjEuNTIgOTA0LDI4NS44MiIgZmlsbD0ibm9uZSIgaWQ9IkdhbWUtYmFja3RvLVNjb3JlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5MDQsMjAzLjU3LDkwMCwyMDkuNTcsOTA0LDIxNS41Nyw5MDgsMjA5LjU3LDkwNCwyMDMuNTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBHYW1lIHRvIENoYWluLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkdhbWUiIGRhdGEtZW50aXR5LTI9IkNoYWluIiBkYXRhLXNvdXJjZS1saW5lPSI3MiIgZGF0YS11aWQ9ImxuazIyIiBpZD0ibGlua19HYW1lX0NoYWluIj48cGF0aCBjb2RlTGluZT0iNzIiIGQ9Ik04MDEuMDQ4NiwxMzAuNzU0MiBDNjk0LjQ1ODYsMTQxLjMyNDIgNTI2Ljc2LDE2Ny4yIDM4OCwyMzUuMDcgQzM2NS44MiwyNDUuOTMgMzQ0LjI2LDI2MS44MSAzMjUuNzcsMjc3LjY3IiBmaWxsPSJub25lIiBpZD0iR2FtZS1iYWNrdG8tQ2hhaW4iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgxMi45OSwxMjkuNTcsODA2LjYyNDYsMTI2LjE4MTYsODAxLjA0ODYsMTMwLjc1NDIsODA3LjQxNCwxMzQuMTQyNiw4MTIuOTksMTI5LjU3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgRmllbGQgdG8gUHV5by0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJGaWVsZCIgZGF0YS1lbnRpdHktMj0iUHV5byIgZGF0YS1zb3VyY2UtbGluZT0iNzMiIGRhdGEtdWlkPSJsbmsyMyIgaWQ9ImxpbmtfRmllbGRfUHV5byI+PHBhdGggY29kZUxpbmU9IjczIiBkPSJNMTQ5LjY3OTQsMzk5LjQyNDggQzE2MC4wMzk0LDQwOC4zNTQ4IDE2Mi4yOCw0MDguODkgMTc0LDQxNS4yNiBDMjQ2Ljg2LDQ1NC44NSAzNDAuNzksNDczLjk5IDQwNC44NCw0ODMiIGZpbGw9Im5vbmUiIGlkPSJGaWVsZC1iYWNrdG8tUHV5byIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQwLjU5LDM5MS41OSwxNDIuNTIzMSwzOTguNTM3MiwxNDkuNjc5NCwzOTkuNDI0OCwxNDcuNzQ2MywzOTIuNDc3NiwxNDAuNTksMzkxLjU5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgUHV5b1BhaXIgdG8gUHV5by0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJQdXlvUGFpciIgZGF0YS1lbnRpdHktMj0iUHV5byIgZGF0YS1zb3VyY2UtbGluZT0iNzQiIGRhdGEtdWlkPSJsbmsyNCIgaWQ9ImxpbmtfUHV5b1BhaXJfUHV5byI+PHBhdGggY29kZUxpbmU9Ijc0IiBkPSJNNDc4LjYxMjIsMzk1LjM5OTcgQzQ3OC40NzIyLDQxNi45OTk3IDQ3OC4zOSw0MzAuMjQgNDc4LjI2LDQ1MC43OSIgZmlsbD0ibm9uZSIgaWQ9IlB1eW9QYWlyLWJhY2t0by1QdXlvIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NzguNjksMzgzLjQsNDc0LjY1MTIsMzg5LjM3MzksNDc4LjYxMjIsMzk1LjM5OTcsNDgyLjY1MSwzODkuNDI1OCw0NzguNjksMzgzLjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBQdXlvIHRvIFBvc2l0aW9uLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlB1eW8iIGRhdGEtZW50aXR5LTI9IlBvc2l0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSI3NSIgZGF0YS11aWQ9ImxuazI1IiBpZD0ibGlua19QdXlvX1Bvc2l0aW9uIj48cGF0aCBjb2RlTGluZT0iNzUiIGQ9Ik00NzgsNTQ0LjI3IEM0NzgsNTYyLjgzIDQ3OCw1NzIuODcgNDc4LDU5MS40MyIgZmlsbD0ibm9uZSIgaWQ9IlB1eW8tYmFja3RvLVBvc2l0aW9uIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NzgsNTMyLjI3LDQ3NCw1MzguMjcsNDc4LDU0NC4yNyw0ODIsNTM4LjI3LDQ3OCw1MzIuMjciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgR2FtZSB0byBDaGFpbkRldGVjdGlvblNlcnZpY2UtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iR2FtZSIgZGF0YS1lbnRpdHktMj0iQ2hhaW5EZXRlY3Rpb25TZXJ2aWNlIiBkYXRhLXNvdXJjZS1saW5lPSI3NyIgZGF0YS11aWQ9ImxuazI2IiBpZD0ibGlua19HYW1lX0NoYWluRGV0ZWN0aW9uU2VydmljZSI+PHBhdGggY29kZUxpbmU9Ijc3IiBkPSJNOTkyLjcsMjAzLjU3IEMxMDM0Ljc5LDI0MS43OCAxMDc3LjUxNzcsMjgwLjU2NjkgMTEwNS44NTc3LDMwNi4yOTY5IiBmaWxsPSJub25lIiBpZD0iR2FtZS10by1DaGFpbkRldGVjdGlvblNlcnZpY2UiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjExMTAuMywzMTAuMzMsMTEwNi4zMjU0LDMwMS4zMTg4LDExMDYuNTk4MSwzMDYuOTY5LDExMDAuOTQ3OCwzMDcuMjQxOCwxMTEwLjMsMzEwLjMzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEdhbWUgdG8gR3Jhdml0eVNlcnZpY2UtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iR2FtZSIgZGF0YS1lbnRpdHktMj0iR3Jhdml0eVNlcnZpY2UiIGRhdGEtc291cmNlLWxpbmU9Ijc4IiBkYXRhLXVpZD0ibG5rMjciIGlkPSJsaW5rX0dhbWVfR3Jhdml0eVNlcnZpY2UiPjxwYXRoIGNvZGVMaW5lPSI3OCIgZD0iTTk5NC45NiwxMzguNDggQzEwNjguMiwxNTQuMDkgMTE3MS4zOCwxODMuNDggMTI0OSwyMzUuMDcgQzEyNzguOTMsMjU0Ljk3IDEzMDEuMTE0MSwyODMuMjA2MyAxMzE2LjE3NDEsMzA1LjUyNjMiIGZpbGw9Im5vbmUiIGlkPSJHYW1lLXRvLUdyYXZpdHlTZXJ2aWNlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzE5LjUzLDMxMC41LDEzMTcuODExOSwzMDAuODAyMiwxMzE2LjczMzQsMzA2LjM1NTIsMTMxMS4xODAzLDMwNS4yNzY3LDEzMTkuNTMsMzEwLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgR2FtZSB0byBTY29yZUNhbGN1bGF0aW9uU2VydmljZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJHYW1lIiBkYXRhLWVudGl0eS0yPSJTY29yZUNhbGN1bGF0aW9uU2VydmljZSIgZGF0YS1zb3VyY2UtbGluZT0iNzkiIGRhdGEtdWlkPSJsbmsyOCIgaWQ9ImxpbmtfR2FtZV9TY29yZUNhbGN1bGF0aW9uU2VydmljZSI+PHBhdGggY29kZUxpbmU9Ijc5IiBkPSJNOTk0LjgzLDEyOS42IEMxMTAxLjIyLDE0MC4yMSAxMjgwLjUyLDE2Ny4zIDE0MTksMjM1LjA3IEMxNDU3LjM3LDI1My44NSAxNDg5LjY5ODIsMjgzLjM1NzcgMTUxMS42NzgyLDMwNi4wNzc3IiBmaWxsPSJub25lIiBpZD0iR2FtZS10by1TY29yZUNhbGN1bGF0aW9uU2VydmljZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTUxNS44NSwzMTAuMzksMTUxMi40NjcxLDMwMS4xNDAzLDE1MTIuMzczNSwzMDYuNzk2NCwxNTA2LjcxNzQsMzA2LjcwMjgsMTUxNS44NSwzMTAuMzkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLVNSQz1bVExGVFFqaW01Qnh0S3daVG5NMkdLWFpxbVhTM3V6ZVhLOU9HUHU0bm5mMkxLcVVUUjBMUHBYaEFSbE9HVXUyekk1emNEdGtCN0tjTWVaR0tXdE0teF9XU1ZVVjc1bmt1dm5zR3VrRGdqbGh5QlBfVnBQVmFKTGFNRHRjVU44cEVUTlJ0Z1YyLXVnUHlOdlIxYnFzZG9zQVFoTThfSFdUX0xJcE5pcG51b3NsWkp2OFRQVHpmMC1Hb1FuZTUzVE5HTnZ4YlVhZ09lN3JGZmhHNTExRjJEd2E1aW1zMlVtdTJTTWFFWDZuRzJaZ3o2MHVvOVVRemU1bVh0eTdaRVRhcGdJMGJiSmFDcjJaMGZRd0NRVDlqQVV6SWFmaVotT2RGS05CSFFRd3Y0TnBJRFFfTTJXZm9CUjl3NnNOYnVubDEzeHhIc3ZIcUdyazM0Ukc1dGNucjhGMHdieXBVN3Y5UFA5RnI2ZFJ6STVIZVZfY0FQM2k4cE5VMld1ZW95cHZaY2stbmw1ZkEwVkhiRE1pZzFZM3AtVzZPbmZCWU1Wa0FKRUVpMVlRNUxBd0hrSjZIc2lhVWNvNm5MT2xIRWVodFo4cnpaM0dUcFdscm14N1ZqaFJ0WFpBYjNkTW1iU0puc0RrTWV0TkNPOFZmUEJmTFlEa0J0UXRTcDBGN1A1bEJTbzdaVmFNcDNDWXRGc3hWaEpIWUlHTGdwdmRQWVRFNVZ1ZjNScTVaYXI3cS1CTV9LVDR6cnVUSnFnaERnTTIzZTc0OHRsc01fRmx6di1fcGh5Si01LXljYV80VjIzMGlVYzNTZVdWZWpqZWpnV3o4bVdIRTY4VnlRNXNBZ3dpRmhuR0t0MnpnMmxtaFBWcTddLS0+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h2 id="_5">値オブジェクト詳細設計（関数型）<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="1-position-">1. Position（座標）- 関数型実装<a class="headerlink" href="#1-position-" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 型定義</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Position</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ファクトリ関数（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Position</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">validateCoordinates</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">({</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">});</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">Position</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">createPosition</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>

<span class="c1">// バリデーション（純粋関数）</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">validateCoordinates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">Number</span><span class="p">.</span><span class="nx">isInteger</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nb">Number</span><span class="p">.</span><span class="nx">isInteger</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Coordinates must be integers&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Coordinates must be non-negative&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// 移動操作（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">dx</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">dy</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">pos</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Position</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">createPosition</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dx</span><span class="p">,</span><span class="w"> </span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dy</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">moveLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePosition</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">moveRight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePosition</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">moveUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePosition</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">moveDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePosition</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>

<span class="c1">// 隣接位置取得（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getNeighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pos</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Position</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="nx">moveUp</span><span class="p">(</span><span class="nx">pos</span><span class="p">),</span>
<span class="w">  </span><span class="nx">moveDown</span><span class="p">(</span><span class="nx">pos</span><span class="p">),</span>
<span class="w">  </span><span class="nx">moveLeft</span><span class="p">(</span><span class="nx">pos</span><span class="p">),</span>
<span class="w">  </span><span class="nx">moveRight</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
<span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">isValidPosition</span><span class="p">(</span><span class="nx">p</span><span class="p">));</span>

<span class="c1">// 位置チェック（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isAdjacentTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">pos1</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">,</span><span class="w"> </span><span class="nx">pos2</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">pos1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pos2</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">pos1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pos2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dx</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="nx">dx</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isValidPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">pos</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">height</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isWithinField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isValidPosition</span><span class="p">(</span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="mf">12</span><span class="p">);</span>

<span class="c1">// 文字列変換（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">positionToString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pos</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`(</span><span class="si">${</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span>

<span class="c1">// 等価性チェック（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isPositionEqual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">pos1</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">,</span><span class="w"> </span><span class="nx">pos2</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">pos1</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">pos2</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">pos1</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">pos2</span><span class="p">.</span><span class="nx">y</span>
<span class="p">);</span>
</code></pre></div>
<h3 id="2-puyocolor">2. PuyoColor（ぷよの色）<a class="headerlink" href="#2-puyocolor" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">RED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">GREEN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">BLUE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">YELLOW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">PURPLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;purple&#39;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">PuyoColorUtils</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">VALID_COLORS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">);</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">isValid</span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">VALID_COLORS</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">color</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">random</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">VALID_COLORS</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">randomIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">colors</span><span class="p">[</span><span class="nx">randomIndex</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">getDisplayName</span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">displayNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">[</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">RED</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;赤&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">[</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">GREEN</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;緑&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">[</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">BLUE</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;青&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">      </span><span class="p">[</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">YELLOW</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;黄&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="p">[</span><span class="nx">PuyoColor</span><span class="p">.</span><span class="nx">PURPLE</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;紫&#39;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">displayNames</span><span class="p">[</span><span class="nx">color</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">getCSSClass</span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`puyo-</span><span class="si">${</span><span class="nx">color</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3-puyo-">3. Puyo（ぷよ）- 関数型実装<a class="headerlink" href="#3-puyo-" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 型定義</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ファクトリ関数（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">validatePuyoColor</span><span class="p">(</span><span class="nx">color</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">({</span><span class="w"> </span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="p">});</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createRandomPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">getRandomColor</span><span class="p">(),</span><span class="w"> </span><span class="nx">position</span><span class="p">);</span>

<span class="c1">// バリデーション（純粋関数）</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">validatePuyoColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">isValidPuyoColor</span><span class="p">(</span><span class="nx">color</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid puyo color: </span><span class="si">${</span><span class="nx">color</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// 移動操作（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">newPosition</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">newPosition</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">dx</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">dy</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">movePosition</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span><span class="w"> </span><span class="nx">dy</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">))</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyoBy</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoRight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyoBy</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyoBy</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyoBy</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>

<span class="c1">// 色変更（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">changePuyoColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">newColor</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">newColor</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// チェック関数（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isPuyoAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">isPositionEqual</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isSamePuyoColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">puyo1</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo2</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">puyo1</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">puyo2</span><span class="p">.</span><span class="nx">color</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">arePuyosAdjacent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">puyo1</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo2</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">isAdjacentTo</span><span class="p">(</span><span class="nx">puyo1</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo2</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// 文字列変換（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyoToString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="sb">`</span><span class="si">${</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb"> at </span><span class="si">${</span><span class="nx">positionToString</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

<span class="c1">// JSON変換（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyoToJSON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">puyo.color</span><span class="p">,</span>
<span class="w">  </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">puyo.position.x</span><span class="p">,</span>
<span class="w">    </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">puyo.position.y</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// 等価性チェック（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isPuyoEqual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">puyo1</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo2</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">puyo1</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">puyo2</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">    </span><span class="nx">isPositionEqual</span><span class="p">(</span><span class="nx">puyo1</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo2</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// 配列操作ユーティリティ（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">filterPuyosByColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">,</span><span class="w"> </span><span class="nx">puyos</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">[])</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">puyos</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">puyo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">groupPuyosByColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">puyos</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">[])</span><span class="o">:</span><span class="w"> </span><span class="nb">Map</span><span class="o">&lt;</span><span class="nx">PuyoColor</span><span class="p">,</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">fp</span><span class="p">.</span><span class="nx">groupBy</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">puyos</span><span class="p">);</span>
</code></pre></div>
<h3 id="4-rotation-">4. Rotation（回転状態）- 関数型実装<a class="headerlink" href="#4-rotation-" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 型定義</span>
<span class="k">export</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="nx">Rotation</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">UP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w">      </span><span class="c1">// 0度 (初期状態)</span>
<span class="w">  </span><span class="nx">RIGHT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">90</span><span class="p">,</span><span class="w">  </span><span class="c1">// 90度</span>
<span class="w">  </span><span class="nx">DOWN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">180</span><span class="p">,</span><span class="w">  </span><span class="c1">// 180度</span>
<span class="w">  </span><span class="nx">LEFT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">270</span><span class="w">   </span><span class="c1">// 270度</span>
<span class="p">}</span>

<span class="c1">// ファクトリ関数（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Rotation</span><span class="p">.</span><span class="nx">UP</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Rotation</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">validateRotation</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">angle</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// バリデーション（純粋関数）</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">validateRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">90</span><span class="p">,</span><span class="w"> </span><span class="mf">180</span><span class="p">,</span><span class="w"> </span><span class="mf">270</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">angle</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid rotation angle: </span><span class="si">${</span><span class="nx">angle</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// 角度から回転状態を作成（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotationFromAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">angle</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Rotation</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">normalizedAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nx">angle</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">360</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">360</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">360</span><span class="p">;</span>

<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">normalizedAngle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">0</span><span class="o">:</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span><span class="nx">Rotation</span><span class="p">.</span><span class="nx">UP</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">90</span><span class="o">:</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span><span class="nx">Rotation</span><span class="p">.</span><span class="nx">RIGHT</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">180</span><span class="o">:</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span><span class="nx">Rotation</span><span class="p">.</span><span class="nx">DOWN</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">270</span><span class="o">:</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span><span class="nx">Rotation</span><span class="p">.</span><span class="nx">LEFT</span><span class="p">;</span>
<span class="w">    </span><span class="nx">default</span><span class="o">:</span>
<span class="w">      </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid rotation angle: </span><span class="si">${</span><span class="nx">angle</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// 回転操作（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotateClockwise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">rotation</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Rotation</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">nextAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">rotation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">90</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">360</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">rotationFromAngle</span><span class="p">(</span><span class="nx">nextAngle</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotateCounterClockwise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">rotation</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Rotation</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">nextAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">rotation</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">90</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">360</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">360</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">rotationFromAngle</span><span class="p">(</span><span class="nx">nextAngle</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// 指定回数回転（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotateBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">times</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">rotation</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Rotation</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rotation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">times</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">90</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rotationFromAngle</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="c1">// サブぷよのオフセット取得（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getOffsetForSubPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">rotation</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Position</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">rotation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">Rotation.UP</span><span class="o">:</span>
<span class="w">      </span><span class="kt">return</span><span class="w"> </span><span class="nx">createPosition</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// 上</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">Rotation.RIGHT</span><span class="o">:</span>
<span class="w">      </span><span class="kt">return</span><span class="w"> </span><span class="nx">createPosition</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span><span class="w">   </span><span class="c1">// 右</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">Rotation.DOWN</span><span class="o">:</span>
<span class="w">      </span><span class="kt">return</span><span class="w"> </span><span class="nx">createPosition</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">   </span><span class="c1">// 下</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">Rotation.LEFT</span><span class="o">:</span>
<span class="w">      </span><span class="kt">return</span><span class="w"> </span><span class="nx">createPosition</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// 左</span>
<span class="w">    </span><span class="nx">default</span><span class="o">:</span>
<span class="w">      </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid rotation: </span><span class="si">${</span><span class="nx">rotation</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// 文字列変換（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotationToString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">rotation</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">rotation</span><span class="si">}</span><span class="sb">°`</span><span class="p">;</span>

<span class="c1">// 回転の合成（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">composeRotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">...rotations</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="p">[])</span><span class="o">:</span><span class="w"> </span><span class="nx">Rotation</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">totalAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rotations</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">rot</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rot</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">rotationFromAngle</span><span class="p">(</span><span class="nx">totalAngle</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="5-puyopair-">5. PuyoPair（組ぷよ）- 関数型実装<a class="headerlink" href="#5-puyopair-" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 型定義</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">sub</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">rotation</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ファクトリ関数（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createPuyoPair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">,</span>
<span class="w">  </span><span class="nx">sub</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">,</span>
<span class="w">  </span><span class="nx">rotation</span><span class="o">:</span><span class="w"> </span><span class="kt">Rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Rotation</span><span class="p">.</span><span class="nx">UP</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">validatePuyoPair</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="w"> </span><span class="nx">sub</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">({</span><span class="w"> </span><span class="nx">main</span><span class="p">,</span><span class="w"> </span><span class="nx">sub</span><span class="p">,</span><span class="w"> </span><span class="nx">rotation</span><span class="w"> </span><span class="p">});</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createRandomPuyoPair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createRandomPuyo</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">subPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">moveUp</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createRandomPuyo</span><span class="p">(</span><span class="nx">subPosition</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">createPuyoPair</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="w"> </span><span class="nx">sub</span><span class="p">,</span><span class="w"> </span><span class="nx">Rotation</span><span class="p">.</span><span class="nx">UP</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// バリデーション（純粋関数）</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">validatePuyoPair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">sub</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isPuyoEqual</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="w"> </span><span class="nx">sub</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Main and sub puyo cannot be the same&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// 位置計算（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getSubPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Position</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getOffsetForSubPuyo</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">rotation</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">movePosition</span><span class="p">(</span><span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getSubPuyoAtCorrectPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">movePuyoTo</span><span class="p">(</span><span class="nx">getSubPosition</span><span class="p">(</span><span class="nx">pair</span><span class="p">),</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">sub</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getPuyos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">Puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="p">[</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">,</span><span class="w"> </span><span class="nx">getSubPuyoAtCorrectPosition</span><span class="p">(</span><span class="nx">pair</span><span class="p">)];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getPositions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">Position</span><span class="p">,</span><span class="w"> </span><span class="nx">Position</span><span class="p">]</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="p">[</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">getSubPosition</span><span class="p">(</span><span class="nx">pair</span><span class="p">)];</span>

<span class="c1">// 移動操作（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoPairLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">createPuyoPair</span><span class="p">(</span><span class="nx">movePuyoLeft</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">),</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">sub</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">rotation</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoPairRight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">createPuyoPair</span><span class="p">(</span><span class="nx">movePuyoRight</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">),</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">sub</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">rotation</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoPairDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">createPuyoPair</span><span class="p">(</span><span class="nx">movePuyoDown</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">),</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">sub</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">rotation</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePuyoPairBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">dx</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">dy</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">createPuyoPair</span><span class="p">(</span><span class="nx">movePuyoBy</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span><span class="w"> </span><span class="nx">dy</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">),</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">sub</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">rotation</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// 回転操作（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotatePuyoPairClockwise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">createPuyoPair</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">sub</span><span class="p">,</span><span class="w"> </span><span class="nx">rotateClockwise</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">rotation</span><span class="p">));</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotatePuyoPairCounterClockwise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">createPuyoPair</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span><span class="nx">sub</span><span class="p">,</span><span class="w"> </span><span class="nx">rotateCounterClockwise</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">rotation</span><span class="p">));</span>

<span class="c1">// フィールド適合性チェック（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">canFitInField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">fieldWidth</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">fieldHeight</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">mainPos</span><span class="p">,</span><span class="w"> </span><span class="nx">subPos</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getPositions</span><span class="p">(</span><span class="nx">pair</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">isValidPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isValidPosition</span><span class="p">(</span><span class="nx">fieldWidth</span><span class="p">,</span><span class="w"> </span><span class="nx">fieldHeight</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">isValidPos</span><span class="p">(</span><span class="nx">mainPos</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">isValidPos</span><span class="p">(</span><span class="nx">subPos</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="c1">// 壁蹴り回転（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotateWithWallKick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">fieldWidth</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">fieldHeight</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">,</span><span class="w"> </span><span class="nx">clockwise</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clockwise</span><span class="w"> </span><span class="o">?</span><span class="w"> </span>
<span class="w">      </span><span class="nx">rotatePuyoPairClockwise</span><span class="p">(</span><span class="nx">pair</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span>
<span class="w">      </span><span class="nx">rotatePuyoPairCounterClockwise</span><span class="p">(</span><span class="nx">pair</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">canFit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canFitInField</span><span class="p">(</span><span class="nx">fieldWidth</span><span class="p">,</span><span class="w"> </span><span class="nx">fieldHeight</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 通常の回転が可能な場合</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">canFit</span><span class="p">(</span><span class="nx">rotated</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">rotated</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 左に移動してから回転</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">leftShifted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyoPairLeft</span><span class="p">(</span><span class="nx">rotated</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">canFit</span><span class="p">(</span><span class="nx">leftShifted</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">leftShifted</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 右に移動してから回転</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rightShifted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyoPairRight</span><span class="p">(</span><span class="nx">rotated</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">canFit</span><span class="p">(</span><span class="nx">rightShifted</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">rightShifted</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 回転できない場合は元の状態を返す</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">pair</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="c1">// 文字列変換（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyoPairToString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">subPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getSubPosition</span><span class="p">(</span><span class="nx">pair</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="sb">`PuyoPair[</span><span class="si">${</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">color</span><span class="si">}</span><span class="sb">@</span><span class="si">${</span><span class="nx">positionToString</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span><span class="si">}</span><span class="sb">, `</span><span class="w"> </span><span class="o">+</span>
<span class="w">         </span><span class="sb">`</span><span class="si">${</span><span class="nx">pair</span><span class="p">.</span><span class="nx">sub</span><span class="p">.</span><span class="nx">color</span><span class="si">}</span><span class="sb">@</span><span class="si">${</span><span class="nx">positionToString</span><span class="p">(</span><span class="nx">subPos</span><span class="p">)</span><span class="si">}</span><span class="sb">] rot:</span><span class="si">${</span><span class="nx">rotationToString</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">rotation</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// JSON変換（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">puyoPairToJSON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">pair</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPair</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="kt">puyoToJSON</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">main</span><span class="p">),</span>
<span class="w">  </span><span class="nx">sub</span><span class="o">:</span><span class="w"> </span><span class="kt">puyoToJSON</span><span class="p">(</span><span class="nx">pair</span><span class="p">.</span><span class="nx">sub</span><span class="p">),</span>
<span class="w">  </span><span class="nx">rotation</span><span class="o">:</span><span class="w"> </span><span class="kt">pair.rotation</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="_6">エンティティ設計<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<h3 id="1-gameid-">1. GameId（ゲーム識別子）- 関数型実装<a class="headerlink" href="#1-gameid-" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 型定義</span>
<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">GameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>

<span class="c1">// バリデーション（純粋関数）</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">validateGameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">value</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;GameId cannot be empty&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;GameId cannot exceed 100 characters&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="sr">/^[a-zA-Z0-9_-]+$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;GameId can only contain alphanumeric characters, underscores, and hyphens&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// ファクトリ関数（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createGameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameId</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">validateGameId</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// ID生成（純粋関数化のため、タイムスタンプとランダム値を引数として受け取る）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">generateGameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">random</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameId</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestampStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">36</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">randomStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">random</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">9</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">createGameId</span><span class="p">(</span><span class="sb">`game_</span><span class="si">${</span><span class="nx">timestampStr</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">randomStr</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// より純粋なID生成（シード付き）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">generateGameIdWithSeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">seed</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameId</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">      </span><span class="p">(</span><span class="nx">s</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">fp</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">c</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mf">0</span><span class="p">)),</span>
<span class="w">      </span><span class="nx">fp</span><span class="p">.</span><span class="nx">sum</span>
<span class="w">    </span><span class="p">)(</span><span class="nx">seed</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">createGameId</span><span class="p">(</span><span class="sb">`game_</span><span class="si">${</span><span class="nx">hash</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">counter</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="c1">// ID操作ユーティリティ（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isValidGameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">validateGameId</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameIdToString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">GameId</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameIdEquals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">id1</span><span class="o">:</span><span class="w"> </span><span class="kt">GameId</span><span class="p">,</span><span class="w"> </span><span class="nx">id2</span><span class="o">:</span><span class="w"> </span><span class="kt">GameId</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">id1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">id2</span>
<span class="p">);</span>
</code></pre></div>
<h3 id="2-field-">2. Field（フィールド）- 関数型実装<a class="headerlink" href="#2-field-" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 型定義</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">FieldId</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">grid</span><span class="o">:</span><span class="w"> </span><span class="kt">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="k">readonly</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">FieldId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>

<span class="c1">// 定数</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">DEFAULT_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6</span><span class="p">;</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">DEFAULT_HEIGHT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">12</span><span class="p">;</span>

<span class="c1">// ファクトリ関数（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createEmptyField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">FieldId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateFieldId</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DEFAULT_WIDTH</span><span class="p">,</span>
<span class="w">  </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DEFAULT_HEIGHT</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">validateFieldDimensions</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">times</span><span class="p">(</span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">times</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">),</span>
<span class="w">    </span><span class="nx">height</span>
<span class="w">  </span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">grid</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="p">});</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">createFieldFromGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="nx">grid</span><span class="o">:</span><span class="w"> </span><span class="kt">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">FieldId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateFieldId</span><span class="p">()</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">grid</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">grid</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>

<span class="w">  </span><span class="nx">validateFieldDimensions</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">);</span>
<span class="w">  </span><span class="nx">validateGrid</span><span class="p">(</span><span class="nx">grid</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">({</span>
<span class="w">    </span><span class="nx">id</span><span class="p">,</span>
<span class="w">    </span><span class="nx">grid</span><span class="o">:</span><span class="w"> </span><span class="kt">fp.map</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">([...</span><span class="nx">row</span><span class="p">]),</span><span class="w"> </span><span class="nx">grid</span><span class="p">),</span>
<span class="w">    </span><span class="nx">width</span><span class="p">,</span>
<span class="w">    </span><span class="nx">height</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>

<span class="c1">// FieldId生成（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">generateFieldId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">random</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">FieldId</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestampStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">36</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">randomStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">random</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">9</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="sb">`field_</span><span class="si">${</span><span class="nx">timestampStr</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">randomStr</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// バリデーション（純粋関数）</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">validateFieldDimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">width</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Field dimensions must be positive&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">width</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">20</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">20</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Field dimensions are too large&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">validateGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="nx">grid</span><span class="o">:</span><span class="w"> </span><span class="kt">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span>
<span class="w">  </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">grid</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Grid height does not match field height&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">grid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">width</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Grid width does not match field width&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// クエリ関数（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isEmpty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">row</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">cell</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">cell</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isFull</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">row</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">cell</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">cell</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isValidFieldPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">isValidPosition</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">canPlacePuyoAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">isValidFieldPosition</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">    </span><span class="nx">getPuyoAt</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getPuyoAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">isValidFieldPosition</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">[</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">][</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Lodash/fpを活用したフィールド検索（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getPuyosOfColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoColor</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">      </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flatMap</span><span class="p">((</span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="kt">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">row</span><span class="p">),</span>
<span class="w">      </span><span class="nx">fp</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">color</span><span class="p">)</span>
<span class="w">    </span><span class="p">)(</span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">[]</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getAllPuyos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flatMap</span><span class="p">((</span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="kt">ReadonlyArray</span><span class="o">&lt;</span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">row</span><span class="p">),</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<span class="w">  </span><span class="p">)(</span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">[];</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">getAllPositions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Position</span><span class="p">[]</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">positions</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span><span class="w"> </span><span class="nx">y</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span><span class="w"> </span><span class="nx">x</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">positions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">createPosition</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">positions</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// フィールド変更操作（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">placePuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">canPlacePuyoAt</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Cannot place puyo at position </span><span class="si">${</span><span class="nx">positionToString</span><span class="p">(</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">);</span>
<span class="w">    </span><span class="nx">newGrid</span><span class="p">[</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">][</span><span class="nx">puyo</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">puyo</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">createFieldFromGrid</span><span class="p">(</span><span class="nx">newGrid</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">removePuyoAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">isValidFieldPosition</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid position: </span><span class="si">${</span><span class="nx">positionToString</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">);</span>
<span class="w">    </span><span class="nx">newGrid</span><span class="p">[</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">][</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">createFieldFromGrid</span><span class="p">(</span><span class="nx">newGrid</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">removePuyosAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">positions</span><span class="o">:</span><span class="w"> </span><span class="kt">Position</span><span class="p">[],</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">positions</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">currentField</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">removePuyoAt</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span><span class="w"> </span><span class="nx">currentField</span><span class="p">),</span><span class="w"> </span><span class="nx">field</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// 重力適用（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">applyGravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">newGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">times</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">times</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">width</span><span class="p">),</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// 各列について重力を適用</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span><span class="w"> </span><span class="nx">x</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">      </span><span class="nx">fp</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="mf">0</span><span class="p">),</span>
<span class="w">      </span><span class="nx">fp</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">[</span><span class="nx">y</span><span class="p">][</span><span class="nx">x</span><span class="p">]),</span>
<span class="w">      </span><span class="nx">fp</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">null</span><span class="p">),</span>
<span class="w">      </span><span class="nx">fp</span><span class="p">.</span><span class="nx">reverse</span>
<span class="w">    </span><span class="p">)(</span><span class="nx">field</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">[];</span>

<span class="w">    </span><span class="c1">// 列を再構築（下から埋める）</span>
<span class="w">    </span><span class="nx">column</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">puyo</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">newY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">index</span><span class="p">;</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">newPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">movePuyoTo</span><span class="p">(</span><span class="nx">createPosition</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">newY</span><span class="p">),</span><span class="w"> </span><span class="nx">puyo</span><span class="p">);</span>
<span class="w">      </span><span class="nx">newGrid</span><span class="p">[</span><span class="nx">newY</span><span class="p">][</span><span class="nx">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newPuyo</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">createFieldFromGrid</span><span class="p">(</span><span class="nx">newGrid</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// 変換・表示（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">fieldToPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[][]</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">fp</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">puyo</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">puyo</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;.&#39;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)(</span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">fieldToString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">fp</span><span class="p">.</span><span class="nx">flow</span><span class="p">(</span>
<span class="w">    </span><span class="nx">fieldToPattern</span><span class="p">,</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">row</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)),</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)(</span><span class="nx">field</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">fieldToJSON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">field.id</span><span class="p">,</span>
<span class="w">  </span><span class="nx">grid</span><span class="o">:</span><span class="w"> </span><span class="kt">fp.map</span><span class="p">(</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">puyoToJSON</span><span class="p">(</span><span class="nx">puyo</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<span class="w">  </span><span class="p">)(</span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">),</span>
<span class="w">  </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="kt">field.width</span><span class="p">,</span>
<span class="w">  </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="kt">field.height</span>
<span class="p">});</span>

<span class="c1">// フィールド比較（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">fieldsEqual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="nx">field1</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">,</span><span class="w"> </span><span class="nx">field2</span><span class="o">:</span><span class="w"> </span><span class="kt">Field</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="nx">field1</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">field2</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="nx">field1</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">field2</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">field1</span><span class="p">.</span><span class="nx">grid</span><span class="p">,</span><span class="w"> </span><span class="nx">field2</span><span class="p">.</span><span class="nx">grid</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<h2 id="json">JSONシリアル化サポート<a class="headerlink" href="#json" title="Permanent link">&para;</a></h2>
<h3 id="1_1">1. シリアル化インターフェース<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Serializable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">toJSON</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">T</span><span class="p">;</span>
<span class="w">  </span><span class="nx">toString</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Deserializable</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">TJson</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">fromJSON</span><span class="p">(</span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">TJson</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">T</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ゲーム状態のシリアル化</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">GameStateJson</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoJson</span><span class="p">[][];</span>
<span class="w">  </span><span class="nx">currentPuyo</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPairJson</span><span class="p">;</span>
<span class="w">  </span><span class="nx">nextPuyo</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPairJson</span><span class="p">;</span>
<span class="w">  </span><span class="nx">score</span><span class="o">:</span><span class="w"> </span><span class="kt">ScoreJson</span><span class="p">;</span>
<span class="w">  </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">lastUpdate</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">PuyoJson</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">PuyoPairJson</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoJson</span><span class="p">;</span>
<span class="w">  </span><span class="nx">sub</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoJson</span><span class="p">;</span>
<span class="w">  </span><span class="nx">rotation</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ScoreJson</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">current</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">highScore</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">combo</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-">2. シリアル化の実装 - 関数型アプローチ<a class="headerlink" href="#2-" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fp</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;lodash/fp&#39;</span><span class="p">;</span>

<span class="c1">// 関数型シリアル化実装（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">serializeGameState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">game</span><span class="o">:</span><span class="w"> </span><span class="kt">Game</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">GameStateJson</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">gameIdToString</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span>
<span class="w">  </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="kt">fp.map</span><span class="p">(</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">puyo</span><span class="o">:</span><span class="w"> </span><span class="kt">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">puyo</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">puyoToJSON</span><span class="p">(</span><span class="nx">puyo</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<span class="w">  </span><span class="p">)(</span><span class="nx">game</span><span class="p">.</span><span class="nx">field</span><span class="p">.</span><span class="nx">grid</span><span class="p">),</span>
<span class="w">  </span><span class="nx">currentPuyo</span><span class="o">:</span><span class="w"> </span><span class="kt">puyoPairToJSON</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">currentPuyo</span><span class="p">),</span>
<span class="w">  </span><span class="nx">nextPuyo</span><span class="o">:</span><span class="w"> </span><span class="kt">puyoPairToJSON</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">nextPuyo</span><span class="p">),</span>
<span class="w">  </span><span class="nx">score</span><span class="o">:</span><span class="w"> </span><span class="kt">scoreToJSON</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">score</span><span class="p">),</span>
<span class="w">  </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">gameStateToString</span><span class="p">(</span><span class="nx">game</span><span class="p">.</span><span class="nx">state</span><span class="p">),</span>
<span class="w">  </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">game.createdAt.toISOString</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">lastUpdate</span><span class="o">:</span><span class="w"> </span><span class="kt">game.lastUpdate.toISOString</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// デシリアル化関数群（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">deserializeGameState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">GameStateJson</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Game</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">gameId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createGameId</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deserializeField</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">field</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deserializePuyoPair</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">currentPuyo</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">nextPuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deserializePuyoPair</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">nextPuyo</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deserializeScore</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">score</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gameStateFromString</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">createGame</span><span class="p">({</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">gameId</span><span class="p">,</span>
<span class="w">    </span><span class="nx">field</span><span class="p">,</span>
<span class="w">    </span><span class="nx">currentPuyo</span><span class="p">,</span>
<span class="w">    </span><span class="nx">nextPuyo</span><span class="p">,</span>
<span class="w">    </span><span class="nx">score</span><span class="p">,</span>
<span class="w">    </span><span class="nx">state</span><span class="p">,</span>
<span class="w">    </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">),</span>
<span class="w">    </span><span class="nx">lastUpdate</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">lastUpdate</span><span class="p">)</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">deserializeField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">gridJson</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">PuyoJson</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)[][])</span><span class="o">:</span><span class="w"> </span><span class="nx">Field</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fp</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
<span class="w">    </span><span class="nx">fp</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">puyoJson</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoJson</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">puyoJson</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">deserializePuyo</span><span class="p">(</span><span class="nx">puyoJson</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)(</span><span class="nx">gridJson</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">createFieldFromGrid</span><span class="p">(</span><span class="nx">grid</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">deserializePuyo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoJson</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createPosition</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">createPuyo</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">deserializePuyoPair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">PuyoPairJson</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deserializePuyo</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">main</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">deserializePuyo</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">sub</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rotationFromAngle</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">rotation</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">createPuyoPair</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="w"> </span><span class="nx">sub</span><span class="p">,</span><span class="w"> </span><span class="nx">rotation</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">deserializeScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">ScoreJson</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Score</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">createScore</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">current</span><span class="p">,</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">highScore</span><span class="p">,</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">combo</span><span class="p">);</span>

<span class="c1">// バリデーション付きデシリアル化（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">deserializeGameStateWithValidation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Game</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">validateGameStateJson</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">deserializeGameState</span><span class="p">(</span><span class="nx">json</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">GameStateJson</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">validateGameStateJson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">json</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">json</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Invalid game state JSON: must be an object&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">json</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Invalid game state JSON: missing or invalid id&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">field</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Invalid game state JSON: field must be an array&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// 他の必要なバリデーションを追加...</span>
<span class="p">};</span>

<span class="c1">// JSON形式の型ガード（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">isGameStateJson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">obj</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">GameStateJson</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="nx">obj</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">field</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="nx">obj</span><span class="p">.</span><span class="nx">currentPuyo</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="nx">obj</span><span class="p">.</span><span class="nx">nextPuyo</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="nx">obj</span><span class="p">.</span><span class="nx">score</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">state</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">createdAt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">lastUpdate</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">;</span>

<span class="c1">// 安全な変換ユーティリティ（純粋関数）</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">safeDeserialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">deserializeFn</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">T</span><span class="p">,</span>
<span class="w">  </span><span class="nx">fallback</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span>
<span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">T</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">deserializeFn</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Deserialization failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fallback</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// 使用例: </span>
<span class="c1">// const safeDeserializeGame = safeDeserialize(deserializeGameState, createDefaultGame());</span>
</code></pre></div>
<h2 id="_7">タイプガード・バリデーション<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<h3 id="1_2">1. 型安全性の確保<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">TypeGuards</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">isPuyo</span><span class="p">(</span><span class="nx">obj</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">Puyo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">Puyo</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">isPuyoColor</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">PuyoColor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">PuyoColor</span><span class="p">).</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">isPosition</span><span class="p">(</span><span class="nx">obj</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">Position</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">Position</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">isPuyoPair</span><span class="p">(</span><span class="nx">obj</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">PuyoPair</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">isValidGridCell</span><span class="p">(</span><span class="nx">cell</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">cell</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="p">(</span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cell</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">isPuyo</span><span class="p">(</span><span class="nx">cell</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">isValidGrid</span><span class="p">(</span><span class="nx">grid</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">grid</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="p">(</span><span class="nx">Puyo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)[][]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">grid</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">           </span><span class="nx">grid</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">row</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">             </span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">row</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">             </span><span class="nx">row</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">cell</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">isValidGridCell</span><span class="p">(</span><span class="nx">cell</span><span class="p">))</span>
<span class="w">           </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Validators</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nx">validateGameConfiguration</span><span class="p">(</span><span class="nx">config</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">fieldWidth</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">fieldWidth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">4</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">fieldWidth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Field width must be between 4 and 10&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">fieldHeight</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">fieldHeight</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">8</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">fieldHeight</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">20</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Field height must be between 8 and 20&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">availableColors</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">availableColors</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;At least 3 colors must be available&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">availableColors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">TypeGuards</span><span class="p">.</span><span class="nx">isPuyoColor</span><span class="p">(</span><span class="nx">color</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid color: </span><span class="si">${</span><span class="nx">color</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_8">まとめ<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>この関数型データモデル設計により以下を実現：</p>
<ol>
<li><strong>関数型プログラミングの原則</strong>:</li>
<li>純粋関数による予測可能な動作</li>
<li>イミュータブルなデータ構造</li>
<li>
<p>副作用の排除</p>
</li>
<li>
<p><strong>Lodash/fpの活用</strong>:</p>
</li>
<li>カリー化された関数によるコンポーザビリティ</li>
<li>宣言的なデータ変換パイプライン</li>
<li>
<p>関数合成による複雑な処理の構築</p>
</li>
<li>
<p><strong>型安全性とバリデーション</strong>:</p>
</li>
<li>TypeScriptによる厳密な型定義</li>
<li>実行時バリデーションによる堅牢性</li>
<li>
<p>タイプガードによる型の保証</p>
</li>
<li>
<p><strong>テスタビリティ</strong>:</p>
</li>
<li>純粋関数による単体テストの容易さ</li>
<li>副作用がないためのモックの不要性</li>
<li>
<p>プロパティベーステストへの適合性</p>
</li>
<li>
<p><strong>保守性と拡張性</strong>:</p>
</li>
<li>単一責任原則に従った関数分割</li>
<li>高次関数による共通処理の抽象化</li>
<li>
<p>依存性の明確化</p>
</li>
<li>
<p><strong>ドメインモデルの表現</strong>:</p>
</li>
<li>ビジネスルールを純粋関数として実装</li>
<li>ドメイン用語の関数名による明確化</li>
<li>複雑なゲームロジックの関数合成</li>
</ol>
<p>次のPhase 3（開発）では、この関数型データモデルを基盤として、TDD（Red-Green-Refactor）サイクルで具体的な実装を行います。実装戦略で定義したLodash/fpベースの関数型アプローチを実践し、テスト容易性と保守性の高いコードを構築していきます。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works" target="_blank" rel="noopener" title="GitHub Repository/claude-code-booster" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>