
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Site Description">
      
      
        <meta name="author" content="Project Team">
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>TypeScriptによるヘキサゴナルアーキテクチャ実装 - Site Name</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#typescript" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Site Name" class="md-header__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Site Name
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TypeScriptによるヘキサゴナルアーキテクチャ実装
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Site Name" class="md-nav__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Site Name
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="typescript">TypeScriptによるヘキサゴナルアーキテクチャ実装<a class="headerlink" href="#typescript" title="Permanent link">&para;</a></h1>
<h2 id="_1">概要<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>このドキュメントでは、TypeScript/Node.jsを使用してヘキサゴナルアーキテクチャ（Ports and Adaptersパターン）を実装する方法を、会議室予約システムを例に詳しく解説します。レイヤードアーキテクチャからヘキサゴナルアーキテクチャへの移行過程を、テスト駆動開発（TDD）を交えて実装していきます。</p>
<h3 id="_2">対象読者<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<ul>
<li>TypeScript/Node.js開発者</li>
<li>クリーンアーキテクチャやヘキサゴナルアーキテクチャに興味がある方</li>
<li>テスト駆動開発（TDD）を実践したい方</li>
<li>保守性の高いアプリケーション設計を学びたい方</li>
</ul>
<h3 id="_3">技術スタック<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>言語</strong>: TypeScript 5.0+</li>
<li><strong>ランタイム</strong>: Node.js 18+</li>
<li><strong>Webフレームワーク</strong>: Express.js</li>
<li><strong>データベース</strong>: SQLite (開発用), PostgreSQL (本番用)</li>
<li><strong>ORM</strong>: Prisma</li>
<li><strong>テストフレームワーク</strong>: Jest</li>
<li><strong>バリデーション</strong>: Zod</li>
<li><strong>DIコンテナ</strong>: TypeDI</li>
</ul>
<hr />
<h2 id="_4">目次<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#第1章-サンプルアプリケーション実装">サンプルアプリケーション実装</a></li>
<li><a href="#第2章-レイヤードアーキテクチャ">レイヤードアーキテクチャ</a></li>
<li><a href="#第3章-ヘキサゴナルアーキテクチャ">ヘキサゴナルアーキテクチャ</a></li>
</ol>
<hr />
<h2 id="1">第1章: サンプルアプリケーション実装<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 会議室予約システムの要件<a class="headerlink" href="#11" title="Permanent link">&para;</a></h3>
<p>Spring Boot版と同様の会議室予約システムをTypeScriptで実装します。</p>
<h4 id="_5">機能要件<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>会議室予約</strong>: ユーザーが特定の日時に会議室を予約</li>
<li><strong>予約一覧表示</strong>: 特定の日付の予約状況を表示</li>
<li><strong>予約キャンセル</strong>: 既存の予約をキャンセル</li>
<li><strong>ユーザー認証</strong>: 基本的な認証機能</li>
</ul>
<h4 id="_6">非機能要件<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>保守性</strong>: 変更が他の部分に影響しにくい設計</li>
<li><strong>テスタビリティ</strong>: 単体テストが書きやすい設計</li>
<li><strong>拡張性</strong>: 新機能追加が容易な設計</li>
</ul>
<h3 id="12">1.2 プロジェクトセットアップ<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<h4 id="packagejson">package.json<a class="headerlink" href="#packagejson" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;meeting-room-reservation-ts&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Meeting Room Reservation System with Hexagonal Architecture&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dist/index.js&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nodemon src/index.ts&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tsc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:watch&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest --watch&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:coverage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest --coverage&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;prisma:generate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prisma generate&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;prisma:migrate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prisma migrate dev&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;dependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;express&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^4.18.2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;prisma&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;@prisma/client&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;typedi&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^0.10.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;zod&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^3.21.4&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;bcrypt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.1.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;jsonwebtoken&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^9.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;reflect-metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^0.1.13&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;@types/express&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^4.17.17&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;@types/node&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^20.3.1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;@types/jest&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^29.5.2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;@types/bcrypt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;@types/jsonwebtoken&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^9.0.2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;typescript&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.1.3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;nodemon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^2.0.22&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ts-node&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^10.9.1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;jest&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^29.5.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ts-jest&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^29.1.0&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="tsconfigjson">tsconfig.json<a class="headerlink" href="#tsconfigjson" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;compilerOptions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ES2022&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;commonjs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lib&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ES2022&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;outDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./dist&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;rootDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./src&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;strict&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;esModuleInterop&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;skipLibCheck&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;forceConsistentCasingInFileNames&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;experimentalDecorators&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;emitDecoratorMetadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;resolveJsonModule&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;include&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;src/**/*&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;exclude&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;node_modules&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dist&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;**/*.test.ts&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;**/*.spec.ts&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="13-tdd">1.3 TDD（テスト駆動開発）の実践<a class="headerlink" href="#13-tdd" title="Permanent link">&para;</a></h3>
<p>TypeScriptでのTDD実装を、ドメインモデルから始めます。</p>
<h4 id="131-reservationtimeslottdd">1.3.1 ReservationTimeSlotのTDD実装<a class="headerlink" href="#131-reservationtimeslottdd" title="Permanent link">&para;</a></h4>
<p><strong>Red: 失敗するテストから開始</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// src/domain/model/reservation/ReservationTimeSlot.test.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservationTimeSlot&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ReservationTimeSlot&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;overlap&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;同一時間帯の場合は重複する&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">slot1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">slot2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">slot1</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">slot2</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;部分重複の場合は重複する&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">slot1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">slot2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:30:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:30:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">slot1</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">slot2</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;時間が重複しない場合はfalse&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">slot1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">slot2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T11:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">slot1</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">slot2</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;開始時間が終了時間より後の場合はエラー&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">)).</span><span class="nx">toThrow</span><span class="p">(</span><span class="s1">&#39;開始時間は終了時間より前である必要があります&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><strong>Green: テストを通す最小限の実装</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// src/domain/model/reservation/ReservationTimeSlot.ts</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">,</span><span class="w"> </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">startTime</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">endTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;開始時間は終了時間より前である必要があります&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">startTime</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_endTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">endTime</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">startTime</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">endTime</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_endTime</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">overlap</span><span class="p">(</span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_endTime</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">_startTime</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">_endTime</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">equals</span><span class="p">(</span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">           </span><span class="k">this</span><span class="p">.</span><span class="nx">_endTime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">_endTime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Refactor: より読みやすく、拡張しやすくリファクタリング</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// src/domain/model/reservation/ReservationTimeSlot.ts</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">,</span><span class="w"> </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">validateTimeRange</span><span class="p">(</span><span class="nx">startTime</span><span class="p">,</span><span class="w"> </span><span class="nx">endTime</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">startTime</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_endTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">endTime</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">validateTimeRange</span><span class="p">(</span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">,</span><span class="w"> </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">startTime</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">endTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;開始時間は終了時間より前である必要があります&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">startTime</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">endTime</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_endTime</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 他の時間スロットと重複しているかチェック</span>
<span class="cm">   * アルゴリズム: 時間帯AとBが重複する条件は</span>
<span class="cm">   * A.endTime &gt; B.startTime &amp;&amp; B.endTime &gt; A.startTime</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">overlap</span><span class="p">(</span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_endTime</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">_startTime</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">_endTime</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">equals</span><span class="p">(</span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">           </span><span class="k">this</span><span class="p">.</span><span class="nx">_endTime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">_endTime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">toString</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">formatTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">date</span><span class="p">.</span><span class="nx">toTimeString</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// HH:MM形式</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">formatTime</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">)</span><span class="si">}</span><span class="sb">-</span><span class="si">${</span><span class="nx">formatTime</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_endTime</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="132-tdd">1.3.2 値オブジェクトのTDD実装<a class="headerlink" href="#132-tdd" title="Permanent link">&para;</a></h4>
<p><strong>UserId値オブジェクト</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">// src/domain/model/auth/UserId.test.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./UserId&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;UserId&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;正常な値でUserId作成&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">userId</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;空文字の場合はエラー&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)).</span><span class="nx">toThrow</span><span class="p">(</span><span class="s1">&#39;ユーザーIDは必須です&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;nullの場合はエラー&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">)).</span><span class="nx">toThrow</span><span class="p">(</span><span class="s1">&#39;ユーザーIDは必須です&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;同じ値のUserIdは等価&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">userId1</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">userId2</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;違う値のUserIdは非等価&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;user456&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">userId1</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">userId2</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// src/domain/model/auth/UserId.ts</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">UserId</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_value</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">value</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;ユーザーIDは必須です&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">value</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">equals</span><span class="p">(</span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="kt">UserId</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">_value</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">toString</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="133-reservation">1.3.3 Reservationエンティティのテスト駆動実装<a class="headerlink" href="#133-reservation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/domain/model/reservation/Reservation.test.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservationTimeSlot&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservableRoom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../auth/User&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../auth/UserId&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../room/RoomId&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Reservation&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">timeSlot</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">room</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoom</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">;</span>

<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="nx">room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">));</span>
<span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">User</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">));</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;正常に予約を作成できる&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">timeSlot</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">room</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">room</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">user</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;overlap&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;同じ部屋の重複時間は衝突する&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">overlappingTimeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:30:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:30:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">overlappingTimeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservation1</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">reservation2</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;違う部屋の場合は衝突しない&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">differentRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">2</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">));</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">differentRoom</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservation1</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">reservation2</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;時間が重複しない場合は衝突しない&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">nonOverlappingTimeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T11:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">nonOverlappingTimeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservation1</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">reservation2</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// src/domain/model/reservation/Reservation.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservationTimeSlot&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservableRoom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../auth/User&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">ReservationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">_id?</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationId</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_timeSlot</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_room</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoom</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">timeSlot</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoom</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">,</span><span class="w"> </span><span class="nx">id?</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">timeSlot</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">room</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">user</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">id</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ReservationId</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">timeSlot</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">room</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_room</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">user</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_user</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 他の予約と重複しているかチェック</span>
<span class="cm">   * 条件: 同じ部屋かつ時間が重複</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">overlap</span><span class="p">(</span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="kt">Reservation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 違う部屋の場合は重複しない</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_room</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">_room</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 同じ部屋の場合は時間の重複をチェック</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// ファクトリメソッド</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">create</span><span class="p">(</span><span class="nx">timeSlot</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoom</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// 永続化後のIDを設定</span>
<span class="w">  </span><span class="nx">withId</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationId</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_room</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_user</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="14-tdd">1.4 TDDによるサービス層の実装<a class="headerlink" href="#14-tdd" title="Permanent link">&para;</a></h3>
<h4 id="141-reservationservice">1.4.1 ReservationServiceのテスト駆動実装<a class="headerlink" href="#141-reservationservice" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/application/service/ReservationService.test.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservationService&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/ReservationRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoomRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/ReservableRoomRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/ReservationTimeSlot&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/ReservableRoom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/auth/User&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/auth/UserId&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/room/RoomId&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/AlreadyReservedException&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/UnavailableReservationException&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ReservationService&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">reservationService</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationService</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">mockReservationRepo</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.Mocked</span><span class="o">&lt;</span><span class="nx">ReservationRepository</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">mockRoomRepo</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.Mocked</span><span class="o">&lt;</span><span class="nx">ReservableRoomRepository</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">mockReservationRepo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">save</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">findByRoomAndDate</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">delete</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">findById</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">mockRoomRepo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">findAvailableRoom</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">reservationService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationService</span><span class="p">(</span><span class="nx">mockReservationRepo</span><span class="p">,</span><span class="w"> </span><span class="nx">mockRoomRepo</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;reserve&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;利用可能な部屋で時間が重複しない場合、予約が成功する&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Given</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">));</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">User</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">));</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">      </span><span class="nx">mockRoomRepo</span><span class="p">.</span><span class="nx">findAvailableRoom</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">room</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">([]);</span>
<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">save</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">withId</span><span class="p">(</span><span class="mf">1</span><span class="p">));</span>

<span class="w">      </span><span class="c1">// When</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">reserve</span><span class="p">(</span><span class="nx">reservation</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Then</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">save</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span><span class="nx">reservation</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;部屋が利用不可能な場合、UnavailableReservationExceptionをスロー&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Given</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">));</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">User</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">));</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">      </span><span class="nx">mockRoomRepo</span><span class="p">.</span><span class="nx">findAvailableRoom</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// When &amp; Then</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">reserve</span><span class="p">(</span><span class="nx">reservation</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="nx">UnavailableReservationException</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;時間が重複する予約がある場合、AlreadyReservedExceptionをスロー&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Given</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">));</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">User</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">));</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">existingTimeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:30:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:30:00&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">existingReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">existingTimeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>

<span class="w">      </span><span class="nx">mockRoomRepo</span><span class="p">.</span><span class="nx">findAvailableRoom</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">room</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">([</span><span class="nx">existingReservation</span><span class="p">]);</span>

<span class="w">      </span><span class="c1">// When &amp; Then</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">reserve</span><span class="p">(</span><span class="nx">reservation</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="nx">AlreadyReservedException</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// src/application/service/ReservationService.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/ReservationRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoomRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/ReservableRoomRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/AlreadyReservedException&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/UnavailableReservationException&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Service</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;typedi&#39;</span><span class="p">;</span>

<span class="kd">@Service</span><span class="p">()</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">reservationRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationRepository</span><span class="p">,</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">roomRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoomRepository</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">reserve</span><span class="p">(</span><span class="nx">reservation</span><span class="o">:</span><span class="w"> </span><span class="kt">Reservation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. 部屋が予約可能かチェック</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">availableRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">roomRepository</span><span class="p">.</span><span class="nx">findAvailableRoom</span><span class="p">(</span>
<span class="w">      </span><span class="nx">reservation</span><span class="p">.</span><span class="nx">room</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
<span class="w">      </span><span class="nx">reservation</span><span class="p">.</span><span class="nx">room</span><span class="p">.</span><span class="nx">date</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">availableRoom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="p">(</span>
<span class="w">        </span><span class="s1">&#39;指定の日付・部屋の組み合わせは予約できません。&#39;</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 2. 時間の重複をチェック</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">existingReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">(</span>
<span class="w">      </span><span class="nx">reservation</span><span class="p">.</span><span class="nx">room</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
<span class="w">      </span><span class="nx">reservation</span><span class="p">.</span><span class="nx">room</span><span class="p">.</span><span class="nx">date</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hasOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">existingReservations</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">existing</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">existing</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">reservation</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hasOverlap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="p">(</span>
<span class="w">        </span><span class="s1">&#39;指定の時間帯はすでに予約済みです。&#39;</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 3. 予約を保存</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">reservation</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">findReservations</span><span class="p">(</span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">(</span><span class="nx">roomId</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">cancel</span><span class="p">(</span><span class="nx">reservationId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">reservationId</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="15">1.5 統合テストの実装<a class="headerlink" href="#15" title="Permanent link">&para;</a></h3>
<h4 id="151-api">1.5.1 APIレベルの統合テスト<a class="headerlink" href="#151-api" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/__tests__/integration/ReservationAPI.test.ts</span>
<span class="k">import</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;supertest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../app&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Reservation API Integration Tests&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">prisma</span><span class="o">:</span><span class="w"> </span><span class="kt">PrismaClient</span><span class="p">;</span>

<span class="w">  </span><span class="nx">beforeAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$connect</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// テスト前にDBをクリーンアップ</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">afterAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$disconnect</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;POST /reservations - 予約が正常に作成される&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given: テストデータをセットアップ</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">firstName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">lastName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hashedpassword&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">roleName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;USER&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">meetingRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Conference Room A&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// When: API を呼び出し</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/reservations&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;09:00&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10:00&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Then: レスポンスを検証</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">201</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">reservation</span><span class="p">).</span><span class="nx">toHaveProperty</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">roomId</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// データベースに保存されたことを確認</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">savedReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">findFirst</span><span class="p">({</span>
<span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">savedReservation</span><span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;POST /reservations - 重複する予約は409エラー&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given: 既存の予約を作成</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">firstName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">lastName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hashedpassword&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">roleName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;USER&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Conference Room A&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 既存の予約</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:30:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:30:00&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// When: 重複する予約を試行</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/reservations&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10:00&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// 30分重複</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;11:00&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Then: エラーレスポンスを検証</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">409</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">error</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="s1">&#39;すでに予約済み&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="16-tdd">1.6 TDDの利点とまとめ<a class="headerlink" href="#16-tdd" title="Permanent link">&para;</a></h3>
<h4 id="161-tdd">1.6.1 TDDで得られた利点<a class="headerlink" href="#161-tdd" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>設計の改善</strong></li>
<li>インターフェースを先に定義することで、使いやすいAPIが自然に生まれる</li>
<li>
<p>依存関係がモック可能な形で設計される</p>
</li>
<li>
<p><strong>高い品質</strong></p>
</li>
<li>100%のテストカバレッジを達成</li>
<li>
<p>リファクタリング時の安全性が確保される</p>
</li>
<li>
<p><strong>ドキュメント効果</strong></p>
</li>
<li>テストコードが実行可能な仕様書として機能</li>
<li>
<p>新しい開発者が理解しやすい</p>
</li>
<li>
<p><strong>高速な開発サイクル</strong></p>
</li>
<li>モックを使った高速なテスト実行（1テストあたり数ミリ秒）</li>
<li>即座のフィードバックによる効率的な開発</li>
</ol>
<h4 id="162-typescript">1.6.2 TypeScript特有の利点<a class="headerlink" href="#162-typescript" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 型安全性によるコンパイル時エラー検出</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">ReservationData</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 誤った型の使用はコンパイル時に検出</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">invalidReservation</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Error: Type &#39;string&#39; is not assignable to type &#39;number&#39;</span>
<span class="w">  </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;09:00&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Error: Type &#39;string&#39; is not assignable to type &#39;Date&#39;</span>
<span class="w">  </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">123</span><span class="w"> </span><span class="c1">// Error: Type &#39;number&#39; is not assignable to type &#39;string&#39;</span>
<span class="p">};</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Zodによる実行時バリデーション</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">z</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zod&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">ReservationSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z</span><span class="p">.</span><span class="nx">object</span><span class="p">({</span>
<span class="w">  </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">z.number</span><span class="p">().</span><span class="nx">positive</span><span class="p">(),</span>
<span class="w">  </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">regex</span><span class="p">(</span><span class="sr">/^\d{2}:\d{2}$/</span><span class="p">),</span>
<span class="w">  </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">regex</span><span class="p">(</span><span class="sr">/^\d{2}:\d{2}$/</span><span class="p">),</span>
<span class="w">  </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span>
<span class="w">  </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">regex</span><span class="p">(</span><span class="sr">/^\d{4}-\d{2}-\d{2}$/</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// 型安全なバリデーション</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">validateReservationRequest</span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">unknown</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">ReservationData</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">ReservationSchema</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="2">第2章: レイヤードアーキテクチャ<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 レイヤードアーキテクチャの概要<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<p>TypeScriptでのレイヤードアーキテクチャは、Express.jsベースのWebアプリケーションでよく採用される設計パターンです。各層が明確な役割を持ち、上位層が下位層に依存する形で構成されます。</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjY4NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6OTk1cHg7aGVpZ2h0OjY4NXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDk5NSA2ODUiIHdpZHRoPSI5OTVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIFByZXNlbnRhdGlvbiBMYXllci0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iUHJlc2VudGF0aW9uIExheWVyIiBkYXRhLXNvdXJjZS1saW5lPSIxIiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfUHJlc2VudGF0aW9uIExheWVyIj48cGF0aCBkPSJNMjIxLDYgTDM3Mi40Mzg1LDYgQTMuNzUsMy43NSAwIDAgMSAzNzQuOTM4NSw4LjUgTDM4MS45Mzg1LDI4LjI5NjkgTDU1MSwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDU1My41LDMwLjc5NjkgTDU1My41LDIxNi4xOSBBMi41LDIuNSAwIDAgMSA1NTEsMjE4LjY5IEwyMjEsMjE4LjY5IEEyLjUsMi41IDAgMCAxIDIxOC41LDIxNi4xOSBMMjE4LjUsOC41IEEyLjUsMi41IDAgMCAxIDIyMSw2IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIyMTguNSIgeDI9IjM4MS45Mzg1IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUwLjQzODUiIHg9IjIyMi41IiB5PSIyMC45OTUxIj5QcmVzZW50YXRpb24gTGF5ZXI8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIEJ1c2luZXNzIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJCdXNpbmVzcyBMYXllciIgZGF0YS1zb3VyY2UtbGluZT0iNyIgZGF0YS11aWQ9ImVudDAwMDYiIGlkPSJjbHVzdGVyX0J1c2luZXNzIExheWVyIj48cGF0aCBkPSJNNDI3LDI0Mi42OSBMNTQ2LjY2NSwyNDIuNjkgQTMuNzUsMy43NSAwIDAgMSA1NDkuMTY1LDI0NS4xOSBMNTU2LjE2NSwyNjQuOTg2OSBMNjAyLDI2NC45ODY5IEEyLjUsMi41IDAgMCAxIDYwNC41LDI2Ny40ODY5IEw2MDQuNSw0NDguMzQgQTIuNSwyLjUgMCAwIDEgNjAyLDQ1MC44NCBMNDI3LDQ1MC44NCBBMi41LDIuNSAwIDAgMSA0MjQuNSw0NDguMzQgTDQyNC41LDI0NS4xOSBBMi41LDIuNSAwIDAgMSA0MjcsMjQyLjY5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI0MjQuNSIgeDI9IjU1Ni4xNjUiIHkxPSIyNjQuOTg2OSIgeTI9IjI2NC45ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExOC42NjUiIHg9IjQyOC41IiB5PSIyNTcuNjg1MSI+QnVzaW5lc3MgTGF5ZXI8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIERhdGEgQWNjZXNzIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJEYXRhIEFjY2VzcyBMYXllciIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGRhdGEtdWlkPSJlbnQwMDA5IiBpZD0iY2x1c3Rlcl9EYXRhIEFjY2VzcyBMYXllciI+PHBhdGggZD0iTTYzMSwzNTMuNTQgTDc3Ni40NDM0LDM1My41NCBBMy43NSwzLjc1IDAgMCAxIDc3OC45NDM0LDM1Ni4wNCBMNzg1Ljk0MzQsMzc1LjgzNjkgTDk4NiwzNzUuODM2OSBBMi41LDIuNSAwIDAgMSA5ODguNSwzNzguMzM2OSBMOTg4LjUsNTU0LjYzIEEyLjUsMi41IDAgMCAxIDk4Niw1NTcuMTMgTDYzMSw1NTcuMTMgQTIuNSwyLjUgMCAwIDEgNjI4LjUsNTU0LjYzIEw2MjguNSwzNTYuMDQgQTIuNSwyLjUgMCAwIDEgNjMxLDM1My41NCIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNjI4LjUiIHgyPSI3ODUuOTQzNCIgeTE9IjM3NS44MzY5IiB5Mj0iMzc1LjgzNjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ0LjQ0MzQiIHg9IjYzMi41IiB5PSIzNjguNTM1MSI+RGF0YSBBY2Nlc3MgTGF5ZXI8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIERhdGFiYXNlLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJEYXRhYmFzZSIgZGF0YS1zb3VyY2UtbGluZT0iMTgiIGRhdGEtdWlkPSJlbnQwMDEzIiBpZD0iY2x1c3Rlcl9EYXRhYmFzZSI+PHBhdGggZD0iTTYxMSw1ODEuMTMgTDY4Ni41MDQ5LDU4MS4xMyBBMy43NSwzLjc1IDAgMCAxIDY4OS4wMDQ5LDU4My42MyBMNjk2LjAwNDksNjAzLjQyNjkgTDgxMCw2MDMuNDI2OSBBMi41LDIuNSAwIDAgMSA4MTIuNSw2MDUuOTI2OSBMODEyLjUsNjc1LjkzIEEyLjUsMi41IDAgMCAxIDgxMCw2NzguNDMgTDYxMSw2NzguNDMgQTIuNSwyLjUgMCAwIDEgNjA4LjUsNjc1LjkzIEw2MDguNSw1ODMuNjMgQTIuNSwyLjUgMCAwIDEgNjExLDU4MS4xMyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNjA4LjUiIHgyPSI2OTYuMDA0OSIgeTE9IjYwMy40MjY5IiB5Mj0iNjAzLjQyNjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzQuNTA0OSIgeD0iNjEyLjUiIHk9IjU5Ni4xMjUxIj5EYXRhYmFzZTwvdGV4dD48L2c+PCEtLWVudGl0eSBjb250cm9sbGVycy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJjb250cm9sbGVycyIgZGF0YS1zb3VyY2UtbGluZT0iMiIgZGF0YS11aWQ9ImVudDAwMDMiIGlkPSJlbnRpdHlfY29udHJvbGxlcnMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTc1Ljg5MTYiIHg9IjI5Ni41NiIgeT0iMTU2LjM5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjQ1Mi40NTE2IiB5PSIxNjEuMzkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjQ1MC40NTE2IiB5PSIxNjMuMzkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjQ1MC40NTE2IiB5PSIxNjcuMzkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzUuODkxNiIgeD0iMzExLjU2IiB5PSIxODkuMzg1MSI+RXhwcmVzcyBDb250cm9sbGVyczwvdGV4dD48L2c+PCEtLWVudGl0eSBtaWRkbGV3YXJlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Im1pZGRsZXdhcmUiIGRhdGEtc291cmNlLWxpbmU9IjMiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iZW50aXR5X21pZGRsZXdhcmUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIwLjY0MzYiIHg9IjIzNC4xOCIgeT0iNDEiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMzM0LjgyMzYiIHk9IjQ2Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIzMzIuODIzNiIgeT0iNDgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjMzMi44MjM2IiB5PSI1MiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgwLjY0MzYiIHg9IjI0OS4xOCIgeT0iNzMuOTk1MSI+TWlkZGxld2FyZTwvdGV4dD48L2c+PCEtLWVudGl0eSByb3V0ZXMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0icm91dGVzIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBkYXRhLXVpZD0iZW50MDAwNSIgaWQ9ImVudGl0eV9yb3V0ZXMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ4LjEzNzciIHg9IjM4OS40NCIgeT0iNDEiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iNTE3LjU3NzciIHk9IjQ2Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI1MTUuNTc3NyIgeT0iNDgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjUxNS41Nzc3IiB5PSI1MiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC4xMzc3IiB4PSI0MDQuNDQiIHk9IjczLjk5NTEiPlJvdXRlIEhhbmRsZXJzPC90ZXh0PjwvZz48IS0tZW50aXR5IHNlcnZpY2VzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9InNlcnZpY2VzIiBkYXRhLXNvdXJjZS1saW5lPSI4IiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImVudGl0eV9zZXJ2aWNlcyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDguOTMwNyIgeD0iNDQwLjA0IiB5PSIyNzcuNjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iNTY4Ljk3MDciIHk9IjI4Mi42OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNTY2Ljk3MDciIHk9IjI4NC42OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNTY2Ljk3MDciIHk9IjI4OC42OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC45MzA3IiB4PSI0NTUuMDQiIHk9IjMxMC42ODUxIj5TZXJ2aWNlIENsYXNzZXM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgYnVzaW5lc3MtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iYnVzaW5lc3MiIGRhdGEtc291cmNlLWxpbmU9IjkiIGRhdGEtdWlkPSJlbnQwMDA4IiBpZD0iZW50aXR5X2J1c2luZXNzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0My4wMjQ0IiB4PSI0NDIuOTkiIHk9IjM4OC41NCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSI1NjYuMDE0NCIgeT0iMzkzLjU0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI1NjQuMDE0NCIgeT0iMzk1LjU0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI1NjQuMDE0NCIgeT0iMzk5LjU0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAzLjAyNDQiIHg9IjQ1Ny45OSIgeT0iNDIxLjUzNTEiPkJ1c2luZXNzIExvZ2ljPC90ZXh0PjwvZz48IS0tZW50aXR5IHByaXNtYS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJwcmlzbWEiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBkYXRhLXVpZD0iZW50MDAxMCIgaWQ9ImVudGl0eV9wcmlzbWEiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMyLjU3OTEiIHg9IjY0NC4yMSIgeT0iNDk0Ljg0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9Ijc1Ni43ODkxIiB5PSI0OTkuODQiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijc1NC43ODkxIiB5PSI1MDEuODQiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijc1NC43ODkxIiB5PSI1MDUuODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Mi41NzkxIiB4PSI2NTkuMjEiIHk9IjUyNy44MzUxIj5QcmlzbWEgQ2xpZW50PC90ZXh0PjwvZz48IS0tZW50aXR5IG1vZGVscy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJtb2RlbHMiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBkYXRhLXVpZD0iZW50MDAxMSIgaWQ9ImVudGl0eV9tb2RlbHMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTYwLjU3OTEiIHg9IjgxMi4yMSIgeT0iNDk0Ljg0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9Ijk1Mi43ODkxIiB5PSI0OTkuODQiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijk1MC43ODkxIiB5PSI1MDEuODQiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijk1MC43ODkxIiB5PSI1MDUuODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjAuNTc5MSIgeD0iODI3LjIxIiB5PSI1MjcuODM1MSI+RGF0YWJhc2UgTW9kZWxzPC90ZXh0PjwvZz48IS0tZW50aXR5IHJlcG9zLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9InJlcG9zIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgZGF0YS11aWQ9ImVudDAwMTIiIGlkPSJlbnRpdHlfcmVwb3MiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTcwLjc2NDYiIHg9IjY0NC4xMiIgeT0iMzg4LjU0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9Ijc5NC44ODQ2IiB5PSIzOTMuNTQiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijc5Mi44ODQ2IiB5PSIzOTUuNTQiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijc5Mi44ODQ2IiB5PSIzOTkuNTQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzAuNzY0NiIgeD0iNjU5LjEyIiB5PSI0MjEuNTM1MSI+UmVwb3NpdG9yeSBQYXR0ZXJuPC90ZXh0PjwvZz48IS0tZW50aXR5IGRiLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImRiIiBkYXRhLXNvdXJjZS1saW5lPSIxOSIgZGF0YS11aWQ9ImVudDAwMTQiIGlkPSJlbnRpdHlfZGIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTcxLjE2OCIgeD0iNjI0LjkyIiB5PSI2MTYuMTMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iNzc2LjA4OCIgeT0iNjIxLjEzIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI3NzQuMDg4IiB5PSI2MjMuMTMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijc3NC4wODgiIHk9IjYyNy4xMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMS4xNjgiIHg9IjYzOS45MiIgeT0iNjQ5LjEyNTEiPlBvc3RncmVTUUwvU1FMaXRlPC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR01OMjMiIGRhdGEtc291cmNlLWxpbmU9IjMzIiBkYXRhLXVpZD0iZW50MDAyNCIgaWQ9ImVudGl0eV9HTU4yMyI+PHBhdGggZD0iTTYsMzYuNDUgTDYsOTEuODQ4NCBBMCwwIDAgMCAwIDYsOTEuODQ4NCBMMTY2LjA1LDkxLjg0ODQgTDMyOC40MiwxNTUuOTkgTDE3NC4wNSw5MS44NDg0IEwxOTkuMDA4OSw5MS44NDg0IEEwLDAgMCAwIDAgMTk5LjAwODksOTEuODQ4NCBMMTk5LjAwODksNDYuNDUgTDE4OS4wMDg5LDM2LjQ1IEw2LDM2LjQ1IEEwLDAgMCAwIDAgNiwzNi40NSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTE4OS4wMDg5LDM2LjQ1IEwxODkuMDA4OSw0Ni40NSBMMTk5LjAwODksNDYuNDUgTDE4OS4wMDg5LDM2LjQ1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzIuMDA4OSIgeD0iMTIiIHk9IjUzLjUxNjkiPkhUVFAgJiMxMjUyMjsmIzEyNDYzOyYjMTI0NTY7JiMxMjQ3MzsmIzEyNDg4Oy8mIzEyNTI0OyYjMTI0NzM7JiMxMjUwOTsmIzEyNTMxOyYjMTI0NzM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjEyIiB5PSI2OC42NDk3Ij4mIzEyNDk2OyYjMTI1MjI7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0NzE7JiMxMjUxOTsmIzEyNTMxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSIxMiIgeT0iODMuNzgyNSI+JiMzNTQ2OTsmIzM1Mzg4OyYjMTI1Mzk7JiMzNTQ2OTsmIzIxNDg3OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdNTjI2IiBkYXRhLXNvdXJjZS1saW5lPSIzOSIgZGF0YS11aWQ9ImVudDAwMjciIGlkPSJlbnRpdHlfR01OMjYiPjxwYXRoIGQ9Ik01NzAsMTUxLjg0IEw1NzAsMjA3LjIzODQgQTAsMCAwIDAgMCA1NzAsMjA3LjIzODQgTDYxMS43OCwyMDcuMjM4NCBMNTM5LjI4LDI3Ny4yOCBMNjE5Ljc4LDIwNy4yMzg0IEw3MjEuMDAwMiwyMDcuMjM4NCBBMCwwIDAgMCAwIDcyMS4wMDAyLDIwNy4yMzg0IEw3MjEuMDAwMiwxNjEuODQgTDcxMS4wMDAyLDE1MS44NCBMNTcwLDE1MS44NCBBMCwwIDAgMCAwIDU3MCwxNTEuODQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03MTEuMDAwMiwxNTEuODQgTDcxMS4wMDAyLDE2MS44NCBMNzIxLjAwMDIsMTYxLjg0IEw3MTEuMDAwMiwxNTEuODQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSI1NzYiIHk9IjE2OC45MDY5Ij4mIzEyNDk5OyYjMTI0NzI7JiMxMjQ5MzsmIzEyNDczOyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC4wMDAyIiB4PSI1NzYiIHk9IjE4NC4wMzk3Ij4mIzEyNDg4OyYjMTI1MjE7JiMxMjUzMTsmIzEyNDcwOyYjMTI0NjM7JiMxMjQ3MTsmIzEyNTE5OyYjMTI1MzE7JiMzMTY0OTsmIzI5NzAyOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuMDAwMSIgeD0iNTc2IiB5PSIxOTkuMTcyNSI+JiMxMjQ1NjsmIzEyNTIxOyYjMTI1NDA7JiMxMjQ5NTsmIzEyNTMxOyYjMTI0ODk7JiMxMjUyMjsmIzEyNTMxOyYjMTI0NjQ7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR01OMjkiIGRhdGEtc291cmNlLWxpbmU9IjQ1IiBkYXRhLXVpZD0iZW50MDAzMCIgaWQ9ImVudGl0eV9HTU4yOSI+PHBhdGggZD0iTTY0Ny41LDI3My4xNCBMNjQ3LjUsMzI4LjUzODQgQTAsMCAwIDAgMCA2NDcuNSwzMjguNTM4NCBMNzI1LjUsMzI4LjUzODQgTDcyOS41LDM4OC4yNCBMNzMzLjUsMzI4LjUzODQgTDgxMS41MDAyLDMyOC41Mzg0IEEwLDAgMCAwIDAgODExLjUwMDIsMzI4LjUzODQgTDgxMS41MDAyLDI4My4xNCBMODAxLjUwMDIsMjczLjE0IEw2NDcuNSwyNzMuMTQgQTAsMCAwIDAgMCA2NDcuNSwyNzMuMTQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik04MDEuNTAwMiwyNzMuMTQgTDgwMS41MDAyLDI4My4xNCBMODExLjUwMDIsMjgzLjE0IEw4MDEuNTAwMiwyNzMuMTQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC4wMDAyIiB4PSI2NTMuNSIgeT0iMjkwLjIwNjkiPiYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMTI0NTA7JiMxMjQ2MzsmIzEyNDc1OyYjMTI0NzM7JiMyNTI3NzsmIzM1OTM3OyYjMjEyNzA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjY1My41IiB5PSIzMDUuMzM5NyI+JiMxMjQ2MzsmIzEyNDU2OyYjMTI1MjI7JiMxMjUyNTsmIzEyNDcyOyYjMTI0ODM7JiMxMjQ2Mzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzLjAwMDIiIHg9IjY1My41IiB5PSIzMjAuNDcyNSI+JiMxMjQ1ODsmIzEyNTAyOyYjMTI0NzI7JiMxMjQ1NTsmIzEyNDYzOyYjMTI0ODg7JiMxMjUxMDsmIzEyNDgzOyYjMTI1MDA7JiMxMjUzMTsmIzEyNDY0OzwvdGV4dD48L2c+PCEtLWxpbmsgY29udHJvbGxlcnMgdG8gc2VydmljZXMtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iY29udHJvbGxlcnMiIGRhdGEtZW50aXR5LTI9InNlcnZpY2VzIiBkYXRhLXNvdXJjZS1saW5lPSIyMiIgZGF0YS11aWQ9ImxuazE1IiBpZD0ibGlua19jb250cm9sbGVyc19zZXJ2aWNlcyI+PHBhdGggZD0iTTQwOC45NiwyMDIuOTggQzQzMi4yLDIyNC4zMSA0NjIuNTM5MywyNTIuMTUzMiA0ODUuNzM5MywyNzMuNDQzMiIgZmlsbD0ibm9uZSIgaWQ9ImNvbnRyb2xsZXJzLXRvLXNlcnZpY2VzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0OTAuMTYsMjc3LjUsNDg2LjIzMzQsMjY4LjQ2NzcsNDg2LjQ3NjEsMjc0LjExOTQsNDgwLjgyNDQsMjc0LjM2Miw0OTAuMTYsMjc3LjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgc2VydmljZXMgdG8gcmVwb3MtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0ic2VydmljZXMiIGRhdGEtZW50aXR5LTI9InJlcG9zIiBkYXRhLXNvdXJjZS1saW5lPSIyMyIgZGF0YS11aWQ9ImxuazE2IiBpZD0ibGlua19zZXJ2aWNlc19yZXBvcyI+PHBhdGggZD0iTTU2MS4zNCwzMjQuMjcgQzU3NS4yNywzMzEuMDIgNTkwLjU0LDMzOC41MSA2MDQuNSwzNDUuNTQgQzYzMi4wNSwzNTkuNCA2NTcuNDQ5NywzNzIuNjA3MSA2ODEuNTM5NywzODUuMjc3MSIgZmlsbD0ibm9uZSIgaWQ9InNlcnZpY2VzLXRvLXJlcG9zIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2ODYuODUsMzg4LjA3LDY4MC43NDY1LDM4MC4zNDA0LDY4Mi40MjQ3LDM4NS43NDI2LDY3Ny4wMjI2LDM4Ny40MjA4LDY4Ni44NSwzODguMDciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgcmVwb3MgdG8gcHJpc21hLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9InJlcG9zIiBkYXRhLWVudGl0eS0yPSJwcmlzbWEiIGRhdGEtc291cmNlLWxpbmU9IjI0IiBkYXRhLXVpZD0ibG5rMTciIGlkPSJsaW5rX3JlcG9zX3ByaXNtYSI+PHBhdGggZD0iTTcyNS4zOCw0MzUuMzIgQzcyMi4xOSw0NTIuODEgNzE4Ljg3MzksNDcxLjAxNjkgNzE1LjY5MzksNDg4LjQ5NjkiIGZpbGw9Im5vbmUiIGlkPSJyZXBvcy10by1wcmlzbWEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjcxNC42Miw0OTQuNCw3MjAuMTY2Myw0ODYuMjYxMyw3MTUuNTE0OSw0ODkuNDgwNyw3MTIuMjk1NSw0ODQuODI5NCw3MTQuNjIsNDk0LjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgcHJpc21hIHRvIGRiLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9InByaXNtYSIgZGF0YS1lbnRpdHktMj0iZGIiIGRhdGEtc291cmNlLWxpbmU9IjI1IiBkYXRhLXVpZD0ibG5rMTgiIGlkPSJsaW5rX3ByaXNtYV9kYiI+PHBhdGggZD0iTTcxMC41LDU0MS40MiBDNzEwLjUsNTYyLjc1IDcxMC41LDU4OC42NSA3MTAuNSw2MDkuOTQiIGZpbGw9Im5vbmUiIGlkPSJwcmlzbWEtdG8tZGIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjcxMC41LDYxNS45NCw3MTQuNSw2MDYuOTQsNzEwLjUsNjEwLjk0LDcwNi41LDYwNi45NCw3MTAuNSw2MTUuOTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgbWlkZGxld2FyZSB0byBjb250cm9sbGVycy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJtaWRkbGV3YXJlIiBkYXRhLWVudGl0eS0yPSJjb250cm9sbGVycyIgZGF0YS1zb3VyY2UtbGluZT0iMjciIGRhdGEtdWlkPSJsbmsxOSIgaWQ9ImxpbmtfbWlkZGxld2FyZV9jb250cm9sbGVycyI+PHBhdGggZD0iTTMxMi4yOSw4Ny41NSBDMzI4LjA2LDEwNy40MyAzNDcuMjYsMTMxLjYyMDMgMzYzLjAzLDE1MS40OTAzIiBmaWxsPSJub25lIiBpZD0ibWlkZGxld2FyZS10by1jb250cm9sbGVycyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzY2Ljc2LDE1Ni4xOSwzNjQuMjk4MiwxNDYuNjUzOCwzNjMuNjUxNywxNTIuMjczNiwzNTguMDMxOSwxNTEuNjI3MSwzNjYuNzYsMTU2LjE5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIHJvdXRlcyB0byBjb250cm9sbGVycy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJyb3V0ZXMiIGRhdGEtZW50aXR5LTI9ImNvbnRyb2xsZXJzIiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgZGF0YS11aWQ9ImxuazIwIiBpZD0ibGlua19yb3V0ZXNfY29udHJvbGxlcnMiPjxwYXRoIGQ9Ik00NDcuOSw4Ny41NSBDNDM0LjA1LDEwNy40MyA0MTcuMzQ5MywxMzEuMzk2NiA0MDMuNTA5MywxNTEuMjY2NiIgZmlsbD0ibm9uZSIgaWQ9InJvdXRlcy10by1jb250cm9sbGVycyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDAwLjA4LDE1Ni4xOSw0MDguNTA2MiwxNTEuMDkxMSw0MDIuOTM3NywxNTIuMDg3Miw0MDEuOTQxNywxNDYuNTE4Nyw0MDAuMDgsMTU2LjE5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIHNlcnZpY2VzIHRvIGJ1c2luZXNzLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9InNlcnZpY2VzIiBkYXRhLWVudGl0eS0yPSJidXNpbmVzcyIgZGF0YS1zb3VyY2UtbGluZT0iMjkiIGRhdGEtdWlkPSJsbmsyMSIgaWQ9Imxpbmtfc2VydmljZXNfYnVzaW5lc3MiPjxwYXRoIGQ9Ik01MTQuNSwzMjQuMzkgQzUxNC41LDM0My4wNyA1MTQuNSwzNjMuNDkgNTE0LjUsMzgyLjE2IiBmaWxsPSJub25lIiBpZD0ic2VydmljZXMtdG8tYnVzaW5lc3MiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUxNC41LDM4OC4xNiw1MTguNSwzNzkuMTYsNTE0LjUsMzgzLjE2LDUxMC41LDM3OS4xNiw1MTQuNSwzODguMTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgcmVwb3MgdG8gbW9kZWxzLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9InJlcG9zIiBkYXRhLWVudGl0eS0yPSJtb2RlbHMiIGRhdGEtc291cmNlLWxpbmU9IjMwIiBkYXRhLXVpZD0ibG5rMjIiIGlkPSJsaW5rX3JlcG9zX21vZGVscyI+PHBhdGggZD0iTTc2NC44Nyw0MzUuMzIgQzc5Mi4yMSw0NTIuODEgODI0LjgyNiw0NzMuNjg2MyA4NTIuMTQ2LDQ5MS4xNjYzIiBmaWxsPSJub25lIiBpZD0icmVwb3MtdG8tbW9kZWxzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4NTcuMiw0OTQuNCw4NTEuNzc0Nyw0ODYuMTgwMSw4NTIuOTg4Myw0OTEuNzA1Myw4NDcuNDYzMiw0OTIuOTE4OCw4NTcuMiw0OTQuNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tU1JDPVtUUDdESlhIMTRDVmxfSEdUeGVHdEMxNHF1RzM5MmptczdkZmRvYXQ3c1ViOVR3Q0l1c0t3S0pHSUkzSlNEQzRCSTFHbTlXZTF1eURLYTdxQ2d3amRUdE9hN2NRY3dieVZsd2dRSWNNRnJIM2FOQy0yV3o4aGhxcWZMekdNczNkdk5GSmxGd2lldUVJSUFScXJIRzdNRlBKQW9RcHJITnpMdnRhMUp2SzVaZXNjaGtZbGNLcUZTYmNMLVJKS0hpYzk1cTlLNF9aWWZqRGJuQkpXVFIxRlQwUG9nTDNFR1FmcUlJRFlNczI2RWtGV2U5NHdaVXlmaC1KVEJFbHN4YmRqSGVmUVF6Z09Zb2pNSDNfYzN2RzNrTWZvQTE5cm4yUWowZkxuc1hreDlObEFVeDFiTVlWQWp3Mm5JTThQdnVTTXJYLWlCRDJaVkpmSEZlV0xDcVVLeV9EdHNscWMxZ2k5bTZfc2NyZEpYbk5nOWpnWmlwSnhWekIxUnlhVG9GSHdCUVZQTXZJNl9nMHRiSklGRWxOQjZuaXpZVTRPd3JFaVp4Mi1tQjJ6V0U0Qk1ueW1WMlQzT0RZQkFVNExYWWtpVnM4dWY4ME83LSAtQ1p3dW1OOTlubE5pZ2VDbmJuN0hYcXREV1U4VnJFT09UUmxzTHhLMU8yY25aLUNvZTdwbjYweFd2RVJaUFVvZFlNMzVDZkRzTzU1eHBCOUh6elh6YWtsTGF0RHpPVi1Bc2JtSi15LVJOLURsMXpUanpxSW1TTXl0RUtmRV83X3R3QzZSNHFKeDZNN1pfM184bF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="22-typescript">2.2 TypeScriptレイヤードアーキテクチャの実装例<a class="headerlink" href="#22-typescript" title="Permanent link">&para;</a></h3>
<h4 id="221-express-controllers">2.2.1 プレゼンテーション層（Express Controllers）<a class="headerlink" href="#221-express-controllers" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/presentation/controller/ReservationController.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">Response</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../business/service/ReservationService&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">CreateReservationRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">ReservationResponse</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../dto/ReservationDto&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../middleware/validation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">asyncHandler</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../middleware/asyncHandler&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationController</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="nx">reservationService</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationService</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="c1">// 予約作成</span>
<span class="w">  </span><span class="nx">createReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">asyncHandler</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="o">:</span><span class="w"> </span><span class="kt">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="o">:</span><span class="w"> </span><span class="kt">Response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// リクエストバリデーション</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">validatedData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">CreateReservationRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// サービス層呼び出し</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">createReservation</span><span class="p">({</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">validatedData.roomId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">validatedData</span><span class="p">.</span><span class="nx">date</span><span class="p">),</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">validatedData.startTime</span><span class="p">,</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">validatedData.endTime</span><span class="p">,</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">req.user.id</span><span class="w"> </span><span class="c1">// 認証ミドルウェアから取得</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">      </span><span class="c1">// レスポンス生成</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.id</span><span class="o">!</span><span class="p">,</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.roomId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.date.toISOString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">],</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.startTime</span><span class="p">,</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.endTime</span><span class="p">,</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.userId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;confirmed&#39;</span>
<span class="w">      </span><span class="p">};</span>

<span class="w">      </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">201</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">reservation</span><span class="o">:</span><span class="w"> </span><span class="kt">response</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">409</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">          </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">          </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">error.message</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">          </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">          </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">error.message</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span><span class="w"> </span><span class="c1">// その他のエラーはグローバルエラーハンドラーで処理</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="c1">// 予約一覧取得</span>
<span class="w">  </span><span class="nx">getReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">asyncHandler</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="o">:</span><span class="w"> </span><span class="kt">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="o">:</span><span class="w"> </span><span class="kt">Response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">roomId</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">getReservations</span><span class="p">({</span>
<span class="w">      </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">Number</span><span class="p">(</span><span class="nx">roomId</span><span class="p">),</span>
<span class="w">      </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
<span class="w">      </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">reservations</span><span class="o">:</span><span class="w"> </span><span class="kt">reservations.map</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">          </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">r.id</span><span class="o">!</span><span class="p">,</span>
<span class="w">          </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">r.roomId</span><span class="p">,</span>
<span class="w">          </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">r.date.toISOString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">],</span>
<span class="w">          </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">r.startTime</span><span class="p">,</span>
<span class="w">          </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">r.endTime</span><span class="p">,</span>
<span class="w">          </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">r.userId</span>
<span class="w">        </span><span class="p">}))</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="222-service-classes">2.2.2 ビジネス層（Service Classes）<a class="headerlink" href="#222-service-classes" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/business/service/ReservationService.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../data/repository/ReservationRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">MeetingRoomRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../data/repository/MeetingRoomRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../exception/AlreadyReservedException&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../exception/UnavailableReservationException&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">CreateReservationData</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ReservationData</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">reservationRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationRepository</span><span class="p">,</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">meetingRoomRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">MeetingRoomRepository</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">createReservation</span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">CreateReservationData</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">ReservationData</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. 部屋の存在確認</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">meetingRoomRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">roomId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">room</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="p">(</span><span class="s1">&#39;指定された会議室が見つかりません&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 2. 予約可能日の確認</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">isAvailable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">meetingRoomRepository</span><span class="p">.</span><span class="nx">isAvailableOn</span><span class="p">(</span>
<span class="w">      </span><span class="nx">data</span><span class="p">.</span><span class="nx">roomId</span><span class="p">,</span><span class="w"> </span>
<span class="w">      </span><span class="nx">data</span><span class="p">.</span><span class="nx">date</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">isAvailable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="p">(</span>
<span class="w">        </span><span class="s1">&#39;指定の日付・部屋の組み合わせは予約できません&#39;</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 3. 時間重複チェック</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">existingReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">(</span>
<span class="w">      </span><span class="nx">data</span><span class="p">.</span><span class="nx">roomId</span><span class="p">,</span>
<span class="w">      </span><span class="nx">data</span><span class="p">.</span><span class="nx">date</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hasOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">existingReservations</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">existing</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">isTimeOverlap</span><span class="p">(</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">data.startTime</span><span class="p">,</span><span class="w"> </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">data.endTime</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">existing.startTime</span><span class="p">,</span><span class="w"> </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">existing.endTime</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hasOverlap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="p">(</span><span class="s1">&#39;指定の時間帯はすでに予約済みです&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 4. 予約作成</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">data.roomId</span><span class="p">,</span>
<span class="w">      </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">data.date</span><span class="p">,</span>
<span class="w">      </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">data.startTime</span><span class="p">,</span>
<span class="w">      </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">data.endTime</span><span class="p">,</span>
<span class="w">      </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">data.userId</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">getReservations</span><span class="p">(</span><span class="nx">criteria</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">    </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="p">})</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">ReservationData</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">(</span>
<span class="w">      </span><span class="nx">criteria</span><span class="p">.</span><span class="nx">roomId</span><span class="p">,</span>
<span class="w">      </span><span class="nx">criteria</span><span class="p">.</span><span class="nx">date</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// ビジネスロジック: 時間重複判定</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">isTimeOverlap</span><span class="p">(</span>
<span class="w">    </span><span class="nx">slot1</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">slot2</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">start1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">timeToMinutes</span><span class="p">(</span><span class="nx">slot1</span><span class="p">.</span><span class="nx">startTime</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">end1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">timeToMinutes</span><span class="p">(</span><span class="nx">slot1</span><span class="p">.</span><span class="nx">endTime</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">start2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">timeToMinutes</span><span class="p">(</span><span class="nx">slot2</span><span class="p">.</span><span class="nx">startTime</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">end2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">timeToMinutes</span><span class="p">(</span><span class="nx">slot2</span><span class="p">.</span><span class="nx">endTime</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">end1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">start2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">end2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">start1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">timeToMinutes</span><span class="p">(</span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">hours</span><span class="p">,</span><span class="w"> </span><span class="nx">minutes</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nb">Number</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">hours</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">minutes</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="223-repository-pattern">2.2.3 データアクセス層（Repository Pattern）<a class="headerlink" href="#223-repository-pattern" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/data/repository/ReservationRepository.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../business/service/ReservationService&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="nx">prisma</span><span class="o">:</span><span class="w"> </span><span class="kt">PrismaClient</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">create</span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">    </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">    </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="p">})</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">ReservationData</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Prismaを使ったデータ操作</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">created</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">data.roomId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">data.date</span><span class="p">,</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="sb">`1970-01-01T</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">startTime</span><span class="si">}</span><span class="sb">:00`</span><span class="p">),</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="sb">`1970-01-01T</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">endTime</span><span class="si">}</span><span class="sb">:00`</span><span class="p">),</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">data.userId</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// ドメインオブジェクトに変換</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">created.id</span><span class="p">,</span>
<span class="w">      </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">created.roomId</span><span class="p">,</span>
<span class="w">      </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">created.reservedDate</span><span class="p">,</span>
<span class="w">      </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">created.startTime.toTimeString</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">),</span>
<span class="w">      </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">created.endTime.toTimeString</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">),</span>
<span class="w">      </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">created.userId</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">findByRoomAndDate</span><span class="p">(</span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">ReservationData</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
<span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">date</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">orderBy</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;asc&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">reservations</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">r.id</span><span class="p">,</span>
<span class="w">      </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">r.roomId</span><span class="p">,</span>
<span class="w">      </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">r.reservedDate</span><span class="p">,</span>
<span class="w">      </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">r.startTime.toTimeString</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">),</span>
<span class="w">      </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">r.endTime.toTimeString</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">),</span>
<span class="w">      </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">r.userId</span>
<span class="w">    </span><span class="p">}));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="ow">delete</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="ow">delete</span><span class="p">({</span>
<span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="224-prisma">2.2.4 データベーススキーマ（Prisma）<a class="headerlink" href="#224-prisma" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>// prisma/schema.prisma
generator client {
  provider = &quot;prisma-client-js&quot;
}

datasource db {
  provider = &quot;sqlite&quot;
  url      = &quot;file:./dev.db&quot;
}

model User {
  id           String  @id
  firstName    String
  lastName     String
  password     String
  roleName     String
  reservations Reservation[]

  @@map(&quot;users&quot;)
}

model MeetingRoom {
  id               Int               @id @default(autoincrement())
  name             String
  reservableRooms  ReservableRoom[]

  @@map(&quot;meeting_rooms&quot;)
}

model ReservableRoom {
  roomId       Int
  reservedDate DateTime
  meetingRoom  MeetingRoom   @relation(fields: [roomId], references: [id])
  reservations Reservation[]

  @@id([roomId, reservedDate])
  @@map(&quot;reservable_rooms&quot;)
}

model Reservation {
  id           Int      @id @default(autoincrement())
  startTime    DateTime
  endTime      DateTime
  roomId       Int
  reservedDate DateTime
  userId       String
  user         User     @relation(fields: [userId], references: [id])
  reservableRoom ReservableRoom @relation(fields: [roomId, reservedDate], references: [roomId, reservedDate])

  @@map(&quot;reservations&quot;)
}
</code></pre></div>
<h3 id="23">2.3 レイヤードアーキテクチャの問題点<a class="headerlink" href="#23" title="Permanent link">&para;</a></h3>
<h4 id="231">2.3.1 層間の密結合<a class="headerlink" href="#231" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 問題: サービス層がPrismaクライアントに直接依存</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">createReservation</span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">CreateReservationData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 直接PrismaのAPIを使用 → データベース技術に依存</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">existing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
<span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">data.roomId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">data.date</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Prismaの戻り値型に依存したロジック</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hasOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">existing</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">isOverlap</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">startTime</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">endTime</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">startTime</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">endTime</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="232">2.3.2 ビジネスロジックの散在<a class="headerlink" href="#232" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 問題: コントローラにビジネスロジックが漏出</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationController</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">createReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">asyncHandler</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="o">:</span><span class="w"> </span><span class="kt">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="o">:</span><span class="w"> </span><span class="kt">Response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// バリデーション処理がコントローラに</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">startTime</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">endTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;時間は必須です&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 時刻形式チェックがコントローラに</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeRegex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/^\d{2}:\d{2}$/</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">timeRegex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">startTime</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;時刻形式が正しくありません&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ビジネスルールがコントローラに</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">startHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">startTime</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">startHour</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">9</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">startHour</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">17</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;営業時間外です&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// エラーハンドリングがコントローラに</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">createReservation</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;P2002&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Prismaのエラーコード</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">409</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;重複した予約です&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="233">2.3.3 テストの困難さ<a class="headerlink" href="#233" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 問題: データベース依存で遅い統合テストしか書けない</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ReservationService&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">prisma</span><span class="o">:</span><span class="w"> </span><span class="kt">PrismaClient</span><span class="p">;</span>

<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 実際のデータベースが必要</span>
<span class="w">    </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$connect</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// テストデータの準備が複雑</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">firstName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">lastName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hash&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">roleName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;USER&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Conference Room A&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">afterEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// クリーンアップも時間がかかる</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$disconnect</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;予約ができること&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// このテスト1つで数百ミリ秒かかる</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationService</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="p">(</span><span class="nx">prisma</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MeetingRoomRepository</span><span class="p">(</span><span class="nx">prisma</span><span class="p">));</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">createReservation</span><span class="p">({</span>
<span class="w">      </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">      </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;09:00&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10:00&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="24">2.4 パフォーマンステスト結果<a class="headerlink" href="#24" title="Permanent link">&para;</a></h3>
<p><strong>レイヤードアーキテクチャのテスト実行時間</strong>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--<span class="w"> </span>--testPathPattern<span class="o">=</span>layered
Test<span class="w"> </span>Suites:<span class="w"> </span><span class="m">3</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">3</span><span class="w"> </span>total
Tests:<span class="w">       </span><span class="m">15</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">15</span><span class="w"> </span>total
Time:<span class="w">        </span><span class="m">8</span>.347<span class="w"> </span>s

<span class="c1"># 1テストあたり: 0.556秒</span>
<span class="c1"># データベースアクセスが必要なため遅い</span>
</code></pre></div></p>
<h3 id="25">2.5 まとめ<a class="headerlink" href="#25" title="Permanent link">&para;</a></h3>
<p>レイヤードアーキテクチャは理解しやすく実装も容易ですが、以下の課題があります：</p>
<ol>
<li><strong>技術依存</strong>: ビジネスロジックがデータベース技術に依存</li>
<li><strong>関心の分離不足</strong>: ビジネスルールが複数の層に散在</li>
<li><strong>テスタビリティ</strong>: 高速な単体テストが困難</li>
<li><strong>変更耐性</strong>: インフラ変更時に多くの層に影響</li>
</ol>
<p>これらの課題を解決するために、次章ではヘキサゴナルアーキテクチャへの移行について説明します。</p>
<hr />
<h2 id="3">第3章: ヘキサゴナルアーキテクチャ<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 ヘキサゴナルアーキテクチャとは<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<p>ヘキサゴナルアーキテクチャ（Ports and Adaptersパターン）は、Alistair Cockburnによって提唱された設計手法で、アプリケーションの中核となるビジネスロジック（ドメイン層）を外部の技術的詳細から完全に分離することを目的とします。</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjY2OHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzMwcHg7aGVpZ2h0OjY2OHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDczMCA2NjgiIHdpZHRoPSI3MzBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIEhleGFnb25hbCBBcmNoaXRlY3R1cmUgKFR5cGVTY3JpcHQpLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5UeXBlU2NyaXB0LiIgZGF0YS1zb3VyY2UtbGluZT0iMyIgZGF0YS11aWQ9ImVudDAwMDIiIGlkPSJjbHVzdGVyX0hleGFnb25hbCBBcmNoaXRlY3R1cmUgLlR5cGVTY3JpcHQuIj48cGF0aCBkPSJNMjE0LjUsNiBMNTA0LjkyNjgsNiBBMy43NSwzLjc1IDAgMCAxIDUwNy40MjY4LDguNSBMNTE0LjQyNjgsMjguMjk2OSBMNTE0LjUsMjguMjk2OSBBMi41LDIuNSAwIDAgMSA1MTcsMzAuNzk2OSBMNTE3LDY1OC43MyBBMi41LDIuNSAwIDAgMSA1MTQuNSw2NjEuMjMgTDIxNC41LDY2MS4yMyBBMi41LDIuNSAwIDAgMSAyMTIsNjU4LjczIEwyMTIsOC41IEEyLjUsMi41IDAgMCAxIDIxNC41LDYiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjIxMiIgeDI9IjUxNC40MjY4IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjg5LjQyNjgiIHg9IjIxNiIgeT0iMjAuOTk1MSI+SGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAoVHlwZVNjcmlwdCk8L3RleHQ+PC9nPjwhLS1jbGFzcyBjb3JlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImNvcmUiIGRhdGEtc291cmNlLWxpbmU9IjUiIGRhdGEtdWlkPSJlbnQwMDAzIiBpZD0iZW50aXR5X2NvcmUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTIzLjc4MTMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIxNi42NTQzIiB4PSIyODQuNjciIHk9IjI3My4wNyIvPjxlbGxpcHNlIGN4PSIzMTEuNjQ2NCIgY3k9IjI5NC4zNjY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zMTQuNjE1MiwzMDAuMDA3NSBRMzE0LjAzNywzMDAuMzA0NCAzMTMuMzk2NCwzMDAuNDQ1IFEzMTIuNzU1OCwzMDAuNjAxMyAzMTIuMDUyNywzMDAuNjAxMyBRMzA5LjU1MjcsMzAwLjYwMTMgMzA4LjIyNDUsMjk4Ljk2MDYgUTMwNi45MTIsMjk3LjMwNDQgMzA2LjkxMiwyOTQuMTc5NCBRMzA2LjkxMiwyOTEuMDU0NCAzMDguMjI0NSwyODkuMzk4MSBRMzA5LjU1MjcsMjg3Ljc0MTkgMzEyLjA1MjcsMjg3Ljc0MTkgUTMxMi43NTU4LDI4Ny43NDE5IDMxMy4zOTY0LDI4Ny44OTgxIFEzMTQuMDUyNywyODguMDU0NCAzMTQuNjE1MiwyODguMzUxMyBMMzE0LjYxNTIsMjkxLjA3IFEzMTMuOTkwMiwyOTAuNDkxOSAzMTMuMzk2NCwyOTAuMjI2MyBRMzEyLjgwMjcsMjg5Ljk0NSAzMTIuMTc3NywyODkuOTQ1IFEzMTAuODMzOSwyODkuOTQ1IDMxMC4xNDY0LDI5MS4wMjMxIFEzMDkuNDU4OSwyOTIuMDg1NiAzMDkuNDU4OSwyOTQuMTc5NCBRMzA5LjQ1ODksMjk2LjI3MzEgMzEwLjE0NjQsMjk3LjM1MTMgUTMxMC44MzM5LDI5OC40MTM4IDMxMi4xNzc3LDI5OC40MTM4IFEzMTIuODAyNywyOTguNDEzOCAzMTMuMzk2NCwyOTguMTQ4MSBRMzEzLjk5MDIsMjk3Ljg2NjkgMzE0LjYxNTIsMjk3LjI4ODggTDMxNC42MTUyLDMwMC4wMDc1IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE1LjM4MzgiIHg9IjM0OS42MzYiIHk9IjI5MS4wNjUxIj5BcHBsaWNhdGlvbiBDb3JlPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OC4wNCIgeD0iMzI4LjMwNzgiIHk9IjMwNy4zNjIiPihEb21haW4gKyBVc2UgQ2FzZXMpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI4NS42NyIgeDI9IjUwMC4zMjQzIiB5MT0iMzE1LjY2MzgiIHkyPSIzMTUuNjYzOCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI5Mi42NyIgeT0iMzI2LjMxMjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuODEwNSIgeD0iMzA0LjY3IiB5PSIzMzIuNjU4OSI+RG9tYWluIFNlcnZpY2VzPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI4NS42NyIgeDI9IjUwMC4zMjQzIiB5MT0iMzM5Ljk2MDYiIHkyPSIzMzkuOTYwNiIvPjxyZWN0IGZpbGw9IiNGMjRENUMiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI5Mi42NyIgeT0iMzUwLjYwOTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzQuMTM4NyIgeD0iMzA0LjY3IiB5PSIzNTYuOTU1NyI+RG9tYWluIE1vZGVscyAoY2xhc3Nlcyk8L3RleHQ+PHJlY3QgZmlsbD0iI0YyNEQ1QyIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMjkyLjY3IiB5PSIzNjYuOTA1OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4MS4zMTY0IiB4PSIzMDQuNjciIHk9IjM3My4yNTI2Ij5CdXNpbmVzcyBSdWxlcyAobWV0aG9kcyk8L3RleHQ+PHJlY3QgZmlsbD0iI0YyNEQ1QyIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMjkyLjY3IiB5PSIzODMuMjAyOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5MC42NTQzIiB4PSIzMDQuNjciIHk9IjM4OS41NDk1Ij5Vc2UgQ2FzZSBJbnRlcmZhY2VzIChwb3J0cyk8L3RleHQ+PC9nPjwhLS1jbGFzcyBpbnB1dC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJpbnB1dCIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iZW50aXR5X2lucHV0Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjE0MC4wNzgxIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzEuNTcxMyIgeD0iMjkxLjIxIiB5PSI0MSIvPjxlbGxpcHNlIGN4PSIzMjIuMzE0NiIgY3k9IjYyLjI5NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTMyNS4yODM0LDY3LjkzNzUgUTMyNC43MDUzLDY4LjIzNDQgMzI0LjA2NDYsNjguMzc1IFEzMjMuNDI0LDY4LjUzMTMgMzIyLjcyMDksNjguNTMxMyBRMzIwLjIyMDksNjguNTMxMyAzMTguODkyOCw2Ni44OTA2IFEzMTcuNTgwMyw2NS4yMzQ0IDMxNy41ODAzLDYyLjEwOTQgUTMxNy41ODAzLDU4Ljk4NDQgMzE4Ljg5MjgsNTcuMzI4MSBRMzIwLjIyMDksNTUuNjcxOSAzMjIuNzIwOSw1NS42NzE5IFEzMjMuNDI0LDU1LjY3MTkgMzI0LjA2NDYsNTUuODI4MSBRMzI0LjcyMDksNTUuOTg0NCAzMjUuMjgzNCw1Ni4yODEzIEwzMjUuMjgzNCw1OSBRMzI0LjY1ODQsNTguNDIxOSAzMjQuMDY0Niw1OC4xNTYzIFEzMjMuNDcwOSw1Ny44NzUgMzIyLjg0NTksNTcuODc1IFEzMjEuNTAyMSw1Ny44NzUgMzIwLjgxNDYsNTguOTUzMSBRMzIwLjEyNzEsNjAuMDE1NiAzMjAuMTI3MSw2Mi4xMDk0IFEzMjAuMTI3MSw2NC4yMDMxIDMyMC44MTQ2LDY1LjI4MTMgUTMyMS41MDIxLDY2LjM0MzggMzIyLjg0NTksNjYuMzQzOCBRMzIzLjQ3MDksNjYuMzQzOCAzMjQuMDY0Niw2Ni4wNzgxIFEzMjQuNjU4NCw2NS43OTY5IDMyNS4yODM0LDY1LjIxODggTDMyNS4yODM0LDY3LjkzNzUgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDMuNzgzMiIgeD0iMzM5Ljg5MzQiIHk9IjU4Ljk5NTEiPklucHV0IEFkYXB0ZXJzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2LjAxMDciIHg9IjM0My43Nzk3IiB5PSI3NS4yOTIiPihEcml2aW5nIFNpZGUpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI5Mi4yMSIgeDI9IjQ2MS43ODEzIiB5MT0iODMuNTkzOCIgeTI9IjgzLjU5MzgiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOTkuMjEiIHk9Ijk0LjI0MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzUuODkxNiIgeD0iMzExLjIxIiB5PSIxMDAuNTg4OSI+RXhwcmVzcyBDb250cm9sbGVyczwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOTkuMjEiIHk9IjExMC41MzkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM0LjI1MSIgeD0iMzExLjIxIiB5PSIxMTYuODg1NyI+R3JhcGhRTCBSZXNvbHZlcnM8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMjk5LjIxIiB5PSIxMjYuODM1OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNS40MDMzIiB4PSIzMTEuMjEiIHk9IjEzMy4xODI2Ij5DTEkgQ29tbWFuZHM8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMjk5LjIxIiB5PSIxNDMuMTMyOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNi45NzU2IiB4PSIzMTEuMjEiIHk9IjE0OS40Nzk1Ij5FdmVudCBIYW5kbGVyczwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOTkuMjEiIHk9IjE1OS40Mjk3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ1LjU3MTMiIHg9IjMxMS4yMSIgeT0iMTY1Ljc3NjQiPldlYlNvY2tldCBIYW5kbGVyczwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyOTIuMjEiIHgyPSI0NjEuNzgxMyIgeTE9IjE3My4wNzgxIiB5Mj0iMTczLjA3ODEiLz48L2c+PCEtLWNsYXNzIG91dHB1dC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJvdXRwdXQiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBkYXRhLXVpZD0iZW50MDAwNSIgaWQ9ImVudGl0eV9vdXRwdXQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTU2LjM3NSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUzLjEyMTEiIHg9IjMzNy40NCIgeT0iNDg4Ljg1Ii8+PGVsbGlwc2UgY3g9IjM1NC42NzExIiBjeT0iNTEwLjE0NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTM1Ny42Mzk5LDUxNS43ODc1IFEzNTcuMDYxNyw1MTYuMDg0NCAzNTYuNDIxMSw1MTYuMjI1IFEzNTUuNzgwNSw1MTYuMzgxMyAzNTUuMDc3NCw1MTYuMzgxMyBRMzUyLjU3NzQsNTE2LjM4MTMgMzUxLjI0OTIsNTE0Ljc0MDYgUTM0OS45MzY3LDUxMy4wODQ0IDM0OS45MzY3LDUwOS45NTk0IFEzNDkuOTM2Nyw1MDYuODM0NCAzNTEuMjQ5Miw1MDUuMTc4MSBRMzUyLjU3NzQsNTAzLjUyMTkgMzU1LjA3NzQsNTAzLjUyMTkgUTM1NS43ODA1LDUwMy41MjE5IDM1Ni40MjExLDUwMy42NzgxIFEzNTcuMDc3NCw1MDMuODM0NCAzNTcuNjM5OSw1MDQuMTMxMyBMMzU3LjYzOTksNTA2Ljg1IFEzNTcuMDE0OSw1MDYuMjcxOSAzNTYuNDIxMSw1MDYuMDA2MyBRMzU1LjgyNzQsNTA1LjcyNSAzNTUuMjAyNCw1MDUuNzI1IFEzNTMuODU4Niw1MDUuNzI1IDM1My4xNzExLDUwNi44MDMxIFEzNTIuNDgzNiw1MDcuODY1NiAzNTIuNDgzNiw1MDkuOTU5NCBRMzUyLjQ4MzYsNTEyLjA1MzEgMzUzLjE3MTEsNTEzLjEzMTMgUTM1My44NTg2LDUxNC4xOTM4IDM1NS4yMDI0LDUxNC4xOTM4IFEzNTUuODI3NCw1MTQuMTkzOCAzNTYuNDIxMSw1MTMuOTI4MSBRMzU3LjAxNDksNTEzLjY0NjkgMzU3LjYzOTksNTEzLjA2ODggTDM1Ny42Mzk5LDUxNS43ODc1IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE2LjE2MzEiIHg9IjM2OS4xNjY5IiB5PSI1MDYuODQ1MSI+T3V0cHV0IEFkYXB0ZXJzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjg0NzciIHg9IjM4MS4zMjQ2IiB5PSI1MjMuMTQyIj4oRHJpdmVuIFNpZGUpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMzOC40NCIgeDI9IjQ4OS41NjExIiB5MT0iNTMxLjQ0MzgiIHkyPSI1MzEuNDQzOCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjM0NS40NCIgeT0iNTQyLjA5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjcuMTIxMSIgeD0iMzU3LjQ0IiB5PSI1NDguNDM4OSI+UHJpc21hIFJlcG9zaXRvcnk8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMzQ1LjQ0IiB5PSI1NTguMzg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg2LjM5OTQiIHg9IjM1Ny40NCIgeT0iNTY0LjczNTciPlJlZGlzIENhY2hlPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjM0NS40NCIgeT0iNTc0LjY4NTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Mi4yMjM2IiB4PSIzNTcuNDQiIHk9IjU4MS4wMzI2Ij5FeHRlcm5hbCBBUElzPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjM0NS40NCIgeT0iNTkwLjk4MjgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS4xMDE2IiB4PSIzNTcuNDQiIHk9IjU5Ny4zMjk1Ij5GaWxlIFN5c3RlbTwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIzNDUuNDQiIHk9IjYwNy4yNzk3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE5LjA5NTciIHg9IjM1Ny40NCIgeT0iNjEzLjYyNjQiPk1lc3NhZ2UgUXVldWVzPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjM0NS40NCIgeT0iNjIzLjU3NjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDIuMzI3MSIgeD0iMzU3LjQ0IiB5PSI2MjkuOTIzMiI+RW1haWwgU2VydmljZXM8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzM4LjQ0IiB4Mj0iNDg5LjU2MTEiIHkxPSI2MzcuMjI1IiB5Mj0iNjM3LjIyNSIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR01OOCIgZGF0YS1zb3VyY2UtbGluZT0iMzQiIGRhdGEtdWlkPSJlbnQwMDA5IiBpZD0iZW50aXR5X0dNTjgiPjxwYXRoIGQ9Ik01MzMsODMuMzQgTDUzMywxMzguNzM4NCBBMCwwIDAgMCAwIDUzMywxMzguNzM4NCBMNTg0LjIyLDEzOC43Mzg0IEw0NTQuMjUsMjcyLjczIEw1OTIuMjIsMTM4LjczODQgTDY5Ny4wMDAyLDEzOC43Mzg0IEEwLDAgMCAwIDAgNjk3LjAwMDIsMTM4LjczODQgTDY5Ny4wMDAyLDkzLjM0IEw2ODcuMDAwMiw4My4zNCBMNTMzLDgzLjM0IEEwLDAgMCAwIDAgNTMzLDgzLjM0IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNjg3LjAwMDIsODMuMzQgTDY4Ny4wMDAyLDkzLjM0IEw2OTcuMDAwMiw5My4zNCBMNjg3LjAwMDIsODMuMzQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0My4wMDAyIiB4PSI1MzkiIHk9IjEwMC40MDY5Ij4mIzMyMDIwOyYjMzE4ODM7JiMxMjM5NDsmIzEyNDk5OyYjMTI0NzI7JiMxMjQ5MzsmIzEyNDczOyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSI1MzkiIHk9IjExNS41Mzk3Ij4mIzIyODA2OyYjMzcwOTY7JiMyNTIxNjsmIzM0ODk5OyYjMTIzOTU7JiMzODc1MDsmIzIwMzgxOyYjMjMzODQ7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSI1MzkiIHk9IjEzMC42NzI1Ij4mIzM5NjQwOyYjMzY4OTU7JiMxMjM5MTsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsmIzIxNDg3OyYjMzMwMjE7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iR01OMTEiIGRhdGEtc291cmNlLWxpbmU9IjQwIiBkYXRhLXVpZD0iZW50MDAxMiIgaWQ9ImVudGl0eV9HTU4xMSI+PHBhdGggZD0iTTYsODMuMzQgTDYsMTM4LjczODQgQTAsMCAwIDAgMCA2LDEzOC43Mzg0IEwxOTYuMDAwMiwxMzguNzM4NCBBMCwwIDAgMCAwIDE5Ni4wMDAyLDEzOC43Mzg0IEwxOTYuMDAwMiwxMTUuMDMgTDI5MC45NCwxMTEuMDMgTDE5Ni4wMDAyLDEwNy4wMyBMMTk2LjAwMDIsOTMuMzQgTDE4Ni4wMDAyLDgzLjM0IEw2LDgzLjM0IEEwLDAgMCAwIDAgNiw4My4zNCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTE4Ni4wMDAyLDgzLjM0IEwxODYuMDAwMiw5My4zNCBMMTk2LjAwMDIsOTMuMzQgTDE4Ni4wMDAyLDgzLjM0IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjkuMDAwMiIgeD0iMTIiIHk9IjEwMC40MDY5Ij4mIzIyODA2OyYjMzcwOTY7JiMxMjM2MzsmIzEyNDI1OyYjMTI0NTA7JiMxMjUwMzsmIzEyNTIyOyYjMTI0NjU7JiMxMjU0MDsmIzEyNDcxOyYjMTI1MTk7JiMxMjUzMTsmIzEyNDM0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuMDAwMSIgeD0iMTIiIHk9IjExNS41Mzk3Ij4mIzM5MzY2OyYjMjEyMDU7JiMxMjM3NzsmIzEyNDI3OyYjMTI0NTA7JiMxMjQ4MDsmIzEyNTAzOyYjMTI0Nzk7JiMxMjU0MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQwLjUzMDgiIHg9IjEyIiB5PSIxMzAuNjcyNSI+SFRUUCwgR3JhcGhRTCwgQ0xJJiMzMTU2MTs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJHTU4xNCIgZGF0YS1zb3VyY2UtbGluZT0iNDYiIGRhdGEtdWlkPSJlbnQwMDE1IiBpZD0iZW50aXR5X0dNTjE0Ij48cGF0aCBkPSJNNTMzLDUzOS4zNCBMNTMzLDU2My4wNCBMNDkwLjkxLDU2Ny4wNCBMNTMzLDU3MS4wNCBMNTMzLDU5NC43Mzg0IEEwLDAgMCAwIDAgNTMzLDU5NC43Mzg0IEw3MjMuMDAwMiw1OTQuNzM4NCBBMCwwIDAgMCAwIDcyMy4wMDAyLDU5NC43Mzg0IEw3MjMuMDAwMiw1NDkuMzQgTDcxMy4wMDAyLDUzOS4zNCBMNTMzLDUzOS4zNCBBMCwwIDAgMCAwIDUzMyw1MzkuMzQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03MTMuMDAwMiw1MzkuMzQgTDcxMy4wMDAyLDU0OS4zNCBMNzIzLjAwMDIsNTQ5LjM0IEw3MTMuMDAwMiw1MzkuMzQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Ni4wMDAyIiB4PSI1MzkiIHk9IjU1Ni40MDY5Ij4mIzEyNDUwOyYjMTI1MDM7JiMxMjUyMjsmIzEyNDY1OyYjMTI1NDA7JiMxMjQ3MTsmIzEyNTE5OyYjMTI1MzE7JiMxMjM2NDsmIzIyODA2OyYjMzcwOTY7JiMxMjM5ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY5LjAwMDIiIHg9IjUzOSIgeT0iNTcxLjUzOTciPiYjMjUyMTY7JiMzNDg5OTsmIzEyNDM0OyYjMjAzNTE7JiMxMjM1ODsmIzEyMzgzOyYjMTI0MTc7JiMxMjM5ODsmIzEyNDUwOyYjMTI0ODA7JiMxMjUwMzsmIzEyNDc5OyYjMTI1NDA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMS4wMjQ1IiB4PSI1MzkiIHk9IjU4Ni42NzI1Ij5EQiwgQVBJLCAmIzEyNTAxOyYjMTI0NDk7JiMxMjQ1MjsmIzEyNTIzOyYjMzE1NjE7PC90ZXh0PjwvZz48IS0tbGluayBpbnB1dCB0byBjb3JlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImlucHV0IiBkYXRhLWVudGl0eS0yPSJjb3JlIiBkYXRhLXNvdXJjZS1saW5lPSIzMCIgZGF0YS11aWQ9ImxuazYiIGlkPSJsaW5rX2lucHV0X2NvcmUiPjxwYXRoIGNvZGVMaW5lPSIzMCIgZD0iTTM4MiwxODEuMzQgQzM4NC4xMSwyMTAuNTkgMzg2LjEwOTEsMjM4LjM3NTUgMzg4LjE0OTEsMjY2LjcwNTUiIGZpbGw9Im5vbmUiIGlkPSJpbnB1dC10by1jb3JlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzODguNTgsMjcyLjY5LDM5MS45MjMzLDI2My40MjYsMzg4LjIyMDksMjY3LjcwMjksMzgzLjk0MzksMjY0LjAwMDUsMzg4LjU4LDI3Mi42OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcwLjgwMTgiIHg9IjM5MC42MDM4IiB5PSIyMjQuMTM2OSI+SW5wdXQgUG9ydHM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzcuMTQ5NCIgeD0iMzg3LjQzIiB5PSIyMzkuMjY5NyI+KFVzZSBDYXNlcyk8L3RleHQ+PC9nPjwhLS1saW5rIGNvcmUgdG8gb3V0cHV0LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImNvcmUiIGRhdGEtZW50aXR5LTI9Im91dHB1dCIgZGF0YS1zb3VyY2UtbGluZT0iMzEiIGRhdGEtdWlkPSJsbms3IiBpZD0ibGlua19jb3JlX291dHB1dCI+PHBhdGggY29kZUxpbmU9IjMxIiBkPSJNMzk4LjYsMzk3LjMyIEM0MDEuMTUsNDI1LjI3IDQwMy42NTQ2LDQ1Mi43MDQ4IDQwNi4zNjQ2LDQ4Mi4zOTQ4IiBmaWxsPSJub25lIiBpZD0iY29yZS10by1vdXRwdXQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwNi45MSw0ODguMzcsNDEwLjA3NTQsNDc5LjA0MzcsNDA2LjQ1NTUsNDgzLjM5MDcsNDAyLjEwODUsNDc5Ljc3MDksNDA2LjkxLDQ4OC4zNyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgyLjI5NzQiIHg9IjQwNS4xMyIgeT0iNDM5LjkxNjkiPk91dHB1dCBQb3J0czwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NS4xMTgyIiB4PSI0MDguNzE5NiIgeT0iNDU1LjA0OTciPihJbnRlcmZhY2VzKTwvdGV4dD48L2c+PCEtLVNSQz1bVFBCVkpuRDE0Q1ZWend6T1VTOU9fVzRVSjRnZnEwSXFqM00tIC1CQlVKVGlEcnpsQnhoUTE2MUZrQlk1WURJT1dZV3o4QzJHTzIxOV85NmVZeWlTQzVWZlZrQmt6SVk3d1RabFZ4eW55UGtQay01M2Q4VDFBaUwzQnR2c1BBcjhsTzRlSDRaNWxhSk0wWml0MjRjazhhMEtxQnhxY3ItM2ZqV0d3TmJrRWVFZjk3a2NST19HbjhQU0xubDlINTcyRlFJdjJNWDBJN2VSWnF3QjVVNFhscVZpQVE4NGZLMlFCQVVlUHNNSEZxQ21tQnRtODUxcnQ1Q1BhYkFjc0NlSEFxS2V4MDJFckczVTV4d0hYQ0xlQURTV3d5d21VMlFjVGNmTWlXa25tZXYwZExvMUJPVEpNREUtcG9BR2dZb1h2WHVTRE1rSy0zRTJ1aXJZd3ViOGFCSzkxWDVnQTgzMFA5WmVaTVRIU2NBQ0xLMkJlMzZBNWtQOW5qTGVpekVzcHM4NUdxcmRwb2Q4VW1BRWd5MVBYOTdZTHdydlJfbUNDbVg0a0NSMU9pQkJhZ2lLQ0dJR0tycThrY3JXNVY2dkdjVFM0WHN4QWtGRUxJblJXM1ctMExmVUxYZlB2cFBrZng5YU5zajA2MXNuczVlcGtwRDBEelowblNOam1oaWRYeWlmc3FtUG12QVI0RVFtcld2cHlFejdHVk5haE9vVVhxNDJyWUFZZWstaGFfRWtoeXl6VFoweW10UzNhRXdPbENGYzF3UDd4Slo0djloc3pyX3RxbS16ZEFuVXg2bldWemhWVmRWdFF4WHJqYVZ4WExkemIxLUR6SjVUVHFqRlVvLUVCejhIMHc1RlJBNmlORzV0UlZjd2toMXA2TktwTUM3Y0Z3SGpDM3AzdlhFYkZKQnZYUWdmem1NSVR6RlROVXpyRFpEellxZE0tNU1qREplc0ZwRFBndlRwbVZ5WlBkLTN5UUVyd015YVJKVFR0aTFob3RzUm55bzdKSHZBRGNRb1ZkUG5ZbDhobjNZUW40UXVKSjRfYng4THA1RERESjdPbnNTRnFTMUpZM20wMF0tLT48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="32-typescript">3.2 TypeScriptヘキサゴナルアーキテクチャの実装<a class="headerlink" href="#32-typescript" title="Permanent link">&para;</a></h3>
<h4 id="321-input-port">3.2.1 Input Port（ユースケース）の定義<a class="headerlink" href="#321-input-port" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/application/port/in/ReservationUseCase.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/reservation/Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/room/RoomId&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">CreateReservationCommand</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="w">  </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ReservationQuery</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ReservationUseCase</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 新しい予約を作成する</span>
<span class="cm">   * @param command 予約作成コマンド</span>
<span class="cm">   * @returns 作成された予約</span>
<span class="cm">   * @throws AlreadyReservedException 時間が重複している場合</span>
<span class="cm">   * @throws UnavailableReservationException 部屋が利用不可能な場合</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">createReservation</span><span class="p">(</span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">CreateReservationCommand</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 指定された部屋・日付の予約一覧を取得する</span>
<span class="cm">   * @param query 検索条件</span>
<span class="cm">   * @returns 予約一覧（時刻順）</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">findReservations</span><span class="p">(</span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationQuery</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 予約をキャンセルする</span>
<span class="cm">   * @param reservationId 予約ID</span>
<span class="cm">   * @param userId キャンセルするユーザーID（権限チェック用）</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">cancelReservation</span><span class="p">(</span><span class="nx">reservationId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 特定の予約情報を取得する</span>
<span class="cm">   * @param reservationId 予約ID</span>
<span class="cm">   * @returns 予約情報</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">getReservation</span><span class="p">(</span><span class="nx">reservationId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="322-output-port">3.2.2 Output Port（リポジトリ抽象）の定義<a class="headerlink" href="#322-output-port" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/application/port/out/ReservationRepository.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/reservation/Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/room/RoomId&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 予約を保存する</span>
<span class="cm">   * @param reservation 保存する予約</span>
<span class="cm">   * @returns 保存された予約（IDが設定される）</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">save</span><span class="p">(</span><span class="nx">reservation</span><span class="o">:</span><span class="w"> </span><span class="kt">Reservation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 指定された部屋・日付の予約一覧を取得する</span>
<span class="cm">   * @param roomId 部屋ID</span>
<span class="cm">   * @param date 日付</span>
<span class="cm">   * @returns 予約一覧（開始時刻でソート）</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">findByRoomAndDate</span><span class="p">(</span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">RoomId</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 予約IDで予約を検索する</span>
<span class="cm">   * @param id 予約ID</span>
<span class="cm">   * @returns 予約情報、見つからない場合はnull</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 予約を削除する</span>
<span class="cm">   * @param id 削除する予約のID</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">deleteById</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 全ての予約を削除する（テスト用）</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">deleteAll</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// src/application/port/out/ReservableRoomRepository.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/reservation/ReservableRoom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/room/RoomId&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ReservableRoomRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 指定された日に予約可能な部屋を取得する</span>
<span class="cm">   * @param roomId 部屋ID</span>
<span class="cm">   * @param date 日付</span>
<span class="cm">   * @returns 予約可能な部屋、利用不可の場合はnull</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">findAvailableRoom</span><span class="p">(</span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">RoomId</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 指定された日の予約可能な部屋一覧を取得する</span>
<span class="cm">   * @param date 日付</span>
<span class="cm">   * @returns 予約可能な部屋一覧</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">findAvailableRoomsOn</span><span class="p">(</span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">ReservableRoom</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="323">3.2.3 アプリケーションサービス（ビジネスロジック）<a class="headerlink" href="#323" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/application/service/ReservationService.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Service</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;typedi&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationUseCase</span><span class="p">,</span><span class="w"> </span><span class="nx">CreateReservationCommand</span><span class="p">,</span><span class="w"> </span><span class="nx">ReservationQuery</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/in/ReservationUseCase&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/ReservationRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoomRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/ReservableRoomRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/UserRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/ReservationTimeSlot&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/auth/User&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/room/RoomId&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/AlreadyReservedException&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/UnavailableReservationException&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/NotFoundError&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UnauthorizedError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/UnauthorizedError&#39;</span><span class="p">;</span>

<span class="kd">@Service</span><span class="p">()</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="k">implements</span><span class="w"> </span><span class="nx">ReservationUseCase</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">reservationRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationRepository</span><span class="p">,</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">roomRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoomRepository</span><span class="p">,</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">userRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">UserRepository</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">createReservation</span><span class="p">(</span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="kt">CreateReservationCommand</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. ユーザーの存在確認</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">userId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="p">(</span><span class="sb">`ユーザー &#39;</span><span class="si">${</span><span class="nx">command</span><span class="p">.</span><span class="nx">userId</span><span class="si">}</span><span class="sb">&#39; が見つかりません`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 2. 部屋の予約可能性チェック</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">roomId</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">availableRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">roomRepository</span><span class="p">.</span><span class="nx">findAvailableRoom</span><span class="p">(</span><span class="nx">roomId</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">availableRoom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="p">(</span>
<span class="w">        </span><span class="s1">&#39;指定の日付・部屋の組み合わせは予約できません。&#39;</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 3. 時間スロット作成とバリデーション</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">parseTime</span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">startTime</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">.</span><span class="nx">date</span><span class="p">),</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">parseTime</span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">endTime</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 4. 既存予約との重複チェック</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">existingReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">(</span>
<span class="w">      </span><span class="nx">roomId</span><span class="p">,</span><span class="w"> </span>
<span class="w">      </span><span class="nx">command</span><span class="p">.</span><span class="nx">date</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">availableRoom</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hasOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">existingReservations</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">existing</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">existing</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">newReservation</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">hasOverlap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="p">(</span>
<span class="w">        </span><span class="s1">&#39;指定の時間帯はすでに予約済みです。&#39;</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 5. 予約を保存</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">newReservation</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">findReservations</span><span class="p">(</span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationQuery</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">roomId</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">(</span><span class="nx">roomId</span><span class="p">,</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">date</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">cancelReservation</span><span class="p">(</span><span class="nx">reservationId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. 予約の存在確認</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">reservationId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">reservation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="p">(</span><span class="sb">`予約 ID </span><span class="si">${</span><span class="nx">reservationId</span><span class="si">}</span><span class="sb"> が見つかりません`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 2. 権限チェック（本人またはADMIN）</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="p">(</span><span class="sb">`ユーザー &#39;</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">&#39; が見つかりません`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">canBeCancelledBy</span><span class="p">(</span><span class="nx">user</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">UnauthorizedError</span><span class="p">(</span><span class="s1">&#39;この予約をキャンセルする権限がありません&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 3. 予約削除</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">deleteById</span><span class="p">(</span><span class="nx">reservationId</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">getReservation</span><span class="p">(</span><span class="nx">reservationId</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">reservationId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">reservation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="p">(</span><span class="sb">`予約 ID </span><span class="si">${</span><span class="nx">reservationId</span><span class="si">}</span><span class="sb"> が見つかりません`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">reservation</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">parseTime</span><span class="p">(</span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">hours</span><span class="p">,</span><span class="w"> </span><span class="nx">minutes</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nb">Number</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">setHours</span><span class="p">(</span><span class="nx">hours</span><span class="p">,</span><span class="w"> </span><span class="nx">minutes</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="324">3.2.4 ドメインモデルの実装<a class="headerlink" href="#324" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/domain/model/reservation/Reservation.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservationTimeSlot&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservableRoom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../auth/User&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="nx">ReservationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">_id?</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationId</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_timeSlot</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_room</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoom</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">timeSlot</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoom</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">,</span><span class="w"> </span><span class="nx">id?</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">timeSlot</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">room</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">user</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">id</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ReservationId</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">timeSlot</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">room</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_room</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">user</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_user</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 他の予約と重複しているかチェック</span>
<span class="cm">   * ビジネスルール: 同じ部屋かつ時間が重複する場合に衝突</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">overlap</span><span class="p">(</span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="kt">Reservation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 違う部屋の場合は重複しない</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_room</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">_room</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 同じ部屋の場合は時間の重複をチェック</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 指定されたユーザーがこの予約をキャンセルできるかチェック</span>
<span class="cm">   * ビジネスルール: 予約したユーザー本人またはADMINがキャンセル可能</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">canBeCancelledBy</span><span class="p">(</span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_user</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">isAdmin</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 予約が指定された時間内かどうかチェック</span>
<span class="cm">   * ビジネスルール: 営業時間内（9:00-18:00）の予約のみ有効</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">isWithinBusinessHours</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">startHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">.</span><span class="nx">startTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">endHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">.</span><span class="nx">endTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">startHour</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">9</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">endHour</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">18</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// ファクトリメソッド</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">create</span><span class="p">(</span><span class="nx">timeSlot</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationTimeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoom</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// ビジネスルールの検証</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">isWithinBusinessHours</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;予約は営業時間内（9:00-18:00）で行ってください&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">reservation</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// 永続化後のIDを設定</span>
<span class="w">  </span><span class="nx">withId</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationId</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_room</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_user</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// 表示用文字列</span>
<span class="w">  </span><span class="nx">toString</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`予約[</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="si">}</span><span class="sb">]: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_room</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_timeSlot</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_user</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// src/domain/model/auth/User.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./UserId&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserName</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./UserName&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Password</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./Password&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="nx">RoleName</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USER&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">ADMIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ADMIN&#39;</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UserId</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_name</span><span class="o">:</span><span class="w"> </span><span class="kt">UserName</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_password</span><span class="o">:</span><span class="w"> </span><span class="kt">Password</span><span class="p">;</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">_role</span><span class="o">:</span><span class="w"> </span><span class="kt">RoleName</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">UserId</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">UserName</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="kt">Password</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="kt">RoleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RoleName</span><span class="p">.</span><span class="nx">USER</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">password</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">_role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">role</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">id</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">UserId</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">name</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">UserName</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_name</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">get</span><span class="w"> </span><span class="nx">role</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">RoleName</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_role</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * ビジネスルール: 管理者かどうか</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">isAdmin</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_role</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">RoleName</span><span class="p">.</span><span class="nx">ADMIN</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * パスワードが一致するかチェック</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">verifyPassword</span><span class="p">(</span><span class="nx">plainPassword</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_password</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">plainPassword</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * 等価性チェック（IDで判定）</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">equals</span><span class="p">(</span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// ファクトリメソッド</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">create</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">firstName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">lastName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">plainPassword</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="kt">RoleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RoleName</span><span class="p">.</span><span class="nx">USER</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">User</span><span class="p">(</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="nx">id</span><span class="p">),</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserName</span><span class="p">(</span><span class="nx">firstName</span><span class="p">,</span><span class="w"> </span><span class="nx">lastName</span><span class="p">),</span>
<span class="w">      </span><span class="nx">Password</span><span class="p">.</span><span class="nx">fromPlainText</span><span class="p">(</span><span class="nx">plainPassword</span><span class="p">),</span>
<span class="w">      </span><span class="nx">role</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">toString</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_name</span><span class="p">.</span><span class="nx">fullName</span><span class="si">}</span><span class="sb">(</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="325-output-adapter">3.2.5 Output Adapter（データベースアダプター）の実装<a class="headerlink" href="#325-output-adapter" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/infrastructure/persistence/ReservationPersistenceAdapter.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Service</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;typedi&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../application/port/out/ReservationRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationMapper</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./mapper/ReservationMapper&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/room/RoomId&#39;</span><span class="p">;</span>

<span class="kd">@Service</span><span class="p">()</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationPersistenceAdapter</span><span class="w"> </span><span class="k">implements</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">prisma</span><span class="o">:</span><span class="w"> </span><span class="kt">PrismaClient</span><span class="p">,</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">mapper</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationMapper</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">save</span><span class="p">(</span><span class="nx">reservation</span><span class="o">:</span><span class="w"> </span><span class="kt">Reservation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">mapper</span><span class="p">.</span><span class="nx">toPersistence</span><span class="p">(</span><span class="nx">reservation</span><span class="p">);</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="p">,</span>
<span class="w">      </span><span class="nx">include</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservableRoom</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">include</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">meetingRoom</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">mapper</span><span class="p">.</span><span class="nx">toDomain</span><span class="p">(</span><span class="nx">saved</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">findByRoomAndDate</span><span class="p">(</span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">RoomId</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">Date</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
<span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">roomId.value</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">date</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">include</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservableRoom</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">include</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">meetingRoom</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nx">orderBy</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;asc&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">reservations</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">mapper</span><span class="p">.</span><span class="nx">toDomain</span><span class="p">(</span><span class="nx">r</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Reservation</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
<span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nx">include</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservableRoom</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">include</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">meetingRoom</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">mapper</span><span class="p">.</span><span class="nx">toDomain</span><span class="p">(</span><span class="nx">reservation</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">deleteById</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="ow">delete</span><span class="p">({</span>
<span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">deleteAll</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// src/infrastructure/persistence/mapper/ReservationMapper.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Service</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;typedi&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/reservation/Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/reservation/ReservationTimeSlot&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/reservation/ReservableRoom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/auth/User&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/auth/UserId&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserName</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/auth/UserName&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Password</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/auth/Password&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/room/RoomId&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">MeetingRoom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/room/MeetingRoom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoleName</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/model/auth/User&#39;</span><span class="p">;</span>

<span class="kd">@Service</span><span class="p">()</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationMapper</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">toPersistence</span><span class="p">(</span><span class="nx">reservation</span><span class="o">:</span><span class="w"> </span><span class="kt">Reservation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.timeSlot.startTime</span><span class="p">,</span>
<span class="w">      </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.timeSlot.endTime</span><span class="p">,</span>
<span class="w">      </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.room.roomId.value</span><span class="p">,</span>
<span class="w">      </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.room.date</span><span class="p">,</span>
<span class="w">      </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">reservation.user.id.value</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">toDomain</span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 時間スロット作成</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">startTime</span><span class="p">),</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">endTime</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 会議室作成</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">meetingRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MeetingRoom</span><span class="p">(</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span>
<span class="w">      </span><span class="nx">data</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">name</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 予約可能部屋作成  </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservableRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">roomId</span><span class="p">),</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">reservedDate</span><span class="p">),</span>
<span class="w">      </span><span class="nx">meetingRoom</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// ユーザー作成</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">User</span><span class="p">(</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserId</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserName</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span><span class="p">),</span>
<span class="w">      </span><span class="nx">Password</span><span class="p">.</span><span class="nx">fromHash</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">),</span><span class="w"> </span><span class="c1">// 既にハッシュ化済み</span>
<span class="w">      </span><span class="nx">data</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">roleName</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">RoleName</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">reservableRoom</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="326-input-adapterweb">3.2.6 Input Adapter（Webコントローラー）の実装<a class="headerlink" href="#326-input-adapterweb" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/infrastructure/web/controller/ReservationController.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">Response</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Service</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;typedi&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationUseCase</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../application/port/in/ReservationUseCase&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">CreateReservationRequestDto</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../dto/CreateReservationRequestDto&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationResponseDto</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../dto/ReservationResponseDto&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../middleware/validation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">asyncHandler</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../middleware/asyncHandler&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">authenticated</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../middleware/authentication&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/exception/AlreadyReservedException&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/exception/UnavailableReservationException&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../../domain/exception/NotFoundError&#39;</span><span class="p">;</span>

<span class="kd">@Service</span><span class="p">()</span>
<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">ReservationController</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="nx">reservationUseCase</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationUseCase</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * POST /reservations</span>
<span class="cm">   * 新しい予約を作成</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">createReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">asyncHandler</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="o">:</span><span class="w"> </span><span class="kt">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="o">:</span><span class="w"> </span><span class="kt">Response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// リクエストバリデーション</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">requestData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">CreateReservationRequestDto</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// ユースケース呼び出し</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationUseCase</span><span class="p">.</span><span class="nx">createReservation</span><span class="p">({</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">requestData.roomId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">requestData</span><span class="p">.</span><span class="nx">date</span><span class="p">),</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">requestData.startTime</span><span class="p">,</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">requestData.endTime</span><span class="p">,</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">req.user.id</span><span class="w"> </span><span class="c1">// 認証ミドルウェアから取得</span>
<span class="w">      </span><span class="p">});</span>

<span class="w">      </span><span class="c1">// レスポンス生成</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ReservationResponseDto</span><span class="p">.</span><span class="nx">fromDomain</span><span class="p">(</span><span class="nx">reservation</span><span class="p">);</span>

<span class="w">      </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">201</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">reservation</span><span class="o">:</span><span class="w"> </span><span class="kt">response</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">handleReservationError</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * GET /reservations</span>
<span class="cm">   * 予約一覧取得</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">getReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">asyncHandler</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="o">:</span><span class="w"> </span><span class="kt">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="o">:</span><span class="w"> </span><span class="kt">Response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">roomId</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationUseCase</span><span class="p">.</span><span class="nx">findReservations</span><span class="p">({</span>
<span class="w">      </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">Number</span><span class="p">(</span><span class="nx">roomId</span><span class="p">),</span>
<span class="w">      </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">reservations</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">ReservationResponseDto</span><span class="p">.</span><span class="nx">fromDomain</span><span class="p">(</span><span class="nx">r</span><span class="p">));</span>

<span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
<span class="w">      </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">reservations</span><span class="o">:</span><span class="w"> </span><span class="kt">response</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * DELETE /reservations/:id</span>
<span class="cm">   * 予約キャンセル</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="nx">cancelReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">asyncHandler</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="o">:</span><span class="w"> </span><span class="kt">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="o">:</span><span class="w"> </span><span class="kt">Response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">reservationUseCase</span><span class="p">.</span><span class="nx">cancelReservation</span><span class="p">(</span><span class="nx">reservationId</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">      </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">204</span><span class="p">).</span><span class="nx">send</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">          </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">          </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">error.message</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">handleReservationError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="o">:</span><span class="w"> </span><span class="kt">Response</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">409</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">error.message</span><span class="p">,</span>
<span class="w">        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ALREADY_RESERVED&#39;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">error.message</span><span class="p">,</span>
<span class="w">        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;UNAVAILABLE_RESERVATION&#39;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">NotFoundError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
<span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">error.message</span><span class="p">,</span>
<span class="w">        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;NOT_FOUND&#39;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// その他のエラーはグローバルエラーハンドラーで処理</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="33">3.3 ヘキサゴナルアーキテクチャのテスト戦略<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<h4 id="331">3.3.1 高速ユニットテスト（モック使用）<a class="headerlink" href="#331" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/application/service/ReservationService.test.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservationService&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/ReservationRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoomRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/ReservableRoomRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../port/out/UserRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/ReservationTimeSlot&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/ReservableRoom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="nx">RoleName</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/auth/User&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AlreadyReservedException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/AlreadyReservedException&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UnavailableReservationException</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/exception/UnavailableReservationException&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ReservationService&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">reservationService</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationService</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">mockReservationRepo</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.Mocked</span><span class="o">&lt;</span><span class="nx">ReservationRepository</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">mockRoomRepo</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.Mocked</span><span class="o">&lt;</span><span class="nx">ReservableRoomRepository</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">mockUserRepo</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.Mocked</span><span class="o">&lt;</span><span class="nx">UserRepository</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// モック作成</span>
<span class="w">    </span><span class="nx">mockReservationRepo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">save</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">findByRoomAndDate</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">findById</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">deleteById</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">deleteAll</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">mockRoomRepo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">findAvailableRoom</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">findAvailableRoomsOn</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">mockUserRepo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">findById</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">save</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">reservationService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationService</span><span class="p">(</span>
<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">,</span>
<span class="w">      </span><span class="nx">mockRoomRepo</span><span class="p">,</span>
<span class="w">      </span><span class="nx">mockUserRepo</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;createReservation&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;正常ケース: 予約可能な時間帯で予約が成功する&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Given: テストデータ準備</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;09:00&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10:00&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span>
<span class="w">      </span><span class="p">};</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">expectedReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">          </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="nx">mockRoom</span><span class="p">,</span>
<span class="w">        </span><span class="nx">mockUser</span><span class="p">,</span>
<span class="w">        </span><span class="mf">1</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="c1">// モックの動作を定義</span>
<span class="w">      </span><span class="nx">mockUserRepo</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockUser</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockRoomRepo</span><span class="p">.</span><span class="nx">findAvailableRoom</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockRoom</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">([]);</span><span class="w"> </span><span class="c1">// 既存予約なし</span>
<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">save</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">expectedReservation</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// When: メソッド実行</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">createReservation</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Then: 結果検証</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">save</span><span class="p">).</span><span class="nx">toHaveBeenCalledTimes</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">savedReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">save</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">calls</span><span class="p">[</span><span class="mf">0</span><span class="p">][</span><span class="mf">0</span><span class="p">];</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">savedReservation</span><span class="p">.</span><span class="nx">timeSlot</span><span class="p">.</span><span class="nx">startTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">9</span><span class="p">);</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">savedReservation</span><span class="p">.</span><span class="nx">timeSlot</span><span class="p">.</span><span class="nx">endTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">10</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;異常ケース: 部屋が利用不可能な場合は例外をスロー&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Given</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">999</span><span class="p">,</span>
<span class="w">        </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;09:00&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10:00&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span>
<span class="w">      </span><span class="p">};</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="w">      </span><span class="nx">mockUserRepo</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockUser</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockRoomRepo</span><span class="p">.</span><span class="nx">findAvailableRoom</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"> </span><span class="c1">// 部屋が利用不可</span>

<span class="w">      </span><span class="c1">// When &amp; Then</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">createReservation</span><span class="p">(</span><span class="nx">command</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="nx">UnavailableReservationException</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// save は呼ばれない</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">save</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;異常ケース: 時間重複する予約がある場合は例外をスロー&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Given</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10:00&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;11:00&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span>
<span class="w">      </span><span class="p">};</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockRoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">));</span>

<span class="w">      </span><span class="c1">// 既存の予約（9:30-10:30）</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">existingReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">          </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:30:00&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:30:00&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="nx">mockRoom</span><span class="p">,</span>
<span class="w">        </span><span class="nx">mockUser</span><span class="p">,</span>
<span class="w">        </span><span class="mf">1</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="nx">mockUserRepo</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockUser</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockRoomRepo</span><span class="p">.</span><span class="nx">findAvailableRoom</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockRoom</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">([</span><span class="nx">existingReservation</span><span class="p">]);</span>

<span class="w">      </span><span class="c1">// When &amp; Then</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">createReservation</span><span class="p">(</span><span class="nx">command</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="nx">AlreadyReservedException</span><span class="p">);</span>

<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">save</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;cancelReservation&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;正常ケース: 予約者本人がキャンセル可能&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Given</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="p">;</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">          </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">)),</span>
<span class="w">        </span><span class="nx">mockUser</span><span class="p">,</span>
<span class="w">        </span><span class="mf">1</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockReservation</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockUserRepo</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockUser</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">deleteById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">();</span>

<span class="w">      </span><span class="c1">// When</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">cancelReservation</span><span class="p">(</span><span class="nx">reservationId</span><span class="p">,</span><span class="w"> </span><span class="nx">userId</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Then</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">deleteById</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span><span class="nx">reservationId</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;正常ケース: ADMINは他人の予約もキャンセル可能&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Given</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">adminId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">;</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;user123&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockAdmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Admin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">RoleName</span><span class="p">.</span><span class="nx">ADMIN</span><span class="p">);</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mockReservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">          </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">)),</span>
<span class="w">        </span><span class="nx">mockUser</span><span class="p">,</span><span class="w"> </span><span class="c1">// 予約者は一般ユーザー</span>
<span class="w">        </span><span class="mf">1</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockReservation</span><span class="p">);</span>
<span class="w">      </span><span class="nx">mockUserRepo</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockAdmin</span><span class="p">);</span><span class="w"> </span><span class="c1">// キャンセル実行者はADMIN</span>
<span class="w">      </span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">deleteById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">();</span>

<span class="w">      </span><span class="c1">// When</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">reservationService</span><span class="p">.</span><span class="nx">cancelReservation</span><span class="p">(</span><span class="nx">reservationId</span><span class="p">,</span><span class="w"> </span><span class="nx">adminId</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Then</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockReservationRepo</span><span class="p">.</span><span class="nx">deleteById</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span><span class="nx">reservationId</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><strong>テスト実行結果</strong>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--<span class="w"> </span>--testPathPattern<span class="o">=</span>ReservationService
Test<span class="w"> </span>Suites:<span class="w"> </span><span class="m">1</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>total<span class="w">  </span>
Tests:<span class="w">       </span><span class="m">8</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">8</span><span class="w"> </span>total
Time:<span class="w">        </span><span class="m">0</span>.847<span class="w"> </span>s

<span class="c1"># 1テストあたり: 0.106秒</span>
<span class="c1"># レイヤードアーキテクチャより約5倍高速</span>
</code></pre></div></p>
<h4 id="332">3.3.2 統合テスト（アダプター層のテスト）<a class="headerlink" href="#332" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/infrastructure/persistence/ReservationPersistenceAdapter.test.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationPersistenceAdapter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./ReservationPersistenceAdapter&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationMapper</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./mapper/ReservationMapper&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/Reservation&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/ReservationTimeSlot&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/reservation/ReservableRoom&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="nx">RoleName</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/auth/User&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../domain/model/room/RoomId&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ReservationPersistenceAdapter&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">prisma</span><span class="o">:</span><span class="w"> </span><span class="kt">PrismaClient</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">adapter</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationPersistenceAdapter</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">mapper</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationMapper</span><span class="p">;</span>

<span class="w">  </span><span class="nx">beforeAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$connect</span><span class="p">();</span>
<span class="w">    </span><span class="nx">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationMapper</span><span class="p">();</span>
<span class="w">    </span><span class="nx">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationPersistenceAdapter</span><span class="p">(</span><span class="nx">prisma</span><span class="p">,</span><span class="w"> </span><span class="nx">mapper</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// テスト前にDBをクリーンアップ</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">afterAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$disconnect</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;予約をデータベースに保存できる&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given: テストデータをセットアップ</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">firstName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">lastName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hashedpassword&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">roleName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;USER&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Conference Room A&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// ドメインオブジェクト作成</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeSlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationTimeSlot</span><span class="p">(</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">room</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">));</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;testuser&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Reservation</span><span class="p">(</span><span class="nx">timeSlot</span><span class="p">,</span><span class="w"> </span><span class="nx">room</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When: 保存</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">adapter</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">reservation</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then: 保存結果を検証</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">saved</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">saved</span><span class="p">.</span><span class="nx">timeSlot</span><span class="p">.</span><span class="nx">startTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">9</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">saved</span><span class="p">.</span><span class="nx">timeSlot</span><span class="p">.</span><span class="nx">endTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">10</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">saved</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;testuser&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// データベースに実際に保存されたことを確認</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">dbRecord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">findFirst</span><span class="p">({</span>
<span class="w">      </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">dbRecord</span><span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">dbRecord</span><span class="o">!</span><span class="p">.</span><span class="nx">roomId</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;部屋と日付で予約一覧を取得できる&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given: テストデータを準備</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">setupTestData</span><span class="p">();</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">roomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When: 検索</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">adapter</span><span class="p">.</span><span class="nx">findByRoomAndDate</span><span class="p">(</span><span class="nx">roomId</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then: 結果を検証</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservations</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 時刻順にソートされていることを確認</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservations</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">timeSlot</span><span class="p">.</span><span class="nx">startTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">9</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">reservations</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">timeSlot</span><span class="p">.</span><span class="nx">startTime</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">14</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// すべて同じ部屋・日付であることを確認</span>
<span class="w">    </span><span class="nx">reservations</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">room</span><span class="p">.</span><span class="nx">roomId</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">room</span><span class="p">.</span><span class="nx">date</span><span class="p">.</span><span class="nx">toDateString</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">toDateString</span><span class="p">());</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">setupTestData</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ユーザー作成</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">createMany</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user1&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">firstName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">lastName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;One&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hash1&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">roleName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;USER&#39;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user2&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">          </span><span class="nx">firstName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;User&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">lastName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Two&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hash2&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">roleName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;USER&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 会議室作成</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">meetingRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Conference Room A&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 予約可能部屋作成</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservableRoom</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 予約作成</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">reservation</span><span class="p">.</span><span class="nx">createMany</span><span class="p">({</span>
<span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T09:00:00&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T10:00:00&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">          </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user1&#39;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nx">startTime</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T14:00:00&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">endTime</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01T15:00:00&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">          </span><span class="nx">reservedDate</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user2&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="34">3.4 依存関係注入の設定<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<h4 id="341-typedi">3.4.1 TypeDI設定<a class="headerlink" href="#341-typedi" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/infrastructure/di/Container.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Container</span><span class="p">,</span><span class="w"> </span><span class="nx">Service</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;typedi&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationUseCase</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../application/port/in/ReservationUseCase&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../application/service/ReservationService&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../application/port/out/ReservationRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationPersistenceAdapter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../persistence/ReservationPersistenceAdapter&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoomRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../application/port/out/ReservableRoomRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservableRoomPersistenceAdapter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../persistence/ReservableRoomPersistenceAdapter&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../../application/port/out/UserRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">UserPersistenceAdapter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../persistence/UserPersistenceAdapter&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">DIContainer</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">setup</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// データベース接続</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>
<span class="w">    </span><span class="nx">Container</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;prisma&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">prisma</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// リポジトリの登録（Output Port → Output Adapter）</span>
<span class="w">    </span><span class="nx">Container</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
<span class="w">      </span><span class="s1">&#39;ReservationRepository&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationPersistenceAdapter</span><span class="p">(</span><span class="nx">prisma</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationMapper</span><span class="p">())</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="nx">Container</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
<span class="w">      </span><span class="s1">&#39;ReservableRoomRepository&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservableRoomPersistenceAdapter</span><span class="p">(</span><span class="nx">prisma</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="nx">Container</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
<span class="w">      </span><span class="s1">&#39;UserRepository&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">UserPersistenceAdapter</span><span class="p">(</span><span class="nx">prisma</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// サービスの登録（Input Port → Application Service）</span>
<span class="w">    </span><span class="nx">Container</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
<span class="w">      </span><span class="s1">&#39;ReservationUseCase&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReservationService</span><span class="p">(</span>
<span class="w">        </span><span class="nx">Container</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;ReservationRepository&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Container</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;ReservableRoomRepository&#39;</span><span class="p">),</span><span class="w"> </span>
<span class="w">        </span><span class="nx">Container</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;UserRepository&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="342-expressjs">3.4.2 Express.js アプリケーション設定<a class="headerlink" href="#342-expressjs" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// src/infrastructure/web/app.ts</span>
<span class="k">import</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;reflect-metadata&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Container</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;typedi&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">DIContainer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../di/Container&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ReservationController</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./controller/ReservationController&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">errorHandler</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./middleware/errorHandler&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">authenticationMiddleware</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./middleware/authentication&#39;</span><span class="p">;</span>

<span class="c1">// DI設定</span>
<span class="nx">DIContainer</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>

<span class="c1">// ミドルウェア設定</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">authenticationMiddleware</span><span class="p">);</span>

<span class="c1">// コントローラー取得（DIコンテナから）</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">reservationController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Container</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">ReservationController</span><span class="p">);</span>

<span class="c1">// ルート設定</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/reservations&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">reservationController</span><span class="p">.</span><span class="nx">createReservation</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/reservations&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">reservationController</span><span class="p">.</span><span class="nx">getReservations</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/reservations/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">reservationController</span><span class="p">.</span><span class="nx">cancelReservation</span><span class="p">);</span>

<span class="c1">// エラーハンドリング</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">errorHandler</span><span class="p">);</span>

<span class="k">export</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="p">};</span>
</code></pre></div>
<h3 id="35">3.5 ヘキサゴナルアーキテクチャの詳細クラス図<a class="headerlink" href="#35" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjEyMzNweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjUxMjhweDtoZWlnaHQ6MTIzM3B4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDUxMjggMTIzMyIgd2lkdGg9IjUxMjhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIEFwcGxpY2F0aW9uIENvcmUtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IkFwcGxpY2F0aW9uIENvcmUiIGRhdGEtc291cmNlLWxpbmU9IjEiIGRhdGEtdWlkPSJlbnQwMDAyIiBpZD0iY2x1c3Rlcl9BcHBsaWNhdGlvbiBDb3JlIj48cGF0aCBkPSJNMTgzLjg4LDQ4NC42NyBMMzE1LjM0MzksNDg0LjY3IEEzLjc1LDMuNzUgMCAwIDEgMzE3Ljg0MzksNDg3LjE3IEwzMjQuODQzOSw1MDYuOTY2OSBMMjg3Mi44OCw1MDYuOTY2OSBBMi41LDIuNSAwIDAgMSAyODc1LjM4LDUwOS40NjY5IEwyODc1LjM4LDEyMjQuMTEgQTIuNSwyLjUgMCAwIDEgMjg3Mi44OCwxMjI2LjYxIEwxODMuODgsMTIyNi42MSBBMi41LDIuNSAwIDAgMSAxODEuMzgsMTIyNC4xMSBMMTgxLjM4LDQ4Ny4xNyBBMi41LDIuNSAwIDAgMSAxODMuODgsNDg0LjY3IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxODEuMzgiIHgyPSIzMjQuODQzOSIgeTE9IjUwNi45NjY5IiB5Mj0iNTA2Ljk2NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjQ2MzkiIHg9IjE4NS4zOCIgeT0iNDk5LjY2NTEiPkFwcGxpY2F0aW9uIENvcmU8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIERvbWFpbiBNb2RlbHMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IkRvbWFpbiBNb2RlbHMiIGRhdGEtc291cmNlLWxpbmU9IjMiIGRhdGEtdWlkPSJlbnQwMDAzIiBpZD0iY2x1c3Rlcl9Eb21haW4gTW9kZWxzIj48cGF0aCBkPSJNMjIzLjg4LDUzNS42NyBMMzQ1Ljk5MjMsNTM1LjY3IEEzLjc1LDMuNzUgMCAwIDEgMzQ4LjQ5MjMsNTM4LjE3IEwzNTUuNDkyMyw1NTcuOTY2OSBMOTIzLjg4LDU1Ny45NjY5IEEyLjUsMi41IDAgMCAxIDkyNi4zOCw1NjAuNDY2OSBMOTI2LjM4LDExOTIuMTEgQTIuNSwyLjUgMCAwIDEgOTIzLjg4LDExOTQuNjEgTDIyMy44OCwxMTk0LjYxIEEyLjUsMi41IDAgMCAxIDIyMS4zOCwxMTkyLjExIEwyMjEuMzgsNTM4LjE3IEEyLjUsMi41IDAgMCAxIDIyMy44OCw1MzUuNjciIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjIyMS4zOCIgeDI9IjM1NS40OTIzIiB5MT0iNTU3Ljk2NjkiIHkyPSI1NTcuOTY2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjEuMTEyMyIgeD0iMjI1LjM4IiB5PSI1NTAuNjY1MSI+RG9tYWluIE1vZGVsczwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgUG9ydHMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IlBvcnRzIiBkYXRhLXNvdXJjZS1saW5lPSI0NiIgZGF0YS11aWQ9ImVudDAwMDkiIGlkPSJjbHVzdGVyX1BvcnRzIj48cGF0aCBkPSJNOTUyLjg4LDgzOS45NCBMOTk1LjY4ODYsODM5Ljk0IEEzLjc1LDMuNzUgMCAwIDEgOTk4LjE4ODYsODQyLjQ0IEwxMDA1LjE4ODYsODYyLjIzNjkgTDI4NDAuODgsODYyLjIzNjkgQTIuNSwyLjUgMCAwIDEgMjg0My4zOCw4NjQuNzM2OSBMMjg0My4zOCwxMDAxLjYzIEEyLjUsMi41IDAgMCAxIDI4NDAuODgsMTAwNC4xMyBMOTUyLjg4LDEwMDQuMTMgQTIuNSwyLjUgMCAwIDEgOTUwLjM4LDEwMDEuNjMgTDk1MC4zOCw4NDIuNDQgQTIuNSwyLjUgMCAwIDEgOTUyLjg4LDgzOS45NCIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iOTUwLjM4IiB4Mj0iMTAwNS4xODg2IiB5MT0iODYyLjIzNjkiIHkyPSI4NjIuMjM2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS44MDg2IiB4PSI5NTQuMzgiIHk9Ijg1NC45MzUxIj5Qb3J0czwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQXBwbGljYXRpb24gU2VydmljZXMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IkFwcGxpY2F0aW9uIFNlcnZpY2VzIiBkYXRhLXNvdXJjZS1saW5lPSI2NiIgZGF0YS11aWQ9ImVudDAwMTMiIGlkPSJjbHVzdGVyX0FwcGxpY2F0aW9uIFNlcnZpY2VzIj48cGF0aCBkPSJNMTU2OC44OCw1NjguMjcgTDE3MzAuNTg2MSw1NjguMjcgQTMuNzUsMy43NSAwIDAgMSAxNzMzLjA4NjEsNTcwLjc3IEwxNzQwLjA4NjEsNTkwLjU2NjkgTDIyMTUuODgsNTkwLjU2NjkgQTIuNSwyLjUgMCAwIDEgMjIxOC4zOCw1OTMuMDY2OSBMMjIxOC4zOCw3NDYuMjUgQTIuNSwyLjUgMCAwIDEgMjIxNS44OCw3NDguNzUgTDE1NjguODgsNzQ4Ljc1IEEyLjUsMi41IDAgMCAxIDE1NjYuMzgsNzQ2LjI1IEwxNTY2LjM4LDU3MC43NyBBMi41LDIuNSAwIDAgMSAxNTY4Ljg4LDU2OC4yNyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTU2Ni4zOCIgeDI9IjE3NDAuMDg2MSIgeTE9IjU5MC41NjY5IiB5Mj0iNTkwLjU2NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYwLjcwNjEiIHg9IjE1NzAuMzgiIHk9IjU4My4yNjUxIj5BcHBsaWNhdGlvbiBTZXJ2aWNlczwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgSW5mcmFzdHJ1Y3R1cmUtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IkluZnJhc3RydWN0dXJlIiBkYXRhLXNvdXJjZS1saW5lPSI3NyIgZGF0YS11aWQ9ImVudDAwMTUiIGlkPSJjbHVzdGVyX0luZnJhc3RydWN0dXJlIj48cGF0aCBkPSJNMjkxNy44OCw2IEwzMDI5Ljc1MjEsNiBBMy43NSwzLjc1IDAgMCAxIDMwMzIuMjUyMSw4LjUgTDMwMzkuMjUyMSwyOC4yOTY5IEw0OTU2Ljg4LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgNDk1OS4zOCwzMC43OTY5IEw0OTU5LjM4LDc2MS45NSBBMi41LDIuNSAwIDAgMSA0OTU2Ljg4LDc2NC40NSBMMjkxNy44OCw3NjQuNDUgQTIuNSwyLjUgMCAwIDEgMjkxNS4zOCw3NjEuOTUgTDI5MTUuMzgsOC41IEEyLjUsMi41IDAgMCAxIDI5MTcuODgsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjkxNS4zOCIgeDI9IjMwMzkuMjUyMSIgeTE9IjI4LjI5NjkiIHkyPSIyOC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMC44NzIxIiB4PSIyOTE5LjM4IiB5PSIyMC45OTUxIj5JbmZyYXN0cnVjdHVyZTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgSW5wdXQgQWRhcHRlcnMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IklucHV0IEFkYXB0ZXJzIiBkYXRhLXNvdXJjZS1saW5lPSI3OSIgZGF0YS11aWQ9ImVudDAwMTYiIGlkPSJjbHVzdGVyX0lucHV0IEFkYXB0ZXJzIj48cGF0aCBkPSJNMzU2Ny44OCw1NyBMMzY4Ny4zNjA1LDU3IEEzLjc1LDMuNzUgMCAwIDEgMzY4OS44NjA1LDU5LjUgTDM2OTYuODYwNSw3OS4yOTY5IEw0OTE2Ljg4LDc5LjI5NjkgQTIuNSwyLjUgMCAwIDEgNDkxOS4zOCw4MS43OTY5IEw0OTE5LjM4LDI2Ny41OCBBMi41LDIuNSAwIDAgMSA0OTE2Ljg4LDI3MC4wOCBMMzU2Ny44OCwyNzAuMDggQTIuNSwyLjUgMCAwIDEgMzU2NS4zOCwyNjcuNTggTDM1NjUuMzgsNTkuNSBBMi41LDIuNSAwIDAgMSAzNTY3Ljg4LDU3IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIzNTY1LjM4IiB4Mj0iMzY5Ni44NjA1IiB5MT0iNzkuMjk2OSIgeTI9Ijc5LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE4LjQ4MDUiIHg9IjM1NjkuMzgiIHk9IjcxLjk5NTEiPklucHV0IEFkYXB0ZXJzPC90ZXh0PjwvZz48IS0tY2x1c3RlciBPdXRwdXQgQWRhcHRlcnMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9Ik91dHB1dCBBZGFwdGVycyIgZGF0YS1zb3VyY2UtbGluZT0iMTA1IiBkYXRhLXVpZD0iZW50MDAyMCIgaWQ9ImNsdXN0ZXJfT3V0cHV0IEFkYXB0ZXJzIj48cGF0aCBkPSJNMjk0OS44OCw3My4zIEwzMDgyLjc0NTIsNzMuMyBBMy43NSwzLjc1IDAgMCAxIDMwODUuMjQ1Miw3NS44IEwzMDkyLjI0NTIsOTUuNTk2OSBMMzUzOC44OCw5NS41OTY5IEEyLjUsMi41IDAgMCAxIDM1NDEuMzgsOTguMDk2OSBMMzU0MS4zOCw3MjkuOTUgQTIuNSwyLjUgMCAwIDEgMzUzOC44OCw3MzIuNDUgTDI5NDkuODgsNzMyLjQ1IEEyLjUsMi41IDAgMCAxIDI5NDcuMzgsNzI5Ljk1IEwyOTQ3LjM4LDc1LjggQTIuNSwyLjUgMCAwIDEgMjk0OS44OCw3My4zIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIyOTQ3LjM4IiB4Mj0iMzA5Mi4yNDUyIiB5MT0iOTUuNTk2OSIgeTI9Ijk1LjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMxLjg2NTIiIHg9IjI5NTEuMzgiIHk9Ijg4LjI5NTEiPk91dHB1dCBBZGFwdGVyczwvdGV4dD48L2c+PCEtLWNsYXNzIFJlc2VydmF0aW9uLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IlJlc2VydmF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBkYXRhLXVpZD0iZW50MDAwNCIgaWQ9ImVudGl0eV9SZXNlcnZhdGlvbiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxOTQuNjcxOSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMzAzLjc1MSIgeD0iNjA2LjUiIHk9IjU3MC42NyIvPjxlbGxpcHNlIGN4PSI3MTIuMjgyNyIgY3k9IjU4Ni42NyIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNzE1LjI1MTUsNTkyLjMxMDYgUTcxNC42NzMzLDU5Mi42MDc1IDcxNC4wMzI3LDU5Mi43NDgxIFE3MTMuMzkyMSw1OTIuOTA0NCA3MTIuNjg5LDU5Mi45MDQ0IFE3MTAuMTg5LDU5Mi45MDQ0IDcwOC44NjA4LDU5MS4yNjM3IFE3MDcuNTQ4Myw1ODkuNjA3NSA3MDcuNTQ4Myw1ODYuNDgyNSBRNzA3LjU0ODMsNTgzLjM1NzUgNzA4Ljg2MDgsNTgxLjcwMTIgUTcxMC4xODksNTgwLjA0NSA3MTIuNjg5LDU4MC4wNDUgUTcxMy4zOTIxLDU4MC4wNDUgNzE0LjAzMjcsNTgwLjIwMTIgUTcxNC42ODksNTgwLjM1NzUgNzE1LjI1MTUsNTgwLjY1NDQgTDcxNS4yNTE1LDU4My4zNzMxIFE3MTQuNjI2NSw1ODIuNzk1IDcxNC4wMzI3LDU4Mi41Mjk0IFE3MTMuNDM5LDU4Mi4yNDgxIDcxMi44MTQsNTgyLjI0ODEgUTcxMS40NzAyLDU4Mi4yNDgxIDcxMC43ODI3LDU4My4zMjYyIFE3MTAuMDk1Miw1ODQuMzg4NyA3MTAuMDk1Miw1ODYuNDgyNSBRNzEwLjA5NTIsNTg4LjU3NjIgNzEwLjc4MjcsNTg5LjY1NDQgUTcxMS40NzAyLDU5MC43MTY5IDcxMi44MTQsNTkwLjcxNjkgUTcxMy40MzksNTkwLjcxNjkgNzE0LjAzMjcsNTkwLjQ1MTIgUTcxNC42MjY1LDU5MC4xNyA3MTUuMjUxNSw1ODkuNTkxOSBMNzE1LjI1MTUsNTkyLjMxMDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My42ODU1IiB4PSI3MzIuNzgyNyIgeT0iNTkxLjUxNjciPlJlc2VydmF0aW9uPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjYwNy41IiB4Mj0iOTA5LjI1MSIgeTE9IjYwMi42NyIgeTI9IjYwMi42NyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjYxNC41IiB5PSI2MTMuMzE4NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAxMzciIHg9IjYyNi41IiB5PSI2MTkuNjY1MSI+X2lkPzogbnVtYmVyPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjYxNC41IiB5PSI2MjkuNjE1MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxOS44MzY5IiB4PSI2MjYuNSIgeT0iNjM1Ljk2MiI+X3RpbWVTbG90OiBSZXNlcnZhdGlvblRpbWVTbG90PC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjYxNC41IiB5PSI2NDUuOTEyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3MS40NDUzIiB4PSI2MjYuNSIgeT0iNjUyLjI1ODkiPl9yb29tOiBSZXNlcnZhYmxlUm9vbTwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI2MTQuNSIgeT0iNjYyLjIwOTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC42MTMzIiB4PSI2MjYuNSIgeT0iNjY4LjU1NTciPl91c2VyOiBVc2VyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjYwNy41IiB4Mj0iOTA5LjI1MSIgeTE9IjY3NS44NTc1IiB5Mj0iNjc1Ljg1NzUiLz48ZWxsaXBzZSBjeD0iNjE3LjUiIGN5PSI2ODkuNTA1OSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjU4Ljc4ODEiIHg9IjYyNi41IiB5PSI2OTIuODUyNiI+b3ZlcmxhcChvdGhlcjogUmVzZXJ2YXRpb24pOiBib29sZWFuPC90ZXh0PjxlbGxpcHNlIGN4PSI2MTcuNSIgY3k9IjcwNS44MDI4IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNzcuNzUxIiB4PSI2MjYuNSIgeT0iNzA5LjE0OTUiPmNhbkJlQ2FuY2VsbGVkQnkodXNlcjogVXNlcik6IGJvb2xlYW48L3RleHQ+PGVsbGlwc2UgY3g9IjYxNy41IiBjeT0iNzIyLjA5OTciIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzNC44NTU1IiB4PSI2MjYuNSIgeT0iNzI1LjQ0NjQiPmlzV2l0aGluQnVzaW5lc3NIb3VycygpOiBib29sZWFuPC90ZXh0PjxlbGxpcHNlIGN4PSI2MTcuNSIgY3k9IjczOC4zOTY2IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMDQuNzYzNyIgeD0iNjI2LjUiIHk9Ijc0MS43NDMyIj5zdGF0aWMgY3JlYXRlKC4uLik6IFJlc2VydmF0aW9uPC90ZXh0PjxlbGxpcHNlIGN4PSI2MTcuNSIgY3k9Ijc1NC42OTM0IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjMuMDc3MSIgeD0iNjI2LjUiIHk9Ijc1OC4wNDAxIj53aXRoSWQoaWQ6IG51bWJlcik6IFJlc2VydmF0aW9uPC90ZXh0PjwvZz48IS0tY2xhc3MgUmVzZXJ2YXRpb25UaW1lU2xvdC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSZXNlcnZhdGlvblRpbWVTbG90IiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfUmVzZXJ2YXRpb25UaW1lU2xvdCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMTMuMTg3NSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMzQ2LjMxMTUiIHg9IjIzNy4yMiIgeT0iODc0Ljk0Ii8+PGVsbGlwc2UgY3g9IjMzMy41MjEzIiBjeT0iODkwLjk0IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zMzYuNDksODk2LjU4MDYgUTMzNS45MTE5LDg5Ni44Nzc1IDMzNS4yNzEzLDg5Ny4wMTgxIFEzMzQuNjMwNiw4OTcuMTc0NCAzMzMuOTI3NSw4OTcuMTc0NCBRMzMxLjQyNzUsODk3LjE3NDQgMzMwLjA5OTQsODk1LjUzMzcgUTMyOC43ODY5LDg5My44Nzc1IDMyOC43ODY5LDg5MC43NTI1IFEzMjguNzg2OSw4ODcuNjI3NSAzMzAuMDk5NCw4ODUuOTcxMiBRMzMxLjQyNzUsODg0LjMxNSAzMzMuOTI3NSw4ODQuMzE1IFEzMzQuNjMwNiw4ODQuMzE1IDMzNS4yNzEzLDg4NC40NzEyIFEzMzUuOTI3NSw4ODQuNjI3NSAzMzYuNDksODg0LjkyNDQgTDMzNi40OSw4ODcuNjQzMSBRMzM1Ljg2NSw4ODcuMDY1IDMzNS4yNzEzLDg4Ni43OTk0IFEzMzQuNjc3NSw4ODYuNTE4MSAzMzQuMDUyNSw4ODYuNTE4MSBRMzMyLjcwODgsODg2LjUxODEgMzMyLjAyMTMsODg3LjU5NjIgUTMzMS4zMzM4LDg4OC42NTg3IDMzMS4zMzM4LDg5MC43NTI1IFEzMzEuMzMzOCw4OTIuODQ2MiAzMzIuMDIxMyw4OTMuOTI0NCBRMzMyLjcwODgsODk0Ljk4NjkgMzM0LjA1MjUsODk0Ljk4NjkgUTMzNC42Nzc1LDg5NC45ODY5IDMzNS4yNzEzLDg5NC43MjEyIFEzMzUuODY1LDg5NC40NCAzMzYuNDksODkzLjg2MTkgTDMzNi40OSw4OTYuNTgwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0NS4yMDkiIHg9IjM1NC4wMjEzIiB5PSI4OTUuNzg2NyI+UmVzZXJ2YXRpb25UaW1lU2xvdDwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMzguMjIiIHgyPSI1ODIuNTMxNSIgeTE9IjkwNi45NCIgeTI9IjkwNi45NCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI0NS4yMiIgeT0iOTE3LjU4ODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuOTI4NyIgeD0iMjU3LjIyIiB5PSI5MjMuOTM1MSI+X3N0YXJ0VGltZTogRGF0ZTwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyNDUuMjIiIHk9IjkzMy44ODUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEwLjY5NDMiIHg9IjI1Ny4yMiIgeT0iOTQwLjIzMiI+X2VuZFRpbWU6IERhdGU8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjM4LjIyIiB4Mj0iNTgyLjUzMTUiIHkxPSI5NDcuNTMzNyIgeTI9Ijk0Ny41MzM3Ii8+PGVsbGlwc2UgY3g9IjI0OC4yMiIgY3k9Ijk2MS4xODIyIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMjAuMzExNSIgeD0iMjU3LjIyIiB5PSI5NjQuNTI4OSI+b3ZlcmxhcChvdGhlcjogUmVzZXJ2YXRpb25UaW1lU2xvdCk6IGJvb2xlYW48L3RleHQ+PGVsbGlwc2UgY3g9IjI0OC4yMiIgY3k9Ijk3Ny40NzkxIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMTMuODcyMSIgeD0iMjU3LjIyIiB5PSI5ODAuODI1NyI+ZXF1YWxzKG90aGVyOiBSZXNlcnZhdGlvblRpbWVTbG90KTogYm9vbGVhbjwvdGV4dD48L2c+PCEtLWNsYXNzIFVzZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iVXNlciIgZGF0YS1zb3VyY2UtbGluZT0iMjMiIGRhdGEtdWlkPSJlbnQwMDA2IiBpZD0iZW50aXR5X1VzZXIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTc4LjM3NSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjkxLjU2MjUiIHg9IjYxOC42IiB5PSI4NDIuMzQiLz48ZWxsaXBzZSBjeD0iNzQ0LjE3NjIiIGN5PSI4NTguMzQiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTc0Ny4xNDQ5LDg2My45ODA2IFE3NDYuNTY2OCw4NjQuMjc3NSA3NDUuOTI2Miw4NjQuNDE4MSBRNzQ1LjI4NTUsODY0LjU3NDQgNzQ0LjU4MjQsODY0LjU3NDQgUTc0Mi4wODI0LDg2NC41NzQ0IDc0MC43NTQzLDg2Mi45MzM3IFE3MzkuNDQxOCw4NjEuMjc3NSA3MzkuNDQxOCw4NTguMTUyNSBRNzM5LjQ0MTgsODU1LjAyNzUgNzQwLjc1NDMsODUzLjM3MTIgUTc0Mi4wODI0LDg1MS43MTUgNzQ0LjU4MjQsODUxLjcxNSBRNzQ1LjI4NTUsODUxLjcxNSA3NDUuOTI2Miw4NTEuODcxMiBRNzQ2LjU4MjQsODUyLjAyNzUgNzQ3LjE0NDksODUyLjMyNDQgTDc0Ny4xNDQ5LDg1NS4wNDMxIFE3NDYuNTE5OSw4NTQuNDY1IDc0NS45MjYyLDg1NC4xOTk0IFE3NDUuMzMyNCw4NTMuOTE4MSA3NDQuNzA3NCw4NTMuOTE4MSBRNzQzLjM2MzcsODUzLjkxODEgNzQyLjY3NjIsODU0Ljk5NjIgUTc0MS45ODg3LDg1Ni4wNTg3IDc0MS45ODg3LDg1OC4xNTI1IFE3NDEuOTg4Nyw4NjAuMjQ2MiA3NDIuNjc2Miw4NjEuMzI0NCBRNzQzLjM2MzcsODYyLjM4NjkgNzQ0LjcwNzQsODYyLjM4NjkgUTc0NS4zMzI0LDg2Mi4zODY5IDc0NS45MjYyLDg2Mi4xMjEyIFE3NDYuNTE5OSw4NjEuODQgNzQ3LjE0NDksODYxLjI2MTkgTDc0Ny4xNDQ5LDg2My45ODA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzEuOTEwMiIgeD0iNzY0LjY3NjIiIHk9Ijg2My4xODY3Ij5Vc2VyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjYxOS42IiB4Mj0iOTA5LjE2MjUiIHkxPSI4NzQuMzQiIHkyPSI4NzQuMzQiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI2MjYuNiIgeT0iODg0Ljk4ODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My44NjkxIiB4PSI2MzguNiIgeT0iODkxLjMzNTEiPl9pZDogVXNlcklkPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjYyNi42IiB5PSI5MDEuMjg1MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyOS4wODMiIHg9IjYzOC42IiB5PSI5MDcuNjMyIj5fbmFtZTogVXNlck5hbWU8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iNjI2LjYiIHk9IjkxNy41ODIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ5LjE0NjUiIHg9IjYzOC42IiB5PSI5MjMuOTI4OSI+X3Bhc3N3b3JkOiBQYXNzd29yZDwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI2MjYuNiIgeT0iOTMzLjg3OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTUuMDg5OCIgeD0iNjM4LjYiIHk9Ijk0MC4yMjU3Ij5fcm9sZTogUm9sZU5hbWU8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNjE5LjYiIHgyPSI5MDkuMTYyNSIgeTE9Ijk0Ny41Mjc1IiB5Mj0iOTQ3LjUyNzUiLz48ZWxsaXBzZSBjeD0iNjI5LjYiIGN5PSI5NjEuMTc1OSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMyLjExMTMiIHg9IjYzOC42IiB5PSI5NjQuNTIyNiI+aXNBZG1pbigpOiBib29sZWFuPC90ZXh0PjxlbGxpcHNlIGN4PSI2MjkuNiIgY3k9Ijk3Ny40NzI4IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNjUuNTYyNSIgeD0iNjM4LjYiIHk9Ijk4MC44MTk1Ij52ZXJpZnlQYXNzd29yZChwbGFpbjogc3RyaW5nKTogYm9vbGVhbjwvdGV4dD48ZWxsaXBzZSBjeD0iNjI5LjYiIGN5PSI5OTMuNzY5NyIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjAwLjU3MzIiIHg9IjYzOC42IiB5PSI5OTcuMTE2NCI+ZXF1YWxzKG90aGVyOiBVc2VyKTogYm9vbGVhbjwvdGV4dD48ZWxsaXBzZSBjeD0iNjI5LjYiIGN5PSIxMDEwLjA2NjYiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Mi45ODgzIiB4PSI2MzguNiIgeT0iMTAxMy40MTMyIj5zdGF0aWMgY3JlYXRlKC4uLik6IFVzZXI8L3RleHQ+PC9nPjwhLS1jbGFzcyBVc2VySWQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iVXNlcklkIiBkYXRhLXNvdXJjZS1saW5lPSIzNCIgZGF0YS11aWQ9ImVudDAwMDciIGlkPSJlbnRpdHlfVXNlcklkIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjgwLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIzOS41ODg5IiB4PSI0NDQuNTgiIHk9IjEwODkuODciLz48ZWxsaXBzZSBjeD0iNTM3LjY2MTUiIGN5PSIxMTA1Ljg3IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik01NDAuNjMwMywxMTExLjUxMDYgUTU0MC4wNTIyLDExMTEuODA3NSA1MzkuNDExNSwxMTExLjk0ODEgUTUzOC43NzA5LDExMTIuMTA0NCA1MzguMDY3OCwxMTEyLjEwNDQgUTUzNS41Njc4LDExMTIuMTA0NCA1MzQuMjM5NywxMTEwLjQ2MzggUTUzMi45MjcyLDExMDguODA3NSA1MzIuOTI3MiwxMTA1LjY4MjUgUTUzMi45MjcyLDExMDIuNTU3NSA1MzQuMjM5NywxMTAwLjkwMTMgUTUzNS41Njc4LDEwOTkuMjQ1IDUzOC4wNjc4LDEwOTkuMjQ1IFE1MzguNzcwOSwxMDk5LjI0NSA1MzkuNDExNSwxMDk5LjQwMTMgUTU0MC4wNjc4LDEwOTkuNTU3NSA1NDAuNjMwMywxMDk5Ljg1NDQgTDU0MC42MzAzLDExMDIuNTczMSBRNTQwLjAwNTMsMTEwMS45OTUgNTM5LjQxMTUsMTEwMS43Mjk0IFE1MzguODE3OCwxMTAxLjQ0ODEgNTM4LjE5MjgsMTEwMS40NDgxIFE1MzYuODQ5LDExMDEuNDQ4MSA1MzYuMTYxNSwxMTAyLjUyNjMgUTUzNS40NzQsMTEwMy41ODg4IDUzNS40NzQsMTEwNS42ODI1IFE1MzUuNDc0LDExMDcuNzc2MyA1MzYuMTYxNSwxMTA4Ljg1NDQgUTUzNi44NDksMTEwOS45MTY5IDUzOC4xOTI4LDExMDkuOTE2OSBRNTM4LjgxNzgsMTEwOS45MTY5IDUzOS40MTE1LDExMDkuNjUxMyBRNTQwLjAwNTMsMTEwOS4zNyA1NDAuNjMwMywxMTA4Ljc5MTkgTDU0MC42MzAzLDExMTEuNTEwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0LjkyNTgiIHg9IjU1OC4xNjE1IiB5PSIxMTEwLjcxNjciPlVzZXJJZDwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0NDUuNTgiIHgyPSI2ODMuMTY4OSIgeTE9IjExMjEuODciIHkyPSIxMTIxLjg3Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iNDUyLjU4IiB5PSIxMTMyLjUxODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NC41OTU3IiB4PSI0NjQuNTgiIHk9IjExMzguODY1MSI+X3ZhbHVlOiBzdHJpbmc8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDQ1LjU4IiB4Mj0iNjgzLjE2ODkiIHkxPSIxMTQ2LjE2NjkiIHkyPSIxMTQ2LjE2NjkiLz48ZWxsaXBzZSBjeD0iNDU1LjU4IiBjeT0iMTE1OS44MTUzIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMTMuNTg4OSIgeD0iNDY0LjU4IiB5PSIxMTYzLjE2MiI+ZXF1YWxzKG90aGVyOiBVc2VySWQpOiBib29sZWFuPC90ZXh0PjwvZz48IS0tY2xhc3MgVXNlck5hbWUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iVXNlck5hbWUiIGRhdGEtc291cmNlLWxpbmU9IjM5IiBkYXRhLXVpZD0iZW50MDAwOCIgaWQ9ImVudGl0eV9Vc2VyTmFtZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI5Ni44OTA2IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzYuNjAyNSIgeD0iNzE5LjA4IiB5PSIxMDgxLjcyIi8+PGVsbGlwc2UgY3g9Ijc2Ni41MjQ4IiBjeT0iMTA5Ny43MiIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNzY5LjQ5MzYsMTEwMy4zNjA2IFE3NjguOTE1NCwxMTAzLjY1NzUgNzY4LjI3NDgsMTEwMy43OTgxIFE3NjcuNjM0MiwxMTAzLjk1NDQgNzY2LjkzMTEsMTEwMy45NTQ0IFE3NjQuNDMxMSwxMTAzLjk1NDQgNzYzLjEwMjksMTEwMi4zMTM4IFE3NjEuNzkwNCwxMTAwLjY1NzUgNzYxLjc5MDQsMTA5Ny41MzI1IFE3NjEuNzkwNCwxMDk0LjQwNzUgNzYzLjEwMjksMTA5Mi43NTEzIFE3NjQuNDMxMSwxMDkxLjA5NSA3NjYuOTMxMSwxMDkxLjA5NSBRNzY3LjYzNDIsMTA5MS4wOTUgNzY4LjI3NDgsMTA5MS4yNTEzIFE3NjguOTMxMSwxMDkxLjQwNzUgNzY5LjQ5MzYsMTA5MS43MDQ0IEw3NjkuNDkzNiwxMDk0LjQyMzEgUTc2OC44Njg2LDEwOTMuODQ1IDc2OC4yNzQ4LDEwOTMuNTc5NCBRNzY3LjY4MTEsMTA5My4yOTgxIDc2Ny4wNTYxLDEwOTMuMjk4MSBRNzY1LjcxMjMsMTA5My4yOTgxIDc2NS4wMjQ4LDEwOTQuMzc2MyBRNzY0LjMzNzMsMTA5NS40Mzg4IDc2NC4zMzczLDEwOTcuNTMyNSBRNzY0LjMzNzMsMTA5OS42MjYzIDc2NS4wMjQ4LDExMDAuNzA0NCBRNzY1LjcxMjMsMTEwMS43NjY5IDc2Ny4wNTYxLDExMDEuNzY2OSBRNzY3LjY4MTEsMTEwMS43NjY5IDc2OC4yNzQ4LDExMDEuNTAxMyBRNzY4Ljg2ODYsMTEwMS4yMiA3NjkuNDkzNiwxMTAwLjY0MTkgTDc2OS40OTM2LDExMDMuMzYwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjczLjIxMjkiIHg9Ijc4Ny4wMjQ4IiB5PSIxMTAyLjU2NjciPlVzZXJOYW1lPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjcyMC4wOCIgeDI9Ijg5NC42ODI1IiB5MT0iMTExMy43MiIgeTI9IjExMTMuNzIiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI3MjcuMDgiIHk9IjExMjQuMzY4NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS4wMTU2IiB4PSI3MzkuMDgiIHk9IjExMzAuNzE1MSI+X2ZpcnN0TmFtZTogc3RyaW5nPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjcyNy4wOCIgeT0iMTE0MC42NjUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIyLjkxMDIiIHg9IjczOS4wOCIgeT0iMTE0Ny4wMTIiPl9sYXN0TmFtZTogc3RyaW5nPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjcyMC4wOCIgeDI9Ijg5NC42ODI1IiB5MT0iMTE1NC4zMTM4IiB5Mj0iMTE1NC4zMTM4Ii8+PGVsbGlwc2UgY3g9IjczMC4wOCIgY3k9IjExNjcuOTYyMiIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUwLjYwMjUiIHg9IjczOS4wOCIgeT0iMTE3MS4zMDg5Ij5nZXQgZnVsbE5hbWUoKTogc3RyaW5nPC90ZXh0PjwvZz48IS0tY2xhc3MgUmVzZXJ2YXRpb25Vc2VDYXNlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IlJlc2VydmF0aW9uVXNlQ2FzZSIgZGF0YS1zb3VyY2UtbGluZT0iNDciIGRhdGEtdWlkPSJlbnQwMDEwIiBpZD0iZW50aXR5X1Jlc2VydmF0aW9uVXNlQ2FzZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI5Ni44OTA2IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2MTkuMzc5OSIgeD0iMjIwNy42OSIgeT0iODgzLjA5Ii8+PGVsbGlwc2UgY3g9IjI0NDEuMDc5MiIgY3k9Ijg5OS4wOSIgZmlsbD0iI0I0QTdFNSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMjQzNy4wMDEsODk0Ljg1NTYgTDI0MzcuMDAxLDg5Mi42OTk0IEwyNDQ0LjM5MTcsODkyLjY5OTQgTDI0NDQuMzkxNyw4OTQuODU1NiBMMjQ0MS45MjI5LDg5NC44NTU2IEwyNDQxLjkyMjksOTAyLjkzMzcgTDI0NDQuMzkxNyw5MDIuOTMzNyBMMjQ0NC4zOTE3LDkwNS4wOSBMMjQzNy4wMDEsOTA1LjA5IEwyNDM3LjAwMSw5MDIuOTMzNyBMMjQzOS40Njk4LDkwMi45MzM3IEwyNDM5LjQ2OTgsODk0Ljg1NTYgTDI0MzcuMDAxLDg5NC44NTU2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDQuMTAxNiIgeD0iMjQ2MS41NzkyIiB5PSI5MDMuOTM2NyI+UmVzZXJ2YXRpb25Vc2VDYXNlPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIyMDguNjkiIHgyPSIyODI2LjA2OTkiIHkxPSI5MTUuMDkiIHkyPSI5MTUuMDkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMjA4LjY5IiB4Mj0iMjgyNi4wNjk5IiB5MT0iOTIzLjA5IiB5Mj0iOTIzLjA5Ii8+PGVsbGlwc2UgY3g9IjIyMTguNjkiIGN5PSI5MzYuNzM4NCIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTkzLjM3OTkiIHg9IjIyMjcuNjkiIHk9Ijk0MC4wODUxIj5jcmVhdGVSZXNlcnZhdGlvbihjb21tYW5kOiBDcmVhdGVSZXNlcnZhdGlvbkNvbW1hbmQpOiBQcm9taXNlJmx0O1Jlc2VydmF0aW9uJmd0OzwvdGV4dD48ZWxsaXBzZSBjeD0iMjIxOC42OSIgY3k9Ijk1My4wMzUzIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0ODcuNzMwNSIgeD0iMjIyNy42OSIgeT0iOTU2LjM4MiI+ZmluZFJlc2VydmF0aW9ucyhxdWVyeTogUmVzZXJ2YXRpb25RdWVyeSk6IFByb21pc2UmbHQ7UmVzZXJ2YXRpb25bXSZndDs8L3RleHQ+PGVsbGlwc2UgY3g9IjIyMTguNjkiIGN5PSI5NjkuMzMyMiIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDM2LjgwMjciIHg9IjIyMjcuNjkiIHk9Ijk3Mi42Nzg5Ij5jYW5jZWxSZXNlcnZhdGlvbihpZDogbnVtYmVyLCB1c2VySWQ6IHN0cmluZyk6IFByb21pc2UmbHQ7dm9pZCZndDs8L3RleHQ+PC9nPjwhLS1jbGFzcyBSZXNlcnZhdGlvblJlcG9zaXRvcnktLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUmVzZXJ2YXRpb25SZXBvc2l0b3J5IiBkYXRhLXNvdXJjZS1saW5lPSI1MyIgZGF0YS11aWQ9ImVudDAwMTEiIGlkPSJlbnRpdHlfUmVzZXJ2YXRpb25SZXBvc2l0b3J5Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjExMy4xODc1IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1NjEuNDM4NSIgeD0iMTYxMS42NiIgeT0iODc0Ljk0Ii8+PGVsbGlwc2UgY3g9IjE4MDguNzUwMyIgY3k9Ijg5MC45NCIgZmlsbD0iI0I0QTdFNSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTgwNC42NzIyLDg4Ni43MDU2IEwxODA0LjY3MjIsODg0LjU0OTQgTDE4MTIuMDYyOCw4ODQuNTQ5NCBMMTgxMi4wNjI4LDg4Ni43MDU2IEwxODA5LjU5NDEsODg2LjcwNTYgTDE4MDkuNTk0MSw4OTQuNzgzNyBMMTgxMi4wNjI4LDg5NC43ODM3IEwxODEyLjA2MjgsODk2Ljk0IEwxODA0LjY3MjIsODk2Ljk0IEwxODA0LjY3MjIsODk0Ljc4MzcgTDE4MDcuMTQxLDg5NC43ODM3IEwxODA3LjE0MSw4ODYuNzA1NiBMMTgwNC42NzIyLDg4Ni43MDU2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTguNzU3OCIgeD0iMTgyOS4yNTAzIiB5PSI4OTUuNzg2NyI+UmVzZXJ2YXRpb25SZXBvc2l0b3J5PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE2MTIuNjYiIHgyPSIyMTcyLjA5ODUiIHkxPSI5MDYuOTQiIHkyPSI5MDYuOTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNjEyLjY2IiB4Mj0iMjE3Mi4wOTg1IiB5MT0iOTE0Ljk0IiB5Mj0iOTE0Ljk0Ii8+PGVsbGlwc2UgY3g9IjE2MjIuNjYiIGN5PSI5MjguNTg4NCIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzg4Ljc3MzQiIHg9IjE2MzEuNjYiIHk9IjkzMS45MzUxIj5zYXZlKHJlc2VydmF0aW9uOiBSZXNlcnZhdGlvbik6IFByb21pc2UmbHQ7UmVzZXJ2YXRpb24mZ3Q7PC90ZXh0PjxlbGxpcHNlIGN4PSIxNjIyLjY2IiBjeT0iOTQ0Ljg4NTMiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzNS40Mzg1IiB4PSIxNjMxLjY2IiB5PSI5NDguMjMyIj5maW5kQnlSb29tQW5kRGF0ZShyb29tSWQ6IFJvb21JZCwgZGF0ZTogRGF0ZSk6IFByb21pc2UmbHQ7UmVzZXJ2YXRpb25bXSZndDs8L3RleHQ+PGVsbGlwc2UgY3g9IjE2MjIuNjYiIGN5PSI5NjEuMTgyMiIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzU2LjY0NDUiIHg9IjE2MzEuNjYiIHk9Ijk2NC41Mjg5Ij5maW5kQnlJZChpZDogbnVtYmVyKTogUHJvbWlzZSZsdDtSZXNlcnZhdGlvbiB8IG51bGwmZ3Q7PC90ZXh0PjxlbGxpcHNlIGN4PSIxNjIyLjY2IiBjeT0iOTc3LjQ3OTEiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4MC45NzA3IiB4PSIxNjMxLjY2IiB5PSI5ODAuODI1NyI+ZGVsZXRlQnlJZChpZDogbnVtYmVyKTogUHJvbWlzZSZsdDt2b2lkJmd0OzwvdGV4dD48L2c+PCEtLWNsYXNzIFJlc2VydmFibGVSb29tUmVwb3NpdG9yeS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSZXNlcnZhYmxlUm9vbVJlcG9zaXRvcnkiIGRhdGEtc291cmNlLWxpbmU9IjYwIiBkYXRhLXVpZD0iZW50MDAxMiIgaWQ9ImVudGl0eV9SZXNlcnZhYmxlUm9vbVJlcG9zaXRvcnkiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iODAuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjEwLjIyNjYiIHg9Ijk2Ni4yNiIgeT0iODkxLjIzIi8+PGVsbGlwc2UgY3g9IjExNzAuMjEwMiIgY3k9IjkwNy4yMyIgZmlsbD0iI0I0QTdFNSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTE2Ni4xMzIxLDkwMi45OTU2IEwxMTY2LjEzMjEsOTAwLjgzOTQgTDExNzMuNTIyNyw5MDAuODM5NCBMMTE3My41MjI3LDkwMi45OTU2IEwxMTcxLjA1MzksOTAyLjk5NTYgTDExNzEuMDUzOSw5MTEuMDczNyBMMTE3My41MjI3LDkxMS4wNzM3IEwxMTczLjUyMjcsOTEzLjIzIEwxMTY2LjEzMjEsOTEzLjIzIEwxMTY2LjEzMjEsOTExLjA3MzcgTDExNjguNjAwOCw5MTEuMDczNyBMMTE2OC42MDA4LDkwMi45OTU2IEwxMTY2LjEzMjEsOTAyLjk5NTYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5My44MjYyIiB4PSIxMTkwLjcxMDIiIHk9IjkxMi4wNzY3Ij5SZXNlcnZhYmxlUm9vbVJlcG9zaXRvcnk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOTY3LjI2IiB4Mj0iMTU3NS40ODY2IiB5MT0iOTIzLjIzIiB5Mj0iOTIzLjIzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOTY3LjI2IiB4Mj0iMTU3NS40ODY2IiB5MT0iOTMxLjIzIiB5Mj0iOTMxLjIzIi8+PGVsbGlwc2UgY3g9Ijk3Ny4yNiIgY3k9Ijk0NC44Nzg0IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1ODQuMjI2NiIgeD0iOTg2LjI2IiB5PSI5NDguMjI1MSI+ZmluZEF2YWlsYWJsZVJvb20ocm9vbUlkOiBSb29tSWQsIGRhdGU6IERhdGUpOiBQcm9taXNlJmx0O1Jlc2VydmFibGVSb29tIHwgbnVsbCZndDs8L3RleHQ+PGVsbGlwc2UgY3g9Ijk3Ny4yNiIgY3k9Ijk2MS4xNzUzIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NjIuMDc1MiIgeD0iOTg2LjI2IiB5PSI5NjQuNTIyIj5maW5kQXZhaWxhYmxlUm9vbXNPbihkYXRlOiBEYXRlKTogUHJvbWlzZSZsdDtSZXNlcnZhYmxlUm9vbVtdJmd0OzwvdGV4dD48L2c+PCEtLWNsYXNzIFJlc2VydmF0aW9uU2VydmljZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSZXNlcnZhdGlvblNlcnZpY2UiIGRhdGEtc291cmNlLWxpbmU9IjY3IiBkYXRhLXVpZD0iZW50MDAxNCIgaWQ9ImVudGl0eV9SZXNlcnZhdGlvblNlcnZpY2UiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTI5LjQ4NDQiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjYxOS4zNzk5IiB4PSIxNTgyLjY5IiB5PSI2MDMuMjciLz48ZWxsaXBzZSBjeD0iMTgyMC40MTY2IiBjeT0iNjE5LjI3IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0xODIzLjM4NTMsNjI0LjkxMDYgUTE4MjIuODA3Miw2MjUuMjA3NSAxODIyLjE2NjYsNjI1LjM0ODEgUTE4MjEuNTI1OSw2MjUuNTA0NCAxODIwLjgyMjgsNjI1LjUwNDQgUTE4MTguMzIyOCw2MjUuNTA0NCAxODE2Ljk5NDcsNjIzLjg2MzcgUTE4MTUuNjgyMiw2MjIuMjA3NSAxODE1LjY4MjIsNjE5LjA4MjUgUTE4MTUuNjgyMiw2MTUuOTU3NSAxODE2Ljk5NDcsNjE0LjMwMTIgUTE4MTguMzIyOCw2MTIuNjQ1IDE4MjAuODIyOCw2MTIuNjQ1IFExODIxLjUyNTksNjEyLjY0NSAxODIyLjE2NjYsNjEyLjgwMTIgUTE4MjIuODIyOCw2MTIuOTU3NSAxODIzLjM4NTMsNjEzLjI1NDQgTDE4MjMuMzg1Myw2MTUuOTczMSBRMTgyMi43NjAzLDYxNS4zOTUgMTgyMi4xNjY2LDYxNS4xMjk0IFExODIxLjU3MjgsNjE0Ljg0ODEgMTgyMC45NDc4LDYxNC44NDgxIFExODE5LjYwNDEsNjE0Ljg0ODEgMTgxOC45MTY2LDYxNS45MjYyIFExODE4LjIyOTEsNjE2Ljk4ODcgMTgxOC4yMjkxLDYxOS4wODI1IFExODE4LjIyOTEsNjIxLjE3NjIgMTgxOC45MTY2LDYyMi4yNTQ0IFExODE5LjYwNDEsNjIzLjMxNjkgMTgyMC45NDc4LDYyMy4zMTY5IFExODIxLjU3MjgsNjIzLjMxNjkgMTgyMi4xNjY2LDYyMy4wNTEyIFExODIyLjc2MDMsNjIyLjc3IDE4MjMuMzg1Myw2MjIuMTkxOSBMMTgyMy4zODUzLDYyNC45MTA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM1LjQyNjgiIHg9IjE4NDAuOTE2NiIgeT0iNjI0LjExNjciPlJlc2VydmF0aW9uU2VydmljZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNTgzLjY5IiB4Mj0iMjIwMS4wNjk5IiB5MT0iNjM1LjI3IiB5Mj0iNjM1LjI3Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMTU5MC42OSIgeT0iNjQ1LjkxODQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMjIuNzEwOSIgeD0iMTYwMi42OSIgeT0iNjUyLjI2NTEiPnJlc2VydmF0aW9uUmVwb3NpdG9yeTogUmVzZXJ2YXRpb25SZXBvc2l0b3J5PC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjE1OTAuNjkiIHk9IjY2Mi4yMTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzE0LjU4OTgiIHg9IjE2MDIuNjkiIHk9IjY2OC41NjIiPnJvb21SZXBvc2l0b3J5OiBSZXNlcnZhYmxlUm9vbVJlcG9zaXRvcnk8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMTU5MC42OSIgeT0iNjc4LjUxMjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjEuNzU3OCIgeD0iMTYwMi42OSIgeT0iNjg0Ljg1ODkiPnVzZXJSZXBvc2l0b3J5OiBVc2VyUmVwb3NpdG9yeTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNTgzLjY5IiB4Mj0iMjIwMS4wNjk5IiB5MT0iNjkyLjE2MDYiIHkyPSI2OTIuMTYwNiIvPjxlbGxpcHNlIGN4PSIxNTkzLjY5IiBjeT0iNzA1LjgwOTEiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU5My4zNzk5IiB4PSIxNjAyLjY5IiB5PSI3MDkuMTU1NyI+Y3JlYXRlUmVzZXJ2YXRpb24oY29tbWFuZDogQ3JlYXRlUmVzZXJ2YXRpb25Db21tYW5kKTogUHJvbWlzZSZsdDtSZXNlcnZhdGlvbiZndDs8L3RleHQ+PGVsbGlwc2UgY3g9IjE1OTMuNjkiIGN5PSI3MjIuMTA1OSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDg3LjczMDUiIHg9IjE2MDIuNjkiIHk9IjcyNS40NTI2Ij5maW5kUmVzZXJ2YXRpb25zKHF1ZXJ5OiBSZXNlcnZhdGlvblF1ZXJ5KTogUHJvbWlzZSZsdDtSZXNlcnZhdGlvbltdJmd0OzwvdGV4dD48L2c+PCEtLWNsYXNzIFJlc2VydmF0aW9uQ29udHJvbGxlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSZXNlcnZhdGlvbkNvbnRyb2xsZXIiIGRhdGEtc291cmNlLWxpbmU9IjgwIiBkYXRhLXVpZD0iZW50MDAxNyIgaWQ9ImVudGl0eV9SZXNlcnZhdGlvbkNvbnRyb2xsZXIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTEzLjE4NzUiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ4MS45Mjk3IiB4PSI0NDIxLjQxIiB5PSIxMTYuNDUiLz48ZWxsaXBzZSBjeD0iNDU4MS42OTU2IiBjeT0iMTMyLjQ1IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00NTg0LjY2NDQsMTM4LjA5MDYgUTQ1ODQuMDg2MywxMzguMzg3NSA0NTgzLjQ0NTYsMTM4LjUyODEgUTQ1ODIuODA1LDEzOC42ODQ0IDQ1ODIuMTAxOSwxMzguNjg0NCBRNDU3OS42MDE5LDEzOC42ODQ0IDQ1NzguMjczOCwxMzcuMDQzNyBRNDU3Ni45NjEzLDEzNS4zODc1IDQ1NzYuOTYxMywxMzIuMjYyNSBRNDU3Ni45NjEzLDEyOS4xMzc1IDQ1NzguMjczOCwxMjcuNDgxMiBRNDU3OS42MDE5LDEyNS44MjUgNDU4Mi4xMDE5LDEyNS44MjUgUTQ1ODIuODA1LDEyNS44MjUgNDU4My40NDU2LDEyNS45ODEyIFE0NTg0LjEwMTksMTI2LjEzNzUgNDU4NC42NjQ0LDEyNi40MzQ0IEw0NTg0LjY2NDQsMTI5LjE1MzEgUTQ1ODQuMDM5NCwxMjguNTc1IDQ1ODMuNDQ1NiwxMjguMzA5NCBRNDU4Mi44NTE5LDEyOC4wMjgxIDQ1ODIuMjI2OSwxMjguMDI4MSBRNDU4MC44ODMxLDEyOC4wMjgxIDQ1ODAuMTk1NiwxMjkuMTA2MiBRNDU3OS41MDgxLDEzMC4xNjg3IDQ1NzkuNTA4MSwxMzIuMjYyNSBRNDU3OS41MDgxLDEzNC4zNTYyIDQ1ODAuMTk1NiwxMzUuNDM0NCBRNDU4MC44ODMxLDEzNi40OTY5IDQ1ODIuMjI2OSwxMzYuNDk2OSBRNDU4Mi44NTE5LDEzNi40OTY5IDQ1ODMuNDQ1NiwxMzYuMjMxMiBRNDU4NC4wMzk0LDEzNS45NSA0NTg0LjY2NDQsMTM1LjM3MTkgTDQ1ODQuNjY0NCwxMzguMDkwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Mi44NTg0IiB4PSI0NjAyLjE5NTYiIHk9IjEzNy4yOTY3Ij5SZXNlcnZhdGlvbkNvbnRyb2xsZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDQyMi40MSIgeDI9IjQ5MDIuMzM5NyIgeTE9IjE0OC40NSIgeTI9IjE0OC40NSIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjQ0MjkuNDEiIHk9IjE1OS4wOTg0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjkzLjM5ODQiIHg9IjQ0NDEuNDEiIHk9IjE2NS40NDUxIj5yZXNlcnZhdGlvblVzZUNhc2U6IFJlc2VydmF0aW9uVXNlQ2FzZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0NDIyLjQxIiB4Mj0iNDkwMi4zMzk3IiB5MT0iMTcyLjc0NjkiIHkyPSIxNzIuNzQ2OSIvPjxlbGxpcHNlIGN4PSI0NDMyLjQxIiBjeT0iMTg2LjM5NTMiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ1NS4zMjgxIiB4PSI0NDQxLjQxIiB5PSIxODkuNzQyIj5jcmVhdGVSZXNlcnZhdGlvbihyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlJmx0O3ZvaWQmZ3Q7PC90ZXh0PjxlbGxpcHNlIGN4PSI0NDMyLjQxIiBjeT0iMjAyLjY5MjIiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0MC44NjMzIiB4PSI0NDQxLjQxIiB5PSIyMDYuMDM4OSI+Z2V0UmVzZXJ2YXRpb25zKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSk6IFByb21pc2UmbHQ7dm9pZCZndDs8L3RleHQ+PGVsbGlwc2UgY3g9IjQ0MzIuNDEiIGN5PSIyMTguOTg5MSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDU1LjkyOTciIHg9IjQ0NDEuNDEiIHk9IjIyMi4zMzU3Ij5jYW5jZWxSZXNlcnZhdGlvbihyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlJmx0O3ZvaWQmZ3Q7PC90ZXh0PjwvZz48IS0tY2xhc3MgQ3JlYXRlUmVzZXJ2YXRpb25SZXF1ZXN0RHRvLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkNyZWF0ZVJlc2VydmF0aW9uUmVxdWVzdER0byIgZGF0YS1zb3VyY2UtbGluZT0iODciIGRhdGEtdWlkPSJlbnQwMDE4IiBpZD0iZW50aXR5X0NyZWF0ZVJlc2VydmF0aW9uUmVxdWVzdER0byI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMTMuMTg3NSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjQ0Ljg0MzgiIHg9IjQxNDEuOTYiIHk9IjExNi40NSIvPjxlbGxpcHNlIGN4PSI0MTU2Ljk2IiBjeT0iMTMyLjQ1IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00MTU5LjkyODgsMTM4LjA5MDYgUTQxNTkuMzUwNiwxMzguMzg3NSA0MTU4LjcxLDEzOC41MjgxIFE0MTU4LjA2OTQsMTM4LjY4NDQgNDE1Ny4zNjYzLDEzOC42ODQ0IFE0MTU0Ljg2NjMsMTM4LjY4NDQgNDE1My41MzgxLDEzNy4wNDM3IFE0MTUyLjIyNTYsMTM1LjM4NzUgNDE1Mi4yMjU2LDEzMi4yNjI1IFE0MTUyLjIyNTYsMTI5LjEzNzUgNDE1My41MzgxLDEyNy40ODEyIFE0MTU0Ljg2NjMsMTI1LjgyNSA0MTU3LjM2NjMsMTI1LjgyNSBRNDE1OC4wNjk0LDEyNS44MjUgNDE1OC43MSwxMjUuOTgxMiBRNDE1OS4zNjYzLDEyNi4xMzc1IDQxNTkuOTI4OCwxMjYuNDM0NCBMNDE1OS45Mjg4LDEyOS4xNTMxIFE0MTU5LjMwMzgsMTI4LjU3NSA0MTU4LjcxLDEyOC4zMDk0IFE0MTU4LjExNjMsMTI4LjAyODEgNDE1Ny40OTEzLDEyOC4wMjgxIFE0MTU2LjE0NzUsMTI4LjAyODEgNDE1NS40NiwxMjkuMTA2MiBRNDE1NC43NzI1LDEzMC4xNjg3IDQxNTQuNzcyNSwxMzIuMjYyNSBRNDE1NC43NzI1LDEzNC4zNTYyIDQxNTUuNDYsMTM1LjQzNDQgUTQxNTYuMTQ3NSwxMzYuNDk2OSA0MTU3LjQ5MTMsMTM2LjQ5NjkgUTQxNTguMTE2MywxMzYuNDk2OSA0MTU4LjcxLDEzNi4yMzEyIFE0MTU5LjMwMzgsMTM1Ljk1IDQxNTkuOTI4OCwxMzUuMzcxOSBMNDE1OS45Mjg4LDEzOC4wOTA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjEyLjg0MzgiIHg9IjQxNzAuOTYiIHk9IjEzNy4yOTY3Ij5DcmVhdGVSZXNlcnZhdGlvblJlcXVlc3REdG88L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDE0Mi45NiIgeDI9IjQzODUuODAzOCIgeTE9IjE0OC40NSIgeTI9IjE0OC40NSIvPjxlbGxpcHNlIGN4PSI0MTUyLjk2IiBjeT0iMTYyLjA5ODQiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMy4zNDY3IiB4PSI0MTYxLjk2IiB5PSIxNjUuNDQ1MSI+cm9vbUlkOiBudW1iZXI8L3RleHQ+PGVsbGlwc2UgY3g9IjQxNTIuOTYiIGN5PSIxNzguMzk1MyIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODAuOTIzOCIgeD0iNDE2MS45NiIgeT0iMTgxLjc0MiI+ZGF0ZTogc3RyaW5nPC90ZXh0PjxlbGxpcHNlIGN4PSI0MTUyLjk2IiBjeT0iMTk0LjY5MjIiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNi42NTUzIiB4PSI0MTYxLjk2IiB5PSIxOTguMDM4OSI+c3RhcnRUaW1lOiBzdHJpbmc8L3RleHQ+PGVsbGlwc2UgY3g9IjQxNTIuOTYiIGN5PSIyMTAuOTg5MSIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEwLjQyMDkiIHg9IjQxNjEuOTYiIHk9IjIxNC4zMzU3Ij5lbmRUaW1lOiBzdHJpbmc8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDE0Mi45NiIgeDI9IjQzODUuODAzOCIgeTE9IjIyMS42Mzc1IiB5Mj0iMjIxLjYzNzUiLz48L2c+PCEtLWNsYXNzIFJlc2VydmF0aW9uUmVzcG9uc2VEdG8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUmVzZXJ2YXRpb25SZXNwb25zZUR0byIgZGF0YS1zb3VyY2UtbGluZT0iOTQiIGRhdGEtdWlkPSJlbnQwMDE5IiBpZD0iZW50aXR5X1Jlc2VydmF0aW9uUmVzcG9uc2VEdG8iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTYyLjA3ODEiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjUyNS4xNDY1IiB4PSIzNTgxLjgiIHk9IjkyIi8+PGVsbGlwc2UgY3g9IjM3NTEuOTI5NCIgY3k9IjEwOCIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMzc1NC44OTgxLDExMy42NDA2IFEzNzU0LjMyLDExMy45Mzc1IDM3NTMuNjc5NCwxMTQuMDc4MSBRMzc1My4wMzg4LDExNC4yMzQ0IDM3NTIuMzM1NiwxMTQuMjM0NCBRMzc0OS44MzU2LDExNC4yMzQ0IDM3NDguNTA3NSwxMTIuNTkzOCBRMzc0Ny4xOTUsMTEwLjkzNzUgMzc0Ny4xOTUsMTA3LjgxMjUgUTM3NDcuMTk1LDEwNC42ODc1IDM3NDguNTA3NSwxMDMuMDMxMyBRMzc0OS44MzU2LDEwMS4zNzUgMzc1Mi4zMzU2LDEwMS4zNzUgUTM3NTMuMDM4OCwxMDEuMzc1IDM3NTMuNjc5NCwxMDEuNTMxMyBRMzc1NC4zMzU2LDEwMS42ODc1IDM3NTQuODk4MSwxMDEuOTg0NCBMMzc1NC44OTgxLDEwNC43MDMxIFEzNzU0LjI3MzEsMTA0LjEyNSAzNzUzLjY3OTQsMTAzLjg1OTQgUTM3NTMuMDg1NiwxMDMuNTc4MSAzNzUyLjQ2MDYsMTAzLjU3ODEgUTM3NTEuMTE2OSwxMDMuNTc4MSAzNzUwLjQyOTQsMTA0LjY1NjMgUTM3NDkuNzQxOSwxMDUuNzE4OCAzNzQ5Ljc0MTksMTA3LjgxMjUgUTM3NDkuNzQxOSwxMDkuOTA2MyAzNzUwLjQyOTQsMTEwLjk4NDQgUTM3NTEuMTE2OSwxMTIuMDQ2OSAzNzUyLjQ2MDYsMTEyLjA0NjkgUTM3NTMuMDg1NiwxMTIuMDQ2OSAzNzUzLjY3OTQsMTExLjc4MTMgUTM3NTQuMjczMSwxMTEuNSAzNzU0Ljg5ODEsMTEwLjkyMTkgTDM3NTQuODk4MSwxMTMuNjQwNiBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3Ni4zODc3IiB4PSIzNzcyLjQyOTQiIHk9IjExMi44NDY3Ij5SZXNlcnZhdGlvblJlc3BvbnNlRHRvPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM1ODIuOCIgeDI9IjQxMDUuOTQ2NSIgeTE9IjEyNCIgeTI9IjEyNCIvPjxlbGxpcHNlIGN4PSIzNTkyLjgiIGN5PSIxMzcuNjQ4NCIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzYuNTgzIiB4PSIzNjAxLjgiIHk9IjE0MC45OTUxIj5pZDogbnVtYmVyPC90ZXh0PjxlbGxpcHNlIGN4PSIzNTkyLjgiIGN5PSIxNTMuOTQ1MyIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEzLjM0NjciIHg9IjM2MDEuOCIgeT0iMTU3LjI5MiI+cm9vbUlkOiBudW1iZXI8L3RleHQ+PGVsbGlwc2UgY3g9IjM1OTIuOCIgY3k9IjE3MC4yNDIyIiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MC45MjM4IiB4PSIzNjAxLjgiIHk9IjE3My41ODg5Ij5kYXRlOiBzdHJpbmc8L3RleHQ+PGVsbGlwc2UgY3g9IjM1OTIuOCIgY3k9IjE4Ni41MzkxIiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuNjU1MyIgeD0iMzYwMS44IiB5PSIxODkuODg1NyI+c3RhcnRUaW1lOiBzdHJpbmc8L3RleHQ+PGVsbGlwc2UgY3g9IjM1OTIuOCIgY3k9IjIwMi44MzU5IiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAuNDIwOSIgeD0iMzYwMS44IiB5PSIyMDYuMTgyNiI+ZW5kVGltZTogc3RyaW5nPC90ZXh0PjxlbGxpcHNlIGN4PSIzNTkyLjgiIGN5PSIyMTkuMTMyOCIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTIuOTA3MiIgeD0iMzYwMS44IiB5PSIyMjIuNDc5NSI+dXNlcklkOiBzdHJpbmc8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzU4Mi44IiB4Mj0iNDEwNS45NDY1IiB5MT0iMjI5Ljc4MTMiIHkyPSIyMjkuNzgxMyIvPjxlbGxpcHNlIGN4PSIzNTkyLjgiIGN5PSIyNDMuNDI5NyIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDk5LjE0NjUiIHg9IjM2MDEuOCIgeT0iMjQ2Ljc3NjQiPnN0YXRpYyBmcm9tRG9tYWluKHJlc2VydmF0aW9uOiBSZXNlcnZhdGlvbik6IFJlc2VydmF0aW9uUmVzcG9uc2VEdG88L3RleHQ+PC9nPjwhLS1jbGFzcyBSZXNlcnZhdGlvblBlcnNpc3RlbmNlQWRhcHRlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSZXNlcnZhdGlvblBlcnNpc3RlbmNlQWRhcHRlciIgZGF0YS1zb3VyY2UtbGluZT0iMTA2IiBkYXRhLXVpZD0iZW50MDAyMSIgaWQ9ImVudGl0eV9SZXNlcnZhdGlvblBlcnNpc3RlbmNlQWRhcHRlciI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMjkuNDg0NCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTYxLjQzODUiIHg9IjI5NjMuNjYiIHk9IjEwOC4zIi8+PGVsbGlwc2UgY3g9IjMxMzAuMTA0OCIgY3k9IjEyNC4zIiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zMTMzLjA3MzYsMTI5Ljk0MDYgUTMxMzIuNDk1NCwxMzAuMjM3NSAzMTMxLjg1NDgsMTMwLjM3ODEgUTMxMzEuMjE0MiwxMzAuNTM0NCAzMTMwLjUxMTEsMTMwLjUzNDQgUTMxMjguMDExMSwxMzAuNTM0NCAzMTI2LjY4MjksMTI4Ljg5MzcgUTMxMjUuMzcwNCwxMjcuMjM3NSAzMTI1LjM3MDQsMTI0LjExMjUgUTMxMjUuMzcwNCwxMjAuOTg3NSAzMTI2LjY4MjksMTE5LjMzMTIgUTMxMjguMDExMSwxMTcuNjc1IDMxMzAuNTExMSwxMTcuNjc1IFEzMTMxLjIxNDIsMTE3LjY3NSAzMTMxLjg1NDgsMTE3LjgzMTIgUTMxMzIuNTExMSwxMTcuOTg3NSAzMTMzLjA3MzYsMTE4LjI4NDQgTDMxMzMuMDczNiwxMjEuMDAzMSBRMzEzMi40NDg2LDEyMC40MjUgMzEzMS44NTQ4LDEyMC4xNTk0IFEzMTMxLjI2MTEsMTE5Ljg3ODEgMzEzMC42MzYxLDExOS44NzgxIFEzMTI5LjI5MjMsMTE5Ljg3ODEgMzEyOC42MDQ4LDEyMC45NTYyIFEzMTI3LjkxNzMsMTIyLjAxODcgMzEyNy45MTczLDEyNC4xMTI1IFEzMTI3LjkxNzMsMTI2LjIwNjIgMzEyOC42MDQ4LDEyNy4yODQ0IFEzMTI5LjI5MjMsMTI4LjM0NjkgMzEzMC42MzYxLDEyOC4zNDY5IFEzMTMxLjI2MTEsMTI4LjM0NjkgMzEzMS44NTQ4LDEyOC4wODEyIFEzMTMyLjQ0ODYsMTI3LjggMzEzMy4wNzM2LDEyNy4yMjE5IEwzMTMzLjA3MzYsMTI5Ljk0MDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjAuMDQ4OCIgeD0iMzE1MC42MDQ4IiB5PSIxMjkuMTQ2NyI+UmVzZXJ2YXRpb25QZXJzaXN0ZW5jZUFkYXB0ZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjk2NC42NiIgeDI9IjM1MjQuMDk4NSIgeTE9IjE0MC4zIiB5Mj0iMTQwLjMiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOTcxLjY2IiB5PSIxNTAuOTQ4NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0NS4zMzg5IiB4PSIyOTgzLjY2IiB5PSIxNTcuMjk1MSI+cHJpc21hOiBQcmlzbWFDbGllbnQ8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMjk3MS42NiIgeT0iMTY3LjI0NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMDAuMDEyNyIgeD0iMjk4My42NiIgeT0iMTczLjU5MiI+bWFwcGVyOiBSZXNlcnZhdGlvbk1hcHBlcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyOTY0LjY2IiB4Mj0iMzUyNC4wOTg1IiB5MT0iMTgwLjg5MzciIHkyPSIxODAuODkzNyIvPjxlbGxpcHNlIGN4PSIyOTc0LjY2IiBjeT0iMTk0LjU0MjIiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM4OC43NzM0IiB4PSIyOTgzLjY2IiB5PSIxOTcuODg4OSI+c2F2ZShyZXNlcnZhdGlvbjogUmVzZXJ2YXRpb24pOiBQcm9taXNlJmx0O1Jlc2VydmF0aW9uJmd0OzwvdGV4dD48ZWxsaXBzZSBjeD0iMjk3NC42NiIgY3k9IjIxMC44MzkxIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MzUuNDM4NSIgeD0iMjk4My42NiIgeT0iMjE0LjE4NTciPmZpbmRCeVJvb21BbmREYXRlKHJvb21JZDogUm9vbUlkLCBkYXRlOiBEYXRlKTogUHJvbWlzZSZsdDtSZXNlcnZhdGlvbltdJmd0OzwvdGV4dD48ZWxsaXBzZSBjeD0iMjk3NC42NiIgY3k9IjIyNy4xMzU5IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNTYuNjQ0NSIgeD0iMjk4My42NiIgeT0iMjMwLjQ4MjYiPmZpbmRCeUlkKGlkOiBudW1iZXIpOiBQcm9taXNlJmx0O1Jlc2VydmF0aW9uIHwgbnVsbCZndDs8L3RleHQ+PC9nPjwhLS1jbGFzcyBSZXNlcnZhdGlvbk1hcHBlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSZXNlcnZhdGlvbk1hcHBlciIgZGF0YS1zb3VyY2UtbGluZT0iMTE0IiBkYXRhLXVpZD0iZW50MDAyMiIgaWQ9ImVudGl0eV9SZXNlcnZhdGlvbk1hcHBlciI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI4MC41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIzMzkuMDI0NCIgeD0iMjk2My44NiIgeT0iMzMzLjA4Ii8+PGVsbGlwc2UgY3g9IjMwNjAuODc5IiBjeT0iMzQ5LjA4IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zMDYzLjg0NzgsMzU0LjcyMDYgUTMwNjMuMjY5NywzNTUuMDE3NSAzMDYyLjYyOSwzNTUuMTU4MSBRMzA2MS45ODg0LDM1NS4zMTQ0IDMwNjEuMjg1MywzNTUuMzE0NCBRMzA1OC43ODUzLDM1NS4zMTQ0IDMwNTcuNDU3MiwzNTMuNjczNyBRMzA1Ni4xNDQ3LDM1Mi4wMTc1IDMwNTYuMTQ0NywzNDguODkyNSBRMzA1Ni4xNDQ3LDM0NS43Njc1IDMwNTcuNDU3MiwzNDQuMTExMiBRMzA1OC43ODUzLDM0Mi40NTUgMzA2MS4yODUzLDM0Mi40NTUgUTMwNjEuOTg4NCwzNDIuNDU1IDMwNjIuNjI5LDM0Mi42MTEyIFEzMDYzLjI4NTMsMzQyLjc2NzUgMzA2My44NDc4LDM0My4wNjQ0IEwzMDYzLjg0NzgsMzQ1Ljc4MzEgUTMwNjMuMjIyOCwzNDUuMjA1IDMwNjIuNjI5LDM0NC45Mzk0IFEzMDYyLjAzNTMsMzQ0LjY1ODEgMzA2MS40MTAzLDM0NC42NTgxIFEzMDYwLjA2NjUsMzQ0LjY1ODEgMzA1OS4zNzksMzQ1LjczNjIgUTMwNTguNjkxNSwzNDYuNzk4NyAzMDU4LjY5MTUsMzQ4Ljg5MjUgUTMwNTguNjkxNSwzNTAuOTg2MiAzMDU5LjM3OSwzNTIuMDY0NCBRMzA2MC4wNjY1LDM1My4xMjY5IDMwNjEuNDEwMywzNTMuMTI2OSBRMzA2Mi4wMzUzLDM1My4xMjY5IDMwNjIuNjI5LDM1Mi44NjEyIFEzMDYzLjIyMjgsMzUyLjU4IDMwNjMuODQ3OCwzNTIuMDAxOSBMMzA2My44NDc4LDM1NC43MjA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM2LjQ4NjMiIHg9IjMwODEuMzc5IiB5PSIzNTMuOTI2NyI+UmVzZXJ2YXRpb25NYXBwZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjk2NC44NiIgeDI9IjMzMDEuODg0NCIgeTE9IjM2NS4wOCIgeTI9IjM2NS4wOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI5NjQuODYiIHgyPSIzMzAxLjg4NDQiIHkxPSIzNzMuMDgiIHkyPSIzNzMuMDgiLz48ZWxsaXBzZSBjeD0iMjk3NC44NiIgY3k9IjM4Ni43Mjg0IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMTMuMDI0NCIgeD0iMjk4My44NiIgeT0iMzkwLjA3NTEiPnRvUGVyc2lzdGVuY2UocmVzZXJ2YXRpb246IFJlc2VydmF0aW9uKTogYW55PC90ZXh0PjxlbGxpcHNlIGN4PSIyOTc0Ljg2IiBjeT0iNDAzLjAyNTMiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzOC41OTQ3IiB4PSIyOTgzLjg2IiB5PSI0MDYuMzcyIj50b0RvbWFpbihkYXRhOiBhbnkpOiBSZXNlcnZhdGlvbjwvdGV4dD48L2c+PCEtLWNsYXNzIFByaXNtYUNsaWVudC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJQcmlzbWFDbGllbnQiIGRhdGEtc291cmNlLWxpbmU9IjExOSIgZGF0YS11aWQ9ImVudDAwMjMiIGlkPSJlbnRpdHlfUHJpc21hQ2xpZW50Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9Ijk2Ljg5MDYiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI5NC4wNzEzIiB4PSIzMDc5LjM0IiB5PSI2MTkuNTYiLz48ZWxsaXBzZSBjeD0iMzE3OC4wNjEyIiBjeT0iNjM1LjU2IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zMTgxLjAyOTksNjQxLjIwMDYgUTMxODAuNDUxOCw2NDEuNDk3NSAzMTc5LjgxMTIsNjQxLjYzODEgUTMxNzkuMTcwNiw2NDEuNzk0NCAzMTc4LjQ2NzQsNjQxLjc5NDQgUTMxNzUuOTY3NCw2NDEuNzk0NCAzMTc0LjYzOTMsNjQwLjE1MzggUTMxNzMuMzI2OCw2MzguNDk3NSAzMTczLjMyNjgsNjM1LjM3MjUgUTMxNzMuMzI2OCw2MzIuMjQ3NSAzMTc0LjYzOTMsNjMwLjU5MTMgUTMxNzUuOTY3NCw2MjguOTM1IDMxNzguNDY3NCw2MjguOTM1IFEzMTc5LjE3MDYsNjI4LjkzNSAzMTc5LjgxMTIsNjI5LjA5MTMgUTMxODAuNDY3NCw2MjkuMjQ3NSAzMTgxLjAyOTksNjI5LjU0NDQgTDMxODEuMDI5OSw2MzIuMjYzMSBRMzE4MC40MDQ5LDYzMS42ODUgMzE3OS44MTEyLDYzMS40MTk0IFEzMTc5LjIxNzQsNjMxLjEzODEgMzE3OC41OTI0LDYzMS4xMzgxIFEzMTc3LjI0ODcsNjMxLjEzODEgMzE3Ni41NjEyLDYzMi4yMTYzIFEzMTc1Ljg3MzcsNjMzLjI3ODggMzE3NS44NzM3LDYzNS4zNzI1IFEzMTc1Ljg3MzcsNjM3LjQ2NjMgMzE3Ni41NjEyLDYzOC41NDQ0IFEzMTc3LjI0ODcsNjM5LjYwNjkgMzE3OC41OTI0LDYzOS42MDY5IFEzMTc5LjIxNzQsNjM5LjYwNjkgMzE3OS44MTEyLDYzOS4zNDEzIFEzMTgwLjQwNDksNjM5LjA2IDMxODEuMDI5OSw2MzguNDgxOSBMMzE4MS4wMjk5LDY0MS4yMDA2IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODguMTI4OSIgeD0iMzE5OC41NjEyIiB5PSI2NDAuNDA2NyI+UHJpc21hQ2xpZW50PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMwODAuMzQiIHgyPSIzMzcyLjQxMTMiIHkxPSI2NTEuNTYiIHkyPSI2NTEuNTYiLz48ZWxsaXBzZSBjeD0iMzA5MC4zNCIgY3k9IjY2NS4yMDg0IiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMzYuMDMxMyIgeD0iMzA5OS4zNCIgeT0iNjY4LjU1NTEiPnJlc2VydmF0aW9uOiBSZXNlcnZhdGlvbkRlbGVnYXRlPC90ZXh0PjxlbGxpcHNlIGN4PSIzMDkwLjM0IiBjeT0iNjgxLjUwNTMiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNS4wNzgxIiB4PSIzMDk5LjM0IiB5PSI2ODQuODUyIj51c2VyOiBVc2VyRGVsZWdhdGU8L3RleHQ+PGVsbGlwc2UgY3g9IjMwOTAuMzQiIGN5PSI2OTcuODAyMiIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjY4LjA3MTMiIHg9IjMwOTkuMzQiIHk9IjcwMS4xNDg5Ij5tZWV0aW5nUm9vbTogTWVldGluZ1Jvb21EZWxlZ2F0ZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzMDgwLjM0IiB4Mj0iMzM3Mi40MTEzIiB5MT0iNzA4LjQ1MDYiIHkyPSI3MDguNDUwNiIvPjwvZz48IS0tY2xhc3MgUmVzZXJ2YWJsZVJvb20tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUmVzZXJ2YWJsZVJvb20iIGRhdGEtc291cmNlLWxpbmU9IjE0MSIgZGF0YS11aWQ9ImVudDAwMzUiIGlkPSJlbnRpdHlfUmVzZXJ2YWJsZVJvb20iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1MC43NTM5IiB4PSI3IiB5PSI5MDcuNTMiLz48ZWxsaXBzZSBjeD0iMjIiIGN5PSI5MjMuNTMiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTI0Ljk2ODgsOTI5LjE3MDYgUTI0LjM5MDYsOTI5LjQ2NzUgMjMuNzUsOTI5LjYwODEgUTIzLjEwOTQsOTI5Ljc2NDQgMjIuNDA2Myw5MjkuNzY0NCBRMTkuOTA2Myw5MjkuNzY0NCAxOC41NzgxLDkyOC4xMjM4IFExNy4yNjU2LDkyNi40Njc1IDE3LjI2NTYsOTIzLjM0MjUgUTE3LjI2NTYsOTIwLjIxNzUgMTguNTc4MSw5MTguNTYxMyBRMTkuOTA2Myw5MTYuOTA1IDIyLjQwNjMsOTE2LjkwNSBRMjMuMTA5NCw5MTYuOTA1IDIzLjc1LDkxNy4wNjEzIFEyNC40MDYzLDkxNy4yMTc1IDI0Ljk2ODgsOTE3LjUxNDQgTDI0Ljk2ODgsOTIwLjIzMzEgUTI0LjM0MzgsOTE5LjY1NSAyMy43NSw5MTkuMzg5NCBRMjMuMTU2Myw5MTkuMTA4MSAyMi41MzEzLDkxOS4xMDgxIFEyMS4xODc1LDkxOS4xMDgxIDIwLjUsOTIwLjE4NjMgUTE5LjgxMjUsOTIxLjI0ODggMTkuODEyNSw5MjMuMzQyNSBRMTkuODEyNSw5MjUuNDM2MyAyMC41LDkyNi41MTQ0IFEyMS4xODc1LDkyNy41NzY5IDIyLjUzMTMsOTI3LjU3NjkgUTIzLjE1NjMsOTI3LjU3NjkgMjMuNzUsOTI3LjMxMTMgUTI0LjM0MzgsOTI3LjAzIDI0Ljk2ODgsOTI2LjQ1MTkgTDI0Ljk2ODgsOTI5LjE3MDYgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTguNzUzOSIgeD0iMzYiIHk9IjkyOC4zNzY3Ij5SZXNlcnZhYmxlUm9vbTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4IiB4Mj0iMTU2Ljc1MzkiIHkxPSI5MzkuNTMiIHkyPSI5MzkuNTMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4IiB4Mj0iMTU2Ljc1MzkiIHkxPSI5NDcuNTMiIHkyPSI5NDcuNTMiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdNTjQxIiBkYXRhLXNvdXJjZS1saW5lPSIxNTIiIGRhdGEtdWlkPSJlbnQwMDQyIiBpZD0iZW50aXR5X0dNTjQxIj48cGF0aCBkPSJNMTA3LjM4LDM0NS42OCBMMTA3LjM4LDQwMS4wNzg0IEwyNzEuMzgwMiw0MDEuMDc4NCBMMjcxLjM4MDIsMzU1LjY4IEwyNjEuMzgwMiwzNDUuNjggTDEwNy4zOCwzNDUuNjgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yNjEuMzgwMiwzNDUuNjggTDI2MS4zODAyLDM1NS42OCBMMjcxLjM4MDIsMzU1LjY4IEwyNjEuMzgwMiwzNDUuNjgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuMDAwMiIgeD0iMTEzLjM4IiB5PSIzNjIuNzQ2OSI+JiMzMjAyMDsmIzMxODgzOyYjMTIzOTQ7JiMxMjQ5OTsmIzEyNDcyOyYjMTI0OTM7JiMxMjQ3MzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMTEzLjM4IiB5PSIzNzcuODc5NyI+JiMyMjgwNjsmIzM3MDk2OyYjMjUyMTY7JiMzNDg5OTsmIzEyMzk1OyYjMzg3NTA7JiMyMDM4MTsmIzIzMzg0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMTEzLjM4IiB5PSIzOTMuMDEyNSI+JiMzOTY0MDsmIzM2ODk1OyYjMTIzOTE7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7JiMyMTQ4NzsmIzMzMDIxOzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdNTjQ0IiBkYXRhLXNvdXJjZS1saW5lPSIxNTgiIGRhdGEtdWlkPSJlbnQwMDQ1IiBpZD0iZW50aXR5X0dNTjQ0Ij48cGF0aCBkPSJNNDk4My4zOCwzNDUuNjggTDQ5ODMuMzgsNDAxLjA3ODQgTDUxMjEuMzgwMSw0MDEuMDc4NCBMNTEyMS4zODAxLDM1NS42OCBMNTExMS4zODAxLDM0NS42OCBMNDk4My4zOCwzNDUuNjgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik01MTExLjM4MDEsMzQ1LjY4IEw1MTExLjM4MDEsMzU1LjY4IEw1MTIxLjM4MDEsMzU1LjY4IEw1MTExLjM4MDEsMzQ1LjY4IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjQ5ODkuMzgiIHk9IjM2Mi43NDY5Ij4mIzIyODA2OyYjMzcwOTY7JiMyNTIxNjsmIzM0ODk5OyYjMTIzOTg7JiMzNTQ0MzsmIzMyMDQ4OyYjMjM0NTU7JiMzNTAxMzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iNDk4OS4zOCIgeT0iMzc3Ljg3OTciPiYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMxMjM5NTsmIzIwMzgxOyYjMjMzODQ7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy4wMDAxIiB4PSI0OTg5LjM4IiB5PSIzOTMuMDEyNSI+JiMyNTIxNjsmIzM0ODk5OyYjMzAzNDA7JiMzODMwNjsmIzI0NTE1OyYjMjAxMDc7JiMxMjQzNDsmIzIwOTk4OyYjMzg2MjY7PC90ZXh0PjwvZz48IS0tbGluayBSZXNlcnZhdGlvbkNvbnRyb2xsZXIgdG8gUmVzZXJ2YXRpb25Vc2VDYXNlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlJlc2VydmF0aW9uQ29udHJvbGxlciIgZGF0YS1lbnRpdHktMj0iUmVzZXJ2YXRpb25Vc2VDYXNlIiBkYXRhLXNvdXJjZS1saW5lPSIxMjgiIGRhdGEtdWlkPSJsbmsyNCIgaWQ9ImxpbmtfUmVzZXJ2YXRpb25Db250cm9sbGVyX1Jlc2VydmF0aW9uVXNlQ2FzZSI+PHBhdGggY29kZUxpbmU9IjEyOCIgZD0iTTQ2MDQuMjIsMjMwLjA4IEM0NDcxLjg0LDM1My44MiA0MTMyLjY2LDY0OS43NiAzNzg3LjM4LDc4MC40NSBDMzYxNy40Myw4NDQuNzggMzE1MS41NzQ1LDg4Ny43Njg0IDI4MzMuMzg0NSw5MTAuNzE4NCIgZmlsbD0ibm9uZSIgaWQ9IlJlc2VydmF0aW9uQ29udHJvbGxlci10by1SZXNlcnZhdGlvblVzZUNhc2UiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI4MjcuNCw5MTEuMTUsMjgzNi42NjQ0LDkxNC40OTIyLDI4MzIuMzg3LDkxMC43OTAzLDI4MzYuMDg4OSw5MDYuNTEyOSwyODI3LjQsOTExLjE1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjkuNzgzMiIgeD0iNDM1My4xNSIgeT0iNDU2LjczNjkiPnVzZXM8L3RleHQ+PC9nPjwhLS1saW5rIFJlc2VydmF0aW9uU2VydmljZSB0byBSZXNlcnZhdGlvblVzZUNhc2UtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iUmVzZXJ2YXRpb25TZXJ2aWNlIiBkYXRhLWVudGl0eS0yPSJSZXNlcnZhdGlvblVzZUNhc2UiIGRhdGEtc291cmNlLWxpbmU9IjEyOSIgZGF0YS11aWQ9ImxuazI1IiBpZD0ibGlua19SZXNlcnZhdGlvblNlcnZpY2VfUmVzZXJ2YXRpb25Vc2VDYXNlIj48cGF0aCBjb2RlTGluZT0iMTI5IiBkPSJNMjA0NS42Nyw3MzMuMTUgQzIxNTYuMDgsNzc5LjM1IDIyODYuMDY0OCw4MzMuNzQyNiAyMzg2LjM1NDgsODc1LjcwMjYiIGZpbGw9Im5vbmUiIGlkPSJSZXNlcnZhdGlvblNlcnZpY2UtdG8tUmVzZXJ2YXRpb25Vc2VDYXNlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSIyNDAyLjk2LDg4Mi42NSwyMzg4LjY3MDYsODcwLjE2NzUsMjM4NC4wMzksODgxLjIzNzcsMjQwMi45Niw4ODIuNjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Ni45MDgyIiB4PSIyMjI0LjYyIiB5PSI4MDguNDA2OSI+aW1wbGVtZW50czwvdGV4dD48L2c+PCEtLWxpbmsgUmVzZXJ2YXRpb25TZXJ2aWNlIHRvIFJlc2VydmF0aW9uUmVwb3NpdG9yeS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJSZXNlcnZhdGlvblNlcnZpY2UiIGRhdGEtZW50aXR5LTI9IlJlc2VydmF0aW9uUmVwb3NpdG9yeSIgZGF0YS1zb3VyY2UtbGluZT0iMTMwIiBkYXRhLXVpZD0ibG5rMjYiIGlkPSJsaW5rX1Jlc2VydmF0aW9uU2VydmljZV9SZXNlcnZhdGlvblJlcG9zaXRvcnkiPjxwYXRoIGNvZGVMaW5lPSIxMzAiIGQ9Ik0xODkyLjM4LDczMi45OCBDMTg5Mi4zOCw3NzYuMzggMTg5Mi4zOCw4MjcuMiAxODkyLjM4LDg2OC43NiIgZmlsbD0ibm9uZSIgaWQ9IlJlc2VydmF0aW9uU2VydmljZS10by1SZXNlcnZhdGlvblJlcG9zaXRvcnkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE4OTIuMzgsODc0Ljc2LDE4OTYuMzgsODY1Ljc2LDE4OTIuMzgsODY5Ljc2LDE4ODguMzgsODY1Ljc2LDE4OTIuMzgsODc0Ljc2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjkuNzgzMiIgeD0iMTg5My4zOCIgeT0iODA4LjQwNjkiPnVzZXM8L3RleHQ+PC9nPjwhLS1saW5rIFJlc2VydmF0aW9uU2VydmljZSB0byBSZXNlcnZhYmxlUm9vbVJlcG9zaXRvcnktLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iUmVzZXJ2YXRpb25TZXJ2aWNlIiBkYXRhLWVudGl0eS0yPSJSZXNlcnZhYmxlUm9vbVJlcG9zaXRvcnkiIGRhdGEtc291cmNlLWxpbmU9IjEzMSIgZGF0YS11aWQ9ImxuazI3IiBpZD0ibGlua19SZXNlcnZhdGlvblNlcnZpY2VfUmVzZXJ2YWJsZVJvb21SZXBvc2l0b3J5Ij48cGF0aCBjb2RlTGluZT0iMTMxIiBkPSJNMTc0MC4wNyw3MzMuMTUgQzE2MjMsNzgyLjQ1IDE0NzAuNTI5Niw4NDYuNjYxMyAxMzcxLjE3OTYsODg4LjUwMTMiIGZpbGw9Im5vbmUiIGlkPSJSZXNlcnZhdGlvblNlcnZpY2UtdG8tUmVzZXJ2YWJsZVJvb21SZXBvc2l0b3J5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzY1LjY1LDg5MC44MywxMzc1LjQ5Nyw4OTEuMDIzMywxMzcwLjI1OCw4ODguODg5NCwxMzcyLjM5Miw4ODMuNjUwNSwxMzY1LjY1LDg5MC44MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI5Ljc4MzIiIHg9IjE1ODIuODgiIHk9IjgwOC40MDY5Ij51c2VzPC90ZXh0PjwvZz48IS0tbGluayBSZXNlcnZhdGlvblBlcnNpc3RlbmNlQWRhcHRlciB0byBSZXNlcnZhdGlvblJlcG9zaXRvcnktLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iUmVzZXJ2YXRpb25QZXJzaXN0ZW5jZUFkYXB0ZXIiIGRhdGEtZW50aXR5LTI9IlJlc2VydmF0aW9uUmVwb3NpdG9yeSIgZGF0YS1zb3VyY2UtbGluZT0iMTMyIiBkYXRhLXVpZD0ibG5rMjgiIGlkPSJsaW5rX1Jlc2VydmF0aW9uUGVyc2lzdGVuY2VBZGFwdGVyX1Jlc2VydmF0aW9uUmVwb3NpdG9yeSI+PHBhdGggY29kZUxpbmU9IjEzMiIgZD0iTTMzMDMuOTQsMjM4LjEyIEMzMzI2LjQsMjY1LjUyIDMzNTAuMTcsMjk5LjAyIDMzNjUuMzgsMzMzLjA4IEMzNDQ2LjU4LDUxNC45NCAzNTI5LjE2LDYzNi42NCAzMzkxLjM4LDc4MC40NSBDMzM0NS4xOCw4MjguNjggMjI1Ni4wNyw4MTkuOSAyMTkwLjM4LDgzMS45NCBDMjEzOC42NSw4NDEuNDEgMjEwMC42MDMzLDg1MS45MTE0IDIwNTIuMDUzMyw4NjguNTkxNCIgZmlsbD0ibm9uZSIgaWQ9IlJlc2VydmF0aW9uUGVyc2lzdGVuY2VBZGFwdGVyLXRvLVJlc2VydmF0aW9uUmVwb3NpdG9yeSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iMjAzNS4wMyw4NzQuNDQsMjA1NC4wMDI5LDg3NC4yNjU5LDIwNTAuMTAzOCw4NjIuOTE3LDIwMzUuMDMsODc0LjQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzYuOTA4MiIgeD0iMzQyMy4yOCIgeT0iNDU2LjczNjkiPmltcGxlbWVudHM8L3RleHQ+PC9nPjwhLS1saW5rIFJlc2VydmF0aW9uUGVyc2lzdGVuY2VBZGFwdGVyIHRvIFByaXNtYUNsaWVudC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJSZXNlcnZhdGlvblBlcnNpc3RlbmNlQWRhcHRlciIgZGF0YS1lbnRpdHktMj0iUHJpc21hQ2xpZW50IiBkYXRhLXNvdXJjZS1saW5lPSIxMzMiIGRhdGEtdWlkPSJsbmsyOSIgaWQ9ImxpbmtfUmVzZXJ2YXRpb25QZXJzaXN0ZW5jZUFkYXB0ZXJfUHJpc21hQ2xpZW50Ij48cGF0aCBjb2RlTGluZT0iMTMzIiBkPSJNMzI4My4wOCwyMzguMTkgQzMyOTcuODYsMjY2LjI3IDMzMTIuOTQsMzAwLjI1IDMzMjAuMzgsMzMzLjA4IEMzMzQzLjc0LDQzNi4xNiAzMjkzLjc4NzMsNTQ5LjU5NTkgMzI1OC4yNDczLDYxNC4wNDU5IiBmaWxsPSJub25lIiBpZD0iUmVzZXJ2YXRpb25QZXJzaXN0ZW5jZUFkYXB0ZXItdG8tUHJpc21hQ2xpZW50IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMjU1LjM1LDYxOS4zLDMyNjMuMTk4Nyw2MTMuMzUwNCwzMjU3Ljc2NDQsNjE0LjkyMTYsMzI1Ni4xOTMyLDYwOS40ODczLDMyNTUuMzUsNjE5LjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOS43ODMyIiB4PSIzMzI3LjE0IiB5PSIzNzcuOTQ2OSI+dXNlczwvdGV4dD48L2c+PCEtLWxpbmsgUmVzZXJ2YXRpb25QZXJzaXN0ZW5jZUFkYXB0ZXIgdG8gUmVzZXJ2YXRpb25NYXBwZXItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iUmVzZXJ2YXRpb25QZXJzaXN0ZW5jZUFkYXB0ZXIiIGRhdGEtZW50aXR5LTI9IlJlc2VydmF0aW9uTWFwcGVyIiBkYXRhLXNvdXJjZS1saW5lPSIxMzQiIGRhdGEtdWlkPSJsbmszMCIgaWQ9ImxpbmtfUmVzZXJ2YXRpb25QZXJzaXN0ZW5jZUFkYXB0ZXJfUmVzZXJ2YXRpb25NYXBwZXIiPjxwYXRoIGNvZGVMaW5lPSIxMzQiIGQ9Ik0zMjA4LjQ5LDIzOC4xNiBDMzE5MS4wNywyNjkuMjggMzE3My42MzEzLDMwMC40NTQ4IDMxNTguNDkxMywzMjcuNDk0OCIgZmlsbD0ibm9uZSIgaWQ9IlJlc2VydmF0aW9uUGVyc2lzdGVuY2VBZGFwdGVyLXRvLVJlc2VydmF0aW9uTWFwcGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMTU1LjU2LDMzMi43MywzMTYzLjQ0NzEsMzI2LjgzMTMsMzE1OC4wMDI3LDMyOC4zNjczLDMxNTYuNDY2NywzMjIuOTIzLDMxNTUuNTYsMzMyLjczIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjkuNzgzMiIgeD0iMzE3OS45MyIgeT0iMjk5LjE0NjkiPnVzZXM8L3RleHQ+PC9nPjwhLS1yZXZlcnNlIGxpbmsgUmVzZXJ2YXRpb24gdG8gUmVzZXJ2YXRpb25UaW1lU2xvdC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJSZXNlcnZhdGlvbiIgZGF0YS1lbnRpdHktMj0iUmVzZXJ2YXRpb25UaW1lU2xvdCIgZGF0YS1zb3VyY2UtbGluZT0iMTM3IiBkYXRhLXVpZD0ibG5rMzEiIGlkPSJsaW5rX1Jlc2VydmF0aW9uX1Jlc2VydmF0aW9uVGltZVNsb3QiPjxwYXRoIGNvZGVMaW5lPSIxMzciIGQ9Ik02MjAuMTg2NCw3NzIuODU4NSBDNTcxLjM5NjQsODA5LjUxODUgNTI3LjA4LDg0Mi44MyA0ODQuOSw4NzQuNTIiIGZpbGw9Im5vbmUiIGlkPSJSZXNlcnZhdGlvbi1iYWNrdG8tUmVzZXJ2YXRpb25UaW1lU2xvdCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjI5Ljc4LDc2NS42NSw2MjIuNTgwNCw3NjYuMDU2NCw2MjAuMTg2NCw3NzIuODU4NSw2MjcuMzg2LDc3Mi40NTIxLDYyOS43OCw3NjUuNjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBSZXNlcnZhdGlvbiB0byBVc2VyLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlJlc2VydmF0aW9uIiBkYXRhLWVudGl0eS0yPSJVc2VyIiBkYXRhLXNvdXJjZS1saW5lPSIxMzgiIGRhdGEtdWlkPSJsbmszMiIgaWQ9ImxpbmtfUmVzZXJ2YXRpb25fVXNlciI+PHBhdGggY29kZUxpbmU9IjEzOCIgZD0iTTc2MC44NjgxLDc3Ny42NDY4IEM3NjEuNDQ4MSw4MDIuNjY2OCA3NjEuNzgsODE3LjQ5IDc2Mi4zNSw4NDIuMDgiIGZpbGw9Im5vbmUiIGlkPSJSZXNlcnZhdGlvbi1iYWNrdG8tVXNlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNzYwLjU5LDc2NS42NSw3NTYuNzMwMSw3NzEuNzQxMSw3NjAuODY4MSw3NzcuNjQ2OCw3NjQuNzI4LDc3MS41NTU3LDc2MC41OSw3NjUuNjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBVc2VyIHRvIFVzZXJJZC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJVc2VyIiBkYXRhLWVudGl0eS0yPSJVc2VySWQiIGRhdGEtc291cmNlLWxpbmU9IjEzOSIgZGF0YS11aWQ9ImxuazMzIiBpZD0ibGlua19Vc2VyX1VzZXJJZCI+PHBhdGggY29kZUxpbmU9IjEzOSIgZD0iTTY2NS43NjMsMTAyOS40ODMgQzY0MS40MDMsMTA1My40MzMgNjI0LjgsMTA2OS43NiA2MDQuNywxMDg5LjUyIiBmaWxsPSJub25lIiBpZD0iVXNlci1iYWNrdG8tVXNlcklkIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NzQuMzIsMTAyMS4wNyw2NjcuMjM3MiwxMDIyLjQyNDIsNjY1Ljc2MywxMDI5LjQ4Myw2NzIuODQ1OCwxMDI4LjEyODgsNjc0LjMyLDEwMjEuMDciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBVc2VyIHRvIFVzZXJOYW1lLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlVzZXIiIGRhdGEtZW50aXR5LTI9IlVzZXJOYW1lIiBkYXRhLXNvdXJjZS1saW5lPSIxNDAiIGRhdGEtdWlkPSJsbmszNCIgaWQ9ImxpbmtfVXNlcl9Vc2VyTmFtZSI+PHBhdGggY29kZUxpbmU9IjE0MCIgZD0iTTc4Ni4zMDU1LDEwMzIuNzkyNSBDNzkwLjg1NTUsMTA1My41ODI1IDc5Mi45NiwxMDYzLjI1IDc5Ni45NCwxMDgxLjQ1IiBmaWxsPSJub25lIiBpZD0iVXNlci1iYWNrdG8tVXNlck5hbWUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc4My43NCwxMDIxLjA3LDc4MS4xMTUzLDEwMjcuNzg2NSw3ODYuMzA1NSwxMDMyLjc5MjUsNzg4LjkzMDMsMTAyNi4wNzYxLDc4My43NCwxMDIxLjA3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIFJlc2VydmF0aW9uIHRvIFJlc2VydmFibGVSb29tLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlJlc2VydmF0aW9uIiBkYXRhLWVudGl0eS0yPSJSZXNlcnZhYmxlUm9vbSIgZGF0YS1zb3VyY2UtbGluZT0iMTQxIiBkYXRhLXVpZD0ibG5rMzYiIGlkPSJsaW5rX1Jlc2VydmF0aW9uX1Jlc2VydmFibGVSb29tIj48cGF0aCBjb2RlTGluZT0iMTQxIiBkPSJNNjMzLjY0LDc2NS42NyBDNjIzLjM4LDc3MS4yNiA2MTIuOSw3NzYuMjggNjAyLjM4LDc4MC40NSBDNDQzLjUyLDg0My40MSAzODAuMzQsNzY5LjI1IDIyMS4zOCw4MzEuOTQgQzE3Ny4wNiw4NDkuNDEgMTM4LjAwMzUsODc5LjkyNCAxMTEuNzgzNSw5MDMuMTI0IiBmaWxsPSJub25lIiBpZD0iUmVzZXJ2YXRpb24tdG8tUmVzZXJ2YWJsZVJvb20iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwNy4yOSw5MDcuMSwxMTYuNjgwOSw5MDQuMTMxNywxMTEuMDM0Niw5MDMuNzg2NywxMTEuMzc5Niw4OTguMTQwNCwxMDcuMjksOTA3LjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgUmVzZXJ2YXRpb25SZXNwb25zZUR0byB0byBSZXNlcnZhdGlvbi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJSZXNlcnZhdGlvblJlc3BvbnNlRHRvIiBkYXRhLWVudGl0eS0yPSJSZXNlcnZhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iMTQ0IiBkYXRhLXVpZD0ibG5rMzciIGlkPSJsaW5rX1Jlc2VydmF0aW9uUmVzcG9uc2VEdG9fUmVzZXJ2YXRpb24iPjxwYXRoIGNvZGVMaW5lPSIxNDQiIGQ9Ik0zNjM4LjAzLDI1NC41NiBDMzYwNi4wOSwyNjQuMTkgMzU3My4xNiwyNzIuNTUgMzU0MS4zOCwyNzguMDggQzM0NzYuMzUsMjg5LjM4IDMwMTMuMjQsMjgxLjY3IDI5NDcuMzgsMjg2LjA4IEMyMzY0LjQ3LDMyNS4wOSAyMjE2Ljc1LDMzNi44OCAxNjQyLjM4LDQ0My42NyBDMTM4Mi40OCw0OTEuOTkgMTA5MS4yNDkzLDU3MC42NjIyIDkxNi4xNDkzLDYyMC42NzIyIiBmaWxsPSJub25lIiBpZD0iUmVzZXJ2YXRpb25SZXNwb25zZUR0by10by1SZXNlcnZhdGlvbiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTEwLjM4LDYyMi4zMiw5MjAuMTMyNSw2MjMuNjk0Niw5MTUuMTg3OCw2MjAuOTQ2OSw5MTcuOTM1NSw2MTYuMDAyMiw5MTAuMzgsNjIyLjMyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTYuMjQ2NiIgeD0iMjM0MS4yIiB5PSIzNzcuOTQ2OSI+Y29udmVydHM8L3RleHQ+PC9nPjwhLS1saW5rIENyZWF0ZVJlc2VydmF0aW9uUmVxdWVzdER0byB0byBSZXNlcnZhdGlvblVzZUNhc2UtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQ3JlYXRlUmVzZXJ2YXRpb25SZXF1ZXN0RHRvIiBkYXRhLWVudGl0eS0yPSJSZXNlcnZhdGlvblVzZUNhc2UiIGRhdGEtc291cmNlLWxpbmU9IjE0NSIgZGF0YS11aWQ9ImxuazM4IiBpZD0ibGlua19DcmVhdGVSZXNlcnZhdGlvblJlcXVlc3REdG9fUmVzZXJ2YXRpb25Vc2VDYXNlIj48cGF0aCBjb2RlTGluZT0iMTQ1IiBkPSJNNDIxNy44NSwyMzAuMDcgQzQxMTIuMDgsMzUzLjEyIDM4MzkuNTgsNjQ2LjY3IDM1NDEuMzgsNzgwLjQ1IEMzNDE3LjA5LDgzNi4yMSAzMDg2Ljc4MDQsODc3Ljk3NSAyODMzLjIzMDQsOTAzLjI0NSIgZmlsbD0ibm9uZSIgaWQ9IkNyZWF0ZVJlc2VydmF0aW9uUmVxdWVzdER0by10by1SZXNlcnZhdGlvblVzZUNhc2UiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI4MjcuMjYsOTAzLjg0LDI4MzYuNjEyMyw5MDYuOTI3NywyODMyLjIzNTQsOTAzLjM0NDEsMjgzNS44MTg5LDg5OC45NjcyLDI4MjcuMjYsOTAzLjg0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTAuNjIyNiIgeD0iNDAwOS4zNyIgeT0iNDU2LjczNjkiPmlucHV0IHRvPC90ZXh0PjwvZz48IS0tbGluayBSZXNlcnZhdGlvbk1hcHBlciB0byBSZXNlcnZhdGlvbi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJSZXNlcnZhdGlvbk1hcHBlciIgZGF0YS1lbnRpdHktMj0iUmVzZXJ2YXRpb24iIGRhdGEtc291cmNlLWxpbmU9IjE0OCIgZGF0YS11aWQ9ImxuazM5IiBpZD0ibGlua19SZXNlcnZhdGlvbk1hcHBlcl9SZXNlcnZhdGlvbiI+PHBhdGggY29kZUxpbmU9IjE0OCIgZD0iTTI5NjMuNjMsMzc0LjU5IEMyNjc0Ljk0LDM3Ny4xNyAyMDcwLjYxLDM5Mi4yNiAxNTY2LjM4LDQ2OC42NyBDMTMzNC40OSw1MDMuODIgMTA3Ny40NjI1LDU3Mi40OTg1IDkxNi4yNjI1LDYxOS4yNTg1IiBmaWxsPSJub25lIiBpZD0iUmVzZXJ2YXRpb25NYXBwZXItdG8tUmVzZXJ2YXRpb24iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjkxMC41LDYyMC45Myw5MjAuMjU4MSw2MjIuMjY0Myw5MTUuMzAyMSw2MTkuNTM3LDkxOC4wMjkzLDYxNC41ODEsOTEwLjUsNjIwLjkzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzUuNjU0OCIgeD0iMTczNS45OSIgeT0iNDU2LjczNjkiPm1hcHM8L3RleHQ+PC9nPjwhLS1saW5rIFJlc2VydmF0aW9uTWFwcGVyIHRvIFByaXNtYUNsaWVudC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJSZXNlcnZhdGlvbk1hcHBlciIgZGF0YS1lbnRpdHktMj0iUHJpc21hQ2xpZW50IiBkYXRhLXNvdXJjZS1saW5lPSIxNDkiIGRhdGEtdWlkPSJsbms0MCIgaWQ9ImxpbmtfUmVzZXJ2YXRpb25NYXBwZXJfUHJpc21hQ2xpZW50Ij48cGF0aCBjb2RlTGluZT0iMTQ5IiBkPSJNMzE0Ni4wMiw0MTQuMTUgQzMxNjIuOTUsNDY3LjQzIDMxOTEuMTUyMSw1NTYuMTkyIDMyMDkuMzIyMSw2MTMuMzQyIiBmaWxsPSJub25lIiBpZD0iUmVzZXJ2YXRpb25NYXBwZXItdG8tUHJpc21hQ2xpZW50IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMjExLjE0LDYxOS4wNiwzMjEyLjIyNTEsNjA5LjI3MTEsMzIwOS42MjUsNjE0LjI5NSwzMjA0LjYwMTEsNjExLjY5NSwzMjExLjE0LDYxOS4wNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ3Ljk2OTIiIHg9IjMxNTkuMzIiIHk9IjQ1Ni43MzY5Ij5mcm9tL3RvPC90ZXh0PjwvZz48IS0tbGluayBHTU40MSB0byBBcHBsaWNhdGlvbiBDb3JlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkdNTjQxIiBkYXRhLWVudGl0eS0yPSJBcHBsaWNhdGlvbiBDb3JlIiBkYXRhLXNvdXJjZS1saW5lPSIxNTIiIGRhdGEtdWlkPSJsbms0MyIgaWQ9ImxpbmtfR01ONDFfQXBwbGljYXRpb24gQ29yZSI+PHBhdGggZD0iTTE4OS4zOCw0MDEuMzggQzE4OS4zOCw0MTkuMjA3NSAxODkuMzgsNDQ0LjM0NzUgMTg5LjM4LDQ3Mi4xMjEyIEMxODkuMzgsNDc1LjU5MyAxODkuMzgsNDc5LjEwNTggMTg5LjM4LDQ4Mi42NTA3IEMxODkuMzgsNDgzLjA5MzggMTg5LjM4LDQ4My41Mzc0IDE4OS4zOCw0ODMuOTgxNSIgZmlsbD0ibm9uZSIgaWQ9IkdNTjQxLUFwcGxpY2F0aW9uIENvcmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48L2c+PCEtLWxpbmsgSW5mcmFzdHJ1Y3R1cmUgdG8gR01ONDQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iSW5mcmFzdHJ1Y3R1cmUiIGRhdGEtZW50aXR5LTI9IkdNTjQ0IiBkYXRhLXNvdXJjZS1saW5lPSIxNTgiIGRhdGEtdWlkPSJsbms0NiIgaWQ9ImxpbmtfSW5mcmFzdHJ1Y3R1cmVfR01ONDQiPjxwYXRoIGQ9Ik00OTU5LjUzODIsMTkwLjA2NTUgQzQ5NTkuNzA5NiwxOTAuNDAyMSA0OTU5Ljg4MzIsMTkwLjc0MzIgNDk2MC4wNTkyLDE5MS4wODg3IEM0OTYwLjc2MjksMTkyLjQ3MDcgNDk2MS41MDIzLDE5My45MjI5IDQ5NjIuMjc1LDE5NS40NDAzIEM0OTY4LjQ1NjIsMjA3LjU3OTQgNDk3Ni43NiwyMjMuODg2MiA0OTg1LjgzNSwyNDEuNzA3NSBDNTAwMy45ODUsMjc3LjM1IDUwMjUuMjIsMzE5LjA1IDUwMzguNzMsMzQ1LjU4IiBmaWxsPSJub25lIiBpZD0iSW5mcmFzdHJ1Y3R1cmUtR01ONDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48L2c+PCEtLVNSQz1bckxUUlJuRDc1N3hWTng3WWZRUDl0N1VoU2ZLdTNfTDNJNmYwRjVITERUYVRYcjV0UHBPcGlxT01IMkJVNWE1SFhMR0dHYU0wZTk1d0lSY2U4Rk1ZamxvT1pLZHlCdGZjVGpWVW93b1JJN3MwNXpqcHZib19TdmRaMDNiVmUycmlkcmVFMGV5dUkxOTZ4R3haLTlIenNSQTJ4N1FMLU9YR1V1c3ZzMUZnb2w2RzQ3T0YyeW03WVQxYlF5ZC1kQldWak1tUS1ma09nd0NhRlp4aENUZEFTdnZCWU9nMUMtUEZCcFN6dDhFcGVlVDBRRGRkdVREUWlEYTBTbXk1M0lPbEFjZkVyVWNNbFNjT1huNDVEV1ZINVRuMXJDNlVYenNMT01FY2ZDMTduMEtZQm5BdzRXZjJpSDBWaXYyQkhlNTVJNTNsczB4N0lFOTZpemF5TkowQjc5VDBIVFRqNDNTQmp5SW5PcktYb1c5RmUwOFJOMmZJb3J1NUF1ZzRnUGlacDBpeUtyTm02Yy03bzFGN3V2eHdmLTM5U2ZVMHJOTkxZSUJiWTNnVldMLUE0VzN4OVNRMVFvRnpiTUpHMHh1VVY2ZS0xVS1vd25EUTExRzI4VnJYOWpTOEZBWWM1aTNDMlRzUTRxQ2JUd1I0dzJlZm5ERHJhdVc2bzBqblBpUWVsRWxNT1FBWUlSSnEySFZvWjhPWnJHSDR1MmxJNWttakJFci13N2NBaEE5RkJ0UUt0Y2FaUkowa1RHQ0hBWjdsOG1WZDRtTTZFcVdla21qZlpCZEJYaUR5N3I3MGxyRS13WUd0TzdJM0N2eThfNjdraVd0QS1lSXdFUDllUjhVTzNtajV5ZWNZYzNMeS1iYXh3SXplaFJuM2ktZlZqNEVEUFl3ZGNQdTE4c3ZST00yQ2s4UzM5ZVhhVkFZMzVjWTA2dG5zTlV4c0VVNmozRE5tTUFRa1FmdzY2WXBBZFB4LU5oSFQ4MlB6RElfNEg0LXZobXRpelhNdXpabWIwbkNISXJtbExIel9Fa3pBNDJXVmJXVThVRGR6WU05OVBOQi1MVkk5VFRldVhXZzVJQjVzeXFfNE1VMGEzWlFfMVVjYlJYemtvZE5CTjBBQWxHMThnbk9nTzVLTGJzU3pOcFlfVkhzcUt1QXBJX2lTZldXRjdIY010emlrM0s5ZkJ4aWVXOWVuV3puWExDQm16VEJucElqSmY2TU9CNFBLRUR2TWwxMkdhOGpBYVBPQzg0WFNnTUN6dldldWQ0b3dFYUhFOFotVHE5TnlmR2ZNOVRERGJCTENrZWVpZjNxcGRUTXZudFZzRWNJbHh0SG1McTdGRkNsaWFCb0RfeUZlR2NjR3Bqd3lGWTJIaDY3cDFnSlByckJiaE9Wb0Z5amgwb3c4YTFaSWJWQmZDV2l1NEp2SVVMN1Y3T3pXZ1hPdjdtTDFRVWJPcXdIdFNRUVI0Zno0ZXRDa01Hd1JVTzRYRWpKaVFUUjBOUUk5VFFqWTdqRWFZY2pxaHlBSml2TWlZQkNURHFWcUNQUEdFcHN6TkFfRDNiRU1UMUl6UG5feXlzM3l6RHhheGZFM3JvRkJGNW9RcFJQZkhNYWZxeThvSkZyY3lxZ0QxRjQzM19pR05PclNrc09wYzZVaE5WLVFMaUtDSEx0c2pZMWxUalllZkxyQ3RwNWpqbXFyYmVmMlRrQmVIWG16WmFUeFNWR29aZHdFZXJfWXdBenV6NWlTX0cyS2w3QnhfUUtidXQtaUNlelVibE5FZHZyV3RJLVN6SGdWNXdqWWg3blJGUlMtdGhsbnZqUHpnc095YmVBM2kxbjZ1TnkwTzNibFVqVU02ejVGOGltbzNTcDNFOGhZdzh1MlBsSjJnZUF1ajVJczNZREFyMzJNQ2dTY3hHVkE0NktJV3lOMFBkdDM3c0poeURNVG1yemxuaGtHY0RsbndGU3UtWU9VX0g1N0pfTmxBMXV6anlQeFRvVkhacy0gLWxkaHEtN1F5a3B6dnkzMWZFNmtvVnN6b3pMNnkydGN5ZmVNa1pzeXpGdWgtamswemk5TlByRldjYW5Bc0VNTV9qMndLVDN5eC1rZGJ1UWlOdXNVRlpoeF9vWWVLcGt2LVFaSlhGVnBrSS1adHlVbGV1Qy1SeVVaUnlWTGhhX2pGZmRSXzFHMDBdLS0+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h3 id="36">3.6 パフォーマンス比較とまとめ<a class="headerlink" href="#36" title="Permanent link">&para;</a></h3>
<h4 id="361">3.6.1 テスト実行時間の比較<a class="headerlink" href="#361" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>アーキテクチャ</th>
<th>テスト手法</th>
<th>実行時間</th>
<th>1テストあたり</th>
<th>データベース依存</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>レイヤード</strong></td>
<td>統合テスト</td>
<td>8.347秒</td>
<td>0.556秒</td>
<td>あり</td>
</tr>
<tr>
<td><strong>ヘキサゴナル</strong></td>
<td>ユニットテスト</td>
<td>0.847秒</td>
<td>0.106秒</td>
<td>なし</td>
</tr>
<tr>
<td><strong>改善効果</strong></td>
<td>-</td>
<td><strong>10倍高速</strong></td>
<td><strong>5倍高速</strong></td>
<td><strong>分離</strong></td>
</tr>
</tbody>
</table>
<h4 id="362">3.6.2 コード品質の向上<a class="headerlink" href="#362" title="Permanent link">&para;</a></h4>
<p><strong>1. 依存関係の明確化</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// Before (レイヤード): 具象クラスに依存</span>
<span class="kd">class</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span><span class="w"> </span><span class="c1">// 具象依存</span>
<span class="p">}</span>

<span class="c1">// After (ヘキサゴナル): 抽象に依存</span>
<span class="kd">class</span><span class="w"> </span><span class="nx">ReservationService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">reservationRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservationRepository</span><span class="p">,</span><span class="w"> </span><span class="c1">// 抽象依存</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">roomRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">ReservableRoomRepository</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>2. ビジネスロジックの集約</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// ドメインモデルにビジネスルールが集約</span>
<span class="kd">class</span><span class="w"> </span><span class="nx">Reservation</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">overlap</span><span class="p">(</span><span class="nx">other</span><span class="o">:</span><span class="w"> </span><span class="kt">Reservation</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 重複判定のビジネスルール</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">canBeCancelledBy</span><span class="p">(</span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// キャンセル可能判定のビジネスルール  </span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">isWithinBusinessHours</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 営業時間内判定のビジネスルール</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>3. 型安全性の向上</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// 値オブジェクトによる型安全性</span>
<span class="kd">class</span><span class="w"> </span><span class="nx">RoomId</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="nx">_value</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">_value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Room ID must be positive&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// コンパイル時エラー検出</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">bookRoom</span><span class="p">(</span><span class="nx">roomId</span><span class="o">:</span><span class="w"> </span><span class="kt">RoomId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>

<span class="nx">bookRoom</span><span class="p">(</span><span class="mf">123</span><span class="p">);</span><span class="w"> </span><span class="c1">// Error: Argument of type &#39;number&#39; is not assignable to parameter of type &#39;RoomId&#39;</span>
<span class="nx">bookRoom</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">RoomId</span><span class="p">(</span><span class="mf">123</span><span class="p">));</span><span class="w"> </span><span class="c1">// OK</span>
</code></pre></div></p>
<h4 id="363">3.6.3 開発効率の向上<a class="headerlink" href="#363" title="Permanent link">&para;</a></h4>
<p><strong>1. 高速なフィードバックループ</strong>
- ユニットテストが数ミリ秒で完了
- リファクタリング時の安全性確保
- TDDサイクルの高速化</p>
<p><strong>2. 技術変更の容易さ</strong>
- データベースをPrismaからTypeORMに変更する場合
- アダプター層のみ変更、ドメイン層は無変更
- 段階的移行が可能</p>
<p><strong>3. チーム開発の改善</strong>
- ポートによる明確なインターフェース定義
- 並行開発が可能（モックによる独立性）
- 責務分離による保守性向上</p>
<hr />
<h2 id="_7">まとめ<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>TypeScriptによるヘキサゴナルアーキテクチャの実装により、以下の利益を得ることができました：</p>
<h3 id="_8">技術的利益<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>10倍高速なテスト実行</strong>: モック使用により統合テストに比べて大幅な高速化</li>
<li><strong>型安全性</strong>: コンパイル時エラー検出による品質向上</li>
<li><strong>保守性</strong>: 明確な責務分離による変更影響の局所化</li>
</ul>
<h3 id="_9">ビジネス利益<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>開発速度向上</strong>: 高速フィードバックによる効率的な開発サイクル</li>
<li><strong>品質向上</strong>: TDDとドメイン駆動設計による堅牢なビジネスロジック</li>
<li><strong>将来対応</strong>: 技術変更に強いアーキテクチャによる長期保守性</li>
</ul>
<h3 id="_10">学習効果<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>設計原則の理解</strong>: SOLID原則、特に依存関係逆転原則の実践</li>
<li><strong>ドメインモデリング</strong>: ビジネスルールをコードで表現する技術</li>
<li><strong>テスト技術</strong>: 効果的なユニットテストの書き方</li>
</ul>
<p>このケーススタディを通じて、TypeScriptでのヘキサゴナルアーキテクチャ実装の具体的な手法と利点を学ぶことができました。実際のプロジェクトでも同様のアプローチを適用し、保守性と拡張性に優れたアプリケーションを構築してください。</p>
<hr />
<h2 id="_11">参考資料<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<h3 id="_12">書籍<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<ul>
<li>「Clean Architecture」 Robert C. Martin</li>
<li>「Domain-Driven Design」 Eric Evans</li>
<li>「Growing Object-Oriented Software, Guided by Tests」 Steve Freeman &amp; Nat Pryce</li>
<li>「Effective TypeScript」 Dan Vanderkam</li>
</ul>
<h3 id="typescript_1">TypeScript関連リソース<a class="headerlink" href="#typescript_1" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://www.typescriptlang.org/">TypeScript Official Documentation</a></li>
<li><a href="https://docs.typestack.community/typedi/">TypeDI Documentation</a></li>
<li><a href="https://www.prisma.io/docs">Prisma Documentation</a></li>
<li><a href="https://jestjs.io/">Jest Testing Framework</a></li>
</ul>
<h3 id="_13">アーキテクチャ関連リソース<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://alistair.cockburn.us/hexagonal-architecture/">Hexagonal Architecture by Alistair Cockburn</a></li>
<li><a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">The Clean Architecture by Robert C. Martin</a></li>
<li><a href="https://plantuml.com/">PlantUML Documentation</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works" target="_blank" rel="noopener" title="GitHub Repository/claude-code-booster" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>