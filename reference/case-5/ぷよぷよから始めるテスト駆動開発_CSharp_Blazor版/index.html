
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="テスト駆動開発の手法を用いてC# Blazorでぷよぷよゲームを実装する過程を解説">
      
      
        <meta name="author" content="Project Team">
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>ぷよぷよから始めるテスト駆動開発 C# Blazor版 - Site Name</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#c-blazor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Site Name" class="md-header__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Site Name
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ぷよぷよから始めるテスト駆動開発 C# Blazor版
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Site Name" class="md-nav__button md-logo" aria-label="Site Name" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Site Name
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/claude-code-booster" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    claude-code-booster
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="c-blazor">ぷよぷよから始めるテスト駆動開発 C# Blazor版<a class="headerlink" href="#c-blazor" title="Permanent link">&para;</a></h1>
<h2 id="_1">はじめに<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>みなさん、こんにちは！今日は私と一緒にテスト駆動開発（TDD）を使って、C# BlazorWebAssemblyでぷよぷよゲームを作っていきましょう。さて、プログラミングの旅に出る前に、皆さんは「テスト駆動開発」について聞いたことがありますか？もしかしたら「テストって、コードを書いた後にするものじゃないの？」と思われるかもしれませんね。</p>
<blockquote>
<p>テスト駆動開発とは、プログラミングの手法の一種で、「テストファースト」の原則に従い、実装前にテストを書くことで、コードの品質を高め、設計を改善していく開発手法です。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<p>この記事では、私たちが一緒にぷよぷよゲームを実装しながら、テスト駆動開発の基本的な流れと考え方を学んでいきます。まるでモブプログラミングのセッションのように、あなたと私が一緒に考え、コードを書き、改善していく過程を体験しましょう。「でも、ぷよぷよって結構複雑なゲームじゃないの？」と思われるかもしれませんが、心配いりません。各章では、ユーザーストーリーに基づいた機能を、テスト、実装、解説の順に少しずつ進めていきますよ。一歩一歩、着実に進んでいきましょう！</p>
<h3 id="_2">テスト駆動開発のサイクル<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>さて、テスト駆動開発では、どのように進めていけばいいのでしょうか？「テストを書いてから実装する」というのは分かりましたが、具体的にはどんな手順で進めるのでしょうか？</p>
<p>私がいつも実践しているのは、以下の3つのステップを繰り返すサイクルです。皆さんも一緒にやってみましょう：</p>
<ol>
<li><strong>Red（赤）</strong>: まず失敗するテストを書きます。「え？わざと失敗するテストを？」と思われるかもしれませんが、これには重要な意味があるんです。これから実装する機能が何をすべきかを明確にするためなんですよ。</li>
<li><strong>Green（緑）</strong>: 次に、テストが通るように、最小限のコードを実装します。この段階では、きれいなコードよりも「とにかく動くこと」を優先します。「最小限」というのがポイントです。必要以上のことはしないようにしましょう。</li>
<li><strong>Refactor（リファクタリング）</strong>: 最後に、コードの品質を改善します。テストが通ることを確認しながら、重複を取り除いたり、わかりやすい名前をつけたりします。「動くけど汚いコード」から「動いてきれいなコード」へと進化させるんです。</li>
</ol>
<blockquote>
<p>テスト駆動開発のリズム：赤、緑、リファクタリング。まず失敗するテストを書き（赤）、次にテストが通るようにする（緑）、そして重複を除去する（リファクタリング）。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<p>このサイクルを「Red-Green-Refactor」サイクルと呼びます。「赤・緑・リファクタリング」のリズムを刻むように、このサイクルを繰り返していくんです。これによって、少しずつ機能を追加し、コードの品質を高めていきましょう。皆さんも一緒にこのリズムを体感してみてください！</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNUQVRFIiBoZWlnaHQ9IjY1MXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzM3cHg7aGVpZ2h0OjY1MXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDczNyA2NTEiIHdpZHRoPSI3MzdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxlbGxpcHNlIGN4PSIzOTkiIGN5PSIxNiIgZmlsbD0iIzIyMjIyMiIgcng9IjEwIiByeT0iMTAiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZyBpZD0iLi4uLi4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTkuOTk5NCIgeD0iMzE5IiB5PSI4NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMxOSIgeDI9IjQ3OC45OTk0IiB5MT0iMTEzLjI5NjkiIHkyPSIxMTMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOS45OTk0IiB4PSIzMjkiIHk9IjEwNC45OTUxIj4mIzEyNDY3OyYjMTI1NDA7JiMxMjQ4NzsmIzEyNDUxOyYjMTI1MzE7JiMxMjQ2NDsmIzEyMzkyOyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OzwvdGV4dD48L2c+PGcgaWQ9IlRPRE8iPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjEuMzcxMSIgeD0iMjg5LjMyIiB5PSIyMTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyODkuMzIiIHgyPSIzNTAuNjkxMSIgeTE9IjI0MC4yOTY5IiB5Mj0iMjQwLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS4zNzExIiB4PSIyOTkuMzIiIHk9IjIzMS45OTUxIj5UT0RPPC90ZXh0PjwvZz48ZyBpZD0iUmVkIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUwLjI2NTYiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTIuMDAwNSIgeD0iMTk1IiB5PSIzNDEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxOTUiIHgyPSIyODcuMDAwNSIgeTE9IjM2Ny4yOTY5IiB5Mj0iMzY3LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNy4yMjc1IiB4PSIyMjcuMzg2NSIgeT0iMzU4Ljk5NTEiPlJlZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi4wMDA1IiB4PSIyMDAiIHk9IjM4My40MzU1Ij4mIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODsmIzEyMzk1OyYjMjI4MzM7JiMyNTk0Mzs8L3RleHQ+PC9nPjxnIGlkPSJHcmVlbiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MC4yNjU2IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE2NC4wMDExIiB4PSI3IiB5PSI0NjguMjciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI3IiB4Mj0iMTcxLjAwMTEiIHkxPSI0OTQuNTY2OSIgeTI9IjQ5NC41NjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIuNzA0MSIgeD0iNjcuNjQ4NSIgeT0iNDg2LjI2NTEiPkdyZWVuPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0NC4wMDExIiB4PSIxMiIgeT0iNTEwLjcwNTUiPiYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMTIzOTU7JiMzNjg5MDsmIzEyNDI3OyYjMjYzNjg7JiMyMzU2NzsmIzM4NDgwOyYjMTIzOTg7JiMyMzQ1NTsmIzM1MDEzOzwvdGV4dD48L2c+PGcgaWQ9IlJlZmFjdG9yIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUwLjI2NTYiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjQ4LjAwMTciIHg9IjExNyIgeT0iNTk1LjUzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTE3IiB4Mj0iMzY1LjAwMTciIHkxPSI2MjEuODI2OSIgeTI9IjYyMS44MjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTkuMzU2NCIgeD0iMjExLjMyMjYiIHk9IjYxMy41MjUxIj5SZWZhY3RvcjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjguMDAxNyIgeD0iMTIyIiB5PSI2MzcuOTY1NSI+JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7JiMxMjM5ODsmIzM3MzI1OyYjMzUwNzk7JiMxMjQzNDsmIzM4NTAwOyYjMjE0MzU7JiMxMjM3NTsmIzEyMzkwOyYjMTI1MjI7JiMxMjUwMTsmIzEyNDQ5OyYjMTI0NjM7JiMxMjQ3OTsmIzEyNTIyOyYjMTI1MzE7JiMxMjQ2NDs8L3RleHQ+PC9nPjxnIGlkPSIuLi4uLi4uLi4uLiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzMuOTk5MyIgeD0iNTU3IiB5PSIyMTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI1NTciIHgyPSI3MzAuOTk5MyIgeTE9IjI0MC4yOTY5IiB5Mj0iMjQwLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTMuOTk5MyIgeD0iNTY3IiB5PSIyMzEuOTk1MSI+JiMxMjQ1MjsmIzEyNDg2OyYjMTI1MjQ7JiMxMjU0MDsmIzEyNDcxOyYjMTI1MTk7JiMxMjUzMTsmIzEyNTI0OyYjMTI0OTk7JiMxMjUxNzsmIzEyNTQwOzwvdGV4dD48L2c+PCEtLWxpbmsgKnN0YXJ0KiB0byA/Pz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ii5zdGFydC4iIGRhdGEtZW50aXR5LTI9Ii4uLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjEiIGRhdGEtdWlkPSJsbms0IiBpZD0ibGlua18uc3RhcnQuXy4uLi4uLi4uLi4iPjxwYXRoIGQ9Ik0zOTksMjYuMzYgQzM5OSw0MC4yOSAzOTksNjAuOTYgMzk5LDgwLjY1IiBmaWxsPSJub25lIiBpZD0iKnN0YXJ0Ki10by0mIzEyNDY3OyYjMTI1NDA7JiMxMjQ4NzsmIzEyNDUxOyYjMTI1MzE7JiMxMjQ2NDsmIzEyMzkyOyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzk5LDg2LjY1LDQwMyw3Ny42NSwzOTksODEuNjUsMzk1LDc3LjY1LDM5OSw4Ni42NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayA/Pz8/Pz8/Pz8/IHRvIFRPRE8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLi4uLiIgZGF0YS1lbnRpdHktMj0iVE9ETyIgZGF0YS1zb3VyY2UtbGluZT0iMiIgZGF0YS11aWQ9ImxuazYiIGlkPSJsaW5rXy4uLi4uLi4uLi5fVE9ETyI+PHBhdGggZD0iTTMxOC44NSwxMjAuMjYgQzI4OC40NSwxMjcuMzggMjU2LjY4LDE0MS4wNCAyMzgsMTY3IEMyMTkuOTcsMTkyLjA3IDI1My4xNTYzLDIxMS44NDA4IDI4My4zMTYzLDIyNC40ODA4IiBmaWxsPSJub25lIiBpZD0iJiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODc7JiMxMjQ1MTsmIzEyNTMxOyYjMTI0NjQ7JiMxMjM5MjsmIzEyNDg2OyYjMTI0NzM7JiMxMjQ4ODstdG8tVE9ETyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjg4Ljg1LDIyNi44LDI4Mi4wOTU2LDIxOS42MzIyLDI4NC4yMzg2LDIyNC44Njc0LDI3OS4wMDM0LDIyNy4wMTA0LDI4OC44NSwyMjYuOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNi40MTYxIiB4PSIyMzkiIHk9IjE4MC4wNjY5Ij5UT0RPJiMxMjUyMjsmIzEyNDczOyYjMTI0ODg7JiMxMjQzNDsmIzIwMzE2OyYjMjUxMDQ7PC90ZXh0PjwvZz48IS0tbGluayBUT0RPIHRvID8/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iVE9ETyIgZGF0YS1lbnRpdHktMj0iLi4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTEiIGRhdGEtdWlkPSJsbmsxNSIgaWQ9ImxpbmtfVE9ET18uLi4uLi4uLi4uIj48cGF0aCBkPSJNMzM5LjA0LDIxMy43NyBDMzQ1LjkzLDIwNC42MyAzNTMuNTgsMTk0LjAyIDM2MCwxODQgQzM2OS42NCwxNjguOTcgMzc2LjUyMTgsMTU2LjY4MjggMzgzLjgyMTgsMTQyLjc3MjgiIGZpbGw9Im5vbmUiIGlkPSJUT0RPLXRvLSYjMTI0Njc7JiMxMjU0MDsmIzEyNDg3OyYjMTI0NTE7JiMxMjUzMTsmIzEyNDY0OyYjMTIzOTI7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzODYuNjEsMTM3LjQ2LDM3OC44ODU5LDE0My41NzA0LDM4NC4yODY1LDE0MS44ODczLDM4NS45Njk2LDE0Ny4yODgsMzg2LjYxLDEzNy40NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyMC40MTYyIiB4PSIzNzAuMjYiIHk9IjE4MC4wNjY5Ij5UT0RPJiMxMjUyMjsmIzEyNDczOyYjMTI0ODg7JiMxMjM2NDsmIzMxMzU0OyYjMTIzOTU7JiMxMjM5NDsmIzEyNDI3OyYjMTI0MTQ7JiMxMjM5MTsmIzMyMzY4OyYjMTI0MjY7JiMzNjgyMDsmIzEyMzc3OzwvdGV4dD48L2c+PCEtLWxpbmsgVE9ETyB0byBSZWQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iVE9ETyIgZGF0YS1lbnRpdHktMj0iUmVkIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBkYXRhLXVpZD0ibG5rOCIgaWQ9ImxpbmtfVE9ET19SZWQiPjxwYXRoIGQ9Ik0zMDQuNTgsMjY0LjQzIEMyOTAuNjYsMjg2LjQ4IDI3My40OTM0LDMxMy42NjY3IDI1OS41ODM0LDMzNS42OTY3IiBmaWxsPSJub25lIiBpZD0iVE9ETy10by1SZWQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI1Ni4zOCwzNDAuNzcsMjY0LjU2NzIsMzM1LjI5NTYsMjU5LjA0OTUsMzM2LjU0MjIsMjU3LjgwMjgsMzMxLjAyNDUsMjU2LjM4LDM0MC43NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjI4Ni4yMyIgeT0iMzA3LjA2NjkiPiYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMTI0MzQ7JiMyNjM2MDsmIzEyMzY3OzwvdGV4dD48L2c+PCEtLWxpbmsgUmVkIHRvIEdyZWVuLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlJlZCIgZGF0YS1lbnRpdHktMj0iR3JlZW4iIGRhdGEtc291cmNlLWxpbmU9IjQiIGRhdGEtdWlkPSJsbmsxMCIgaWQ9ImxpbmtfUmVkX0dyZWVuIj48cGF0aCBkPSJNMTk0LjY4LDM4NC40MSBDMTc0LjgxLDM5My4zNSAxNTIuMjUsNDA1LjY5IDEzNSw0MjEuMjcgQzEyMC40OCw0MzQuMzggMTExLjQ3MjEsNDQ3Ljc4NTggMTAzLjQ0MjEsNDYyLjcxNTgiIGZpbGw9Im5vbmUiIGlkPSJSZWQtdG8tR3JlZW4iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwMC42LDQ2OCwxMDguMzg1OSw0NjEuOTY4NCwxMDIuOTY4NCw0NjMuNTk2NSwxMDEuMzQwMyw0NTguMTc5LDEwMC42LDQ2OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjEzNiIgeT0iNDM0LjMzNjkiPiYjMjYzNjg7JiMyMzU2NzsmIzM4NDgwOyYjMTIzOTg7JiMyMzQ1NTsmIzM1MDEzOzwvdGV4dD48L2c+PCEtLWxpbmsgR3JlZW4gdG8gUmVmYWN0b3ItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iR3JlZW4iIGRhdGEtZW50aXR5LTI9IlJlZmFjdG9yIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0ibG5rMTIiIGlkPSJsaW5rX0dyZWVuX1JlZmFjdG9yIj48cGF0aCBkPSJNOTAuNTEsNTE4LjcyIEM5Mi42Miw1MzMuODEgOTcuNTYsNTUyLjcgMTA5LDU2NS41MyBDMTIwLjEyLDU3OC4wMiAxMjkuMTcyNCw1ODUuMDM5MyAxNDQuMzkyNCw1OTIuNDk5MyIgZmlsbD0ibm9uZSIgaWQ9IkdyZWVuLXRvLVJlZmFjdG9yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDkuNzgsNTk1LjE0LDE0My40NTksNTg3LjU4NzIsMTQ1LjI5MDMsNTkyLjkzOTQsMTM5LjkzODEsNTk0Ljc3MDcsMTQ5Ljc4LDU5NS4xNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIxMTAiIHk9IjU2MS41OTY5Ij4mIzEyNTIyOyYjMTI1MDE7JiMxMjQ0OTsmIzEyNDYzOyYjMTI0Nzk7JiMxMjUyMjsmIzEyNTMxOyYjMTI0NjQ7PC90ZXh0PjwvZz48IS0tbGluayBSZWZhY3RvciB0byBSZWQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iUmVmYWN0b3IiIGRhdGEtZW50aXR5LTI9IlJlZCIgZGF0YS1zb3VyY2UtbGluZT0iNiIgZGF0YS11aWQ9ImxuazEzIiBpZD0ibGlua19SZWZhY3Rvcl9SZWQiPjxwYXRoIGQ9Ik0yNDEsNTk1LjE2IEMyNDEsNTQ2Ljc3IDI0MSw0NDUuNSAyNDEsMzk3LjM1IiBmaWxsPSJub25lIiBpZD0iUmVmYWN0b3ItdG8tUmVkIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNDEsMzkxLjM1LDIzNyw0MDAuMzUsMjQxLDM5Ni4zNSwyNDUsNDAwLjM1LDI0MSwzOTEuMzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMjQyIiB5PSI0OTcuOTY2OSI+JiMyNzQyNTsmIzEyMzk4OyYjMTI0ODY7JiMxMjQ3MzsmIzEyNDg4OyYjMTI0MzQ7JiMyNjM2MDsmIzEyMzY3OzwvdGV4dD48L2c+PCEtLWxpbmsgUmVmYWN0b3IgdG8gVE9ETy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJSZWZhY3RvciIgZGF0YS1lbnRpdHktMj0iVE9ETyIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGRhdGEtdWlkPSJsbmsxNCIgaWQ9ImxpbmtfUmVmYWN0b3JfVE9ETyI+PHBhdGggZD0iTTI4MS43Myw1OTUuMjIgQzMwNy40NSw1NzcuNDEgMzM4Ljc4LDU1MC44IDM1NSw1MTguNTMgQzU5NS43LDM5Ljc0IDM5NC42NiwzNDYuOTggMzczLDI5NCBDMzY4LjI4LDI4Mi40NSAzNjQuMDc3NywyNzYuMjA2MyAzNTUuMjM3NywyNjcuNjc2MyIgZmlsbD0ibm9uZSIgaWQ9IlJlZmFjdG9yLXRvLVRPRE8iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM1MC45MiwyNjMuNTEsMzU0LjYxOSwyNzIuNjM3OCwzNTQuNTE4MSwyNjYuOTgxOSwzNjAuMTc0LDI2Ni44ODA5LDM1MC45MiwyNjMuNTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOTguNDE2MyIgeD0iNDAzLjk5IiB5PSI0MzQuMzM2OSI+JiMxMjUyMjsmIzEyNTAxOyYjMTI0NDk7JiMxMjQ2MzsmIzEyNDc5OyYjMTI1MjI7JiMxMjUzMTsmIzEyNDY0OyYjMTIzNjQ7JiMyMzQzNjsmIzIwMTAyOyYjMTIzNzU7JiMxMjM4MzsmIzEyNDI1O1RPRE8mIzEyNTIyOyYjMTI0NzM7JiMxMjQ4ODsmIzEyMzk1OyYjMjUxNDc7JiMxMjQyNzs8L3RleHQ+PC9nPjwhLS1saW5rID8/Pz8/Pz8/Pz8gdG8gPz8/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iLi4uLi4uLi4uLiIgZGF0YS1lbnRpdHktMj0iLi4uLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjEyIiBkYXRhLXVpZD0ibG5rMTciIGlkPSJsaW5rXy4uLi4uLi4uLi5fLi4uLi4uLi4uLi4iPjxwYXRoIGQ9Ik00NzkuNDMsMTIwLjk1IEM1MTguNTIsMTI4LjA2IDU2NC4zOSwxNDEuNTIgNTk5LDE2NyBDNjE0Ljk4LDE3OC43NyA2MjQuMDc5MywxOTIuNjcyOSA2MzEuNTM5MywyMDguMTgyOSIgZmlsbD0ibm9uZSIgaWQ9IiYjMTI0Njc7JiMxMjU0MDsmIzEyNDg3OyYjMTI0NTE7JiMxMjUzMTsmIzEyNDY0OyYjMTIzOTI7JiMxMjQ4NjsmIzEyNDczOyYjMTI0ODg7LXRvLSYjMTI0NTI7JiMxMjQ4NjsmIzEyNTI0OyYjMTI1NDA7JiMxMjQ3MTsmIzEyNTE5OyYjMTI1MzE7JiMxMjUyNDsmIzEyNDk5OyYjMTI1MTc7JiMxMjU0MDsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYzNC4xNCwyMTMuNTksNjMzLjg0MzcsMjAzLjc0NTYsNjMxLjk3MjgsMjA5LjA4NDEsNjI2LjYzNDIsMjA3LjIxMzIsNjM0LjE0LDIxMy41OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tU1JDPVtaUEJGSWE5MTZDTnR5bklrMHItV0hRa1dmSDNqZWFNS0JHa2ExXzN4WGxvSmJjQTl0MTk0bDZNZmNFNllyQ2c3RVR4bnRoVGVQWklybzc4cnA3VC1TLVBtUGRSTnphQlh5NE84dDhMeVdxbzJRdjFUUzBWcTA5YTB6bzFKdWNfUEVrbjREWUVYVFJqMERZTzJrMzF3QndqS05iWkxPRGxIR3F0RFpjZjJ0UncyU2k4ODFqWUFIUUY3NmI3YmtEVjkxS3VVckZSUTVSenM5WVJJbkVMZV8tM3E5NlFqNmYxNVMxTnkxMXhRaEdhZVBpcHlNak1nUWhTYmJvLWNlZ1JkRmdqWUlOb2JNUEkyLTBxdXlxay1uTEpKbWo5UTNQOE5sZ2tSQW1JRXdycUVHMk5HX01nbmZ3S2tXcTVQaHZxVHpIRk1pbTlFVnctVmNZZXJxNWRkelZfcGEzX1ZaeEJabnh3czBVYjkxbEcxZ2V6eDdWMnZGeG02RVFqeTNCMWgxaDliRzd3MWgxbEdSQXlXeF9KbTRtMDBdLS0+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_3">開発環境<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>さて、実際にコードを書く前に、私たちが使用する開発環境について少しお話ししておきましょう。皆さんは「道具選びは仕事の半分」という言葉を聞いたことがありますか？プログラミングでも同じことが言えるんです。</p>
<blockquote>
<p>良いツールは良い仕事の第一歩です。適切な道具を選ぶことで、開発の効率と品質が大きく向上します。</p>
<p>— Andrew Hunt &amp; David Thomas 『達人プログラマー』</p>
</blockquote>
<p>「どんなツールを使えばいいの？」と思われるかもしれませんね。今回のプロジェクトでは、以下のツールを使用していきます：</p>
<ul>
<li><strong>言語</strong>: C# — 「.NETって難しそう...」と思われるかもしれませんが、C#は強力な型システムと豊富なライブラリにより、大規模な開発でもバグを減らしやすくなるんです。</li>
<li><strong>フレームワーク</strong>: Blazor WebAssembly — 「Webアプリなのにサーバーサイド言語のC#？」驚かれるかもしれませんが、BlazorはC#をブラウザで実行できる素晴らしいフレームワークなんです！</li>
<li><strong>テストフレームワーク</strong>: xUnit — .NETエコシステムで広く使われている信頼性の高いテストフレームワークです。テスト駆動開発には欠かせないツールですね。</li>
<li><strong>コードカバレッジ</strong>: Coverlet — テストがどれだけコードをカバーしているかを可視化してくれます。「どこをテストすべき？」という疑問に答えてくれますよ。</li>
<li><strong>静的コード解析</strong>: Microsoft.CodeAnalysis.Analyzers — コードの品質を自動的にチェックし、潜在的な問題を早期に発見してくれます。</li>
<li><strong>コードフォーマッタ</strong>: dotnet format — 「チーム内でコーディングスタイルが統一されていない...」そんな悩みを解決してくれます。</li>
<li><strong>バージョン管理</strong>: Git — コードの変更履歴を追跡し、「あれ？昨日までちゃんと動いてたのに...」というときに過去の状態に戻れる魔法のツールです。</li>
</ul>
<p>これらのツールを使って、テスト駆動開発の流れに沿ってぷよぷよゲームを実装していきましょう。「環境構築って難しそう...」と心配される方もいるかもしれませんが、今回のイテレーション0では、その環境構築についてしっかり解説していきますね！</p>
<h2 id="_4">要件<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="_5">ユーザーストーリー<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>さて、実際にコードを書き始める前に、少し立ち止まって考えてみましょう。「何を作るのか？」という基本的な問いかけです。私たちが作るぷよぷよゲームは、どのような機能を持つべきでしょうか？</p>
<p>アジャイル開発では、この「何を作るのか？」という問いに対して、「ユーザーストーリー」という形で答えを出します。皆さんは「ユーザーストーリー」という言葉を聞いたことがありますか？</p>
<blockquote>
<p>ユーザーストーリーとは、ソフトウェアの機能を「誰が」「何を」「なぜ」したいのかという形式で表現したものです。これにより、開発チームは常にユーザーの視点を忘れずに開発を進めることができます。</p>
<p>— Mike Cohn 『User Stories Applied』</p>
</blockquote>
<p>つまり、「プレイヤーとして、〇〇ができる（〇〇したいから）」という形式で機能を表現するんです。これによって、「誰のため」の「どんな機能」を「なぜ」作るのかが明確になります。素晴らしいですよね！</p>
<p>では、私たちのぷよぷよゲームでは、どんなユーザーストーリーが考えられるでしょうか？一緒に考えてみましょう：</p>
<ul>
<li>プレイヤーとして、新しいゲームを開始できる（ゲームの基本機能として必要ですよね！）</li>
<li>プレイヤーとして、落ちてくるぷよを左右に移動できる（ぷよを適切な位置に配置したいですよね）</li>
<li>プレイヤーとして、落ちてくるぷよを回転できる（戦略的にぷよを配置するために必要です）</li>
<li>プレイヤーとして、ぷよを素早く落下させることができる（「早く次のぷよを落としたい！」というときのために）</li>
<li>プレイヤーとして、同じ色のぷよを4つ以上つなげると消去できる（これがぷよぷよの醍醐味ですよね！）</li>
<li>プレイヤーとして、連鎖反応を起こしてより高いスコアを獲得できる（「れ〜んさ〜ん！」と叫びたくなりますよね）</li>
<li>プレイヤーとして、全消し（ぜんけし）ボーナスを獲得できる（「やった！全部消えた！」という達成感を味わいたいですよね）</li>
<li>プレイヤーとして、ゲームオーバーになるとゲーム終了の演出を見ることができる（終わりが明確でないとモヤモヤしますよね）</li>
<li>プレイヤーとして、現在のスコアを確認できる（「今どれくらい点数取れてるかな？」と気になりますよね）</li>
<li>プレイヤーとして、キーボードでぷよを操作できる（PCでプレイするなら必須ですよね）</li>
<li>プレイヤーとして、タッチ操作でぷよを操作できる（スマホでもプレイしたいですよね）</li>
</ul>
<p>「うわ、結構たくさんあるな...」と思われるかもしれませんが、心配いりません！これらのユーザーストーリーを一つずつ実装していくことで、徐々にゲームを完成させていきましょう。テスト駆動開発の素晴らしいところは、各ストーリーを小さなタスクに分解し、テスト→実装→リファクタリングのサイクルで少しずつ進められることなんです。一歩一歩、着実に進んでいきましょう！</p>
<h3 id="_6">ユースケース図<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>ユーザーストーリーを整理したところで、「これらの機能がどのように関連しているのか、全体像が見えるといいな」と思いませんか？そんなときに役立つのが「ユースケース図」です。</p>
<p>「ユースケース図って何？」と思われるかもしれませんね。ユースケース図は、システムと外部アクター（ここではプレイヤーとシステム自体）の相互作用を視覚的に表現するための図です。「絵に描いて整理すると分かりやすい」というやつですね。</p>
<blockquote>
<p>ユースケース図は、システムが外部に提供する機能と、それを利用するアクターとの関係を表現します。これにより、システムの境界と責任範囲が明確になります。</p>
<p>— Martin Fowler 『UMLモデリングのエッセンス』</p>
</blockquote>
<p>「百聞は一見にしかず」というように、実際に見てみるのが一番分かりやすいですよね。では、私たちのぷよぷよゲームのユースケース図を見てみましょう：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjU3N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6ODI2cHg7aGVpZ2h0OjU3N3B4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDgyNiA1NzciIHdpZHRoPSI4MjZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyID8/Pz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSIuLi4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iOSIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJjbHVzdGVyXy4uLi4uLi4uLi4uIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjU2NCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYxNS4wNyIgeD0iMTEyIiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1My45OTkzIiB4PSIzNDIuNTM1MyIgeT0iMjEuOTk1MSI+JiMxMjQwNzsmIzEyNDI0OyYjMTI0MDc7JiMxMjQyNDsmIzEyNDY2OyYjMTI1NDA7JiMxMjUxMjsmIzEyNDcxOyYjMTI0NzM7JiMxMjQ4NjsmIzEyNTEyOzwvdGV4dD48L2c+PCEtLWVudGl0eSBTdGFydE5ld0dhbWUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iU3RhcnROZXdHYW1lIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfU3RhcnROZXdHYW1lIj48ZWxsaXBzZSBjeD0iMjE0LjAyNTkiIGN5PSI1MjguOTk1MiIgZmlsbD0iI0YxRjFGMSIgcng9Ijc4LjAyNTkiIHJ5PSIxOC4wMDUyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuOTk5NSIgeD0iMTUxLjAyNjIiIHk9IjUzMy42NDM2Ij4mIzI2MDMyOyYjMTIzNzU7JiMxMjM1NjsmIzEyNDY2OyYjMTI1NDA7JiMxMjUxMjsmIzEyNDM0OyYjMzgyODM7JiMyMjk4Nzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUmVzdGFydEdhbWUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUmVzdGFydEdhbWUiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBkYXRhLXVpZD0iZW50MDAwNiIgaWQ9ImVudGl0eV9SZXN0YXJ0R2FtZSI+PGVsbGlwc2UgY3g9IjIxNC4wMjU5IiBjeT0iNDU3Ljk5NTIiIGZpbGw9IiNGMUYxRjEiIHJ4PSI3OC4wMjU5IiByeT0iMTguMDA1MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI1Ljk5OTUiIHg9IjE1MS4wMjYyIiB5PSI0NjIuNjQzNiI+JiMxMjQ2NjsmIzEyNTQwOyYjMTI1MTI7JiMxMjQzNDsmIzEyNTIyOyYjMTI0NzM7JiMxMjQ3OTsmIzEyNTQwOyYjMTI0ODg7PC90ZXh0PjwvZz48IS0tZW50aXR5IE1vdmVQdXlvLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ik1vdmVQdXlvIiBkYXRhLXNvdXJjZS1saW5lPSIxOCIgZGF0YS11aWQ9ImVudDAwMDciIGlkPSJlbnRpdHlfTW92ZVB1eW8iPjxlbGxpcHNlIGN4PSIyMTQuMDMyNCIgY3k9IjE5OS4wMDA1IiBmaWxsPSIjRjFGMUYxIiByeD0iNzIuMjUyNCIgcnk9IjE2Ljg1MDUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS45OTk1IiB4PSIxNTguMDMyNyIgeT0iMjAzLjY0ODkiPiYjMTI0MDc7JiMxMjQyNDsmIzEyNDM0OyYjMjQwMzg7JiMyMTQ5MTsmIzEyMzk1OyYjMzEyMjc7JiMyMTIwNTs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUm90YXRlUHV5by0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJSb3RhdGVQdXlvIiBkYXRhLXNvdXJjZS1saW5lPSIxOSIgZGF0YS11aWQ9ImVudDAwMDgiIGlkPSJlbnRpdHlfUm90YXRlUHV5byI+PGVsbGlwc2UgY3g9IjIxNC4wMjczIiBjeT0iMTMzLjAwMzYiIGZpbGw9IiNGMUYxRjEiIHJ4PSI1Mi40OTczIiByeT0iMTQuNTIzNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMTc5LjAyNzQiIHk9IjEzNy42NTIxIj4mIzEyNDA3OyYjMTI0MjQ7JiMxMjQzNDsmIzIyMjM4OyYjMzY1Nzg7PC90ZXh0PjwvZz48IS0tZW50aXR5IFF1aWNrRHJvcFB1eW8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUXVpY2tEcm9wUHV5byIgZGF0YS1zb3VyY2UtbGluZT0iMjAiIGRhdGEtdWlkPSJlbnQwMDA5IiBpZD0iZW50aXR5X1F1aWNrRHJvcFB1eW8iPjxlbGxpcHNlIGN4PSIyMTQuMDMyNCIgY3k9IjY3LjAwMDUiIGZpbGw9IiNGMUYxRjEiIHJ4PSI3Mi4yNTI0IiByeT0iMTYuODUwNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjk5OTUiIHg9IjE1OC4wMzI3IiB5PSI3MS42NDg5Ij4mIzEyNDA3OyYjMTI0MjQ7JiMxMjQzNDsmIzMyMDMyOyYjMjYwODk7JiMxMjM2NzsmIzMzODUzOyYjMTk5Nzk7PC90ZXh0PjwvZz48IS0tZW50aXR5IEVyYXNlUHV5by0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJFcmFzZVB1eW8iIGRhdGEtc291cmNlLWxpbmU9IjI1IiBkYXRhLXVpZD0iZW50MDAxMCIgaWQ9ImVudGl0eV9FcmFzZVB1eW8iPjxlbGxpcHNlIGN4PSIyMTQuMDI3MyIgY3k9IjI5Mi4wMDM2IiBmaWxsPSIjRjFGMUYxIiByeD0iNTIuNDk3MyIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjE3OS4wMjc0IiB5PSIyOTYuNjUyMSI+JiMxMjQwNzsmIzEyNDI0OyYjMTI0MzQ7JiMyODA0MDsmIzIxNDM1OzwvdGV4dD48L2c+PCEtLWVudGl0eSBDaGFpblJlYWN0aW9uLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkNoYWluUmVhY3Rpb24iIGRhdGEtc291cmNlLWxpbmU9IjI2IiBkYXRhLXVpZD0iZW50MDAxMSIgaWQ9ImVudGl0eV9DaGFpblJlYWN0aW9uIj48ZWxsaXBzZSBjeD0iNDM2LjAzNTIiIGN5PSIyNTUuOTk1IiBmaWxsPSIjRjFGMUYxIiByeD0iNjYuNzI1MiIgcnk9IjE1Ljc0NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMzg3LjAzNTQiIHk9IjI2MC42NDM1Ij4mIzM2ODk5OyYjMzc3ODI7JiMyMTQ1MzsmIzI0NTQwOyYjMTI0MzQ7JiMzMDMzMDsmIzI5OTgzOzwvdGV4dD48L2c+PCEtLWVudGl0eSBaZW5rZXNoaUJvbnVzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9Ilplbmtlc2hpQm9udXMiIGRhdGEtc291cmNlLWxpbmU9IjI3IiBkYXRhLXVpZD0iZW50MDAxMiIgaWQ9ImVudGl0eV9aZW5rZXNoaUJvbnVzIj48ZWxsaXBzZSBjeD0iNDM2LjA0MzEiIGN5PSIzMjUuOTk4NiIgZmlsbD0iI0YxRjFGMSIgcng9IjgzLjk5MzEiIHJ5PSIxOS4xOTg2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzkuOTk5NCIgeD0iMzY2LjA0MzQiIHk9IjMzMC42NDcxIj4mIzIwODQwOyYjMjgwNDA7JiMxMjM3NTsmIzEyNTA4OyYjMTI1NDA7JiMxMjQ5MDsmIzEyNDczOyYjMTI0MzQ7JiMyOTU1NDsmIzI0NDcxOzwvdGV4dD48L2c+PCEtLWVudGl0eSBEaXNwbGF5U2NvcmUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iRGlzcGxheVNjb3JlIiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgZGF0YS11aWQ9ImVudDAwMTMiIGlkPSJlbnRpdHlfRGlzcGxheVNjb3JlIj48ZWxsaXBzZSBjeD0iNjQxLjU1NDIiIGN5PSIyNTUuMDAyOCIgZmlsbD0iI0YxRjFGMSIgcng9IjYxLjUxNDIiIHJ5PSIxNC43MDI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSI1OTkuNTU0NCIgeT0iMjU5LjY1MTMiPiYjMTI0NzM7JiMxMjQ2NzsmIzEyNDUwOyYjMTI0MzQ7JiMzNDkyMDsmIzMxMDM0OzwvdGV4dD48L2c+PCEtLWVudGl0eSBLZXlib2FyZENvbnRyb2wtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iS2V5Ym9hcmRDb250cm9sIiBkYXRhLXNvdXJjZS1saW5lPSIzMyIgZGF0YS11aWQ9ImVudDAwMTQiIGlkPSJlbnRpdHlfS2V5Ym9hcmRDb250cm9sIj48ZWxsaXBzZSBjeD0iNDM2LjA0MjQiIGN5PSI2Ny4wMDA1IiBmaWxsPSIjRjFGMUYxIiByeD0iNzIuMjUyNCIgcnk9IjE2Ljg1MDUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS45OTk1IiB4PSIzODAuMDQyNyIgeT0iNzEuNjQ4OSI+JiMxMjQ2MTsmIzEyNTQwOyYjMTI1MDg7JiMxMjU0MDsmIzEyNDg5OyYjMTIzOTE7JiMyNTgwNTsmIzIwMzE2OzwvdGV4dD48L2c+PCEtLWVudGl0eSBUb3VjaENvbnRyb2wtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iVG91Y2hDb250cm9sIiBkYXRhLXNvdXJjZS1saW5lPSIzNCIgZGF0YS11aWQ9ImVudDAwMTUiIGlkPSJlbnRpdHlfVG91Y2hDb250cm9sIj48ZWxsaXBzZSBjeD0iNDM2LjAzNzMiIGN5PSIxMzMuMDAzNiIgZmlsbD0iI0YxRjFGMSIgcng9IjUyLjQ5NzMiIHJ5PSIxNC41MjM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSI0MDEuMDM3NCIgeT0iMTM3LjY1MjEiPiYjMTI0Nzk7JiMxMjQ4MzsmIzEyNDgxOyYjMjU4MDU7JiMyMDMxNjs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgR2FtZU92ZXJDaGVjay0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJHYW1lT3ZlckNoZWNrIiBkYXRhLXNvdXJjZS1saW5lPSIzOSIgZGF0YS11aWQ9ImVudDAwMTYiIGlkPSJlbnRpdHlfR2FtZU92ZXJDaGVjayI+PGVsbGlwc2UgY3g9IjIxNC4wMjU5IiBjeT0iMzg2Ljk5NTIiIGZpbGw9IiNGMUYxRjEiIHJ4PSI3OC4wMjU5IiByeT0iMTguMDA1MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI1Ljk5OTUiIHg9IjE1MS4wMjYyIiB5PSIzOTEuNjQzNiI+JiMxMjQ2NjsmIzEyNTQwOyYjMTI1MTI7JiMxMjQ1ODsmIzEyNTQwOyYjMTI0OTY7JiMxMjU0MDsmIzIxMDI4OyYjMjM0NTA7PC90ZXh0PjwvZz48IS0tZW50aXR5IEdhbWVPdmVyQW5pbWF0aW9uLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdhbWVPdmVyQW5pbWF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSI0MCIgZGF0YS11aWQ9ImVudDAwMTciIGlkPSJlbnRpdHlfR2FtZU92ZXJBbmltYXRpb24iPjxlbGxpcHNlIGN4PSI0MzYuMDM1OSIgY3k9IjM5Ny45OTUyIiBmaWxsPSIjRjFGMUYxIiByeD0iNzguMDI1OSIgcnk9IjE4LjAwNTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSIzNzMuMDM2MiIgeT0iNDAyLjY0MzYiPiYjMTI0NjY7JiMxMjU0MDsmIzEyNTEyOyYjMTI0NTg7JiMxMjU0MDsmIzEyNDk2OyYjMTI1NDA7JiMyODQzNjsmIzIwOTg2OzwvdGV4dD48L2c+PCEtLWVudGl0eSBQbGF5ZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iUGxheWVyIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImVudGl0eV9QbGF5ZXIiPjxlbGxpcHNlIGN4PSI0MC45OTk4IiBjeT0iMTAzLjM1IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00MC45OTk4LDExMS4zNSBMNDAuOTk5OCwxMzguMzUgTTI3Ljk5OTgsMTE5LjM1IEw1My45OTk4LDExOS4zNSBNNDAuOTk5OCwxMzguMzUgTDI3Ljk5OTgsMTUzLjM1IE00MC45OTk4LDEzOC4zNSBMNTMuOTk5OCwxNTMuMzUiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjYiIHk9IjE2Ny44NDUxIj4mIzEyNTAzOyYjMTI1MjQ7JiMxMjQ1MjsmIzEyNTE2OyYjMTI1NDA7PC90ZXh0PjwvZz48IS0tZW50aXR5IFN5c3RlbS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJTeXN0ZW0iIGRhdGEtc291cmNlLWxpbmU9IjciIGRhdGEtdWlkPSJlbnQwMDAzIiBpZD0iZW50aXR5X1N5c3RlbSI+PGVsbGlwc2UgY3g9Ijc5MS4wNjk5IiBjeT0iNDAwLjM1IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03OTEuMDY5OSw0MDguMzUgTDc5MS4wNjk5LDQzNS4zNSBNNzc4LjA2OTksNDE2LjM1IEw4MDQuMDY5OSw0MTYuMzUgTTc5MS4wNjk5LDQzNS4zNSBMNzc4LjA2OTksNDUwLjM1IE03OTEuMDY5OSw0MzUuMzUgTDgwNC4wNjk5LDQ1MC4zNSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iNzYzLjA3IiB5PSI0NjQuODQ1MSI+JiMxMjQ3MTsmIzEyNDczOyYjMTI0ODY7JiMxMjUxMjs8L3RleHQ+PC9nPjwhLS1saW5rIFBsYXllciB0byBTdGFydE5ld0dhbWUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iUGxheWVyIiBkYXRhLWVudGl0eS0yPSJTdGFydE5ld0dhbWUiIGRhdGEtc291cmNlLWxpbmU9IjQ1IiBkYXRhLXVpZD0ibG5rMTgiIGlkPSJsaW5rX1BsYXllcl9TdGFydE5ld0dhbWUiPjxwYXRoIGQ9Ik0yOS4wNywxNzEuMzMgQzI5LjA3LDI3MC43MSAyOS4wNyw1MjkgMjkuMDcsNTI5IEMyOS4wNyw1MjkgNzkuMTgsNTI5IDEyOS41OSw1MjkiIGZpbGw9Im5vbmUiIGlkPSJQbGF5ZXItdG8tU3RhcnROZXdHYW1lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzUuNTksNTI5LDEyNi41OSw1MjUsMTMwLjU5LDUyOSwxMjYuNTksNTMzLDEzNS41OSw1MjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgUGxheWVyIHRvIFJlc3RhcnRHYW1lLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlBsYXllciIgZGF0YS1lbnRpdHktMj0iUmVzdGFydEdhbWUiIGRhdGEtc291cmNlLWxpbmU9IjQ2IiBkYXRhLXVpZD0ibG5rMTkiIGlkPSJsaW5rX1BsYXllcl9SZXN0YXJ0R2FtZSI+PHBhdGggZD0iTTUzLjA3LDE3MS41NiBDNTMuMDcsMjU3LjY1IDUzLjA3LDQ1OCA1My4wNyw0NTggQzUzLjA3LDQ1OCA4OC44OSw0NTggMTI5LjksNDU4IiBmaWxsPSJub25lIiBpZD0iUGxheWVyLXRvLVJlc3RhcnRHYW1lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzUuOSw0NTgsMTI2LjksNDU0LDEzMC45LDQ1OCwxMjYuOSw0NjIsMTM1LjksNDU4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIFBsYXllciB0byBNb3ZlUHV5by0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJQbGF5ZXIiIGRhdGEtZW50aXR5LTI9Ik1vdmVQdXlvIiBkYXRhLXNvdXJjZS1saW5lPSI0NyIgZGF0YS11aWQ9ImxuazIwIiBpZD0ibGlua19QbGF5ZXJfTW92ZVB1eW8iPjxwYXRoIGQ9Ik03Ni40NywxNjMuMjcgQzEwOS45NSwxNjMuMjcgMTU1LjA3LDE2My4yNyAxNTUuMDcsMTYzLjI3IEMxNTUuMDcsMTYzLjI3IDE1NS4wNywxNzIuMyAxNTUuMDcsMTgyLjg2IiBmaWxsPSJub25lIiBpZD0iUGxheWVyLXRvLU1vdmVQdXlvIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNTUuMDcsMTg4Ljg2LDE1OS4wNywxNzkuODYsMTU1LjA3LDE4My44NiwxNTEuMDcsMTc5Ljg2LDE1NS4wNywxODguODYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgUGxheWVyIHRvIFJvdGF0ZVB1eW8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iUGxheWVyIiBkYXRhLWVudGl0eS0yPSJSb3RhdGVQdXlvIiBkYXRhLXNvdXJjZS1saW5lPSI0OCIgZGF0YS11aWQ9ImxuazIxIiBpZD0ibGlua19QbGF5ZXJfUm90YXRlUHV5byI+PHBhdGggZD0iTTc2LjQzLDEzMyBDMTAwLjg1LDEzMyAxMjcuNzMsMTMzIDE1NS4yMywxMzMiIGZpbGw9Im5vbmUiIGlkPSJQbGF5ZXItdG8tUm90YXRlUHV5byIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTYxLjIzLDEzMywxNTIuMjMsMTI5LDE1Ni4yMywxMzMsMTUyLjIzLDEzNywxNjEuMjMsMTMzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIFBsYXllciB0byBRdWlja0Ryb3BQdXlvLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlBsYXllciIgZGF0YS1lbnRpdHktMj0iUXVpY2tEcm9wUHV5byIgZGF0YS1zb3VyY2UtbGluZT0iNDkiIGRhdGEtdWlkPSJsbmsyMiIgaWQ9ImxpbmtfUGxheWVyX1F1aWNrRHJvcFB1eW8iPjxwYXRoIGQ9Ik03Ni4zNSwxMDIuNzMgQzEwNy41NCwxMDIuNzMgMTQ4LjA3LDEwMi43MyAxNDguMDcsMTAyLjczIEMxNDguMDcsMTAyLjczIDE0OC4wNyw5MC42NyAxNDguMDcsODAuMjMiIGZpbGw9Im5vbmUiIGlkPSJQbGF5ZXItdG8tUXVpY2tEcm9wUHV5byIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQ4LjA3LDc0LjIzLDE0NC4wNyw4My4yMywxNDguMDcsNzkuMjMsMTUyLjA3LDgzLjIzLDE0OC4wNyw3NC4yMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBQbGF5ZXIgdG8gS2V5Ym9hcmRDb250cm9sLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlBsYXllciIgZGF0YS1lbnRpdHktMj0iS2V5Ym9hcmRDb250cm9sIiBkYXRhLXNvdXJjZS1saW5lPSI1MCIgZGF0YS11aWQ9ImxuazIzIiBpZD0ibGlua19QbGF5ZXJfS2V5Ym9hcmRDb250cm9sIj48cGF0aCBkPSJNNzYuMjIsMTEwLjYgQzE2MS42OCwxMTAuNiAzNzMuMDcsMTEwLjYgMzczLjA3LDExMC42IEMzNzMuMDcsMTEwLjYgMzczLjA3LDk0LjA4IDM3My4wNyw4MS40MSIgZmlsbD0ibm9uZSIgaWQ9IlBsYXllci10by1LZXlib2FyZENvbnRyb2wiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM3My4wNyw3NS40MSwzNjkuMDcsODQuNDEsMzczLjA3LDgwLjQxLDM3Ny4wNyw4NC40MSwzNzMuMDcsNzUuNDEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgUGxheWVyIHRvIFRvdWNoQ29udHJvbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJQbGF5ZXIiIGRhdGEtZW50aXR5LTI9IlRvdWNoQ29udHJvbCIgZGF0YS1zb3VyY2UtbGluZT0iNTEiIGRhdGEtdWlkPSJsbmsyNCIgaWQ9ImxpbmtfUGxheWVyX1RvdWNoQ29udHJvbCI+PHBhdGggZD0iTTc2LjQxLDE1NS40IEMxNzMuMzgsMTU1LjQgNDM2LjA3LDE1NS40IDQzNi4wNywxNTUuNCBDNDM2LjA3LDE1NS40IDQzNi4wNywxNTcuOTggNDM2LjA3LDE1My44MiIgZmlsbD0ibm9uZSIgaWQ9IlBsYXllci10by1Ub3VjaENvbnRyb2wiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQzNi4wNywxNDcuODIsNDMyLjA3LDE1Ni44Miw0MzYuMDcsMTUyLjgyLDQ0MC4wNywxNTYuODIsNDM2LjA3LDE0Ny44MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tcmV2ZXJzZSBsaW5rIEVyYXNlUHV5byB0byBTeXN0ZW0tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iRXJhc2VQdXlvIiBkYXRhLWVudGl0eS0yPSJTeXN0ZW0iIGRhdGEtc291cmNlLWxpbmU9IjU0IiBkYXRhLXVpZD0ibG5rMjUiIGlkPSJsaW5rX0VyYXNlUHV5b19TeXN0ZW0iPjxwYXRoIGQ9Ik0yNzIuNzksMjkyIEM0MTYuMzIsMjkyIDc5Ny4wNywyOTIgNzk3LjA3LDI5MiBDNzk3LjA3LDI5MiA3OTcuMDcsMzUwLjczIDc5Ny4wNywzOTEuNTYiIGZpbGw9Im5vbmUiIGlkPSJFcmFzZVB1eW8tYmFja3RvLVN5c3RlbSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjY2Ljc5LDI5MiwyNzUuNzksMjk2LDI3MS43OSwyOTIsMjc1Ljc5LDI4OCwyNjYuNzksMjkyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1yZXZlcnNlIGxpbmsgQ2hhaW5SZWFjdGlvbiB0byBTeXN0ZW0tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQ2hhaW5SZWFjdGlvbiIgZGF0YS1lbnRpdHktMj0iU3lzdGVtIiBkYXRhLXNvdXJjZS1saW5lPSI1NSIgZGF0YS11aWQ9ImxuazI2IiBpZD0ibGlua19DaGFpblJlYWN0aW9uX1N5c3RlbSI+PHBhdGggZD0iTTUwMy43MywyNjIuMzUgQzUzMC41OSwyNjIuMzUgNTUwLjA3LDI2Mi4zNSA1NTAuMDcsMjYyLjM1IEM1NTAuMDcsMjYyLjM1IDU1MC4wNywzOTkuOSA1NTAuMDcsMzk5LjkgQzU1MC4wNywzOTkuOSA2OTkuMzgsMzk5LjkgNzYyLjk1LDM5OS45IiBmaWxsPSJub25lIiBpZD0iQ2hhaW5SZWFjdGlvbi1iYWNrdG8tU3lzdGVtIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0OTcuNzMsMjYyLjM1LDUwNi43MywyNjYuMzUsNTAyLjczLDI2Mi4zNSw1MDYuNzMsMjU4LjM1LDQ5Ny43MywyNjIuMzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBaZW5rZXNoaUJvbnVzIHRvIFN5c3RlbS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJaZW5rZXNoaUJvbnVzIiBkYXRhLWVudGl0eS0yPSJTeXN0ZW0iIGRhdGEtc291cmNlLWxpbmU9IjU2IiBkYXRhLXVpZD0ibG5rMjciIGlkPSJsaW5rX1plbmtlc2hpQm9udXNfU3lzdGVtIj48cGF0aCBkPSJNNTI2LjUzLDMyNiBDNjI5LjgzLDMyNiA3ODUuMDcsMzI2IDc4NS4wNywzMjYgQzc4NS4wNywzMjYgNzg1LjA3LDM2MS45NCA3ODUuMDcsMzkxLjU3IiBmaWxsPSJub25lIiBpZD0iWmVua2VzaGlCb251cy1iYWNrdG8tU3lzdGVtIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1MjAuNTMsMzI2LDUyOS41MywzMzAsNTI1LjUzLDMyNiw1MjkuNTMsMzIyLDUyMC41MywzMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBEaXNwbGF5U2NvcmUgdG8gU3lzdGVtLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkRpc3BsYXlTY29yZSIgZGF0YS1lbnRpdHktMj0iU3lzdGVtIiBkYXRhLXNvdXJjZS1saW5lPSI1NyIgZGF0YS11aWQ9ImxuazI4IiBpZD0ibGlua19EaXNwbGF5U2NvcmVfU3lzdGVtIj48cGF0aCBkPSJNNzA5LjU2LDI1NSBDNzU2LjksMjU1IDgwOC4wNywyNTUgODA4LjA3LDI1NSBDODA4LjA3LDI1NSA4MDguMDcsMzQwLjA4IDgwOC4wNywzOTEuNiIgZmlsbD0ibm9uZSIgaWQ9IkRpc3BsYXlTY29yZS1iYWNrdG8tU3lzdGVtIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3MDMuNTYsMjU1LDcxMi41NiwyNTksNzA4LjU2LDI1NSw3MTIuNTYsMjUxLDcwMy41NiwyNTUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBHYW1lT3ZlckNoZWNrIHRvIFN5c3RlbS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJHYW1lT3ZlckNoZWNrIiBkYXRhLWVudGl0eS0yPSJTeXN0ZW0iIGRhdGEtc291cmNlLWxpbmU9IjU4IiBkYXRhLXVpZD0ibG5rMjkiIGlkPSJsaW5rX0dhbWVPdmVyQ2hlY2tfU3lzdGVtIj48cGF0aCBkPSJNMjc3Ljg1LDM3NC40OSBDNDIwLjk0LDM3NC40OSA3NzQuMDcsMzc0LjQ5IDc3NC4wNywzNzQuNDkgQzc3NC4wNywzNzQuNDkgNzc0LjA3LDM4MS45OCA3NzQuMDcsMzkxLjQ1IiBmaWxsPSJub25lIiBpZD0iR2FtZU92ZXJDaGVjay1iYWNrdG8tU3lzdGVtIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNzEuODUsMzc0LjQ5LDI4MC44NSwzNzguNDksMjc2Ljg1LDM3NC40OSwyODAuODUsMzcwLjQ5LDI3MS44NSwzNzQuNDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLXJldmVyc2UgbGluayBHYW1lT3ZlckFuaW1hdGlvbiB0byBTeXN0ZW0tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iR2FtZU92ZXJBbmltYXRpb24iIGRhdGEtZW50aXR5LTI9IlN5c3RlbSIgZGF0YS1zb3VyY2UtbGluZT0iNTkiIGRhdGEtdWlkPSJsbmszMCIgaWQ9ImxpbmtfR2FtZU92ZXJBbmltYXRpb25fU3lzdGVtIj48cGF0aCBkPSJNNTA3Ljk5LDQwNy45NSBDNTg2LjE5LDQwNy45NSA3MDYuOTksNDA3Ljk1IDc2Mi45Nyw0MDcuOTUiIGZpbGw9Im5vbmUiIGlkPSJHYW1lT3ZlckFuaW1hdGlvbi1iYWNrdG8tU3lzdGVtIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1MDEuOTksNDA3Ljk1LDUxMC45OSw0MTEuOTUsNTA2Ljk5LDQwNy45NSw1MTAuOTksNDAzLjk1LDUwMS45OSw0MDcuOTUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgTW92ZVB1eW8gdG8gS2V5Ym9hcmRDb250cm9sLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9Ik1vdmVQdXlvIiBkYXRhLWVudGl0eS0yPSJLZXlib2FyZENvbnRyb2wiIGRhdGEtc291cmNlLWxpbmU9IjYyIiBkYXRhLXVpZD0ibG5rMzEiIGlkPSJsaW5rX01vdmVQdXlvX0tleWJvYXJkQ29udHJvbCI+PHBhdGggZD0iTTI4Ni4zNywxOTkgQzMzMS4xMSwxOTkgMzgwLjA3LDE5OSAzODAuMDcsMTk5IEMzODAuMDcsMTk5IDM4MC4wNywxMTUuMzMgMzgwLjA3LDgzLjgiIGZpbGw9Im5vbmUiIGlkPSJNb3ZlUHV5by10by1LZXlib2FyZENvbnRyb2wiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM4MC4wNyw3Ny44LDM3Ni4wNyw4Ni44LDM4MC4wNyw4Mi44LDM4NC4wNyw4Ni44LDM4MC4wNyw3Ny44IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjEuMTg1MSIgeD0iMzE4LjA3IiB5PSIxOTguMzE2OSI+JiMxNzE7ZXh0ZW5kJiMxODc7PC90ZXh0PjwvZz48IS0tbGluayBNb3ZlUHV5byB0byBUb3VjaENvbnRyb2wtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iTW92ZVB1eW8iIGRhdGEtZW50aXR5LTI9IlRvdWNoQ29udHJvbCIgZGF0YS1zb3VyY2UtbGluZT0iNjMiIGRhdGEtdWlkPSJsbmszMiIgaWQ9ImxpbmtfTW92ZVB1eW9fVG91Y2hDb250cm9sIj48cGF0aCBkPSJNMjgwLjA3LDE5MS45OCBDMjgwLjA3LDE3Ni42OCAyODAuMDcsMTQxLjcxIDI4MC4wNywxNDEuNzEgQzI4MC4wNywxNDEuNzEgMzQwLjg0LDE0MS43MSAzODcuMDEsMTQxLjcxIiBmaWxsPSJub25lIiBpZD0iTW92ZVB1eW8tdG8tVG91Y2hDb250cm9sIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzOTMuMDEsMTQxLjcxLDM4NC4wMSwxMzcuNzEsMzg4LjAxLDE0MS43MSwzODQuMDEsMTQ1LjcxLDM5My4wMSwxNDEuNzEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MS4xODUxIiB4PSIzMTIuNDEiIHk9IjE1NC43NzY5Ij4mIzE3MTtleHRlbmQmIzE4Nzs8L3RleHQ+PC9nPjwhLS1saW5rIFJvdGF0ZVB1eW8gdG8gS2V5Ym9hcmRDb250cm9sLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlJvdGF0ZVB1eW8iIGRhdGEtZW50aXR5LTI9IktleWJvYXJkQ29udHJvbCIgZGF0YS1zb3VyY2UtbGluZT0iNjQiIGRhdGEtdWlkPSJsbmszMyIgaWQ9ImxpbmtfUm90YXRlUHV5b19LZXlib2FyZENvbnRyb2wiPjxwYXRoIGQ9Ik0yNTcuMDIsMTI0LjI5IEMzMDUuMDMsMTI0LjI5IDM3Ni4wNywxMjQuMjkgMzc2LjA3LDEyNC4yOSBDMzc2LjA3LDEyNC4yOSAzNzYuMDcsOTkuMDYgMzc2LjA3LDgyLjcyIiBmaWxsPSJub25lIiBpZD0iUm90YXRlUHV5by10by1LZXlib2FyZENvbnRyb2wiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM3Ni4wNyw3Ni43MiwzNzIuMDcsODUuNzIsMzc2LjA3LDgxLjcyLDM4MC4wNyw4NS43MiwzNzYuMDcsNzYuNzIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MS4xODUxIiB4PSIyNzguMzMiIHk9IjEyMC4zNTY5Ij4mIzE3MTtleHRlbmQmIzE4Nzs8L3RleHQ+PC9nPjwhLS1saW5rIFJvdGF0ZVB1eW8gdG8gVG91Y2hDb250cm9sLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlJvdGF0ZVB1eW8iIGRhdGEtZW50aXR5LTI9IlRvdWNoQ29udHJvbCIgZGF0YS1zb3VyY2UtbGluZT0iNjUiIGRhdGEtdWlkPSJsbmszNCIgaWQ9ImxpbmtfUm90YXRlUHV5b19Ub3VjaENvbnRyb2wiPjxwYXRoIGQ9Ik0yNjUuOCwxMzUuOSBDMzAxLjQyLDEzNS45IDM0Mi41NSwxMzUuOSAzNzguMTksMTM1LjkiIGZpbGw9Im5vbmUiIGlkPSJSb3RhdGVQdXlvLXRvLVRvdWNoQ29udHJvbCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzg0LjE5LDEzNS45LDM3NS4xOSwxMzEuOSwzNzkuMTksMTM1LjksMzc1LjE5LDEzOS45LDM4NC4xOSwxMzUuOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYxLjE4NTEiIHg9IjMyNS45OSIgeT0iMTMxLjk2NjkiPiYjMTcxO2V4dGVuZCYjMTg3OzwvdGV4dD48L2c+PCEtLWxpbmsgUXVpY2tEcm9wUHV5byB0byBLZXlib2FyZENvbnRyb2wtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iUXVpY2tEcm9wUHV5byIgZGF0YS1lbnRpdHktMj0iS2V5Ym9hcmRDb250cm9sIiBkYXRhLXNvdXJjZS1saW5lPSI2NiIgZGF0YS11aWQ9ImxuazM1IiBpZD0ibGlua19RdWlja0Ryb3BQdXlvX0tleWJvYXJkQ29udHJvbCI+PHBhdGggZD0iTTI4Ni43Miw2NyBDMzExLjM4LDY3IDMzMi45Miw2NyAzNTcuNTYsNjciIGZpbGw9Im5vbmUiIGlkPSJRdWlja0Ryb3BQdXlvLXRvLUtleWJvYXJkQ29udHJvbCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzYzLjU2LDY3LDM1NC41Niw2MywzNTguNTYsNjcsMzU0LjU2LDcxLDM2My41Niw2NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYxLjE4NTEiIHg9IjI2My4xNCIgeT0iODAuMDY2OSI+JiMxNzE7ZXh0ZW5kJiMxODc7PC90ZXh0PjwvZz48IS0tbGluayBRdWlja0Ryb3BQdXlvIHRvIFRvdWNoQ29udHJvbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJRdWlja0Ryb3BQdXlvIiBkYXRhLWVudGl0eS0yPSJUb3VjaENvbnRyb2wiIGRhdGEtc291cmNlLWxpbmU9IjY3IiBkYXRhLXVpZD0ibG5rMzYiIGlkPSJsaW5rX1F1aWNrRHJvcFB1eW9fVG91Y2hDb250cm9sIj48cGF0aCBkPSJNMjczLjA3LDc3LjE0IEMyNzMuMDcsOTQuOTcgMjczLjA3LDEzMC4xIDI3My4wNywxMzAuMSBDMjczLjA3LDEzMC4xIDMzMC43MywxMzAuMSAzNzguNDgsMTMwLjEiIGZpbGw9Im5vbmUiIGlkPSJRdWlja0Ryb3BQdXlvLXRvLVRvdWNoQ29udHJvbCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzg0LjQ4LDEzMC4xLDM3NS40OCwxMjYuMSwzNzkuNDgsMTMwLjEsMzc1LjQ4LDEzNC4xLDM4NC40OCwxMzAuMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYxLjE4NTEiIHg9IjI0MC4yOSIgeT0iMTQzLjE2NjkiPiYjMTcxO2V4dGVuZCYjMTg3OzwvdGV4dD48L2c+PCEtLWxpbmsgRXJhc2VQdXlvIHRvIENoYWluUmVhY3Rpb24tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iRXJhc2VQdXlvIiBkYXRhLWVudGl0eS0yPSJDaGFpblJlYWN0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSI3MCIgZGF0YS11aWQ9ImxuazM3IiBpZD0ibGlua19FcmFzZVB1eW9fQ2hhaW5SZWFjdGlvbiI+PHBhdGggZD0iTTIxNC4wNywyNzcuMzYgQzIxNC4wNywyNjcuMzkgMjE0LjA3LDI1NiAyMTQuMDcsMjU2IEMyMTQuMDcsMjU2IDI5Ny41MSwyNTYgMzYyLjg0LDI1NiIgZmlsbD0ibm9uZSIgaWQ9IkVyYXNlUHV5by10by1DaGFpblJlYWN0aW9uIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNjguODQsMjU2LDM1OS44NCwyNTIsMzYzLjg0LDI1NiwzNTkuODQsMjYwLDM2OC44NCwyNTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2My4wMDY4IiB4PSIyMTYuNzciIHk9IjI2OS4wNjY5Ij4mIzE3MTtpbmNsdWRlJiMxODc7PC90ZXh0PjwvZz48IS0tbGluayBDaGFpblJlYWN0aW9uIHRvIERpc3BsYXlTY29yZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJDaGFpblJlYWN0aW9uIiBkYXRhLWVudGl0eS0yPSJEaXNwbGF5U2NvcmUiIGRhdGEtc291cmNlLWxpbmU9IjcxIiBkYXRhLXVpZD0ibG5rMzgiIGlkPSJsaW5rX0NoYWluUmVhY3Rpb25fRGlzcGxheVNjb3JlIj48cGF0aCBkPSJNNDkzLjU2LDI0Ny42NSBDNTIzLjAxLDI0Ny42NSA1NTIuNjUsMjQ3LjY1IDU4MS41OCwyNDcuNjUiIGZpbGw9Im5vbmUiIGlkPSJDaGFpblJlYWN0aW9uLXRvLURpc3BsYXlTY29yZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTg3LjU4LDI0Ny42NSw1NzguNTgsMjQzLjY1LDU4Mi41OCwyNDcuNjUsNTc4LjU4LDI1MS42NSw1ODcuNTgsMjQ3LjY1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjMuMDA2OCIgeD0iNTQxLjU3IiB5PSIyNDMuNzE2OSI+JiMxNzE7aW5jbHVkZSYjMTg3OzwvdGV4dD48L2c+PCEtLWxpbmsgWmVua2VzaGlCb251cyB0byBEaXNwbGF5U2NvcmUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iWmVua2VzaGlCb251cyIgZGF0YS1lbnRpdHktMj0iRGlzcGxheVNjb3JlIiBkYXRhLXNvdXJjZS1saW5lPSI3MiIgZGF0YS11aWQ9ImxuazM5IiBpZD0ibGlua19aZW5rZXNoaUJvbnVzX0Rpc3BsYXlTY29yZSI+PHBhdGggZD0iTTUxNC4wNywzMTguNjcgQzUxNC4wNywzMDAuNTMgNTE0LjA3LDI1NSA1MTQuMDcsMjU1IEM1MTQuMDcsMjU1IDU0MS4xOSwyNTUgNTczLjY4LDI1NSIgZmlsbD0ibm9uZSIgaWQ9Ilplbmtlc2hpQm9udXMtdG8tRGlzcGxheVNjb3JlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NzkuNjgsMjU1LDU3MC42OCwyNTEsNTc0LjY4LDI1NSw1NzAuNjgsMjU5LDU3OS42OCwyNTUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2My4wMDY4IiB4PSI1MTYuMDQiIHk9IjI2OC4wNjY5Ij4mIzE3MTtpbmNsdWRlJiMxODc7PC90ZXh0PjwvZz48IS0tbGluayBHYW1lT3ZlckNoZWNrIHRvIEdhbWVPdmVyQW5pbWF0aW9uLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkdhbWVPdmVyQ2hlY2siIGRhdGEtZW50aXR5LTI9IkdhbWVPdmVyQW5pbWF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSI3MyIgZGF0YS11aWQ9ImxuazQwIiBpZD0ibGlua19HYW1lT3ZlckNoZWNrX0dhbWVPdmVyQW5pbWF0aW9uIj48cGF0aCBkPSJNMjg4Ljg4LDM5Mi41IEMzMTIuMTcsMzkyLjUgMzMxLjg0LDM5Mi41IDM1NS4xNCwzOTIuNSIgZmlsbD0ibm9uZSIgaWQ9IkdhbWVPdmVyQ2hlY2stdG8tR2FtZU92ZXJBbmltYXRpb24iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM2MS4xNCwzOTIuNSwzNTIuMTQsMzg4LjUsMzU2LjE0LDM5Mi41LDM1Mi4xNCwzOTYuNSwzNjEuMTQsMzkyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2My4wMDY4IiB4PSIzMjYuMDEiIHk9IjM4OC41NjY5Ij4mIzE3MTtpbmNsdWRlJiMxODc7PC90ZXh0PjwvZz48IS0tU1JDPVtiTEhUSm5EMTU3dFZOcDdublFWbzBtbVhLSjAtNjFOMTl6XzZ4VFhra2pyZlRnVGVPcVpTTlM0QTBhdDVEV2VnOEZBZmc2MTRBSHlfUFpmVC1ZLVNkUU5SY0hQSUo5ZmNDX1VTVXktenZ5d093MzQxMTBGUklBSzlJMWVzcWVjMUJTdDk2NU9Fc1owQlNiM0ZtMUdROUdLSldKMENoUEk5OTgxZk04V0tTV1hXY3dJbmZicTVyNWtYdGRWZ2RMM19hQmV4UkVUelNCb2ZHUHJXNnJvWFZmTndOd2N0SWR0LUV4bTJlMEU2SkxYMFRlcG16Z2R0Yl9nSnI1eUl1VDYyR3IxTXEtQmc3RURvSkY3aXR6aUQyX2JCQWw2UEhkMEFhSklvLU1TZXdXbUx4Mm03ZlNiY1BRTnZfM0ROSF9zcnk5cHBsOV9IWHZQdGEwdVROZ0xILUs3VEFkTFZJMk5BcFNlcU12LUVYMTVlYXhsZW9Jc09ITXNNM0FSLWJhV2pIazROMU1pNEVJNUZhQ1FyM2ZNWWV5UVJjVmhIdWdLYWphUEdQbGpoUjZ3RmtqbDFVZXJEbG5NTHhrMG5EOW1sdUZGVzJuekZRb2tIN2FtV2tHV05fNWZnTDNVZkV0VFFFZ2hfWVRnLWRwVnFwOTJEU3VCSnJLQlNWaWxmX3NrYXlSbDhQY2tZcTRzUlhySFhGNTVwamlCY1BqWjlPWVpsdEs0bV9xYzAxekZHaTRPR1oxT3U5aDI5M1B1bmpENVY1QmdjSEZyb0NCRkJaZ2syLUgxUDZVSWFaSGxPb1prb1pub3Q5dlF2VkJneTRRbVUyRklHdVVKdWxleGdzRXhzWnFyeU9MQ0Jic2xPLW9ScUhBZlVLTlN6aWJxS2tPcUFacDJxYXVGTzhaT3NQSFBWOVBfd2hXSC1XRkR3a2VOaWpnRHpBSXdmQXJ4VkJWNUh1bC1pa0NnbGlRV014a3N6Q01HRmZmNlV3SzVoN0N3cGJtU0F4UmZiUEE2bVEzcEtvV01nM205TjV5ZEtlYlMxOTE4M3dhTUpwa01oOTF0N1VvejNzcmlrZFFnaEIwS3czUDEyb2hXeDlqbk03LXlrdzR5YU1hLU9pZ0RvRzViMUVJMWxjdG9razcxVTg5d3A3MG10ekZLNEFzcnBhVktKSnNpRDJsSnJUUktDaGU3LVZsSUs4Mml2Q0EwWXZHY2VpRlFLVXdWaW01d1NMMzZmVHp2ay1DTWZuUEZ4V1JqTWhyS1l4eUFuakJxQnNRZmY4VHNtVDNFVkg5b2xuYUFxT2ZXQUxhdGswTE9EM2k3VHBZZ0NWbTAwXS0tPjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<p>この図を見ると、プレイヤーとシステムの役割分担がよくわかりますね。プレイヤーはゲームの開始や操作を担当し、システムはぷよの消去判定やスコア計算などの内部処理を担当しています。また、キーボード操作とタッチ操作は「拡張（extend）」関係にあり、ぷよの移動や回転などの基本操作を異なる入力方法で実現していることがわかります。</p>
<p>このようにユースケース図を作成することで、システムの全体像を把握し、実装すべき機能の関連性を明確にすることができます。それでは、実際のコード実装に進んでいきましょう！</p>
<h2 id="0">イテレーション0: 開発環境の準備<a class="headerlink" href="#0" title="Permanent link">&para;</a></h2>
<p>「いきなりコードを書き始める前に、まず環境を整えましょう！」実は、この準備がとても重要なんです。良い道具を揃えておくことで、後の作業がとてもスムーズになりますよ。</p>
<h3 id="_7">自動化から始めるテスト駆動開発<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>エピソード1ではテスト駆動開発のゴールが <strong>動作するきれいなコード</strong> であることを学びました。では、良いコードを書き続けるためには何が必要になるでしょうか？それは<a href="https://t-wada.hatenablog.jp/entry/clean-code-that-works">ソフトウェア開発の三種の神器</a>と呼ばれるものです。</p>
<blockquote>
<p>今日のソフトウェア開発の世界において絶対になければならない3つの技術的な柱があります。
三本柱と言ったり、三種の神器と言ったりしていますが、それらは</p>
<ul>
<li>
<p>バージョン管理</p>
</li>
<li>
<p>テスティング</p>
</li>
<li>
<p>自動化</p>
</li>
</ul>
<p>の3つです。</p>
<p>—  https://t-wada.hatenablog.jp/entry/clean-code-that-works </p>
</blockquote>
<p>これから、これら3つの神器を一つずつ準備していきます。「なんだか大変そう...」と思われるかもしれませんが、一度準備してしまえば、後は自動で動いてくれるので楽になりますよ！</p>
<h3 id="_8">プロジェクトの作成<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>まずは、Blazor WebAssemblyプロジェクトを作成しましょう。「どうやって作るの？」というと、.NET CLIを使います。コマンド一つで簡単に作れるんですよ！</p>
<div class="highlight"><pre><span></span><code><span class="c1"># プロジェクトディレクトリに移動</span>
<span class="nb">cd</span><span class="w"> </span>/workspaces/case-study-game-dev/app/csharp

<span class="c1"># Blazor WebAssemblyプロジェクトを作成</span>
dotnet<span class="w"> </span>new<span class="w"> </span>blazorwasm<span class="w"> </span>-n<span class="w"> </span>PuyoPuyoTDD<span class="w"> </span>-o<span class="w"> </span>PuyoPuyoTDD

<span class="c1"># テストプロジェクトを作成</span>
dotnet<span class="w"> </span>new<span class="w"> </span>xunit<span class="w"> </span>-n<span class="w"> </span>PuyoPuyoTDD.Tests<span class="w"> </span>-o<span class="w"> </span>PuyoPuyoTDD.Tests

<span class="c1"># ソリューションファイルを作成</span>
dotnet<span class="w"> </span>new<span class="w"> </span>sln<span class="w"> </span>-n<span class="w"> </span>PuyoPuyoTDD

<span class="c1"># プロジェクトをソリューションに追加</span>
dotnet<span class="w"> </span>sln<span class="w"> </span>add<span class="w"> </span>PuyoPuyoTDD/PuyoPuyoTDD.csproj
dotnet<span class="w"> </span>sln<span class="w"> </span>add<span class="w"> </span>PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj

<span class="c1"># テストプロジェクトからメインプロジェクトへの参照を追加</span>
<span class="nb">cd</span><span class="w"> </span>PuyoPuyoTDD.Tests
dotnet<span class="w"> </span>add<span class="w"> </span>reference<span class="w"> </span>../PuyoPuyoTDD/PuyoPuyoTDD.csproj
<span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<p>「たくさんコマンドがあるなぁ...」と思われるかもしれませんが、一つずつ見ていきましょう：</p>
<ol>
<li><code>dotnet new blazorwasm</code> - Blazor WebAssemblyのプロジェクトを作成します</li>
<li><code>dotnet new xunit</code> - xUnitのテストプロジェクトを作成します</li>
<li><code>dotnet new sln</code> - ソリューションファイルを作成します（複数のプロジェクトをまとめて管理するため）</li>
<li><code>dotnet sln add</code> - プロジェクトをソリューションに追加します</li>
<li><code>dotnet add reference</code> - テストプロジェクトからメインプロジェクトを参照できるようにします</li>
</ol>
<p>これでプロジェクトの基本構造ができました！</p>
<h3 id="_9">バージョン管理<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<h4 id="git">Gitリポジトリの初期化<a class="headerlink" href="#git" title="Permanent link">&para;</a></h4>
<p>次に、バージョン管理の準備をしましょう。「バージョン管理って何？」という方もいるかもしれませんね。簡単に言うと、「コードの変更履歴を記録して、いつでも過去の状態に戻れるようにする仕組み」なんです。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Gitリポジトリを初期化（まだの場合）</span>
<span class="c1"># 既にリポジトリがある場合はスキップ</span>

<span class="c1"># .gitignoreファイルを作成</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>.gitignore<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">## Ignore Visual Studio temporary files, build results, and</span>
<span class="s">## files generated by popular Visual Studio add-ons.</span>

<span class="s"># User-specific files</span>
<span class="s">*.suo</span>
<span class="s">*.user</span>
<span class="s">*.userosscache</span>
<span class="s">*.sln.docstates</span>

<span class="s"># Build results</span>
<span class="s">[Dd]ebug/</span>
<span class="s">[Dd]ebugPublic/</span>
<span class="s">[Rr]elease/</span>
<span class="s">[Rr]eleases/</span>
<span class="s">x64/</span>
<span class="s">x86/</span>
<span class="s">[Bb]in/</span>
<span class="s">[Oo]bj/</span>

<span class="s"># Visual Studio cache/options directory</span>
<span class="s">.vs/</span>

<span class="s"># Test results</span>
<span class="s">[Tt]est[Rr]esult*/</span>
<span class="s">[Bb]uild[Ll]og.*</span>

<span class="s"># Coverage reports</span>
<span class="s">coverage/</span>
<span class="s">TestResults/</span>

<span class="s"># NuGet Packages</span>
<span class="s">*.nupkg</span>
<span class="s">.nuget/</span>
<span class="s">EOF</span>
</code></pre></div>
<p><code>.gitignore</code>ファイルは、「このファイルはGitで管理しなくていいよ」と指定するためのファイルです。ビルド結果やテスト結果など、自動生成されるファイルは管理する必要がないですからね。</p>
<h4 id="_10">コミットメッセージの規約<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>Gitでコードを記録するとき、「コミットメッセージ」というものを書きます。「どんなふうに書けばいいの？」という疑問があるかもしれませんね。実は、わかりやすいメッセージを書くための規約があるんです。</p>
<p>これまで作業の区切りごとにリポジトリにコミットしていましたが、その際に以下のような書式でメッセージを書いていきます：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;feat: 新機能を追加&#39;</span>
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;fix: バグを修正&#39;</span>
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;refactor: コードをリファクタリング&#39;</span>
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;test: テストを追加&#39;</span>
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;chore: ビルド設定を変更&#39;</span>
</code></pre></div>
<p>この書式は <a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#type">Angularルール</a>に従っています。具体的には、それぞれのコミットメッセージはヘッダ、ボディ、フッタで構成されています。ヘッダはタイプ、スコープ、タイトルというフォーマットで構成されています。</p>
<div class="highlight"><pre><span></span><code>&lt;タイプ&gt;(&lt;スコープ&gt;): &lt;タイトル&gt;
&lt;空行&gt;
&lt;ボディ&gt;
&lt;空行&gt;
&lt;フッタ&gt;
</code></pre></div>
<p>ヘッダは必須です。ヘッダのスコープは任意です。コミットメッセージの長さは50文字までにしてください（そうすることでその他のGitツールと同様にGitHub上で読みやすくなります）。</p>
<p>コミットのタイプは次を用いて下さい：</p>
<ul>
<li><strong>feat</strong>: 新しい機能の追加</li>
<li><strong>fix</strong>: バグ修正</li>
<li><strong>docs</strong>: ドキュメント変更のみ</li>
<li><strong>style</strong>: コードに影響を与えない変更（フォーマット、セミコロンの欠落など）</li>
<li><strong>refactor</strong>: 機能追加でもバグ修正でもないコード変更</li>
<li><strong>perf</strong>: パフォーマンスを改善するコード変更</li>
<li><strong>test</strong>: 存在しないテストの追加、または既存のテストの修正</li>
<li><strong>chore</strong>: ドキュメント生成のような、補助ツールやライブラリやビルドプロセスの変更</li>
</ul>
<p>「なるほど、こうやって書けば、後から見たときに何をしたかがすぐわかりますね！」その通りです！</p>
<p>では、最初のコミットをしてみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>PuyoPuyoTDD
git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;chore: プロジェクトの初期設定&#39;</span>
</code></pre></div>
<h3 id="_11">パッケージマネージャ<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>では <strong>自動化</strong> の準備に入りたいのですが、そのためにはいくつかの外部ライブラリを利用する必要があります。.NETでは <strong>NuGet</strong> がパッケージマネージャとしての役割を果たします。</p>
<blockquote>
<p>NuGetとは、.NET用のパッケージマネージャーです。開発者が作成・共有したライブラリやツールを「パッケージ」として配布・利用することができます。</p>
</blockquote>
<p><strong>NuGet</strong>を使ってパッケージをインストールするのは簡単です：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># テストプロジェクトに必要なパッケージを追加</span>
<span class="nb">cd</span><span class="w"> </span>PuyoPuyoTDD.Tests
dotnet<span class="w"> </span>add<span class="w"> </span>package<span class="w"> </span>bunit
dotnet<span class="w"> </span>add<span class="w"> </span>package<span class="w"> </span>bunit.web
dotnet<span class="w"> </span>add<span class="w"> </span>package<span class="w"> </span>Microsoft.NET.Test.Sdk
<span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<p>「bunitって何？」と思われるかもしれませんね。bunitはBlazorコンポーネントのテストを支援するライブラリです。「BlazorでテストするならbUnit」と覚えておくといいですよ！</p>
<p>C#/.NETプロジェクトでは、プロジェクトファイル（<code>.csproj</code>）にパッケージの依存関係が記述されます。これにより、プロジェクトをクローンした際に <code>dotnet restore</code> を実行するだけで必要なパッケージが自動的にインストールされます。便利ですよね！</p>
<p>実際にプロジェクトファイルを見てみましょう：</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Project</span><span class="w"> </span><span class="na">Sdk=</span><span class="s">&quot;Microsoft.NET.Sdk&quot;</span><span class="nt">&gt;</span>

<span class="w">  </span><span class="nt">&lt;PropertyGroup&gt;</span>
<span class="w">    </span><span class="nt">&lt;TargetFramework&gt;</span>net8.0<span class="nt">&lt;/TargetFramework&gt;</span>
<span class="w">    </span><span class="nt">&lt;ImplicitUsings&gt;</span>enable<span class="nt">&lt;/ImplicitUsings&gt;</span>
<span class="w">    </span><span class="nt">&lt;Nullable&gt;</span>enable<span class="nt">&lt;/Nullable&gt;</span>
<span class="w">    </span><span class="nt">&lt;IsPackable&gt;</span>false<span class="nt">&lt;/IsPackable&gt;</span>
<span class="w">  </span><span class="nt">&lt;/PropertyGroup&gt;</span>

<span class="w">  </span><span class="nt">&lt;ItemGroup&gt;</span>
<span class="w">    </span><span class="nt">&lt;PackageReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">&quot;bunit&quot;</span><span class="w"> </span><span class="na">Version=</span><span class="s">&quot;1.26.64&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;PackageReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">&quot;bunit.web&quot;</span><span class="w"> </span><span class="na">Version=</span><span class="s">&quot;1.26.64&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;PackageReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">&quot;Microsoft.NET.Test.Sdk&quot;</span><span class="w"> </span><span class="na">Version=</span><span class="s">&quot;17.8.0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;PackageReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">&quot;xunit&quot;</span><span class="w"> </span><span class="na">Version=</span><span class="s">&quot;2.6.2&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;PackageReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">&quot;xunit.runner.visualstudio&quot;</span><span class="w"> </span><span class="na">Version=</span><span class="s">&quot;2.5.4&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;IncludeAssets&gt;</span>runtime;<span class="w"> </span>build;<span class="w"> </span>native;<span class="w"> </span>contentfiles;<span class="w"> </span>analyzers;<span class="w"> </span>buildtransitive<span class="nt">&lt;/IncludeAssets&gt;</span>
<span class="w">      </span><span class="nt">&lt;PrivateAssets&gt;</span>all<span class="nt">&lt;/PrivateAssets&gt;</span>
<span class="w">    </span><span class="nt">&lt;/PackageReference&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ItemGroup&gt;</span>

<span class="w">  </span><span class="nt">&lt;ItemGroup&gt;</span>
<span class="w">    </span><span class="nt">&lt;ProjectReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">&quot;..\PuyoPuyoTDD\PuyoPuyoTDD.csproj&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ItemGroup&gt;</span>

<span class="nt">&lt;/Project&gt;</span>
</code></pre></div>
<p>「こうやって見ると、どんなパッケージを使っているかが一目瞭然ですね！」その通りです！</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;chore: テスト用パッケージの追加&#39;</span>
</code></pre></div>
<h3 id="_12">静的コード解析<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>良いコードを書き続けるためには、コードの品質を維持していく必要があります。<strong>テスト駆動開発</strong>によりプログラムを動かしながら品質を改善していきますが、出来上がったコードに対する品質チェックの方法として<strong>静的コード解析</strong>があります。</p>
<p>C#/.NET用の<strong>静的コード解析</strong>ツールとして<a href="https://github.com/dotnet/roslyn-analyzers">Microsoft.CodeAnalysis.Analyzers</a>を使って確認してみましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># アナライザパッケージをインストール</span>
<span class="nb">cd</span><span class="w"> </span>PuyoPuyoTDD
dotnet<span class="w"> </span>add<span class="w"> </span>package<span class="w"> </span>Microsoft.CodeAnalysis.Analyzers
<span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<p>次に、コード分析の設定ファイルを作成します。<code>.editorconfig</code>ファイルでコーディングスタイルを定義できます：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># PuyoPuyoTDDディレクトリに.editorconfigを作成</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>.editorconfig<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">root = true</span>

<span class="s">[*]</span>
<span class="s">indent_style = space</span>
<span class="s">indent_size = 4</span>
<span class="s">end_of_line = crlf</span>
<span class="s">charset = utf-8</span>
<span class="s">trim_trailing_whitespace = true</span>
<span class="s">insert_final_newline = true</span>

<span class="s">[*.cs]</span>
<span class="s"># C# coding conventions</span>
<span class="s">dotnet_sort_using_directives = true</span>
<span class="s">dotnet_separate_import_directive_groups = false</span>

<span class="s"># Language rules</span>
<span class="s">csharp_prefer_var = false:suggestion</span>
<span class="s">csharp_prefer_braces = true:warning</span>

<span class="s"># Code quality rules</span>
<span class="s">dotnet_diagnostic.CA1502.severity = warning</span>
<span class="s"># CA1502: メソッドの循環的複雑度を7以下に制限</span>
<span class="s">dotnet_code_quality.CA1502.cyclomatic_complexity = 7</span>

<span class="s"># Naming conventions</span>
<span class="s">dotnet_naming_rule.interface_should_be_begins_with_i.severity = warning</span>
<span class="s">dotnet_naming_rule.interface_should_be_begins_with_i.symbols = interface</span>
<span class="s">dotnet_naming_rule.interface_should_be_begins_with_i.style = begins_with_i</span>

<span class="s">dotnet_naming_rule.types_should_be_pascal_case.severity = warning</span>
<span class="s">dotnet_naming_rule.types_should_be_pascal_case.symbols = types</span>
<span class="s">dotnet_naming_rule.types_should_be_pascal_case.style = pascal_case</span>

<span class="s">dotnet_naming_symbols.interface.applicable_kinds = interface</span>
<span class="s">dotnet_naming_symbols.interface.applicable_accessibilities = public, internal, private, protected, protected_internal, private_protected</span>

<span class="s">dotnet_naming_symbols.types.applicable_kinds = class, struct, interface, enum</span>
<span class="s">dotnet_naming_symbols.types.applicable_accessibilities = public, internal, private, protected, protected_internal, private_protected</span>

<span class="s">dotnet_naming_style.begins_with_i.required_prefix = I</span>
<span class="s">dotnet_naming_style.begins_with_i.capitalization = pascal_case</span>

<span class="s">dotnet_naming_style.pascal_case.capitalization = pascal_case</span>
<span class="s">EOF</span>
</code></pre></div>
<p>「.editorconfigって何？」と思われるかもしれませんね。これは、コーディングスタイル（インデントの幅や命名規則など）を定義するファイルです。チーム全体で同じスタイルを共有できるので、「この人のコードは読みにくいな...」という問題が減りますよ！</p>
<p><strong>循環複雑度について</strong></p>
<p>ここで設定している<code>cyclomatic_complexity = 7</code>について少し説明しましょう。循環複雑度（Cyclomatic Complexity）とは、コードの複雑さを測る指標の一つです。</p>
<blockquote>
<p>循環複雑度とは、プログラムの制御フローの複雑さを測る指標です。if文、for文、while文などの分岐や繰り返しが増えるほど、この値は大きくなります。値が高いほどコードの理解が難しく、バグが混入しやすくなります。</p>
<p>— Thomas J. McCabe 『A Complexity Measure』</p>
</blockquote>
<p>一般的な目安として：
- <strong>1-7</strong>: シンプルで理解しやすい（推奨）
- <strong>8-10</strong>: やや複雑、注意が必要
- <strong>11以上</strong>: 複雑すぎる、リファクタリング推奨</p>
<p>「なぜ7なの？」と思われるかもしれませんね。これは、人間が一度に理解できる情報の量（マジカルナンバー7±2）に基づいた経験則です。メソッドの循環複雑度を7以下に保つことで、コードの理解しやすさとテストのしやすさを維持できます。</p>
<p>コード分析を実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>build
</code></pre></div>
<p>「ビルドするだけで静的コード解析もしてくれるんですね！」その通りです。そして、もしメソッドが複雑すぎる場合（循環複雑度が7を超える場合）、警告が表示されますよ！</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;chore: 静的コード解析の設定&#39;</span>
</code></pre></div>
<h3 id="lint">Lintツール<a class="headerlink" href="#lint" title="Permanent link">&para;</a></h3>
<p><strong>静的コード解析</strong>に加えて、より詳細なコード品質チェックを行うために<strong>Lintツール</strong>を導入しましょう。C#/.NETでは、追加のアナライザパッケージを導入することで、より厳密なコードチェックが可能になります。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># より厳密なコード品質チェックのためのアナライザを追加</span>
<span class="nb">cd</span><span class="w"> </span>PuyoPuyoTDD
dotnet<span class="w"> </span>add<span class="w"> </span>package<span class="w"> </span>Microsoft.CodeAnalysis.NetAnalyzers
dotnet<span class="w"> </span>add<span class="w"> </span>package<span class="w"> </span>StyleCop.Analyzers
<span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<p>「StyleCop.Analyzersって何？」と思われるかもしれませんね。StyleCopは、C#のコーディング規約を自動的にチェックしてくれるツールです。「命名規則は守られているか？」「ドキュメントコメントは書かれているか？」などをチェックしてくれますよ。</p>
<h4 id="stylecop">StyleCopの設定<a class="headerlink" href="#stylecop" title="Permanent link">&para;</a></h4>
<p>StyleCopの動作をカスタマイズするために、<code>stylecop.json</code>ファイルを作成しましょう：</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>&gt;<span class="w"> </span>PuyoPuyoTDD/stylecop.json<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">{</span>
<span class="s">  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/DotNetAnalyzers/StyleCopAnalyzers/master/StyleCop.Analyzers/StyleCop.Analyzers/Settings/stylecop.schema.json&quot;,</span>
<span class="s">  &quot;settings&quot;: {</span>
<span class="s">    &quot;documentationRules&quot;: {</span>
<span class="s">      &quot;companyName&quot;: &quot;PuyoPuyoTDD&quot;,</span>
<span class="s">      &quot;copyrightText&quot;: &quot;Copyright (c) {companyName}. All rights reserved.&quot;,</span>
<span class="s">      &quot;documentExposedElements&quot;: true,</span>
<span class="s">      &quot;documentInternalElements&quot;: false,</span>
<span class="s">      &quot;documentPrivateElements&quot;: false,</span>
<span class="s">      &quot;documentInterfaces&quot;: true,</span>
<span class="s">      &quot;documentPrivateFields&quot;: false</span>
<span class="s">    },</span>
<span class="s">    &quot;namingRules&quot;: {</span>
<span class="s">      &quot;allowCommonHungarianPrefixes&quot;: false,</span>
<span class="s">      &quot;allowedHungarianPrefixes&quot;: []</span>
<span class="s">    },</span>
<span class="s">    &quot;orderingRules&quot;: {</span>
<span class="s">      &quot;usingDirectivesPlacement&quot;: &quot;outsideNamespace&quot;,</span>
<span class="s">      &quot;systemUsingDirectivesFirst&quot;: true,</span>
<span class="s">      &quot;blankLinesBetweenUsingGroups&quot;: &quot;allow&quot;</span>
<span class="s">    },</span>
<span class="s">    &quot;layoutRules&quot;: {</span>
<span class="s">      &quot;newlineAtEndOfFile&quot;: &quot;require&quot;</span>
<span class="s">    },</span>
<span class="s">    &quot;maintainabilityRules&quot;: {</span>
<span class="s">      &quot;topLevelTypes&quot;: &quot;multiple&quot;</span>
<span class="s">    }</span>
<span class="s">  }</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p>次に、プロジェクトファイルでStyleCopを有効にします：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># PuyoPuyoTDD.csprojにStyleCop設定を追加</span>
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>PuyoPuyoTDD/PuyoPuyoTDD.csproj<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>

<span class="s">  &lt;ItemGroup&gt;</span>
<span class="s">    &lt;AdditionalFiles Include=&quot;stylecop.json&quot; /&gt;</span>
<span class="s">  &lt;/ItemGroup&gt;</span>
<span class="s">EOF</span>
</code></pre></div>
<p>「stylecop.jsonは何を設定しているんですか？」良い質問です！このファイルでは、以下のようなルールを設定しています：</p>
<ul>
<li><strong>documentationRules</strong>: ドキュメントコメントに関するルール（public要素にはコメントを必須にするなど）</li>
<li><strong>namingRules</strong>: 命名規則（ハンガリアン記法を許可するかなど）</li>
<li><strong>orderingRules</strong>: using文の並び順に関するルール</li>
<li><strong>layoutRules</strong>: レイアウトに関するルール（ファイル末尾の改行など）</li>
<li><strong>maintainabilityRules</strong>: 保守性に関するルール</li>
</ul>
<h4 id="editorconfiglint">.editorconfigでのLint設定の追加<a class="headerlink" href="#editorconfiglint" title="Permanent link">&para;</a></h4>
<p>既存の<code>.editorconfig</code>にStyleCopのルールレベルを追加しましょう：</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>.editorconfig<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>

<span class="s"># StyleCop Analyzers rules</span>
<span class="s"># SA1600: Elements should be documented</span>
<span class="s">dotnet_diagnostic.SA1600.severity = suggestion</span>

<span class="s"># SA1633: File should have header</span>
<span class="s">dotnet_diagnostic.SA1633.severity = none</span>

<span class="s"># SA1101: Prefix local calls with this</span>
<span class="s">dotnet_diagnostic.SA1101.severity = none</span>

<span class="s"># SA1309: Field names should not begin with underscore</span>
<span class="s">dotnet_diagnostic.SA1309.severity = none</span>

<span class="s"># SA1200: Using directives should be placed correctly</span>
<span class="s">dotnet_diagnostic.SA1200.severity = warning</span>

<span class="s"># SA1208: System using directives should be placed before other using directives</span>
<span class="s">dotnet_diagnostic.SA1208.severity = warning</span>

<span class="s"># SA1210: Using directives should be ordered alphabetically by namespace</span>
<span class="s">dotnet_diagnostic.SA1210.severity = warning</span>

<span class="s"># CA1707: Identifiers should not contain underscores</span>
<span class="s">dotnet_diagnostic.CA1707.severity = none</span>

<span class="s"># CA1822: Mark members as static</span>
<span class="s">dotnet_diagnostic.CA1822.severity = suggestion</span>
<span class="s">EOF</span>
</code></pre></div>
<p>「たくさんのルールがありますね！」そうですね。これらのルールは、コードの一貫性と品質を保つために重要です。いくつか重要なものを説明しましょう：</p>
<ul>
<li><strong>SA1600</strong>: public要素にドキュメントコメントを付けることを推奨（suggestionレベル）</li>
<li><strong>SA1633</strong>: ファイルヘッダーは不要に設定（プロジェクトによって必要性が異なるため）</li>
<li><strong>SA1101</strong>: thisプレフィックスは不要に設定（C#の一般的な慣習に従う）</li>
<li><strong>SA1309</strong>: フィールド名のアンダースコアプレフィックスを許可（プライベートフィールドの慣習）</li>
<li><strong>SA1200-1210</strong>: using文の配置と順序に関する警告</li>
</ul>
<h4 id="lint_1">Lintの実行<a class="headerlink" href="#lint_1" title="Permanent link">&para;</a></h4>
<p>それでは、Lintを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ビルドとともにLintチェックが実行される</span>
dotnet<span class="w"> </span>build

<span class="c1"># より詳細な出力が必要な場合</span>
dotnet<span class="w"> </span>build<span class="w"> </span>/p:TreatWarningsAsErrors<span class="o">=</span><span class="nb">true</span>
</code></pre></div>
<p>「/p:TreatWarningsAsErrors=trueって何ですか？」これは、警告をエラーとして扱うオプションです。CI/CD環境で使うと、コード品質を強制的に維持できますよ！</p>
<p>Lintエラーや警告が表示された場合は、コードを修正しましょう。多くの場合、<code>dotnet format</code>で自動修正できます：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># フォーマットとともに自動修正可能な問題を修正</span>
dotnet<span class="w"> </span>format
</code></pre></div>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;chore: Lintツールの設定&#39;</span>
</code></pre></div>
<h3 id="_13">コードフォーマッタ<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p><strong>コードフォーマッタ</strong>は開発チーム内でのコーディングスタイルを統一するためのツールです。C#/.NETでは<code>dotnet format</code>コマンドが標準で提供されています。「わざわざインストールしなくていいんですか？」はい、最初から使えるんです！</p>
<p>コードのフォーマットを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>format
</code></pre></div>
<p>このコマンドにより、プロジェクト内のすべてのC#ファイルが<code>.editorconfig</code>で定義されたルールに従ってフォーマットされます。「自動で整形してくれるなんて楽ちんですね！」</p>
<p>フォーマットの確認のみを行いたい場合は：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>format<span class="w"> </span>--verify-no-changes
</code></pre></div>
<p>「これって何をチェックしてるんですか？」このコマンドは、コードがフォーマットルールに従っているかを確認だけして、実際には変更しません。CI/CD環境で使うと便利ですよ！</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;chore: コードフォーマッタの設定&#39;</span>
</code></pre></div>
<h3 id="_14">コードカバレッジ<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p><strong>コードカバレッジ</strong>はテストがプロダクションコードをどのくらいカバーしているかを測る指標です。「テストを書いたつもりだけど、実は重要な部分がテストされてなかった...」そんなことを防ぐために役立ちます。</p>
<p>C#/.NETでは<code>coverlet</code>がよく使われます：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># カバレッジツールをインストール</span>
<span class="nb">cd</span><span class="w"> </span>PuyoPuyoTDD.Tests
dotnet<span class="w"> </span>add<span class="w"> </span>package<span class="w"> </span>coverlet.collector
dotnet<span class="w"> </span>add<span class="w"> </span>package<span class="w"> </span>coverlet.msbuild
<span class="nb">cd</span><span class="w"> </span>..

<span class="c1"># レポート生成ツールをインストール</span>
dotnet<span class="w"> </span>tool<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>dotnet-reportgenerator-globaltool
</code></pre></div>
<p>「dotnet toolって何ですか？」良い質問です！dotnet toolは、.NET CLI用のグローバルツールを管理する仕組みです。一度インストールすれば、どこからでも使えるようになりますよ。</p>
<p>テストをカバレッジ付きで実行してみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># カバレッジを収集しながらテスト実行</span>
dotnet<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--collect:<span class="s2">&quot;XPlat Code Coverage&quot;</span><span class="w"> </span>--results-directory<span class="w"> </span>./TestResults

<span class="c1"># HTML形式のレポートを生成</span>
reportgenerator<span class="w"> </span>-reports:<span class="s2">&quot;./TestResults/**/coverage.cobertura.xml&quot;</span><span class="w"> </span>-targetdir:<span class="s2">&quot;coverage&quot;</span><span class="w"> </span>-reporttypes:Html
</code></pre></div>
<p>「生成された<code>coverage/index.html</code>をブラウザで開くとカバレッジレポートを確認できます！」カラフルなレポートでどこがテストされているか一目瞭然ですよ。</p>
<p>ワンコマンドでカバレッジレポートを生成するスクリプトを作成しましょう：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># PuyoPuyoTDDディレクトリにcoverage.shを作成</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>coverage.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>
<span class="s"># coverage.sh - コードカバレッジレポート生成スクリプト</span>

<span class="s">echo &quot;🧪 テスト実行とカバレッジ収集中...&quot;</span>
<span class="s">dotnet test --collect:&quot;XPlat Code Coverage&quot; --results-directory ./TestResults</span>

<span class="s">echo &quot;📊 カバレッジレポート生成中...&quot;</span>
<span class="s">reportgenerator -reports:&quot;./TestResults/**/coverage.cobertura.xml&quot; -targetdir:&quot;coverage&quot; -reporttypes:Html</span>

<span class="s">echo &quot;✅ カバレッジレポートが coverage/index.html に生成されました&quot;</span>
<span class="s">echo &quot;&quot;</span>
<span class="s">echo &quot;ブラウザで確認するには以下のコマンドを実行してください:&quot;</span>
<span class="s">echo &quot;  \$BROWSER coverage/index.html&quot;</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>coverage.sh
</code></pre></div>
<p>スクリプトを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>./coverage.sh
</code></pre></div>
<p>「スクリプト化すると、毎回長いコマンドを打たなくて済むから便利ですね！」その通りです！</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;chore: コードカバレッジの設定&#39;</span>
</code></pre></div>
<h3 id="_15">タスクランナー<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>良いコードを書き続けるために今まで色々なツールを導入してきましたが、毎回個別に実行するのは面倒です。「フォーマットして、ビルドして、テストして、カバレッジも確認して...」うんざりしちゃいますよね？</p>
<p>そこで<strong>タスクランナー</strong>の出番です！C#/.NETプロジェクトでは、<strong>Cake</strong>という強力なビルド自動化システムを使うことができます。</p>
<blockquote>
<p>Cakeとは、C#をDSL（ドメイン特化言語）として使用するクロスプラットフォームのビルドオートメーションシステムです。Make、Rake、PSakeと同様の概念ですが、C#の構文を活用できるため、.NET開発者にとって親しみやすいツールです。</p>
</blockquote>
<p>まず、Cakeをグローバルツールとしてインストールしましょう：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Cakeツールをインストール</span>
dotnet<span class="w"> </span>tool<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>Cake.Tool
</code></pre></div>
<p>次に、<code>build.cake</code>ファイルを作成して、よく使うタスクを定義しましょう：</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>&gt;<span class="w"> </span>build.cake<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">///////////////////////////////////////////////////////////////////////////////</span>
<span class="s">// ARGUMENTS</span>
<span class="s">///////////////////////////////////////////////////////////////////////////////</span>

<span class="s">var target = Argument(&quot;target&quot;, &quot;Default&quot;);</span>
<span class="s">var configuration = Argument(&quot;configuration&quot;, &quot;Release&quot;);</span>

<span class="s">///////////////////////////////////////////////////////////////////////////////</span>
<span class="s">// SETUP / TEARDOWN</span>
<span class="s">///////////////////////////////////////////////////////////////////////////////</span>

<span class="s">Setup(ctx =&gt;</span>
<span class="s">{</span>
<span class="s">   Information(&quot;Running tasks...&quot;);</span>
<span class="s">   Information(&quot;Target: {0}&quot;, target);</span>
<span class="s">});</span>

<span class="s">Teardown(ctx =&gt;</span>
<span class="s">{</span>
<span class="s">   Information(&quot;Finished running tasks.&quot;);</span>
<span class="s">});</span>

<span class="s">///////////////////////////////////////////////////////////////////////////////</span>
<span class="s">// TASKS</span>
<span class="s">///////////////////////////////////////////////////////////////////////////////</span>

<span class="s">Task(&quot;Clean&quot;)</span>
<span class="s">    .Description(&quot;プロジェクトのクリーンアップ&quot;)</span>
<span class="s">    .Does(() =&gt;</span>
<span class="s">{</span>
<span class="s">    Information(&quot;クリーンアップを実行中...&quot;);</span>
<span class="s">    DotNetClean(&quot;./PuyoPuyoTDD.sln&quot;);</span>
<span class="s">    CleanDirectory(&quot;./coverage&quot;);</span>
<span class="s">    CleanDirectory(&quot;./TestResults&quot;);</span>
<span class="s">});</span>

<span class="s">Task(&quot;Restore&quot;)</span>
<span class="s">    .Description(&quot;NuGetパッケージの復元&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Clean&quot;)</span>
<span class="s">    .Does(() =&gt;</span>
<span class="s">{</span>
<span class="s">    Information(&quot;パッケージを復元中...&quot;);</span>
<span class="s">    DotNetRestore(&quot;./PuyoPuyoTDD.sln&quot;);</span>
<span class="s">});</span>

<span class="s">Task(&quot;Format&quot;)</span>
<span class="s">    .Description(&quot;コードフォーマットの実行&quot;)</span>
<span class="s">    .Does(() =&gt;</span>
<span class="s">{</span>
<span class="s">    Information(&quot;コードをフォーマット中...&quot;);</span>
<span class="s">    DotNetFormat(&quot;./PuyoPuyoTDD.sln&quot;);</span>
<span class="s">});</span>

<span class="s">Task(&quot;Build&quot;)</span>
<span class="s">    .Description(&quot;プロジェクトのビルド&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Restore&quot;)</span>
<span class="s">    .Does(() =&gt;</span>
<span class="s">{</span>
<span class="s">    Information(&quot;ビルドを実行中...&quot;);</span>
<span class="s">    DotNetBuild(&quot;./PuyoPuyoTDD.sln&quot;, new DotNetBuildSettings</span>
<span class="s">    {</span>
<span class="s">        Configuration = configuration,</span>
<span class="s">        NoRestore = true</span>
<span class="s">    });</span>
<span class="s">});</span>

<span class="s">Task(&quot;Lint&quot;)</span>
<span class="s">    .Description(&quot;コードのLintチェック&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Build&quot;)</span>
<span class="s">    .Does(() =&gt;</span>
<span class="s">{</span>
<span class="s">    Information(&quot;Lintチェックを実行中...&quot;);</span>

<span class="s">    // 警告をエラーとして扱ってビルド</span>
<span class="s">    var lintSettings = new DotNetBuildSettings</span>
<span class="s">    {</span>
<span class="s">        Configuration = configuration,</span>
<span class="s">        NoRestore = true,</span>
<span class="s">        MSBuildSettings = new DotNetMSBuildSettings()</span>
<span class="s">    };</span>
<span class="s">    lintSettings.MSBuildSettings.TreatAllWarningsAs = MSBuildTreatAllWarningsAs.Error;</span>

<span class="s">    try</span>
<span class="s">    {</span>
<span class="s">        DotNetBuild(&quot;./PuyoPuyoTDD.sln&quot;, lintSettings);</span>
<span class="s">        Information(&quot;✅ Lintチェックが成功しました&quot;);</span>
<span class="s">    }</span>
<span class="s">    catch</span>
<span class="s">    {</span>
<span class="s">        Warning(&quot;⚠️ Lintチェックで警告またはエラーが見つかりました&quot;);</span>
<span class="s">        throw;</span>
<span class="s">    }</span>
<span class="s">});</span>

<span class="s">Task(&quot;Test&quot;)</span>
<span class="s">    .Description(&quot;テストの実行&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Build&quot;)</span>
<span class="s">    .Does(() =&gt;</span>
<span class="s">{</span>
<span class="s">    Information(&quot;テストを実行中...&quot;);</span>
<span class="s">    DotNetTest(&quot;./PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj&quot;, new DotNetTestSettings</span>
<span class="s">    {</span>
<span class="s">        Configuration = configuration,</span>
<span class="s">        NoBuild = true,</span>
<span class="s">        NoRestore = true</span>
<span class="s">    });</span>
<span class="s">});</span>

<span class="s">Task(&quot;Coverage&quot;)</span>
<span class="s">    .Description(&quot;コードカバレッジの測定&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Build&quot;)</span>
<span class="s">    .Does(() =&gt;</span>
<span class="s">{</span>
<span class="s">    Information(&quot;カバレッジを測定中...&quot;);</span>

<span class="s">    // カバレッジ付きテスト実行</span>
<span class="s">    DotNetTest(&quot;./PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj&quot;, new DotNetTestSettings</span>
<span class="s">    {</span>
<span class="s">        Configuration = configuration,</span>
<span class="s">        NoBuild = true,</span>
<span class="s">        NoRestore = true,</span>
<span class="s">        ArgumentCustomization = args =&gt; args</span>
<span class="s">            .Append(&quot;--collect:\&quot;XPlat Code Coverage\&quot;&quot;)</span>
<span class="s">            .Append(&quot;--results-directory ./TestResults&quot;)</span>
<span class="s">    });</span>

<span class="s">    // レポート生成</span>
<span class="s">    Information(&quot;カバレッジレポートを生成中...&quot;);</span>
<span class="s">    StartProcess(&quot;reportgenerator&quot;, new ProcessSettings</span>
<span class="s">    {</span>
<span class="s">        Arguments = new ProcessArgumentBuilder()</span>
<span class="s">            .Append(&quot;-reports:./TestResults/**/coverage.cobertura.xml&quot;)</span>
<span class="s">            .Append(&quot;-targetdir:./coverage&quot;)</span>
<span class="s">            .Append(&quot;-reporttypes:Html&quot;)</span>
<span class="s">    });</span>

<span class="s">    Information(&quot;✅ カバレッジレポートが coverage/index.html に生成されました&quot;);</span>
<span class="s">});</span>

<span class="s">Task(&quot;Quality&quot;)</span>
<span class="s">    .Description(&quot;すべての品質チェックを実行&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Format&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Lint&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Build&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Test&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Coverage&quot;)</span>
<span class="s">    .Does(() =&gt;</span>
<span class="s">{</span>
<span class="s">    Information(&quot;✅ すべての品質チェックが完了しました！&quot;);</span>
<span class="s">});</span>

<span class="s">Task(&quot;Watch&quot;)</span>
<span class="s">    .Description(&quot;ファイル監視と自動ビルド・テスト&quot;)</span>
<span class="s">    .Does(() =&gt;</span>
<span class="s">{</span>
<span class="s">    Information(&quot;ファイル監視を開始します...&quot;);</span>
<span class="s">    Information(&quot;終了するには Ctrl+C を押してください&quot;);</span>

<span class="s">    var settings = new DotNetWatchSettings</span>
<span class="s">    {</span>
<span class="s">        Project = &quot;./PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj&quot;</span>
<span class="s">    };</span>

<span class="s">    DotNetWatch(&quot;test&quot;, settings);</span>
<span class="s">});</span>

<span class="s">Task(&quot;Default&quot;)</span>
<span class="s">    .Description(&quot;デフォルトタスク（Quality）&quot;)</span>
<span class="s">    .IsDependentOn(&quot;Quality&quot;);</span>

<span class="s">///////////////////////////////////////////////////////////////////////////////</span>
<span class="s">// EXECUTION</span>
<span class="s">///////////////////////////////////////////////////////////////////////////////</span>

<span class="s">RunTarget(target);</span>
<span class="s">EOF</span>
</code></pre></div>
<p>「このCakeファイルは何をしてくれるんですか？」良い質問です！このCakeファイルでは、以下のタスクを定義しています：</p>
<ul>
<li><strong>Clean</strong>: ビルド成果物とテスト結果をクリーンアップ</li>
<li><strong>Restore</strong>: NuGetパッケージを復元</li>
<li><strong>Format</strong>: コードをフォーマット</li>
<li><strong>Build</strong>: プロジェクトをビルド</li>
<li><strong>Lint</strong>: コードのLintチェック（警告をエラーとして扱う）</li>
<li><strong>Test</strong>: テストを実行</li>
<li><strong>Coverage</strong>: カバレッジを測定してレポート生成</li>
<li><strong>Quality</strong>: すべての品質チェックを実行（デフォルト）</li>
<li><strong>Watch</strong>: ファイル監視と自動テスト実行</li>
</ul>
<p>タスクを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># デフォルトタスク（Quality）を実行</span>
dotnet<span class="w"> </span>cake

<span class="c1"># 特定のタスクを実行</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Clean
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Format
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Build
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Lint
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Coverage

<span class="c1"># すべての品質チェックを実行</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Quality
</code></pre></div>
<p>「Cakeを使うと、C#の構文でビルドスクリプトが書けるので、.NET開発者にとってとても自然ですね！」その通りです！</p>
<p>Cakeの良いところは：</p>
<ol>
<li><strong>C#で書ける</strong>: .NET開発者にとって親しみやすい</li>
<li><strong>依存関係管理</strong>: タスク間の依存関係を自動で解決</li>
<li><strong>クロスプラットフォーム</strong>: Windows、Linux、macOSで動作</li>
<li><strong>豊富なエコシステム</strong>: 多くのアドインとヘルパーが利用可能</li>
</ol>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;chore: Cakeタスクランナーの設定&#39;</span>
</code></pre></div>
<h3 id="_16">タスクの自動化<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p><strong>Cake</strong>により品質をチェックするタスクは用意されましたが、まだ手動で実行する必要があります。「ファイルを保存するたびに自動でテストが走ったら便利なのにな...」と思いませんか？</p>
<p>実は、Cakeには<strong>Watch</strong>タスクを使って自動実行する機能が既に含まれています！また、より細かい制御が必要な場合は、カスタムスクリプトを作成することもできます。</p>
<h4 id="1-cakewatch">方法1: Cakeの組み込みWatchタスクを使用<a class="headerlink" href="#1-cakewatch" title="Permanent link">&para;</a></h4>
<p>最もシンプルな方法は、<code>build.cake</code>で定義した<code>Watch</code>タスクを使うことです：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Cakeのwatchタスクを実行</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Watch
</code></pre></div>
<p>「これだけで自動テストが動くんですね！」そうなんです。.NET CLIの<code>dotnet watch</code>コマンドを利用しているので、ファイルが変更されるたびに自動的にテストが実行されますよ。</p>
<h4 id="2">方法2: カスタム監視スクリプトを使用（高度な制御）<a class="headerlink" href="#2" title="Permanent link">&para;</a></h4>
<p>もし、Cakeタスクを組み合わせた自動実行が必要な場合は、カスタムスクリプトを作成することもできます。Linuxの<code>inotify-tools</code>を使ってファイル監視スクリプトを作成しましょう：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># inotify-toolsがインストールされているか確認</span>
which<span class="w"> </span>inotifywait<span class="w"> </span><span class="o">||</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>inotify-tools
</code></pre></div>
<p>ファイル監視と自動実行のスクリプト<code>watch.sh</code>を作成します：</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>&gt;<span class="w"> </span>watch.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>
<span class="s"># watch.sh - Cakeを使った自動品質チェック</span>

<span class="s">echo &quot;=== C#/.NET Blazor ぷよぷよTDD ファイル監視開始 ===&quot;</span>
<span class="s">echo &quot;ファイル変更を監視中...&quot;</span>
<span class="s">echo &quot;終了するには Ctrl+C を押してください&quot;</span>
<span class="s">echo &quot;&quot;</span>

<span class="s"># 初回実行</span>
<span class="s">echo &quot;🔄 初回品質チェック実行...&quot;</span>
<span class="s">dotnet cake --target=Quality</span>

<span class="s"># ファイル監視開始（PuyoPuyoTDDとPuyoPuyoTDD.Testsディレクトリを監視）</span>
<span class="s">inotifywait -m -r -e modify,create,delete \</span>
<span class="s">    --include=&#39;\.cs$|\.razor$|\.cake$&#39; \</span>
<span class="s">    --exclude=&#39;(bin|obj|coverage|TestResults|tools)/&#39; \</span>
<span class="s">    PuyoPuyoTDD/ PuyoPuyoTDD.Tests/ build.cake 2&gt;/dev/null | while read path action file; do</span>

<span class="s">    echo &quot;&quot;</span>
<span class="s">    echo &quot;📝 変更検出: $file ($action)&quot;</span>
<span class="s">    echo &quot;🔄 Cakeタスクを実行中...&quot;</span>

<span class="s">    # Cakeでフォーマット、ビルド、テストを実行</span>
<span class="s">    dotnet cake --target=Format</span>
<span class="s">    dotnet cake --target=Build</span>
<span class="s">    dotnet cake --target=Test</span>

<span class="s">    if [ $? -eq 0 ]; then</span>
<span class="s">        echo &quot;✅ すべてのチェックが成功しました&quot;</span>
<span class="s">    else</span>
<span class="s">        echo &quot;❌ チェックに失敗しました&quot;</span>
<span class="s">    fi</span>
<span class="s">    echo &quot;&quot;</span>
<span class="s">done</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>watch.sh
</code></pre></div>
<p>「このスクリプトは何をしてくれるんですか？」良い質問です！このスクリプトは：</p>
<ol>
<li>最初に一度、Cakeの<code>Quality</code>タスクを実行します（フォーマット、ビルド、テスト、カバレッジ）</li>
<li>その後、<code>.cs</code>、<code>.razor</code>、<code>.cake</code>ファイルの変更を監視します</li>
<li>ファイルが変更されたら、自動的にCakeタスクを実行します</li>
<li>結果を見やすく表示してくれます（✅成功、❌失敗）</li>
</ol>
<p>「実際に動かしてみましょう！」</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Cakeの組み込みWatchを使う（推奨）</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Watch

<span class="c1"># または、カスタムスクリプトを使う</span>
./watch.sh
</code></pre></div>
<p>「わぁ、ファイルを保存するたびに自動でテストが走りますね！これは便利！」そうなんです。これで、コードを書くことだけに集中できるようになりました。</p>
<h4 id="_17">どちらの方法を選ぶべき？<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Cakeの組み込みWatch</strong>: シンプルで、テストの自動実行だけが必要な場合</li>
<li><strong>カスタムスクリプト</strong>: フォーマット、カバレッジなど、複数のタスクを組み合わせたい場合</li>
</ul>
<p>「ほとんどの場合は、Cakeの組み込みWatchで十分ですね！」その通りです。開発中は<code>dotnet cake --target=Watch</code>を実行しておけば、テストが自動実行されます。</p>
<p>別のターミナルを開いて、何かファイルを変更してみてください。変更が検出されて自動的にタスクが実行されることが確認できるはずです。</p>
<p>テストがパスすることが確認できたらコミットしておきましょう。このときターミナルでは<code>Watch</code>やスクリプトが動いているので、別ターミナルを開いてコミットを実施すると良いでしょう。</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;chore: タスクの自動化&#39;</span>
</code></pre></div>
<h3 id="_18">動作確認<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>さて、ここまでで環境構築は完了です！「本当に動くんでしょうか？」試してみましょう。</p>
<p>まず、簡単なテストを書いて、すべてが正しく動作することを確認します：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># サンプルテストファイルを編集</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>PuyoPuyoTDD.Tests/SampleTest.cs<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">using Xunit;</span>

<span class="s">namespace PuyoPuyoTDD.Tests;</span>

<span class="s">public class SampleTest</span>
<span class="s">{</span>
<span class="s">    [Fact]</span>
<span class="s">    public void 基本的なテストが動作する()</span>
<span class="s">    {</span>
<span class="s">        // Arrange（準備）</span>
<span class="s">        int a = 1;</span>
<span class="s">        int b = 2;</span>

<span class="s">        // Act（実行）</span>
<span class="s">        int result = a + b;</span>

<span class="s">        // Assert（検証）</span>
<span class="s">        Assert.Equal(3, result);</span>
<span class="s">    }</span>

<span class="s">    [Theory]</span>
<span class="s">    [InlineData(1, 2, 3)]</span>
<span class="s">    [InlineData(0, 0, 0)]</span>
<span class="s">    [InlineData(-1, 1, 0)]</span>
<span class="s">    public void 複数のケースをテストできる(int a, int b, int expected)</span>
<span class="s">    {</span>
<span class="s">        // Act</span>
<span class="s">        int result = a + b;</span>

<span class="s">        // Assert</span>
<span class="s">        Assert.Equal(expected, result);</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p>「このテストは何をテストしてるんですか？」良い質問です！これは実際のテストではなく、環境が正しく動作することを確認するためのサンプルです。「1+2=3」という簡単な計算をテストしています。</p>
<p>テストを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span><span class="nb">test</span>
<span class="c1"># または、Cakeを使って</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test
</code></pre></div>
<p>「テストが通りましたね！」素晴らしい！では、わざと失敗するテストを書いてみましょう：</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>PuyoPuyoTDD.Tests/SampleTest.cs<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>

<span class="s">    [Fact]</span>
<span class="s">    public void わざと失敗するテスト()</span>
<span class="s">    {</span>
<span class="s">        // わざと間違った期待値を設定</span>
<span class="s">        Assert.Equal(5, 1 + 2);</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<p>もう一度テストを実行してみましょう：</p>
<p><div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span><span class="nb">test</span>
<span class="c1"># または、Cakeを使って</span>
./build.sh<span class="w"> </span>--target<span class="o">=</span>Test
</code></pre></div>
    }
EOF
<div class="highlight"><pre><span></span><code>もう一度テストを実行してみましょう：

```bash
dotnet test
# または、Cakeを使って
dotnet cake --target=Test
</code></pre></div></p>
<p>「テストが失敗しましたね！」そうです。これは期待通りの動作です。テストが失敗することも正しく検出できることが確認できました。</p>
<p>では、失敗するテストを削除して、もう一度確認しましょう：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 失敗するテストを削除（ファイルを元に戻す）</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>PuyoPuyoTDD.Tests/SampleTest.cs<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">using Xunit;</span>

<span class="s">namespace PuyoPuyoTDD.Tests;</span>

<span class="s">public class SampleTest</span>
<span class="s">{</span>
<span class="s">    [Fact]</span>
<span class="s">    public void 基本的なテストが動作する()</span>
<span class="s">    {</span>
<span class="s">        // Arrange（準備）</span>
<span class="s">        int a = 1;</span>
<span class="s">        int b = 2;</span>

<span class="s">        // Act（実行）</span>
<span class="s">        int result = a + b;</span>

<span class="s">        // Assert（検証）</span>
<span class="s">        Assert.Equal(3, result);</span>
<span class="s">    }</span>

<span class="s">    [Theory]</span>
<span class="s">    [InlineData(1, 2, 3)]</span>
<span class="s">    [InlineData(0, 0, 0)]</span>
<span class="s">    [InlineData(-1, 1, 0)]</span>
<span class="s">    public void 複数のケースをテストできる(int a, int b, int expected)</span>
<span class="s">    {</span>
<span class="s">        // Act</span>
<span class="s">        int result = a + b;</span>

<span class="s">        // Assert</span>
<span class="s">        Assert.Equal(expected, result);</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">EOF</span>

dotnet<span class="w"> </span><span class="nb">test</span>
<span class="c1"># または、Cakeを使って</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test
</code></pre></div>
<p>「すべてのテストが通りましたね！」完璧です！</p>
<p>最後にカバレッジレポートも確認してみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Cakeを使ってカバレッジを測定</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Coverage
</code></pre></div>
<p>「coverage/index.htmlができましたね！」ブラウザで開いてみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="nv">$BROWSER</span><span class="w"> </span>coverage/index.html
</code></pre></div>
<p>「カバレッジレポートが見れました！」素晴らしい！これで、どのコードがテストされているか視覚的に確認できますね。</p>
<p>Cakeのすべてのタスクを一度に実行することもできます：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># すべての品質チェックを実行</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Quality
<span class="c1"># または</span>
dotnet<span class="w"> </span>cake<span class="w">  </span><span class="c1"># デフォルトでQualityタスクが実行される</span>
</code></pre></div>
<p>「Format→Build→Test→Coverageが順番に実行されましたね！」その通りです。Cakeのタスク依存関係が自動的に解決されて、必要なタスクが順番に実行されます。</p>
<p>すべての確認が終わったら、コミットしておきましょう：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;test: サンプルテストの追加&#39;</span>
</code></pre></div>
<h3 id="0_1">イテレーション0のまとめ<a class="headerlink" href="#0_1" title="Permanent link">&para;</a></h3>
<p>お疲れさまでした！イテレーション0が完了しました。ここまでで、以下のことができるようになりました：</p>
<ol>
<li><strong>プロジェクトの作成</strong>: Blazor WebAssemblyプロジェクトとテストプロジェクトの作成</li>
<li><strong>バージョン管理</strong>: Gitリポジトリの初期化とコミットメッセージの規約</li>
<li><strong>パッケージ管理</strong>: NuGetを使った依存関係の管理（bUnit、Coverletなど）</li>
<li><strong>静的コード解析</strong>: Microsoft.CodeAnalysis.Analyzersによるコード品質の自動チェック</li>
<li><strong>コードフォーマッタ</strong>: dotnet formatによるコーディングスタイルの統一</li>
<li><strong>コードカバレッジ</strong>: Coverlet + ReportGeneratorによるテストカバレッジの測定と可視化</li>
<li><strong>タスクランナー</strong>: CakeによるC#ベースのビルド自動化</li>
<li><strong>タスクの自動化</strong>: dotnet watchまたはinotify-toolsによるファイル監視と自動実行</li>
</ol>
<p>これで<a href="https://t-wada.hatenablog.jp/entry/clean-code-that-works">ソフトウェア開発の三種の神器</a>が揃いました：</p>
<ul>
<li>✅ <strong>バージョン管理</strong>: Git + Angularルールのコミットメッセージ</li>
<li>✅ <strong>テスティング</strong>: xUnit + bUnit + Coverlet</li>
<li>✅ <strong>自動化</strong>: Cake + dotnet watch（またはカスタムwatch.sh）</li>
</ul>
<p><strong>Cakeを使うメリット</strong>:
- C#で書けるので.NET開発者にとって自然
- タスクの依存関係を宣言的に定義できる
- クロスプラットフォームで動作
- 豊富なアドインとヘルパー機能
- IDE統合とデバッグサポート</p>
<p>「これでテスト駆動開発を始める準備が整いましたね！」その通りです！次のイテレーションからは、実際にぷよぷよゲームの機能を実装していきますよ。</p>
<p>開発を始めるときは、以下のコマンドを実行しておけば、ファイルを保存するたびに自動でテストが実行されるので、テスト駆動開発のリズム（Red-Green-Refactor）に集中できますね！</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 方法1: Cakeの組み込みWatchを使う（推奨）</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Watch

<span class="c1"># 方法2: カスタムスクリプトを使う（より詳細な制御が必要な場合）</span>
./watch.sh

<span class="c1"># 方法3: 品質チェックを手動実行</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Quality

<span class="c1"># 別のターミナルでコードを編集</span>
<span class="c1"># ファイルを保存するたびに自動でテストが実行される！</span>
</code></pre></div>
<p><strong>よく使うCakeコマンド</strong>:
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>cake<span class="w">                      </span><span class="c1"># すべての品質チェック（デフォルト）</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Clean<span class="w">       </span><span class="c1"># クリーンアップ</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Format<span class="w">      </span><span class="c1"># コードフォーマット</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Build<span class="w">       </span><span class="c1"># ビルド</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test<span class="w">        </span><span class="c1"># テスト実行</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Coverage<span class="w">    </span><span class="c1"># カバレッジ測定</span>
dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Watch<span class="w">       </span><span class="c1"># 自動テスト実行</span>
</code></pre></div></p>
<p>それでは、次のイテレーション1で実際のゲーム機能の実装に取り組んでいきましょう！</p>
<h2 id="1">イテレーション1: ゲーム開始の実装<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p>さあ、いよいよコードを書き始めましょう！テスト駆動開発では、小さなイテレーション（反復）で機能を少しずつ追加していきます。最初のイテレーションでは、最も基本的な機能である「ゲームの開始」を実装します。</p>
<blockquote>
<p>イテレーション開発とは、ソフトウェアを小さな機能単位で繰り返し開発していく手法です。各イテレーションで計画、設計、実装、テスト、評価のサイクルを回すことで、リスクを早期に発見し、フィードバックを得ながら開発を進めることができます。</p>
<p>— Craig Larman 『アジャイル開発とスクラム』</p>
</blockquote>
<h3 id="_19">ユーザーストーリー<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>まずは、このイテレーションで実装するユーザーストーリーを確認しましょう：</p>
<blockquote>
<p>プレイヤーとして、新しいゲームを開始できる</p>
</blockquote>
<p>このシンプルなストーリーから始めることで、ゲームの基本的な構造を作り、後続の機能追加の土台を築くことができます。では、テスト駆動開発のサイクルに従って、まずはテストから書いていきましょう！</p>
<h3 id="todo">TODOリスト<a class="headerlink" href="#todo" title="Permanent link">&para;</a></h3>
<p>さて、ユーザーストーリーを実装するために、まずはTODOリストを作成しましょう。TODOリストは、大きな機能を小さなタスクに分解するのに役立ちます。</p>
<blockquote>
<p>TODOリストは、テスト駆動開発の重要なプラクティスの一つです。実装前に必要なタスクを明確にすることで、開発の方向性を保ち、何も見落とさないようにします。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<p>私たちの「新しいゲームを開始できる」というユーザーストーリーを実現するためには、どのようなタスクが必要でしょうか？考えてみましょう：</p>
<ul>
<li>ゲームの初期化処理を実装する（ゲームの状態や必要なコンポーネントを設定する）</li>
<li>Blazorコンポーネントを作成する（プレイヤーが視覚的にゲームを認識できるようにする）</li>
<li>新しいぷよを生成する（ゲーム開始時に最初のぷよを作成する）</li>
<li>ゲームループを開始する（ゲームの継続的な更新と描画を行う）</li>
</ul>
<p>これらのタスクを一つずつ実装していきましょう。テスト駆動開発では、各タスクに対してテスト→実装→リファクタリングのサイクルを回します。まずは「ゲームの初期化処理」から始めましょう！</p>
<h3 id="_20">テスト: ゲームの初期化<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p>さて、TODOリストの最初のタスク「ゲームの初期化処理を実装する」に取り掛かりましょう。テスト駆動開発では、まずテストを書くことから始めます。</p>
<blockquote>
<p>テストファースト</p>
<p>いつテストを書くべきだろうか——それはテスト対象のコードを書く前だ。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<p>では、ゲームの初期化処理をテストするコードを書いてみましょう。何をテストすべきでしょうか？ゲームが初期化されたとき、必要なコンポーネントが正しく作成され、ゲームの状態が適切に設定されていることを確認する必要がありますね。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/GameTest.cs</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Xunit</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Models</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Tests.Models</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">GameTest</span>
<span class="p">{</span>
<span class="w">    </span><span class="na">[Fact]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">ゲ</span><span class="n">ー</span><span class="err">ムを初期化すると必要なコンポ</span><span class="n">ー</span><span class="err">ネントが作成される</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Arrange &amp; Act</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Game</span><span class="p">();</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">NotNull</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">);</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">NotNull</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="p">);</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">NotNull</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="p">);</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">NotNull</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Fact]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">ゲ</span><span class="n">ー</span><span class="err">ムを初期化するとゲ</span><span class="n">ー</span><span class="err">ムモ</span><span class="n">ー</span><span class="err">ドが</span><span class="n">Start</span><span class="err">になる</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Arrange</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Game</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Act</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">GameMode</span><span class="p">.</span><span class="n">Start</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>このテストでは、<code>Game</code>クラスの<code>Initialize</code>メソッドが正しく動作することを確認しています。具体的には、必要なコンポーネント（Config, Stage, Player, Score）が作成され、ゲームモードが<code>Start</code>に設定されることを検証しています。</p>
<h3 id="_21">実装: ゲームの初期化<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p>テストを書いたら、次に実行してみましょう。どうなるでしょうか？</p>
<div class="highlight"><pre><span></span><code>error CS0246: 型または名前空間の名前 &#39;Game&#39; が見つかりませんでした
</code></pre></div>
<p>おっと！まだ<code>Game</code>クラスを実装していないので、当然エラーになりますね。これがテスト駆動開発の「Red（赤）」の状態です。テストが失敗することを確認できました。</p>
<blockquote>
<p>失敗するテスト</p>
<p>テストが失敗することを確認してから実装に取り掛かろう。そうすれば、テストが正しく機能していることがわかる。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<p>では、テストが通るように最小限のコードを実装していきましょう。「最小限」というのがポイントです。この段階では、テストが通ることだけを目指して、必要最低限のコードを書きます。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Game.cs</span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Models</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">GameMode</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Start</span><span class="p">,</span>
<span class="w">    </span><span class="n">CheckFall</span><span class="p">,</span>
<span class="w">    </span><span class="n">Fall</span><span class="p">,</span>
<span class="w">    </span><span class="n">CheckErase</span><span class="p">,</span>
<span class="w">    </span><span class="n">Erasing</span><span class="p">,</span>
<span class="w">    </span><span class="n">NewPuyo</span><span class="p">,</span>
<span class="w">    </span><span class="n">Playing</span><span class="p">,</span>
<span class="w">    </span><span class="n">GameOver</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Game</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Stage</span><span class="w"> </span><span class="n">Stage</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Player</span><span class="w"> </span><span class="n">Player</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">GameMode</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_frame</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_combinationCount</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 各コンポーネントの初期化</span>
<span class="w">        </span><span class="n">Config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Config</span><span class="p">();</span>
<span class="w">        </span><span class="n">Stage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stage</span><span class="p">(</span><span class="n">Config</span><span class="p">);</span>
<span class="w">        </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Player</span><span class="p">(</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Stage</span><span class="p">);</span>
<span class="w">        </span><span class="n">Score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Score</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// ゲームモードを設定</span>
<span class="w">        </span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Start</span><span class="p">;</span>
<span class="w">        </span><span class="n">_frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">_combinationCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_22">解説: ゲームの初期化<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p>テストが通りましたね！おめでとうございます。これがテスト駆動開発の「Green（緑）」の状態です。</p>
<blockquote>
<p>テストが通ったら、次はリファクタリングだ。でも、その前に少し立ち止まって、今書いたコードについて考えてみよう。</p>
<p>— Martin Fowler 『リファクタリング』</p>
</blockquote>
<p>実装したゲームの初期化処理について、少し解説しておきましょう。この処理では、主に以下のことを行っています：</p>
<ol>
<li>各コンポーネント（Config, Stage, Player, Score）のインスタンスを作成</li>
<li>ゲームモードを<code>Start</code>に設定</li>
<li>フレームカウンタと連鎖カウンタを初期化</li>
</ol>
<p>これにより、ゲームを開始するための準備が整います。各コンポーネントの役割を理解しておくと、今後の実装がスムーズになりますよ：</p>
<ul>
<li><strong>Config</strong>: ゲームの設定値を管理します（画面サイズ、ぷよの大きさなど）</li>
<li><strong>Stage</strong>: ゲームのステージ（盤面）を管理します（ぷよの配置状態、消去判定など）</li>
<li><strong>Player</strong>: プレイヤーの入力と操作を管理します（キーボード入力の処理、ぷよの移動など）</li>
<li><strong>Score</strong>: スコアの計算と表示を管理します（連鎖数に応じたスコア計算など）</li>
</ul>
<p>このように、責任を明確に分けることで、コードの保守性が高まります。これはオブジェクト指向設計の基本原則の一つ、「単一責任の原則」に従っています。</p>
<blockquote>
<p>単一責任の原則（SRP）：クラスを変更する理由は1つだけであるべき。</p>
<p>— Robert C. Martin 『Clean Architecture』</p>
</blockquote>
<h3 id="blazor">Blazorコンポーネントの作成<a class="headerlink" href="#blazor" title="Permanent link">&para;</a></h3>
<p>次に、ゲームを表示するためのBlazorコンポーネントを作成しましょう。Blazor WebAssemblyでは、Razorコンポーネントを使ってUIを構築します。</p>
<div class="highlight"><pre><span></span><code>@* PuyoPuyoTDD/Pages/GamePage.razor *@
@page &quot;/game&quot;
@using PuyoPuyoTDD.Models
@inject IJSRuntime JSRuntime

&lt;div class=&quot;game-container&quot;&gt;
    &lt;h3&gt;ぷよぷよ TDD&lt;/h3&gt;
    &lt;div class=&quot;game-area&quot;&gt;
        &lt;canvas id=&quot;stage&quot; width=&quot;192&quot; height=&quot;384&quot;&gt;&lt;/canvas&gt;
        &lt;div class=&quot;info-panel&quot;&gt;
            &lt;div class=&quot;score-display&quot;&gt;
                &lt;p&gt;スコア&lt;/p&gt;
                &lt;p id=&quot;score&quot;&gt;0&lt;/p&gt;
            &lt;/div&gt;
            &lt;div class=&quot;next-display&quot;&gt;
                &lt;p&gt;NEXT&lt;/p&gt;
                &lt;canvas id=&quot;next&quot; width=&quot;32&quot; height=&quot;64&quot;&gt;&lt;/canvas&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

@code {
    private Game? _game;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _game = new Game();
            _game.Initialize();
            await JSRuntime.InvokeVoidAsync(&quot;startGameLoop&quot;, DotNetObjectReference.Create(this));
        }
    }

    [JSInvokable]
    public void UpdateGame()
    {
        _game?.Update();
    }
}
</code></pre></div>
<h3 id="blazor_1">解説: Blazorコンポーネント<a class="headerlink" href="#blazor_1" title="Permanent link">&para;</a></h3>
<p>このBlazorコンポーネントでは、以下のことを行っています：</p>
<ol>
<li><strong>Canvas要素の配置</strong>: ゲームの盤面とNEXTぷよを表示するためのcanvas要素を配置</li>
<li><strong>コンポーネントライフサイクル</strong>: <code>OnAfterRenderAsync</code>メソッドで初回レンダリング後にゲームを初期化</li>
<li><strong>JavaScript相互運用</strong>: <code>JSRuntime</code>を使ってJavaScriptのゲームループを呼び出す</li>
<li><strong>JSInvokable属性</strong>: JavaScript側からC#のメソッドを呼び出せるようにする</li>
</ol>
<p>Blazor WebAssemblyでは、ゲームループのような高頻度の処理はJavaScript側で実行し、C#側のビジネスロジックを呼び出す方式が推奨されます。これにより、パフォーマンスを最適化できます。</p>
<h3 id="javascript">JavaScriptの実装<a class="headerlink" href="#javascript" title="Permanent link">&para;</a></h3>
<p>Blazorから呼び出されるJavaScript側の実装も必要です。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// wwwroot/js/game.js</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">startGameLoop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">dotnetHelper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">gameLoop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">dotnetHelper</span><span class="p">.</span><span class="nx">invokeMethodAsync</span><span class="p">(</span><span class="s1">&#39;UpdateGame&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">gameLoop</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">gameLoop</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>このJavaScriptコードでは、<code>requestAnimationFrame</code>を使って60FPSでゲームループを実行し、各フレームでC#側の<code>UpdateGame</code>メソッドを呼び出します。</p>
<h2 id="2_1">イテレーション2: ぷよの移動の実装<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h2>
<p>さて、前回のイテレーションでゲームの基本的な構造ができましたね。「ゲームが始まったけど、ぷよが動かないと面白くないよね？」と思いませんか？そこで次は、ぷよを左右に移動できるようにしていきましょう！</p>
<h3 id="_23">ユーザーストーリー<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p>まずは、このイテレーションで実装するユーザーストーリーを確認しましょう：</p>
<blockquote>
<p>プレイヤーとして、落ちてくるぷよを左右に移動できる</p>
</blockquote>
<p>「ぷよぷよって、落ちてくるぷよを左右に動かして、うまく積み上げるゲームですよね？」そうです！今回はその基本操作である「左右の移動」を実装していきます。</p>
<h3 id="todo_1">TODOリスト<a class="headerlink" href="#todo_1" title="Permanent link">&para;</a></h3>
<p>さて、このユーザーストーリーを実現するために、どんなタスクが必要でしょうか？一緒に考えてみましょう。</p>
<blockquote>
<p>TODOリストは、大きな問題を小さな問題に分割するための強力なツールです。複雑な問題に直面したとき、それを管理可能な小さなタスクに分解することで、一歩一歩確実に前進できます。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<p>「ぷよを左右に移動する」という機能を実現するためには、以下のようなタスクが必要そうですね：</p>
<ul>
<li>プレイヤーの入力を検出する（キーボードの左右キーが押されたことを検知する）</li>
<li>ぷよを左右に移動する処理を実装する（実際にぷよの位置を変更する）</li>
<li>移動可能かどうかのチェックを実装する（画面の端や他のぷよにぶつかる場合は移動できないようにする）</li>
<li>移動後の表示を更新する（画面上でぷよの位置が変わったことを表示する）</li>
</ul>
<p>「なるほど、順番に実装していけばいいんですね！」そうです、一つずつ進めていきましょう。テスト駆動開発の流れに沿って、まずはテストから書いていきますよ。</p>
<h3 id="_24">テスト: プレイヤーの入力検出<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>「最初に何をテストすればいいんでしょうか？」まずは、プレイヤーの入力を検出する部分からテストしていきましょう。キーボードの左右キーが押されたときに、それを正しく検知できるかどうかをテストします。</p>
<blockquote>
<p>テストファースト</p>
<p>いつテストを書くべきだろうか——それはテスト対象のコードを書く前だ。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/PlayerTest.cs</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Xunit</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Models</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Tests.Models</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PlayerTest</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="n">_config</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Stage</span><span class="w"> </span><span class="n">_stage</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Player</span><span class="w"> </span><span class="n">_player</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">PlayerTest</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Config</span><span class="p">();</span>
<span class="w">        </span><span class="n">_stage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stage</span><span class="p">(</span><span class="n">_config</span><span class="p">);</span>
<span class="w">        </span><span class="n">_player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Player</span><span class="p">(</span><span class="n">_config</span><span class="p">,</span><span class="w"> </span><span class="n">_stage</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Fact]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">左キ</span><span class="n">ー</span><span class="err">が押されると左向きの移動フラグが立つ</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Act</span>
<span class="w">        </span><span class="n">_player</span><span class="p">.</span><span class="n">SetInputLeft</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">_player</span><span class="p">.</span><span class="n">InputKeyLeft</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Fact]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">右キ</span><span class="n">ー</span><span class="err">が押されると右向きの移動フラグが立つ</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Act</span>
<span class="w">        </span><span class="n">_player</span><span class="p">.</span><span class="n">SetInputRight</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">_player</span><span class="p">.</span><span class="n">InputKeyRight</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Fact]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">キ</span><span class="n">ー</span><span class="err">が離されると対応する移動フラグが下がる</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Arrange</span>
<span class="w">        </span><span class="n">_player</span><span class="p">.</span><span class="n">SetInputLeft</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">_player</span><span class="p">.</span><span class="n">InputKeyLeft</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Act</span>
<span class="w">        </span><span class="n">_player</span><span class="p">.</span><span class="n">SetInputLeft</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">False</span><span class="p">(</span><span class="n">_player</span><span class="p">.</span><span class="n">InputKeyLeft</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>「このテストは何をしているんですか？」このテストでは、キーボードの左右キーが押されたときと離されたときに、<code>Player</code>クラスの中の対応するフラグが正しく設定されるかどうかを確認しています。</p>
<h3 id="_25">実装: プレイヤーの入力検出<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<p>「失敗するテストができたので、次は実装ですね！」そうです！テストが通るように、最小限のコードを実装していきましょう。</p>
<blockquote>
<p>最小限の実装</p>
<p>テストを通すために、どれだけのコードを書けばよいだろうか——テストが通る最小限のコードだけを書こう。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Player.cs</span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Models</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Player</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="n">_config</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Stage</span><span class="w"> </span><span class="n">_stage</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">InputKeyLeft</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">InputKeyRight</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">InputKeyUp</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">InputKeyDown</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_puyoX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// ぷよのX座標（中央に配置）</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_puyoY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// ぷよのY座標（一番上）</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_puyoType</span><span class="p">;</span><span class="w"> </span><span class="c1">// 現在のぷよの種類</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_nextPuyoType</span><span class="p">;</span><span class="w"> </span><span class="c1">// 次のぷよの種類</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_rotation</span><span class="p">;</span><span class="w"> </span><span class="c1">// 現在の回転状態</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Player</span><span class="p">(</span><span class="n">Config</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">Stage</span><span class="w"> </span><span class="n">stage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
<span class="w">        </span><span class="n">_stage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stage</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetInputLeft</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">InputKeyLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetInputRight</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">InputKeyRight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetInputUp</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">InputKeyUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetInputDown</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">InputKeyDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>「なるほど！キーが押されたり離されたりしたときのフラグを管理しているんですね。」そうです！Blazorでは、JavaScript側でキーボードイベントを検知し、C#側のメソッドを呼び出してフラグを設定します。</p>
<h3 id="_26">テスト: ぷよの移動<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p>「次は何をテストしますか？」次は、ぷよを左右に移動する機能をテストしましょう。ぷよが左右に移動できるか、そして画面の端に到達したときに移動が制限されるかをテストします。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/PlayerTest.cs（続き）</span>
<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">左に移動できる場合左に移動する</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">initialX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">MoveLeft</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">initialX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">右に移動できる場合右に移動する</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">initialX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">MoveRight</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">initialX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">左端にいる場合左に移動できない</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">SetPuyoX</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">MoveLeft</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">右端にいる場合右に移動できない</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">SetPuyoX</span><span class="p">(</span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">MoveRight</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_27">実装: ぷよの移動<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<p>「テストが失敗することを確認したら、実装に進みましょう！」そうですね。では、ぷよを移動させる機能を実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Player.cs（続き）</span>
<span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PuyoX</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_puyoX</span><span class="p">;</span>
<span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PuyoY</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_puyoY</span><span class="p">;</span>
<span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PuyoType</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_puyoType</span><span class="p">;</span>
<span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NextPuyoType</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_nextPuyoType</span><span class="p">;</span>
<span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Rotation</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_rotation</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateNewPuyo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_puyoX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="n">_puyoY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">_puyoType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Random</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1～4のランダムな値</span>
<span class="w">    </span><span class="n">_nextPuyoType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Random</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w">    </span><span class="n">_rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetPuyoX</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_puyoX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">MoveLeft</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_puyoX</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_puyoX</span><span class="o">--</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">MoveRight</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_puyoX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_puyoX</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_28">解説: ぷよの移動<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<p>「ぷよの位置や種類を管理するプロパティがたくさんありますね！」そうですね。ぷよの状態を管理するために、いくつかのプロパティを定義しています：</p>
<ul>
<li><code>PuyoX</code>と<code>PuyoY</code>：ぷよの位置（X座標とY座標）</li>
<li><code>PuyoType</code>と<code>NextPuyoType</code>：現在のぷよと次のぷよの種類</li>
<li><code>Rotation</code>：ぷよの回転状態</li>
</ul>
<p>「移動の処理はシンプルですね！」そうですね。<code>MoveLeft</code>メソッドでは左端（X座標が0）でなければX座標を1減らし、<code>MoveRight</code>メソッドでは右端（X座標がステージの幅-1）でなければX座標を1増やしています。これで、ぷよが画面の端を超えて移動することはなくなりました。</p>
<blockquote>
<p>境界条件のテスト</p>
<p>プログラムの動作が変わる境界条件をテストすることは非常に重要です。例えば、配列の最初の要素、最後の要素、空の配列などです。</p>
<p>— Martin Fowler 『リファクタリング』</p>
</blockquote>
<h2 id="3">イテレーション3: ぷよの回転の実装<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<p>「左右に移動できるようになったけど、ぷよぷよって回転もできますよね？」そうですね！ぷよぷよの醍醐味の一つは、ぷよを回転させて思い通りの場所に配置することです。今回は、ぷよを回転させる機能を実装していきましょう！</p>
<h3 id="_29">ユーザーストーリー<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<p>まずは、このイテレーションで実装するユーザーストーリーを確認しましょう：</p>
<blockquote>
<p>プレイヤーとして、落ちてくるぷよを回転できる</p>
</blockquote>
<p>「回転って具体的にどういう動きですか？」良い質問ですね！ぷよぷよでは、2つのぷよが連なった状態で落ちてきます。回転とは、この2つのぷよの相対的な位置関係を変えることです。</p>
<h3 id="todo_2">TODOリスト<a class="headerlink" href="#todo_2" title="Permanent link">&para;</a></h3>
<p>「どんな作業が必要になりますか？」このユーザーストーリーを実現するために、TODOリストを作成してみましょう。</p>
<blockquote>
<p>TODOリストは、実装前に必要なタスクを明確にすることで、開発の方向性を保ち、何も見落とさないようにします。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<p>「ぷよを回転させる」という機能を実現するためには、以下のようなタスクが必要そうですね：</p>
<ul>
<li>ぷよの回転処理を実装する（時計回り・反時計回りの回転）</li>
<li>回転可能かどうかのチェックを実装する（他のぷよや壁にぶつかる場合は回転できないようにする）</li>
<li>壁キック処理を実装する（壁際での回転を可能にする特殊処理）</li>
</ul>
<h3 id="_30">テスト: ぷよの回転<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h3>
<p>「まずは何からテストしますか？」テスト駆動開発の流れに沿って、まずは基本的な回転機能のテストから書いていきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/PlayerTest.cs（続き）</span>
<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">時計回りに回転すると回転状態が</span><span class="mi">1</span><span class="err">増える</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">initialRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">Rotation</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">RotateRight</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">((</span><span class="n">initialRotation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">Rotation</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">反時計回りに回転すると回転状態が</span><span class="mi">1</span><span class="err">減る</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">initialRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">Rotation</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">RotateLeft</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">((</span><span class="n">initialRotation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">Rotation</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">回転状態が</span><span class="mi">4</span><span class="err">になると</span><span class="mi">0</span><span class="err">に戻る</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">SetRotation</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">RotateRight</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">Rotation</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_31">実装: ぷよの回転<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<p>「テストが失敗することを確認したら、実装に進みましょう！」そうですね。では、ぷよを回転させる機能を実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Player.cs（続き）</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetRotation</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">rotation</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotation</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RotateRight</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_rotation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 壁キック処理</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_rotation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">_puyoX</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_puyoX</span><span class="o">--</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_rotation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">_puyoX</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_puyoX</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RotateLeft</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_rotation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 壁キック処理</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_rotation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">_puyoX</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_puyoX</span><span class="o">--</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_rotation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">_puyoX</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_puyoX</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_32">解説: ぷよの回転と壁キック<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<p>「シンプルですね！」そうですね。回転処理自体はとてもシンプルです。<code>RotateRight</code>メソッドでは回転状態を1増やし、<code>RotateLeft</code>メソッドでは回転状態を1減らしています。</p>
<p>「壁キックって何ですか？」壁キックとは、ぷよが壁際にあるときに回転すると壁にめり込んでしまうので、自動的に少し位置をずらして回転を可能にする処理のことです。プレイヤーの操作性を向上させるための工夫なんですよ。</p>
<blockquote>
<p>境界条件のテスト</p>
<p>プログラムの動作が変わる境界条件をテストすることは非常に重要です。壁際での回転のような特殊なケースは、バグが発生しやすい場所です。</p>
<p>— Martin Fowler 『リファクタリング』</p>
</blockquote>
<h2 id="4">イテレーション4: ぷよの高速落下の実装<a class="headerlink" href="#4" title="Permanent link">&para;</a></h2>
<p>「回転ができるようになったけど、ぷよぷよってもっと早く落とせたよね？」そうですね！ぷよぷよでは、プレイヤーが下キーを押すことで、ぷよを素早く落下させることができます。今回は、その「高速落下」機能を実装していきましょう！</p>
<h3 id="_33">ユーザーストーリー<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<p>まずは、このイテレーションで実装するユーザーストーリーを確認しましょう：</p>
<blockquote>
<p>プレイヤーとして、ぷよを素早く落下させることができる</p>
</blockquote>
<p>「早く次のぷよを落としたい！」というときに、下キーを押して素早く落下させる機能は、ゲームのテンポを良くするために重要ですね。</p>
<h3 id="todo_3">TODOリスト<a class="headerlink" href="#todo_3" title="Permanent link">&para;</a></h3>
<p>「どんな作業が必要になりますか？」このユーザーストーリーを実現するために、TODOリストを作成してみましょう。</p>
<p>「ぷよを素早く落下させる」という機能を実現するためには、以下のようなタスクが必要そうですね：</p>
<ul>
<li>下キー入力の検出を実装する（キーボードの下キーが押されたことを検知する）</li>
<li>高速落下処理を実装する（下キーが押されているときは落下速度を上げる）</li>
<li>落下可能かどうかのチェックを実装する（下に障害物がある場合は落下できないようにする）</li>
</ul>
<h3 id="_34">テスト: 高速落下<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<p>「最初に何をテストすればいいんでしょうか？」まずは、下キーが押されたときに落下速度が上がることと、ぷよが下に移動できるかどうかをテストしましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/PlayerTest.cs（続き）</span>
<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">下キ</span><span class="n">ー</span><span class="err">が押されていると落下速度が上がる</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">SetInputDown</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">dropSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">GetDropSpeed</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">dropSpeed</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">下に移動できる場合下に移動する</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">initialY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">PuyoY</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">canMove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">MoveDown</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">canMove</span><span class="p">);</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">initialY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">PuyoY</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">下に障害物がある場合下に移動できない</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="n">_player</span><span class="p">.</span><span class="n">SetPuyoY</span><span class="p">(</span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">canMove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">MoveDown</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">False</span><span class="p">(</span><span class="n">canMove</span><span class="p">);</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_player</span><span class="p">.</span><span class="n">PuyoY</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_35">実装: 高速落下<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<p>「テストが失敗することを確認したら、実装に進みましょう！」そうですね。では、高速落下の機能を実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Player.cs（続き）</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetPuyoY</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_puyoY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetDropSpeed</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">InputKeyDown</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">MoveDown</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_puyoY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_puyoY</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_36">解説: 高速落下<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h3>
<p>「シンプルですね！」そうですね。高速落下の処理自体はとてもシンプルです。<code>GetDropSpeed</code>メソッドでは、下キーが押されているかどうかを確認し、押されていれば通常の10倍の速度で落下するようにしています。</p>
<p>「なぜ<code>MoveDown</code>メソッドは<code>bool</code>を返すんですか？」良い質問ですね！<code>MoveDown</code>メソッドは、ぷよが実際に下に移動できたかどうかを返します。これは、ぷよが着地したかどうかを判定するために使われます。</p>
<h2 id="5">イテレーション5: ぷよの消去の実装<a class="headerlink" href="#5" title="Permanent link">&para;</a></h2>
<p>「ぷよが落ちてくるようになったけど、ぷよぷよの醍醐味はぷよを消すことですよね？」そうですね！ぷよぷよの最も重要な要素の一つは、同じ色のぷよを4つ以上つなげると消去できる機能です。今回は、その「ぷよの消去」機能を実装していきましょう！</p>
<h3 id="_37">ユーザーストーリー<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h3>
<p>まずは、このイテレーションで実装するユーザーストーリーを確認しましょう：</p>
<blockquote>
<p>プレイヤーとして、同じ色のぷよを4つ以上つなげると消去できる</p>
</blockquote>
<p>「これがぷよぷよの基本ルールですね！」そうです！同じ色のぷよを4つ以上つなげると消去できるというのが、ぷよぷよの基本的なルールです。</p>
<h3 id="todo_4">TODOリスト<a class="headerlink" href="#todo_4" title="Permanent link">&para;</a></h3>
<p>「どんな作業が必要になりますか？」このユーザーストーリーを実現するために、TODOリストを作成してみましょう。</p>
<p>「ぷよを消去する」という機能を実現するためには、以下のようなタスクが必要そうですね：</p>
<ul>
<li>ぷよの接続判定を実装する（隣接する同じ色のぷよを検出する）</li>
<li>4つ以上つながったぷよの検出を実装する（消去対象となるぷよのグループを特定する）</li>
<li>ぷよの消去処理を実装する（消去対象のぷよを実際に消す）</li>
<li>消去後の落下処理を実装する（消去された後の空きスペースにぷよが落ちてくる）</li>
</ul>
<h3 id="_38">テスト: ぷよの接続判定<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h3>
<p>「最初に何をテストすればいいんでしょうか？」まずは、ぷよの接続判定をテストしましょう。同じ色のぷよが4つ以上つながっているかどうかを判定する機能が必要です。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/StageTest.cs</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Xunit</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Models</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Tests.Models</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">StageTest</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="n">_config</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Stage</span><span class="w"> </span><span class="n">_stage</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">StageTest</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Config</span><span class="p">();</span>
<span class="w">        </span><span class="n">_stage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stage</span><span class="p">(</span><span class="n">_config</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Fact]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">同じ色のぷよが</span><span class="mi">4</span><span class="err">つつながっていると消去対象になる</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Arrange</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Act</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">eraseInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_stage</span><span class="p">.</span><span class="n">CheckErase</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">eraseInfo</span><span class="p">.</span><span class="n">ErasePuyoCount</span><span class="p">);</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">NotEmpty</span><span class="p">(</span><span class="n">eraseInfo</span><span class="p">.</span><span class="n">EraseList</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Fact]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">異なる色のぷよは消去対象にならない</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Arrange</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="n">_stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Act</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">eraseInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_stage</span><span class="p">.</span><span class="n">CheckErase</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">eraseInfo</span><span class="p">.</span><span class="n">ErasePuyoCount</span><span class="p">);</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">Empty</span><span class="p">(</span><span class="n">eraseInfo</span><span class="p">.</span><span class="n">EraseList</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_39">実装: ぷよの接続判定<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h3>
<p>「テストが失敗することを確認したら、実装に進みましょう！」そうですね。では、ぷよの接続判定を実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Stage.cs</span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Models</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">record</span><span class="w"> </span><span class="nf">EraseInfo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ErasePuyoCount</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Type</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">EraseList</span><span class="p">);</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Stage</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="n">_config</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="p">[,]</span><span class="w"> </span><span class="n">_board</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="o">!</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Stage</span><span class="p">(</span><span class="n">Config</span><span class="w"> </span><span class="n">config</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
<span class="w">        </span><span class="n">Initialize</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_board</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="p">,</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetPuyo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_board</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetPuyo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_board</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">EraseInfo</span><span class="w"> </span><span class="nf">CheckErase</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">eraseList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Type</span><span class="p">)</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="k">checked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">bool</span><span class="p">[</span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="p">,</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="p">];</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_board</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="k">checked</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">])</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="kt">var</span><span class="w"> </span><span class="n">puyoType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_board</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">];</span>
<span class="w">                    </span><span class="kt">var</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Y</span><span class="p">)</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">                    </span><span class="n">SearchConnectedPuyo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">puyoType</span><span class="p">,</span><span class="w"> </span><span class="k">checked</span><span class="p">,</span><span class="w"> </span><span class="n">connected</span><span class="p">);</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connected</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="p">(</span><span class="n">connX</span><span class="p">,</span><span class="w"> </span><span class="n">connY</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">connected</span><span class="p">)</span>
<span class="w">                        </span><span class="p">{</span>
<span class="w">                            </span><span class="n">eraseList</span><span class="p">.</span><span class="n">Add</span><span class="p">((</span><span class="n">connX</span><span class="p">,</span><span class="w"> </span><span class="n">connY</span><span class="p">,</span><span class="w"> </span><span class="n">puyoType</span><span class="p">));</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">EraseInfo</span><span class="p">(</span><span class="n">eraseList</span><span class="p">.</span><span class="n">Count</span><span class="p">,</span><span class="w"> </span><span class="n">eraseList</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SearchConnectedPuyo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">startX</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">startY</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">puyoType</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="kt">bool</span><span class="p">[,]</span><span class="w"> </span><span class="k">checked</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Y</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">connected</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">checked</span><span class="p">[</span><span class="n">startY</span><span class="p">,</span><span class="w"> </span><span class="n">startX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">connected</span><span class="p">.</span><span class="n">Add</span><span class="p">((</span><span class="n">startX</span><span class="p">,</span><span class="w"> </span><span class="n">startY</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// 4方向を探索</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">directions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">directions</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">nextX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dx</span><span class="p">;</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">nextY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dy</span><span class="p">;</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nextX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">nextX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="n">nextY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">nextY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="n">_board</span><span class="p">[</span><span class="n">nextY</span><span class="p">,</span><span class="w"> </span><span class="n">nextX</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">puyoType</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="o">!</span><span class="k">checked</span><span class="p">[</span><span class="n">nextY</span><span class="p">,</span><span class="w"> </span><span class="n">nextX</span><span class="p">])</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">SearchConnectedPuyo</span><span class="p">(</span><span class="n">nextX</span><span class="p">,</span><span class="w"> </span><span class="n">nextY</span><span class="p">,</span><span class="w"> </span><span class="n">puyoType</span><span class="p">,</span><span class="w"> </span><span class="k">checked</span><span class="p">,</span><span class="w"> </span><span class="n">connected</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">EraseBoards</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Type</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">eraseList</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">eraseList</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_board</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Fall</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">--</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageCols</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_board</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">fallY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">                    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">fallY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_config</span><span class="p">.</span><span class="n">StageRows</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">_board</span><span class="p">[</span><span class="n">fallY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="n">_board</span><span class="p">[</span><span class="n">fallY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_board</span><span class="p">[</span><span class="n">fallY</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">];</span>
<span class="w">                        </span><span class="n">_board</span><span class="p">[</span><span class="n">fallY</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">                        </span><span class="n">fallY</span><span class="o">++</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_40">解説: ぷよの接続判定<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h3>
<p>ぷよの接続判定では、深さ優先探索（DFS）アルゴリズムを使用しています。このアルゴリズムでは、あるぷよから始めて、上下左右に隣接する同じ色のぷよを再帰的に探索していきます。</p>
<h2 id="6">イテレーション6: 連鎖反応とスコア計算の実装<a class="headerlink" href="#6" title="Permanent link">&para;</a></h2>
<p>「ぷよを消せるようになったけど、ぷよぷよの醍醐味は連鎖じゃないですか？」そうですね！ぷよぷよの最も魅力的な要素の一つは、連鎖反応です。ぷよが消えて落下した結果、新たな消去パターンが生まれ、連続して消去が発生する「連鎖」を実装していきましょう！</p>
<h3 id="_41">ユーザーストーリー<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h3>
<p>まずは、このイテレーションで実装するユーザーストーリーを確認しましょう：</p>
<blockquote>
<p>プレイヤーとして、連鎖反応を起こしてより高いスコアを獲得できる</p>
</blockquote>
<p>「れ〜んさ〜ん！」と叫びたくなるような連鎖反応を実装して、プレイヤーがより高いスコアを目指せるようにしましょう。</p>
<h3 id="todo_5">TODOリスト<a class="headerlink" href="#todo_5" title="Permanent link">&para;</a></h3>
<p>「どんな作業が必要になりますか？」このユーザーストーリーを実現するために、TODOリストを作成してみましょう。</p>
<p>「連鎖反応を実装する」という機能を実現するためには、以下のようなタスクが必要そうですね：</p>
<ul>
<li>連鎖カウントを実装する（何連鎖目かをカウントする）</li>
<li>連鎖ボーナスの計算を実装する（連鎖数に応じたボーナス点を計算する）</li>
<li>スコア表示を実装する（プレイヤーに現在のスコアを表示する）</li>
</ul>
<h3 id="_42">テスト: スコア計算<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h3>
<p>「最初に何をテストすればいいんでしょうか？」まずは、連鎖ボーナスを含むスコア計算をテストしましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/ScoreTest.cs</span>
<span class="k">using</span><span class="w"> </span><span class="nn">Xunit</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Models</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Tests.Models</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ScoreTest</span>
<span class="p">{</span>
<span class="w">    </span><span class="na">[Fact]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">ぷよを消去するとスコアが加算される</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Arrange</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Score</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Act</span>
<span class="w">        </span><span class="n">score</span><span class="p">.</span><span class="n">AddScore</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="n">GetScore</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Fact]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">連鎖数が増えるとボ</span><span class="n">ー</span><span class="err">ナスが加算される</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Arrange</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">score1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Score</span><span class="p">();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">score2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Score</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Act</span>
<span class="w">        </span><span class="n">score1</span><span class="p">.</span><span class="n">AddScore</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">score2</span><span class="p">.</span><span class="n">AddScore</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">score2</span><span class="p">.</span><span class="n">GetScore</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">score1</span><span class="p">.</span><span class="n">GetScore</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Theory]</span>
<span class="w">    </span><span class="na">[InlineData(1, 1)]</span>
<span class="w">    </span><span class="na">[InlineData(2, 8)]</span>
<span class="w">    </span><span class="na">[InlineData(3, 16)]</span>
<span class="w">    </span><span class="na">[InlineData(4, 32)]</span>
<span class="w">    </span><span class="na">[InlineData(5, 64)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">連鎖ボ</span><span class="n">ー</span><span class="err">ナステ</span><span class="n">ー</span><span class="err">ブルが正しく機能する</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">chainCount</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">expectedBonus</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Arrange</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Score</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Act</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">score</span><span class="p">.</span><span class="n">GetChainBonus</span><span class="p">(</span><span class="n">chainCount</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Assert</span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">expectedBonus</span><span class="p">,</span><span class="w"> </span><span class="n">bonus</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_43">実装: スコア計算<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h3>
<p>「テストが失敗することを確認したら、実装に進みましょう！」そうですね。では、スコア計算を実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Score.cs</span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">PuyoPuyoTDD.Models</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Score</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_score</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">_chainBonusTable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">96</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w"> </span><span class="mi">160</span><span class="p">,</span><span class="w"> </span><span class="mi">192</span><span class="p">,</span><span class="w"> </span><span class="mi">224</span><span class="p">,</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddScore</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">erasePuyoCount</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">chainCount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">baseScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">erasePuyoCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">chainBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetChainBonus</span><span class="p">(</span><span class="n">chainCount</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">additionalScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseScore</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">chainBonus</span><span class="p">;</span>
<span class="w">        </span><span class="n">_score</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">additionalScore</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetScore</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_score</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetChainBonus</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">chainCount</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">chainCount</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">chainCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">_chainBonusTable</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">_chainBonusTable</span><span class="p">[</span><span class="o">^</span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_chainBonusTable</span><span class="p">[</span><span class="n">chainCount</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Reset</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_44">解説: スコア計算<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h3>
<p>スコア計算では、以下の計算式を使用しています：</p>
<div class="highlight"><pre><span></span><code>最終スコア = 基本点（消去したぷよの数 × 10）× 連鎖ボーナス
</code></pre></div>
<p>連鎖ボーナステーブルは、連鎖数が増えるほど大きくなるように設定されています。これにより、プレイヤーは連鎖を狙うモチベーションが高まります。</p>
<h2 id="7">イテレーション7: 全消しボーナスの実装<a class="headerlink" href="#7" title="Permanent link">&para;</a></h2>
<p>イテレーション6でスコア計算と連鎖数のカウントができるようになりました。次は、ぷよぷよの醍醐味の一つである「全消し（ぜんけし）」ボーナスを実装していきましょう！</p>
<blockquote>
<p>ゲームバランス</p>
<p>ゲームの面白さは、挑戦と報酬のバランスから生まれます。困難な目標を達成したときの大きな報酬は、プレイヤーの達成感を高めます。</p>
<p>— Mihaly Csikszentmihalyi 『フロー体験』</p>
</blockquote>
<h3 id="_45">ユーザーストーリー<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h3>
<p>まずは、このイテレーションで実装するユーザーストーリーを確認しましょう：</p>
<blockquote>
<p>プレイヤーとして、全消しボーナスを獲得できる</p>
</blockquote>
<p>「全消しって何ですか？」良い質問です！全消しとは、盤面上のぷよをすべて消去することです。これは非常に難しい技術で、達成すると大きなボーナスが得られます。</p>
<h3 id="todo_6">TODOリスト<a class="headerlink" href="#todo_6" title="Permanent link">&para;</a></h3>
<p>このユーザーストーリーを実現するために、TODOリストを作成してみましょう：</p>
<ul>
<li>全消し判定を実装する（盤面上にぷよが残っているかをチェック）</li>
<li>全消しボーナスの計算を実装する（固定ボーナス3600点）</li>
<li>全消しボーナスのスコア加算を実装する（消去後に全消しチェック）</li>
<li>全消し演出を実装する（全消し達成時の視覚的フィードバック）</li>
</ul>
<p>「順番に実装していくんですね！」そうです。テスト駆動開発の流れに沿って、まずはテストから書いていきましょう。</p>
<h3 id="_46">テスト: 全消し判定<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h3>
<p>まず、盤面上にぷよが残っているかを判定する機能をテストしましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/StageTest.cs（続き）</span>
<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">盤面が空の場合は全消し判定が</span><span class="n">true</span><span class="err">になる</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">isAllClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stage</span><span class="p">.</span><span class="n">IsAllClear</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">isAllClear</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">盤面にぷよが残っている場合は全消し判定が</span><span class="n">false</span><span class="err">になる</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1つでもぷよがあれば全消しではない</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">isAllClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stage</span><span class="p">.</span><span class="n">IsAllClear</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">False</span><span class="p">(</span><span class="n">isAllClear</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">すべてのぷよを消去すると全消し判定が</span><span class="n">true</span><span class="err">になる</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// ぷよを配置</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 消去</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">eraseInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stage</span><span class="p">.</span><span class="n">CheckErase</span><span class="p">();</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">EraseBoards</span><span class="p">(</span><span class="n">eraseInfo</span><span class="p">.</span><span class="n">EraseList</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">isAllClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stage</span><span class="p">.</span><span class="n">IsAllClear</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">isAllClear</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>「このテストでは何を確認しているんですか？」このテストでは、以下の3つのケースを確認しています：</p>
<ol>
<li>盤面が空の場合、全消しと判定される</li>
<li>盤面にぷよが1つでも残っている場合、全消しではない</li>
<li>ぷよをすべて消去した場合、全消しと判定される</li>
</ol>
<h3 id="_47">実装: 全消し判定<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h3>
<p>では、テストが通るように実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Stage.cs（続き）</span>
<span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsAllClear</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// 盤面上のすべてのマスをチェック</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">StageHeight</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">StageWidth</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ぷよが1つでもあれば全消しではない</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">board</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// すべてのマスが空なら全消し</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>「シンプルですね！」そうですね。全消し判定の実装自体はとてもシンプルです。盤面上のすべてのマスを順番にチェックし、ぷよがある（値が0でない）マスが見つかった時点で<code>false</code>を返します。すべてのマスをチェックして、ぷよが見つからなければ<code>true</code>を返します。</p>
<p>「二重ループを使って、すべてのマスをチェックしているんですね！」その通りです！外側のループで行（y座標）を、内側のループで列（x座標）を順番にチェックしています。これにより、盤面上のすべてのマスを効率的にチェックできます。</p>
<p>テストを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test
</code></pre></div>
<p>「テストが通りました！」素晴らしい！</p>
<p>変更をコミットしておきましょう：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;feat: 全消し判定を実装&#39;</span>
</code></pre></div>
<h3 id="_48">テスト: 全消しボーナス<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h3>
<p>次に、全消しボーナスの計算をテストしましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/ScoreTest.cs（続き）</span>
<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">全消しボ</span><span class="n">ー</span><span class="err">ナスを追加すると</span><span class="mi">3600</span><span class="err">点加算される</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Score</span><span class="p">();</span>
<span class="w">    </span><span class="n">score</span><span class="p">.</span><span class="n">AddScore</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"> </span><span class="c1">// 既存のスコア</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">initialScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">score</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">score</span><span class="p">.</span><span class="n">AddZenkeshiBonus</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">initialScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">全消しボ</span><span class="n">ー</span><span class="err">ナスは何度でも加算できる</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Score</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">score</span><span class="p">.</span><span class="n">AddZenkeshiBonus</span><span class="p">();</span>
<span class="w">    </span><span class="n">score</span><span class="p">.</span><span class="n">AddZenkeshiBonus</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="mi">7200</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">);</span><span class="w"> </span><span class="c1">// 3600 × 2</span>
<span class="p">}</span>
</code></pre></div>
<p>「全消しボーナスは3600点なんですね！」そうです。これはぷよぷよの標準的な全消しボーナスです。かなり大きなボーナスなので、全消しを狙う戦略的なプレイが重要になります。</p>
<h3 id="_49">実装: 全消しボーナス<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h3>
<p>では、テストが通るように実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Score.cs（続き）</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddZenkeshiBonus</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// 全消しボーナス（固定値3600点）</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ZenkeshiBonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3600</span><span class="p">;</span>
<span class="w">    </span><span class="n">CurrentScore</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">ZenkeshiBonus</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>「とてもシンプルですね！」そうです。全消しボーナスは固定値なので、実装も非常にシンプルです。</p>
<p>テストを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test
</code></pre></div>
<p>「テストが通りました！」素晴らしい！</p>
<p>変更をコミットしておきましょう：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;feat: 全消しボーナスの計算を実装&#39;</span>
</code></pre></div>
<h3 id="_50">テスト: ゲームへの統合<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h3>
<p>次に、全消しボーナスがゲームに統合されることをテストしましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/GameTest.cs（続き）</span>
<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">全消しすると全消しボ</span><span class="n">ー</span><span class="err">ナスが加算される</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Game</span><span class="p">();</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ぷよを4つ配置（全消し可能な状態）</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="o">!</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">CheckErase</span><span class="p">;</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">initialScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="o">!</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span><span class="w"> </span><span class="c1">// 消去チェック → 消去実行</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="c1">// 通常スコア（10 × 4 × 1 = 40）+ 全消しボーナス（3600）</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">initialScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">ぷよが残っている場合は全消しボ</span><span class="n">ー</span><span class="err">ナスが加算されない</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Game</span><span class="p">();</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ぷよを配置（消去後もぷよが残る状態）</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="o">!</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// 消えないぷよ</span>

<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">CheckErase</span><span class="p">;</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">initialScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="o">!</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span><span class="w"> </span><span class="c1">// 消去チェック → 消去実行</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="c1">// 通常スコアのみ（10 × 4 × 1 = 40）</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">initialScore</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_51">実装: ゲームへの統合<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h3>
<p>では、テストが通るように実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Game.cs（更新）</span>
<span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateErasing</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Stage</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">currentEraseInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="n">eraseFrameCount</span><span class="o">++</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 一定フレーム後に消去実行</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eraseFrameCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="c1">// 約0.5秒</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Stage</span><span class="p">.</span><span class="n">EraseBoards</span><span class="p">(</span><span class="n">currentEraseInfo</span><span class="p">.</span><span class="n">EraseList</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 全消しチェック</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Stage</span><span class="p">.</span><span class="n">IsAllClear</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Score</span><span class="p">.</span><span class="n">AddZenkeshiBonus</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">currentEraseInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">CheckFall</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>「消去処理の後に全消しチェックを追加したんですね！」その通りです。ぷよを消去した後、盤面が空になったかどうかをチェックし、全消しであれば全消しボーナスを加算します。</p>
<p>テストを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test
</code></pre></div>
<p>「テストが通りました！」素晴らしい！</p>
<p>変更をコミットしておきましょう：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;feat: 全消しボーナスをゲームに統合&#39;</span>
</code></pre></div>
<h3 id="blazor_2">Blazorコンポーネントの更新<a class="headerlink" href="#blazor_2" title="Permanent link">&para;</a></h3>
<p>全消し時の演出を追加しましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Pages/GamePage.razor（更新）</span>
<span class="n">@page</span><span class="w"> </span><span class="s">&quot;/game&quot;</span>
<span class="n">@using</span><span class="w"> </span><span class="n">PuyoPuyoTDD</span><span class="p">.</span><span class="n">Models</span>
<span class="n">@using</span><span class="w"> </span><span class="n">Microsoft</span><span class="p">.</span><span class="n">JSInterop</span>
<span class="n">@implements</span><span class="w"> </span><span class="n">IDisposable</span>

<span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span><span class="err">ぷよぷよゲ</span><span class="n">ー</span><span class="err">ム</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>

<span class="n">@if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">gameStarted</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">button</span><span class="w"> </span><span class="n">@onclick</span><span class="o">=</span><span class="s">&quot;StartGame&quot;</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="o">&gt;</span><span class="err">ゲ</span><span class="n">ー</span><span class="err">ム開始</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;game-area&quot;</span><span class="w"> </span><span class="n">tabindex</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="w"> </span>
<span class="w">         </span><span class="n">@onkeydown</span><span class="o">=</span><span class="s">&quot;HandleKeyDown&quot;</span><span class="w"> </span>
<span class="w">         </span><span class="n">@onkeyup</span><span class="o">=</span><span class="s">&quot;HandleKeyUp&quot;</span>
<span class="w">         </span><span class="n">@ref</span><span class="o">=</span><span class="s">&quot;gameAreaRef&quot;</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">canvas</span><span class="w"> </span><span class="n">@ref</span><span class="o">=</span><span class="s">&quot;gameCanvas&quot;</span><span class="w"> </span>
<span class="w">                </span><span class="n">width</span><span class="o">=</span><span class="s">&quot;@game!.Config!.CanvasWidth&quot;</span><span class="w"> </span>
<span class="w">                </span><span class="n">height</span><span class="o">=</span><span class="s">&quot;@game!.Config!.CanvasHeight&quot;</span>
<span class="w">                </span><span class="n">style</span><span class="o">=</span><span class="s">&quot;border: 1px solid black;&quot;</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;/</span><span class="n">canvas</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;info-area&quot;</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;score-display&quot;</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="err">スコア</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;score-value @(scoreAnimating ? &quot;</span><span class="n">score</span><span class="o">-</span><span class="n">pulse</span><span class="s">&quot; : &quot;&quot;)&quot;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Score</span><span class="o">!</span><span class="p">.</span><span class="n">CurrentScore</span>
<span class="w">                </span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">            </span><span class="n">@if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="o">!</span><span class="p">.</span><span class="n">CombinationCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;chain-display&quot;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;chain-value&quot;</span><span class="o">&gt;</span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">CombinationCount</span><span class="w"> </span><span class="err">連鎖！</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">@if</span><span class="w"> </span><span class="p">(</span><span class="n">showZenkeshi</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;zenkeshi-display&quot;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;zenkeshi-text&quot;</span><span class="o">&gt;</span><span class="err">全消し！</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;zenkeshi-bonus&quot;</span><span class="o">&gt;+</span><span class="mi">3600</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;debug-area&quot;</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">フレ</span><span class="n">ー</span><span class="err">ム</span><span class="p">:</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Frame</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">ぷよ位置</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Player</span><span class="o">!</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">,</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Player</span><span class="o">!</span><span class="p">.</span><span class="n">PuyoY</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">回転</span><span class="p">:</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Player</span><span class="o">!</span><span class="p">.</span><span class="n">Rotation</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">モ</span><span class="n">ー</span><span class="err">ド</span><span class="p">:</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Mode</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">連鎖数</span><span class="p">:</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">CombinationCount</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span>
<span class="w">    </span><span class="cm">/* ... 既存のスタイル ... */</span>

<span class="w">    </span><span class="p">.</span><span class="n">zenkeshi</span><span class="o">-</span><span class="n">display</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">animation</span><span class="p">:</span><span class="w"> </span><span class="n">zenkeshiPop</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="w"> </span><span class="n">ease</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="o">-</span><span class="n">top</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="n">px</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">zenkeshi</span><span class="o">-</span><span class="n">text</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mf">2.5</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span><span class="w"> </span><span class="n">bold</span><span class="p">;</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="n">FFD700</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">6</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>
<span class="w">        </span><span class="n">animation</span><span class="p">:</span><span class="w"> </span><span class="n">zenkeshiGlow</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="w"> </span><span class="n">infinite</span><span class="w"> </span><span class="n">alternate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">zenkeshi</span><span class="o">-</span><span class="n">bonus</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mf">1.8</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span><span class="w"> </span><span class="n">bold</span><span class="p">;</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="n">FFA500</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="n">px</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">@keyframes</span><span class="w"> </span><span class="n">zenkeshiPop</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="n">opacity</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mf">5d</span><span class="n">eg</span><span class="p">);</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="mi">50</span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mf">1.2</span><span class="p">)</span><span class="w"> </span><span class="n">rotate</span><span class="p">(</span><span class="mf">5d</span><span class="n">eg</span><span class="p">);</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="n">opacity</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">rotate</span><span class="p">(</span><span class="mf">0d</span><span class="n">eg</span><span class="p">);</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">@keyframes</span><span class="w"> </span><span class="n">zenkeshiGlow</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">6</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">to</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">12</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span>

<span class="n">@code</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Game</span><span class="o">?</span><span class="w"> </span><span class="n">game</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">ElementReference</span><span class="w"> </span><span class="n">gameCanvas</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">ElementReference</span><span class="w"> </span><span class="n">gameAreaRef</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">gameStarted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Timer</span><span class="o">?</span><span class="w"> </span><span class="n">gameTimer</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">IJSObjectReference</span><span class="o">?</span><span class="w"> </span><span class="n">canvasModule</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">scoreAnimating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lastScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">showZenkeshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>

<span class="w">    </span><span class="na">[Inject]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">IJSRuntime</span><span class="w"> </span><span class="n">JSRuntime</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="o">!</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ... その他のメソッド ...</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">GameLoop</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">previousScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastScore</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">wasAllClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="o">?.</span><span class="n">IsAllClear</span><span class="p">()</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// ゲーム状態を更新</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 全消しチェック（消去後に盤面が空になった）</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">wasAllClear</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="o">?.</span><span class="n">IsAllClear</span><span class="p">()</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">false</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">showZenkeshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// 2秒後に非表示</span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">).</span><span class="n">ContinueWith</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">showZenkeshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">                </span><span class="n">InvokeAsync</span><span class="p">(</span><span class="n">StateHasChanged</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// スコアが変化したらアニメーション</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="o">!</span><span class="p">.</span><span class="n">CurrentScore</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">previousScore</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">scoreAnimating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">            </span><span class="n">lastScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">;</span>

<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="p">(</span><span class="mi">300</span><span class="p">).</span><span class="n">ContinueWith</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">scoreAnimating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">                </span><span class="n">InvokeAsync</span><span class="p">(</span><span class="n">StateHasChanged</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// canvas描画</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvasModule</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nf">DrawGame</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 画面を更新</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nf">InvokeAsync</span><span class="p">(</span><span class="n">StateHasChanged</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ... その他のメソッド ...</span>
<span class="p">}</span>
</code></pre></div>
<p>「全消し時に特別な演出が追加されたんですね！」そうです。金色の「全消し！」テキストと「+3600」ボーナス表示が、ポップアップアニメーションとともに表示されます。</p>
<h3 id="_52">画面の確認<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h3>
<p>実装した機能を実際にブラウザで確認してみましょう！</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>PuyoPuyoTDD
dotnet<span class="w"> </span>run
</code></pre></div>
<p>ブラウザで <code>http://localhost:5000/game</code> にアクセスして、「ゲーム開始」ボタンをクリックしてください。</p>
<h4 id="_53">全消しの確認<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h4>
<p>ゲームをプレイして、全消しを実現してみましょう：</p>
<ol>
<li><strong>シンプルな全消し</strong>: 最初の4つのぷよを揃えて消すだけで全消し</li>
<li>盤面が空になる</li>
<li>金色の「全消し！」テキストが表示される</li>
<li>「+3600」ボーナスが表示される</li>
<li>
<p>スコアが大きく増加する</p>
</li>
<li>
<p><strong>連鎖からの全消し</strong>: 複数回の連鎖を経て全消し</p>
</li>
<li>連鎖ボーナス + 全消しボーナスで高得点</li>
<li>連鎖表示の後に全消し表示が出る</li>
</ol>
<p>「全消しすると画面が華やかになりますね！」そうなんです。プレイヤーの大きな達成に対して、しっかりとフィードバックを返すことが重要です。</p>
<h4 id="_54">全消しボーナスの確認<a class="headerlink" href="#_54" title="Permanent link">&para;</a></h4>
<p>スコアの変化を確認してみましょう：</p>
<ol>
<li><strong>通常消去</strong>: 4個消去、1連鎖</li>
<li>
<p>スコア: 10 × 4 × 1 = 40点</p>
</li>
<li>
<p><strong>全消し</strong>: 4個消去、1連鎖、全消し</p>
</li>
<li>
<p>スコア: 10 × 4 × 1 + 3600 = 3640点</p>
</li>
<li>
<p><strong>連鎖全消し</strong>: 4個消去、2連鎖、全消し</p>
</li>
<li>1連鎖目: 10 × 4 × 1 = 40点</li>
<li>2連鎖目: 10 × 4 × 8 = 320点</li>
<li>全消しボーナス: 3600点</li>
<li>合計: 3960点</li>
</ol>
<p>「全消しボーナスの威力がすごいですね！」その通りです！全消しは難しいですが、達成すると大きなボーナスが得られます。</p>
<p>確認が終わったら、Ctrl+Cでアプリケーションを停止しましょう。</p>
<h3 id="7_1">イテレーション7のまとめ<a class="headerlink" href="#7_1" title="Permanent link">&para;</a></h3>
<p>お疲れさまでした！イテレーション7が完了しました。ここまでで、以下のことができるようになりました：</p>
<ol>
<li><strong>全消し判定</strong>: 盤面上にぷよが残っているかをチェック</li>
<li><strong>全消しボーナス</strong>: 固定値3600点のボーナス</li>
<li><strong>ゲームへの統合</strong>: 消去後の全消しチェックとボーナス加算</li>
<li><strong>全消し演出</strong>: 金色の「全消し！」表示と「+3600」ボーナス表示</li>
<li><strong>視覚的フィードバック</strong>: ポップアップアニメーションと輝きエフェクト</li>
</ol>
<p>「ゲームがさらに面白くなりました！」その通りです！全消しという目標ができることで、戦略的なプレイが生まれます。</p>
<blockquote>
<p>ゲーム設計の妙</p>
<p>困難だが達成可能な目標と、それに見合った報酬を用意することで、プレイヤーは夢中になってゲームをプレイします。全消しボーナスは、まさにその好例です。</p>
<p>— Sid Meier 『Game Design』</p>
</blockquote>
<p>次のイテレーション8では、ゲームオーバー判定とリスタート機能を実装していきます。これで、ぷよぷよゲームとしての基本機能が完成しますよ！楽しみにしていてください。</p>
<h2 id="8">イテレーション8: ゲームオーバーとリスタートの実装<a class="headerlink" href="#8" title="Permanent link">&para;</a></h2>
<p>イテレーション7で全消しボーナスが実装できました。いよいよ最後のイテレーションです！ゲームオーバー判定とリスタート機能を実装して、ぷよぷよゲームを完成させましょう。</p>
<blockquote>
<p>ゲームの終わり</p>
<p>ゲームには明確な始まりと終わりが必要です。終わりがあるからこそ、プレイヤーは次のプレイへの意欲を持ちます。</p>
<p>— Jane McGonigal 『Reality is Broken』</p>
</blockquote>
<h3 id="_55">ユーザーストーリー<a class="headerlink" href="#_55" title="Permanent link">&para;</a></h3>
<p>まずは、このイテレーションで実装するユーザーストーリーを確認しましょう：</p>
<blockquote>
<p>プレイヤーとして、ゲームオーバーになるとゲーム終了の演出を見ることができる</p>
<p>プレイヤーとして、ゲームオーバー後に新しいゲームを開始できる</p>
</blockquote>
<p>「ゲームが終わったことが明確に分かり、また新しく始められるといいですね！」そうですね。ゲームの終わりが明確でないと、プレイヤーはモヤモヤした気持ちになってしまいます。</p>
<h3 id="todo_7">TODOリスト<a class="headerlink" href="#todo_7" title="Permanent link">&para;</a></h3>
<p>このユーザーストーリーを実現するために、TODOリストを作成してみましょう：</p>
<ul>
<li>ゲームオーバー判定を実装する（新しいぷよを配置できない状態を検出）</li>
<li>ゲームオーバー演出を実装する（ゲームオーバー時の表示）</li>
<li>リスタート機能を実装する（ゲームを最初から始める）</li>
<li>リスタートボタンの表示を実装する（UI）</li>
</ul>
<p>「順番に実装していくんですね！」そうです。テスト駆動開発の流れに沿って、まずはテストから書いていきましょう。</p>
<h3 id="_56">テスト: ゲームオーバー判定<a class="headerlink" href="#_56" title="Permanent link">&para;</a></h3>
<p>まず、新しいぷよを配置できない状態がゲームオーバーと判定されるかをテストしましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/PlayerTest.cs（続き）</span>
<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">新しいぷよを配置できない場合はゲ</span><span class="n">ー</span><span class="err">ムオ</span><span class="n">ー</span><span class="err">バ</span><span class="n">ー</span><span class="err">判定が</span><span class="n">true</span><span class="err">になる</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="c1">// ステージの上部（新しいぷよの配置位置）にぷよを配置</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// 中央上部</span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">isGameOver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">CheckGameOver</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">isGameOver</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">新しいぷよを配置できる場合はゲ</span><span class="n">ー</span><span class="err">ムオ</span><span class="n">ー</span><span class="err">バ</span><span class="n">ー</span><span class="err">判定が</span><span class="n">false</span><span class="err">になる</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">isGameOver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">CheckGameOver</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">False</span><span class="p">(</span><span class="n">isGameOver</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">回転を考慮した</span><span class="mi">2</span><span class="err">つ目のぷよの位置も判定に含まれる</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="c1">// 2つ目のぷよの位置（上）にぷよを配置</span>
<span class="w">    </span><span class="n">stage</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// 画面外だが判定には影響</span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="n">SetRotation</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// 上向き</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">isGameOver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">CheckGameOver</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="c1">// 2つ目のぷよの位置が画面外の場合はゲームオーバーではない</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">False</span><span class="p">(</span><span class="n">isGameOver</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>「このテストでは何を確認しているんですか？」このテストでは、以下のケースを確認しています：</p>
<ol>
<li>新しいぷよの配置位置にすでにぷよがある場合、ゲームオーバーと判定される</li>
<li>配置位置が空いている場合、ゲームオーバーではない</li>
<li>2つ目のぷよの位置も考慮される</li>
</ol>
<h3 id="_57">実装: ゲームオーバー判定<a class="headerlink" href="#_57" title="Permanent link">&para;</a></h3>
<p>では、テストが通るように実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Player.cs（続き）</span>
<span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">CheckGameOver</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// 新しいぷよの配置位置（中央上部）にすでにぷよがあるかチェック</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stage</span><span class="p">.</span><span class="n">GetPuyo</span><span class="p">(</span><span class="n">PuyoX</span><span class="p">,</span><span class="w"> </span><span class="n">PuyoY</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 2つ目のぷよの位置もチェック</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="p">(</span><span class="n">secondX</span><span class="p">,</span><span class="w"> </span><span class="n">secondY</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSecondPuyoPosition</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// 2つ目のぷよが画面内で、その位置にすでにぷよがある場合</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">secondY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">secondY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">StageHeight</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">        </span><span class="n">secondX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">secondX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">StageWidth</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stage</span><span class="p">.</span><span class="n">GetPuyo</span><span class="p">(</span><span class="n">secondX</span><span class="p">,</span><span class="w"> </span><span class="n">secondY</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>「配置位置にぷよがあるかどうかをチェックしているんですね！」その通りです。1つ目と2つ目のぷよ、両方の配置位置にぷよがないことを確認しています。</p>
<p>テストを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test
</code></pre></div>
<p>「テストが通りました！」素晴らしい！</p>
<p>変更をコミットしておきましょう：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;feat: ゲームオーバー判定を実装&#39;</span>
</code></pre></div>
<h3 id="_58">テスト: ゲームモード遷移<a class="headerlink" href="#_58" title="Permanent link">&para;</a></h3>
<p>次に、ゲームオーバー時のゲームモード遷移をテストしましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/GameTest.cs（続き）</span>
<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">新しいぷよを配置できない場合は</span><span class="n">GameOver</span><span class="err">モ</span><span class="n">ー</span><span class="err">ドに遷移する</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Game</span><span class="p">();</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ステージの上部にぷよを配置</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="o">!</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">NewPuyo</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">GameMode</span><span class="p">.</span><span class="n">GameOver</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">GameOver</span><span class="err">モ</span><span class="n">ー</span><span class="err">ドではゲ</span><span class="n">ー</span><span class="err">ムの処理が停止する</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Game</span><span class="p">();</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">GameOver</span><span class="p">;</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">initialFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Frame</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="c1">// フレームは進むが、ゲーム処理は行われない</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">initialFrame</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Frame</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_59">実装: ゲームモード遷移<a class="headerlink" href="#_59" title="Permanent link">&para;</a></h3>
<p>では、テストが通るように実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Game.cs（更新）</span>
<span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateNewPuyo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Player</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 連鎖数をリセット</span>
<span class="w">    </span><span class="n">CombinationCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 新しいぷよを生成</span>
<span class="w">    </span><span class="n">Player</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ゲームオーバー判定</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Player</span><span class="p">.</span><span class="n">CheckGameOver</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">GameOver</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Playingモードに遷移</span>
<span class="w">    </span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Playing</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Frame</span><span class="o">++</span><span class="p">;</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">Mode</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Start</span><span class="p">:</span>
<span class="w">            </span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">NewPuyo</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">NewPuyo</span><span class="p">:</span>
<span class="w">            </span><span class="n">UpdateNewPuyo</span><span class="p">();</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Playing</span><span class="p">:</span>
<span class="w">            </span><span class="n">UpdatePlaying</span><span class="p">();</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">CheckErase</span><span class="p">:</span>
<span class="w">            </span><span class="n">UpdateCheckErase</span><span class="p">();</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Erasing</span><span class="p">:</span>
<span class="w">            </span><span class="n">UpdateErasing</span><span class="p">();</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">CheckFall</span><span class="p">:</span>
<span class="w">            </span><span class="n">UpdateCheckFall</span><span class="p">();</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Fall</span><span class="p">:</span>
<span class="w">            </span><span class="n">UpdateFall</span><span class="p">();</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">GameOver</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// ゲームオーバー時は何もしない</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>「新しいぷよ生成時にゲームオーバー判定を追加したんですね！」その通りです。新しいぷよを配置できない場合、ゲームオーバーモードに遷移します。</p>
<p>テストを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test
</code></pre></div>
<p>「テストが通りました！」素晴らしい！</p>
<p>変更をコミットしておきましょう：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;feat: ゲームオーバー時のモード遷移を実装&#39;</span>
</code></pre></div>
<h3 id="_60">テスト: リスタート機能<a class="headerlink" href="#_60" title="Permanent link">&para;</a></h3>
<p>次に、リスタート機能をテストしましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD.Tests/Models/GameTest.cs（続き）</span>
<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">リスタ</span><span class="n">ー</span><span class="err">トするとゲ</span><span class="n">ー</span><span class="err">ムが初期状態に戻る</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Game</span><span class="p">();</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// ゲームを進める</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="o">!</span><span class="p">.</span><span class="n">AddScore</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="o">!</span><span class="p">.</span><span class="n">SetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">GameOver</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">);</span><span class="w"> </span><span class="c1">// スコアがリセット</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="p">.</span><span class="n">GetPuyo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">));</span><span class="w"> </span><span class="c1">// ステージがクリア</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">GameMode</span><span class="p">.</span><span class="n">Start</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="p">);</span><span class="w"> </span><span class="c1">// モードがStartに戻る</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Frame</span><span class="p">);</span><span class="w"> </span><span class="c1">// フレームがリセット</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="err">リスタ</span><span class="n">ー</span><span class="err">ト後にゲ</span><span class="n">ー</span><span class="err">ムを開始できる</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Game</span><span class="p">();</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">GameOver</span><span class="p">;</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span><span class="w"> </span><span class="c1">// Start → NewPuyo</span>
<span class="w">    </span><span class="n">game</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span><span class="w"> </span><span class="c1">// NewPuyo → Playing</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">GameMode</span><span class="p">.</span><span class="n">Playing</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="p">);</span>
<span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="n">NotNull</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_61">実装: リスタート機能<a class="headerlink" href="#_61" title="Permanent link">&para;</a></h3>
<p>では、テストが通るように実装していきましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Models/Game.cs（更新）</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Restart</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ゲームを初期化</span>
<span class="w">    </span><span class="n">Initialize</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>「シンプルですね！」そうです。リスタートは、ゲームを初期状態に戻すだけなので、<code>Initialize()</code>メソッドを呼び出すだけで実現できます。</p>
<p>テストを実行してみましょう：</p>
<div class="highlight"><pre><span></span><code>dotnet<span class="w"> </span>cake<span class="w"> </span>--target<span class="o">=</span>Test
</code></pre></div>
<p>「テストが通りました！」素晴らしい！</p>
<p>変更をコミットしておきましょう：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;feat: リスタート機能を実装&#39;</span>
</code></pre></div>
<h3 id="blazor_3">Blazorコンポーネントの更新<a class="headerlink" href="#blazor_3" title="Permanent link">&para;</a></h3>
<p>ゲームオーバー演出とリスタートボタンを追加しましょう。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// PuyoPuyoTDD/Pages/GamePage.razor（更新）</span>
<span class="n">@page</span><span class="w"> </span><span class="s">&quot;/game&quot;</span>
<span class="n">@using</span><span class="w"> </span><span class="n">PuyoPuyoTDD</span><span class="p">.</span><span class="n">Models</span>
<span class="n">@using</span><span class="w"> </span><span class="n">Microsoft</span><span class="p">.</span><span class="n">JSInterop</span>
<span class="n">@implements</span><span class="w"> </span><span class="n">IDisposable</span>

<span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span><span class="err">ぷよぷよゲ</span><span class="n">ー</span><span class="err">ム</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>

<span class="n">@if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">gameStarted</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">button</span><span class="w"> </span><span class="n">@onclick</span><span class="o">=</span><span class="s">&quot;StartGame&quot;</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="o">&gt;</span><span class="err">ゲ</span><span class="n">ー</span><span class="err">ム開始</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;game-container&quot;</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;game-area&quot;</span><span class="w"> </span><span class="n">tabindex</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="w"> </span>
<span class="w">             </span><span class="n">@onkeydown</span><span class="o">=</span><span class="s">&quot;HandleKeyDown&quot;</span><span class="w"> </span>
<span class="w">             </span><span class="n">@onkeyup</span><span class="o">=</span><span class="s">&quot;HandleKeyUp&quot;</span>
<span class="w">             </span><span class="n">@ref</span><span class="o">=</span><span class="s">&quot;gameAreaRef&quot;</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="n">canvas</span><span class="w"> </span><span class="n">@ref</span><span class="o">=</span><span class="s">&quot;gameCanvas&quot;</span><span class="w"> </span>
<span class="w">                    </span><span class="n">width</span><span class="o">=</span><span class="s">&quot;@game!.Config!.CanvasWidth&quot;</span><span class="w"> </span>
<span class="w">                    </span><span class="n">height</span><span class="o">=</span><span class="s">&quot;@game!.Config!.CanvasHeight&quot;</span>
<span class="w">                    </span><span class="n">style</span><span class="o">=</span><span class="s">&quot;border: 1px solid black;&quot;</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;/</span><span class="n">canvas</span><span class="o">&gt;</span>

<span class="w">            </span><span class="n">@if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="o">!</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">GameOver</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;game-over-overlay&quot;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;game-over-content&quot;</span><span class="o">&gt;</span>
<span class="w">                        </span><span class="o">&lt;</span><span class="n">h1</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;game-over-text&quot;</span><span class="o">&gt;</span><span class="n">GAME</span><span class="w"> </span><span class="n">OVER</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<span class="w">                        </span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;final-score&quot;</span><span class="o">&gt;</span><span class="err">最終スコア</span><span class="p">:</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Score</span><span class="o">!</span><span class="p">.</span><span class="n">CurrentScore</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                        </span><span class="o">&lt;</span><span class="n">button</span><span class="w"> </span><span class="n">@onclick</span><span class="o">=</span><span class="s">&quot;RestartGame&quot;</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;btn btn-success btn-lg&quot;</span><span class="o">&gt;</span>
<span class="w">                            </span><span class="err">もう一度プレイ</span>
<span class="w">                        </span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;info-area&quot;</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;score-display&quot;</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="err">スコア</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;score-value @(scoreAnimating ? &quot;</span><span class="n">score</span><span class="o">-</span><span class="n">pulse</span><span class="s">&quot; : &quot;&quot;)&quot;</span><span class="o">&gt;</span>
<span class="w">                        </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Score</span><span class="o">!</span><span class="p">.</span><span class="n">CurrentScore</span>
<span class="w">                    </span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">                </span><span class="n">@if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="o">!</span><span class="p">.</span><span class="n">CombinationCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">game</span><span class="o">!</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">GameOver</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;chain-display&quot;</span><span class="o">&gt;</span>
<span class="w">                        </span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;chain-value&quot;</span><span class="o">&gt;</span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">CombinationCount</span><span class="w"> </span><span class="err">連鎖！</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">@if</span><span class="w"> </span><span class="p">(</span><span class="n">showZenkeshi</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">game</span><span class="o">!</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">GameOver</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;zenkeshi-display&quot;</span><span class="o">&gt;</span>
<span class="w">                        </span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;zenkeshi-text&quot;</span><span class="o">&gt;</span><span class="err">全消し！</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                        </span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;zenkeshi-bonus&quot;</span><span class="o">&gt;+</span><span class="mi">3600</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                    </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">class</span><span class="o">=</span><span class="s">&quot;debug-area&quot;</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">フレ</span><span class="n">ー</span><span class="err">ム</span><span class="p">:</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Frame</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">ぷよ位置</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Player</span><span class="o">!</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">,</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Player</span><span class="o">!</span><span class="p">.</span><span class="n">PuyoY</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">回転</span><span class="p">:</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Player</span><span class="o">!</span><span class="p">.</span><span class="n">Rotation</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">モ</span><span class="n">ー</span><span class="err">ド</span><span class="p">:</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">Mode</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">連鎖数</span><span class="p">:</span><span class="w"> </span><span class="n">@game</span><span class="o">!</span><span class="p">.</span><span class="n">CombinationCount</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">.</span><span class="n">game</span><span class="o">-</span><span class="n">container</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">display</span><span class="p">:</span><span class="w"> </span><span class="n">flex</span><span class="p">;</span>
<span class="w">        </span><span class="n">justify</span><span class="o">-</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="n">center</span><span class="p">;</span>
<span class="w">        </span><span class="n">align</span><span class="o">-</span><span class="n">items</span><span class="p">:</span><span class="w"> </span><span class="n">center</span><span class="p">;</span>
<span class="w">        </span><span class="n">min</span><span class="o">-</span><span class="n">height</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="n">px</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">game</span><span class="o">-</span><span class="n">area</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">relative</span><span class="p">;</span>
<span class="w">        </span><span class="n">display</span><span class="p">:</span><span class="w"> </span><span class="n">flex</span><span class="p">;</span>
<span class="w">        </span><span class="n">flex</span><span class="o">-</span><span class="n">direction</span><span class="p">:</span><span class="w"> </span><span class="n">column</span><span class="p">;</span>
<span class="w">        </span><span class="n">align</span><span class="o">-</span><span class="n">items</span><span class="p">:</span><span class="w"> </span><span class="n">center</span><span class="p">;</span>
<span class="w">        </span><span class="n">gap</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="n">px</span><span class="p">;</span>
<span class="w">        </span><span class="n">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="n">px</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">game</span><span class="o">-</span><span class="n">over</span><span class="o">-</span><span class="n">overlay</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">absolute</span><span class="p">;</span>
<span class="w">        </span><span class="n">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">left</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">right</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">);</span>
<span class="w">        </span><span class="n">display</span><span class="p">:</span><span class="w"> </span><span class="n">flex</span><span class="p">;</span>
<span class="w">        </span><span class="n">justify</span><span class="o">-</span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="n">center</span><span class="p">;</span>
<span class="w">        </span><span class="n">align</span><span class="o">-</span><span class="n">items</span><span class="p">:</span><span class="w"> </span><span class="n">center</span><span class="p">;</span>
<span class="w">        </span><span class="n">z</span><span class="o">-</span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<span class="w">        </span><span class="n">animation</span><span class="p">:</span><span class="w"> </span><span class="n">fadeIn</span><span class="w"> </span><span class="mf">0.5</span><span class="n">s</span><span class="w"> </span><span class="n">ease</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">game</span><span class="o">-</span><span class="n">over</span><span class="o">-</span><span class="n">content</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span><span class="w"> </span><span class="n">center</span><span class="p">;</span>
<span class="w">        </span><span class="n">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="n">px</span><span class="p">;</span>
<span class="w">        </span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">);</span>
<span class="w">        </span><span class="n">border</span><span class="o">-</span><span class="n">radius</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="n">px</span><span class="p">;</span>
<span class="w">        </span><span class="n">backdrop</span><span class="o">-</span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="n">blur</span><span class="p">(</span><span class="mi">10</span><span class="n">px</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">game</span><span class="o">-</span><span class="n">over</span><span class="o">-</span><span class="n">text</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="n">FF4444</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span><span class="w"> </span><span class="n">bold</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">20</span><span class="n">px</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="n">px</span><span class="w"> </span><span class="mi">4</span><span class="n">px</span><span class="w"> </span><span class="mi">8</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">);</span>
<span class="w">        </span><span class="n">animation</span><span class="p">:</span><span class="w"> </span><span class="n">gameOverPulse</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="w"> </span><span class="n">infinite</span><span class="w"> </span><span class="n">alternate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">@keyframes</span><span class="w"> </span><span class="n">gameOverPulse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span>
<span class="w">            </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="n">px</span><span class="w"> </span><span class="mi">4</span><span class="n">px</span><span class="w"> </span><span class="mi">8</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mf">0.8</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">to</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mf">1.05</span><span class="p">);</span><span class="w"> </span>
<span class="w">            </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="n">px</span><span class="w"> </span><span class="mi">4</span><span class="n">px</span><span class="w"> </span><span class="mi">16</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">final</span><span class="o">-</span><span class="n">score</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="n">FFFFFF</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mf">1.5</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="n">px</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">30</span><span class="n">px</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">btn</span><span class="o">-</span><span class="n">lg</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="n">px</span><span class="w"> </span><span class="mi">40</span><span class="n">px</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span><span class="w"> </span><span class="n">bold</span><span class="p">;</span>
<span class="w">        </span><span class="n">border</span><span class="o">-</span><span class="n">radius</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="n">px</span><span class="p">;</span>
<span class="w">        </span><span class="n">transition</span><span class="p">:</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="mf">0.3</span><span class="n">s</span><span class="w"> </span><span class="n">ease</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">btn</span><span class="o">-</span><span class="n">lg</span><span class="p">:</span><span class="n">hover</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mf">1.1</span><span class="p">);</span>
<span class="w">        </span><span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">5</span><span class="n">px</span><span class="w"> </span><span class="mi">15</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* 既存のスタイル */</span>
<span class="w">    </span><span class="p">.</span><span class="n">info</span><span class="o">-</span><span class="n">area</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">display</span><span class="p">:</span><span class="w"> </span><span class="n">flex</span><span class="p">;</span>
<span class="w">        </span><span class="n">flex</span><span class="o">-</span><span class="n">direction</span><span class="p">:</span><span class="w"> </span><span class="n">column</span><span class="p">;</span>
<span class="w">        </span><span class="n">align</span><span class="o">-</span><span class="n">items</span><span class="p">:</span><span class="w"> </span><span class="n">center</span><span class="p">;</span>
<span class="w">        </span><span class="n">gap</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="n">px</span><span class="p">;</span>
<span class="w">        </span><span class="n">min</span><span class="o">-</span><span class="n">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="n">px</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">score</span><span class="o">-</span><span class="n">display</span><span class="w"> </span><span class="n">h4</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mi">333</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">score</span><span class="o">-</span><span class="k">value</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span><span class="w"> </span><span class="n">bold</span><span class="p">;</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mf">2196F</span><span class="mi">3</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="n">px</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">transition</span><span class="p">:</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="mf">0.3</span><span class="n">s</span><span class="w"> </span><span class="n">ease</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">score</span><span class="o">-</span><span class="n">pulse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">animation</span><span class="p">:</span><span class="w"> </span><span class="n">pulse</span><span class="w"> </span><span class="mf">0.3</span><span class="n">s</span><span class="w"> </span><span class="n">ease</span><span class="p">;</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="n">FF9800</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">@keyframes</span><span class="w"> </span><span class="n">pulse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="mi">0</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="mi">50</span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mf">1.2</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">chain</span><span class="o">-</span><span class="n">display</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">animation</span><span class="p">:</span><span class="w"> </span><span class="n">fadeIn</span><span class="w"> </span><span class="mf">0.3</span><span class="n">s</span><span class="w"> </span><span class="n">ease</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">chain</span><span class="o">-</span><span class="k">value</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mf">1.5</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span><span class="w"> </span><span class="n">bold</span><span class="p">;</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="n">F44336</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="n">px</span><span class="w"> </span><span class="mi">2</span><span class="n">px</span><span class="w"> </span><span class="mi">4</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">@keyframes</span><span class="w"> </span><span class="n">fadeIn</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">opacity</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">translateY</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="n">px</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">to</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">opacity</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">translateY</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">zenkeshi</span><span class="o">-</span><span class="n">display</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">animation</span><span class="p">:</span><span class="w"> </span><span class="n">zenkeshiPop</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="w"> </span><span class="n">ease</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="o">-</span><span class="n">top</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="n">px</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">zenkeshi</span><span class="o">-</span><span class="n">text</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mf">2.5</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span><span class="w"> </span><span class="n">bold</span><span class="p">;</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="n">FFD700</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">6</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>
<span class="w">        </span><span class="n">animation</span><span class="p">:</span><span class="w"> </span><span class="n">zenkeshiGlow</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="w"> </span><span class="n">infinite</span><span class="w"> </span><span class="n">alternate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">zenkeshi</span><span class="o">-</span><span class="n">bonus</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mf">1.8</span><span class="n">rem</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span><span class="w"> </span><span class="n">bold</span><span class="p">;</span>
<span class="w">        </span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="n">FFA500</span><span class="p">;</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="n">px</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">@keyframes</span><span class="w"> </span><span class="n">zenkeshiPop</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="n">opacity</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mf">5d</span><span class="n">eg</span><span class="p">);</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="mi">50</span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mf">1.2</span><span class="p">)</span><span class="w"> </span><span class="n">rotate</span><span class="p">(</span><span class="mf">5d</span><span class="n">eg</span><span class="p">);</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="n">opacity</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="n">transform</span><span class="p">:</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">rotate</span><span class="p">(</span><span class="mf">0d</span><span class="n">eg</span><span class="p">);</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">@keyframes</span><span class="w"> </span><span class="n">zenkeshiGlow</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">6</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">to</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">text</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">3</span><span class="n">px</span><span class="w"> </span><span class="mi">12</span><span class="n">px</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">debug</span><span class="o">-</span><span class="n">area</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="n">px</span><span class="w"> </span><span class="n">solid</span><span class="w"> </span><span class="err">#</span><span class="n">ccc</span><span class="p">;</span>
<span class="w">        </span><span class="n">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="n">px</span><span class="p">;</span>
<span class="w">        </span><span class="n">border</span><span class="o">-</span><span class="n">radius</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="n">px</span><span class="p">;</span>
<span class="w">        </span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="n">f9f9f9</span><span class="p">;</span>
<span class="w">        </span><span class="n">font</span><span class="o">-</span><span class="n">family</span><span class="p">:</span><span class="w"> </span><span class="n">monospace</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">.</span><span class="n">debug</span><span class="o">-</span><span class="n">area</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="n">px</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span>

<span class="n">@code</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Game</span><span class="o">?</span><span class="w"> </span><span class="n">game</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">ElementReference</span><span class="w"> </span><span class="n">gameCanvas</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">ElementReference</span><span class="w"> </span><span class="n">gameAreaRef</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">gameStarted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Timer</span><span class="o">?</span><span class="w"> </span><span class="n">gameTimer</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">IJSObjectReference</span><span class="o">?</span><span class="w"> </span><span class="n">canvasModule</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">scoreAnimating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lastScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">showZenkeshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>

<span class="w">    </span><span class="na">[Inject]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">IJSRuntime</span><span class="w"> </span><span class="n">JSRuntime</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="o">!</span><span class="p">;</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">OnAfterRenderAsync</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">firstRender</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">firstRender</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gameStarted</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">canvasModule</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">canvasModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">JSRuntime</span><span class="p">.</span><span class="n">InvokeAsync</span><span class="o">&lt;</span><span class="n">IJSObjectReference</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;import&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;./js/canvas.js&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">StartGame</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Game</span><span class="p">();</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="o">!</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Playing</span><span class="p">;</span>
<span class="w">        </span><span class="n">gameStarted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>

<span class="w">        </span><span class="n">StateHasChanged</span><span class="p">();</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">gameAreaRef</span><span class="p">.</span><span class="n">FocusAsync</span><span class="p">();</span>

<span class="w">        </span><span class="n">gameTimer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Timer</span><span class="p">(</span>
<span class="w">            </span><span class="k">async</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">GameLoop</span><span class="p">(),</span>
<span class="w">            </span><span class="k">null</span><span class="p">,</span>
<span class="w">            </span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span>
<span class="w">            </span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMilliseconds</span><span class="p">(</span><span class="mf">16.6</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">RestartGame</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="o">!</span><span class="p">.</span><span class="n">CreateNewPuyo</span><span class="p">();</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Playing</span><span class="p">;</span>
<span class="w">        </span><span class="n">showZenkeshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">scoreAnimating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">lastScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">gameAreaRef</span><span class="p">.</span><span class="n">FocusAsync</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">GameLoop</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">previousScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastScore</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">wasAllClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="o">?.</span><span class="n">IsAllClear</span><span class="p">()</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// ゲーム状態を更新</span>
<span class="w">        </span><span class="n">game</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 全消しチェック</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">wasAllClear</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="o">?.</span><span class="n">IsAllClear</span><span class="p">()</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">false</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">showZenkeshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">).</span><span class="n">ContinueWith</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">showZenkeshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">                </span><span class="n">InvokeAsync</span><span class="p">(</span><span class="n">StateHasChanged</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// スコアが変化したらアニメーション</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="o">!</span><span class="p">.</span><span class="n">CurrentScore</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">previousScore</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">scoreAnimating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">            </span><span class="n">lastScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Score</span><span class="p">.</span><span class="n">CurrentScore</span><span class="p">;</span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="p">(</span><span class="mi">300</span><span class="p">).</span><span class="n">ContinueWith</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">scoreAnimating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">                </span><span class="n">InvokeAsync</span><span class="p">(</span><span class="n">StateHasChanged</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// canvas描画</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvasModule</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nf">DrawGame</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nf">InvokeAsync</span><span class="p">(</span><span class="n">StateHasChanged</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">DrawGame</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">canvasModule</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">canvasModule</span><span class="p">.</span><span class="n">InvokeVoidAsync</span><span class="p">(</span><span class="s">&quot;clearCanvas&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">gameCanvas</span><span class="p">);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">board</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Stage</span><span class="o">!</span><span class="p">.</span><span class="n">GetBoard</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="o">!</span><span class="p">.</span><span class="n">StageHeight</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">StageWidth</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">puyoType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">board</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">];</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">puyoType</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="k">await</span><span class="w"> </span><span class="n">canvasModule</span><span class="p">.</span><span class="n">InvokeVoidAsync</span><span class="p">(</span>
<span class="w">                        </span><span class="s">&quot;drawPuyo&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">gameCanvas</span><span class="p">,</span>
<span class="w">                        </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">PuyoSize</span><span class="p">,</span>
<span class="w">                        </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">PuyoSize</span><span class="p">,</span>
<span class="w">                        </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">PuyoSize</span><span class="p">,</span>
<span class="w">                        </span><span class="n">puyoType</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Playing</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="n">canvasModule</span><span class="p">.</span><span class="n">InvokeVoidAsync</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;drawPuyo&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">gameCanvas</span><span class="p">,</span>
<span class="w">                </span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">PuyoX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">PuyoSize</span><span class="p">,</span>
<span class="w">                </span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">PuyoY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">PuyoSize</span><span class="p">,</span>
<span class="w">                </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">PuyoSize</span><span class="p">,</span>
<span class="w">                </span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">PuyoType</span><span class="p">);</span>

<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="p">(</span><span class="n">secondX</span><span class="p">,</span><span class="w"> </span><span class="n">secondY</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSecondPuyoPosition</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">secondY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">secondY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">StageHeight</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="n">secondX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">secondX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">StageWidth</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">await</span><span class="w"> </span><span class="n">canvasModule</span><span class="p">.</span><span class="n">InvokeVoidAsync</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;drawPuyo&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">gameCanvas</span><span class="p">,</span>
<span class="w">                    </span><span class="n">secondX</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">PuyoSize</span><span class="p">,</span>
<span class="w">                    </span><span class="n">secondY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">PuyoSize</span><span class="p">,</span>
<span class="w">                    </span><span class="n">game</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">PuyoSize</span><span class="p">,</span>
<span class="w">                    </span><span class="n">game</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">NextPuyoType</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">GetSecondPuyoPosition</span><span class="p">(</span><span class="n">Player</span><span class="w"> </span><span class="n">player</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">Rotation</span><span class="w"> </span><span class="k">switch</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">PuyoY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">            </span><span class="mi">1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">PuyoX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">PuyoY</span><span class="p">),</span>
<span class="w">            </span><span class="mi">2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">PuyoY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">            </span><span class="mi">3</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">PuyoX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">PuyoY</span><span class="p">),</span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">PuyoX</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">PuyoY</span><span class="p">)</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">HandleKeyDown</span><span class="p">(</span><span class="n">KeyboardEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">game</span><span class="o">?.</span><span class="n">Mode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">GameMode</span><span class="p">.</span><span class="n">Playing</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">        </span><span class="n">game</span><span class="o">?.</span><span class="n">Player</span><span class="o">?.</span><span class="n">HandleKeyDown</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span><span class="p">);</span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;ArrowLeft&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="n">game</span><span class="o">?.</span><span class="n">Player</span><span class="o">?.</span><span class="n">MoveLeft</span><span class="p">();</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;ArrowRight&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="n">game</span><span class="o">?.</span><span class="n">Player</span><span class="o">?.</span><span class="n">MoveRight</span><span class="p">();</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;ArrowUp&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="n">game</span><span class="o">?.</span><span class="n">Player</span><span class="o">?.</span><span class="n">RotateRight</span><span class="p">();</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">HandleKeyUp</span><span class="p">(</span><span class="n">KeyboardEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">game</span><span class="o">?.</span><span class="n">Player</span><span class="o">?.</span><span class="n">HandleKeyUp</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Dispose</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">gameTimer</span><span class="o">?.</span><span class="n">Dispose</span><span class="p">();</span>
<span class="w">        </span><span class="n">canvasModule</span><span class="o">?.</span><span class="n">DisposeAsync</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>「ゲームオーバー時にオーバーレイが表示されるんですね！」そうです。半透明の黒いオーバーレイの上に、赤い「GAME OVER」テキストと最終スコア、リスタートボタンが表示されます。</p>
<h3 id="_62">画面の確認<a class="headerlink" href="#_62" title="Permanent link">&para;</a></h3>
<p>実装した機能を実際にブラウザで確認してみましょう！</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>PuyoPuyoTDD
dotnet<span class="w"> </span>run
</code></pre></div>
<p>ブラウザで <code>http://localhost:5000/game</code> にアクセスして、「ゲーム開始」ボタンをクリックしてください。</p>
<h4 id="_63">ゲームオーバーの確認<a class="headerlink" href="#_63" title="Permanent link">&para;</a></h4>
<p>ゲームオーバーになるまでプレイしてみましょう：</p>
<ol>
<li><strong>自然なゲームオーバー</strong>: ぷよを積み重ねて、上部まで到達させる</li>
<li>新しいぷよを配置できなくなる</li>
<li>画面が暗くなる</li>
<li>赤い「GAME OVER」テキストが表示される</li>
<li>
<p>最終スコアが表示される</p>
</li>
<li>
<p><strong>ゲームオーバー演出</strong>: </p>
</li>
<li>半透明の黒いオーバーレイ</li>
<li>「GAME OVER」テキストが脈動する</li>
<li>「もう一度プレイ」ボタンが表示される</li>
</ol>
<p>「ゲームオーバーの演出がかっこいいですね！」そうなんです。プレイヤーに明確にゲームが終了したことを伝えることが重要です。</p>
<h4 id="_64">リスタート機能の確認<a class="headerlink" href="#_64" title="Permanent link">&para;</a></h4>
<p>「もう一度プレイ」ボタンをクリックしてみましょう：</p>
<ol>
<li><strong>ゲームのリセット</strong>:</li>
<li>スコアが0に戻る</li>
<li>ステージがクリアされる</li>
<li>
<p>新しいぷよが登場する</p>
</li>
<li>
<p><strong>即座にプレイ開始</strong>:</p>
</li>
<li>すぐにキーボード操作ができる</li>
<li>ゲームループが継続している</li>
<li>スムーズに次のゲームが始まる</li>
</ol>
<p>「何度でもプレイできますね！」その通りです！リスタート機能により、プレイヤーは気軽に何度でも挑戦できます。</p>
<h4 id="_65">スコアアタック<a class="headerlink" href="#_65" title="Permanent link">&para;</a></h4>
<p>何度かプレイして、以下を試してみましょう：</p>
<ol>
<li><strong>連鎖を狙う</strong>: 高得点を目指して連鎖を組み立てる</li>
<li><strong>全消しを狙う</strong>: 全消しボーナス3600点を獲得する</li>
<li><strong>高得点を記録</strong>: 自分のベストスコアを更新する</li>
</ol>
<p>「ゲームとして完成していますね！」その通りです！基本的なゲーム機能がすべて揃いました。</p>
<p>確認が終わったら、Ctrl+Cでアプリケーションを停止しましょう。</p>
<h3 id="8_1">イテレーション8のまとめ<a class="headerlink" href="#8_1" title="Permanent link">&para;</a></h3>
<p>お疲れさまでした！イテレーション8が完了しました。ここまでで、以下のことができるようになりました：</p>
<ol>
<li><strong>ゲームオーバー判定</strong>: 新しいぷよを配置できない状態を検出</li>
<li><strong>ゲームモード遷移</strong>: NewPuyo → GameOver</li>
<li><strong>ゲームオーバー演出</strong>: 半透明オーバーレイと「GAME OVER」表示</li>
<li><strong>最終スコア表示</strong>: プレイ結果のフィードバック</li>
<li><strong>リスタート機能</strong>: ゲームを初期状態に戻す</li>
<li><strong>リスタートボタン</strong>: UIからの再プレイ開始</li>
</ol>
<p>「ぷよぷよゲームが完成しました！」その通りです！Red-Green-Refactorのサイクルを繰り返すことで、完全に動作するゲームが実装できましたね。</p>
<blockquote>
<p>完成への道</p>
<p>ソフトウェアは決して完成しない。ただ、リリースされるだけだ。しかし、テスト駆動開発により、常に動作するソフトウェアを維持できる。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<h2 id="_66">ふりかえり<a class="headerlink" href="#_66" title="Permanent link">&para;</a></h2>
<p>ぷよぷよゲームの実装を完了することができたので、これまでのふりかえりをしておきましょう。</p>
<h3 id="keep">Keep（続けること）<a class="headerlink" href="#keep" title="Permanent link">&para;</a></h3>
<p>まず <strong>TODOリスト</strong> を作成して <strong>テストファースト</strong> で１つずつ小さなステップで開発を進めていきました。テスト駆動開発の「Red-Green-Refactor」サイクルに従うことで、コードの品質を保ちながら、段階的に機能を追加していくことができました。</p>
<p>各イテレーションでは、ユーザーストーリーに基づいた機能を、テスト、実装、解説の順に進めていきました。この流れは非常に効果的で、実装の方針が明確になり、必要最小限のコードで機能を実現することができました。</p>
<p>特に以下の点は今後も続けていきたいプラクティスです：</p>
<ol>
<li><strong>ユーザーストーリーからTODOリストへの分解</strong>: 大きな機能を小さなタスクに分解することで、実装の見通しが立ちやすくなりました</li>
<li><strong>テストファーストの原則に従った実装</strong>: 先にテストを書くことで、インターフェースの設計が明確になり、実装がスムーズに進みました</li>
<li><strong>小さなステップでの開発</strong>: 一度に多くのことをしようとせず、小さく確実に進めることで、バグの混入を防げました</li>
<li><strong>リファクタリングによるコードの継続的な改善</strong>: 機能追加後にコードを整理することで、保守性の高いコードベースを維持できました</li>
<li><strong>C#の言語機能の活用</strong>: タプル、パターンマッチング、Null許容参照型などを適切に使用できました</li>
<li><strong>Blazorの特性を活かした実装</strong>: JSInterop、コンポーネントライフサイクル、CSSアニメーションを効果的に活用できました</li>
</ol>
<h3 id="problem">Problem（課題）<a class="headerlink" href="#problem" title="Permanent link">&para;</a></h3>
<p>開発を進める中で、いくつかの課題も見えてきました。</p>
<ol>
<li>
<p><strong>テストの粒度</strong>: テストをどの程度細かく書くべきか、判断が難しい場面がありました。細かすぎると冗長になり、粗すぎると問題の特定が難しくなります。</p>
</li>
<li>
<p><strong>非同期処理のテスト</strong>: BlazorのJSInteropや非同期処理のテストは、TypeScriptと異なるアプローチが必要でした。</p>
</li>
<li>
<p><strong>ゲームループの実装</strong>: JavaScriptのrequestAnimationFrameの代わりに、C#のTimerを使用する必要があり、違いを理解する必要がありました。</p>
</li>
<li>
<p><strong>状態管理の複雑さ</strong>: ゲームモードの遷移が複雑になるにつれて、状態管理の難しさを実感しました。</p>
</li>
<li>
<p><strong>パフォーマンスの考慮</strong>: 60FPSを維持するために、描画処理の最適化が必要でした。</p>
</li>
</ol>
<h3 id="try">Try（挑戦）<a class="headerlink" href="#try" title="Permanent link">&para;</a></h3>
<p>今後は以下のことに挑戦していきたいと思います：</p>
<ol>
<li><strong>より効率的なテスト戦略の模索</strong>: </li>
<li>ユニットテストとインテグレーションテストのバランス</li>
<li>
<p>E2Eテストの導入（Playwrightなど）</p>
</li>
<li>
<p><strong>自動化テストのカバレッジを高める工夫</strong>:</p>
</li>
<li>より多くのエッジケースをカバーする</li>
<li>
<p>Property-based testingの導入</p>
</li>
<li>
<p><strong>より複雑なゲーム機能への挑戦</strong>:</p>
</li>
<li>マルチプレイヤー対応</li>
<li>リプレイ機能</li>
<li>
<p>ランキングシステム</p>
</li>
<li>
<p><strong>パフォーマンス最適化とそのテスト手法の習得</strong>:</p>
</li>
<li>プロファイリングツールの活用</li>
<li>
<p>メモリ使用量の最適化</p>
</li>
<li>
<p><strong>アクセシビリティの向上</strong>:</p>
</li>
<li>キーボードナビゲーションの改善</li>
<li>
<p>スクリーンリーダー対応</p>
</li>
<li>
<p><strong>CI/CDパイプラインの構築</strong>:</p>
</li>
<li>GitHub Actionsでの自動テスト</li>
<li>自動デプロイの実現</li>
</ol>
<p>これらの知識と経験は、他のプロジェクトにも応用できるものです。テスト駆動開発は、コードの品質を高め、保守性を向上させるための強力な手法です。ぜひ、自分のプロジェクトにも取り入れてみてください。</p>
<h2 id="_67">おわりに<a class="headerlink" href="#_67" title="Permanent link">&para;</a></h2>
<p>お疲れさまでした！C# Blazorを使ったぷよぷよゲームの実装を、テスト駆動開発で完成させることができました。</p>
<p>このチュートリアルを通じて、以下のことを学びました：</p>
<ul>
<li><strong>テスト駆動開発の基本サイクル</strong>: Red-Green-Refactor</li>
<li><strong>C# 8.0の言語機能</strong>: Nullable参照型、タプル、パターンマッチング、インデックス演算子</li>
<li><strong>Blazor WebAssembly</strong>: コンポーネント、JSInterop、状態管理</li>
<li><strong>ゲームプログラミング</strong>: ゲームループ、状態遷移、衝突判定、アルゴリズム（DFS）</li>
<li><strong>品質管理</strong>: 静的解析、Linter、コードカバレッジ、自動化（Cake）</li>
</ul>
<blockquote>
<p>テスト駆動開発の真価</p>
<p>テスト駆動開発は、単にバグを減らすための技術ではありません。設計を改善し、自信を持ってコードを変更できるようにする、開発者の強力な味方なのです。</p>
<p>— Kent Beck 『テスト駆動開発』</p>
</blockquote>
<p>このチュートリアルで学んだテスト駆動開発の手法は、ゲーム開発だけでなく、あらゆるソフトウェア開発に応用できます。小さなステップで確実に進み、常に動作するコードを維持する——この原則を忘れずに、これからも素晴らしいソフトウェアを作り続けてください。</p>
<p>Happy Coding! 🎮✨</p>
<h2 id="_68">参考資料<a class="headerlink" href="#_68" title="Permanent link">&para;</a></h2>
<h3 id="_69">書籍<a class="headerlink" href="#_69" title="Permanent link">&para;</a></h3>
<ul>
<li>Kent Beck『テスト駆動開発』（オーム社）</li>
<li>Robert C. Martin『Clean Code アジャイルソフトウェア達人の技』（KADOKAWA）</li>
<li>Martin Fowler『リファクタリング 既存のコードを安全に改善する』（オーム社）</li>
<li>Andrew Hunt, David Thomas『達人プログラマー』（オーム社）</li>
</ul>
<h3 id="_70">オンラインリソース<a class="headerlink" href="#_70" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.microsoft.com/dotnet/">Microsoft .NET Documentation</a></li>
<li><a href="https://docs.microsoft.com/aspnet/core/blazor/">Blazor Documentation</a></li>
<li><a href="https://xunit.net/">xUnit Documentation</a></li>
<li><a href="https://bunit.dev/">bUnit Documentation</a></li>
<li><a href="https://cakebuild.net/">Cake Build Documentation</a></li>
</ul>
<h3 id="_71">ゲーム開発リソース<a class="headerlink" href="#_71" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://puyo.sega.jp/program/">ぷよぷよプログラミング</a></li>
<li><a href="https://gameprogrammingpatterns.com/">Game Programming Patterns</a></li>
</ul>
<h3 id="_72">コミュニティ<a class="headerlink" href="#_72" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://dotnet.microsoft.com/platform/community">.NET Community</a></li>
<li><a href="https://blazor.net/">Blazor Community</a></li>
</ul>
<p>ありがとうございました！</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works" target="_blank" rel="noopener" title="GitHub Repository/claude-code-booster" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>