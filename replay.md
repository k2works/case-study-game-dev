# 開発プロセス再現ガイド

## 概要

このドキュメントは、ぷよぷよゲーム開発プロジェクトの全開発プロセスを再現するためのガイドです。
8つのイテレーションを通じて段階的に機能を実装し、完全に動作するゲームを構築した過程を記録しています。

## 前提条件

### 必要なソフトウェア

- Node.js (最新LTS版)
- npm (Node.jsに同梱)
- Git
- モダンブラウザ (Chrome, Firefox, Safari等)

### プロジェクト構成

```
case-study-game-dev/
├── app/                    # ゲームアプリケーション
│   ├── src/               # ソースコード
│   ├── test/              # テストファイル  
│   ├── package.json       # 依存関係定義
│   └── vercel.json        # デプロイ設定
├── docs/                  # プロジェクトドキュメント
└── README.md              # プロジェクト概要
```

## 開発プロセス再現手順

### Phase 1: 要件定義

1. **プロジェクト要件の確認**
   ```bash
   # プロジェクトルートで要件定義を確認
   cat docs/requirements/要件定義.md
   ```

2. **ユーザーストーリーとイテレーション計画の理解**
   - 8つのイテレーションで構成
   - 各イテレーションは独立した機能単位
   - テスト駆動開発（TDD）で実装

### Phase 2: 環境構築・配置

1. **プロジェクトのクローン**
   ```bash
   git clone <repository-url>
   cd case-study-game-dev
   ```

2. **開発環境セットアップ**
   ```bash
   cd app
   npm install
   ```

3. **開発ツールの確認**
   ```bash
   # テスト実行
   npm run test
   
   # 開発サーバー起動
   npm run dev
   
   # 品質チェック
   npm run lint
   npm run format:check
   ```

### Phase 3: 開発 (8イテレーション)

#### イテレーション1: ゲーム開始の実装

**目標**: ゲームの基盤となるシステムを構築

**実装内容**:
- ゲーム初期化処理
- ゲーム画面表示
- ぷよ生成システム
- 60FPSゲームループ
- Canvas描画システム

**主要ファイル**:
- `src/domain/model/Game.ts`
- `src/domain/model/GameField.ts`
- `src/domain/model/Puyo.ts`
- `src/infrastructure/rendering/GameRenderer.ts`

**テスト手順**:
```bash
npm run test -- --testNamePattern="イテレーション1"
```

**確認項目**:
- ゲームが正常に起動する
- ぷよが画面に表示される
- ゲームループが60FPSで動作する

#### イテレーション2: ぷよの移動の実装

**目標**: ぷよの基本操作を実装

**実装内容**:
- 自由落下システム（30フレーム間隔）
- キーボード入力処理 (InputHandler)
- 左右移動・高速落下機能
- 当たり判定システム
- 着地検出と新ぷよ生成

**主要ファイル**:
- `src/infrastructure/input/InputHandler.ts`
- `src/application/GameController.ts`

**テスト手順**:
```bash
npm run test -- --testNamePattern="移動"
```

**確認項目**:
- 左右矢印キーでぷよが移動する
- 下矢印キーで高速落下する
- フィールド境界で移動が制限される
- ぷよが着地して新しいぷよが生成される

#### イテレーション3: ぷよの回転の実装

**目標**: ぷよペアの回転機能を実装

**実装内容**:
- 時計回り90度回転
- 回転時の衝突検出
- 壁キック処理（左右1マス）
- 上矢印キー入力処理

**テスト手順**:
```bash
npm run test -- --testNamePattern="回転"
```

**確認項目**:
- 上矢印キーでぷよが回転する
- 境界や他ぷよとの衝突時は回転不可
- 壁際での壁キックが動作する

#### イテレーション4: 高速落下の実装

**目標**: 下キーによる高速落下機能を完成

**実装内容**:
- 下キー継続押下検出
- 高速落下処理の統合
- 既存移動システムとの整合性

**テスト手順**:
```bash
npm run test -- --testNamePattern="高速落下"
```

**確認項目**:
- 下キーを押している間、ぷよが高速で落下
- 通常の自動落下と併存
- 着地判定が正常に動作

#### イテレーション5: ぷよの消去の実装

**目標**: 4つ以上連結したぷよの消去機能

**実装内容**:
- 隣接同色ぷよの検出アルゴリズム
- 4つ以上のグループ判定
- ぷよ消去処理
- 重力適用システム

**主要ファイル**:
- `src/domain/model/Game.ts` (processClearAndGravity)

**テスト手順**:
```bash
npm run test -- --testNamePattern="消去"
```

**確認項目**:
- 4つ以上の同色ぷよが消去される
- 消去後に重力が適用される
- 複数グループの同時消去

#### イテレーション6: 連鎖反応の実装

**目標**: 連続消去による連鎖システム

**実装内容**:
- 連鎖判定ロジック
- 連鎖カウント管理
- スコア計算システム
- 連鎖ボーナス（2^(連鎖数-1)倍）

**テスト手順**:
```bash
npm run test -- --testNamePattern="連鎖"
```

**確認項目**:
- 連続消去で連鎖が発生
- 連鎖数が正確にカウント
- ボーナススコアが正しく計算

#### イテレーション7: 全消しボーナスの実装

**目標**: フィールド全消去時の特別ボーナス

**実装内容**:
- 全消し判定（フィールドが空になる）
- 全消しボーナス（+2000点）
- 連鎖発生時のみボーナス適用

**テスト手順**:
```bash
npm run test -- --testNamePattern="全消し"
```

**確認項目**:
- フィールド全消去時にボーナス加算
- 連鎖なしでは全消しボーナス無し
- スコア表示の更新

#### イテレーション8: ゲームオーバーの実装

**目標**: ゲーム終了とリスタート機能

**実装内容**:
- ゲームオーバー判定（新ぷよ配置不可）
- ゲームオーバー演出表示
- Rキーによるリスタート機能
- リセットボタン機能

**主要ファイル**:
- `src/domain/model/GameState.ts`
- `src/infrastructure/rendering/GameRenderer.ts` (renderGameOver)

**テスト手順**:
```bash
npm run test -- --testNamePattern="ゲームオーバー"
```

**確認項目**:
- フィールド満杯時にゲームオーバー
- ゲームオーバー画面の表示
- Rキーでリスタート
- リセットボタンの動作

### Phase 4: 運用

1. **品質チェック**
   ```bash
   cd app
   npm run format:check
   npm run lint
   npm run build
   npm run test
   ```

2. **デプロイ準備**
   ```bash
   # vercel.jsonの確認
   cat vercel.json
   
   # 本番ビルド
   npm run build
   ```

3. **Vercelデプロイ**
   ```bash
   # 手動デプロイ（オプション）
   npx vercel --prod
   ```

## 完成した機能一覧

✅ **基本操作**: ぷよの移動・回転・高速落下  
✅ **ぷよ消去**: 4つ以上の同色ぷよ連結による消去  
✅ **連鎖システム**: 連続消去による連鎖反応とボーナス計算  
✅ **全消しボーナス**: フィールド全消去時の特別ボーナス  
✅ **スコアシステム**: リアルタイムスコア計算と表示  
✅ **ゲームオーバー**: 判定・演出・リスタート機能  
✅ **操作説明**: キーボード操作ガイド表示  
✅ **リセット機能**: ゲーム開始・リセットボタン  

## 品質指標

- **テスト**: 76テスト、100%通過率
- **コードカバレッジ**: 包括的なテストによる高い網羅率
- **アーキテクチャ**: ドメイン駆動設計（DDD）+ テスト駆動開発（TDD）
- **型安全性**: TypeScript厳密モード適用
- **自動化**: ESLint + Prettier + GitHub Actions + Vercel

## 操作方法

| キー | 動作 |
|------|------|
| ← → | ぷよの左右移動 |
| ↑ | ぷよの回転 |
| ↓ | 高速落下 |
| R | ゲームオーバー時のリスタート |

## トラブルシューティング

### 一般的な問題

1. **テスト失敗**
   ```bash
   # キャッシュクリア
   rm -rf node_modules
   npm install
   npm run test
   ```

2. **ビルドエラー**
   ```bash
   # 型チェック
   npx tsc --noEmit
   
   # フォーマット修正
   npm run format
   npm run lint:fix
   ```

3. **開発サーバー起動エラー**
   ```bash
   # ポート確認
   lsof -i :5173
   
   # 代替ポート使用
   npm run dev -- --port 3000
   ```

### デプロイ関連

1. **Vercelデプロイ失敗**
   - `vercel.json`設定の確認
   - 環境変数の設定確認
   - ビルドログの確認

## 参考リソース

- [プロジェクト要件定義](docs/requirements/要件定義.md)
- [アプリケーションREADME](app/README.md)
- [Vercel設定ガイド](docs/operation/Vercel設定.md)
- [開発ドキュメント](docs/development/)

## 学習のポイント

### テスト駆動開発（TDD）
- **Red-Green-Refactor**サイクルの実践
- 小さなステップでの確実な進歩
- テストファーストによる設計の改善

### ドメイン駆動設計（DDD）
- ビジネスロジックを中心とした設計
- 層の責務分離による保守性向上
- ドメインモデルの適切な抽象化

### 継続的改善
- コードレビューによる品質向上
- リファクタリングによる設計改善
- 自動化による効率化

## 次のステップ

このプロジェクトをベースに以下の拡張が可能：

1. **新機能の追加**
   - マルチプレイヤー対戦
   - AIプレイヤー
   - カスタムテーマ

2. **技術的改善**
   - パフォーマンス最適化
   - アニメーション効果
   - サウンド追加

3. **運用面の強化**
   - モニタリング
   - ログ分析
   - A/Bテスト

## まとめ

この再現ガイドに従うことで、ゲーム開発プロジェクトの全プロセスを体験し、テスト駆動開発とドメイン駆動設計を実践できます。各イテレーションは独立しているため、段階的に学習を進めることが可能です。

**よいソフトウェア**の原則に従い、**変更を楽に安全にできて役に立つソフトウェア**を実現したプロジェクトとして、今後の開発の参考にしてください。