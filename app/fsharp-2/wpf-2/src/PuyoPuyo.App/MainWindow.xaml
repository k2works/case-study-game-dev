<Window
    x:Class="PuyoPuyo.App.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="ぷよぷよゲーム" Height="690" Width="500"
    Focusable="True">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
  </Window.Resources>
  <Window.InputBindings>
    <KeyBinding Key="Left" Command="{Binding MoveLeft}" />
    <KeyBinding Key="Right" Command="{Binding MoveRight}" />
    <KeyBinding Key="Down" Command="{Binding MoveDown}" />
    <KeyBinding Key="Up" Command="{Binding Rotate}" />
  </Window.InputBindings>
  <StackPanel Orientation="Vertical">
    <!-- タイトル -->
    <TextBlock Text="ぷよぷよゲーム" FontSize="24" HorizontalAlignment="Center" Margin="10"/>

    <!-- ゲームエリア（ボードと情報パネルを横に並べる） -->
    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
      <!-- ゲームボード -->
      <Border BorderBrush="Black" BorderThickness="2" Margin="10">
        <Grid Width="240" Height="520">
          <Canvas Background="WhiteSmoke">
            <ItemsControl ItemsSource="{Binding Puyos}">
              <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                  <Canvas/>
                </ItemsPanelTemplate>
              </ItemsControl.ItemsPanel>
              <ItemsControl.ItemContainerStyle>
                <Style>
                  <Setter Property="Canvas.Left" Value="{Binding X}"/>
                  <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                </Style>
              </ItemsControl.ItemContainerStyle>
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Ellipse Width="36" Height="36" Fill="{Binding Color}" Stroke="Black" StrokeThickness="1"/>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </Canvas>

          <!-- ゲームオーバー表示 -->
          <Border Background="#CC000000" Visibility="{Binding IsGameOver, Converter={StaticResource BoolToVisibility}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
              <TextBlock Text="GAME OVER" FontSize="32" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,20"/>
              <TextBlock Text="{Binding Score, StringFormat='Score: {0}'}" FontSize="20" Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,10"/>
              <TextBlock Text="{Binding Chain, StringFormat='Chain: {0}'}" FontSize="20" Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,20"/>
              <Button Command="{Binding RestartGame}" Content="もう一度プレイ" Width="150" Height="40" FontSize="16"/>
            </StackPanel>
          </Border>
        </Grid>
      </Border>

      <!-- 情報パネル -->
      <StackPanel Orientation="Vertical" Margin="10" VerticalAlignment="Top">
        <!-- スコア表示 -->
        <TextBlock Text="Score" FontSize="14" FontWeight="Bold" Margin="0,5,0,5"/>
        <TextBlock Text="{Binding Score}" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>

        <!-- 連鎖数表示 -->
        <TextBlock Text="Chain" FontSize="14" FontWeight="Bold" Margin="0,5,0,5"/>
        <TextBlock Text="{Binding Chain}" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>

        <!-- 次のぷよ表示 -->
        <TextBlock Text="Next" FontSize="14" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,5,0,5"/>
        <Border Width="50" Height="50" BorderBrush="LightGray" BorderThickness="1" Margin="0,0,0,10">
          <Canvas Background="Transparent" Width="50" Height="50">
            <!-- 次のぷよはここに表示される（将来実装） -->
          </Canvas>
        </Border>
      </StackPanel>
    </StackPanel>

    <!-- コントロールボタン -->
    <Button Command="{Binding StartGame}" Content="ゲーム開始" Width="120" Height="40" Margin="10" IsEnabled="{Binding CanStartGame}"/>
  </StackPanel>
</Window>
