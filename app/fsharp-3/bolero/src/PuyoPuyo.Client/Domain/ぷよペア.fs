namespace PuyoPuyo.Domain

open PuyoPuyo.Domain

/// ぷよペア
type ぷよペア =
    { X座標: int<列>
      Y座標: int<行>
      ぷよ1の色: ぷよの色 // 軸ぷよ
      ぷよ2の色: ぷよの色 // 2つ目のぷよ
      回転状態: int<回転> } // 0: 上, 1: 右, 2: 下, 3: 左

module ぷよペア =
    /// ぷよペアを作成
    let 作成 (列: int<列>) (行: int<行>) (色1: ぷよの色) (色2: ぷよの色) (回転: int<回転>) : ぷよペア =
        { X座標 = 列
          Y座標 = 行
          ぷよ1の色 = 色1
          ぷよ2の色 = 色2
          回転状態 = 回転 }

    /// ぷよペアの各ぷよの位置を取得
    let 位置取得 (ぷよペア: ぷよペア) : (int<列> * int<行>) * (int<列> * int<行>) =
        let 位置1 = (ぷよペア.X座標, ぷよペア.Y座標)

        let 位置2 =
            match ぷよペア.回転状態 with
            | 0<回転> -> (ぷよペア.X座標, ぷよペア.Y座標 - 1<行>) // 上
            | 1<回転> -> (ぷよペア.X座標 + 1<列>, ぷよペア.Y座標) // 右
            | 2<回転> -> (ぷよペア.X座標, ぷよペア.Y座標 + 1<行>) // 下
            | 3<回転> -> (ぷよペア.X座標 - 1<列>, ぷよペア.Y座標) // 左
            | _ -> (ぷよペア.X座標, ぷよペア.Y座標 - 1<行>) // デフォルトは上

        (位置1, 位置2)

    /// ランダムなぷよペアを生成
    let ランダム作成 (列: int<列>) (行: int<行>) (回転: int<回転>) : ぷよペア =
        let 乱数 = System.Random()
        let 色リスト = [| 赤; 緑; 青; 黄 |]
        let 色1 = 色リスト.[乱数.Next(色リスト.Length)]
        let 色2 = 色リスト.[乱数.Next(色リスト.Length)]
        作成 列 行 色1 色2 回転

    /// 時計回りに回転
    let 時計回り回転 (ぷよペア: ぷよペア) : ぷよペア =
        { ぷよペア with 回転状態 = (int ぷよペア.回転状態 + 1) % 4 |> (*) 1<回転> }

    /// 反時計回りに回転
    let 反時計回り回転 (ぷよペア: ぷよペア) : ぷよペア =
        { ぷよペア with 回転状態 = (int ぷよペア.回転状態 + 3) % 4 |> (*) 1<回転> }

module 盤面操作 =
    /// ぷよペアをボードに固定
    let ぷよペア固定 (盤面: 盤面) (ペア: ぷよペア) : 盤面 =
        let (位置1, 位置2) = ぷよペア.位置取得 ペア
        PuyoPuyo.Domain.盤面.ぷよ2つ固定 盤面 位置1 ペア.ぷよ1の色 位置2 ペア.ぷよ2の色
