(ns puyo.score-test
  (:require [cljs.test :refer-macros [deftest is testing]]
            [puyo.score :as score]))

(deftest スコア計算テスト
  (testing "基本的なスコア計算"
    (is (= 40 (score/スコア計算 4 0)) "連鎖なし: 4個×10×1")
    (is (= 360 (score/スコア計算 4 1)) "1連鎖: 4個×10×(1+8)")
    (is (= 680 (score/スコア計算 4 2)) "2連鎖: 4個×10×(1+16)"))

  (testing "連鎖数が増えるとスコアが指数的に増加する"
    (let [基本スコア (score/スコア計算 4 1)
          連鎖2スコア (score/スコア計算 4 2)
          連鎖3スコア (score/スコア計算 4 3)]
      (is (> 連鎖2スコア (* 基本スコア 1.5))
          "2連鎖は1連鎖の1.5倍以上")
      (is (> 連鎖3スコア (* 連鎖2スコア 1.5))
          "3連鎖は2連鎖の1.5倍以上"))))

(deftest 全消し判定テスト
  (testing "空のフィールドは全消し"
    (let [空盤面 [[0 0 0 0 0 0]
                 [0 0 0 0 0 0]
                 [0 0 0 0 0 0]
                 [0 0 0 0 0 0]]]
      (is (score/全消し判定? 空盤面))))

  (testing "ぷよがあるフィールドは全消しでない"
    (let [盤面 [[1 0 0 0 0 0]
               [0 0 0 0 0 0]
               [0 0 0 0 0 0]
               [0 0 0 0 0 0]]]
      (is (not (score/全消し判定? 盤面))))))
