# ぷよぷよゲーム

TypeScriptとテスト駆動開発で実装したフル機能のぷよぷよゲーム

## 概要

このプロジェクトは、よいソフトウェア開発の原則に従って、8つのイテレーションで段階的にぷよぷよゲームを実装しました。
テスト駆動開発（TDD）とドメイン駆動設計（DDD）を採用し、高品質で保守性の高いコードベースを実現しています。

## 🎮 ゲーム機能

### 実装済み機能（全8イテレーション完了）

- ✅ **基本操作**: ぷよの移動・回転・高速落下
- ✅ **ぷよ消去**: 4つ以上の同色ぷよ連結による消去
- ✅ **連鎖システム**: 連続消去による連鎖反応とボーナス計算
- ✅ **全消しボーナス**: フィールド全消去時の特別ボーナス
- ✅ **スコアシステム**: リアルタイムスコア計算と表示
- ✅ **ゲームオーバー**: 判定・演出・リスタート機能
- ✅ **操作説明**: キーボード操作ガイド表示
- ✅ **リセット機能**: ゲーム開始・リセットボタン

### 操作方法

| キー | 動作                         |
| ---- | ---------------------------- |
| ← →  | ぷよの左右移動               |
| ↑    | ぷよの回転                   |
| ↓    | 高速落下                     |
| R    | ゲームオーバー時のリスタート |

### スコアシステム

- **基本スコア**: 消去ぷよ数 × 10点
- **連鎖ボーナス**: 2^(連鎖数-1) 倍
- **全消しボーナス**: +2000点（連鎖発生時のみ）

## 🛠️ 技術スタック

- **言語**: TypeScript 5.8
- **テストフレームワーク**: Vitest（76テスト、100%成功率）
- **ビルドツール**: Vite 7.0
- **静的解析**: ESLint + Prettier
- **アーキテクチャ**: ドメイン駆動設計（DDD）
- **開発手法**: テスト駆動開発（TDD）
- **デプロイ**: Vercel

## 構成

- [セットアップ](#セットアップ)
- [開発コマンド](#開発コマンド)
- [デプロイ](#デプロイ)
- [開発プロセス](#開発プロセス)

## 詳細

### セットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# テストの実行
npm run test

# ビルド
npm run build
```

**[⬆ back to top](#構成)**

### 開発コマンド

| コマンド                | 説明                           |
| ----------------------- | ------------------------------ |
| `npm run dev`           | 開発サーバーを起動             |
| `npm run build`         | プロダクションビルド           |
| `npm run test`          | テストを実行                   |
| `npm run test:watch`    | テストを監視モードで実行       |
| `npm run test:coverage` | カバレッジ付きでテスト実行     |
| `npm run lint`          | ESLintによる静的解析           |
| `npm run lint:fix`      | ESLintによる自動修正           |
| `npm run format`        | Prettierによるフォーマット     |
| `npm run format:check`  | フォーマットチェック           |
| `npm run guard`         | ファイル変更を監視して自動実行 |

**[⬆ back to top](#構成)**

### プロジェクト構造

```
src/
├── domain/              # ドメイン層
│   ├── model/          # ドメインモデル
│   │   ├── Game.ts           # ゲームエンティティ
│   │   ├── GameField.ts      # ゲームフィールド
│   │   ├── Puyo.ts           # ぷよ値オブジェクト
│   │   └── GameState.ts      # ゲーム状態
│   └── type/           # タイプ・戦略
├── application/         # アプリケーション層
│   └── GameController.ts     # ゲーム制御
├── infrastructure/      # インフラ層
│   ├── input/          # 入力処理
│   │   └── InputHandler.ts  # キーボード入力
│   └── rendering/      # 描画処理
│       └── GameRenderer.ts  # Canvas描画
├── test/               # テストファイル
└── main.ts             # エントリポイント
```

### アーキテクチャ設計

本プロジェクトは**ドメイン駆動設計（DDD）**を採用し、以下の層で構成されています：

- **ドメイン層**: ビジネスロジックとルールを含む
- **アプリケーション層**: ユースケースと外部との調整
- **インフラストラクチャ層**: 技術的な実装詳細

この設計により、ビジネスロジックが技術的な詳細から分離され、テストしやすく保守性の高いコードを実現しています。

**[⬆ back to top](#構成)**

### デプロイ

このアプリケーションはVercelにデプロイされます。
case-1ブランチへのプッシュで自動デプロイが実行されます。

### Vercel設定

Vercelの詳細な設定手順は [Vercel設定ガイド](../docs/operation/Vercel設定.md) を参照してください。

以下の環境変数をGitHubリポジトリのSecretsに設定してください：

- `VERCEL_TOKEN`: Vercelアクセストークン
- `ORG_ID`: Vercel組織ID
- `PROJECT_ID`: VercelプロジェクトID

### 手動デプロイ

```bash
# Vercel CLIのインストール
npm i -g vercel

# デプロイ
vercel --prod
```

**[⬆ back to top](#構成)**

### 開発プロセス

1. **テスト駆動開発**: Red-Green-Refactorサイクル
2. **イテレーション開発**: 機能を段階的に実装
3. **継続的インテグレーション**: GitHubActionsによる自動化
4. **継続的デプロイ**: Vercelへの自動デプロイ

## 🎯 開発プロセス

### テスト駆動開発（TDD）

本プロジェクトは**テスト駆動開発**を実践し、以下のサイクルで開発しました：

1. **Red**: 失敗するテストを書く
2. **Green**: テストを通す最小限の実装
3. **Refactor**: コードを改善・整理

### イテレーション開発

**8つのイテレーション**で段階的に機能を実装：

| イテレーション | 機能                               | 状態    |
| -------------- | ---------------------------------- | ------- |
| 1              | ゲーム開始・ぷよ生成・ゲームループ | ✅ 完了 |
| 2              | ぷよの移動・自由落下・着地判定     | ✅ 完了 |
| 3              | ぷよの回転・壁キック処理           | ✅ 完了 |
| 4              | 高速落下処理                       | ✅ 完了 |
| 5              | ぷよ消去・4つ以上連結判定          | ✅ 完了 |
| 6              | 連鎖反応・スコア計算システム       | ✅ 完了 |
| 7              | 全消しボーナス・特別演出           | ✅ 完了 |
| 8              | ゲームオーバー・リスタート機能     | ✅ 完了 |

### 品質指標

- **テスト**: 76テスト、100%通過
- **コードカバレッジ**: 高い網羅率
- **コード品質**: ESLint + Prettier適用
- **型安全性**: TypeScript厳密モード

**[⬆ back to top](#構成)**

## 参照

- [プロジェクトドキュメント](../docs/)
- [アーキテクチャドキュメント](../docs/development/アーキテクチャ.md)
- [設計ドキュメント](../docs/development/設計.md)
- [実装ドキュメント](../docs/development/実装.md)
- [要件定義](../docs/requirements/要件定義.md)
- [開発プロセス再現ガイド](../replay.md)

## ライセンス

ISC
