# ユーザーインターフェース設計

## 概要

ぷよぷよゲームのユーザーインターフェース設計について説明します。レスポンシブデザイン、アクセシビリティ、ユーザビリティを考慮した設計を行います。

## 全体レイアウト設計

### デスクトップ版レイアウト

```plantuml
@startsalt "デスクトップレイアウト"
{
  {T
    + ぷよぷよゲーム | ハイスコア: 12,500 | 設定
  }
  {+
    {
      スコア: 1,250
      ---
      連鎖: 3
      ---
      レベル: 2
      ---
      NEXT
      [RG]
      [GB]
      ---
      操作方法:
      ← → : 移動
      ↑ : 回転
      ↓ : 落下
    }
    |
    {
      {^"ゲームフィールド"
        [R][G][.][.][.][.]
        [.][B][R][.][.][.]
        [G][B][R][G][.][.]
        [R][G][B][B][.][.]
        [.][.][.][.][.][.]
        [.][.][.][.][.][.]
        [.][.][.][.][.][.]
        [.][.][.][.][.][.]
        [.][.][.][.][.][.]
        [.][.][.][.][.][.]
        [.][.][.][.][.][.]
        [.][.][.][.][.][.]
      }
    }
    |
    {
      {^"ゲーム情報"
        時間: 02:15
        ---
        最高連鎖: 5
        ---
        状態: プレイ中
      }
      ---
      [新しいゲーム]
      [ポーズ]
      [リスタート]
      ---
      音量: [====    ]
    }
  }
  {T
    ^ ©2025 ぷよぷよゲーム v1.0
  }
}
@endsalt
```

### モバイル版レイアウト（縦持ち）

```plantuml
@startsalt "モバイル縦レイアウト"
{
  {T
    + ぷよぷよ | スコア: 1,250 | [≡]
  }
  {+
    {^
      連鎖: 3 | レベル: 2 | NEXT: [RG]
    }
    ---
    {^"ゲームフィールド"
      [R][G][.][.][.][.]
      [.][B][R][.][.][.]
      [G][B][R][G][.][.]
      [R][G][B][B][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
    }
    ---
    {+
      [ ← ] | [ ↻ ] | [ → ]
      ---
      [    ↓ 高速落下    ]
      ---
      [ポーズ] | [リスタート]
    }
  }
  {T
    ^ 時間: 02:15 | 最高連鎖: 5
  }
}
@endsalt
```

### モバイル版レイアウト（横持ち）

```plantuml
@startsalt "モバイル横レイアウト"
{
  {+
    {
      スコア: 1,250
      連鎖: 3
      レベル: 2
      ---
      NEXT:
      [RG]
      [GB]
      ---
      [ポーズ]
      [リスタート]
    }
    |
    {^"ゲームフィールド"
      [R][G][.][.][.][.]
      [.][B][R][.][.][.]
      [G][B][R][G][.][.]
      [R][G][B][B][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
      [.][.][.][.][.][.]
    }
    |
    {+
      [ ← ]
      [ ↻ ]  
      [ → ]
      ---
      [↓]
      高速
      落下
    }
  }
}
@endsalt
```

## 画面状態別UI設計

### ゲーム開始画面

```plantuml
@startsalt "ゲーム開始画面"
{
  {^
    **ぷよぷよゲーム**
    ===
    {^
      [          新しいゲーム          ]
      ---
      [          続きから          ]
      ---
      [          設定          ]
      ---
      [          ハイスコア          ]
    }
    ===
    最高スコア: 15,750
    最高連鎖: 7連鎖
  }
}
@endsalt
```

### ゲームプレイ画面（詳細）

```plantuml
@startsalt "ゲームプレイ画面"
{+
  {T
    ぷよぷよゲーム | [?] ヘルプ | [⚙] 設定 | [🔊] 音
  }
  {+
    {
      **ゲーム情報**
      ===
      スコア
      **1,250**
      ---
      連鎖数
      **3連鎖**
      ---
      レベル
      **2**
      ---
      **NEXT**
      {^
        [R][G]
        [G][B]
      }
      ---
      経過時間
      **02:15**
      ===
      **操作方法**
      ← → : 移動
      ↑ : 回転  
      ↓ : 落下
      Space: ポーズ
    }
    |
    {^
      **ゲームフィールド**
      .________________.
      |[R][G][.][.][.][.]|
      |[.][B][R][.][.][.]|
      |[G][B][R][G][.][.]|
      |[R][G][B][B][.][.]|
      |[.][.][.][.][.][.]|
      |[.][.][.][.][.][.]|
      |[.][.][.][.][.][.]|
      |[.][.][.][.][.][.]|
      |[.][.][.][.][.][.]|
      |[.][.][.][.][.][.]|
      |[.][.][.][.][.][.]|
      |[.][.][.][.][.][.]|
      '________________'
      
      落下中: [R][G] ← 操作対象
    }
    |
    {
      **ゲーム制御**
      ===
      [  新しいゲーム  ]
      ---
      [    ポーズ    ]
      ---  
      [  リスタート  ]
      ---
      [    終了    ]
      ===
      **音量設定**
      BGM: [====    ]
      効果音: [======  ]
      ===
      **デバッグ情報**
      (開発時のみ)
      FPS: 60
      メモリ: 45MB
    }
  }
}
@endsalt
```

### ポーズ画面

```plantuml
@startsalt "ポーズ画面"
{
  {^
    **ポーズ中**
    ===
    現在のスコア: 1,250
    経過時間: 02:15
    ===
    [        再開        ]
    ---
    [      リスタート      ]
    ---
    [        設定        ]
    ---
    [      メニューに戻る      ]
  }
}
@endsalt
```

### ゲームオーバー画面

```plantuml
@startsalt "ゲームオーバー画面"
{
  {^
    **ゲームオーバー**
    ===
    **最終結果**
    
    スコア: **1,250**
    最高連鎖: **3連鎖**
    プレイ時間: **02:15**
    
    {* ハイスコア更新! *}
    ===
    [      もう一度      ]
    ---
    [     ハイスコア     ]
    ---
    [    メニューに戻る    ]
  }
}
@endsalt
```

### 設定画面

```plantuml
@startsalt "設定画面"
{+
  {T
    設定 | [×] 閉じる
  }
  {+
    {
      **音響設定**
      ===
      BGM音量
      [========  ]
      ---
      効果音音量  
      [======    ]
      ---
      [ ] BGMを無効化
      [ ] 効果音を無効化
    }
    ---
    {
      **操作設定**
      ===
      左移動: [←]
      右移動: [→]  
      回転: [↑]
      高速落下: [↓]
      ポーズ: [Space]
      ---
      [  キー設定をリセット  ]
    }
    ---
    {
      **ゲーム設定**
      ===
      難易度: (o) 初級 ( ) 中級 ( ) 上級
      ---
      落下速度: [=====     ]
      ---
      [ ] 次のぷよを表示
      [ ] ゴーストぷよを表示
    }
    ---
    {
      **表示設定**
      ===
      テーマ: (o) ライト ( ) ダーク
      ---
      言語: [日本語 ^]
      ---
      [ ] フルスクリーン
      [ ] デバッグ情報を表示
    }
  }
  ---
  {+
    [  設定をリセット  ] | [    適用    ] | [    OK    ]
  }
}
@endsalt
```

## レスポンシブデザイン仕様

### ブレークポイント設計

```plantuml
@startuml "レスポンシブブレークポイント"
!define MOBILE_COLOR #FFE6E6
!define TABLET_COLOR #E6F3FF  
!define DESKTOP_COLOR #F0FFF0

rectangle "モバイル (320px - 767px)" MOBILE_COLOR {
  note as n1
    - シングルカラム
    - タッチ操作優先
    - コンパクトな情報表示
    - 大きなタップターゲット
  end note
}

rectangle "タブレット (768px - 1023px)" TABLET_COLOR {
  note as n2  
    - 2カラムレイアウト
    - ハイブリッド操作
    - 中程度の情報密度
    - 両持ち対応
  end note
}

rectangle "デスクトップ (1024px+)" DESKTOP_COLOR {
  note as n3
    - 3カラムレイアウト
    - キーボード操作
    - 高密度情報表示
    - マウスホバー効果
  end note
}

n1 --> n2 : 画面拡大
n2 --> n3 : 画面拡大
@enduml
```

### レスポンシブ変更点

| 要素 | モバイル | タブレット | デスクトップ |
|------|----------|------------|--------------|
| フィールドサイズ | 280×560px | 320×640px | 360×720px |
| ぷよサイズ | 40×40px | 45×45px | 50×50px |
| サイドパネル | 下部配置 | 右側配置 | 右側配置 |
| タッチボタン | 大きめ(60px) | 中程度(50px) | 非表示 |
| フォントサイズ | 14px | 16px | 18px |

## アクセシビリティ設計

### WCAG 2.1 対応

```plantuml
@startuml "アクセシビリティ要件"
package "知覚可能" {
  [色以外の情報提供]
  [十分なコントラスト比]
  [拡大可能なテキスト]
  [代替テキスト]
}

package "操作可能" {
  [キーボード操作]
  [フォーカス管理]  
  [十分なクリック領域]
  [操作時間の調整]
}

package "理解可能" {
  [明確なラベル]
  [一貫したナビゲーション]
  [エラーメッセージ]
  [操作説明]
}

package "堅牢性" {
  [セマンティックHTML]
  [ARIA属性]
  [スクリーンリーダー対応]
  [ブラウザ互換性]
}

[色以外の情報提供] --> [十分なコントラスト比]
[キーボード操作] --> [フォーカス管理]
[明確なラベル] --> [エラーメッセージ]
[セマンティックHTML] --> [ARIA属性]
@enduml
```

### カラーユニバーサルデザイン

```plantuml
@startuml "色彩設計"
!define RED_COLOR #FF4444
!define GREEN_COLOR #44FF44  
!define BLUE_COLOR #4444FF
!define YELLOW_COLOR #FFFF44
!define PURPLE_COLOR #FF44FF

rectangle "標準色セット" {
  rectangle "赤ぷよ" RED_COLOR
  rectangle "緑ぷよ" GREEN_COLOR
  rectangle "青ぷよ" BLUE_COLOR  
  rectangle "黄ぷよ" YELLOW_COLOR
  rectangle "紫ぷよ" PURPLE_COLOR
}

rectangle "色覚多様性対応" {
  rectangle "赤ぷよ(●)" #CC3333
  rectangle "緑ぷよ(▲)" #33CC33
  rectangle "青ぷよ(■)" #3333CC
  rectangle "黄ぷよ(◆)" #CCCC33  
  rectangle "紫ぷよ(★)" #CC33CC
}

note right : シンボル併用で\n色の区別を補助
@enduml
```

### キーボードナビゲーション

```plantuml
@startuml "キーボードナビゲーション"
state "メニュー画面" as Menu {
  state "新しいゲーム" as NewGame
  state "続きから" as Continue
  state "設定" as Settings
  state "終了" as Exit
}

state "ゲームプレイ" as Game {
  state "フィールド操作" as Field
  state "ポーズボタン" as Pause
  state "設定ボタン" as GameSettings
}

state "設定画面" as SettingsScreen {
  state "音量設定" as Volume
  state "キー設定" as KeyConfig
  state "適用ボタン" as Apply
}

Menu --> Game : Enter/Space
Game --> SettingsScreen : Esc
SettingsScreen --> Game : Esc/Apply

NewGame --> Continue : Tab/↓
Continue --> Settings : Tab/↓
Settings --> Exit : Tab/↓
Exit --> NewGame : Tab/↓

Field --> Pause : Tab
Pause --> GameSettings : Tab
GameSettings --> Field : Tab

note as N1
  Tab: 次の要素
  Shift+Tab: 前の要素
  Enter/Space: 決定
  Esc: キャンセル/戻る
  ↑↓←→: 方向移動
end note
@enduml
```

## ユーザーエクスペリエンス設計

### ゲームフロー

```plantuml
@startuml "ユーザーフロー"
start

:アプリケーション起動;
:タイトル画面表示;

if (初回起動?) then (yes)
  :チュートリアル画面;
  :基本操作説明;
else (no)
endif

:メニュー選択;

switch (選択項目)
case ( 新しいゲーム )
  :ゲーム初期化;
  :ゲームプレイ開始;
  
  repeat
    :ぷよ操作;
    :連鎖判定;
    :スコア更新;
  repeat while (ゲーム継続?)
  
  :ゲームオーバー;
  :結果表示;
  
case ( 続きから )
  :セーブデータ読み込み;
  :ゲームプレイ再開;
  
case ( 設定 )
  :設定画面表示;
  :設定変更;
  :設定保存;
  
case ( 終了 )
  :アプリケーション終了;
  stop
endswitch

:メニューに戻る;
stop
@enduml
```

### フィードバック設計

```plantuml
@startuml "フィードバック設計"
package "視覚フィードバック" {
  [ぷよ落下アニメーション]
  [消去エフェクト]
  [連鎖演出]
  [スコアポップアップ]
  [ボタンホバー効果]
}

package "聴覚フィードバック" {
  [ぷよ落下音]
  [消去音]
  [連鎖音]
  [ボタンクリック音]
  [BGM]
}

package "触覚フィードバック" {
  [バイブレーション]
  [長押し反応]
}

package "情報フィードバック" {
  [スコア更新]
  [連鎖数表示]
  [操作ガイド]
  [エラーメッセージ]
}

[ぷよ落下アニメーション] --> [ぷよ落下音]
[消去エフェクト] --> [消去音]
[連鎖演出] --> [連鎖音]
[スコアポップアップ] --> [バイブレーション]
@enduml
```

## アニメーション設計

### 基本アニメーション

```plantuml
@startuml "アニメーションタイムライン"
concurrency
  (start) --> [ぷよ生成] (generate)
  (generate) --> [落下開始] (fall_start)
  (fall_start) --> [落下中] (falling)
  (falling) --> [着地] (land)
  (land) --> [固定] (fixed)
and
  (fixed) --> [消去判定] (check_erase)
  (check_erase) --> [消去アニメーション] (erase_anim)
  (erase_anim) --> [重力適用] (gravity)
  (gravity) --> [連鎖チェック] (chain_check)
end
@enduml
```

### パフォーマンス考慮

| アニメーション | 継続時間 | FPS目標 | 最適化手法 |
|---------------|----------|---------|------------|
| ぷよ落下 | 500ms | 60fps | RequestAnimationFrame |
| 消去エフェクト | 300ms | 30fps | CSS Transform |
| 連鎖演出 | 800ms | 60fps | Canvas最適化 |
| UI遷移 | 200ms | 60fps | GPU加速 |

## エラー状態とメッセージ

### エラーハンドリング画面

```plantuml
@startsalt "エラー画面"
{
  {^
    **エラーが発生しました**
    ===
    申し訳ございませんが、
    予期しないエラーが発生しました。
    
    エラーコード: ERR_001
    エラー内容: ゲームデータの読み込みに失敗
    
    ===
    [      再試行      ]
    ---
    [    初期化して続行    ]
    ---
    [     問題を報告     ]
    ---
    [   メニューに戻る   ]
  }
}
@endsalt
```

### 接続エラー画面

```plantuml
@startsalt "接続エラー画面"
{
  {^
    **ネットワークエラー**
    ===
    インターネット接続を
    確認してください。
    
    オフラインでも基本的な
    ゲームプレイは可能です。
    
    ===
    [    再接続を試す    ]
    ---
    [  オフラインで続行  ]
    ---
    [   メニューに戻る   ]
  }
}
@endsalt
```

## 国際化対応

### 多言語対応設計

```plantuml
@startuml "国際化設計"
package "言語リソース" {
  [日本語 (ja)]
  [英語 (en)]
  [中国語 (zh)]
  [韓国語 (ko)]
}

package "地域化対応" {
  [数値フォーマット]
  [日付時刻形式]  
  [通貨表示]
  [文字方向]
}

package "フォント対応" {
  [日本語フォント]
  [英数字フォント]
  [CJKフォント]
  [アイコンフォント]
}

[日本語 (ja)] --> [日本語フォント]
[英語 (en)] --> [英数字フォント]
[中国語 (zh)] --> [CJKフォント]
[韓国語 (ko)] --> [CJKフォント]

[数値フォーマット] --> [日付時刻形式]
@enduml
```

## まとめ

このユーザーインターフェース設計により以下を実現：

1. **使いやすさ:** 直感的で一貫性のあるUI
2. **アクセシビリティ:** WCAG 2.1準拠のバリアフリー対応
3. **レスポンシブ:** すべてのデバイスサイズに対応
4. **パフォーマンス:** 60FPS以上のスムーズな体験
5. **国際化:** 多言語・多地域対応
6. **拡張性:** 新機能追加時のUI拡張が容易