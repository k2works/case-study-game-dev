# 設計

ぷよぷよゲームの機能設計関連のドキュメントです。

## ドキュメント一覧

### [アーキテクチャ.md](アーキテクチャ.md)
レイヤードアーキテクチャの設計
- 4層構造（Presentation/Application/Domain/Infrastructure）
- 依存関係の明確化
- 設計原則の適用
- データフローとコンポーネント構成

### [データモデル.md](データモデル.md)
データ構造の設計
- エンティティ関係図
- 主要エンティティ（Game, Field, Puyo, Chain, Score）
- 制約と規則の定義
- パフォーマンス考慮事項

### [ドメインモデル.md](ドメインモデル.md)
DDD（ドメイン駆動設計）に基づく設計
- 3つの集約（Game/Puyo/Chain）
- ドメインサービスの定義
- ドメインイベントの設計
- ユビキタス言語の確立

### [ユーザーインターフェース設計.md](ユーザーインターフェース設計.md)
UI/UXの設計
- 全体レイアウトとワイヤーフレーム
- レスポンシブデザイン対応
- アクセシビリティ対応
- タッチ操作UI

### [依存性注入設計.md](依存性注入設計.md)
DIシステムの設計
- Clean Architecture準拠のDIコンテナ実装
- 型安全なサービス解決システム
- シングルトン・ファクトリパターンの活用
- テスタビリティ向上のための依存関係管理

## 設計の特徴

### アーキテクチャの特徴
- **関心事の分離**: 5層構造による明確な責任分離（Presentation/Application/Domain/Service/Infrastructure）
- **依存関係逆転**: ドメイン層が他層に依存しない、内向きの依存関係
- **依存性注入**: 型安全なDIコンテナによる疎結合実現
- **テスタビリティ**: DIによるモック注入、各層を独立してテスト可能
- **拡張性**: サービス追加・変更が既存コードに影響しない設計

### ドメインモデルの特徴
- **集約の活用**: ビジネスルールを集約内に凝集
- **不変条件**: ドメイン知識をコードで表現
- **イベント駆動**: ドメインイベントによる疎結合
- **ユビキタス言語**: ドメインエキスパートと共通言語

### UIデザインの特徴
- **アクセシビリティファースト**: WCAG 2.1 AA準拠
- **レスポンシブ**: デスクトップ・タブレット・モバイル対応
- **直感的操作**: キーボード・タッチ両対応
- **視覚的フィードバック**: アニメーションとエフェクト

## Phase 1での成果

機能設計において以下を完了：

1. **アーキテクチャ設計**
   - レイヤードアーキテクチャの採用決定
   - 各層の責任と依存関係の明確化
   - コンポーネント構成図の作成

2. **データ・ドメイン設計**
   - エンティティ関係図の作成
   - DDD集約の設計
   - ドメインサービスとイベントの定義

3. **UI/UX設計**
   - ワイヤーフレームとレイアウト
   - アクセシビリティ要件の具体化
   - レスポンシブデザインの仕様

## Iteration 3→4間での進化

アーキテクチャリファクタリングにより設計を大幅に改善：

1. **依存性注入システム導入**
   - 型安全なDIコンテナの実装
   - サービス層の抽象化とインターフェース化
   - Clean Architecture準拠の依存関係逆転実現

2. **アプリケーション層強化**
   - GameUseCaseパターンによるユースケース統一
   - プレゼンテーション層からのビジネスロジック分離
   - コンポーネント責任の明確化

3. **設計品質向上**
   - SOLID原則の厳格な適用
   - 型安全性の完全実現（any型排除）
   - テスタビリティの向上（345テストケース）

これらの設計進化により、保守性・拡張性・テスタビリティが大幅に向上し、Iteration 4以降の最適化作業の基盤が整備されました。