# 非機能要件

## 概要

ぷよぷよゲームシステムの非機能要件について説明します。システムの品質特性と制約事項を定義し、測定可能な指標で要件を明確化します。

## パフォーマンス要件

### レスポンス時間要件

```plantuml
@startuml "パフォーマンス要件"
!define GOOD_COLOR #90EE90
!define ACCEPTABLE_COLOR #FFD700
!define POOR_COLOR #FF6347

package "レスポンス時間目標" {
  rectangle "ゲーム操作レスポンス" GOOD_COLOR {
    note as n1
      目標: 16ms以下
      上限: 33ms以下
      測定: キー入力から画面更新まで
    end note
  }
  
  rectangle "ゲーム初期化" ACCEPTABLE_COLOR {
    note as n2
      目標: 3秒以下
      上限: 5秒以下
      測定: ゲーム開始ボタンから操作可能まで
    end note
  }
  
  rectangle "画面遷移" GOOD_COLOR {
    note as n3
      目標: 200ms以下
      上限: 500ms以下
      測定: ユーザー操作から画面変更完了まで
    end note
  }
}

@enduml
```

### スループット要件

| 操作種別 | 目標値 | 測定方法 |
|----------|--------|----------|
| フレームレート | 60 FPS以上 | requestAnimationFrame監視 |
| 連鎖計算処理 | 100連鎖/秒以上 | ベンチマークテスト |
| 同時操作処理 | 10操作/秒以上 | 入力バッファリングテスト |

### リソース使用量要件

```plantuml
@startuml "リソース使用量"
!define MEMORY_COLOR #E6F3FF
!define CPU_COLOR #FFE6E6
!define STORAGE_COLOR #F0FFF0

package "メモリ使用量" MEMORY_COLOR {
  rectangle "初期ロード時" {
    note as m1
      目標: 50MB以下
      上限: 100MB以下
    end note
  }
  
  rectangle "ゲームプレイ中" {
    note as m2
      目標: 80MB以下
      上限: 150MB以下
    end note
  }
  
  rectangle "メモリリーク" {
    note as m3
      許容値: 1MB/時間以下
      測定: 長時間プレイテスト
    end note
  }
}

package "CPU使用量" CPU_COLOR {
  rectangle "アイドル時" {
    note as c1
      目標: 5%以下
      上限: 10%以下
    end note
  }
  
  rectangle "ゲームプレイ中" {
    note as c2
      目標: 30%以下
      上限: 50%以下
    end note
  }
}

package "ストレージ使用量" STORAGE_COLOR {
  rectangle "アプリケーション" {
    note as s1
      目標: 5MB以下
      上限: 10MB以下
    end note
  }
  
  rectangle "セーブデータ" {
    note as s2
      目標: 1MB以下
      上限: 5MB以下
    end note
  }
}

@enduml
```

## 可用性・信頼性要件

### システム可用性

```plantuml
@startuml "可用性要件"
package "可用性目標" {
  [システム稼働率: 99.9%以上]
  [計画停止時間: 月4時間以内]
  [障害復旧時間: 1時間以内]
}

package "信頼性指標" {
  [平均故障間隔(MTBF): 720時間以上]
  [平均復旧時間(MTTR): 30分以内]
  [データ整合性: 99.99%以上]
}

package "障害対応" {
  [自動復旧機能]
  [データバックアップ]
  [エラーレポート機能]
  [グレースフルデグラデーション]
}

[システム稼働率: 99.9%以上] --> [自動復旧機能]
[障害復旧時間: 1時間以内] --> [データバックアップ]
[データ整合性: 99.99%以上] --> [エラーレポート機能]
@enduml
```

### エラーハンドリング要件

```plantuml
@startuml "エラーハンドリング戦略"
package "エラー分類" {
  class SystemError {
    - 重大度: Critical
    - 対応: 即座にエラー画面表示
    - 復旧: アプリケーション再起動
  }
  
  class DataError {
    - 重大度: High
    - 対応: データリセット提案
    - 復旧: セーフモードでの起動
  }
  
  class NetworkError {
    - 重大度: Medium
    - 対応: オフラインモード移行
    - 復旧: 再接続試行
  }
  
  class UserInputError {
    - 重大度: Low
    - 対応: ユーザーに操作説明
    - 復旧: 自動修正
  }
}

package "エラー対応フロー" {
  SystemError --> DataError : データ破損検出
  DataError --> NetworkError : 通信障害検出
  NetworkError --> UserInputError : 入力エラー検出
}

@enduml
```

## セキュリティ要件

### 脅威モデル

```plantuml
@startuml "脅威モデル"
package "脅威と対策" {
  rectangle "XSS攻撃" {
    note as xss
      脅威: スクリプト注入
      影響: ユーザーデータ漏洩
      対策: 入力値サニタイゼーション
      優先度: 高
    end note
  }
  
  rectangle "データ改ざん" {
    note as data
      脅威: ローカルストレージ操作
      影響: スコア改ざん
      対策: データ整合性チェック
      優先度: 中
  }
  
  rectangle "DoS攻撃" {
    note as dos
      脅威: 大量リクエスト
      影響: サービス停止
      対策: レート制限
      優先度: 低
  }
}

@enduml
```

### セキュリティ制御

| セキュリティ要件 | 実装方針 | 検証方法 |
|------------------|----------|----------|
| 入力値検証 | すべての入力をサニタイズ | セキュリティテスト |
| データ暗号化 | 重要データの暗号化保存 | データ保護監査 |
| セッション管理 | セッション固定化対策 | セッションテスト |
| HTTPS通信 | すべての通信をHTTPS化 | SSL証明書監視 |

## 互換性要件

### ブラウザ互換性

```plantuml
@startuml "ブラウザサポート"
!define PRIMARY_COLOR #90EE90
!define SECONDARY_COLOR #FFD700
!define PARTIAL_COLOR #FFE6CC

package "フルサポート" PRIMARY_COLOR {
  [Chrome 90+]
  [Firefox 88+]
  [Safari 14+]
  [Edge 90+]
}

package "基本サポート" SECONDARY_COLOR {
  [Chrome 80-89]
  [Firefox 78-87]
  [Safari 13]
  [Edge 80-89]
}

package "制限サポート" PARTIAL_COLOR {
  [古いブラウザ]
  [モバイルブラウザ]
}

note right of [フルサポート]
  すべての機能が利用可能
  最新Web API対応
  パフォーマンス最適化
end note

note right of [基本サポート]
  コア機能のみ利用可能
  一部制限あり
end note

note right of [制限サポート]
  基本的なゲームプレイのみ
  機能制限メッセージ表示
end note

@enduml
```

### デバイス互換性

| デバイス種別 | 画面サイズ | 操作方法 | サポートレベル |
|--------------|------------|----------|----------------|
| デスクトップ | 1024px+ | キーボード・マウス | フル |
| タブレット | 768-1023px | タッチ・キーボード | フル |
| スマートフォン | 320-767px | タッチのみ | 基本 |
| 小画面デバイス | <320px | タッチのみ | 制限 |

## アクセシビリティ要件

### WCAG 2.1 準拠レベル

```plantuml
@startuml "アクセシビリティ要件"
package "WCAG 2.1 AA準拠" {
  rectangle "知覚可能" {
    [代替テキスト提供]
    [十分なコントラスト比]
    [拡大表示対応]
    [色以外の情報表現]
  }
  
  rectangle "操作可能" {
    [キーボードアクセス]
    [フォーカス管理]
    [十分なクリック領域]
    [制限時間の調整]
  }
  
  rectangle "理解可能" {
    [明確な操作説明]
    [エラーメッセージ]
    [一貫したナビゲーション]
    [予測可能な動作]
  }
  
  rectangle "堅牢性" {
    [セマンティックマークアップ]
    [支援技術対応]
    [標準準拠コード]
  }
}

@enduml
```

### 支援技術対応

| 支援技術 | 対応レベル | 実装方針 |
|----------|------------|----------|
| スクリーンリーダー | フル対応 | ARIA属性・ライブリージョン |
| 音声認識 | 基本対応 | 音声コマンド対応 |
| 拡大ソフト | フル対応 | 高コントラスト・拡大表示 |
| 代替入力デバイス | 基本対応 | カスタムキー設定 |

## 拡張性・保守性要件

### システム拡張性

```plantuml
@startuml "拡張性要件"
package "水平拡張性" {
  [同時ユーザー数: 1,000人]
  [トラフィック増加: 年間50%]
  [データ量増加: 年間100%]
}

package "機能拡張性" {
  [新ゲームモード追加]
  [マルチプレイヤー対応]
  [AI対戦機能]
  [カスタマイズ機能]
}

package "技術拡張性" {
  [新技術スタック対応]
  [API拡張]
  [プラグインアーキテクチャ]
  [マイクロサービス移行]
}

[同時ユーザー数: 1,000人] --> [新ゲームモード追加]
[機能拡張性] --> [技術拡張性]
@enduml
```

### コード品質要件

| 品質指標 | 目標値 | 測定方法 |
|----------|--------|----------|
| テストカバレッジ | 80%以上 | Jest Coverage |
| 循環的複雑度 | 10以下/関数 | ESLint complexity |
| 技術的負債比率 | 5%以下 | SonarQube |
| コード重複率 | 3%以下 | 静的解析ツール |

## 国際化・ローカライゼーション要件

### 多言語対応

```plantuml
@startuml "国際化要件"
package "対応言語" {
  [日本語 (ja)] #90EE90
  [英語 (en)] #90EE90
  [中国語 (zh)] #FFD700
  [韓国語 (ko)] #FFD700
}

package "文化的適応" {
  [数値フォーマット]
  [日付時刻形式]
  [通貨表示]
  [文字方向]
}

package "コンテンツ管理" {
  [翻訳管理システム]
  [文字列外部化]
  [フォント管理]
  [レイアウト調整]
}

[日本語 (ja)] --> [翻訳管理システム]
[英語 (en)] --> [文字列外部化]
[中国語 (zh)] --> [フォント管理]
[韓国語 (ko)] --> [レイアウト調整]
@enduml
```

### 地域化対応

| 地域 | 文字エンコーディング | 入力方式 | 特別考慮事項 |
|------|----------------------|----------|--------------|
| 日本 | UTF-8 | IME対応 | 縦書き対応検討 |
| 北米 | UTF-8 | 標準キーボード | - |
| 中国 | UTF-8 | 簡体字入力 | フォントサイズ調整 |
| 韓国 | UTF-8 | ハングル入力 | 文字幅考慮 |

## 運用・監視要件

### 監視要件

```plantuml
@startuml "監視要件"
package "リアルタイム監視" {
  [システムメトリクス監視]
  [エラーレート監視]  
  [パフォーマンス監視]
  [ユーザー体験監視]
}

package "ログ管理" {
  [アプリケーションログ]
  [アクセスログ]
  [エラーログ]
  [監査ログ]
}

package "アラート" {
  [閾値超過アラート]
  [異常パターン検出]
  [SLA違反通知]
  [セキュリティイベント通知]
}

[システムメトリクス監視] --> [閾値超過アラート]
[エラーレート監視] --> [異常パターン検出]
[パフォーマンス監視] --> [SLA違反通知]
@enduml
```

### バックアップ・復旧要件

| データ種別 | バックアップ頻度 | 保管期間 | 復旧目標時間 |
|------------|------------------|----------|--------------|
| ユーザーデータ | リアルタイム | 30日 | 1時間 |
| アプリケーション設定 | 日次 | 90日 | 30分 |
| ログデータ | 週次 | 1年 | 24時間 |
| 監査ログ | 月次 | 7年 | 48時間 |

## 法的・コンプライアンス要件

### プライバシー・データ保護

```plantuml
@startuml "データ保護要件"
package "個人情報保護" {
  [データ最小化]
  [目的制限]
  [保管期間制限]
  [セキュリティ保護]
}

package "法的準拠" {
  [個人情報保護法対応]
  [GDPR対応]
  [CCPA対応]
  [Cookie法対応]
}

package "ユーザー権利" {
  [データアクセス権]
  [データ削除権]
  [データポータビリティ権]
  [同意撤回権]
}

[個人情報保護] --> [法的準拠]
[法的準拠] --> [ユーザー権利]
@enduml
```

### コンプライアンス要件

| 規制・標準 | 適用範囲 | 対応レベル | 監査頻度 |
|------------|----------|------------|----------|
| 個人情報保護法 | 全システム | 完全準拠 | 年次 |
| JIS X 8341 | UI/UX | レベルAA | 半年 |
| ISO 27001 | セキュリティ | 部分準拠 | 年次 |
| PCI DSS | 決済処理 | 対象外 | - |

## 非機能要件の測定・検証

### パフォーマンステスト

```plantuml
@startuml "パフォーマンステスト計画"
start

:テスト環境構築;

parallel
  :負荷テスト実行;
  note right: 通常負荷での性能測定
and
  :ストレステスト実行;
  note right: 限界負荷での動作確認
and
  :スパイクテスト実行;
  note right: 急激な負荷変動への対応
end parallel

:結果分析;

if (要件満足?) then (yes)
  :テスト合格;
else (no)
  :パフォーマンス改善;
endif

stop
@enduml
```

### 継続的監視

| 指標 | 測定頻度 | アラート閾値 | 対応手順 |
|------|----------|--------------|----------|
| レスポンス時間 | 1分間隔 | 平均50ms超過 | 自動スケーリング |
| エラー率 | 1分間隔 | 1%超過 | 開発チーム通知 |
| メモリ使用量 | 5分間隔 | 80%超過 | リソース監視強化 |
| CPU使用率 | 1分間隔 | 70%超過 | パフォーマンス調査 |

## まとめ

この非機能要件により以下を実現：

1. **パフォーマンス:** 60FPS以上の快適なゲーム体験
2. **可用性:** 99.9%以上のシステム稼働率
3. **セキュリティ:** 多層防御によるセキュリティ保護
4. **互換性:** 幅広いブラウザ・デバイスサポート
5. **アクセシビリティ:** WCAG 2.1 AA準拠のバリアフリー
6. **拡張性:** 将来の機能追加・技術変更への対応力
7. **運用性:** 効率的な監視・保守・運用体制
8. **コンプライアンス:** 法的要件・業界標準への準拠