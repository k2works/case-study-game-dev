---
title: ã·ã‚ˆã·ã‚ˆã‹ã‚‰å§‹ã‚ã‚‹ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º (Elixirç‰ˆ)
description: ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æ‰‹æ³•ã‚’ç”¨ã„ã¦Elixirã§ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã™ã‚‹éç¨‹ã‚’è§£èª¬
published: true
date: 2025-10-14T00:00:00.000Z
tags: tdd, elixir, ã·ã‚ˆã·ã‚ˆ, phoenix-liveview
editor: markdown
dateCreated: 2025-10-14T00:00:00.000Z
---

# ã·ã‚ˆã·ã‚ˆã‹ã‚‰å§‹ã‚ã‚‹ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º (Elixirç‰ˆ)

## ã¯ã˜ã‚ã«

ã¿ãªã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ä»Šæ—¥ã¯ç§ã¨ä¸€ç·’ã«ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ã‚’ä½¿ã£ã¦ã€Elixirã§ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã€ŒElixirã§ã‚²ãƒ¼ãƒ é–‹ç™ºï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€Elixirã®å¼·åŠ›ãªä¸¦è¡Œå‡¦ç†ã¨Phoenix LiveViewã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡æ©Ÿèƒ½ã‚’æ´»ç”¨ã™ã‚Œã°ã€ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯¾å¿œã®ã‚²ãƒ¼ãƒ ã‚‚ç°¡å˜ã«ä½œã‚Œã‚‹ã‚“ã§ã™ï¼

> ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã¨ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ‰‹æ³•ã®ä¸€ç¨®ã§ã€ã€Œãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã€ã®åŸå‰‡ã«å¾“ã„ã€å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’é«˜ã‚ã€è¨­è¨ˆã‚’æ”¹å–„ã—ã¦ã„ãé–‹ç™ºæ‰‹æ³•ã§ã™ã€‚
>
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã“ã®è¨˜äº‹ã§ã¯ã€ç§ãŸã¡ãŒä¸€ç·’ã«ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ãªãŒã‚‰ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®åŸºæœ¬çš„ãªæµã‚Œã¨è€ƒãˆæ–¹ã‚’å­¦ã‚“ã§ã„ãã¾ã™ã€‚ã¾ã‚‹ã§ãƒ¢ãƒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚ˆã†ã«ã€ã‚ãªãŸã¨ç§ãŒä¸€ç·’ã«è€ƒãˆã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€æ”¹å–„ã—ã¦ã„ãéç¨‹ã‚’ä½“é¨“ã—ã¾ã—ã‚‡ã†ã€‚

### Elixirã§ã‚²ãƒ¼ãƒ é–‹ç™ºã‚’é¸ã‚“ã ç†ç”±

ã€ŒãªãœElixirãªã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ã„ãã¤ã‹ç†ç”±ãŒã‚ã‚Šã¾ã™ï¼š

1. **é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°**: ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ã‚ˆã‚Šã€ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç†ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™
2. **ä¸¦è¡Œå‡¦ç†**: å°†æ¥çš„ã«ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã‚„ã™ã„è¨­è¨ˆã«ãªã‚Šã¾ã™
3. **Phoenix LiveView**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªã‚²ãƒ¼ãƒ ä½“é¨“ã‚’æä¾›ã§ãã¾ã™
4. **ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°**: ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹é·ç§»ãŒç›´æ„Ÿçš„ã«æ›¸ã‘ã¾ã™
5. **å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«**: Mixã€ExUnitã€Credoãªã©ã€é–‹ç™ºç’°å¢ƒãŒå……å®Ÿã—ã¦ã„ã¾ã™

### ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚µã‚¤ã‚¯ãƒ«

ã•ã¦ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€ã©ã®ã‚ˆã†ã«é€²ã‚ã¦ã„ã‘ã°ã„ã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿã€Œãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã‹ã‚‰å®Ÿè£…ã™ã‚‹ã€ã¨ã„ã†ã®ã¯åˆ†ã‹ã‚Šã¾ã—ãŸãŒã€å…·ä½“çš„ã«ã¯ã©ã‚“ãªæ‰‹é †ã§é€²ã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ç§ãŒã„ã¤ã‚‚å®Ÿè·µã—ã¦ã„ã‚‹ã®ã¯ã€ä»¥ä¸‹ã®3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¹°ã‚Šè¿”ã™ã‚µã‚¤ã‚¯ãƒ«ã§ã™ã€‚çš†ã•ã‚“ã‚‚ä¸€ç·’ã«ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **Redï¼ˆèµ¤ï¼‰**: ã¾ãšå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¾ã™ã€‚ã€Œãˆï¼Ÿã‚ã–ã¨å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã‚Œã«ã¯é‡è¦ãªæ„å‘³ãŒã‚ã‚‹ã‚“ã§ã™ã€‚ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½ãŒä½•ã‚’ã™ã¹ãã‹ã‚’æ˜ç¢ºã«ã™ã‚‹ãŸã‚ãªã‚“ã§ã™ã‚ˆã€‚
2. **Greenï¼ˆç·‘ï¼‰**: æ¬¡ã«ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ã€æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã®æ®µéšã§ã¯ã€ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šã‚‚ã€Œã¨ã«ã‹ãå‹•ãã“ã¨ã€ã‚’å„ªå…ˆã—ã¾ã™ã€‚ã€Œæœ€å°é™ã€ã¨ã„ã†ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚å¿…è¦ä»¥ä¸Šã®ã“ã¨ã¯ã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚
3. **Refactorï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰**: æœ€å¾Œã«ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’æ”¹å–„ã—ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªã—ãªãŒã‚‰ã€é‡è¤‡ã‚’å–ã‚Šé™¤ã„ãŸã‚Šã€ã‚ã‹ã‚Šã‚„ã™ã„åå‰ã‚’ã¤ã‘ãŸã‚Šã—ã¾ã™ã€‚ã€Œå‹•ãã‘ã©æ±šã„ã‚³ãƒ¼ãƒ‰ã€ã‹ã‚‰ã€Œå‹•ã„ã¦ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã€ã¸ã¨é€²åŒ–ã•ã›ã‚‹ã‚“ã§ã™ã€‚

> ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ãƒªã‚ºãƒ ï¼šèµ¤ã€ç·‘ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€‚ã¾ãšå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆèµ¤ï¼‰ã€æ¬¡ã«ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆç·‘ï¼‰ã€ãã—ã¦é‡è¤‡ã‚’é™¤å»ã™ã‚‹ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰ã€‚
>
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ã€ŒRed-Green-Refactorã€ã‚µã‚¤ã‚¯ãƒ«ã¨å‘¼ã³ã¾ã™ã€‚ã€Œèµ¤ãƒ»ç·‘ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€ã®ãƒªã‚ºãƒ ã‚’åˆ»ã‚€ã‚ˆã†ã«ã€ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãã‚“ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€å°‘ã—ãšã¤æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’é«˜ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```plantuml
@startuml
[*] --> ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ
ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ --> TODO : TODOãƒªã‚¹ãƒˆã‚’ä½œæˆ
TODO --> Red : ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
Red --> Green : æœ€å°é™ã®å®Ÿè£…
Green --> Refactor : ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
Refactor --> Red : æ¬¡ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
Red : ãƒ†ã‚¹ãƒˆã«å¤±æ•—
Green : ãƒ†ã‚¹ãƒˆã«é€šã‚‹æœ€å°é™ã®å®Ÿè£…
Refactor : ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’é™¤å»ã—ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
Refactor --> TODO : ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒå®Œäº†ã—ãŸã‚‰TODOãƒªã‚¹ãƒˆã«æˆ»ã‚‹
TODO --> ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ : TODOãƒªã‚¹ãƒˆãŒç©ºã«ãªã‚‹ã¾ã§ç¹°ã‚Šè¿”ã™
ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ --> ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ“ãƒ¥ãƒ¼
@enduml
```

### é–‹ç™ºç’°å¢ƒ

ã•ã¦ã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã«ã€ç§ãŸã¡ãŒä½¿ç”¨ã™ã‚‹é–‹ç™ºç’°å¢ƒã«ã¤ã„ã¦å°‘ã—ãŠè©±ã—ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ãã¾ã™ï¼š

- **è¨€èª**: Elixir 1.16+ â€” é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã€Erlang VMã®ä¸Šã§å‹•ä½œã—ã¾ã™
- **ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«**: Mix â€” Elixirã®æ¨™æº–ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã‹ã‚‰ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¾ã§çµ±åˆçš„ã«ç®¡ç†ã§ãã¾ã™
- **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: ExUnit â€” Elixiræ¨™æº–ã®ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™
- **é™çš„è§£æ**: Credo â€” Elixirå°‚ç”¨ã®é™çš„ã‚³ãƒ¼ãƒ‰è§£æãƒ„ãƒ¼ãƒ«ã§ã™
- **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: ExCoveralls â€” ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã—ã¾ã™
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Phoenix LiveView â€” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã¾ã™
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Git â€” ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´å±¥æ­´ã‚’è¿½è·¡ã—ã¾ã™

ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æµã‚Œã«æ²¿ã£ã¦ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

---

## è¦ä»¶

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã•ã¦ã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã‚‹å‰ã«ã€å°‘ã—ç«‹ã¡æ­¢ã¾ã£ã¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã€Œä½•ã‚’ä½œã‚‹ã®ã‹ï¼Ÿã€ã¨ã„ã†åŸºæœ¬çš„ãªå•ã„ã‹ã‘ã§ã™ã€‚ç§ãŸã¡ãŒä½œã‚‹ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã¯ã€ã©ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’æŒã¤ã¹ãã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™ºã§ã¯ã€ã“ã®ã€Œä½•ã‚’ä½œã‚‹ã®ã‹ï¼Ÿã€ã¨ã„ã†å•ã„ã«å¯¾ã—ã¦ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€ã¨ã„ã†å½¢ã§ç­”ãˆã‚’å‡ºã—ã¾ã™ã€‚

> ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¨ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ©Ÿèƒ½ã‚’ã€Œèª°ãŒã€ã€Œä½•ã‚’ã€ã€Œãªãœã€ã—ãŸã„ã®ã‹ã¨ã„ã†å½¢å¼ã§è¡¨ç¾ã—ãŸã‚‚ã®ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºãƒãƒ¼ãƒ ã¯å¸¸ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦–ç‚¹ã‚’å¿˜ã‚Œãšã«é–‹ç™ºã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
>
> â€” Mike Cohn ã€User Stories Appliedã€

ã§ã¯ã€ç§ãŸã¡ã®ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã§ã¯ã€ã©ã‚“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ

- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å›è»¢ã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€åŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆå»ã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€é€£é–åå¿œã‚’èµ·ã“ã—ã¦ã‚ˆã‚Šé«˜ã„ã‚¹ã‚³ã‚¢ã‚’ç²å¾—ã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€å…¨æ¶ˆã—ï¼ˆãœã‚“ã‘ã—ï¼‰ãƒœãƒ¼ãƒŠã‚¹ã‚’ç²å¾—ã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã«ãªã‚‹ã¨ã‚²ãƒ¼ãƒ çµ‚äº†ã®æ¼”å‡ºã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ã‚’ç¢ºèªã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ã·ã‚ˆã‚’æ“ä½œã§ãã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚¿ãƒƒãƒæ“ä½œã§ã·ã‚ˆã‚’æ“ä½œã§ãã‚‹

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’æ•´ç†ã—ãŸã¨ã“ã‚ã§ã€ã€Œã“ã‚Œã‚‰ã®æ©Ÿèƒ½ãŒã©ã®ã‚ˆã†ã«é–¢é€£ã—ã¦ã„ã‚‹ã®ã‹ã€å…¨ä½“åƒãŒè¦‹ãˆã‚‹ã¨ã„ã„ãªã€ã¨æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿãã‚“ãªã¨ãã«å½¹ç«‹ã¤ã®ãŒã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã€ã§ã™ã€‚

```plantuml
@startuml "ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³"
left to right direction
skinparam packageStyle rectangle
skinparam linetype ortho

' ã‚¢ã‚¯ã‚¿ãƒ¼ã®å®šç¾©
actor "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" as Player
actor "ã‚·ã‚¹ãƒ†ãƒ " as System

rectangle "ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚·ã‚¹ãƒ†ãƒ " {
  together {
    ' ã‚²ãƒ¼ãƒ ç®¡ç†é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹" as StartNewGame
    usecase "ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ" as RestartGame
  }

  together {
    ' ã·ã‚ˆæ“ä½œé–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•" as MovePuyo
    usecase "ã·ã‚ˆã‚’å›è»¢" as RotatePuyo
    usecase "ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹" as QuickDropPuyo
  }

  together {
    ' ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã·ã‚ˆã‚’æ¶ˆå»" as ErasePuyo
    usecase "é€£é–åå¿œã‚’ç™ºç”Ÿ" as ChainReaction
    usecase "å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’ç²å¾—" as ZenkeshiBonus
    usecase "ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º" as DisplayScore
  }

  together {
    ' å…¥åŠ›é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§æ“ä½œ" as KeyboardControl
    usecase "ã‚¿ãƒƒãƒæ“ä½œ" as TouchControl
  }

  together {
    ' ã‚·ã‚¹ãƒ†ãƒ é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š" as GameOverCheck
    usecase "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ¼”å‡º" as GameOverAnimation
  }
}

' ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é–¢é€£
Player --> StartNewGame
Player --> RestartGame
Player --> MovePuyo
Player --> RotatePuyo
Player --> QuickDropPuyo
Player --> KeyboardControl
Player --> TouchControl

' ã‚·ã‚¹ãƒ†ãƒ ã®é–¢é€£
ErasePuyo <-- System
ChainReaction <-- System
ZenkeshiBonus <-- System
DisplayScore <-- System
GameOverCheck <-- System
GameOverAnimation <-- System

' åŒ…å«é–¢ä¿‚
MovePuyo ..> KeyboardControl : <<extend>>
MovePuyo ..> TouchControl : <<extend>>
RotatePuyo ..> KeyboardControl : <<extend>>
RotatePuyo ..> TouchControl : <<extend>>
QuickDropPuyo ..> KeyboardControl : <<extend>>
QuickDropPuyo ..> TouchControl : <<extend>>

' ãã®ä»–ã®é–¢ä¿‚
ErasePuyo ..> ChainReaction : <<include>>
ChainReaction ..> DisplayScore : <<include>>
ZenkeshiBonus ..> DisplayScore : <<include>>
GameOverCheck ..> GameOverAnimation : <<include>>

@enduml
```

---

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨é–‹ç™ºç’°å¢ƒæ§‹ç¯‰

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0ã®ç›®æ¨™

å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã‚‹å‰ã«ã€ã€Œå‹•ä½œã™ã‚‹ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã€ã‚’ç¶™ç¶šçš„ã«æ›¸ãç¶šã‘ã‚‰ã‚Œã‚‹ç’°å¢ƒã‚’æ•´ãˆã¾ã™ã€‚ã“ã‚ŒãŒ**ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0**ã§ã™ã€‚

> ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã«ãŠã„ã¦ã€é©åˆ‡ãªé–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã¯æˆåŠŸã®åŠåˆ†ã§ã™ã€‚è‰¯ã„ãƒ„ãƒ¼ãƒ«ã¯è‰¯ã„ä»•äº‹ã®ç¬¬ä¸€æ­©ã¨ãªã‚Šã¾ã™ã€‚
>
> â€” Andrew Hunt & David Thomas ã€é”äººãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã€

ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿç¾ã™ã‚‹ã“ã¨ï¼š

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ**: Mixã‚’ä½¿ç”¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–
2. **é–‹ç™ºãƒ„ãƒ¼ãƒ«ã®å°å…¥**: Credoï¼ˆé™çš„è§£æï¼‰ã€ExCoverallsï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰ã€mix_test_watchï¼ˆè‡ªå‹•ãƒ†ã‚¹ãƒˆï¼‰
3. **é–‹ç™ºã‚¬ã‚¤ãƒ‰ã®ä½œæˆ**: ãƒãƒ¼ãƒ é–‹ç™ºã®ãŸã‚ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™
4. **å“è³ªåŸºæº–ã®è¨­å®š**: ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ä¿ã¤ãŸã‚ã®ãƒ«ãƒ¼ãƒ«ç­–å®š

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

ã¾ãšã¯ã€æ–°ã—ã„Elixirãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
mix new puyo_puyo --module PuyoPuyo
cd puyo_puyo
```

ã“ã‚Œã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š

```
puyo_puyo/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ puyo_puyo.ex         # ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ puyo_puyo_test.exs   # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ test_helper.exs       # ãƒ†ã‚¹ãƒˆè¨­å®š
â”œâ”€â”€ mix.exs                   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â””â”€â”€ README.md                 # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
```

### ã‚¹ãƒ†ãƒƒãƒ—2: GitåˆæœŸåŒ–

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚’é–‹å§‹ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€Œã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã®ä¸‰ç¨®ã®ç¥å™¨ã€ã®ä¸€ã¤ã§ã™ã€‚

```bash
# Gitãƒªãƒã‚¸ãƒˆãƒªã‚’åˆæœŸåŒ–
git init

# .gitignoreã‚’ä½œæˆ
cat > .gitignore << 'EOF'
# The directory Mix will write compiled artifacts to.
/_build/

# If you run "mix test --cover", coverage assets end up here.
/cover/

# The directory Mix downloads your dependencies sources to.
/deps/

# Where third-party dependencies like ExDoc output generated docs.
/doc/

# Ignore .fetch files in case you like to edit your project deps locally.
/.fetch

# If the VM crashes, it generates a dump, let's ignore it too.
erl_crash.dump

# Also ignore archive artifacts (built via "mix archive.build").
*.ez

# Ignore package tarball (built via "mix hex.build").
puyo_puyo-*.tar

# Temporary files, for example, from tests.
/tmp/
EOF

# åˆå›ã‚³ãƒŸãƒƒãƒˆ
git add -A
git commit -m "chore: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ä¾å­˜é–¢ä¿‚ã®è¨­å®š

é–‹ç™ºã«å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚’ `mix.exs` ã«è¿½åŠ ã—ã¾ã™ã€‚

```elixir
defmodule PuyoPuyo.MixProject do
  use Mix.Project

  def project do
    [
      app: :puyo_puyo,
      version: "0.1.0",
      elixir: "~> 1.16",
      start_permanent: Mix.env() == :prod,
      deps: deps(),

      # ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¨­å®š
      test_coverage: [tool: ExCoveralls],
      preferred_cli_env: [
        coveralls: :test,
        "coveralls.detail": :test,
        "coveralls.html": :test
      ],

      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨­å®š
      name: "PuyoPuyo",
      source_url: "https://github.com/yourusername/puyo_puyo",
      docs: [
        main: "PuyoPuyo",
        extras: ["README.md"]
      ]
    ]
  end

  def application do
    [
      extra_applications: [:logger]
    ]
  end

  defp deps do
    [
      # é™çš„ã‚³ãƒ¼ãƒ‰è§£æ
      {:credo, "~> 1.7", only: [:dev, :test], runtime: false},
      # ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸
      {:excoveralls, "~> 0.18", only: :test},
      # ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ï¼ˆè‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼‰
      {:mix_test_watch, "~> 1.0", only: [:dev, :test], runtime: false},
      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
      {:ex_doc, "~> 0.31", only: :dev, runtime: false}
    ]
  end
end
```

### ã‚¹ãƒ†ãƒƒãƒ—4: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ä¾å­˜é–¢ä¿‚ã‚’å–å¾—
mix deps.get

# ã‚³ãƒŸãƒƒãƒˆ
git add mix.exs mix.lock
git commit -m "chore: é–‹ç™ºãƒ„ãƒ¼ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ "
```

### ã‚¹ãƒ†ãƒƒãƒ—5: é™çš„è§£æãƒ„ãƒ¼ãƒ«ï¼ˆCredoï¼‰ã®è¨­å®š

Credoã¯ã€Elixirã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããŸã‚ã®é™çš„è§£æãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

```bash
# Credoè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
mix credo gen.config
```

ç”Ÿæˆã•ã‚ŒãŸ `.credo.exs` ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚ç‰¹ã«ã€ã‚µã‚¤ã‚¯ãƒ­ãƒãƒ†ã‚£ãƒƒã‚¯è¤‡é›‘åº¦ã‚’7ã«è¨­å®šã—ã¾ã™ã€‚

`.credo.exs` ã‚’ç·¨é›†ï¼š

```elixir
%{
  configs: [
    %{
      name: "default",
      files: %{
        included: [
          "lib/",
          "src/",
          "test/",
          "web/",
          "apps/*/lib/",
          "apps/*/src/",
          "apps/*/test/",
          "apps/*/web/"
        ],
        excluded: [~r"/_build/", ~r"/deps/", ~r"/node_modules/"]
      },
      plugins: [],
      requires: [],
      strict: true,
      parse_timeout: 5000,
      color: true,
      checks: %{
        enabled: [
          # ã‚µã‚¤ã‚¯ãƒ­ãƒãƒ†ã‚£ãƒƒã‚¯è¤‡é›‘åº¦ã‚’7ã«è¨­å®š
          {Credo.Check.Refactor.CyclomaticComplexity, [max_complexity: 7]},

          # ãã®ä»–ã®æ¨å¥¨è¨­å®š
          {Credo.Check.Refactor.Nesting, [max_nesting: 3]},
          {Credo.Check.Design.AliasUsage, []},
          {Credo.Check.Readability.ModuleDoc, []},
          {Credo.Check.Readability.FunctionNames, []},
          {Credo.Check.Readability.VariableNames, []},
          {Credo.Check.Warning.UnusedEnumOperation, []},
          {Credo.Check.Warning.UnusedKeywordOperation, []},
          {Credo.Check.Warning.UnusedListOperation, []},
          {Credo.Check.Warning.UnusedTupleOperation, []}
        ],
        disabled: []
      }
    }
  ]
}
```

#### ã‚µã‚¤ã‚¯ãƒ­ãƒãƒ†ã‚£ãƒƒã‚¯è¤‡é›‘åº¦ã¨ã¯

**ã‚µã‚¤ã‚¯ãƒ­ãƒãƒ†ã‚£ãƒƒã‚¯è¤‡é›‘åº¦ï¼ˆCyclomatic Complexityï¼‰**ã¯ã€ã‚³ãƒ¼ãƒ‰ã®è¤‡é›‘ã•ã‚’æ¸¬ã‚‹æŒ‡æ¨™ã§ã™ï¼š

- **è¨ˆç®—æ–¹æ³•**: æ¡ä»¶åˆ†å²ï¼ˆ`if`ã€`case`ã€`cond`ï¼‰ã¨ãƒ«ãƒ¼ãƒ—ã®æ•°ã«åŸºã¥ã„ã¦è¨ˆç®—
- **è¤‡é›‘åº¦7ã®æ„å‘³**: é–¢æ•°å†…ã«æœ€å¤§7ã¤ã®ç‹¬ç«‹ã—ãŸå®Ÿè¡Œãƒ‘ã‚¹ãŒè¨±å®¹ã•ã‚Œã‚‹
- **æ¨å¥¨å€¤**:
  - 1-7: ä½ã„è¤‡é›‘åº¦ï¼ˆç†è§£ã—ã‚„ã™ã„ï¼‰
  - 8-10: ä¸­ç¨‹åº¦ã®è¤‡é›‘åº¦ï¼ˆã¾ã ç®¡ç†å¯èƒ½ï¼‰
  - 11ä»¥ä¸Š: é«˜ã„è¤‡é›‘åº¦ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ¨å¥¨ï¼‰

è¤‡é›‘åº¦ãŒé«˜ã„é–¢æ•°ã¯ã€ãƒ†ã‚¹ãƒˆãŒé›£ã—ãã€ãƒã‚°ãŒæ··å…¥ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚TDDã§ã¯ã€è¤‡é›‘åº¦ã‚’ä½ãä¿ã¤ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆã—ã‚„ã™ãä¿å®ˆã—ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
# Credoã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹
mix credo --strict

# ã‚µã‚¤ã‚¯ãƒ­ãƒãƒ†ã‚£ãƒƒã‚¯è¤‡é›‘åº¦ã®è©³ç´°ã‚’ç¢ºèª
mix credo --format=flycheck
```

åˆæœŸçŠ¶æ…‹ã§ã¯ã€ã„ãã¤ã‹ã®è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã‚Œã‚‰ã‚’ä¿®æ­£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—6: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¿½åŠ 

CredoãŒæŒ‡æ‘˜ã™ã‚‹ `@moduledoc` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`lib/puyo_puyo.ex` ã‚’ç·¨é›†ï¼š

```elixir
defmodule PuyoPuyo do
  @moduledoc """
  ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

  ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®å®Ÿè·µä¾‹ã¨ã—ã¦ã€
  ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

  ## ç‰¹å¾´

  - ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
  - ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã«ã‚ˆã‚‹çŠ¶æ…‹é·ç§»
  - ExUnitã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º
  """

  @doc """
  Hello world.

  ## Examples

      iex> PuyoPuyo.hello()
      :world

  """
  def hello do
    :world
  end
end
```

### ã‚¹ãƒ†ãƒƒãƒ—7: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã®è¨­å®š

`.formatter.exs` ã‚’ç·¨é›†ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šã‚’èª¿æ•´ï¼š

```elixir
# .formatter.exs
[
  inputs: ["{mix,.formatter}.exs", "{config,lib,test}/**/*.{ex,exs}"],
  line_length: 100,
  import_deps: []
]
```

```bash
# ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•æ•´å½¢
mix format

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
mix format --check-formatted

# ã‚³ãƒŸãƒƒãƒˆ
git add -A
git commit -m "chore: é™çš„è§£æãƒ„ãƒ¼ãƒ«ã®è¨­å®šã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ "
```

### ã‚¹ãƒ†ãƒƒãƒ—8: ã‚«ã‚¹ã‚¿ãƒ Mixã‚¿ã‚¹ã‚¯ã®ä½œæˆ

é–‹ç™ºåŠ¹ç‡ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã€ã‚ˆãä½¿ç”¨ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’çµ±åˆã—ãŸã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
mkdir -p lib/mix/tasks
```

`lib/mix/tasks/check.ex` ã‚’ä½œæˆï¼š

```elixir
defmodule Mix.Tasks.Check do
  @moduledoc """
  é–‹ç™ºæ™‚ã®åŸºæœ¬ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯ã§ã™ã€‚

  ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
  - mix format --check-formatted (ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯)
  - mix credo (é™çš„è§£æ)
  - mix test (ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ)
  """

  use Mix.Task

  @shortdoc "åŸºæœ¬çš„ãªã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯"

  def run(_args) do
    Mix.shell().info("==> åŸºæœ¬ãƒã‚§ãƒƒã‚¯ã‚’é–‹å§‹ã—ã¾ã™")

    # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
    Mix.shell().info("\n==> ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯")
    Mix.Task.run("format", ["--check-formatted"])
    Mix.shell().info("âœ“ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ å®Œäº†")

    # é™çš„è§£æ
    Mix.shell().info("\n==> é™çš„è§£æ")
    Mix.Task.run("credo", ["--strict"])
    Mix.shell().info("âœ“ é™çš„è§£æ å®Œäº†")

    # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    Mix.shell().info("\n==> ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ")
    Mix.Task.run("test", [])
    Mix.shell().info("âœ“ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ å®Œäº†")

    Mix.shell().info("\nğŸ‰ åŸºæœ¬ãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
  end
end
```

`lib/mix/tasks/dev.ex` ã‚’ä½œæˆï¼š

```elixir
defmodule Mix.Tasks.Dev do
  @moduledoc """
  é–‹ç™ºæ™‚ã«ã‚ˆãä½¿ç”¨ã™ã‚‹ã‚¿ã‚¹ã‚¯ã®ãŸã‚ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã§ã™ã€‚
  """

  use Mix.Task

  @shortdoc "é–‹ç™ºç”¨ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚³ãƒãƒ³ãƒ‰"

  def run(["test"]) do
    Mix.Task.run("test", [])
  end

  def run(["format"]) do
    Mix.Task.run("format", [])
    Mix.shell().info("âœ“ ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¾ã—ãŸ")
  end

  def run(["coverage"]) do
    Mix.Task.run("coveralls.html", [])
    Mix.shell().info("âœ“ ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ (cover/excoveralls.html)")
  end

  def run(["watch"]) do
    Mix.Task.run("test.watch", [])
  end

  def run(_) do
    Mix.shell().info("""
    ä½¿ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:

      mix dev test          # ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
      mix dev format        # ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
      mix dev coverage      # ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
      mix dev watch         # ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ãƒ¢ãƒ¼ãƒ‰
    """)
  end
end
```

```bash
# å‹•ä½œç¢ºèª
mix check

# ã‚³ãƒŸãƒƒãƒˆ
git add -A
git commit -m "chore: ã‚«ã‚¹ã‚¿ãƒ Mixã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ "
```

### ã‚¹ãƒ†ãƒƒãƒ—9: é–‹ç™ºã‚¬ã‚¤ãƒ‰ã®ä½œæˆ

ãƒãƒ¼ãƒ é–‹ç™ºã®ãŸã‚ã€é–‹ç™ºæ‰‹é †ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã—ã¾ã™ã€‚

`DEVELOPMENT.md` ã‚’ä½œæˆï¼š

```markdown
# é–‹ç™ºã‚¬ã‚¤ãƒ‰

## é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦ãªç’°å¢ƒ

- Elixir 1.16 ä»¥ä¸Š
- Erlang/OTP 26 ä»¥ä¸Š
- Git

### åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

\`\`\`bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
mix deps.get

# é–‹ç™ºãƒ„ãƒ¼ãƒ«ã®å‹•ä½œç¢ºèª
mix check
\`\`\`

## ä½¿ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«

### åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

- `mix test` - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- `mix format` - ã‚³ãƒ¼ãƒ‰æ•´å½¢
- `mix credo` - é™çš„è§£æ
- `mix coveralls` - ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
- `mix coveralls.html` - HTMLã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

### çµ±åˆã‚³ãƒãƒ³ãƒ‰

- `mix check` - åŸºæœ¬ãƒã‚§ãƒƒã‚¯ (format, credo, test)

### é–‹ç™ºç”¨ã‚³ãƒãƒ³ãƒ‰

- `mix dev` - åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ä¸€è¦§
- `mix dev test` - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- `mix dev format` - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®Ÿè¡Œ
- `mix dev coverage` - ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- `mix dev watch` - ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ãƒ¢ãƒ¼ãƒ‰

### è‡ªå‹•åŒ–

- `mix test.watch` - ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

## é–‹ç™ºãƒ•ãƒ­ãƒ¼

### Red-Green-Refactorã‚µã‚¤ã‚¯ãƒ«

1. **Redï¼ˆèµ¤ï¼‰**: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
2. **Greenï¼ˆç·‘ï¼‰**: ãƒ†ã‚¹ãƒˆãŒé€šã‚‹æœ€å°é™ã®å®Ÿè£…
3. **Refactorï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰**: ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’æ”¹å–„

### æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

1. **æ–°æ©Ÿèƒ½ãƒ»ãƒã‚°ä¿®æ­£ã®é–‹å§‹**
   \`\`\`bash
   # ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ãƒ¢ãƒ¼ãƒ‰ã§é–‹ç™º
   mix dev watch
   \`\`\`

2. **ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã**
   - ãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆRedï¼‰
   - å®Ÿè£…ã™ã‚‹ï¼ˆGreenï¼‰
   - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ï¼ˆRefactorï¼‰

3. **ã‚³ãƒŸãƒƒãƒˆå‰ã®ãƒã‚§ãƒƒã‚¯**
   \`\`\`bash
   # è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   mix format

   # å“è³ªãƒã‚§ãƒƒã‚¯
   mix check
   \`\`\`

4. **ã‚³ãƒŸãƒƒãƒˆ**
   \`\`\`bash
   git add -A
   git commit -m "feat: æ–°æ©Ÿèƒ½ã‚’è¿½åŠ "
   \`\`\`

## ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„

Angularã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„ã«å¾“ã„ã¾ã™ï¼š

- `feat`: æ–°æ©Ÿèƒ½
- `fix`: ãƒã‚°ä¿®æ­£
- `docs`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿ã®å¤‰æ›´
- `style`: ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œã«å½±éŸ¿ã—ãªã„å¤‰æ›´
- `refactor`: ãƒã‚°ä¿®æ­£ã‚„æ©Ÿèƒ½è¿½åŠ ä»¥å¤–ã®ã‚³ãƒ¼ãƒ‰å¤‰æ›´
- `test`: ãƒ†ã‚¹ãƒˆã®è¿½åŠ ã‚„ä¿®æ­£
- `chore`: ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã‚„ãƒ„ãƒ¼ãƒ«ã®å¤‰æ›´

ä¾‹ï¼š
\`\`\`bash
git commit -m "feat: ã·ã‚ˆã®ç§»å‹•æ©Ÿèƒ½ã‚’å®Ÿè£…"
git commit -m "test: ã·ã‚ˆã®å›è»¢ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ "
git commit -m "refactor: ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²"
\`\`\`

## å“è³ªåŸºæº–

- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: Elixiræ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã«æº–æ‹ ï¼ˆ100%ï¼‰
- **é™çš„è§£æ**: Credoã®ãƒ«ãƒ¼ãƒ«ã‚’ã‚¯ãƒªã‚¢
- **ã‚µã‚¤ã‚¯ãƒ­ãƒãƒ†ã‚£ãƒƒã‚¯è¤‡é›‘åº¦**: é–¢æ•°ã‚ãŸã‚Š7ä»¥ä¸‹
- **ãƒã‚¹ãƒˆã®æ·±ã•**: æœ€å¤§3ãƒ¬ãƒ™ãƒ«
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Šã‚’ç›®æ¨™
- **å…¨ãƒ†ã‚¹ãƒˆ**: ãƒ‘ã‚¹å¿…é ˆ

### ã‚³ãƒ¼ãƒ‰è¤‡é›‘åº¦ã«ã¤ã„ã¦

**ã‚µã‚¤ã‚¯ãƒ­ãƒãƒ†ã‚£ãƒƒã‚¯è¤‡é›‘åº¦7ä»¥ä¸‹**ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã§ï¼š
- ãƒ†ã‚¹ãƒˆãŒæ›¸ãã‚„ã™ããªã‚‹
- ãƒã‚°ãŒç™ºè¦‹ã—ã‚„ã™ããªã‚‹
- ã‚³ãƒ¼ãƒ‰ã®ç†è§£ãŒå®¹æ˜“ã«ãªã‚‹
- ä¿å®ˆæ€§ãŒå‘ä¸Šã™ã‚‹

è¤‡é›‘åº¦ãŒ7ã‚’è¶…ãˆã‚‹å ´åˆã¯ã€é–¢æ•°ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼

\`\`\`bash
# å•é¡Œ
mix format --check-formatted
# The following files are not formatted: ...

# è§£æ±º
mix format
\`\`\`

### Credoè­¦å‘Š

\`\`\`bash
# è­¦å‘Šã‚’ç¢ºèª
mix credo --strict

# è©³ç´°ã‚’ç¢ºèª
mix credo explain path/to/file.ex:line_number
\`\`\`

### ä¾å­˜é–¢ä¿‚ã®å•é¡Œ

\`\`\`bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
mix deps.clean --all
mix deps.get
\`\`\`
```

```bash
# ã‚³ãƒŸãƒƒãƒˆ
git add DEVELOPMENT.md
git commit -m "docs: é–‹ç™ºã‚¬ã‚¤ãƒ‰ã‚’è¿½åŠ "
```

### ã‚¹ãƒ†ãƒƒãƒ—10: READMEæ›´æ–°

`README.md` ã‚’æ›´æ–°ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚è¦ã‚’è¨˜è¼‰ï¼š

```markdown
# PuyoPuyo

Elixirã¨ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§å®Ÿè£…ã™ã‚‹ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ 

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ã®å®Ÿè·µä¾‹ã¨ã—ã¦ã€
Elixirã§ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã™ã‚‹éç¨‹ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

## ç‰¹å¾´

- **ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º**: Red-Green-Refactorã‚µã‚¤ã‚¯ãƒ«ã«å¾“ã£ãŸé–‹ç™º
- **é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°**: ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- **ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°**: Elixirã®å¼·åŠ›ãªæ©Ÿèƒ½ã‚’æ´»ç”¨
- **å“è³ªç®¡ç†**: Credoã€ExCoverallsã€mix_test_watchã«ã‚ˆã‚‹è‡ªå‹•åŒ–

## é–‹ç™ºç’°å¢ƒ

- Elixir 1.16+
- Erlang/OTP 26+

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

\`\`\`bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
mix deps.get

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
mix test

# å“è³ªãƒã‚§ãƒƒã‚¯
mix check
\`\`\`

## é–‹ç™º

è©³ç´°ãªé–‹ç™ºæ‰‹é †ã«ã¤ã„ã¦ã¯ [DEVELOPMENT.md](DEVELOPMENT.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
```

```bash
# ã‚³ãƒŸãƒƒãƒˆ
git add README.md
git commit -m "docs: README ã‚’æ›´æ–°"
```

### ã‚¹ãƒ†ãƒƒãƒ—11: å‹•ä½œç¢ºèª

ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

```bash
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
mix format --check-formatted

# é™çš„è§£æ
mix credo --strict

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
mix test

# ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
mix coveralls

# HTMLã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
mix coveralls.html

# çµ±åˆãƒã‚§ãƒƒã‚¯
mix check
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0ã®å®Œäº†

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ã“ã‚Œã§é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

#### é”æˆã—ãŸã“ã¨

âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¨GitåˆæœŸåŒ–
âœ… é–‹ç™ºãƒ„ãƒ¼ãƒ«ã®å°å…¥ï¼ˆCredoã€ExCoverallsã€mix_test_watchï¼‰
âœ… ã‚«ã‚¹ã‚¿ãƒ Mixã‚¿ã‚¹ã‚¯ã®ä½œæˆ
âœ… é–‹ç™ºã‚¬ã‚¤ãƒ‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
âœ… å“è³ªåŸºæº–ã®è¨­å®š

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
puyo_puyo/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ puyo_puyo.ex              # ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â””â”€â”€ mix/
â”‚       â””â”€â”€ tasks/
â”‚           â”œâ”€â”€ check.ex          # åŸºæœ¬ãƒã‚§ãƒƒã‚¯ã‚¿ã‚¹ã‚¯
â”‚           â””â”€â”€ dev.ex            # é–‹ç™ºç”¨ã‚¿ã‚¹ã‚¯
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ puyo_puyo_test.exs        # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ test_helper.exs
â”œâ”€â”€ .credo.exs                    # Credoè¨­å®š
â”œâ”€â”€ .formatter.exs                # ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿è¨­å®š
â”œâ”€â”€ .gitignore                    # Gité™¤å¤–è¨­å®š
â”œâ”€â”€ mix.exs                       # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”œâ”€â”€ DEVELOPMENT.md                # é–‹ç™ºã‚¬ã‚¤ãƒ‰
â””â”€â”€ README.md                     # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
```

#### ã‚³ãƒŸãƒƒãƒˆå±¥æ­´

```bash
git log --oneline
```

```
* docs: README ã‚’æ›´æ–°
* docs: é–‹ç™ºã‚¬ã‚¤ãƒ‰ã‚’è¿½åŠ 
* chore: ã‚«ã‚¹ã‚¿ãƒ Mixã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ 
* chore: é™çš„è§£æãƒ„ãƒ¼ãƒ«ã®è¨­å®šã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ 
* chore: é–‹ç™ºãƒ„ãƒ¼ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ 
* chore: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0ã§é–‹ç™ºç’°å¢ƒãŒæ•´ã„ã¾ã—ãŸã€‚æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã€å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ã‚’å§‹ã‚ã¾ã™ï¼š

- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1**: ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–ã¨ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®ç®¡ç†
- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2**: ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ã®å®Ÿè£…
- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3**: ã·ã‚ˆã®ç”Ÿæˆã¨è¡¨ç¤º
- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³4**: ã·ã‚ˆã®ç§»å‹•ã¨å›è»¢
- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³5**: ã·ã‚ˆã®è‡ªç”±è½ä¸‹
- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³6**: ã·ã‚ˆã®æ¶ˆå»åˆ¤å®š
- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³7**: é€£é–åå¿œã®å®Ÿè£…
- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³8**: ã‚¹ã‚³ã‚¢è¨ˆç®—
- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³9**: ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š
- **ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³10**: Phoenix LiveViewã«ã‚ˆã‚‹UIå®Ÿè£…

ãã‚Œã§ã¯ã€Red-Green-Refactorã®ãƒªã‚ºãƒ ã§ã€ã€Œå‹•ä½œã™ã‚‹ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã€ã‚’æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ï¼

---

## å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Elixirå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://elixir-lang.org/docs.html)
- [Mix documentation](https://hexdocs.pm/mix/Mix.html)
- [ExUnit documentation](https://hexdocs.pm/ex_unit/ExUnit.html)

### ä½¿ç”¨ãƒ„ãƒ¼ãƒ«
- [Credo](https://github.com/rrrene/credo) - é™çš„ã‚³ãƒ¼ãƒ‰è§£æ
- [ExCoveralls](https://github.com/parroty/excoveralls) - ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸
- [mix_test_watch](https://github.com/lpil/mix-test.watch) - ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–

### æ›¸ç±
- Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€
- Andrew Hunt & David Thomas ã€é”äººãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã€
- Mike Cohn ã€User Stories Appliedã€

Elixirã®ä¸–ç•Œã§ã€Œå‹•ä½œã™ã‚‹ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã€ã‚’ç¶™ç¶šçš„ã«æ›¸ãç¶šã‘ã‚‹ç’°å¢ƒãŒæ•´ã„ã¾ã—ãŸã€‚é–‹ç™ºã‚’æ¥½ã—ã‚“ã§ãã ã•ã„ï¼

---

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1: ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–ã¨ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®ç®¡ç†

ã•ã‚ã€ã„ã‚ˆã„ã‚ˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã¾ã—ã‚‡ã†ï¼ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€å°ã•ãªã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåå¾©ï¼‰ã§æ©Ÿèƒ½ã‚’å°‘ã—ãšã¤è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚æœ€åˆã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€æœ€ã‚‚åŸºæœ¬çš„ãªæ©Ÿèƒ½ã§ã‚ã‚‹ã€Œã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–ã¨ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®ç®¡ç†ã€ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

> ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¨ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’å°ã•ãªæ©Ÿèƒ½å˜ä½ã§ç¹°ã‚Šè¿”ã—é–‹ç™ºã—ã¦ã„ãæ‰‹æ³•ã§ã™ã€‚å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§è¨ˆç”»ã€è¨­è¨ˆã€å®Ÿè£…ã€ãƒ†ã‚¹ãƒˆã€è©•ä¾¡ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å›ã™ã“ã¨ã§ã€ãƒªã‚¹ã‚¯ã‚’æ—©æœŸã«ç™ºè¦‹ã—ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å¾—ãªãŒã‚‰é–‹ç™ºã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
>
> â€” Craig Larman ã€ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™ºã¨ã‚¹ã‚¯ãƒ©ãƒ ã€

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹

ã“ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã§ã€ã‚²ãƒ¼ãƒ ã®åŸºæœ¬çš„ãªæ§‹é€ ã‚’ä½œã‚Šã€å¾Œç¶šã®æ©Ÿèƒ½è¿½åŠ ã®åœŸå°ã‚’ç¯‰ãã“ã¨ãŒã§ãã¾ã™ã€‚ã§ã¯ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚µã‚¤ã‚¯ãƒ«ã«å¾“ã£ã¦ã€ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### TODOãƒªã‚¹ãƒˆ

ã•ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã€ã¾ãšã¯TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚TODOãƒªã‚¹ãƒˆã¯ã€å¤§ããªæ©Ÿèƒ½ã‚’å°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®é‡è¦ãªãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®ä¸€ã¤ã§ã™ã€‚å®Ÿè£…å‰ã«å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºã®æ–¹å‘æ€§ã‚’ä¿ã¡ã€ä½•ã‚‚è¦‹è½ã¨ã•ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
>
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ç§ãŸã¡ã®ã€Œæ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹ã€ã¨ã„ã†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ã©ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ã§ã—ã‚‡ã†ã‹ï¼Ÿè€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- [x] ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’è¡¨ç¾ã™ã‚‹æ§‹é€ ä½“ã‚’å®šç¾©ã™ã‚‹
- [x] ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹
- [ ] ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã®çŠ¶æ…‹é·ç§»ã‚’å®Ÿè£…ã™ã‚‹
- [ ] ã‚²ãƒ¼ãƒ è¨­å®šæƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹

ã“ã‚Œã‚‰ã®ã‚¿ã‚¹ã‚¯ã‚’ä¸€ã¤ãšã¤å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€å„ã‚¿ã‚¹ã‚¯ã«å¯¾ã—ã¦ãƒ†ã‚¹ãƒˆâ†’å®Ÿè£…â†’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å›ã—ã¾ã™ã€‚ã¾ãšã¯ã€Œã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®å®šç¾©ã€ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼

### ãƒ†ã‚¹ãƒˆ: ã‚²ãƒ¼ãƒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½œæˆ

ã•ã¦ã€TODOãƒªã‚¹ãƒˆã®æœ€åˆã®ã‚¿ã‚¹ã‚¯ã€Œã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’è¡¨ç¾ã™ã‚‹æ§‹é€ ä½“ã‚’å®šç¾©ã™ã‚‹ã€ã«å–ã‚Šæ›ã‹ã‚Šã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€ã¾ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚

> ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
>
> ã„ã¤ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¹ãã ã‚ã†ã‹â€”â€”ãã‚Œã¯ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã ã€‚
>
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã§ã¯ã€ã‚²ãƒ¼ãƒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åŸºæœ¬çš„ãªå‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

`test/puyo_puyo/game_test.exs` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.GameTest do
  use ExUnit.Case
  alias PuyoPuyo.Game

  describe "new/0" do
    test "æ–°ã—ã„ã‚²ãƒ¼ãƒ æ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹" do
      game = Game.new()

      assert %Game{} = game
      assert game.mode == :start
      assert game.frame == 0
      assert game.chain_count == 0
    end
  end

  describe "initialize/1" do
    test "ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã™ã‚‹ã¨ã€å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½œæˆã•ã‚Œã‚‹" do
      game = Game.new()
      initialized_game = Game.initialize(game)

      assert initialized_game.config != nil
      assert initialized_game.stage != nil
      assert initialized_game.score != nil
      assert initialized_game.mode == :new_puyo
    end

    test "åˆæœŸåŒ–æ¸ˆã¿ã®ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã¯ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ã§ã‚ã‚‹" do
      game = Game.new()
      initialized_game = Game.initialize(game)

      # å…ƒã®ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã¯å¤‰æ›´ã•ã‚Œãªã„
      assert game.mode == :start
      assert initialized_game.mode == :new_puyo
    end
  end
end
```

ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ã€`Game`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åŸºæœ¬çš„ãªå‹•ä½œã‚’ç¢ºèªã—ã¦ã„ã¾ã™ï¼š

1. `new/0`é–¢æ•°ã§æ–°ã—ã„ã‚²ãƒ¼ãƒ æ§‹é€ ä½“ã‚’ä½œæˆã§ãã‚‹
2. `initialize/1`é–¢æ•°ã§ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã§ãã‚‹
3. åˆæœŸåŒ–å¾Œã€å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¨­å®šã•ã‚Œã‚‹
4. ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ãªã£ã¦ã„ã‚‹ï¼ˆå…ƒã®ãƒ‡ãƒ¼ã‚¿ã¯å¤‰æ›´ã•ã‚Œãªã„ï¼‰

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆRedï¼‰

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
mix test test/puyo_puyo/game_test.exs
```

å½“ç„¶ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ï¼š

```
** (CompileError) test/puyo_puyo/game_test.exs:2: module PuyoPuyo.Game is not loaded
```

ã“ã‚ŒãŒãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã€ŒRedï¼ˆèµ¤ï¼‰ã€ã®çŠ¶æ…‹ã§ã™ã€‚ã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### å®Ÿè£…: ã‚²ãƒ¼ãƒ æ§‹é€ ä½“ã®å®šç¾©

ã¾ãšã€`lib/puyo_puyo/game.ex` ã‚’ä½œæˆã—ã¦ã‚²ãƒ¼ãƒ æ§‹é€ ä½“ã‚’å®šç¾©ã—ã¾ã™ï¼š

```elixir
defmodule PuyoPuyo.Game do
  @moduledoc """
  ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

  ã‚²ãƒ¼ãƒ å…¨ä½“ã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã€ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®åˆ¶å¾¡ã‚’è¡Œã„ã¾ã™ã€‚
  """

  @type game_mode ::
          :start
          | :check_fall
          | :fall
          | :check_erase
          | :erasing
          | :new_puyo
          | :playing
          | :game_over

  @type t :: %__MODULE__{
          mode: game_mode(),
          frame: non_neg_integer(),
          chain_count: non_neg_integer(),
          config: map() | nil,
          stage: map() | nil,
          score: map() | nil
        }

  defstruct mode: :start,
            frame: 0,
            chain_count: 0,
            config: nil,
            stage: nil,
            score: nil

  @doc """
  æ–°ã—ã„ã‚²ãƒ¼ãƒ æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

  ## Examples

      iex> game = PuyoPuyo.Game.new()
      iex> game.mode
      :start

  """
  @spec new() :: t()
  def new do
    %__MODULE__{}
  end

  @doc """
  ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

  å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆè¨­å®šã€ã‚¹ãƒ†ãƒ¼ã‚¸ã€ã‚¹ã‚³ã‚¢ï¼‰ã‚’ä½œæˆã—ã€
  ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’ `:new_puyo` ã«è¨­å®šã—ã¾ã™ã€‚

  ## Parameters

    - game: åˆæœŸåŒ–ã™ã‚‹ã‚²ãƒ¼ãƒ æ§‹é€ ä½“

  ## Returns

    åˆæœŸåŒ–ã•ã‚ŒãŸã‚²ãƒ¼ãƒ æ§‹é€ ä½“

  ## Examples

      iex> game = PuyoPuyo.Game.new()
      iex> initialized = PuyoPuyo.Game.initialize(game)
      iex> initialized.mode
      :new_puyo

  """
  @spec initialize(t()) :: t()
  def initialize(%__MODULE__{} = game) do
    # å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆæœŸåŒ–ï¼ˆç¾æ™‚ç‚¹ã§ã¯ä»®å®Ÿè£…ï¼‰
    config = %{rows: 12, cols: 6, puyo_size: 32}
    stage = %{grid: [], rows: 12, cols: 6}
    score = %{current: 0, chain: 0}

    # æ–°ã—ã„ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’è¿”ã™ï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ï¼‰
    %{game | config: config, stage: stage, score: score, mode: :new_puyo}
  end
end
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆGreenï¼‰

ã‚‚ã†ä¸€åº¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
mix test test/puyo_puyo/game_test.exs
```

çµæœï¼š

```
...

Finished in 0.05 seconds
3 tests, 0 failures
```

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã€‚ã“ã‚ŒãŒãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã€ŒGreenï¼ˆç·‘ï¼‰ã€ã®çŠ¶æ…‹ã§ã™ã€‚

### è§£èª¬: Elixirã®ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ 

ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼å®Ÿè£…ã—ãŸã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã€å°‘ã—è§£èª¬ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

#### æ§‹é€ ä½“ï¼ˆStructï¼‰ã®å®šç¾©

Elixirã§ã¯ã€`defstruct`ã‚’ä½¿ã£ã¦æ§‹é€ ä½“ã‚’å®šç¾©ã—ã¾ã™ï¼š

```elixir
defstruct mode: :start,
          frame: 0,
          chain_count: 0,
          config: nil,
          stage: nil,
          score: nil
```

ã“ã‚Œã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨€èªã®ã‚¯ãƒ©ã‚¹ã«ä¼¼ã¦ã„ã¾ã™ãŒã€é‡è¦ãªé•ã„ãŒã‚ã‚Šã¾ã™ï¼š

- **ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«**: ä¸€åº¦ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã¯å¤‰æ›´ã§ãã¾ã›ã‚“
- **ãƒ‡ãƒ¼ã‚¿ã¨æŒ¯ã‚‹èˆã„ã®åˆ†é›¢**: ãƒ‡ãƒ¼ã‚¿ï¼ˆæ§‹é€ ä½“ï¼‰ã¨æŒ¯ã‚‹èˆã„ï¼ˆé–¢æ•°ï¼‰ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™

#### å‹æŒ‡å®šï¼ˆType Specificationï¼‰

Elixirã§ã¯ã€`@type`ã¨`@spec`ã‚’ä½¿ã£ã¦å‹ã‚’æŒ‡å®šã§ãã¾ã™ï¼š

```elixir
@type game_mode :: :start | :check_fall | :fall | ...
@type t :: %__MODULE__{...}

@spec new() :: t()
@spec initialize(t()) :: t()
```

ã“ã‚Œã«ã‚ˆã‚Šï¼š
- ã‚³ãƒ¼ãƒ‰ã®æ„å›³ãŒæ˜ç¢ºã«ãªã‚‹
- Dialyzerï¼ˆé™çš„è§£æãƒ„ãƒ¼ãƒ«ï¼‰ã§å‹ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡ºã§ãã‚‹
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆæ™‚ã«å‹æƒ…å ±ãŒå«ã¾ã‚Œã‚‹

#### ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªæ›´æ–°

`initialize/1`é–¢æ•°ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```elixir
def initialize(%__MODULE__{} = game) do
  config = %{...}
  stage = %{...}
  score = %{...}

  # æ–°ã—ã„ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’è¿”ã™
  %{game | config: config, stage: stage, score: score, mode: :new_puyo}
end
```

`%{game | ...}`ã¨ã„ã†æ§‹æ–‡ã¯ã€**æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¸€éƒ¨ã‚’æ›´æ–°ã—ãŸæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ**ã—ã¾ã™ã€‚å…ƒã®`game`ã¯å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ã€‚

ã“ã‚ŒãŒElixirã®å¼·åŠ›ãªç‰¹æ€§ã§ã™ï¼š

```elixir
game1 = Game.new()              # mode: :start
game2 = Game.initialize(game1)  # mode: :new_puyo
# game1.mode ã¯ã¾ã  :start ã®ã¾ã¾ï¼
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã«ã‚ˆã‚‹å‹ãƒã‚§ãƒƒã‚¯

é–¢æ•°å®šç¾©ã§`%__MODULE__{} = game`ã¨ã„ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ã£ã¦ã„ã¾ã™ï¼š

```elixir
def initialize(%__MODULE__{} = game) do
```

ã“ã‚Œã¯ï¼š
- å¼•æ•°ãŒ`Game`æ§‹é€ ä½“ã§ã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼
- é–“é•ã£ãŸå‹ãŒæ¸¡ã•ã‚Œã‚‹ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
- è‡ªå·±æ–‡æ›¸åŒ–ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰

### ã‚³ãƒŸãƒƒãƒˆ

ã§ã¯ã€ã“ã“ã¾ã§ã®å®Ÿè£…ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¾ã—ã‚‡ã†ï¼š

```bash
# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ç¢ºèª
mix test

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨å“è³ªãƒã‚§ãƒƒã‚¯
mix format
mix check

# ã‚³ãƒŸãƒƒãƒˆ
git add lib/puyo_puyo/game.ex test/puyo_puyo/game_test.exs
git commit -m "feat: ã‚²ãƒ¼ãƒ æ§‹é€ ä½“ã¨åˆæœŸåŒ–æ©Ÿèƒ½ã‚’å®Ÿè£…

- Gameæ§‹é€ ä½“ã®å®šç¾©ï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªã‚²ãƒ¼ãƒ çŠ¶æ…‹ï¼‰
- new/0é–¢æ•°ã§æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’ä½œæˆ
- initialize/1é–¢æ•°ã§ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–
- å‹æŒ‡å®šã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
- ExUnitã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆå®Ÿè£…

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1ã®åŸºç›¤ãŒå®Œæˆ"
```

### Refactor: å‹å®‰å…¨æ€§ã®å‘ä¸Š

ã•ã¦ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸãŒã€ã‚³ãƒ¼ãƒ‰ã‚’ã‚‚ã†å°‘ã—æ”¹å–„ã§ããã†ã§ã™ã€‚ç¾åœ¨ã€`config`ã€`stage`ã€`score`ã¯å˜ãªã‚‹`map()`ã¨ã—ã¦æ‰±ã£ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚‰ã‚‚å°‚ç”¨ã®æ§‹é€ ä½“ã«ã—ãŸæ–¹ãŒå‹å®‰å…¨æ€§ãŒé«˜ã¾ã‚Šã¾ã™ã€‚

ã—ã‹ã—ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®åŸå‰‡ã«å¾“ã„ã€**ã¾ãšã¯å‹•ãã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã‹ã‚‰æ”¹å–„ã™ã‚‹**ã¨ã„ã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å–ã‚Šã¾ã™ã€‚ã“ã®æ”¹å–„ã¯æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§è¡Œã„ã¾ã—ã‚‡ã†ã€‚

> ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°
>
> ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¯ã€æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å‰ã‹ã€ãƒã‚°ã‚’ä¿®æ­£ã—ãŸå¾Œã«è¡Œã†ã®ãŒè‰¯ã„ã€‚ãƒ†ã‚¹ãƒˆãŒé€šã£ã¦ã„ã‚‹çŠ¶æ…‹ã§ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã™ã‚Œã°ã€å®‰å…¨ã«æ”¹å–„ã§ãã‚‹ã€‚
>
> â€” Martin Fowler ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1ã®æŒ¯ã‚Šè¿”ã‚Š

ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§é”æˆã—ãŸã“ã¨ï¼š

âœ… ã‚²ãƒ¼ãƒ æ§‹é€ ä½“ã®å®šç¾©
âœ… åŸºæœ¬çš„ãªåˆæœŸåŒ–å‡¦ç†
âœ… ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æ¡ç”¨
âœ… å‹æŒ‡å®šã«ã‚ˆã‚‹å®‰å…¨æ€§ã®å‘ä¸Š
âœ… ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚µã‚¤ã‚¯ãƒ«å®Ÿè·µ

#### å­¦ã‚“ã ã“ã¨

1. **Elixirã®æ§‹é€ ä½“**: `defstruct`ã§ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å®šç¾©
2. **å‹æŒ‡å®š**: `@type`ã¨`@spec`ã§å‹å®‰å…¨æ€§ã‚’å‘ä¸Š
3. **ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°**: é–¢æ•°å¼•æ•°ã§å‹ã‚’ãƒã‚§ãƒƒã‚¯
4. **ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªæ›´æ–°**: `%{struct | field: value}`æ§‹æ–‡
5. **ExUnit**: Elixirã®æ¨™æº–ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

#### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

- ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ã®å®Ÿè£…
- ã‚²ãƒ¼ãƒ è¨­å®šæƒ…å ±ã®å°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–
- ã‚¹ã‚³ã‚¢ç®¡ç†ã®å°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–

ãã‚Œã§ã¯ã€Red-Green-Refactorã®ãƒªã‚ºãƒ ã§ã€ã€Œå‹•ä½œã™ã‚‹ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã€ã‚’æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ï¼

---

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2: ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‹å®‰å…¨ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2ã®ç›®æ¨™

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1ã§ã¯ã€ã‚²ãƒ¼ãƒ ã®åŸºæœ¬çš„ãªæ§‹é€ ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ã—ã‹ã—ã€`config`ã€`stage`ã€`score`ã‚’å˜ãªã‚‹`map()`ã¨ã—ã¦æ‰±ã£ã¦ã„ã¾ã—ãŸã­ã€‚ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ã“ã‚Œã‚‰ã‚’å°‚ç”¨ã®æ§‹é€ ä½“ã«åˆ†å‰²ã—ã€**å‹å®‰å…¨æ€§ã‚’é«˜ã‚ã€è²¬ä»»ã‚’æ˜ç¢ºã«ã™ã‚‹**ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚

> ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¨ã¯ã€å¤–éƒ¨ã‹ã‚‰è¦‹ãŸæŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆãšã«ã€å†…éƒ¨æ§‹é€ ã‚’æ”¹å–„ã™ã‚‹ã“ã¨ã§ã™ã€‚ãƒ†ã‚¹ãƒˆãŒé€šã£ã¦ã„ã‚‹çŠ¶æ…‹ã§è¡Œã†ã“ã¨ã§ã€å®‰å…¨ã«å“è³ªã‚’å‘ä¸Šã§ãã¾ã™ã€‚
>
> â€” Martin Fowler ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€

ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿç¾ã™ã‚‹ã“ã¨ï¼š

1. **Configæ§‹é€ ä½“**: ã‚²ãƒ¼ãƒ è¨­å®šæƒ…å ±ã®å°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
2. **Stageæ§‹é€ ä½“**: ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ã®å°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
3. **Scoreæ§‹é€ ä½“**: ã‚¹ã‚³ã‚¢ç®¡ç†ã®å°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
4. **å‹å®‰å…¨æ€§ã®å‘ä¸Š**: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ˜ç¢ºãªå‹ã‚’æŒãŸã›ã‚‹

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼š

> é–‹ç™ºè€…ã¨ã—ã¦ã€ã‚²ãƒ¼ãƒ ã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã¦ãŠã‚Šã€å‹å®‰å…¨ãªæ“ä½œãŒã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„

### TODOãƒªã‚¹ãƒˆ

- [x] Configæ§‹é€ ä½“ã‚’ä½œæˆã—ã€ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
- [x] Stageæ§‹é€ ä½“ã‚’ä½œæˆã—ã€ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
- [x] Scoreæ§‹é€ ä½“ã‚’ä½œæˆã—ã€ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
- [x] Gameæ§‹é€ ä½“ã‚’æ›´æ–°ã—ã¦å‹å®‰å…¨ãªæ§‹é€ ä½“ã‚’ä½¿ç”¨ã™ã‚‹
- [ ] ã·ã‚ˆã®ç”Ÿæˆã¨è¡¨ç¤ºæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹

ãã‚Œã§ã¯ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚µã‚¤ã‚¯ãƒ«ã«å¾“ã£ã¦ã€ä¸€ã¤ãšã¤å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ã‚¹ãƒ†ãƒƒãƒ—1: Configæ§‹é€ ä½“ã®ä½œæˆ

ã¾ãšã€ã‚²ãƒ¼ãƒ è¨­å®šæƒ…å ±ã‚’ç®¡ç†ã™ã‚‹`Config`æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆ: Configæ§‹é€ ä½“ï¼ˆRedï¼‰

`test/puyo_puyo/config_test.exs` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.ConfigTest do
  use ExUnit.Case
  alias PuyoPuyo.Config

  describe "new/0" do
    test "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§Configæ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹" do
      config = Config.new()

      assert %Config{} = config
      assert config.rows == 12
      assert config.cols == 6
      assert config.puyo_size == 32
    end
  end

  describe "new/1" do
    test "ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã§Configæ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹" do
      config = Config.new(rows: 16, cols: 8)

      assert config.rows == 16
      assert config.cols == 8
      assert config.puyo_size == 32  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    end

    test "ä¸€éƒ¨ã®è¨­å®šã ã‘ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹" do
      config = Config.new(puyo_size: 48)

      assert config.rows == 12       # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
      assert config.cols == 6        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
      assert config.puyo_size == 48
    end
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/config_test.exs
```

ã‚¨ãƒ©ãƒ¼ï¼š
```
** (CompileError) test/puyo_puyo/config_test.exs:2: module PuyoPuyo.Config is not loaded
```

#### å®Ÿè£…: Configæ§‹é€ ä½“ï¼ˆGreenï¼‰

`lib/puyo_puyo/config.ex` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.Config do
  @moduledoc """
  ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®è¨­å®šæƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

  ã‚¹ãƒ†ãƒ¼ã‚¸ã®ã‚µã‚¤ã‚ºã‚„ã·ã‚ˆã®ã‚µã‚¤ã‚ºãªã©ã€ã‚²ãƒ¼ãƒ å…¨ä½“ã®è¨­å®šã‚’ä¿æŒã—ã¾ã™ã€‚
  """

  @type t :: %__MODULE__{
          rows: pos_integer(),
          cols: pos_integer(),
          puyo_size: pos_integer()
        }

  defstruct rows: 12,
            cols: 6,
            puyo_size: 32

  @doc """
  ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§Configæ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

  ## Examples

      iex> config = PuyoPuyo.Config.new()
      iex> config.rows
      12

  """
  @spec new() :: t()
  def new do
    %__MODULE__{}
  end

  @doc """
  ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã§Configæ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

  ## Parameters

    - opts: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆå½¢å¼ã®è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³

  ## Examples

      iex> config = PuyoPuyo.Config.new(rows: 16, cols: 8)
      iex> {config.rows, config.cols}
      {16, 8}

  """
  @spec new(keyword()) :: t()
  def new(opts) when is_list(opts) do
    struct(__MODULE__, opts)
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/config_test.exs
```

çµæœï¼š
```
...

Finished in 0.03 seconds
3 tests, 0 failures
```

#### è§£èª¬: struct/2é–¢æ•°ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ

æ–°ã—ãä½¿ç”¨ã—ãŸElixirã®æ©Ÿèƒ½ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ï¼š

**struct/2é–¢æ•°**ï¼š
```elixir
struct(__MODULE__, opts)
```

`struct/2`é–¢æ•°ã¯ã€æ§‹é€ ä½“ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›´æ–°ã—ãŸæ–°ã—ã„æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚`defstruct`ã§å®šç¾©ã•ã‚Œã¦ã„ãªã„ã‚­ãƒ¼ãŒã‚ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚ã€å‹å®‰å…¨ã§ã™ã€‚

**ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ**ï¼š
```elixir
Config.new(rows: 16, cols: 8)
```

Elixirã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã¯`[{:rows, 16}, {:cols, 8}]`ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚·ãƒ¥ã‚¬ãƒ¼ã§ã™ã€‚é–¢æ•°ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°ã¨ã—ã¦åºƒãä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚

**ã‚¬ãƒ¼ãƒ‰å¥ when is_list(opts)**ï¼š
```elixir
def new(opts) when is_list(opts) do
```

ã‚¬ãƒ¼ãƒ‰å¥ã¯ã€é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹æ¡ä»¶ã‚’æŒ‡å®šã—ã¾ã™ã€‚`is_list(opts)`ã«ã‚ˆã‚Šã€å¼•æ•°ãŒãƒªã‚¹ãƒˆã§ãªã„å ´åˆã¯ã“ã®é–¢æ•°ã«ãƒãƒƒãƒã—ã¾ã›ã‚“ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—2: Stageæ§‹é€ ä½“ã®ä½œæˆ

æ¬¡ã«ã€ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç®¡ç†ã™ã‚‹`Stage`æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆ: Stageæ§‹é€ ä½“ï¼ˆRedï¼‰

`test/puyo_puyo/stage_test.exs` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.StageTest do
  use ExUnit.Case
  alias PuyoPuyo.{Config, Stage}

  setup do
    config = Config.new()
    {:ok, config: config}
  end

  describe "new/1" do
    test "Configæ§‹é€ ä½“ã‹ã‚‰Stageæ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹", %{config: config} do
      stage = Stage.new(config)

      assert %Stage{} = stage
      assert stage.rows == config.rows
      assert stage.cols == config.cols
      assert length(stage.grid) == config.rows
    end

    test "ã‚°ãƒªãƒƒãƒ‰ã¯ã™ã¹ã¦0ã§åˆæœŸåŒ–ã•ã‚Œã‚‹", %{config: config} do
      stage = Stage.new(config)

      # ã™ã¹ã¦ã®ã‚»ãƒ«ãŒ0ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      for row <- stage.grid do
        assert length(row) == config.cols
        assert Enum.all?(row, &(&1 == 0))
      end
    end
  end

  describe "get_puyo/3" do
    test "æŒ‡å®šä½ç½®ã®ã·ã‚ˆã‚’å–å¾—ã§ãã‚‹", %{config: config} do
      stage = Stage.new(config)
      stage = Stage.set_puyo(stage, 5, 10, 1)

      assert Stage.get_puyo(stage, 5, 10) == 1
    end

    test "ç¯„å›²å¤–ã®ä½ç½®ã¯nilã‚’è¿”ã™", %{config: config} do
      stage = Stage.new(config)

      assert Stage.get_puyo(stage, -1, 0) == nil
      assert Stage.get_puyo(stage, 0, -1) == nil
      assert Stage.get_puyo(stage, 100, 0) == nil
      assert Stage.get_puyo(stage, 0, 100) == nil
    end
  end

  describe "set_puyo/4" do
    test "æŒ‡å®šä½ç½®ã«ã·ã‚ˆã‚’è¨­å®šã§ãã‚‹", %{config: config} do
      stage = Stage.new(config)
      updated_stage = Stage.set_puyo(stage, 3, 5, 2)

      assert Stage.get_puyo(updated_stage, 3, 5) == 2
      # å…ƒã®stageã¯å¤‰æ›´ã•ã‚Œã¦ã„ãªã„ï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ï¼‰
      assert Stage.get_puyo(stage, 3, 5) == 0
    end

    test "ç¯„å›²å¤–ã®ä½ç½®ã«ã¯è¨­å®šã•ã‚Œãªã„", %{config: config} do
      stage = Stage.new(config)
      updated_stage = Stage.set_puyo(stage, -1, 0, 1)

      # stageã¯å¤‰æ›´ã•ã‚Œãªã„
      assert updated_stage == stage
    end
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/stage_test.exs
```

ã‚¨ãƒ©ãƒ¼ï¼š
```
** (CompileError) test/puyo_puyo/stage_test.exs:2: module PuyoPuyo.Stage is not loaded
```

#### å®Ÿè£…: Stageæ§‹é€ ä½“ï¼ˆGreenï¼‰

`lib/puyo_puyo/stage.ex` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.Stage do
  @moduledoc """
  ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ã‚’ç®¡ç†ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

  2æ¬¡å…ƒã‚°ãƒªãƒƒãƒ‰ã¨ã—ã¦ã·ã‚ˆã®é…ç½®ã‚’ç®¡ç†ã—ã€ã·ã‚ˆã®å–å¾—ãƒ»è¨­å®šæ“ä½œã‚’æä¾›ã—ã¾ã™ã€‚
  """

  alias PuyoPuyo.Config

  @type t :: %__MODULE__{
          rows: pos_integer(),
          cols: pos_integer(),
          grid: [[non_neg_integer()]]
        }

  defstruct [:rows, :cols, :grid]

  @doc """
  Configæ§‹é€ ä½“ã‹ã‚‰Stageæ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

  ã‚°ãƒªãƒƒãƒ‰ã¯ã™ã¹ã¦0ï¼ˆç©ºï¼‰ã§åˆæœŸåŒ–ã•ã‚Œã¾ã™ã€‚

  ## Parameters

    - config: ã‚²ãƒ¼ãƒ è¨­å®šæƒ…å ±

  ## Examples

      iex> config = PuyoPuyo.Config.new()
      iex> stage = PuyoPuyo.Stage.new(config)
      iex> {stage.rows, stage.cols}
      {12, 6}

  """
  @spec new(Config.t()) :: t()
  def new(%Config{} = config) do
    # 2æ¬¡å…ƒã‚°ãƒªãƒƒãƒ‰ã‚’ä½œæˆï¼ˆã™ã¹ã¦0ã§åˆæœŸåŒ–ï¼‰
    grid =
      for _row <- 1..config.rows do
        for _col <- 1..config.cols, do: 0
      end

    %__MODULE__{
      rows: config.rows,
      cols: config.cols,
      grid: grid
    }
  end

  @doc """
  æŒ‡å®šä½ç½®ã®ã·ã‚ˆã‚’å–å¾—ã—ã¾ã™ã€‚

  ## Parameters

    - stage: ã‚¹ãƒ†ãƒ¼ã‚¸æ§‹é€ ä½“
    - col: åˆ—ç•ªå·ï¼ˆ0å§‹ã¾ã‚Šï¼‰
    - row: è¡Œç•ªå·ï¼ˆ0å§‹ã¾ã‚Šï¼‰

  ## Returns

    ã·ã‚ˆã®ç¨®é¡ï¼ˆ0ã¯ç©ºï¼‰ã€‚ç¯„å›²å¤–ã®å ´åˆã¯nilã€‚

  ## Examples

      iex> config = PuyoPuyo.Config.new()
      iex> stage = PuyoPuyo.Stage.new(config)
      iex> PuyoPuyo.Stage.get_puyo(stage, 0, 0)
      0

  """
  @spec get_puyo(t(), integer(), integer()) :: non_neg_integer() | nil
  def get_puyo(%__MODULE__{} = stage, col, row) do
    with true <- row >= 0 and row < stage.rows,
         true <- col >= 0 and col < stage.cols,
         row_data <- Enum.at(stage.grid, row),
         puyo when not is_nil(puyo) <- Enum.at(row_data, col) do
      puyo
    else
      _ -> nil
    end
  end

  @doc """
  æŒ‡å®šä½ç½®ã«ã·ã‚ˆã‚’è¨­å®šã—ã¾ã™ã€‚

  ## Parameters

    - stage: ã‚¹ãƒ†ãƒ¼ã‚¸æ§‹é€ ä½“
    - col: åˆ—ç•ªå·ï¼ˆ0å§‹ã¾ã‚Šï¼‰
    - row: è¡Œç•ªå·ï¼ˆ0å§‹ã¾ã‚Šï¼‰
    - puyo_type: ã·ã‚ˆã®ç¨®é¡ï¼ˆ0ã¯ç©ºï¼‰

  ## Returns

    æ›´æ–°ã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ã‚¸æ§‹é€ ä½“ã€‚ç¯„å›²å¤–ã®å ´åˆã¯å…ƒã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ãã®ã¾ã¾è¿”ã™ã€‚

  ## Examples

      iex> config = PuyoPuyo.Config.new()
      iex> stage = PuyoPuyo.Stage.new(config)
      iex> updated = PuyoPuyo.Stage.set_puyo(stage, 3, 5, 1)
      iex> PuyoPuyo.Stage.get_puyo(updated, 3, 5)
      1

  """
  @spec set_puyo(t(), integer(), integer(), non_neg_integer()) :: t()
  def set_puyo(%__MODULE__{} = stage, col, row, puyo_type) do
    if row >= 0 and row < stage.rows and col >= 0 and col < stage.cols do
      new_grid =
        stage.grid
        |> List.update_at(row, fn row_data ->
          List.replace_at(row_data, col, puyo_type)
        end)

      %{stage | grid: new_grid}
    else
      stage
    end
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/stage_test.exs
```

çµæœï¼š
```
.....

Finished in 0.05 seconds
5 tests, 0 failures
```

#### è§£èª¬: withå¼ã¨ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒªã‚¹ãƒˆæ“ä½œ

æ–°ã—ãä½¿ç”¨ã—ãŸElixirã®æ©Ÿèƒ½ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ï¼š

**withå¼**ï¼š
```elixir
with true <- row >= 0 and row < stage.rows,
     true <- col >= 0 and col < stage.cols,
     row_data <- Enum.at(stage.grid, row),
     puyo when not is_nil(puyo) <- Enum.at(row_data, col) do
  puyo
else
  _ -> nil
end
```

`with`å¼ã¯ã€è¤‡æ•°ã®æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã‚’é€£é–ã•ã›ã‚‹ãŸã‚ã®æ§‹æ–‡ã§ã™ã€‚ã„ãšã‚Œã‹ã®æ¡ä»¶ãŒå¤±æ•—ã™ã‚‹ã¨`else`ç¯€ã«ç§»ã‚Šã¾ã™ã€‚ãƒã‚¹ãƒˆã‚’æ¸›ã‚‰ã—ã€å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

**List.update_at/3**ï¼š
```elixir
List.update_at(stage.grid, row, fn row_data ->
  List.replace_at(row_data, col, puyo_type)
end)
```

`List.update_at/3`ã¯ã€ãƒªã‚¹ãƒˆã®æŒ‡å®šä½ç½®ã®è¦ç´ ã‚’æ›´æ–°é–¢æ•°ã§å¤‰æ›ã—ãŸæ–°ã—ã„ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚å…ƒã®ãƒªã‚¹ãƒˆã¯å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ï¼‰ã€‚

**List.replace_at/3**ï¼š
```elixir
List.replace_at(row_data, col, puyo_type)
```

`List.replace_at/3`ã¯ã€ãƒªã‚¹ãƒˆã®æŒ‡å®šä½ç½®ã®è¦ç´ ã‚’æ–°ã—ã„å€¤ã§ç½®ãæ›ãˆãŸæ–°ã—ã„ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚

**ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ |>**ï¼š
```elixir
stage.grid
|> List.update_at(row, fn row_data -> ... end)
```

ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ã¯ã€å·¦è¾ºã®å€¤ã‚’å³è¾ºã®é–¢æ•°ã®ç¬¬1å¼•æ•°ã¨ã—ã¦æ¸¡ã—ã¾ã™ã€‚è¤‡æ•°ã®é–¢æ•°å‘¼ã³å‡ºã—ã‚’èª­ã¿ã‚„ã™ãé€£é–ã§ãã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—3: Scoreæ§‹é€ ä½“ã®ä½œæˆ

æœ€å¾Œã«ã€ã‚¹ã‚³ã‚¢ã‚’ç®¡ç†ã™ã‚‹`Score`æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆ: Scoreæ§‹é€ ä½“ï¼ˆRedï¼‰

`test/puyo_puyo/score_test.exs` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.ScoreTest do
  use ExUnit.Case
  alias PuyoPuyo.Score

  describe "new/0" do
    test "Scoreæ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹" do
      score = Score.new()

      assert %Score{} = score
      assert score.current == 0
      assert score.chain == 0
    end
  end

  describe "add/2" do
    test "æ¶ˆå»ã—ãŸã·ã‚ˆã®æ•°ã«å¿œã˜ã¦ã‚¹ã‚³ã‚¢ãŒåŠ ç®—ã•ã‚Œã‚‹" do
      score = Score.new()
      updated_score = Score.add(score, erase_count: 4, chain: 1)

      # åŸºæœ¬ç‚¹ = 4 Ã— 10 = 40
      assert updated_score.current == 40
      assert updated_score.chain == 1
    end

    test "é€£é–æ•°ã«å¿œã˜ã¦ãƒœãƒ¼ãƒŠã‚¹ãŒåŠ ç®—ã•ã‚Œã‚‹" do
      score = Score.new()
      updated_score = Score.add(score, erase_count: 4, chain: 2)

      # åŸºæœ¬ç‚¹ = 4 Ã— 10 = 40
      # é€£é–ãƒœãƒ¼ãƒŠã‚¹ = 2 Ã— 2 Ã— 50 = 200
      # åˆè¨ˆ = 40 + 200 = 240
      assert updated_score.current == 240
      assert updated_score.chain == 2
    end

    test "1é€£é–ã®å ´åˆã¯ãƒœãƒ¼ãƒŠã‚¹ãªã—" do
      score = Score.new()
      updated_score = Score.add(score, erase_count: 4, chain: 1)

      # åŸºæœ¬ç‚¹ã®ã¿
      assert updated_score.current == 40
    end

    test "è¤‡æ•°å›åŠ ç®—ã§ãã‚‹" do
      score = Score.new()

      score = Score.add(score, erase_count: 4, chain: 1)  # 40ç‚¹
      score = Score.add(score, erase_count: 5, chain: 2)  # 50 + 200 = 250ç‚¹

      # åˆè¨ˆ290ç‚¹
      assert score.current == 290
    end
  end

  describe "reset_chain/1" do
    test "é€£é–æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹" do
      score = Score.new()
      score = Score.add(score, erase_count: 4, chain: 3)

      reset_score = Score.reset_chain(score)

      assert reset_score.chain == 0
      assert reset_score.current == score.current  # ã‚¹ã‚³ã‚¢ã¯ç¶­æŒ
    end
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/score_test.exs
```

ã‚¨ãƒ©ãƒ¼ï¼š
```
** (CompileError) test/puyo_puyo/score_test.exs:2: module PuyoPuyo.Score is not loaded
```

#### å®Ÿè£…: Scoreæ§‹é€ ä½“ï¼ˆGreenï¼‰

`lib/puyo_puyo/score.ex` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.Score do
  @moduledoc """
  ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®ã‚¹ã‚³ã‚¢ã‚’ç®¡ç†ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

  ã‚¹ã‚³ã‚¢è¨ˆç®—ã®ãƒ­ã‚¸ãƒƒã‚¯ã¨é€£é–æ•°ã®ç®¡ç†ã‚’è¡Œã„ã¾ã™ã€‚
  """

  @type t :: %__MODULE__{
          current: non_neg_integer(),
          chain: non_neg_integer()
        }

  defstruct current: 0,
            chain: 0

  @doc """
  æ–°ã—ã„Scoreæ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

  ## Examples

      iex> score = PuyoPuyo.Score.new()
      iex> score.current
      0

  """
  @spec new() :: t()
  def new do
    %__MODULE__{}
  end

  @doc """
  æ¶ˆå»ã—ãŸã·ã‚ˆã®æ•°ã¨é€£é–æ•°ã«å¿œã˜ã¦ã‚¹ã‚³ã‚¢ã‚’åŠ ç®—ã—ã¾ã™ã€‚

  ã‚¹ã‚³ã‚¢è¨ˆç®—å¼ï¼š
  - åŸºæœ¬ç‚¹ = æ¶ˆå»æ•° Ã— 10
  - é€£é–ãƒœãƒ¼ãƒŠã‚¹ = é€£é–æ•° Ã— é€£é–æ•° Ã— 50 ï¼ˆ2é€£é–ä»¥ä¸Šï¼‰
  - ç²å¾—ç‚¹ = åŸºæœ¬ç‚¹ + é€£é–ãƒœãƒ¼ãƒŠã‚¹

  ## Parameters

    - score: Scoreæ§‹é€ ä½“
    - opts: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ
      - erase_count: æ¶ˆå»ã—ãŸã·ã‚ˆã®æ•°
      - chain: ç¾åœ¨ã®é€£é–æ•°

  ## Examples

      iex> score = PuyoPuyo.Score.new()
      iex> updated = PuyoPuyo.Score.add(score, erase_count: 4, chain: 2)
      iex> updated.current
      240

  """
  @spec add(t(), keyword()) :: t()
  def add(%__MODULE__{} = score, opts) do
    erase_count = Keyword.fetch!(opts, :erase_count)
    chain = Keyword.fetch!(opts, :chain)

    base_points = erase_count * 10
    chain_bonus = if chain > 1, do: chain * chain * 50, else: 0
    earned_points = base_points + chain_bonus

    %{score | current: score.current + earned_points, chain: chain}
  end

  @doc """
  é€£é–æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚

  é€£é–ãŒçµ‚äº†ã—ãŸã¨ãã«å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚

  ## Parameters

    - score: Scoreæ§‹é€ ä½“

  ## Examples

      iex> score = PuyoPuyo.Score.new()
      iex> score = PuyoPuyo.Score.add(score, erase_count: 4, chain: 3)
      iex> reset = PuyoPuyo.Score.reset_chain(score)
      iex> reset.chain
      0

  """
  @spec reset_chain(t()) :: t()
  def reset_chain(%__MODULE__{} = score) do
    %{score | chain: 0}
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/score_test.exs
```

çµæœï¼š
```
.....

Finished in 0.04 seconds
5 tests, 0 failures
```

#### è§£èª¬: Keyword.fetch!/2

æ–°ã—ãä½¿ç”¨ã—ãŸElixirã®æ©Ÿèƒ½ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ï¼š

**Keyword.fetch!/2**ï¼š
```elixir
erase_count = Keyword.fetch!(opts, :erase_count)
chain = Keyword.fetch!(opts, :chain)
```

`Keyword.fetch!/2`ã¯ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‹ã‚‰æŒ‡å®šã•ã‚ŒãŸã‚­ãƒ¼ã®å€¤ã‚’å–å¾—ã—ã¾ã™ã€‚ã‚­ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å­˜åœ¨ã‚’ä¿è¨¼ã§ãã¾ã™ã€‚

`!`ãŒä»˜ã„ã¦ã„ã‚‹é–¢æ•°ã¯ã€ã‚¨ãƒ©ãƒ¼æ™‚ã«ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã‚‹æ…£ç¿’ãŒã‚ã‚Šã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—4: Gameæ§‹é€ ä½“ã®æ›´æ–°

ã“ã‚Œã§3ã¤ã®æ§‹é€ ä½“ãŒå®Œæˆã—ã¾ã—ãŸã€‚æœ€å¾Œã«ã€`Game`æ§‹é€ ä½“ã‚’æ›´æ–°ã—ã¦å‹å®‰å…¨ãªæ§‹é€ ä½“ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆ: å‹å®‰å…¨ãªGameæ§‹é€ ä½“ï¼ˆRedï¼‰

`test/puyo_puyo/game_test.exs` ã«æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ï¼š

```elixir
# æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆã®å¾Œã«è¿½åŠ 

describe "initialize/1 with type-safe structs" do
  test "å‹å®‰å…¨ãªæ§‹é€ ä½“ã§åˆæœŸåŒ–ã•ã‚Œã‚‹" do
    game = Game.new()
    initialized_game = Game.initialize(game)

    # Configæ§‹é€ ä½“ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    assert %PuyoPuyo.Config{} = initialized_game.config
    assert initialized_game.config.rows == 12
    assert initialized_game.config.cols == 6

    # Stageæ§‹é€ ä½“ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    assert %PuyoPuyo.Stage{} = initialized_game.stage
    assert initialized_game.stage.rows == 12
    assert initialized_game.stage.cols == 6

    # Scoreæ§‹é€ ä½“ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    assert %PuyoPuyo.Score{} = initialized_game.score
    assert initialized_game.score.current == 0
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/game_test.exs
```

ã‚¨ãƒ©ãƒ¼ï¼š
```
1) test initialize/1 with type-safe structs å‹å®‰å…¨ãªæ§‹é€ ä½“ã§åˆæœŸåŒ–ã•ã‚Œã‚‹ (PuyoPuyo.GameTest)
```

#### å®Ÿè£…: å‹å®‰å…¨ãªGameæ§‹é€ ä½“ï¼ˆGreenï¼‰

`lib/puyo_puyo/game.ex` ã‚’æ›´æ–°ï¼š

```elixir
defmodule PuyoPuyo.Game do
  @moduledoc """
  ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

  ã‚²ãƒ¼ãƒ å…¨ä½“ã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã€ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®åˆ¶å¾¡ã‚’è¡Œã„ã¾ã™ã€‚
  """

  alias PuyoPuyo.{Config, Stage, Score}

  @type game_mode ::
          :start
          | :check_fall
          | :fall
          | :check_erase
          | :erasing
          | :new_puyo
          | :playing
          | :game_over

  @type t :: %__MODULE__{
          mode: game_mode(),
          frame: non_neg_integer(),
          chain_count: non_neg_integer(),
          config: Config.t() | nil,
          stage: Stage.t() | nil,
          score: Score.t() | nil
        }

  defstruct mode: :start,
            frame: 0,
            chain_count: 0,
            config: nil,
            stage: nil,
            score: nil

  @doc """
  æ–°ã—ã„ã‚²ãƒ¼ãƒ æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

  ## Examples

      iex> game = PuyoPuyo.Game.new()
      iex> game.mode
      :start

  """
  @spec new() :: t()
  def new do
    %__MODULE__{}
  end

  @doc """
  ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

  å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆè¨­å®šã€ã‚¹ãƒ†ãƒ¼ã‚¸ã€ã‚¹ã‚³ã‚¢ï¼‰ã‚’ä½œæˆã—ã€
  ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’ `:new_puyo` ã«è¨­å®šã—ã¾ã™ã€‚

  ## Parameters

    - game: åˆæœŸåŒ–ã™ã‚‹ã‚²ãƒ¼ãƒ æ§‹é€ ä½“

  ## Returns

    åˆæœŸåŒ–ã•ã‚ŒãŸã‚²ãƒ¼ãƒ æ§‹é€ ä½“

  ## Examples

      iex> game = PuyoPuyo.Game.new()
      iex> initialized = PuyoPuyo.Game.initialize(game)
      iex> initialized.mode
      :new_puyo

  """
  @spec initialize(t()) :: t()
  def initialize(%__MODULE__{} = game) do
    # å‹å®‰å…¨ãªæ§‹é€ ä½“ã§åˆæœŸåŒ–
    config = Config.new()
    stage = Stage.new(config)
    score = Score.new()

    %{game | config: config, stage: stage, score: score, mode: :new_puyo}
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test
```

çµæœï¼š
```
...............

Finished in 0.12 seconds
16 tests, 0 failures
```

å…¨ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼

#### è§£èª¬: aliasã«ã‚ˆã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã®çŸ­ç¸®

**alias**ï¼š
```elixir
alias PuyoPuyo.{Config, Stage, Score}
```

`alias`ã¯ã€é•·ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‚’çŸ­ç¸®ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`PuyoPuyo.Config`ã‚’å˜ã«`Config`ã¨ã—ã¦å‚ç…§ã§ãã¾ã™ã€‚

ä¸­æ‹¬å¼§`{}`ã‚’ä½¿ã†ã“ã¨ã§ã€è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä¸€åº¦ã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã§ãã¾ã™ã€‚

### ã‚³ãƒŸãƒƒãƒˆ

ã§ã¯ã€ã“ã“ã¾ã§ã®å®Ÿè£…ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¾ã—ã‚‡ã†ï¼š

```bash
# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ç¢ºèª
mix test

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨å“è³ªãƒã‚§ãƒƒã‚¯
mix format
mix check

# ã‚³ãƒŸãƒƒãƒˆ
git add lib/puyo_puyo/ test/puyo_puyo/
git commit -m "feat: ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹å®‰å…¨ãªæ§‹é€ ä½“ã«åˆ†å‰²

- Configæ§‹é€ ä½“ã‚’ä½œæˆï¼ˆã‚²ãƒ¼ãƒ è¨­å®šæƒ…å ±ã®ç®¡ç†ï¼‰
- Stageæ§‹é€ ä½“ã‚’ä½œæˆï¼ˆ2æ¬¡å…ƒã‚°ãƒªãƒƒãƒ‰ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç®¡ç†ï¼‰
- Scoreæ§‹é€ ä½“ã‚’ä½œæˆï¼ˆã‚¹ã‚³ã‚¢è¨ˆç®—ã¨é€£é–ç®¡ç†ï¼‰
- Gameæ§‹é€ ä½“ã‚’æ›´æ–°ï¼ˆå‹å®‰å…¨ãªæ§‹é€ ä½“ã‚’ä½¿ç”¨ï¼‰
- å„æ§‹é€ ä½“ã«å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…
- Elixirã®é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’æ´»ç”¨
  - struct/2ã«ã‚ˆã‚‹æŸ”è»Ÿãªæ§‹é€ ä½“ä½œæˆ
  - withã«ã‚ˆã‚‹æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã®é€£é–
  - ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒªã‚¹ãƒˆæ“ä½œ

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2ã®å‹å®‰å…¨ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒå®Œäº†"
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2ã®æŒ¯ã‚Šè¿”ã‚Š

ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§é”æˆã—ãŸã“ã¨ï¼š

âœ… Configæ§‹é€ ä½“ã®ä½œæˆã¨ãƒ†ã‚¹ãƒˆ
âœ… Stageæ§‹é€ ä½“ã®ä½œæˆã¨ãƒ†ã‚¹ãƒˆ
âœ… Scoreæ§‹é€ ä½“ã®ä½œæˆã¨ãƒ†ã‚¹ãƒˆ
âœ… Gameæ§‹é€ ä½“ã®å‹å®‰å…¨ãªæ›´æ–°
âœ… 16å€‹ã®ãƒ†ã‚¹ãƒˆã™ã¹ã¦ãƒ‘ã‚¹

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
puyo_puyo/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ puyo_puyo/
â”‚       â”œâ”€â”€ game.ex          # ã‚²ãƒ¼ãƒ å…¨ä½“ã®ç®¡ç†
â”‚       â”œâ”€â”€ config.ex        # è¨­å®šæƒ…å ±
â”‚       â”œâ”€â”€ stage.ex         # ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
â”‚       â””â”€â”€ score.ex         # ã‚¹ã‚³ã‚¢ç®¡ç†
â”œâ”€â”€ test/
â”‚   â””â”€â”€ puyo_puyo/
â”‚       â”œâ”€â”€ game_test.exs    # ã‚²ãƒ¼ãƒ ã®ãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ config_test.exs  # è¨­å®šã®ãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ stage_test.exs   # ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ score_test.exs   # ã‚¹ã‚³ã‚¢ã®ãƒ†ã‚¹ãƒˆ
```

#### å­¦ã‚“ã ã“ã¨

1. **struct/2é–¢æ•°**: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‹ã‚‰æ§‹é€ ä½“ã‚’æŸ”è»Ÿã«ä½œæˆ
2. **withå¼**: è¤‡æ•°ã®æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã‚’èª­ã¿ã‚„ã™ãé€£é–
3. **ã‚¬ãƒ¼ãƒ‰å¥**: é–¢æ•°ã®å®Ÿè¡Œæ¡ä»¶ã‚’å‹ãƒ¬ãƒ™ãƒ«ã§åˆ¶ç´„
4. **ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒªã‚¹ãƒˆæ“ä½œ**: List.update_at/3ã¨List.replace_at/3
5. **alias**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‚’çŸ­ç¸®ã—ã¦å¯èª­æ€§å‘ä¸Š
6. **Keyword.fetch!/2**: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å­˜åœ¨ã‚’ä¿è¨¼

#### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½œæˆï¼ˆã·ã‚ˆã®ç”Ÿæˆã¨æ“ä½œï¼‰
- ã·ã‚ˆã®ç§»å‹•ã¨å›è»¢æ©Ÿèƒ½
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã®å‡¦ç†
- ã·ã‚ˆã®è‡ªç”±è½ä¸‹

ãã‚Œã§ã¯ã€Red-Green-Refactorã®ãƒªã‚ºãƒ ã§ã€ã€Œå‹•ä½œã™ã‚‹ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã€ã‚’æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ï¼

---

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã·ã‚ˆã®å›è»¢

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3ã®ç›®æ¨™

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2ã§ã¯ã€ã‚²ãƒ¼ãƒ ã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹å®‰å…¨ãªæ§‹é€ ä½“ã«åˆ†å‰²ã—ã¾ã—ãŸã€‚ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€**ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ“ä½œã‚’ç®¡ç†ã™ã‚‹Playerãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**ã‚’ä½œæˆã—ã€ç‰¹ã«ã·ã‚ˆã®å›è»¢æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

> ã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã®ä¸€ã¤ã¯ã€ã·ã‚ˆã‚’å›è»¢ã•ã›ã¦æ€ã„é€šã‚Šã®å ´æ‰€ã«é…ç½®ã™ã‚‹ã“ã¨ã§ã™ã€‚å›è»¢æ©Ÿèƒ½ã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæˆ¦ç•¥çš„ã«ã·ã‚ˆã‚’é…ç½®ã™ã‚‹ãŸã‚ã®é‡è¦ãªè¦ç´ ã§ã™ã€‚

ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿç¾ã™ã‚‹ã“ã¨ï¼š

1. **Playeræ§‹é€ ä½“**: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ“ä½œçŠ¶æ…‹ã¨ã·ã‚ˆãƒšã‚¢ã‚’ç®¡ç†
2. **ã·ã‚ˆãƒšã‚¢ã®ç”Ÿæˆ**: è»¸ã·ã‚ˆã¨2ã¤ç›®ã®ã·ã‚ˆã‹ã‚‰ãªã‚‹ãƒšã‚¢ã®ä½œæˆ
3. **å›è»¢æ©Ÿèƒ½**: æ™‚è¨ˆå›ã‚Šãƒ»åæ™‚è¨ˆå›ã‚Šã®å›è»¢
4. **å£ã‚­ãƒƒã‚¯å‡¦ç†**: å£éš›ã§ã®å›è»¢ã‚’å¯èƒ½ã«ã™ã‚‹ç‰¹æ®Šå‡¦ç†
5. **å¢ƒç•Œãƒã‚§ãƒƒã‚¯**: å›è»¢æ™‚ã®è¡çªåˆ¤å®š

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å›è»¢ã§ãã‚‹

### TODOãƒªã‚¹ãƒˆ

- [x] Playeræ§‹é€ ä½“ã‚’ä½œæˆã—ã€åŸºæœ¬çš„ãªçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹
- [x] ã·ã‚ˆãƒšã‚¢ã®ç”Ÿæˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹
- [x] å›è»¢æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ™‚è¨ˆå›ã‚Šãƒ»åæ™‚è¨ˆå›ã‚Šï¼‰
- [x] å£ã‚­ãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹
- [ ] ã·ã‚ˆã®ç§»å‹•æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—1: Playeræ§‹é€ ä½“ã®ä½œæˆ

ã¾ãšã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹`Player`æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆ: Playeræ§‹é€ ä½“ï¼ˆRedï¼‰

`test/puyo_puyo/player_test.exs` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.PlayerTest do
  use ExUnit.Case
  alias PuyoPuyo.{Config, Stage, Player}

  setup do
    config = Config.new()
    stage = Stage.new(config)
    {:ok, config: config, stage: stage}
  end

  describe "new/2" do
    test "Configæ§‹é€ ä½“ã¨Stageæ§‹é€ ä½“ã‹ã‚‰Playeræ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹", %{config: config, stage: stage} do
      player = Player.new(config, stage)

      assert %Player{} = player
      assert player.puyo_x == 2  # åˆæœŸä½ç½®ã¯ã‚¹ãƒ†ãƒ¼ã‚¸ä¸­å¤®
      assert player.puyo_y == 0  # åˆæœŸä½ç½®ã¯ä¸€ç•ªä¸Š
      assert player.rotation == 0  # åˆæœŸå›è»¢çŠ¶æ…‹ã¯0ï¼ˆä¸Šå‘ãï¼‰
      assert player.puyo_type == 0  # ã¾ã ã·ã‚ˆã¯ç”Ÿæˆã•ã‚Œã¦ã„ãªã„
      assert player.next_puyo_type == 0
      assert player.landed == false
    end
  end

  describe "create_puyo/1" do
    test "æ–°ã—ã„ã·ã‚ˆãƒšã‚¢ã‚’ç”Ÿæˆã™ã‚‹", %{config: config, stage: stage} do
      player = Player.new(config, stage)
      updated_player = Player.create_puyo(player)

      # ã·ã‚ˆã‚¿ã‚¤ãƒ—ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆ1-4ã®ã„ãšã‚Œã‹ï¼‰
      assert updated_player.puyo_type in 1..4
      assert updated_player.next_puyo_type in 1..4
      assert updated_player.rotation == 0
      assert updated_player.landed == false
    end

    test "ã·ã‚ˆãƒšã‚¢ã®åˆæœŸä½ç½®ãŒæ­£ã—ã„", %{config: config, stage: stage} do
      player = Player.new(config, stage)
      updated_player = Player.create_puyo(player)

      assert updated_player.puyo_x == 2  # ã‚¹ãƒ†ãƒ¼ã‚¸ä¸­å¤®
      assert updated_player.puyo_y == 0  # ä¸€ç•ªä¸Š
    end
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/player_test.exs
```

ã‚¨ãƒ©ãƒ¼ï¼š
```
** (CompileError) test/puyo_puyo/player_test.exs:2: module PuyoPuyo.Player is not loaded
```

#### å®Ÿè£…: Playeræ§‹é€ ä½“ï¼ˆGreenï¼‰

`lib/puyo_puyo/player.ex` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.Player do
  @moduledoc """
  ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ“ä½œã‚’ç®¡ç†ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

  è½ä¸‹ä¸­ã®ã·ã‚ˆãƒšã‚¢ã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã€ç§»å‹•ãƒ»å›è»¢ãªã©ã®æ“ä½œã‚’æä¾›ã—ã¾ã™ã€‚
  """

  alias PuyoPuyo.{Config, Stage}

  @initial_puyo_x 2
  @initial_puyo_y 0
  @min_puyo_type 1
  @max_puyo_type 4

  @type t :: %__MODULE__{
          config: Config.t(),
          stage: Stage.t(),
          puyo_x: integer(),
          puyo_y: integer(),
          puyo_type: non_neg_integer(),
          next_puyo_type: non_neg_integer(),
          rotation: 0..3,
          landed: boolean()
        }

  defstruct [
    :config,
    :stage,
    puyo_x: @initial_puyo_x,
    puyo_y: @initial_puyo_y,
    puyo_type: 0,
    next_puyo_type: 0,
    rotation: 0,
    landed: false
  ]

  @doc """
  æ–°ã—ã„Playeræ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

  ## Parameters

    - config: ã‚²ãƒ¼ãƒ è¨­å®šæƒ…å ±
    - stage: ã‚¹ãƒ†ãƒ¼ã‚¸æ§‹é€ ä½“

  ## Examples

      iex> config = PuyoPuyo.Config.new()
      iex> stage = PuyoPuyo.Stage.new(config)
      iex> player = PuyoPuyo.Player.new(config, stage)
      iex> player.puyo_x
      2

  """
  @spec new(Config.t(), Stage.t()) :: t()
  def new(%Config{} = config, %Stage{} = stage) do
    %__MODULE__{
      config: config,
      stage: stage
    }
  end

  @doc """
  æ–°ã—ã„ã·ã‚ˆãƒšã‚¢ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

  ãƒ©ãƒ³ãƒ€ãƒ ãªè‰²ã®ã·ã‚ˆãƒšã‚¢ï¼ˆè»¸ã·ã‚ˆã¨2ã¤ç›®ã®ã·ã‚ˆï¼‰ã‚’ç”Ÿæˆã—ã€
  åˆæœŸä½ç½®ã¨åˆæœŸå›è»¢çŠ¶æ…‹ã«è¨­å®šã—ã¾ã™ã€‚

  ## Parameters

    - player: Playeræ§‹é€ ä½“

  ## Returns

    æ›´æ–°ã•ã‚ŒãŸPlayeræ§‹é€ ä½“

  ## Examples

      iex> config = PuyoPuyo.Config.new()
      iex> stage = PuyoPuyo.Stage.new(config)
      iex> player = PuyoPuyo.Player.new(config, stage)
      iex> updated = PuyoPuyo.Player.create_puyo(player)
      iex> updated.puyo_type in 1..4
      true

  """
  @spec create_puyo(t()) :: t()
  def create_puyo(%__MODULE__{} = player) do
    %{
      player
      | puyo_x: @initial_puyo_x,
        puyo_y: @initial_puyo_y,
        puyo_type: random_puyo_type(),
        next_puyo_type: random_puyo_type(),
        rotation: 0,
        landed: false
    }
  end

  # ãƒ©ãƒ³ãƒ€ãƒ ãªã·ã‚ˆã‚¿ã‚¤ãƒ—ã‚’ç”Ÿæˆï¼ˆ1-4ï¼‰
  defp random_puyo_type do
    Enum.random(@min_puyo_type..@max_puyo_type)
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/player_test.exs
```

çµæœï¼š
```
....

Finished in 0.03 seconds
4 tests, 0 failures
```

#### è§£èª¬: ã·ã‚ˆãƒšã‚¢ã®æ¦‚å¿µ

ã·ã‚ˆã·ã‚ˆã§ã¯ã€2ã¤ã®ã·ã‚ˆãŒé€£ãªã£ãŸã€Œã·ã‚ˆãƒšã‚¢ã€ãŒè½ä¸‹ã—ã¾ã™ï¼š

**è»¸ã·ã‚ˆï¼ˆpuyo_typeï¼‰**ï¼š
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç›´æ¥åˆ¶å¾¡ã™ã‚‹ä¸­å¿ƒã®ã·ã‚ˆ
- åº§æ¨™ `(puyo_x, puyo_y)` ã«é…ç½®

**2ã¤ç›®ã®ã·ã‚ˆï¼ˆnext_puyo_typeï¼‰**ï¼š
- è»¸ã·ã‚ˆã«å¯¾ã—ã¦ç›¸å¯¾çš„ã«é…ç½®ã•ã‚Œã‚‹ã·ã‚ˆ
- å›è»¢çŠ¶æ…‹ã«ã‚ˆã£ã¦ä½ç½®ãŒå¤‰ã‚ã‚‹

**å›è»¢çŠ¶æ…‹ï¼ˆrotationï¼‰**ï¼š
- 0: 2ã¤ç›®ã®ã·ã‚ˆãŒä¸Šã«ã‚ã‚‹ï¼ˆâ†‘ï¼‰
- 1: 2ã¤ç›®ã®ã·ã‚ˆãŒå³ã«ã‚ã‚‹ï¼ˆâ†’ï¼‰
- 2: 2ã¤ç›®ã®ã·ã‚ˆãŒä¸‹ã«ã‚ã‚‹ï¼ˆâ†“ï¼‰
- 3: 2ã¤ç›®ã®ã·ã‚ˆãŒå·¦ã«ã‚ã‚‹ï¼ˆâ†ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—2: å›è»¢æ©Ÿèƒ½ã®å®Ÿè£…

æ¬¡ã«ã€ã·ã‚ˆã‚’å›è»¢ã•ã›ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆ: å›è»¢æ©Ÿèƒ½ï¼ˆRedï¼‰

`test/puyo_puyo/player_test.exs` ã«è¿½åŠ ï¼š

```elixir
describe "rotate_right/1" do
  test "æ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹ã¨ã€å›è»¢çŠ¶æ…‹ãŒ1å¢—ãˆã‚‹", %{config: config, stage: stage} do
    player =
      Player.new(config, stage)
      |> Player.create_puyo()

    initial_rotation = player.rotation
    updated_player = Player.rotate_right(player)

    assert updated_player.rotation == rem(initial_rotation + 1, 4)
  end

  test "å›è»¢çŠ¶æ…‹ãŒ3ã‹ã‚‰0ã«å¾ªç’°ã™ã‚‹", %{config: config, stage: stage} do
    player =
      Player.new(config, stage)
      |> Player.create_puyo()
      |> Map.put(:rotation, 3)

    updated_player = Player.rotate_right(player)

    assert updated_player.rotation == 0
  end
end

describe "rotate_left/1" do
  test "åæ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹ã¨ã€å›è»¢çŠ¶æ…‹ãŒ1æ¸›ã‚‹", %{config: config, stage: stage} do
    player =
      Player.new(config, stage)
      |> Player.create_puyo()

    initial_rotation = player.rotation
    updated_player = Player.rotate_left(player)

    assert updated_player.rotation == rem(initial_rotation + 3, 4)
  end

  test "å›è»¢çŠ¶æ…‹ãŒ0ã‹ã‚‰3ã«å¾ªç’°ã™ã‚‹", %{config: config, stage: stage} do
    player =
      Player.new(config, stage)
      |> Player.create_puyo()
      |> Map.put(:rotation, 0)

    updated_player = Player.rotate_left(player)

    assert updated_player.rotation == 3
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/player_test.exs
```

ã‚¨ãƒ©ãƒ¼ï¼š
```
** (UndefinedFunctionError) function PuyoPuyo.Player.rotate_right/1 is undefined
```

#### å®Ÿè£…: åŸºæœ¬çš„ãªå›è»¢æ©Ÿèƒ½ï¼ˆGreenï¼‰

`lib/puyo_puyo/player.ex` ã«è¿½åŠ ï¼š

```elixir
# 2ã¤ç›®ã®ã·ã‚ˆã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆå›è»¢çŠ¶æ…‹ã«å¿œã˜ãŸç›¸å¯¾ä½ç½®ï¼‰
# ä¸Šã€å³ã€ä¸‹ã€å·¦ã®é †
@offset_x [0, 1, 0, -1]
@offset_y [-1, 0, 1, 0]

@doc """
æ™‚è¨ˆå›ã‚Šã«å›è»¢ã—ã¾ã™ã€‚

## Parameters

  - player: Playeræ§‹é€ ä½“

## Returns

  æ›´æ–°ã•ã‚ŒãŸPlayeræ§‹é€ ä½“

## Examples

    iex> config = PuyoPuyo.Config.new()
    iex> stage = PuyoPuyo.Stage.new(config)
    iex> player = PuyoPuyo.Player.new(config, stage)
    iex> player = PuyoPuyo.Player.create_puyo(player)
    iex> rotated = PuyoPuyo.Player.rotate_right(player)
    iex> rotated.rotation
    1

"""
@spec rotate_right(t()) :: t()
def rotate_right(%__MODULE__{} = player) do
  # æ™‚è¨ˆå›ã‚Šã«å›è»¢ï¼ˆ0â†’1â†’2â†’3â†’0ï¼‰
  new_rotation = rem(player.rotation + 1, 4)
  %{player | rotation: new_rotation}
end

@doc """
åæ™‚è¨ˆå›ã‚Šã«å›è»¢ã—ã¾ã™ã€‚

## Parameters

  - player: Playeræ§‹é€ ä½“

## Returns

  æ›´æ–°ã•ã‚ŒãŸPlayeræ§‹é€ ä½“

## Examples

    iex> config = PuyoPuyo.Config.new()
    iex> stage = PuyoPuyo.Stage.new(config)
    iex> player = PuyoPuyo.Player.new(config, stage)
    iex> player = PuyoPuyo.Player.create_puyo(player)
    iex> rotated = PuyoPuyo.Player.rotate_left(player)
    iex> rotated.rotation
    3

"""
@spec rotate_left(t()) :: t()
def rotate_left(%__MODULE__{} = player) do
  # åæ™‚è¨ˆå›ã‚Šã«å›è»¢ï¼ˆ0â†’3â†’2â†’1â†’0ï¼‰
  # +3ã¯-1ã¨åŒã˜åŠ¹æœï¼ˆè² ã®æ•°ã‚’é¿ã‘ã‚‹ãŸã‚ï¼‰
  new_rotation = rem(player.rotation + 3, 4)
  %{player | rotation: new_rotation}
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/player_test.exs
```

çµæœï¼š
```
........

Finished in 0.05 seconds
8 tests, 0 failures
```

#### è§£èª¬: å‰°ä½™æ¼”ç®—ã¨å¾ªç’°

Elixirã®`rem/2`é–¢æ•°ã¯å‰°ä½™ï¼ˆremainderï¼‰ã‚’è¨ˆç®—ã—ã¾ã™ï¼š

**æ™‚è¨ˆå›ã‚Šã®å›è»¢**ï¼š
```elixir
rem(rotation + 1, 4)  # 0â†’1â†’2â†’3â†’0
```

**åæ™‚è¨ˆå›ã‚Šã®å›è»¢**ï¼š
```elixir
rem(rotation + 3, 4)  # 0â†’3â†’2â†’1â†’0
```

ãªãœ+3ãªã®ã‹ï¼Ÿ
- åæ™‚è¨ˆå›ã‚Šã¯-1ã¨åŒã˜
- ã—ã‹ã—ã€`rem(-1, 4)`ã¯`-1`ã‚’è¿”ã™å¯èƒ½æ€§ãŒã‚ã‚‹
- `rem(3, 4)`ã¯`3`ã‚’è¿”ã—ã€ã“ã‚Œã¯-1ã¨åŒç­‰ï¼ˆmod 4ï¼‰
- ã“ã‚Œã«ã‚ˆã‚Šå¸¸ã«0-3ã®ç¯„å›²å†…ã«åã¾ã‚‹

### ã‚¹ãƒ†ãƒƒãƒ—3: å£ã‚­ãƒƒã‚¯å‡¦ç†ã®å®Ÿè£…

å£éš›ã§ã®å›è»¢ã‚’å¯èƒ½ã«ã™ã‚‹ã€Œå£ã‚­ãƒƒã‚¯ã€å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆ: å£ã‚­ãƒƒã‚¯å‡¦ç†ï¼ˆRedï¼‰

`test/puyo_puyo/player_test.exs` ã«è¿½åŠ ï¼š

```elixir
describe "wall kick" do
  test "å³ç«¯ã§å³å›è»¢æ™‚ã«å·¦ã«ç§»å‹•ã™ã‚‹", %{config: config, stage: stage} do
    player =
      Player.new(config, stage)
      |> Player.create_puyo()
      |> Map.put(:puyo_x, config.cols - 1)  # å³ç«¯ã«é…ç½®
      |> Map.put(:rotation, 0)  # ä¸Šå‘ã

    # å³å›è»¢ï¼ˆ2ã¤ç›®ã®ã·ã‚ˆãŒå³ã«ãã‚‹ï¼‰
    updated_player = Player.rotate_right(player)

    # å£ã‚­ãƒƒã‚¯ã«ã‚ˆã‚Šå·¦ã«ç§»å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
    assert updated_player.puyo_x == config.cols - 2
    assert updated_player.rotation == 1
  end

  test "å·¦ç«¯ã§å·¦å›è»¢æ™‚ã«å³ã«ç§»å‹•ã™ã‚‹", %{config: config, stage: stage} do
    player =
      Player.new(config, stage)
      |> Player.create_puyo()
      |> Map.put(:puyo_x, 0)  # å·¦ç«¯ã«é…ç½®
      |> Map.put(:rotation, 0)  # ä¸Šå‘ã

    # å·¦å›è»¢ï¼ˆ2ã¤ç›®ã®ã·ã‚ˆãŒå·¦ã«ãã‚‹ï¼‰
    updated_player = Player.rotate_left(player)

    # å£ã‚­ãƒƒã‚¯ã«ã‚ˆã‚Šå³ã«ç§»å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
    assert updated_player.puyo_x == 1
    assert updated_player.rotation == 3
  end

  test "å›è»¢å¾Œã«ã‚¹ãƒ†ãƒ¼ã‚¸ä¸Šã®ã·ã‚ˆã¨è¡çªã™ã‚‹å ´åˆã¯å›è»¢ã—ãªã„", %{config: config, stage: stage} do
    # ã‚¹ãƒ†ãƒ¼ã‚¸ã«éšœå®³ç‰©ã‚’é…ç½®
    stage = Stage.set_puyo(stage, 3, 0, 1)

    player =
      Player.new(config, stage)
      |> Map.put(:stage, stage)
      |> Player.create_puyo()
      |> Map.put(:puyo_x, 2)
      |> Map.put(:rotation, 0)

    initial_rotation = player.rotation

    # å³å›è»¢ã‚’è©¦ã¿ã‚‹ï¼ˆ2ã¤ç›®ã®ã·ã‚ˆãŒcol=3ã«ç§»å‹•ã—ã‚ˆã†ã¨ã™ã‚‹ï¼‰
    updated_player = Player.rotate_right(player)

    # è¡çªã™ã‚‹ãŸã‚å›è»¢ã§ããªã„
    assert updated_player.rotation == initial_rotation
  end
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/player_test.exs
```

ã‚¨ãƒ©ãƒ¼ï¼šãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã™ï¼ˆå£ã‚­ãƒƒã‚¯å‡¦ç†ãŒã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ãªã„ãŸã‚ï¼‰ã€‚

#### å®Ÿè£…: å£ã‚­ãƒƒã‚¯å‡¦ç†ï¼ˆGreenï¼‰

`lib/puyo_puyo/player.ex` ã‚’æ›´æ–°ï¼š

```elixir
@spec rotate_right(t()) :: t()
def rotate_right(%__MODULE__{} = player) do
  # æ™‚è¨ˆå›ã‚Šã«å›è»¢ï¼ˆ0â†’1â†’2â†’3â†’0ï¼‰
  new_rotation = rem(player.rotation + 1, 4)

  # å›è»¢å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
  if can_rotate?(player, new_rotation) do
    # å£ã‚­ãƒƒã‚¯å‡¦ç†ã‚’é©ç”¨
    apply_wall_kick(player, new_rotation)
  else
    player  # å›è»¢ã§ããªã„å ´åˆã¯å…ƒã®çŠ¶æ…‹ã‚’è¿”ã™
  end
end

@spec rotate_left(t()) :: t()
def rotate_left(%__MODULE__{} = player) do
  # åæ™‚è¨ˆå›ã‚Šã«å›è»¢ï¼ˆ0â†’3â†’2â†’1â†’0ï¼‰
  new_rotation = rem(player.rotation + 3, 4)

  # å›è»¢å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
  if can_rotate?(player, new_rotation) do
    # å£ã‚­ãƒƒã‚¯å‡¦ç†ã‚’é©ç”¨
    apply_wall_kick(player, new_rotation)
  else
    player  # å›è»¢ã§ããªã„å ´åˆã¯å…ƒã®çŠ¶æ…‹ã‚’è¿”ã™
  end
end

# å›è»¢å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
defp can_rotate?(%__MODULE__{} = player, new_rotation) do
  # 2ã¤ç›®ã®ã·ã‚ˆã®æ–°ã—ã„ä½ç½®ã‚’è¨ˆç®—
  next_x = player.puyo_x + Enum.at(@offset_x, new_rotation)
  next_y = player.puyo_y + Enum.at(@offset_y, new_rotation)

  # å£ã‚­ãƒƒã‚¯å¾Œã®ä½ç½®ã‚’è¨ˆç®—
  {kicked_puyo_x, kicked_next_x} = calculate_wall_kick(player, next_x)

  # Xåº§æ¨™ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯
  x_in_range =
    kicked_puyo_x >= 0 and kicked_puyo_x < player.config.cols and
      kicked_next_x >= 0 and kicked_next_x < player.config.cols

  # Yåº§æ¨™ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯
  y_in_range = next_y >= 0 and next_y < player.config.rows

  # æ—¢å­˜ã®ã·ã‚ˆã¨ã®è¡çªãƒã‚§ãƒƒã‚¯
  puyo_collision =
    if player.puyo_y >= 0 and player.puyo_y < player.config.rows do
      Stage.get_puyo(player.stage, kicked_puyo_x, player.puyo_y) == 0
    else
      true
    end

  next_puyo_collision =
    if y_in_range do
      Stage.get_puyo(player.stage, kicked_next_x, next_y) == 0
    else
      true
    end

  x_in_range and puyo_collision and next_puyo_collision
end

# å£ã‚­ãƒƒã‚¯å‡¦ç†ã‚’é©ç”¨
defp apply_wall_kick(%__MODULE__{} = player, new_rotation) do
  # 2ã¤ç›®ã®ã·ã‚ˆã®æ–°ã—ã„ä½ç½®ã‚’è¨ˆç®—
  next_x = player.puyo_x + Enum.at(@offset_x, new_rotation)

  # å£ã‚­ãƒƒã‚¯å¾Œã®ä½ç½®ã‚’è¨ˆç®—
  {kicked_puyo_x, _kicked_next_x} = calculate_wall_kick(player, next_x)

  %{player | rotation: new_rotation, puyo_x: kicked_puyo_x}
end

# å£ã‚­ãƒƒã‚¯ã®ä½ç½®èª¿æ•´ã‚’è¨ˆç®—
defp calculate_wall_kick(player, next_x) do
  puyo_x = player.puyo_x

  # å³ç«¯ã§å³å›è»¢ã—ãŸå ´åˆï¼ˆ2ã¤ç›®ã®ã·ã‚ˆãŒå³ã«ãã‚‹å ´åˆï¼‰
  puyo_x =
    if next_x >= player.config.cols do
      puyo_x - 1  # å·¦ã«ç§»å‹•ï¼ˆå£ã‚­ãƒƒã‚¯ï¼‰
    else
      puyo_x
    end

  # å·¦ç«¯ã§å·¦å›è»¢ã—ãŸå ´åˆï¼ˆ2ã¤ç›®ã®ã·ã‚ˆãŒå·¦ã«ãã‚‹å ´åˆï¼‰
  puyo_x =
    if next_x < 0 do
      puyo_x + 1  # å³ã«ç§»å‹•ï¼ˆå£ã‚­ãƒƒã‚¯ï¼‰
    else
      puyo_x
    end

  # å£ã‚­ãƒƒã‚¯å¾Œã®2ã¤ç›®ã®ã·ã‚ˆã®ä½ç½®ã‚’å†è¨ˆç®—
  kicked_next_x = puyo_x + Enum.at(@offset_x, Enum.at([player.rotation], 0))

  {puyo_x, kicked_next_x}
end
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/player_test.exs
```

ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`calculate_wall_kick`ã®å®Ÿè£…ã‚’ä¿®æ­£ã—ã¾ã™ï¼š

```elixir
# å£ã‚­ãƒƒã‚¯ã®ä½ç½®èª¿æ•´ã‚’è¨ˆç®—
defp calculate_wall_kick(player, next_x) do
  puyo_x = player.puyo_x

  # å³ç«¯ãƒã‚§ãƒƒã‚¯ï¼ˆ2ã¤ç›®ã®ã·ã‚ˆãŒå³ã«å‡ºã‚‹å ´åˆï¼‰
  puyo_x =
    if next_x >= player.config.cols do
      puyo_x - 1  # å·¦ã«ç§»å‹•ï¼ˆå£ã‚­ãƒƒã‚¯ï¼‰
    else
      puyo_x
    end

  # å·¦ç«¯ãƒã‚§ãƒƒã‚¯ï¼ˆ2ã¤ç›®ã®ã·ã‚ˆãŒå·¦ã«å‡ºã‚‹å ´åˆï¼‰
  puyo_x =
    if next_x < 0 do
      puyo_x + 1  # å³ã«ç§»å‹•ï¼ˆå£ã‚­ãƒƒã‚¯ï¼‰
    else
      puyo_x
    end

  {puyo_x, next_x}
end
```

å†åº¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼š

```bash
mix test test/puyo_puyo/player_test.exs
```

çµæœï¼š
```
...............

Finished in 0.08 seconds
11 tests, 0 failures
```

#### è§£èª¬: å£ã‚­ãƒƒã‚¯å‡¦ç†ã®ä»•çµ„ã¿

å£ã‚­ãƒƒã‚¯å‡¦ç†ã¯3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

**1. å›è»¢å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆcan_rotate?/2ï¼‰**ï¼š
- å›è»¢å¾Œã®ä½ç½®ã‚’è¨ˆç®—
- å£ã‚­ãƒƒã‚¯ã®ä½ç½®èª¿æ•´ã‚’é©ç”¨
- ç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯
- æ—¢å­˜ã®ã·ã‚ˆã¨ã®è¡çªã‚’ãƒã‚§ãƒƒã‚¯

**2. å£ã‚­ãƒƒã‚¯ã®ä½ç½®èª¿æ•´ã‚’è¨ˆç®—ï¼ˆcalculate_wall_kick/2ï¼‰**ï¼š
- 2ã¤ç›®ã®ã·ã‚ˆãŒå£ã‚’è¶…ãˆã‚‹å ´åˆã€è»¸ã·ã‚ˆã®ä½ç½®ã‚’èª¿æ•´
- å³ç«¯è¶…é â†’ å·¦ã«1ãƒã‚¹ç§»å‹•
- å·¦ç«¯è¶…é â†’ å³ã«1ãƒã‚¹ç§»å‹•

**3. å›è»¢ã‚’é©ç”¨ï¼ˆapply_wall_kick/2ï¼‰**ï¼š
- å›è»¢çŠ¶æ…‹ã‚’æ›´æ–°
- å£ã‚­ãƒƒã‚¯å¾Œã®ä½ç½®ã‚’é©ç”¨

### ã‚³ãƒŸãƒƒãƒˆ

ã§ã¯ã€ã“ã“ã¾ã§ã®å®Ÿè£…ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¾ã—ã‚‡ã†ï¼š

```bash
# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ç¢ºèª
mix test

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨å“è³ªãƒã‚§ãƒƒã‚¯
mix format
mix check

# ã‚³ãƒŸãƒƒãƒˆ
git add lib/puyo_puyo/player.ex test/puyo_puyo/player_test.exs
git commit -m "feat: Playeræ§‹é€ ä½“ã¨ã·ã‚ˆã®å›è»¢æ©Ÿèƒ½ã‚’å®Ÿè£…

- Playeræ§‹é€ ä½“ã®ä½œæˆï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œã®çŠ¶æ…‹ç®¡ç†ï¼‰
- ã·ã‚ˆãƒšã‚¢ã®ç”Ÿæˆæ©Ÿèƒ½ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãªè‰²ã®2ã¤ã®ã·ã‚ˆï¼‰
- å›è»¢æ©Ÿèƒ½ã®å®Ÿè£…ï¼ˆæ™‚è¨ˆå›ã‚Šãƒ»åæ™‚è¨ˆå›ã‚Šï¼‰
- å£ã‚­ãƒƒã‚¯å‡¦ç†ã®å®Ÿè£…ï¼ˆå£éš›ã§ã®å›è»¢ã‚’å¯èƒ½ã«ï¼‰
- å›è»¢æ™‚ã®è¡çªåˆ¤å®šï¼ˆæ—¢å­˜ã®ã·ã‚ˆã¨ã®è¡çªãƒã‚§ãƒƒã‚¯ï¼‰
- 11å€‹ã®ãƒ†ã‚¹ãƒˆã™ã¹ã¦ãƒ‘ã‚¹

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3ã®ã·ã‚ˆå›è»¢æ©Ÿèƒ½ãŒå®Œæˆ"
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3ã®æŒ¯ã‚Šè¿”ã‚Š

ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§é”æˆã—ãŸã“ã¨ï¼š

âœ… Playeræ§‹é€ ä½“ã®ä½œæˆ
âœ… ã·ã‚ˆãƒšã‚¢ã®ç”Ÿæˆæ©Ÿèƒ½
âœ… å›è»¢æ©Ÿèƒ½ï¼ˆæ™‚è¨ˆå›ã‚Šãƒ»åæ™‚è¨ˆå›ã‚Šï¼‰
âœ… å£ã‚­ãƒƒã‚¯å‡¦ç†
âœ… å›è»¢æ™‚ã®è¡çªåˆ¤å®š
âœ… 11å€‹ã®ãƒ†ã‚¹ãƒˆã™ã¹ã¦ãƒ‘ã‚¹

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
puyo_puyo/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ puyo_puyo/
â”‚       â”œâ”€â”€ game.ex          # ã‚²ãƒ¼ãƒ å…¨ä½“ã®ç®¡ç†
â”‚       â”œâ”€â”€ config.ex        # è¨­å®šæƒ…å ±
â”‚       â”œâ”€â”€ stage.ex         # ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
â”‚       â”œâ”€â”€ score.ex         # ã‚¹ã‚³ã‚¢ç®¡ç†
â”‚       â””â”€â”€ player.ex        # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œï¼ˆNEWï¼‰
â”œâ”€â”€ test/
â”‚   â””â”€â”€ puyo_puyo/
â”‚       â”œâ”€â”€ game_test.exs
â”‚       â”œâ”€â”€ config_test.exs
â”‚       â”œâ”€â”€ stage_test.exs
â”‚       â”œâ”€â”€ score_test.exs
â”‚       â””â”€â”€ player_test.exs   # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ†ã‚¹ãƒˆï¼ˆNEWï¼‰
```

#### å­¦ã‚“ã ã“ã¨

1. **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šæ•°ï¼ˆ@ï¼‰**: `@initial_puyo_x`ãªã©ã®å®šæ•°å®šç¾©
2. **rem/2é–¢æ•°**: å‰°ä½™æ¼”ç®—ã«ã‚ˆã‚‹å¾ªç’°å‡¦ç†
3. **Enum.at/2**: ãƒªã‚¹ãƒˆã‹ã‚‰è¦ç´ ã‚’å–å¾—
4. **Enum.random/1**: ãƒ©ãƒ³ãƒ€ãƒ ãªè¦ç´ ã®é¸æŠ
5. **Map.put/3**: æ§‹é€ ä½“ã®ä¸€æ™‚çš„ãªæ›´æ–°ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
6. **ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ã®é€£é–**: è¤‡æ•°ã®é–¢æ•°å‘¼ã³å‡ºã—ã‚’èª­ã¿ã‚„ã™ãè¨˜è¿°
7. **ã‚¬ãƒ¼ãƒ‰å¥ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°**: å‹å®‰å…¨ãªé–¢æ•°å®šç¾©

#### ã·ã‚ˆãƒšã‚¢ã¨å›è»¢ã®æ¦‚å¿µ

**ã·ã‚ˆãƒšã‚¢**ï¼š
- è»¸ã·ã‚ˆï¼ˆpuyo_typeï¼‰: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç›´æ¥åˆ¶å¾¡
- 2ã¤ç›®ã®ã·ã‚ˆï¼ˆnext_puyo_typeï¼‰: è»¸ã·ã‚ˆã«å¯¾ã—ã¦ç›¸å¯¾çš„ã«é…ç½®

**å›è»¢çŠ¶æ…‹ï¼ˆrotationï¼‰**ï¼š
```
0: â†‘ (2ã¤ç›®ã®ã·ã‚ˆãŒä¸Š)
1: â†’ (2ã¤ç›®ã®ã·ã‚ˆãŒå³)
2: â†“ (2ã¤ç›®ã®ã·ã‚ˆãŒä¸‹)
3: â† (2ã¤ç›®ã®ã·ã‚ˆãŒå·¦)
```

**ã‚ªãƒ•ã‚»ãƒƒãƒˆé…åˆ—**ï¼š
```elixir
@offset_x [0, 1, 0, -1]  # Xæ–¹å‘ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
@offset_y [-1, 0, 1, 0]  # Yæ–¹å‘ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
```

### ã‚¹ãƒ†ãƒƒãƒ—4: ç”»é¢è¡¨ç¤ºã¨ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®å®Ÿè£…

ã·ã‚ˆã®å›è»¢æ©Ÿèƒ½ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚æ¬¡ã«ã€ã‚²ãƒ¼ãƒ ã‚’å®Ÿéš›ã«å‹•ã‹ã™ãŸã‚ã®**ç”»é¢è¡¨ç¤ºã¨ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—**ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

> ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã¯ã€ã‚²ãƒ¼ãƒ ã®å¿ƒè‡“éƒ¨ã§ã™ã€‚ç¶™ç¶šçš„ã«æ›´æ–°ã¨æç”»ã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ã§ã€æ»‘ã‚‰ã‹ãªã‚²ãƒ¼ãƒ ä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚

Elixirã§ã®ã‚²ãƒ¼ãƒ é–‹ç™ºã§ã¯ã€å¾“æ¥ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰JavaScriptã¨ã¯ç•°ãªã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å–ã‚Šã¾ã™ã€‚

#### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é¸æŠ

Elixirã§ã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚Šã¾ã™ï¼š

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1: å®Œå…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰**
- JavaScriptã§ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã¨æç”»
- Elixirã¯ãƒ“ãƒ«ãƒ‰ã¨ã‚µãƒ¼ãƒ–ã®ã¿

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: Phoenix LiveView**
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§çŠ¶æ…‹ç®¡ç†
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§æç”»
- WebSocketã§åŒæ–¹å‘é€šä¿¡

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1ï¼ˆå®Œå…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼‰** ã‚’æ¡ç”¨ã—ã¾ã™ã€‚ç†ç”±ã¯ï¼š

1. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒé‡è¦ãªã‚²ãƒ¼ãƒ ã«é©ã—ã¦ã„ã‚‹
2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã®å½±éŸ¿ã‚’å—ã‘ãªã„
3. Elixirã§æ›¸ã„ãŸãƒ­ã‚¸ãƒƒã‚¯ã‚’å­¦ç¿’ç›®çš„ã§ä¿æŒ

#### Nervesã‚’ä½¿ã£ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŒ–

ã¾ãšã€Elixirãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç°¡æ˜“Webã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦å‹•ä½œã•ã›ã¾ã™ã€‚

`mix.exs` ã«Plugä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ ï¼š

```elixir
defp deps do
  [
    # æ—¢å­˜ã®ä¾å­˜é–¢ä¿‚
    {:credo, "~> 1.7", only: [:dev, :test], runtime: false},
    {:excoveralls, "~> 0.18", only: :test},
    {:mix_test_watch, "~> 1.0", only: [:dev, :test], runtime: false},
    {:ex_doc, "~> 0.31", only: :dev, runtime: false},

    # Webã‚µãƒ¼ãƒãƒ¼
    {:plug_cowboy, "~> 2.6"},
    {:jason, "~> 1.4"}
  ]
end
```

ä¾å­˜é–¢ä¿‚ã‚’å–å¾—ï¼š

```bash
mix deps.get
```

#### HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

`priv/static/index.html` ã‚’ä½œæˆï¼š

```html
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ  (Elixirç‰ˆ)</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        gap: 20px;
        padding: 20px;
        background-color: #f0f0f0;
        margin: 0;
      }

      #game-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      #game-canvas {
        border: 2px solid #333;
        background-color: #fff;
      }

      #info-panel {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        min-width: 200px;
      }

      #info-panel h2 {
        margin-top: 0;
        color: #333;
        font-size: 18px;
      }

      .info-item {
        margin: 15px 0;
      }

      .info-label {
        font-size: 14px;
        color: #666;
        margin-bottom: 5px;
      }

      .info-value {
        font-size: 28px;
        font-weight: bold;
        color: #2196F3;
      }

      .chain-value {
        color: #FF9800;
      }

      .controls {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f8f8;
        border-radius: 5px;
      }

      .controls h3 {
        margin-top: 0;
        font-size: 14px;
        color: #666;
      }

      .controls p {
        margin: 5px 0;
        font-size: 12px;
        color: #888;
      }
    </style>
  </head>
  <body>
    <div id="game-container">
      <canvas id="game-canvas" width="192" height="384"></canvas>
    </div>
    <div id="info-panel">
      <h2>ã‚²ãƒ¼ãƒ æƒ…å ±</h2>
      <div class="info-item">
        <div class="info-label">ã‚¹ã‚³ã‚¢</div>
        <div class="info-value" id="score">0</div>
      </div>
      <div class="info-item">
        <div class="info-label">é€£é–æ•°</div>
        <div class="info-value chain-value" id="chain">0</div>
      </div>
      <div class="controls">
        <h3>æ“ä½œæ–¹æ³•</h3>
        <p>â† â†’: ç§»å‹•</p>
        <p>â†‘: å›è»¢</p>
        <p>â†“: é«˜é€Ÿè½ä¸‹</p>
      </div>
    </div>
    <script src="/game.js"></script>
  </body>
</html>
```

#### JavaScriptã§ã®ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—

`priv/static/game.js` ã‚’ä½œæˆï¼š

```javascript
// ã‚²ãƒ¼ãƒ è¨­å®š
const PUYO_SIZE = 32
const COLS = 6
const ROWS = 12
const CANVAS_WIDTH = COLS * PUYO_SIZE
const CANVAS_HEIGHT = ROWS * PUYO_SIZE

// ã·ã‚ˆã®è‰²å®šç¾©
const PUYO_COLORS = [
  '#FFFFFF', // 0: ç©º
  '#FF0000', // 1: èµ¤
  '#00FF00', // 2: ç·‘
  '#0000FF', // 3: é’
  '#FFFF00'  // 4: é»„
]

// Canvasè¦ç´ ã‚’å–å¾—
const canvas = document.getElementById('game-canvas')
const ctx = canvas.getContext('2d')

// ã‚²ãƒ¼ãƒ çŠ¶æ…‹
let gameState = {
  player: {
    puyo_x: 2,
    puyo_y: 0,
    puyo_type: 1,
    next_puyo_type: 2,
    rotation: 0,
    landed: false
  },
  stage: {
    grid: Array(ROWS).fill(null).map(() => Array(COLS).fill(0))
  },
  score: {
    current: 0,
    chain: 0
  },
  inputKeys: {
    left: false,
    right: false,
    up: false,
    down: false
  }
}

// ã‚ªãƒ•ã‚»ãƒƒãƒˆé…åˆ—ï¼ˆå›è»¢çŠ¶æ…‹ã«å¿œã˜ãŸ2ã¤ç›®ã®ã·ã‚ˆã®ç›¸å¯¾ä½ç½®ï¼‰
const OFFSET_X = [0, 1, 0, -1] // ä¸Šã€å³ã€ä¸‹ã€å·¦
const OFFSET_Y = [-1, 0, 1, 0]

// ã‚­ãƒ¼å…¥åŠ›ã®å‡¦ç†
document.addEventListener('keydown', (e) => {
  switch(e.key) {
    case 'ArrowLeft':
      gameState.inputKeys.left = true
      break
    case 'ArrowRight':
      gameState.inputKeys.right = true
      break
    case 'ArrowUp':
      gameState.inputKeys.up = true
      break
    case 'ArrowDown':
      gameState.inputKeys.down = true
      break
  }
})

document.addEventListener('keyup', (e) => {
  switch(e.key) {
    case 'ArrowLeft':
      gameState.inputKeys.left = false
      break
    case 'ArrowRight':
      gameState.inputKeys.right = false
      break
    case 'ArrowUp':
      gameState.inputKeys.up = false
      break
    case 'ArrowDown':
      gameState.inputKeys.down = false
      break
  }
})

// æ›´æ–°å‡¦ç†
function update(deltaTime) {
  // ã‚­ãƒ¼å…¥åŠ›ã«å¿œã˜ãŸå‡¦ç†ï¼ˆå°†æ¥çš„ã«å®Ÿè£…ï¼‰
  if (gameState.inputKeys.up) {
    // å›è»¢å‡¦ç†
    gameState.player.rotation = (gameState.player.rotation + 1) % 4
    gameState.inputKeys.up = false
  }

  // å°†æ¥çš„ã«ã“ã“ã§ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
}

// æç”»å‡¦ç†
function render() {
  // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
  ctx.fillStyle = '#F0F0F0'
  ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT)

  // ã‚°ãƒªãƒƒãƒ‰ã¨ã‚¹ãƒ†ãƒ¼ã‚¸ã®ã·ã‚ˆã‚’æç”»
  for (let row = 0; row < ROWS; row++) {
    for (let col = 0; col < COLS; col++) {
      const x = col * PUYO_SIZE
      const y = row * PUYO_SIZE

      // ã‚°ãƒªãƒƒãƒ‰ç·š
      ctx.strokeStyle = '#E0E0E0'
      ctx.strokeRect(x, y, PUYO_SIZE, PUYO_SIZE)

      // ã‚¹ãƒ†ãƒ¼ã‚¸ä¸Šã®ã·ã‚ˆã‚’æç”»
      const puyoType = gameState.stage.grid[row][col]
      if (puyoType > 0) {
        drawPuyo(ctx, col, row, puyoType)
      }
    }
  }

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã·ã‚ˆãƒšã‚¢ã‚’æç”»
  if (!gameState.player.landed) {
    // è»¸ã·ã‚ˆ
    drawPuyo(ctx, gameState.player.puyo_x, gameState.player.puyo_y, gameState.player.puyo_type)

    // 2ã¤ç›®ã®ã·ã‚ˆ
    const offset_x = OFFSET_X[gameState.player.rotation]
    const offset_y = OFFSET_Y[gameState.player.rotation]
    const next_x = gameState.player.puyo_x + offset_x
    const next_y = gameState.player.puyo_y + offset_y

    if (next_y >= 0 && next_y < ROWS && next_x >= 0 && next_x < COLS) {
      drawPuyo(ctx, next_x, next_y, gameState.player.next_puyo_type)
    }
  }

  // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’æ›´æ–°
  document.getElementById('score').textContent = gameState.score.current
  document.getElementById('chain').textContent = gameState.score.chain
}

// ã·ã‚ˆã‚’æç”»
function drawPuyo(ctx, col, row, puyoType) {
  const x = col * PUYO_SIZE
  const y = row * PUYO_SIZE

  // ã·ã‚ˆã®æœ¬ä½“ï¼ˆå††ï¼‰
  ctx.fillStyle = PUYO_COLORS[puyoType]
  ctx.beginPath()
  ctx.arc(x + PUYO_SIZE/2, y + PUYO_SIZE/2, PUYO_SIZE/2 - 2, 0, Math.PI * 2)
  ctx.fill()

  // ã·ã‚ˆã®ç¸å–ã‚Š
  ctx.strokeStyle = '#333'
  ctx.lineWidth = 2
  ctx.stroke()

  // ã·ã‚ˆã®ç›®ï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆï¼‰
  ctx.fillStyle = 'rgba(255, 255, 255, 0.5)'
  ctx.beginPath()
  ctx.arc(x + PUYO_SIZE/2 - 5, y + PUYO_SIZE/2 - 5, 4, 0, Math.PI * 2)
  ctx.fill()
}

// ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
let lastTime = 0
function gameLoop(currentTime) {
  const deltaTime = currentTime - lastTime
  lastTime = currentTime

  update(deltaTime)
  render()

  requestAnimationFrame(gameLoop)
}

// ã‚²ãƒ¼ãƒ é–‹å§‹
requestAnimationFrame(gameLoop)
```

#### Webã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š

`lib/puyo_puyo/web_server.ex` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.WebServer do
  @moduledoc """
  ã‚²ãƒ¼ãƒ ç”»é¢ã‚’æä¾›ã™ã‚‹Webã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚
  """

  use Plug.Router

  plug(Plug.Static,
    at: "/",
    from: {:puyo_puyo, "priv/static"}
  )

  plug(:match)
  plug(:dispatch)

  get "/" do
    send_file(conn, 200, Path.join(:code.priv_dir(:puyo_puyo), "static/index.html"))
  end

  match _ do
    send_resp(conn, 404, "Not found")
  end
end
```

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•è¨­å®š

`lib/puyo_puyo/application.ex` ã‚’ä½œæˆï¼š

```elixir
defmodule PuyoPuyo.Application do
  @moduledoc false

  use Application

  @impl true
  def start(_type, _args) do
    children = [
      # Webã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
      {Plug.Cowboy, scheme: :http, plug: PuyoPuyo.WebServer, options: [port: 4000]}
    ]

    opts = [strategy: :one_for_one, name: PuyoPuyo.Supervisor]
    Supervisor.start_link(children, opts)
  end
end
```

`mix.exs` ã® `application` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ï¼š

```elixir
def application do
  [
    mod: {PuyoPuyo.Application, []},
    extra_applications: [:logger]
  ]
end
```

#### é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
# ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
mix run --no-halt

# ã¾ãŸã¯ iex ã§èµ·å‹•
iex -S mix
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:4000` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ã‚²ãƒ¼ãƒ ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼

#### è§£èª¬: ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®ä»•çµ„ã¿

**requestAnimationFrameã¨ã¯**ï¼š

ãƒ–ãƒ©ã‚¦ã‚¶ã®æç”»ã‚µã‚¤ã‚¯ãƒ«ã«åˆã‚ã›ã¦ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°ã§ã™ï¼š

```javascript
function gameLoop(currentTime) {
  // 1. ãƒ‡ãƒ«ã‚¿æ™‚é–“ã®è¨ˆç®—
  const deltaTime = currentTime - lastTime
  lastTime = currentTime

  // 2. ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®æ›´æ–°
  update(deltaTime)

  // 3. ç”»é¢ã®æç”»
  render()

  // 4. æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  requestAnimationFrame(gameLoop)
}

// ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—é–‹å§‹
requestAnimationFrame(gameLoop)
```

**ãƒ‡ãƒ«ã‚¿æ™‚é–“ï¼ˆDelta Timeï¼‰**ï¼š

å‰å›ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰ã®çµŒéæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰ã§ã™ã€‚ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§ï¼š

- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆã«ä¾å­˜ã—ãªã„å‹•ã
- ç•°ãªã‚‹ãƒ‡ãƒã‚¤ã‚¹ã§ã‚‚åŒã˜é€Ÿåº¦
- æ»‘ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

**æ›´æ–°ã¨æç”»ã®åˆ†é›¢**ï¼š

```
ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
â”‚
â”œâ”€ update(deltaTime)   â† ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆçŠ¶æ…‹å¤‰æ›´ï¼‰
â”‚  â”œâ”€ å…¥åŠ›å‡¦ç†
â”‚  â”œâ”€ ç‰©ç†æ¼”ç®—
â”‚  â”œâ”€ è¡çªåˆ¤å®š
â”‚  â””â”€ AIå‡¦ç†
â”‚
â””â”€ render()            â† æç”»å‡¦ç†ï¼ˆçŠ¶æ…‹ã‚’ç”»é¢ã«åæ˜ ï¼‰
   â”œâ”€ Canvas ã‚¯ãƒªã‚¢
   â”œâ”€ èƒŒæ™¯æç”»
   â”œâ”€ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæç”»
   â””â”€ UIæç”»
```

ã“ã®åˆ†é›¢ã«ã‚ˆã‚Šï¼š
- ãƒ­ã‚¸ãƒƒã‚¯ã¨æç”»ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãŒã—ã‚„ã™ã„
- ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§å‘ä¸Š

#### Canvasæç”»ã®åŸºæœ¬

**Canvas APIã®ä¸»ãªæ“ä½œ**ï¼š

```javascript
// çŸ©å½¢ã‚’æç”»
ctx.fillRect(x, y, width, height)
ctx.strokeRect(x, y, width, height)

// å††ã‚’æç”»
ctx.beginPath()
ctx.arc(x, y, radius, 0, Math.PI * 2)
ctx.fill()
ctx.stroke()

// è‰²ã®è¨­å®š
ctx.fillStyle = '#FF0000'    // å¡—ã‚Šã¤ã¶ã—è‰²
ctx.strokeStyle = '#000000'  // ç·šã®è‰²
ctx.lineWidth = 2            // ç·šã®å¤ªã•

// Canvaså…¨ä½“ã‚’ã‚¯ãƒªã‚¢
ctx.clearRect(0, 0, width, height)
```

**åº§æ¨™ç³»**ï¼š

```
(0,0) â”€â”€â”€â”€â”€â”€â”€â”€â–º Xè»¸
  â”‚
  â”‚
  â”‚
  â–¼
 Yè»¸
```

å·¦ä¸ŠãŒåŸç‚¹(0,0)ã§ã€å³ã¨ä¸‹ãŒæ­£ã®æ–¹å‘ã§ã™ã€‚

### ã‚³ãƒŸãƒƒãƒˆ (ç”»é¢è¡¨ç¤ºã¨ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—)

ç”»é¢è¡¨ç¤ºã¨ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®åŸºç›¤ãŒã§ããŸã®ã§ã€ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ï¼š

```bash
# æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
git add mix.exs
git add lib/puyo_puyo/web_server.ex
git add lib/puyo_puyo/application.ex
git add priv/static/

# ã‚³ãƒŸãƒƒãƒˆ
git commit -m "feat: ç”»é¢è¡¨ç¤ºã¨ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã‚’å®Ÿè£…

- Plug/Cowboyã«ã‚ˆã‚‹ç°¡æ˜“Webã‚µãƒ¼ãƒãƒ¼
- HTMLãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCanvas + æƒ…å ±ãƒ‘ãƒãƒ«ï¼‰
- JavaScriptã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ï¼ˆrequestAnimationFrameï¼‰
- Canvasæç”»å‡¦ç†ï¼ˆã‚°ãƒªãƒƒãƒ‰ã€ã·ã‚ˆï¼‰
- ã‚­ãƒ¼å…¥åŠ›å‡¦ç†ã®åŸºç›¤
- ãƒ‡ãƒ«ã‚¿æ™‚é–“ã«ã‚ˆã‚‹æ»‘ã‚‰ã‹ãªæ›´æ–°

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3ã®ç”»é¢è¡¨ç¤ºã¨ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ãŒå®Œæˆ"
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3ã®æœ€çµ‚æŒ¯ã‚Šè¿”ã‚Š

ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§é”æˆã—ãŸã“ã¨ï¼š

âœ… Playeræ§‹é€ ä½“ã®ä½œæˆ
âœ… ã·ã‚ˆãƒšã‚¢ã®ç”Ÿæˆæ©Ÿèƒ½
âœ… å›è»¢æ©Ÿèƒ½ï¼ˆæ™‚è¨ˆå›ã‚Šãƒ»åæ™‚è¨ˆå›ã‚Šï¼‰
âœ… å£ã‚­ãƒƒã‚¯å‡¦ç†
âœ… å›è»¢æ™‚ã®è¡çªåˆ¤å®š
âœ… **Webã‚µãƒ¼ãƒãƒ¼ã®æ§‹ç¯‰**
âœ… **ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®å®Ÿè£…**
âœ… **Canvasæç”»ã®å®Ÿè£…**
âœ… **ã‚­ãƒ¼å…¥åŠ›å‡¦ç†ã®åŸºç›¤**
âœ… 11å€‹ã®ãƒ†ã‚¹ãƒˆã™ã¹ã¦ãƒ‘ã‚¹

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ï¼ˆæœ€çµ‚ï¼‰

```
puyo_puyo/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ puyo_puyo/
â”‚       â”œâ”€â”€ game.ex              # ã‚²ãƒ¼ãƒ å…¨ä½“ã®ç®¡ç†
â”‚       â”œâ”€â”€ config.ex            # è¨­å®šæƒ…å ±
â”‚       â”œâ”€â”€ stage.ex             # ã‚¹ãƒ†ãƒ¼ã‚¸
â”‚       â”œâ”€â”€ score.ex             # ã‚¹ã‚³ã‚¢ç®¡ç†
â”‚       â”œâ”€â”€ player.ex            # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ“ä½œ
â”‚       â”œâ”€â”€ application.ex       # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ï¼ˆNEWï¼‰
â”‚       â””â”€â”€ web_server.ex        # Webã‚µãƒ¼ãƒãƒ¼ï¼ˆNEWï¼‰
â”œâ”€â”€ priv/
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ index.html           # ã‚²ãƒ¼ãƒ ç”»é¢ï¼ˆNEWï¼‰
â”‚       â””â”€â”€ game.js              # ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ï¼ˆNEWï¼‰
â””â”€â”€ test/
    â””â”€â”€ puyo_puyo/
        â”œâ”€â”€ game_test.exs
        â”œâ”€â”€ config_test.exs
        â”œâ”€â”€ stage_test.exs
        â”œâ”€â”€ score_test.exs
        â””â”€â”€ player_test.exs
```

#### å­¦ã‚“ã ã“ã¨ï¼ˆè¿½åŠ ï¼‰

8. **Plug/Cowboy**: Elixirã§ã®Webã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰
9. **requestAnimationFrame**: ãƒ–ãƒ©ã‚¦ã‚¶ã®æç”»ã‚µã‚¤ã‚¯ãƒ«ã«åŒæœŸ
10. **ãƒ‡ãƒ«ã‚¿æ™‚é–“**: ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆéä¾å­˜ã®å‹•ã
11. **Canvas API**: 2Dæç”»ã®åŸºæœ¬
12. **ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³**: æ›´æ–°ã¨æç”»ã®åˆ†é›¢
13. **Supervisor**: Elixirã®ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–

#### ã‚²ãƒ¼ãƒ é–‹ç™ºã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**1. çŠ¶æ…‹ã¨æç”»ã®åˆ†é›¢**ï¼š
```
State (Elixir) â†â†’ View (JavaScript)
    â†“                   â†“
ç´”ç²‹é–¢æ•°           Canvasæç”»
ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«     å‰¯ä½œç”¨
```

**2. ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®åŸå‰‡**ï¼š
- æ›´æ–°é »åº¦ã¯ä¸€å®šã«ä¿ã¤
- ãƒ‡ãƒ«ã‚¿æ™‚é–“ã‚’æ´»ç”¨
- æç”»ã¯ã§ãã‚‹ã ã‘è»½é‡ã«

**3. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**ï¼š
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼šExUnit
- æç”»å‡¦ç†ï¼šæ‰‹å‹•ãƒ†ã‚¹ãƒˆ
- çµ±åˆãƒ†ã‚¹ãƒˆï¼šE2Eãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

#### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

- ã·ã‚ˆã®ç§»å‹•æ©Ÿèƒ½ï¼ˆå·¦å³ã®ç§»å‹•ï¼‰
- ã·ã‚ˆã®è‡ªå‹•è½ä¸‹æ©Ÿèƒ½
- é«˜é€Ÿè½ä¸‹æ©Ÿèƒ½ï¼ˆä¸‹ã‚­ãƒ¼ï¼‰
- ç€åœ°åˆ¤å®šã¨å›ºå®šå‡¦ç†
- Elixirãƒ­ã‚¸ãƒƒã‚¯ã¨JavaScriptã®çµ±åˆ

ãã‚Œã§ã¯ã€Red-Green-Refactorã®ãƒªã‚ºãƒ ã§ã€ã€Œå‹•ä½œã™ã‚‹ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã€ã‚’æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ï¼
