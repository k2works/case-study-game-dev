---
title: ã·ã‚ˆã·ã‚ˆã‹ã‚‰å§‹ã‚ã‚‹ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º C# Blazorç‰ˆ
description: ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æ‰‹æ³•ã‚’ç”¨ã„ã¦C# Blazorã§ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã™ã‚‹éç¨‹ã‚’è§£èª¬
published: true
date: 2025-10-10T00:00:00.000Z
tags: tdd, csharp, blazor, ã·ã‚ˆã·ã‚ˆ, dotnet
editor: markdown
dateCreated: 2025-10-10T00:00:00.000Z
---

# ã·ã‚ˆã·ã‚ˆã‹ã‚‰å§‹ã‚ã‚‹ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º C# Blazorç‰ˆ

## ã¯ã˜ã‚ã«

ã¿ãªã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ä»Šæ—¥ã¯ç§ã¨ä¸€ç·’ã«ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ã‚’ä½¿ã£ã¦ã€C# BlazorWebAssemblyã§ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã•ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ—…ã«å‡ºã‚‹å‰ã«ã€çš†ã•ã‚“ã¯ã€Œãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€ã«ã¤ã„ã¦èã„ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿã‚‚ã—ã‹ã—ãŸã‚‰ã€Œãƒ†ã‚¹ãƒˆã£ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ãŸå¾Œã«ã™ã‚‹ã‚‚ã®ã˜ã‚ƒãªã„ã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚

> ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã¨ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ‰‹æ³•ã®ä¸€ç¨®ã§ã€ã€Œãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã€ã®åŸå‰‡ã«å¾“ã„ã€å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’é«˜ã‚ã€è¨­è¨ˆã‚’æ”¹å–„ã—ã¦ã„ãé–‹ç™ºæ‰‹æ³•ã§ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã“ã®è¨˜äº‹ã§ã¯ã€ç§ãŸã¡ãŒä¸€ç·’ã«ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ãªãŒã‚‰ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®åŸºæœ¬çš„ãªæµã‚Œã¨è€ƒãˆæ–¹ã‚’å­¦ã‚“ã§ã„ãã¾ã™ã€‚ã¾ã‚‹ã§ãƒ¢ãƒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚ˆã†ã«ã€ã‚ãªãŸã¨ç§ãŒä¸€ç·’ã«è€ƒãˆã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€æ”¹å–„ã—ã¦ã„ãéç¨‹ã‚’ä½“é¨“ã—ã¾ã—ã‚‡ã†ã€‚ã€Œã§ã‚‚ã€ã·ã‚ˆã·ã‚ˆã£ã¦çµæ§‹è¤‡é›‘ãªã‚²ãƒ¼ãƒ ã˜ã‚ƒãªã„ã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¿ƒé…ã„ã‚Šã¾ã›ã‚“ã€‚å„ç« ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã«åŸºã¥ã„ãŸæ©Ÿèƒ½ã‚’ã€ãƒ†ã‚¹ãƒˆã€å®Ÿè£…ã€è§£èª¬ã®é †ã«å°‘ã—ãšã¤é€²ã‚ã¦ã„ãã¾ã™ã‚ˆã€‚ä¸€æ­©ä¸€æ­©ã€ç€å®Ÿã«é€²ã‚“ã§ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚µã‚¤ã‚¯ãƒ«

ã•ã¦ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€ã©ã®ã‚ˆã†ã«é€²ã‚ã¦ã„ã‘ã°ã„ã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿã€Œãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã‹ã‚‰å®Ÿè£…ã™ã‚‹ã€ã¨ã„ã†ã®ã¯åˆ†ã‹ã‚Šã¾ã—ãŸãŒã€å…·ä½“çš„ã«ã¯ã©ã‚“ãªæ‰‹é †ã§é€²ã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ç§ãŒã„ã¤ã‚‚å®Ÿè·µã—ã¦ã„ã‚‹ã®ã¯ã€ä»¥ä¸‹ã®3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¹°ã‚Šè¿”ã™ã‚µã‚¤ã‚¯ãƒ«ã§ã™ã€‚çš†ã•ã‚“ã‚‚ä¸€ç·’ã«ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **Redï¼ˆèµ¤ï¼‰**: ã¾ãšå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¾ã™ã€‚ã€Œãˆï¼Ÿã‚ã–ã¨å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã‚Œã«ã¯é‡è¦ãªæ„å‘³ãŒã‚ã‚‹ã‚“ã§ã™ã€‚ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½ãŒä½•ã‚’ã™ã¹ãã‹ã‚’æ˜ç¢ºã«ã™ã‚‹ãŸã‚ãªã‚“ã§ã™ã‚ˆã€‚
2. **Greenï¼ˆç·‘ï¼‰**: æ¬¡ã«ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ã€æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã®æ®µéšã§ã¯ã€ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šã‚‚ã€Œã¨ã«ã‹ãå‹•ãã“ã¨ã€ã‚’å„ªå…ˆã—ã¾ã™ã€‚ã€Œæœ€å°é™ã€ã¨ã„ã†ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚å¿…è¦ä»¥ä¸Šã®ã“ã¨ã¯ã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚
3. **Refactorï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰**: æœ€å¾Œã«ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’æ”¹å–„ã—ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªã—ãªãŒã‚‰ã€é‡è¤‡ã‚’å–ã‚Šé™¤ã„ãŸã‚Šã€ã‚ã‹ã‚Šã‚„ã™ã„åå‰ã‚’ã¤ã‘ãŸã‚Šã—ã¾ã™ã€‚ã€Œå‹•ãã‘ã©æ±šã„ã‚³ãƒ¼ãƒ‰ã€ã‹ã‚‰ã€Œå‹•ã„ã¦ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã€ã¸ã¨é€²åŒ–ã•ã›ã‚‹ã‚“ã§ã™ã€‚

> ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ãƒªã‚ºãƒ ï¼šèµ¤ã€ç·‘ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€‚ã¾ãšå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆèµ¤ï¼‰ã€æ¬¡ã«ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆç·‘ï¼‰ã€ãã—ã¦é‡è¤‡ã‚’é™¤å»ã™ã‚‹ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ã€ŒRed-Green-Refactorã€ã‚µã‚¤ã‚¯ãƒ«ã¨å‘¼ã³ã¾ã™ã€‚ã€Œèµ¤ãƒ»ç·‘ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€ã®ãƒªã‚ºãƒ ã‚’åˆ»ã‚€ã‚ˆã†ã«ã€ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãã‚“ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€å°‘ã—ãšã¤æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’é«˜ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚çš†ã•ã‚“ã‚‚ä¸€ç·’ã«ã“ã®ãƒªã‚ºãƒ ã‚’ä½“æ„Ÿã—ã¦ã¿ã¦ãã ã•ã„ï¼

```plantuml
@startuml
[*] --> ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ
ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ --> TODO : TODOãƒªã‚¹ãƒˆã‚’ä½œæˆ
TODO --> Red : ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
Red --> Green : æœ€å°é™ã®å®Ÿè£…
Green --> Refactor : ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
Refactor --> Red : æ¬¡ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
Red : ãƒ†ã‚¹ãƒˆã«å¤±æ•—
Green : ãƒ†ã‚¹ãƒˆã«é€šã‚‹æœ€å°é™ã®å®Ÿè£…
Refactor : ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’é™¤å»ã—ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
Refactor --> TODO : ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒå®Œäº†ã—ãŸã‚‰TODOãƒªã‚¹ãƒˆã«æˆ»ã‚‹
TODO --> ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ : TODOãƒªã‚¹ãƒˆãŒç©ºã«ãªã‚‹ã¾ã§ç¹°ã‚Šè¿”ã™
ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ --> ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ“ãƒ¥ãƒ¼
@enduml
```

### é–‹ç™ºç’°å¢ƒ

ã•ã¦ã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã«ã€ç§ãŸã¡ãŒä½¿ç”¨ã™ã‚‹é–‹ç™ºç’°å¢ƒã«ã¤ã„ã¦å°‘ã—ãŠè©±ã—ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚çš†ã•ã‚“ã¯ã€Œé“å…·é¸ã³ã¯ä»•äº‹ã®åŠåˆ†ã€ã¨ã„ã†è¨€è‘‰ã‚’èã„ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã‚‚åŒã˜ã“ã¨ãŒè¨€ãˆã‚‹ã‚“ã§ã™ã€‚

> è‰¯ã„ãƒ„ãƒ¼ãƒ«ã¯è‰¯ã„ä»•äº‹ã®ç¬¬ä¸€æ­©ã§ã™ã€‚é©åˆ‡ãªé“å…·ã‚’é¸ã¶ã“ã¨ã§ã€é–‹ç™ºã®åŠ¹ç‡ã¨å“è³ªãŒå¤§ããå‘ä¸Šã—ã¾ã™ã€‚
> 
> â€” Andrew Hunt & David Thomas ã€é”äººãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã€

ã€Œã©ã‚“ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ãˆã°ã„ã„ã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ãã¾ã™ï¼š

- **è¨€èª**: C# â€” ã€Œ.NETã£ã¦é›£ã—ãã†...ã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€C#ã¯å¼·åŠ›ãªå‹ã‚·ã‚¹ãƒ†ãƒ ã¨è±Šå¯Œãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚Šã€å¤§è¦æ¨¡ãªé–‹ç™ºã§ã‚‚ãƒã‚°ã‚’æ¸›ã‚‰ã—ã‚„ã™ããªã‚‹ã‚“ã§ã™ã€‚
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Blazor WebAssembly â€” ã€ŒWebã‚¢ãƒ—ãƒªãªã®ã«ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰è¨€èªã®C#ï¼Ÿã€é©šã‹ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€Blazorã¯C#ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã§ãã‚‹ç´ æ™´ã‚‰ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãªã‚“ã§ã™ï¼
- **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: xUnit â€” .NETã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã§åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹ä¿¡é ¼æ€§ã®é«˜ã„ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã«ã¯æ¬ ã‹ã›ãªã„ãƒ„ãƒ¼ãƒ«ã§ã™ã­ã€‚
- **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: Coverlet â€” ãƒ†ã‚¹ãƒˆãŒã©ã‚Œã ã‘ã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã‹ã‚’å¯è¦–åŒ–ã—ã¦ãã‚Œã¾ã™ã€‚ã€Œã©ã“ã‚’ãƒ†ã‚¹ãƒˆã™ã¹ãï¼Ÿã€ã¨ã„ã†ç–‘å•ã«ç­”ãˆã¦ãã‚Œã¾ã™ã‚ˆã€‚
- **é™çš„ã‚³ãƒ¼ãƒ‰è§£æ**: Microsoft.CodeAnalysis.Analyzers â€” ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ã—ã€æ½œåœ¨çš„ãªå•é¡Œã‚’æ—©æœŸã«ç™ºè¦‹ã—ã¦ãã‚Œã¾ã™ã€‚
- **ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿**: dotnet format â€” ã€Œãƒãƒ¼ãƒ å†…ã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„...ã€ãã‚“ãªæ‚©ã¿ã‚’è§£æ±ºã—ã¦ãã‚Œã¾ã™ã€‚
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Git â€” ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´å±¥æ­´ã‚’è¿½è·¡ã—ã€ã€Œã‚ã‚Œï¼Ÿæ˜¨æ—¥ã¾ã§ã¡ã‚ƒã‚“ã¨å‹•ã„ã¦ãŸã®ã«...ã€ã¨ã„ã†ã¨ãã«éå»ã®çŠ¶æ…‹ã«æˆ»ã‚Œã‚‹é­”æ³•ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æµã‚Œã«æ²¿ã£ã¦ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã€Œç’°å¢ƒæ§‹ç¯‰ã£ã¦é›£ã—ãã†...ã€ã¨å¿ƒé…ã•ã‚Œã‚‹æ–¹ã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä»Šå›ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0ã§ã¯ã€ãã®ç’°å¢ƒæ§‹ç¯‰ã«ã¤ã„ã¦ã—ã£ã‹ã‚Šè§£èª¬ã—ã¦ã„ãã¾ã™ã­ï¼

## è¦ä»¶

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã•ã¦ã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã‚‹å‰ã«ã€å°‘ã—ç«‹ã¡æ­¢ã¾ã£ã¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã€Œä½•ã‚’ä½œã‚‹ã®ã‹ï¼Ÿã€ã¨ã„ã†åŸºæœ¬çš„ãªå•ã„ã‹ã‘ã§ã™ã€‚ç§ãŸã¡ãŒä½œã‚‹ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã¯ã€ã©ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’æŒã¤ã¹ãã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™ºã§ã¯ã€ã“ã®ã€Œä½•ã‚’ä½œã‚‹ã®ã‹ï¼Ÿã€ã¨ã„ã†å•ã„ã«å¯¾ã—ã¦ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€ã¨ã„ã†å½¢ã§ç­”ãˆã‚’å‡ºã—ã¾ã™ã€‚çš†ã•ã‚“ã¯ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€ã¨ã„ã†è¨€è‘‰ã‚’èã„ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ

> ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¨ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ©Ÿèƒ½ã‚’ã€Œèª°ãŒã€ã€Œä½•ã‚’ã€ã€Œãªãœã€ã—ãŸã„ã®ã‹ã¨ã„ã†å½¢å¼ã§è¡¨ç¾ã—ãŸã‚‚ã®ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºãƒãƒ¼ãƒ ã¯å¸¸ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦–ç‚¹ã‚’å¿˜ã‚Œãšã«é–‹ç™ºã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
> 
> â€” Mike Cohn ã€User Stories Appliedã€

ã¤ã¾ã‚Šã€ã€Œãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã€‡ã€‡ãŒã§ãã‚‹ï¼ˆã€‡ã€‡ã—ãŸã„ã‹ã‚‰ï¼‰ã€ã¨ã„ã†å½¢å¼ã§æ©Ÿèƒ½ã‚’è¡¨ç¾ã™ã‚‹ã‚“ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€ã€Œèª°ã®ãŸã‚ã€ã®ã€Œã©ã‚“ãªæ©Ÿèƒ½ã€ã‚’ã€Œãªãœã€ä½œã‚‹ã®ã‹ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚ç´ æ™´ã‚‰ã—ã„ã§ã™ã‚ˆã­ï¼

ã§ã¯ã€ç§ãŸã¡ã®ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã§ã¯ã€ã©ã‚“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿä¸€ç·’ã«è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã®åŸºæœ¬æ©Ÿèƒ½ã¨ã—ã¦å¿…è¦ã§ã™ã‚ˆã­ï¼ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã§ãã‚‹ï¼ˆã·ã‚ˆã‚’é©åˆ‡ãªä½ç½®ã«é…ç½®ã—ãŸã„ã§ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å›è»¢ã§ãã‚‹ï¼ˆæˆ¦ç•¥çš„ã«ã·ã‚ˆã‚’é…ç½®ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ˆã€Œæ—©ãæ¬¡ã®ã·ã‚ˆã‚’è½ã¨ã—ãŸã„ï¼ã€ã¨ã„ã†ã¨ãã®ãŸã‚ã«ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€åŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆå»ã§ãã‚‹ï¼ˆã“ã‚ŒãŒã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã§ã™ã‚ˆã­ï¼ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€é€£é–åå¿œã‚’èµ·ã“ã—ã¦ã‚ˆã‚Šé«˜ã„ã‚¹ã‚³ã‚¢ã‚’ç²å¾—ã§ãã‚‹ï¼ˆã€Œã‚Œã€œã‚“ã•ã€œã‚“ï¼ã€ã¨å«ã³ãŸããªã‚Šã¾ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€å…¨æ¶ˆã—ï¼ˆãœã‚“ã‘ã—ï¼‰ãƒœãƒ¼ãƒŠã‚¹ã‚’ç²å¾—ã§ãã‚‹ï¼ˆã€Œã‚„ã£ãŸï¼å…¨éƒ¨æ¶ˆãˆãŸï¼ã€ã¨ã„ã†é”æˆæ„Ÿã‚’å‘³ã‚ã„ãŸã„ã§ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã«ãªã‚‹ã¨ã‚²ãƒ¼ãƒ çµ‚äº†ã®æ¼”å‡ºã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ˆçµ‚ã‚ã‚ŠãŒæ˜ç¢ºã§ãªã„ã¨ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã—ã¾ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ã‚’ç¢ºèªã§ãã‚‹ï¼ˆã€Œä»Šã©ã‚Œãã‚‰ã„ç‚¹æ•°å–ã‚Œã¦ã‚‹ã‹ãªï¼Ÿã€ã¨æ°—ã«ãªã‚Šã¾ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ã·ã‚ˆã‚’æ“ä½œã§ãã‚‹ï¼ˆPCã§ãƒ—ãƒ¬ã‚¤ã™ã‚‹ãªã‚‰å¿…é ˆã§ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚¿ãƒƒãƒæ“ä½œã§ã·ã‚ˆã‚’æ“ä½œã§ãã‚‹ï¼ˆã‚¹ãƒãƒ›ã§ã‚‚ãƒ—ãƒ¬ã‚¤ã—ãŸã„ã§ã™ã‚ˆã­ï¼‰

ã€Œã†ã‚ã€çµæ§‹ãŸãã•ã‚“ã‚ã‚‹ãª...ã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¿ƒé…ã„ã‚Šã¾ã›ã‚“ï¼ã“ã‚Œã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ä¸€ã¤ãšã¤å®Ÿè£…ã—ã¦ã„ãã“ã¨ã§ã€å¾ã€…ã«ã‚²ãƒ¼ãƒ ã‚’å®Œæˆã•ã›ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ç´ æ™´ã‚‰ã—ã„ã¨ã“ã‚ã¯ã€å„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã—ã€ãƒ†ã‚¹ãƒˆâ†’å®Ÿè£…â†’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚¯ãƒ«ã§å°‘ã—ãšã¤é€²ã‚ã‚‰ã‚Œã‚‹ã“ã¨ãªã‚“ã§ã™ã€‚ä¸€æ­©ä¸€æ­©ã€ç€å®Ÿã«é€²ã‚“ã§ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’æ•´ç†ã—ãŸã¨ã“ã‚ã§ã€ã€Œã“ã‚Œã‚‰ã®æ©Ÿèƒ½ãŒã©ã®ã‚ˆã†ã«é–¢é€£ã—ã¦ã„ã‚‹ã®ã‹ã€å…¨ä½“åƒãŒè¦‹ãˆã‚‹ã¨ã„ã„ãªã€ã¨æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿãã‚“ãªã¨ãã«å½¹ç«‹ã¤ã®ãŒã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã€ã§ã™ã€‚

ã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã£ã¦ä½•ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã¨å¤–éƒ¨ã‚¢ã‚¯ã‚¿ãƒ¼ï¼ˆã“ã“ã§ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚·ã‚¹ãƒ†ãƒ è‡ªä½“ï¼‰ã®ç›¸äº’ä½œç”¨ã‚’è¦–è¦šçš„ã«è¡¨ç¾ã™ã‚‹ãŸã‚ã®å›³ã§ã™ã€‚ã€Œçµµã«æã„ã¦æ•´ç†ã™ã‚‹ã¨åˆ†ã‹ã‚Šã‚„ã™ã„ã€ã¨ã„ã†ã‚„ã¤ã§ã™ã­ã€‚

> ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ãŒå¤–éƒ¨ã«æä¾›ã™ã‚‹æ©Ÿèƒ½ã¨ã€ãã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã‚¢ã‚¯ã‚¿ãƒ¼ã¨ã®é–¢ä¿‚ã‚’è¡¨ç¾ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ã®å¢ƒç•Œã¨è²¬ä»»ç¯„å›²ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚
> 
> â€” Martin Fowler ã€UMLãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã®ã‚¨ãƒƒã‚»ãƒ³ã‚¹ã€

ã€Œç™¾èã¯ä¸€è¦‹ã«ã—ã‹ãšã€ã¨ã„ã†ã‚ˆã†ã«ã€å®Ÿéš›ã«è¦‹ã¦ã¿ã‚‹ã®ãŒä¸€ç•ªåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã‚ˆã­ã€‚ã§ã¯ã€ç§ãŸã¡ã®ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```plantuml
@startuml "ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³"
left to right direction
skinparam packageStyle rectangle
skinparam linetype ortho

' ã‚¢ã‚¯ã‚¿ãƒ¼ã®å®šç¾©
actor "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" as Player
actor "ã‚·ã‚¹ãƒ†ãƒ " as System

rectangle "ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚·ã‚¹ãƒ†ãƒ " {
  together {
    ' ã‚²ãƒ¼ãƒ ç®¡ç†é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹" as StartNewGame
    usecase "ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ" as RestartGame
  }

  together {
    ' ã·ã‚ˆæ“ä½œé–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•" as MovePuyo
    usecase "ã·ã‚ˆã‚’å›è»¢" as RotatePuyo
    usecase "ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹" as QuickDropPuyo
  }

  together {
    ' ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã·ã‚ˆã‚’æ¶ˆå»" as ErasePuyo
    usecase "é€£é–åå¿œã‚’ç™ºç”Ÿ" as ChainReaction
    usecase "å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’ç²å¾—" as ZenkeshiBonus
    usecase "ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º" as DisplayScore
  }

  together {
    ' å…¥åŠ›é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§æ“ä½œ" as KeyboardControl
    usecase "ã‚¿ãƒƒãƒæ“ä½œ" as TouchControl
  }

  together {
    ' ã‚·ã‚¹ãƒ†ãƒ é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š" as GameOverCheck
    usecase "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ¼”å‡º" as GameOverAnimation
  }
}

' ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é–¢é€£
Player --> StartNewGame
Player --> RestartGame
Player --> MovePuyo
Player --> RotatePuyo
Player --> QuickDropPuyo
Player --> KeyboardControl
Player --> TouchControl

' ã‚·ã‚¹ãƒ†ãƒ ã®é–¢é€£
ErasePuyo <-- System
ChainReaction <-- System
ZenkeshiBonus <-- System
DisplayScore <-- System
GameOverCheck <-- System
GameOverAnimation <-- System

' åŒ…å«é–¢ä¿‚
MovePuyo ..> KeyboardControl : <<extend>>
MovePuyo ..> TouchControl : <<extend>>
RotatePuyo ..> KeyboardControl : <<extend>>
RotatePuyo ..> TouchControl : <<extend>>
QuickDropPuyo ..> KeyboardControl : <<extend>>
QuickDropPuyo ..> TouchControl : <<extend>>

' ãã®ä»–ã®é–¢ä¿‚
ErasePuyo ..> ChainReaction : <<include>>
ChainReaction ..> DisplayScore : <<include>>
ZenkeshiBonus ..> DisplayScore : <<include>>
GameOverCheck ..> GameOverAnimation : <<include>>

@enduml
```

ã“ã®å›³ã‚’è¦‹ã‚‹ã¨ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚·ã‚¹ãƒ†ãƒ ã®å½¹å‰²åˆ†æ‹…ãŒã‚ˆãã‚ã‹ã‚Šã¾ã™ã­ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚²ãƒ¼ãƒ ã®é–‹å§‹ã‚„æ“ä½œã‚’æ‹…å½“ã—ã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã·ã‚ˆã®æ¶ˆå»åˆ¤å®šã‚„ã‚¹ã‚³ã‚¢è¨ˆç®—ãªã©ã®å†…éƒ¨å‡¦ç†ã‚’æ‹…å½“ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã¨ã‚¿ãƒƒãƒæ“ä½œã¯ã€Œæ‹¡å¼µï¼ˆextendï¼‰ã€é–¢ä¿‚ã«ã‚ã‚Šã€ã·ã‚ˆã®ç§»å‹•ã‚„å›è»¢ãªã©ã®åŸºæœ¬æ“ä½œã‚’ç•°ãªã‚‹å…¥åŠ›æ–¹æ³•ã§å®Ÿç¾ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“åƒã‚’æŠŠæ¡ã—ã€å®Ÿè£…ã™ã¹ãæ©Ÿèƒ½ã®é–¢é€£æ€§ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã‚Œã§ã¯ã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã«é€²ã‚“ã§ã„ãã¾ã—ã‚‡ã†ï¼

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0: é–‹ç™ºç’°å¢ƒã®æº–å‚™

ã€Œã„ããªã‚Šã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã‚‹å‰ã«ã€ã¾ãšç’°å¢ƒã‚’æ•´ãˆã¾ã—ã‚‡ã†ï¼ã€å®Ÿã¯ã€ã“ã®æº–å‚™ãŒã¨ã¦ã‚‚é‡è¦ãªã‚“ã§ã™ã€‚è‰¯ã„é“å…·ã‚’æƒãˆã¦ãŠãã“ã¨ã§ã€å¾Œã®ä½œæ¥­ãŒã¨ã¦ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã‚ˆã€‚

### è‡ªå‹•åŒ–ã‹ã‚‰å§‹ã‚ã‚‹ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º

ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰1ã§ã¯ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚´ãƒ¼ãƒ«ãŒ **å‹•ä½œã™ã‚‹ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰** ã§ã‚ã‚‹ã“ã¨ã‚’å­¦ã³ã¾ã—ãŸã€‚ã§ã¯ã€è‰¯ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãç¶šã‘ã‚‹ãŸã‚ã«ã¯ä½•ãŒå¿…è¦ã«ãªã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿãã‚Œã¯[ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã®ä¸‰ç¨®ã®ç¥å™¨](https://t-wada.hatenablog.jp/entry/clean-code-that-works)ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚

> ä»Šæ—¥ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã®ä¸–ç•Œã«ãŠã„ã¦çµ¶å¯¾ã«ãªã‘ã‚Œã°ãªã‚‰ãªã„3ã¤ã®æŠ€è¡“çš„ãªæŸ±ãŒã‚ã‚Šã¾ã™ã€‚
> ä¸‰æœ¬æŸ±ã¨è¨€ã£ãŸã‚Šã€ä¸‰ç¨®ã®ç¥å™¨ã¨è¨€ã£ãŸã‚Šã—ã¦ã„ã¾ã™ãŒã€ãã‚Œã‚‰ã¯
> 
>   - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
> 
>   - ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°
> 
>   - è‡ªå‹•åŒ–
> 
> ã®3ã¤ã§ã™ã€‚
> 
> â€”  https://t-wada.hatenablog.jp/entry/clean-code-that-works 

ã“ã‚Œã‹ã‚‰ã€ã“ã‚Œã‚‰3ã¤ã®ç¥å™¨ã‚’ä¸€ã¤ãšã¤æº–å‚™ã—ã¦ã„ãã¾ã™ã€‚ã€Œãªã‚“ã ã‹å¤§å¤‰ãã†...ã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä¸€åº¦æº–å‚™ã—ã¦ã—ã¾ãˆã°ã€å¾Œã¯è‡ªå‹•ã§å‹•ã„ã¦ãã‚Œã‚‹ã®ã§æ¥½ã«ãªã‚Šã¾ã™ã‚ˆï¼

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ã¾ãšã¯ã€Blazor WebAssemblyãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚ã€Œã©ã†ã‚„ã£ã¦ä½œã‚‹ã®ï¼Ÿã€ã¨ã„ã†ã¨ã€.NET CLIã‚’ä½¿ã„ã¾ã™ã€‚ã‚³ãƒãƒ³ãƒ‰ä¸€ã¤ã§ç°¡å˜ã«ä½œã‚Œã‚‹ã‚“ã§ã™ã‚ˆï¼

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd /workspaces/case-study-game-dev/app/csharp

# Blazor WebAssemblyãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
dotnet new blazorwasm -n PuyoPuyoTDD -o PuyoPuyoTDD

# ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
dotnet new xunit -n PuyoPuyoTDD.Tests -o PuyoPuyoTDD.Tests

# ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
dotnet new sln -n PuyoPuyoTDD

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ 
dotnet sln add PuyoPuyoTDD/PuyoPuyoTDD.csproj
dotnet sln add PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj

# ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å‚ç…§ã‚’è¿½åŠ 
cd PuyoPuyoTDD.Tests
dotnet add reference ../PuyoPuyoTDD/PuyoPuyoTDD.csproj
cd ..
```

ã€ŒãŸãã•ã‚“ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚‹ãªã...ã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä¸€ã¤ãšã¤è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼š

1. `dotnet new blazorwasm` - Blazor WebAssemblyã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™
2. `dotnet new xunit` - xUnitã®ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™
3. `dotnet new sln` - ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼ˆè¤‡æ•°ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã™ã‚‹ãŸã‚ï¼‰
4. `dotnet sln add` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ ã—ã¾ã™
5. `dotnet add reference` - ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™

ã“ã‚Œã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åŸºæœ¬æ§‹é€ ãŒã§ãã¾ã—ãŸï¼

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

#### Gitãƒªãƒã‚¸ãƒˆãƒªã®åˆæœŸåŒ–

æ¬¡ã«ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®æº–å‚™ã‚’ã—ã¾ã—ã‚‡ã†ã€‚ã€Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã£ã¦ä½•ï¼Ÿã€ã¨ã„ã†æ–¹ã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ç°¡å˜ã«è¨€ã†ã¨ã€ã€Œã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²ã—ã¦ã€ã„ã¤ã§ã‚‚éå»ã®çŠ¶æ…‹ã«æˆ»ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ä»•çµ„ã¿ã€ãªã‚“ã§ã™ã€‚

```bash
# Gitãƒªãƒã‚¸ãƒˆãƒªã‚’åˆæœŸåŒ–ï¼ˆã¾ã ã®å ´åˆï¼‰
# æ—¢ã«ãƒªãƒã‚¸ãƒˆãƒªãŒã‚ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—

# .gitignoreãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > .gitignore << 'EOF'
## Ignore Visual Studio temporary files, build results, and
## files generated by popular Visual Studio add-ons.

# User-specific files
*.suo
*.user
*.userosscache
*.sln.docstates

# Build results
[Dd]ebug/
[Dd]ebugPublic/
[Rr]elease/
[Rr]eleases/
x64/
x86/
[Bb]in/
[Oo]bj/

# Visual Studio cache/options directory
.vs/

# Test results
[Tt]est[Rr]esult*/
[Bb]uild[Ll]og.*

# Coverage reports
coverage/
TestResults/

# NuGet Packages
*.nupkg
.nuget/
EOF
```

`.gitignore`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã€Œã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯Gitã§ç®¡ç†ã—ãªãã¦ã„ã„ã‚ˆã€ã¨æŒ‡å®šã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ãƒ“ãƒ«ãƒ‰çµæœã‚„ãƒ†ã‚¹ãƒˆçµæœãªã©ã€è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç®¡ç†ã™ã‚‹å¿…è¦ãŒãªã„ã§ã™ã‹ã‚‰ã­ã€‚

#### ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¦ç´„

Gitã§ã‚³ãƒ¼ãƒ‰ã‚’è¨˜éŒ²ã™ã‚‹ã¨ãã€ã€Œã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã¨ã„ã†ã‚‚ã®ã‚’æ›¸ãã¾ã™ã€‚ã€Œã©ã‚“ãªãµã†ã«æ›¸ã‘ã°ã„ã„ã®ï¼Ÿã€ã¨ã„ã†ç–‘å•ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚å®Ÿã¯ã€ã‚ã‹ã‚Šã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›¸ããŸã‚ã®è¦ç´„ãŒã‚ã‚‹ã‚“ã§ã™ã€‚

ã“ã‚Œã¾ã§ä½œæ¥­ã®åŒºåˆ‡ã‚Šã”ã¨ã«ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ã„ã¾ã—ãŸãŒã€ãã®éš›ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ›¸å¼ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›¸ã„ã¦ã„ãã¾ã™ï¼š

```bash
git commit -m 'feat: æ–°æ©Ÿèƒ½ã‚’è¿½åŠ '
git commit -m 'fix: ãƒã‚°ã‚’ä¿®æ­£'
git commit -m 'refactor: ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°'
git commit -m 'test: ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
git commit -m 'chore: ãƒ“ãƒ«ãƒ‰è¨­å®šã‚’å¤‰æ›´'
```

ã“ã®æ›¸å¼ã¯ [Angularãƒ«ãƒ¼ãƒ«](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#type)ã«å¾“ã£ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€ãã‚Œãã‚Œã®ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãƒ˜ãƒƒãƒ€ã€ãƒœãƒ‡ã‚£ã€ãƒ•ãƒƒã‚¿ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ˜ãƒƒãƒ€ã¯ã‚¿ã‚¤ãƒ—ã€ã‚¹ã‚³ãƒ¼ãƒ—ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨ã„ã†ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```
<ã‚¿ã‚¤ãƒ—>(<ã‚¹ã‚³ãƒ¼ãƒ—>): <ã‚¿ã‚¤ãƒˆãƒ«>
<ç©ºè¡Œ>
<ãƒœãƒ‡ã‚£>
<ç©ºè¡Œ>
<ãƒ•ãƒƒã‚¿>
```

ãƒ˜ãƒƒãƒ€ã¯å¿…é ˆã§ã™ã€‚ãƒ˜ãƒƒãƒ€ã®ã‚¹ã‚³ãƒ¼ãƒ—ã¯ä»»æ„ã§ã™ã€‚ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é•·ã•ã¯50æ–‡å­—ã¾ã§ã«ã—ã¦ãã ã•ã„ï¼ˆãã†ã™ã‚‹ã“ã¨ã§ãã®ä»–ã®Gitãƒ„ãƒ¼ãƒ«ã¨åŒæ§˜ã«GitHubä¸Šã§èª­ã¿ã‚„ã™ããªã‚Šã¾ã™ï¼‰ã€‚

ã‚³ãƒŸãƒƒãƒˆã®ã‚¿ã‚¤ãƒ—ã¯æ¬¡ã‚’ç”¨ã„ã¦ä¸‹ã•ã„ï¼š

- **feat**: æ–°ã—ã„æ©Ÿèƒ½ã®è¿½åŠ 
- **fix**: ãƒã‚°ä¿®æ­£
- **docs**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¤‰æ›´ã®ã¿
- **style**: ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ã‚’ä¸ãˆãªã„å¤‰æ›´ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ã‚»ãƒŸã‚³ãƒ­ãƒ³ã®æ¬ è½ãªã©ï¼‰
- **refactor**: æ©Ÿèƒ½è¿½åŠ ã§ã‚‚ãƒã‚°ä¿®æ­£ã§ã‚‚ãªã„ã‚³ãƒ¼ãƒ‰å¤‰æ›´
- **perf**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ”¹å–„ã™ã‚‹ã‚³ãƒ¼ãƒ‰å¤‰æ›´
- **test**: å­˜åœ¨ã—ãªã„ãƒ†ã‚¹ãƒˆã®è¿½åŠ ã€ã¾ãŸã¯æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆã®ä¿®æ­£
- **chore**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆã®ã‚ˆã†ãªã€è£œåŠ©ãƒ„ãƒ¼ãƒ«ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã®å¤‰æ›´

ã€Œãªã‚‹ã»ã©ã€ã“ã†ã‚„ã£ã¦æ›¸ã‘ã°ã€å¾Œã‹ã‚‰è¦‹ãŸã¨ãã«ä½•ã‚’ã—ãŸã‹ãŒã™ãã‚ã‹ã‚Šã¾ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼

ã§ã¯ã€æœ€åˆã®ã‚³ãƒŸãƒƒãƒˆã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
cd PuyoPuyoTDD
git add .
git commit -m 'chore: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸè¨­å®š'
```

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£

ã§ã¯ **è‡ªå‹•åŒ–** ã®æº–å‚™ã«å…¥ã‚ŠãŸã„ã®ã§ã™ãŒã€ãã®ãŸã‚ã«ã¯ã„ãã¤ã‹ã®å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚.NETã§ã¯ **NuGet** ãŒãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã¨ã—ã¦ã®å½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚

> NuGetã¨ã¯ã€.NETç”¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã™ã€‚é–‹ç™ºè€…ãŒä½œæˆãƒ»å…±æœ‰ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ãƒ„ãƒ¼ãƒ«ã‚’ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã¨ã—ã¦é…å¸ƒãƒ»åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**NuGet**ã‚’ä½¿ã£ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã¯ç°¡å˜ã§ã™ï¼š

```bash
# ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ 
cd PuyoPuyoTDD.Tests
dotnet add package bunit
dotnet add package bunit.web
dotnet add package Microsoft.NET.Test.Sdk
cd ..
```

ã€Œbunitã£ã¦ä½•ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚bunitã¯Blazorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã‚’æ”¯æ´ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ã€ŒBlazorã§ãƒ†ã‚¹ãƒˆã™ã‚‹ãªã‚‰bUnitã€ã¨è¦šãˆã¦ãŠãã¨ã„ã„ã§ã™ã‚ˆï¼

C#/.NETãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`.csproj`ï¼‰ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾å­˜é–¢ä¿‚ãŒè¨˜è¿°ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸéš›ã« `dotnet restore` ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚ä¾¿åˆ©ã§ã™ã‚ˆã­ï¼

å®Ÿéš›ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
cat PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj
```

```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <IsPackable>false</IsPackable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="bunit" Version="1.26.64" />
    <PackageReference Include="bunit.web" Version="1.26.64" />
    <PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.8.0" />
    <PackageReference Include="xunit" Version="2.6.2" />
    <PackageReference Include="xunit.runner.visualstudio" Version="2.5.4">
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\PuyoPuyoTDD\PuyoPuyoTDD.csproj" />
  </ItemGroup>

</Project>
```

ã€Œã“ã†ã‚„ã£ã¦è¦‹ã‚‹ã¨ã€ã©ã‚“ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ãŒä¸€ç›®ç­ç„¶ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼

```bash
git add .
git commit -m 'chore: ãƒ†ã‚¹ãƒˆç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¿½åŠ '
```

### é™çš„ã‚³ãƒ¼ãƒ‰è§£æ

è‰¯ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãç¶šã‘ã‚‹ãŸã‚ã«ã¯ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’ç¶­æŒã—ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º**ã«ã‚ˆã‚Šãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å‹•ã‹ã—ãªãŒã‚‰å“è³ªã‚’æ”¹å–„ã—ã¦ã„ãã¾ã™ãŒã€å‡ºæ¥ä¸ŠãŒã£ãŸã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹å“è³ªãƒã‚§ãƒƒã‚¯ã®æ–¹æ³•ã¨ã—ã¦**é™çš„ã‚³ãƒ¼ãƒ‰è§£æ**ãŒã‚ã‚Šã¾ã™ã€‚

C#/.NETç”¨ã®**é™çš„ã‚³ãƒ¼ãƒ‰è§£æ**ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦[Microsoft.CodeAnalysis.Analyzers](https://github.com/dotnet/roslyn-analyzers)ã‚’ä½¿ã£ã¦ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
# ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd PuyoPuyoTDD
dotnet add package Microsoft.CodeAnalysis.Analyzers
cd ..
```

æ¬¡ã«ã€ã‚³ãƒ¼ãƒ‰åˆ†æã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚`.editorconfig`ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å®šç¾©ã§ãã¾ã™ï¼š

```bash
# PuyoPuyoTDDãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«.editorconfigã‚’ä½œæˆ
cat > .editorconfig << 'EOF'
root = true

[*]
indent_style = space
indent_size = 4
end_of_line = crlf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.cs]
# C# coding conventions
dotnet_sort_using_directives = true
dotnet_separate_import_directive_groups = false

# Language rules
csharp_prefer_var = false:suggestion
csharp_prefer_braces = true:warning

# Code quality rules
dotnet_diagnostic.CA1502.severity = warning
# CA1502: ãƒ¡ã‚½ãƒƒãƒ‰ã®å¾ªç’°çš„è¤‡é›‘åº¦ã‚’7ä»¥ä¸‹ã«åˆ¶é™
dotnet_code_quality.CA1502.cyclomatic_complexity = 7

# Naming conventions
dotnet_naming_rule.interface_should_be_begins_with_i.severity = warning
dotnet_naming_rule.interface_should_be_begins_with_i.symbols = interface
dotnet_naming_rule.interface_should_be_begins_with_i.style = begins_with_i

dotnet_naming_rule.types_should_be_pascal_case.severity = warning
dotnet_naming_rule.types_should_be_pascal_case.symbols = types
dotnet_naming_rule.types_should_be_pascal_case.style = pascal_case

dotnet_naming_symbols.interface.applicable_kinds = interface
dotnet_naming_symbols.interface.applicable_accessibilities = public, internal, private, protected, protected_internal, private_protected

dotnet_naming_symbols.types.applicable_kinds = class, struct, interface, enum
dotnet_naming_symbols.types.applicable_accessibilities = public, internal, private, protected, protected_internal, private_protected

dotnet_naming_style.begins_with_i.required_prefix = I
dotnet_naming_style.begins_with_i.capitalization = pascal_case

dotnet_naming_style.pascal_case.capitalization = pascal_case
EOF
```

ã€Œ.editorconfigã£ã¦ä½•ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ã“ã‚Œã¯ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã®å¹…ã‚„å‘½åè¦å‰‡ãªã©ï¼‰ã‚’å®šç¾©ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ãƒãƒ¼ãƒ å…¨ä½“ã§åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å…±æœ‰ã§ãã‚‹ã®ã§ã€ã€Œã“ã®äººã®ã‚³ãƒ¼ãƒ‰ã¯èª­ã¿ã«ãã„ãª...ã€ã¨ã„ã†å•é¡ŒãŒæ¸›ã‚Šã¾ã™ã‚ˆï¼

**å¾ªç’°è¤‡é›‘åº¦ã«ã¤ã„ã¦**

ã“ã“ã§è¨­å®šã—ã¦ã„ã‚‹`cyclomatic_complexity = 7`ã«ã¤ã„ã¦å°‘ã—èª¬æ˜ã—ã¾ã—ã‚‡ã†ã€‚å¾ªç’°è¤‡é›‘åº¦ï¼ˆCyclomatic Complexityï¼‰ã¨ã¯ã€ã‚³ãƒ¼ãƒ‰ã®è¤‡é›‘ã•ã‚’æ¸¬ã‚‹æŒ‡æ¨™ã®ä¸€ã¤ã§ã™ã€‚

> å¾ªç’°è¤‡é›‘åº¦ã¨ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã®è¤‡é›‘ã•ã‚’æ¸¬ã‚‹æŒ‡æ¨™ã§ã™ã€‚ifæ–‡ã€foræ–‡ã€whileæ–‡ãªã©ã®åˆ†å²ã‚„ç¹°ã‚Šè¿”ã—ãŒå¢—ãˆã‚‹ã»ã©ã€ã“ã®å€¤ã¯å¤§ãããªã‚Šã¾ã™ã€‚å€¤ãŒé«˜ã„ã»ã©ã‚³ãƒ¼ãƒ‰ã®ç†è§£ãŒé›£ã—ãã€ãƒã‚°ãŒæ··å…¥ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚
> 
> â€” Thomas J. McCabe ã€A Complexity Measureã€

ä¸€èˆ¬çš„ãªç›®å®‰ã¨ã—ã¦ï¼š
- **1-7**: ã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„ï¼ˆæ¨å¥¨ï¼‰
- **8-10**: ã‚„ã‚„è¤‡é›‘ã€æ³¨æ„ãŒå¿…è¦
- **11ä»¥ä¸Š**: è¤‡é›‘ã™ãã‚‹ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ¨å¥¨

ã€Œãªãœ7ãªã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ã“ã‚Œã¯ã€äººé–“ãŒä¸€åº¦ã«ç†è§£ã§ãã‚‹æƒ…å ±ã®é‡ï¼ˆãƒã‚¸ã‚«ãƒ«ãƒŠãƒ³ãƒãƒ¼7Â±2ï¼‰ã«åŸºã¥ã„ãŸçµŒé¨“å‰‡ã§ã™ã€‚ãƒ¡ã‚½ãƒƒãƒ‰ã®å¾ªç’°è¤‡é›‘åº¦ã‚’7ä»¥ä¸‹ã«ä¿ã¤ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®ç†è§£ã—ã‚„ã™ã•ã¨ãƒ†ã‚¹ãƒˆã®ã—ã‚„ã™ã•ã‚’ç¶­æŒã§ãã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰åˆ†æã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet build
```

ã€Œãƒ“ãƒ«ãƒ‰ã™ã‚‹ã ã‘ã§é™çš„ã‚³ãƒ¼ãƒ‰è§£æã‚‚ã—ã¦ãã‚Œã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚ãã—ã¦ã€ã‚‚ã—ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¤‡é›‘ã™ãã‚‹å ´åˆï¼ˆå¾ªç’°è¤‡é›‘åº¦ãŒ7ã‚’è¶…ãˆã‚‹å ´åˆï¼‰ã€è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã‚ˆï¼

```bash
git add .
git commit -m 'chore: é™çš„ã‚³ãƒ¼ãƒ‰è§£æã®è¨­å®š'
```

### ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿

**ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿**ã¯é–‹ç™ºãƒãƒ¼ãƒ å†…ã§ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’çµ±ä¸€ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚C#/.NETã§ã¯`dotnet format`ã‚³ãƒãƒ³ãƒ‰ãŒæ¨™æº–ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚ã€Œã‚ã–ã‚ã–ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãªãã¦ã„ã„ã‚“ã§ã™ã‹ï¼Ÿã€ã¯ã„ã€æœ€åˆã‹ã‚‰ä½¿ãˆã‚‹ã‚“ã§ã™ï¼

ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet format
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ã™ã¹ã¦ã®C#ãƒ•ã‚¡ã‚¤ãƒ«ãŒ`.editorconfig`ã§å®šç¾©ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¾ã™ã€‚ã€Œè‡ªå‹•ã§æ•´å½¢ã—ã¦ãã‚Œã‚‹ãªã‚“ã¦æ¥½ã¡ã‚“ã§ã™ã­ï¼ã€

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ç¢ºèªã®ã¿ã‚’è¡Œã„ãŸã„å ´åˆã¯ï¼š

```bash
dotnet format --verify-no-changes
```

ã€Œã“ã‚Œã£ã¦ä½•ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ã‚³ãƒ¼ãƒ‰ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã ã‘ã—ã¦ã€å®Ÿéš›ã«ã¯å¤‰æ›´ã—ã¾ã›ã‚“ã€‚CI/CDç’°å¢ƒã§ä½¿ã†ã¨ä¾¿åˆ©ã§ã™ã‚ˆï¼

```bash
git add .
git commit -m 'chore: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã®è¨­å®š'
```

### ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸

**ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**ã¯ãƒ†ã‚¹ãƒˆãŒãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ã©ã®ãã‚‰ã„ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã‹ã‚’æ¸¬ã‚‹æŒ‡æ¨™ã§ã™ã€‚ã€Œãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ãŸã¤ã‚‚ã‚Šã ã‘ã©ã€å®Ÿã¯é‡è¦ãªéƒ¨åˆ†ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ãªã‹ã£ãŸ...ã€ãã‚“ãªã“ã¨ã‚’é˜²ããŸã‚ã«å½¹ç«‹ã¡ã¾ã™ã€‚

C#/.NETã§ã¯`coverlet`ãŒã‚ˆãä½¿ã‚ã‚Œã¾ã™ï¼š

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd PuyoPuyoTDD.Tests
dotnet add package coverlet.collector
dotnet add package coverlet.msbuild
cd ..

# ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
dotnet tool install -g dotnet-reportgenerator-globaltool
```

ã€Œdotnet toolã£ã¦ä½•ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼dotnet toolã¯ã€.NET CLIç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ„ãƒ¼ãƒ«ã‚’ç®¡ç†ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚ä¸€åº¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚Œã°ã€ã©ã“ã‹ã‚‰ã§ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã‚ˆã€‚

ãƒ†ã‚¹ãƒˆã‚’ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’åé›†ã—ãªãŒã‚‰ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
dotnet test --collect:"XPlat Code Coverage" --results-directory ./TestResults

# HTMLå½¢å¼ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
reportgenerator -reports:"./TestResults/**/coverage.cobertura.xml" -targetdir:"coverage" -reporttypes:Html
```

ã€Œç”Ÿæˆã•ã‚ŒãŸ`coverage/index.html`ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèªã§ãã¾ã™ï¼ã€ã‚«ãƒ©ãƒ•ãƒ«ãªãƒ¬ãƒãƒ¼ãƒˆã§ã©ã“ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ä¸€ç›®ç­ç„¶ã§ã™ã‚ˆã€‚

ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ã§ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š

```bash
# PuyoPuyoTDDãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«coverage.shã‚’ä½œæˆ
cat > coverage.sh << 'EOF'
#!/bin/bash
# coverage.sh - ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

echo "ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨ã‚«ãƒãƒ¬ãƒƒã‚¸åé›†ä¸­..."
dotnet test --collect:"XPlat Code Coverage" --results-directory ./TestResults

echo "ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­..."
reportgenerator -reports:"./TestResults/**/coverage.cobertura.xml" -targetdir:"coverage" -reporttypes:Html

echo "âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒ coverage/index.html ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸ"
echo ""
echo "ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:"
echo "  \$BROWSER coverage/index.html"
EOF

chmod +x coverage.sh
```

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
./coverage.sh
```

ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒ–ã™ã‚‹ã¨ã€æ¯å›é•·ã„ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ãŸãªãã¦æ¸ˆã‚€ã‹ã‚‰ä¾¿åˆ©ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼

```bash
git add .
git commit -m 'chore: ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¨­å®š'
```

### ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼

è‰¯ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãç¶šã‘ã‚‹ãŸã‚ã«ä»Šã¾ã§è‰²ã€…ãªãƒ„ãƒ¼ãƒ«ã‚’å°å…¥ã—ã¦ãã¾ã—ãŸãŒã€æ¯å›å€‹åˆ¥ã«å®Ÿè¡Œã™ã‚‹ã®ã¯é¢å€’ã§ã™ã€‚ã€Œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ã€ãƒ“ãƒ«ãƒ‰ã—ã¦ã€ãƒ†ã‚¹ãƒˆã—ã¦ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚‚ç¢ºèªã—ã¦...ã€ã†ã‚“ã–ã‚Šã—ã¡ã‚ƒã„ã¾ã™ã‚ˆã­ï¼Ÿ

ãã“ã§**ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼**ã®å‡ºç•ªã§ã™ï¼C#/.NETãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€**Cake**ã¨ã„ã†å¼·åŠ›ãªãƒ“ãƒ«ãƒ‰è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

> Cakeã¨ã¯ã€C#ã‚’DSLï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ç‰¹åŒ–è¨€èªï¼‰ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ“ãƒ«ãƒ‰ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Makeã€Rakeã€PSakeã¨åŒæ§˜ã®æ¦‚å¿µã§ã™ãŒã€C#ã®æ§‹æ–‡ã‚’æ´»ç”¨ã§ãã‚‹ãŸã‚ã€.NETé–‹ç™ºè€…ã«ã¨ã£ã¦è¦ªã—ã¿ã‚„ã™ã„ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ã¾ãšã€Cakeã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ï¼š

```bash
# Cakeãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
dotnet tool install -g Cake.Tool
```

æ¬¡ã«ã€`build.cake`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ã‚ˆãä½¿ã†ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat > build.cake << 'EOF'
///////////////////////////////////////////////////////////////////////////////
// ARGUMENTS
///////////////////////////////////////////////////////////////////////////////

var target = Argument("target", "Default");
var configuration = Argument("configuration", "Release");

///////////////////////////////////////////////////////////////////////////////
// SETUP / TEARDOWN
///////////////////////////////////////////////////////////////////////////////

Setup(ctx =>
{
   Information("Running tasks...");
   Information("Target: {0}", target);
});

Teardown(ctx =>
{
   Information("Finished running tasks.");
});

///////////////////////////////////////////////////////////////////////////////
// TASKS
///////////////////////////////////////////////////////////////////////////////

Task("Clean")
    .Description("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—")
    .Does(() =>
{
    Information("ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œä¸­...");
    DotNetClean("./PuyoPuyoTDD.sln");
    CleanDirectory("./coverage");
    CleanDirectory("./TestResults");
});

Task("Restore")
    .Description("NuGetãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å¾©å…ƒ")
    .IsDependentOn("Clean")
    .Does(() =>
{
    Information("ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¾©å…ƒä¸­...");
    DotNetRestore("./PuyoPuyoTDD.sln");
});

Task("Format")
    .Description("ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å®Ÿè¡Œ")
    .Does(() =>
{
    Information("ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸­...");
    DotNetFormat("./PuyoPuyoTDD.sln");
});

Task("Build")
    .Description("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰")
    .IsDependentOn("Restore")
    .Does(() =>
{
    Information("ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œä¸­...");
    DotNetBuild("./PuyoPuyoTDD.sln", new DotNetBuildSettings
    {
        Configuration = configuration,
        NoRestore = true
    });
});

Task("Test")
    .Description("ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ")
    .IsDependentOn("Build")
    .Does(() =>
{
    Information("ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...");
    DotNetTest("./PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj", new DotNetTestSettings
    {
        Configuration = configuration,
        NoBuild = true,
        NoRestore = true
    });
});

Task("Coverage")
    .Description("ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¸¬å®š")
    .IsDependentOn("Build")
    .Does(() =>
{
    Information("ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šä¸­...");
    
    // ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    DotNetTest("./PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj", new DotNetTestSettings
    {
        Configuration = configuration,
        NoBuild = true,
        NoRestore = true,
        ArgumentCustomization = args => args
            .Append("--collect:\"XPlat Code Coverage\"")
            .Append("--results-directory ./TestResults")
    });
    
    // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    Information("ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...");
    StartProcess("reportgenerator", new ProcessSettings
    {
        Arguments = new ProcessArgumentBuilder()
            .Append("-reports:./TestResults/**/coverage.cobertura.xml")
            .Append("-targetdir:./coverage")
            .Append("-reporttypes:Html")
    });
    
    Information("âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒ coverage/index.html ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸ");
});

Task("Quality")
    .Description("ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ")
    .IsDependentOn("Format")
    .IsDependentOn("Build")
    .IsDependentOn("Test")
    .IsDependentOn("Coverage")
    .Does(() =>
{
    Information("âœ… ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
});

Task("Watch")
    .Description("ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã¨è‡ªå‹•ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆ")
    .Does(() =>
{
    Information("ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã‚’é–‹å§‹ã—ã¾ã™...");
    Information("çµ‚äº†ã™ã‚‹ã«ã¯ Ctrl+C ã‚’æŠ¼ã—ã¦ãã ã•ã„");
    
    var settings = new DotNetWatchSettings
    {
        Project = "./PuyoPuyoTDD.Tests/PuyoPuyoTDD.Tests.csproj"
    };
    
    DotNetWatch("test", settings);
});

Task("Default")
    .Description("ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¹ã‚¯ï¼ˆQualityï¼‰")
    .IsDependentOn("Quality");

///////////////////////////////////////////////////////////////////////////////
// EXECUTION
///////////////////////////////////////////////////////////////////////////////

RunTarget(target);
EOF
```

ã€Œã“ã®Cakeãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½•ã‚’ã—ã¦ãã‚Œã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼ã“ã®Cakeãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã€ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ï¼š

- **Clean**: ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã¨ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **Restore**: NuGetãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¾©å…ƒ
- **Format**: ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- **Build**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰
- **Test**: ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
- **Coverage**: ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã—ã¦ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- **Quality**: ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- **Watch**: ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã¨è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¹ã‚¯ï¼ˆQualityï¼‰ã‚’å®Ÿè¡Œ
dotnet cake

# ç‰¹å®šã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
dotnet cake --target=Clean
dotnet cake --target=Format
dotnet cake --target=Build
dotnet cake --target=Test
dotnet cake --target=Coverage

# ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
dotnet cake --target=Quality
```

ã€ŒCakeã‚’ä½¿ã†ã¨ã€C#ã®æ§‹æ–‡ã§ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ›¸ã‘ã‚‹ã®ã§ã€.NETé–‹ç™ºè€…ã«ã¨ã£ã¦ã¨ã¦ã‚‚è‡ªç„¶ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼

Cakeã®è‰¯ã„ã¨ã“ã‚ã¯ï¼š

1. **C#ã§æ›¸ã‘ã‚‹**: .NETé–‹ç™ºè€…ã«ã¨ã£ã¦è¦ªã—ã¿ã‚„ã™ã„
2. **ä¾å­˜é–¢ä¿‚ç®¡ç†**: ã‚¿ã‚¹ã‚¯é–“ã®ä¾å­˜é–¢ä¿‚ã‚’è‡ªå‹•ã§è§£æ±º
3. **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Windowsã€Linuxã€macOSã§å‹•ä½œ
4. **è±Šå¯Œãªã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ **: å¤šãã®ã‚¢ãƒ‰ã‚¤ãƒ³ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼ãŒåˆ©ç”¨å¯èƒ½

```bash
git add .
git commit -m 'chore: Cakeã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã®è¨­å®š'
```

### ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•åŒ–

**Cake**ã«ã‚ˆã‚Šå“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚¿ã‚¹ã‚¯ã¯ç”¨æ„ã•ã‚Œã¾ã—ãŸãŒã€ã¾ã æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãŸã³ã«è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãŒèµ°ã£ãŸã‚‰ä¾¿åˆ©ãªã®ã«ãª...ã€ã¨æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿ

å®Ÿã¯ã€Cakeã«ã¯**Watch**ã‚¿ã‚¹ã‚¯ã‚’ä½¿ã£ã¦è‡ªå‹•å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ãŒæ—¢ã«å«ã¾ã‚Œã¦ã„ã¾ã™ï¼ã¾ãŸã€ã‚ˆã‚Šç´°ã‹ã„åˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆã¯ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

#### æ–¹æ³•1: Cakeã®çµ„ã¿è¾¼ã¿Watchã‚¿ã‚¹ã‚¯ã‚’ä½¿ç”¨

æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹æ³•ã¯ã€`build.cake`ã§å®šç¾©ã—ãŸ`Watch`ã‚¿ã‚¹ã‚¯ã‚’ä½¿ã†ã“ã¨ã§ã™ï¼š

```bash
# Cakeã®watchã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
dotnet cake --target=Watch
```

ã€Œã“ã‚Œã ã‘ã§è‡ªå‹•ãƒ†ã‚¹ãƒˆãŒå‹•ãã‚“ã§ã™ã­ï¼ã€ãã†ãªã‚“ã§ã™ã€‚.NET CLIã®`dotnet watch`ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã‚ˆã€‚

#### æ–¹æ³•2: ã‚«ã‚¹ã‚¿ãƒ ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼ˆé«˜åº¦ãªåˆ¶å¾¡ï¼‰

ã‚‚ã—ã€Cakeã‚¿ã‚¹ã‚¯ã‚’çµ„ã¿åˆã‚ã›ãŸè‡ªå‹•å®Ÿè¡ŒãŒå¿…è¦ãªå ´åˆã¯ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚Linuxã®`inotify-tools`ã‚’ä½¿ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š

```bash
# inotify-toolsãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
which inotifywait || sudo apt-get update && sudo apt-get install -y inotify-tools
```

ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã¨è‡ªå‹•å®Ÿè¡Œã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ`watch.sh`ã‚’ä½œæˆã—ã¾ã™ï¼š

```bash
cat > watch.sh << 'EOF'
#!/bin/bash
# watch.sh - Cakeã‚’ä½¿ã£ãŸè‡ªå‹•å“è³ªãƒã‚§ãƒƒã‚¯

echo "=== C#/.NET Blazor ã·ã‚ˆã·ã‚ˆTDD ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–é–‹å§‹ ==="
echo "ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–ä¸­..."
echo "çµ‚äº†ã™ã‚‹ã«ã¯ Ctrl+C ã‚’æŠ¼ã—ã¦ãã ã•ã„"
echo ""

# åˆå›å®Ÿè¡Œ
echo "ğŸ”„ åˆå›å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ..."
dotnet cake --target=Quality

# ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–é–‹å§‹ï¼ˆPuyoPuyoTDDã¨PuyoPuyoTDD.Testsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç›£è¦–ï¼‰
inotifywait -m -r -e modify,create,delete \
    --include='\.cs$|\.razor$|\.cake$' \
    --exclude='(bin|obj|coverage|TestResults|tools)/' \
    PuyoPuyoTDD/ PuyoPuyoTDD.Tests/ build.cake 2>/dev/null | while read path action file; do
    
    echo ""
    echo "ğŸ“ å¤‰æ›´æ¤œå‡º: $file ($action)"
    echo "ğŸ”„ Cakeã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œä¸­..."
    
    # Cakeã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
    dotnet cake --target=Format
    dotnet cake --target=Build
    dotnet cake --target=Test
    
    if [ $? -eq 0 ]; then
        echo "âœ… ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã—ã¾ã—ãŸ"
    else
        echo "âŒ ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ"
    fi
    echo ""
done
EOF

chmod +x watch.sh
```

ã€Œã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä½•ã‚’ã—ã¦ãã‚Œã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ï¼š

1. æœ€åˆã«ä¸€åº¦ã€Cakeã®`Quality`ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã€ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
2. ãã®å¾Œã€`.cs`ã€`.razor`ã€`.cake`ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¾ã™
3. ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ã€è‡ªå‹•çš„ã«Cakeã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™
4. çµæœã‚’è¦‹ã‚„ã™ãè¡¨ç¤ºã—ã¦ãã‚Œã¾ã™ï¼ˆâœ…æˆåŠŸã€âŒå¤±æ•—ï¼‰

ã€Œå®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼ã€

```bash
# Cakeã®çµ„ã¿è¾¼ã¿Watchã‚’ä½¿ã†ï¼ˆæ¨å¥¨ï¼‰
dotnet cake --target=Watch

# ã¾ãŸã¯ã€ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ã†
./watch.sh
```

ã€Œã‚ãã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãŸã³ã«è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãŒèµ°ã‚Šã¾ã™ã­ï¼ã“ã‚Œã¯ä¾¿åˆ©ï¼ã€ãã†ãªã‚“ã§ã™ã€‚ã“ã‚Œã§ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã ã‘ã«é›†ä¸­ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

#### ã©ã¡ã‚‰ã®æ–¹æ³•ã‚’é¸ã¶ã¹ãï¼Ÿ

- **Cakeã®çµ„ã¿è¾¼ã¿Watch**: ã‚·ãƒ³ãƒ—ãƒ«ã§ã€ãƒ†ã‚¹ãƒˆã®è‡ªå‹•å®Ÿè¡Œã ã‘ãŒå¿…è¦ãªå ´åˆ
- **ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ã‚«ãƒãƒ¬ãƒƒã‚¸ãªã©ã€è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã‚’çµ„ã¿åˆã‚ã›ãŸã„å ´åˆ

ã€Œã»ã¨ã‚“ã©ã®å ´åˆã¯ã€Cakeã®çµ„ã¿è¾¼ã¿Watchã§ååˆ†ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚é–‹ç™ºä¸­ã¯`dotnet cake --target=Watch`ã‚’å®Ÿè¡Œã—ã¦ãŠã‘ã°ã€ãƒ†ã‚¹ãƒˆãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦ã€ä½•ã‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚å¤‰æ›´ãŒæ¤œå‡ºã•ã‚Œã¦è‡ªå‹•çš„ã«ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã¯ãšã§ã™ã€‚

ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒç¢ºèªã§ããŸã‚‰ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚ã“ã®ã¨ãã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã¯`Watch`ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå‹•ã„ã¦ã„ã‚‹ã®ã§ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦ã‚³ãƒŸãƒƒãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

```bash
git add .
git commit -m 'chore: ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•åŒ–'
```

### å‹•ä½œç¢ºèª

ã•ã¦ã€ã“ã“ã¾ã§ã§ç’°å¢ƒæ§‹ç¯‰ã¯å®Œäº†ã§ã™ï¼ã€Œæœ¬å½“ã«å‹•ãã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã€ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€ã™ã¹ã¦ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ï¼š

```bash
# ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
cat > PuyoPuyoTDD.Tests/SampleTest.cs << 'EOF'
using Xunit;

namespace PuyoPuyoTDD.Tests;

public class SampleTest
{
    [Fact]
    public void åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆãŒå‹•ä½œã™ã‚‹()
    {
        // Arrangeï¼ˆæº–å‚™ï¼‰
        int a = 1;
        int b = 2;

        // Actï¼ˆå®Ÿè¡Œï¼‰
        int result = a + b;

        // Assertï¼ˆæ¤œè¨¼ï¼‰
        Assert.Equal(3, result);
    }

    [Theory]
    [InlineData(1, 2, 3)]
    [InlineData(0, 0, 0)]
    [InlineData(-1, 1, 0)]
    public void è¤‡æ•°ã®ã‚±ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹(int a, int b, int expected)
    {
        // Act
        int result = a + b;

        // Assert
        Assert.Equal(expected, result);
    }
}
EOF
```

ã€Œã“ã®ãƒ†ã‚¹ãƒˆã¯ä½•ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼ã“ã‚Œã¯å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆã§ã¯ãªãã€ç’°å¢ƒãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚ã€Œ1+2=3ã€ã¨ã„ã†ç°¡å˜ãªè¨ˆç®—ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
# ã¾ãŸã¯ã€Cakeã‚’ä½¿ã£ã¦
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼ã§ã¯ã€ã‚ã–ã¨å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
cat >> PuyoPuyoTDD.Tests/SampleTest.cs << 'EOF'

    [Fact]
    public void ã‚ã–ã¨å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆ()
    {
        // ã‚ã–ã¨é–“é•ã£ãŸæœŸå¾…å€¤ã‚’è¨­å®š
        Assert.Equal(5, 1 + 2);
    }
}
EOF
```

ã‚‚ã†ä¸€åº¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
# ã¾ãŸã¯ã€Cakeã‚’ä½¿ã£ã¦
./build.sh --target=Test
```
    }
EOF
```

ã‚‚ã†ä¸€åº¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
# ã¾ãŸã¯ã€Cakeã‚’ä½¿ã£ã¦
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã­ï¼ã€ãã†ã§ã™ã€‚ã“ã‚Œã¯æœŸå¾…é€šã‚Šã®å‹•ä½œã§ã™ã€‚ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚‚æ­£ã—ãæ¤œå‡ºã§ãã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

ã§ã¯ã€å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å‰Šé™¤ã—ã¦ã€ã‚‚ã†ä¸€åº¦ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```bash
# å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å‰Šé™¤ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«æˆ»ã™ï¼‰
cat > PuyoPuyoTDD.Tests/SampleTest.cs << 'EOF'
using Xunit;

namespace PuyoPuyoTDD.Tests;

public class SampleTest
{
    [Fact]
    public void åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆãŒå‹•ä½œã™ã‚‹()
    {
        // Arrangeï¼ˆæº–å‚™ï¼‰
        int a = 1;
        int b = 2;

        // Actï¼ˆå®Ÿè¡Œï¼‰
        int result = a + b;

        // Assertï¼ˆæ¤œè¨¼ï¼‰
        Assert.Equal(3, result);
    }

    [Theory]
    [InlineData(1, 2, 3)]
    [InlineData(0, 0, 0)]
    [InlineData(-1, 1, 0)]
    public void è¤‡æ•°ã®ã‚±ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹(int a, int b, int expected)
    {
        // Act
        int result = a + b;

        // Assert
        Assert.Equal(expected, result);
    }
}
EOF

dotnet test
# ã¾ãŸã¯ã€Cakeã‚’ä½¿ã£ã¦
dotnet cake --target=Test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€å®Œç’§ã§ã™ï¼

æœ€å¾Œã«ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚‚ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
# Cakeã‚’ä½¿ã£ã¦ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®š
dotnet cake --target=Coverage
```

ã€Œcoverage/index.htmlãŒã§ãã¾ã—ãŸã­ï¼ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
$BROWSER coverage/index.html
```

ã€Œã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã‚Œã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼ã“ã‚Œã§ã€ã©ã®ã‚³ãƒ¼ãƒ‰ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹è¦–è¦šçš„ã«ç¢ºèªã§ãã¾ã™ã­ã€‚

Cakeã®ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’ä¸€åº¦ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

```bash
# ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
dotnet cake --target=Quality
# ã¾ãŸã¯
dotnet cake  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§Qualityã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹
```

ã€ŒFormatâ†’Buildâ†’Testâ†’CoverageãŒé †ç•ªã«å®Ÿè¡Œã•ã‚Œã¾ã—ãŸã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚Cakeã®ã‚¿ã‚¹ã‚¯ä¾å­˜é–¢ä¿‚ãŒè‡ªå‹•çš„ã«è§£æ±ºã•ã‚Œã¦ã€å¿…è¦ãªã‚¿ã‚¹ã‚¯ãŒé †ç•ªã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã™ã¹ã¦ã®ç¢ºèªãŒçµ‚ã‚ã£ãŸã‚‰ã€ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'test: ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆã®è¿½åŠ '
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã“ã¾ã§ã§ã€ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼š

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ**: Blazor WebAssemblyãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
2. **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Gitãƒªãƒã‚¸ãƒˆãƒªã®åˆæœŸåŒ–ã¨ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¦ç´„
3. **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†**: NuGetã‚’ä½¿ã£ãŸä¾å­˜é–¢ä¿‚ã®ç®¡ç†ï¼ˆbUnitã€Coverletãªã©ï¼‰
4. **é™çš„ã‚³ãƒ¼ãƒ‰è§£æ**: Microsoft.CodeAnalysis.Analyzersã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰å“è³ªã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯
5. **ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿**: dotnet formatã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã®çµ±ä¸€
6. **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: Coverlet + ReportGeneratorã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¸¬å®šã¨å¯è¦–åŒ–
7. **ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼**: Cakeã«ã‚ˆã‚‹C#ãƒ™ãƒ¼ã‚¹ã®ãƒ“ãƒ«ãƒ‰è‡ªå‹•åŒ–
8. **ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•åŒ–**: dotnet watchã¾ãŸã¯inotify-toolsã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã¨è‡ªå‹•å®Ÿè¡Œ

ã“ã‚Œã§[ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã®ä¸‰ç¨®ã®ç¥å™¨](https://t-wada.hatenablog.jp/entry/clean-code-that-works)ãŒæƒã„ã¾ã—ãŸï¼š

- âœ… **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Git + Angularãƒ«ãƒ¼ãƒ«ã®ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- âœ… **ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: xUnit + bUnit + Coverlet
- âœ… **è‡ªå‹•åŒ–**: Cake + dotnet watchï¼ˆã¾ãŸã¯ã‚«ã‚¹ã‚¿ãƒ watch.shï¼‰

**Cakeã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ**:
- C#ã§æ›¸ã‘ã‚‹ã®ã§.NETé–‹ç™ºè€…ã«ã¨ã£ã¦è‡ªç„¶
- ã‚¿ã‚¹ã‚¯ã®ä¾å­˜é–¢ä¿‚ã‚’å®£è¨€çš„ã«å®šç¾©ã§ãã‚‹
- ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å‹•ä½œ
- è±Šå¯Œãªã‚¢ãƒ‰ã‚¤ãƒ³ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼æ©Ÿèƒ½
- IDEçµ±åˆã¨ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒ¼ãƒˆ

ã€Œã“ã‚Œã§ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã‚’å§‹ã‚ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã¯ã€å®Ÿéš›ã«ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã‚ˆã€‚

é–‹ç™ºã‚’å§‹ã‚ã‚‹ã¨ãã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãŠã‘ã°ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãŸã³ã«è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ãƒªã‚ºãƒ ï¼ˆRed-Green-Refactorï¼‰ã«é›†ä¸­ã§ãã¾ã™ã­ï¼

```bash
# æ–¹æ³•1: Cakeã®çµ„ã¿è¾¼ã¿Watchã‚’ä½¿ã†ï¼ˆæ¨å¥¨ï¼‰
dotnet cake --target=Watch

# æ–¹æ³•2: ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ã†ï¼ˆã‚ˆã‚Šè©³ç´°ãªåˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆï¼‰
./watch.sh

# æ–¹æ³•3: å“è³ªãƒã‚§ãƒƒã‚¯ã‚’æ‰‹å‹•å®Ÿè¡Œ
dotnet cake --target=Quality

# åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†
# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãŸã³ã«è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼
```

**ã‚ˆãä½¿ã†Cakeã‚³ãƒãƒ³ãƒ‰**:
```bash
dotnet cake                      # ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
dotnet cake --target=Clean       # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
dotnet cake --target=Format      # ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
dotnet cake --target=Build       # ãƒ“ãƒ«ãƒ‰
dotnet cake --target=Test        # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
dotnet cake --target=Coverage    # ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
dotnet cake --target=Watch       # è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```

ãã‚Œã§ã¯ã€æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1ã§å®Ÿéš›ã®ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ã®å®Ÿè£…ã«å–ã‚Šçµ„ã‚“ã§ã„ãã¾ã—ã‚‡ã†ï¼

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1: ã‚²ãƒ¼ãƒ é–‹å§‹ã®å®Ÿè£…

ã•ã‚ã€ã„ã‚ˆã„ã‚ˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã¾ã—ã‚‡ã†ï¼ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€å°ã•ãªã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåå¾©ï¼‰ã§æ©Ÿèƒ½ã‚’å°‘ã—ãšã¤è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚æœ€åˆã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€æœ€ã‚‚åŸºæœ¬çš„ãªæ©Ÿèƒ½ã§ã‚ã‚‹ã€Œã‚²ãƒ¼ãƒ ã®é–‹å§‹ã€ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

> ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¨ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’å°ã•ãªæ©Ÿèƒ½å˜ä½ã§ç¹°ã‚Šè¿”ã—é–‹ç™ºã—ã¦ã„ãæ‰‹æ³•ã§ã™ã€‚å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§è¨ˆç”»ã€è¨­è¨ˆã€å®Ÿè£…ã€ãƒ†ã‚¹ãƒˆã€è©•ä¾¡ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å›ã™ã“ã¨ã§ã€ãƒªã‚¹ã‚¯ã‚’æ—©æœŸã«ç™ºè¦‹ã—ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å¾—ãªãŒã‚‰é–‹ç™ºã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
> 
> â€” Craig Larman ã€ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™ºã¨ã‚¹ã‚¯ãƒ©ãƒ ã€

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹

ã“ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã§ã€ã‚²ãƒ¼ãƒ ã®åŸºæœ¬çš„ãªæ§‹é€ ã‚’ä½œã‚Šã€å¾Œç¶šã®æ©Ÿèƒ½è¿½åŠ ã®åœŸå°ã‚’ç¯‰ãã“ã¨ãŒã§ãã¾ã™ã€‚ã§ã¯ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚µã‚¤ã‚¯ãƒ«ã«å¾“ã£ã¦ã€ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### TODOãƒªã‚¹ãƒˆ

ã•ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã€ã¾ãšã¯TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚TODOãƒªã‚¹ãƒˆã¯ã€å¤§ããªæ©Ÿèƒ½ã‚’å°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®é‡è¦ãªãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®ä¸€ã¤ã§ã™ã€‚å®Ÿè£…å‰ã«å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºã®æ–¹å‘æ€§ã‚’ä¿ã¡ã€ä½•ã‚‚è¦‹è½ã¨ã•ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ç§ãŸã¡ã®ã€Œæ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹ã€ã¨ã„ã†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ã©ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ã§ã—ã‚‡ã†ã‹ï¼Ÿè€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚„å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹ï¼‰
- Blazorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦–è¦šçš„ã«ã‚²ãƒ¼ãƒ ã‚’èªè­˜ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰
- æ–°ã—ã„ã·ã‚ˆã‚’ç”Ÿæˆã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã«æœ€åˆã®ã·ã‚ˆã‚’ä½œæˆã™ã‚‹ï¼‰
- ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹ã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã®ç¶™ç¶šçš„ãªæ›´æ–°ã¨æç”»ã‚’è¡Œã†ï¼‰

ã“ã‚Œã‚‰ã®ã‚¿ã‚¹ã‚¯ã‚’ä¸€ã¤ãšã¤å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€å„ã‚¿ã‚¹ã‚¯ã«å¯¾ã—ã¦ãƒ†ã‚¹ãƒˆâ†’å®Ÿè£…â†’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å›ã—ã¾ã™ã€‚ã¾ãšã¯ã€Œã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã€ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼

### ãƒ†ã‚¹ãƒˆ: ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–

ã•ã¦ã€TODOãƒªã‚¹ãƒˆã®æœ€åˆã®ã‚¿ã‚¹ã‚¯ã€Œã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€ã«å–ã‚Šæ›ã‹ã‚Šã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€ã¾ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚

> ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
> 
> ã„ã¤ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¹ãã ã‚ã†ã‹â€”â€”ãã‚Œã¯ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã§ã¯ã€ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã¹ãã§ã—ã‚‡ã†ã‹ï¼Ÿã‚²ãƒ¼ãƒ ãŒåˆæœŸåŒ–ã•ã‚ŒãŸã¨ãã€å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãä½œæˆã•ã‚Œã€ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã­ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/GameTest.cs
using Xunit;
using PuyoPuyoTDD.Models;

namespace PuyoPuyoTDD.Tests.Models;

public class GameTest
{
    [Fact]
    public void ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã™ã‚‹ã¨å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½œæˆã•ã‚Œã‚‹()
    {
        // Arrange & Act
        var game = new Game();
        game.Initialize();

        // Assert
        Assert.NotNull(game.Config);
        Assert.NotNull(game.Stage);
        Assert.NotNull(game.Player);
        Assert.NotNull(game.Score);
    }

    [Fact]
    public void ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ãŒStartã«ãªã‚‹()
    {
        // Arrange
        var game = new Game();

        // Act
        game.Initialize();

        // Assert
        Assert.Equal(GameMode.Start, game.Mode);
    }
}
```

ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ã€`Game`ã‚¯ãƒ©ã‚¹ã®`Initialize`ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆConfig, Stage, Player, Scoreï¼‰ãŒä½œæˆã•ã‚Œã€ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ãŒ`Start`ã«è¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™ã€‚

### å®Ÿè£…: ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–

ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ãŸã‚‰ã€æ¬¡ã«å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã©ã†ãªã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ

```
error CS0246: å‹ã¾ãŸã¯åå‰ç©ºé–“ã®åå‰ 'Game' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ
```

ãŠã£ã¨ï¼ã¾ã `Game`ã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ãªã„ã®ã§ã€å½“ç„¶ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã­ã€‚ã“ã‚ŒãŒãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã€ŒRedï¼ˆèµ¤ï¼‰ã€ã®çŠ¶æ…‹ã§ã™ã€‚ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚

> å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆ
> 
> ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰å®Ÿè£…ã«å–ã‚Šæ›ã‹ã‚ã†ã€‚ãã†ã™ã‚Œã°ã€ãƒ†ã‚¹ãƒˆãŒæ­£ã—ãæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã€Œæœ€å°é™ã€ã¨ã„ã†ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚ã“ã®æ®µéšã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã ã‘ã‚’ç›®æŒ‡ã—ã¦ã€å¿…è¦æœ€ä½é™ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã™ã€‚

```csharp
// PuyoPuyoTDD/Models/Game.cs
namespace PuyoPuyoTDD.Models;

public enum GameMode
{
    Start,
    CheckFall,
    Fall,
    CheckErase,
    Erasing,
    NewPuyo,
    Playing,
    GameOver
}

public class Game
{
    public Config Config { get; private set; } = null!;
    public Stage Stage { get; private set; } = null!;
    public Player Player { get; private set; } = null!;
    public Score Score { get; private set; } = null!;
    public GameMode Mode { get; private set; }
    
    private int _frame;
    private int _combinationCount;

    public void Initialize()
    {
        // å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆæœŸåŒ–
        Config = new Config();
        Stage = new Stage(Config);
        Player = new Player(Config, Stage);
        Score = new Score();

        // ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®š
        Mode = GameMode.Start;
        _frame = 0;
        _combinationCount = 0;
    }
}
```

### è§£èª¬: ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–

ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚ã“ã‚ŒãŒãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã€ŒGreenï¼ˆç·‘ï¼‰ã€ã®çŠ¶æ…‹ã§ã™ã€‚

> ãƒ†ã‚¹ãƒˆãŒé€šã£ãŸã‚‰ã€æ¬¡ã¯ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã ã€‚ã§ã‚‚ã€ãã®å‰ã«å°‘ã—ç«‹ã¡æ­¢ã¾ã£ã¦ã€ä»Šæ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦è€ƒãˆã¦ã¿ã‚ˆã†ã€‚
> 
> â€” Martin Fowler ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€

å®Ÿè£…ã—ãŸã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã«ã¤ã„ã¦ã€å°‘ã—è§£èª¬ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚ã“ã®å‡¦ç†ã§ã¯ã€ä¸»ã«ä»¥ä¸‹ã®ã“ã¨ã‚’è¡Œã£ã¦ã„ã¾ã™ï¼š

1. å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆConfig, Stage, Player, Scoreï¼‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
2. ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’`Start`ã«è¨­å®š
3. ãƒ•ãƒ¬ãƒ¼ãƒ ã‚«ã‚¦ãƒ³ã‚¿ã¨é€£é–ã‚«ã‚¦ãƒ³ã‚¿ã‚’åˆæœŸåŒ–

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹ãŸã‚ã®æº–å‚™ãŒæ•´ã„ã¾ã™ã€‚å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å½¹å‰²ã‚’ç†è§£ã—ã¦ãŠãã¨ã€ä»Šå¾Œã®å®Ÿè£…ãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã‚ˆï¼š

- **Config**: ã‚²ãƒ¼ãƒ ã®è¨­å®šå€¤ã‚’ç®¡ç†ã—ã¾ã™ï¼ˆç”»é¢ã‚µã‚¤ã‚ºã€ã·ã‚ˆã®å¤§ãã•ãªã©ï¼‰
- **Stage**: ã‚²ãƒ¼ãƒ ã®ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆç›¤é¢ï¼‰ã‚’ç®¡ç†ã—ã¾ã™ï¼ˆã·ã‚ˆã®é…ç½®çŠ¶æ…‹ã€æ¶ˆå»åˆ¤å®šãªã©ï¼‰
- **Player**: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›ã¨æ“ä½œã‚’ç®¡ç†ã—ã¾ã™ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã®å‡¦ç†ã€ã·ã‚ˆã®ç§»å‹•ãªã©ï¼‰
- **Score**: ã‚¹ã‚³ã‚¢ã®è¨ˆç®—ã¨è¡¨ç¤ºã‚’ç®¡ç†ã—ã¾ã™ï¼ˆé€£é–æ•°ã«å¿œã˜ãŸã‚¹ã‚³ã‚¢è¨ˆç®—ãªã©ï¼‰

ã“ã®ã‚ˆã†ã«ã€è²¬ä»»ã‚’æ˜ç¢ºã«åˆ†ã‘ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®ä¿å®ˆæ€§ãŒé«˜ã¾ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨­è¨ˆã®åŸºæœ¬åŸå‰‡ã®ä¸€ã¤ã€ã€Œå˜ä¸€è²¬ä»»ã®åŸå‰‡ã€ã«å¾“ã£ã¦ã„ã¾ã™ã€‚

> å˜ä¸€è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ï¼šã‚¯ãƒ©ã‚¹ã‚’å¤‰æ›´ã™ã‚‹ç†ç”±ã¯1ã¤ã ã‘ã§ã‚ã‚‹ã¹ãã€‚
> 
> â€” Robert C. Martin ã€Clean Architectureã€

### Blazorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

æ¬¡ã«ã€ã‚²ãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®Blazorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚Blazor WebAssemblyã§ã¯ã€Razorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ã£ã¦UIã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

```razor
@* PuyoPuyoTDD/Pages/GamePage.razor *@
@page "/game"
@using PuyoPuyoTDD.Models
@inject IJSRuntime JSRuntime

<div class="game-container">
    <h3>ã·ã‚ˆã·ã‚ˆ TDD</h3>
    <div class="game-area">
        <canvas id="stage" width="192" height="384"></canvas>
        <div class="info-panel">
            <div class="score-display">
                <p>ã‚¹ã‚³ã‚¢</p>
                <p id="score">0</p>
            </div>
            <div class="next-display">
                <p>NEXT</p>
                <canvas id="next" width="32" height="64"></canvas>
            </div>
        </div>
    </div>
</div>

@code {
    private Game? _game;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _game = new Game();
            _game.Initialize();
            await JSRuntime.InvokeVoidAsync("startGameLoop", DotNetObjectReference.Create(this));
        }
    }

    [JSInvokable]
    public void UpdateGame()
    {
        _game?.Update();
    }
}
```

### è§£èª¬: Blazorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

ã“ã®Blazorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’è¡Œã£ã¦ã„ã¾ã™ï¼š

1. **Canvasè¦ç´ ã®é…ç½®**: ã‚²ãƒ¼ãƒ ã®ç›¤é¢ã¨NEXTã·ã‚ˆã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®canvasè¦ç´ ã‚’é…ç½®
2. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«**: `OnAfterRenderAsync`ãƒ¡ã‚½ãƒƒãƒ‰ã§åˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã«ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–
3. **JavaScriptç›¸äº’é‹ç”¨**: `JSRuntime`ã‚’ä½¿ã£ã¦JavaScriptã®ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã‚’å‘¼ã³å‡ºã™
4. **JSInvokableå±æ€§**: JavaScriptå´ã‹ã‚‰C#ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹

Blazor WebAssemblyã§ã¯ã€ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®ã‚ˆã†ãªé«˜é »åº¦ã®å‡¦ç†ã¯JavaScriptå´ã§å®Ÿè¡Œã—ã€C#å´ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å‘¼ã³å‡ºã™æ–¹å¼ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã§ãã¾ã™ã€‚

### JavaScriptã®å®Ÿè£…

Blazorã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹JavaScriptå´ã®å®Ÿè£…ã‚‚å¿…è¦ã§ã™ã€‚

```javascript
// wwwroot/js/game.js
window.startGameLoop = function (dotnetHelper) {
    function gameLoop() {
        dotnetHelper.invokeMethodAsync('UpdateGame');
        requestAnimationFrame(gameLoop);
    }
    requestAnimationFrame(gameLoop);
};
```

ã“ã®JavaScriptã‚³ãƒ¼ãƒ‰ã§ã¯ã€`requestAnimationFrame`ã‚’ä½¿ã£ã¦60FPSã§ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã‚’å®Ÿè¡Œã—ã€å„ãƒ•ãƒ¬ãƒ¼ãƒ ã§C#å´ã®`UpdateGame`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2: ã·ã‚ˆã®ç§»å‹•ã®å®Ÿè£…

ã•ã¦ã€å‰å›ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚²ãƒ¼ãƒ ã®åŸºæœ¬çš„ãªæ§‹é€ ãŒã§ãã¾ã—ãŸã­ã€‚ã€Œã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã£ãŸã‘ã©ã€ã·ã‚ˆãŒå‹•ã‹ãªã„ã¨é¢ç™½ããªã„ã‚ˆã­ï¼Ÿã€ã¨æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿãã“ã§æ¬¡ã¯ã€ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã§ãã‚‹

ã€Œã·ã‚ˆã·ã‚ˆã£ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å·¦å³ã«å‹•ã‹ã—ã¦ã€ã†ã¾ãç©ã¿ä¸Šã’ã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã‚ˆã­ï¼Ÿã€ãã†ã§ã™ï¼ä»Šå›ã¯ãã®åŸºæœ¬æ“ä½œã§ã‚ã‚‹ã€Œå·¦å³ã®ç§»å‹•ã€ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

### TODOãƒªã‚¹ãƒˆ

ã•ã¦ã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€ã©ã‚“ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ã§ã—ã‚‡ã†ã‹ï¼Ÿä¸€ç·’ã«è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€å¤§ããªå•é¡Œã‚’å°ã•ãªå•é¡Œã«åˆ†å‰²ã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚è¤‡é›‘ãªå•é¡Œã«ç›´é¢ã—ãŸã¨ãã€ãã‚Œã‚’ç®¡ç†å¯èƒ½ãªå°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã™ã‚‹ã“ã¨ã§ã€ä¸€æ­©ä¸€æ­©ç¢ºå®Ÿã«å‰é€²ã§ãã¾ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã€Œã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã™ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›ã‚’æ¤œå‡ºã™ã‚‹ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å·¦å³ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹ï¼‰
- ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆå®Ÿéš›ã«ã·ã‚ˆã®ä½ç½®ã‚’å¤‰æ›´ã™ã‚‹ï¼‰
- ç§»å‹•å¯èƒ½ã‹ã©ã†ã‹ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆç”»é¢ã®ç«¯ã‚„ä»–ã®ã·ã‚ˆã«ã¶ã¤ã‹ã‚‹å ´åˆã¯ç§»å‹•ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰
- ç§»å‹•å¾Œã®è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹ï¼ˆç”»é¢ä¸Šã§ã·ã‚ˆã®ä½ç½®ãŒå¤‰ã‚ã£ãŸã“ã¨ã‚’è¡¨ç¤ºã™ã‚‹ï¼‰

ã€Œãªã‚‹ã»ã©ã€é †ç•ªã«å®Ÿè£…ã—ã¦ã„ã‘ã°ã„ã„ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€ä¸€ã¤ãšã¤é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æµã‚Œã«æ²¿ã£ã¦ã€ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã™ã‚ˆã€‚

### ãƒ†ã‚¹ãƒˆ: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›æ¤œå‡º

ã€Œæœ€åˆã«ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚Œã°ã„ã„ã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€ã¾ãšã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›ã‚’æ¤œå‡ºã™ã‚‹éƒ¨åˆ†ã‹ã‚‰ãƒ†ã‚¹ãƒˆã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å·¦å³ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«ã€ãã‚Œã‚’æ­£ã—ãæ¤œçŸ¥ã§ãã‚‹ã‹ã©ã†ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

> ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
> 
> ã„ã¤ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¹ãã ã‚ã†ã‹â€”â€”ãã‚Œã¯ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

```csharp
// PuyoPuyoTDD.Tests/Models/PlayerTest.cs
using Xunit;
using PuyoPuyoTDD.Models;

namespace PuyoPuyoTDD.Tests.Models;

public class PlayerTest
{
    private readonly Config _config;
    private readonly Stage _stage;
    private readonly Player _player;

    public PlayerTest()
    {
        _config = new Config();
        _stage = new Stage(_config);
        _player = new Player(_config, _stage);
    }

    [Fact]
    public void å·¦ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã‚‹ã¨å·¦å‘ãã®ç§»å‹•ãƒ•ãƒ©ã‚°ãŒç«‹ã¤()
    {
        // Act
        _player.SetInputLeft(true);

        // Assert
        Assert.True(_player.InputKeyLeft);
    }

    [Fact]
    public void å³ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã‚‹ã¨å³å‘ãã®ç§»å‹•ãƒ•ãƒ©ã‚°ãŒç«‹ã¤()
    {
        // Act
        _player.SetInputRight(true);

        // Assert
        Assert.True(_player.InputKeyRight);
    }

    [Fact]
    public void ã‚­ãƒ¼ãŒé›¢ã•ã‚Œã‚‹ã¨å¯¾å¿œã™ã‚‹ç§»å‹•ãƒ•ãƒ©ã‚°ãŒä¸‹ãŒã‚‹()
    {
        // Arrange
        _player.SetInputLeft(true);
        Assert.True(_player.InputKeyLeft);

        // Act
        _player.SetInputLeft(false);

        // Assert
        Assert.False(_player.InputKeyLeft);
    }
}
```

ã€Œã“ã®ãƒ†ã‚¹ãƒˆã¯ä½•ã‚’ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å·¦å³ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã¨é›¢ã•ã‚ŒãŸã¨ãã«ã€`Player`ã‚¯ãƒ©ã‚¹ã®ä¸­ã®å¯¾å¿œã™ã‚‹ãƒ•ãƒ©ã‚°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚

### å®Ÿè£…: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›æ¤œå‡º

ã€Œå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆãŒã§ããŸã®ã§ã€æ¬¡ã¯å®Ÿè£…ã§ã™ã­ï¼ã€ãã†ã§ã™ï¼ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ã€æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

> æœ€å°é™ã®å®Ÿè£…
> 
> ãƒ†ã‚¹ãƒˆã‚’é€šã™ãŸã‚ã«ã€ã©ã‚Œã ã‘ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‘ã°ã‚ˆã„ã ã‚ã†ã‹â€”â€”ãƒ†ã‚¹ãƒˆãŒé€šã‚‹æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã ã‘ã‚’æ›¸ã“ã†ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

```csharp
// PuyoPuyoTDD/Models/Player.cs
namespace PuyoPuyoTDD.Models;

public class Player
{
    private readonly Config _config;
    private readonly Stage _stage;
    
    public bool InputKeyLeft { get; private set; }
    public bool InputKeyRight { get; private set; }
    public bool InputKeyUp { get; private set; }
    public bool InputKeyDown { get; private set; }
    
    private int _puyoX = 2; // ã·ã‚ˆã®Xåº§æ¨™ï¼ˆä¸­å¤®ã«é…ç½®ï¼‰
    private int _puyoY = 0; // ã·ã‚ˆã®Yåº§æ¨™ï¼ˆä¸€ç•ªä¸Šï¼‰
    private int _puyoType; // ç¾åœ¨ã®ã·ã‚ˆã®ç¨®é¡
    private int _nextPuyoType; // æ¬¡ã®ã·ã‚ˆã®ç¨®é¡
    private int _rotation; // ç¾åœ¨ã®å›è»¢çŠ¶æ…‹

    public Player(Config config, Stage stage)
    {
        _config = config;
        _stage = stage;
    }

    public void SetInputLeft(bool value)
    {
        InputKeyLeft = value;
    }

    public void SetInputRight(bool value)
    {
        InputKeyRight = value;
    }

    public void SetInputUp(bool value)
    {
        InputKeyUp = value;
    }

    public void SetInputDown(bool value)
    {
        InputKeyDown = value;
    }
}
```

ã€Œãªã‚‹ã»ã©ï¼ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã‚Šé›¢ã•ã‚ŒãŸã‚Šã—ãŸã¨ãã®ãƒ•ãƒ©ã‚°ã‚’ç®¡ç†ã—ã¦ã„ã‚‹ã‚“ã§ã™ã­ã€‚ã€ãã†ã§ã™ï¼Blazorã§ã¯ã€JavaScriptå´ã§ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œçŸ¥ã—ã€C#å´ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã—ã¾ã™ã€‚

### ãƒ†ã‚¹ãƒˆ: ã·ã‚ˆã®ç§»å‹•

ã€Œæ¬¡ã¯ä½•ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã‹ï¼Ÿã€æ¬¡ã¯ã€ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã™ã‚‹æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚ã·ã‚ˆãŒå·¦å³ã«ç§»å‹•ã§ãã‚‹ã‹ã€ãã—ã¦ç”»é¢ã®ç«¯ã«åˆ°é”ã—ãŸã¨ãã«ç§»å‹•ãŒåˆ¶é™ã•ã‚Œã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/PlayerTest.csï¼ˆç¶šãï¼‰
[Fact]
public void å·¦ã«ç§»å‹•ã§ãã‚‹å ´åˆå·¦ã«ç§»å‹•ã™ã‚‹()
{
    // Arrange
    _player.CreateNewPuyo();
    var initialX = _player.PuyoX;

    // Act
    _player.MoveLeft();

    // Assert
    Assert.Equal(initialX - 1, _player.PuyoX);
}

[Fact]
public void å³ã«ç§»å‹•ã§ãã‚‹å ´åˆå³ã«ç§»å‹•ã™ã‚‹()
{
    // Arrange
    _player.CreateNewPuyo();
    var initialX = _player.PuyoX;

    // Act
    _player.MoveRight();

    // Assert
    Assert.Equal(initialX + 1, _player.PuyoX);
}

[Fact]
public void å·¦ç«¯ã«ã„ã‚‹å ´åˆå·¦ã«ç§»å‹•ã§ããªã„()
{
    // Arrange
    _player.CreateNewPuyo();
    _player.SetPuyoX(0);

    // Act
    _player.MoveLeft();

    // Assert
    Assert.Equal(0, _player.PuyoX);
}

[Fact]
public void å³ç«¯ã«ã„ã‚‹å ´åˆå³ã«ç§»å‹•ã§ããªã„()
{
    // Arrange
    _player.CreateNewPuyo();
    _player.SetPuyoX(_config.StageCols - 1);

    // Act
    _player.MoveRight();

    // Assert
    Assert.Equal(_config.StageCols - 1, _player.PuyoX);
}
```

### å®Ÿè£…: ã·ã‚ˆã®ç§»å‹•

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‚‰ã€å®Ÿè£…ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼ã€ãã†ã§ã™ã­ã€‚ã§ã¯ã€ã·ã‚ˆã‚’ç§»å‹•ã•ã›ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Player.csï¼ˆç¶šãï¼‰
public int PuyoX => _puyoX;
public int PuyoY => _puyoY;
public int PuyoType => _puyoType;
public int NextPuyoType => _nextPuyoType;
public int Rotation => _rotation;

public void CreateNewPuyo()
{
    _puyoX = 2;
    _puyoY = 0;
    _puyoType = Random.Shared.Next(1, 5); // 1ï½4ã®ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤
    _nextPuyoType = Random.Shared.Next(1, 5);
    _rotation = 0;
}

public void SetPuyoX(int x)
{
    _puyoX = x;
}

public void MoveLeft()
{
    if (_puyoX > 0)
    {
        _puyoX--;
    }
}

public void MoveRight()
{
    if (_puyoX < _config.StageCols - 1)
    {
        _puyoX++;
    }
}
```

### è§£èª¬: ã·ã‚ˆã®ç§»å‹•

ã€Œã·ã‚ˆã®ä½ç½®ã‚„ç¨®é¡ã‚’ç®¡ç†ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒãŸãã•ã‚“ã‚ã‚Šã¾ã™ã­ï¼ã€ãã†ã§ã™ã­ã€‚ã·ã‚ˆã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«ã€ã„ãã¤ã‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ï¼š

- `PuyoX`ã¨`PuyoY`ï¼šã·ã‚ˆã®ä½ç½®ï¼ˆXåº§æ¨™ã¨Yåº§æ¨™ï¼‰
- `PuyoType`ã¨`NextPuyoType`ï¼šç¾åœ¨ã®ã·ã‚ˆã¨æ¬¡ã®ã·ã‚ˆã®ç¨®é¡
- `Rotation`ï¼šã·ã‚ˆã®å›è»¢çŠ¶æ…‹

ã€Œç§»å‹•ã®å‡¦ç†ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ï¼ã€ãã†ã§ã™ã­ã€‚`MoveLeft`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯å·¦ç«¯ï¼ˆXåº§æ¨™ãŒ0ï¼‰ã§ãªã‘ã‚Œã°Xåº§æ¨™ã‚’1æ¸›ã‚‰ã—ã€`MoveRight`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯å³ç«¯ï¼ˆXåº§æ¨™ãŒã‚¹ãƒ†ãƒ¼ã‚¸ã®å¹…-1ï¼‰ã§ãªã‘ã‚Œã°Xåº§æ¨™ã‚’1å¢—ã‚„ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã§ã€ã·ã‚ˆãŒç”»é¢ã®ç«¯ã‚’è¶…ãˆã¦ç§»å‹•ã™ã‚‹ã“ã¨ã¯ãªããªã‚Šã¾ã—ãŸã€‚

> å¢ƒç•Œæ¡ä»¶ã®ãƒ†ã‚¹ãƒˆ
> 
> ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãŒå¤‰ã‚ã‚‹å¢ƒç•Œæ¡ä»¶ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ã¯éå¸¸ã«é‡è¦ã§ã™ã€‚ä¾‹ãˆã°ã€é…åˆ—ã®æœ€åˆã®è¦ç´ ã€æœ€å¾Œã®è¦ç´ ã€ç©ºã®é…åˆ—ãªã©ã§ã™ã€‚
> 
> â€” Martin Fowler ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3: ã·ã‚ˆã®å›è»¢ã®å®Ÿè£…

ã€Œå·¦å³ã«ç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‘ã©ã€ã·ã‚ˆã·ã‚ˆã£ã¦å›è»¢ã‚‚ã§ãã¾ã™ã‚ˆã­ï¼Ÿã€ãã†ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã®ä¸€ã¤ã¯ã€ã·ã‚ˆã‚’å›è»¢ã•ã›ã¦æ€ã„é€šã‚Šã®å ´æ‰€ã«é…ç½®ã™ã‚‹ã“ã¨ã§ã™ã€‚ä»Šå›ã¯ã€ã·ã‚ˆã‚’å›è»¢ã•ã›ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å›è»¢ã§ãã‚‹

ã€Œå›è»¢ã£ã¦å…·ä½“çš„ã«ã©ã†ã„ã†å‹•ãã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã§ã¯ã€2ã¤ã®ã·ã‚ˆãŒé€£ãªã£ãŸçŠ¶æ…‹ã§è½ã¡ã¦ãã¾ã™ã€‚å›è»¢ã¨ã¯ã€ã“ã®2ã¤ã®ã·ã‚ˆã®ç›¸å¯¾çš„ãªä½ç½®é–¢ä¿‚ã‚’å¤‰ãˆã‚‹ã“ã¨ã§ã™ã€‚

### TODOãƒªã‚¹ãƒˆ

ã€Œã©ã‚“ãªä½œæ¥­ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã‹ï¼Ÿã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€å®Ÿè£…å‰ã«å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºã®æ–¹å‘æ€§ã‚’ä¿ã¡ã€ä½•ã‚‚è¦‹è½ã¨ã•ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã€Œã·ã‚ˆã‚’å›è»¢ã•ã›ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- ã·ã‚ˆã®å›è»¢å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ™‚è¨ˆå›ã‚Šãƒ»åæ™‚è¨ˆå›ã‚Šã®å›è»¢ï¼‰
- å›è»¢å¯èƒ½ã‹ã©ã†ã‹ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆä»–ã®ã·ã‚ˆã‚„å£ã«ã¶ã¤ã‹ã‚‹å ´åˆã¯å›è»¢ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰
- å£ã‚­ãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆå£éš›ã§ã®å›è»¢ã‚’å¯èƒ½ã«ã™ã‚‹ç‰¹æ®Šå‡¦ç†ï¼‰

### ãƒ†ã‚¹ãƒˆ: ã·ã‚ˆã®å›è»¢

ã€Œã¾ãšã¯ä½•ã‹ã‚‰ãƒ†ã‚¹ãƒˆã—ã¾ã™ã‹ï¼Ÿã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æµã‚Œã«æ²¿ã£ã¦ã€ã¾ãšã¯åŸºæœ¬çš„ãªå›è»¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/PlayerTest.csï¼ˆç¶šãï¼‰
[Fact]
public void æ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹ã¨å›è»¢çŠ¶æ…‹ãŒ1å¢—ãˆã‚‹()
{
    // Arrange
    _player.CreateNewPuyo();
    var initialRotation = _player.Rotation;

    // Act
    _player.RotateRight();

    // Assert
    Assert.Equal((initialRotation + 1) % 4, _player.Rotation);
}

[Fact]
public void åæ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹ã¨å›è»¢çŠ¶æ…‹ãŒ1æ¸›ã‚‹()
{
    // Arrange
    _player.CreateNewPuyo();
    var initialRotation = _player.Rotation;

    // Act
    _player.RotateLeft();

    // Assert
    Assert.Equal((initialRotation + 3) % 4, _player.Rotation);
}

[Fact]
public void å›è»¢çŠ¶æ…‹ãŒ4ã«ãªã‚‹ã¨0ã«æˆ»ã‚‹()
{
    // Arrange
    _player.CreateNewPuyo();
    _player.SetRotation(3);

    // Act
    _player.RotateRight();

    // Assert
    Assert.Equal(0, _player.Rotation);
}
```

### å®Ÿè£…: ã·ã‚ˆã®å›è»¢

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‚‰ã€å®Ÿè£…ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼ã€ãã†ã§ã™ã­ã€‚ã§ã¯ã€ã·ã‚ˆã‚’å›è»¢ã•ã›ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Player.csï¼ˆç¶šãï¼‰
public void SetRotation(int rotation)
{
    _rotation = rotation;
}

public void RotateRight()
{
    _rotation = (_rotation + 1) % 4;
    
    // å£ã‚­ãƒƒã‚¯å‡¦ç†
    if (_rotation == 1 && _puyoX == _config.StageCols - 1)
    {
        _puyoX--;
    }
    if (_rotation == 3 && _puyoX == 0)
    {
        _puyoX++;
    }
}

public void RotateLeft()
{
    _rotation = (_rotation + 3) % 4;
    
    // å£ã‚­ãƒƒã‚¯å‡¦ç†
    if (_rotation == 1 && _puyoX == _config.StageCols - 1)
    {
        _puyoX--;
    }
    if (_rotation == 3 && _puyoX == 0)
    {
        _puyoX++;
    }
}
```

### è§£èª¬: ã·ã‚ˆã®å›è»¢ã¨å£ã‚­ãƒƒã‚¯

ã€Œã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ï¼ã€ãã†ã§ã™ã­ã€‚å›è»¢å‡¦ç†è‡ªä½“ã¯ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚`RotateRight`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯å›è»¢çŠ¶æ…‹ã‚’1å¢—ã‚„ã—ã€`RotateLeft`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯å›è»¢çŠ¶æ…‹ã‚’1æ¸›ã‚‰ã—ã¦ã„ã¾ã™ã€‚

ã€Œå£ã‚­ãƒƒã‚¯ã£ã¦ä½•ã§ã™ã‹ï¼Ÿã€å£ã‚­ãƒƒã‚¯ã¨ã¯ã€ã·ã‚ˆãŒå£éš›ã«ã‚ã‚‹ã¨ãã«å›è»¢ã™ã‚‹ã¨å£ã«ã‚ã‚Šè¾¼ã‚“ã§ã—ã¾ã†ã®ã§ã€è‡ªå‹•çš„ã«å°‘ã—ä½ç½®ã‚’ãšã‚‰ã—ã¦å›è»¢ã‚’å¯èƒ½ã«ã™ã‚‹å‡¦ç†ã®ã“ã¨ã§ã™ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ“ä½œæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®å·¥å¤«ãªã‚“ã§ã™ã‚ˆã€‚

> å¢ƒç•Œæ¡ä»¶ã®ãƒ†ã‚¹ãƒˆ
> 
> ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãŒå¤‰ã‚ã‚‹å¢ƒç•Œæ¡ä»¶ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ã¯éå¸¸ã«é‡è¦ã§ã™ã€‚å£éš›ã§ã®å›è»¢ã®ã‚ˆã†ãªç‰¹æ®Šãªã‚±ãƒ¼ã‚¹ã¯ã€ãƒã‚°ãŒç™ºç”Ÿã—ã‚„ã™ã„å ´æ‰€ã§ã™ã€‚
> 
> â€” Martin Fowler ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³4: ã·ã‚ˆã®é«˜é€Ÿè½ä¸‹ã®å®Ÿè£…

ã€Œå›è»¢ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‘ã©ã€ã·ã‚ˆã·ã‚ˆã£ã¦ã‚‚ã£ã¨æ—©ãè½ã¨ã›ãŸã‚ˆã­ï¼Ÿã€ãã†ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã§ã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒä¸‹ã‚­ãƒ¼ã‚’æŠ¼ã™ã“ã¨ã§ã€ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»Šå›ã¯ã€ãã®ã€Œé«˜é€Ÿè½ä¸‹ã€æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹

ã€Œæ—©ãæ¬¡ã®ã·ã‚ˆã‚’è½ã¨ã—ãŸã„ï¼ã€ã¨ã„ã†ã¨ãã«ã€ä¸‹ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹æ©Ÿèƒ½ã¯ã€ã‚²ãƒ¼ãƒ ã®ãƒ†ãƒ³ãƒã‚’è‰¯ãã™ã‚‹ãŸã‚ã«é‡è¦ã§ã™ã­ã€‚

### TODOãƒªã‚¹ãƒˆ

ã€Œã©ã‚“ãªä½œæ¥­ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã‹ï¼Ÿã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã€Œã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- ä¸‹ã‚­ãƒ¼å…¥åŠ›ã®æ¤œå‡ºã‚’å®Ÿè£…ã™ã‚‹ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ä¸‹ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹ï¼‰
- é«˜é€Ÿè½ä¸‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆä¸‹ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ã¨ãã¯è½ä¸‹é€Ÿåº¦ã‚’ä¸Šã’ã‚‹ï¼‰
- è½ä¸‹å¯èƒ½ã‹ã©ã†ã‹ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆä¸‹ã«éšœå®³ç‰©ãŒã‚ã‚‹å ´åˆã¯è½ä¸‹ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰

### ãƒ†ã‚¹ãƒˆ: é«˜é€Ÿè½ä¸‹

ã€Œæœ€åˆã«ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚Œã°ã„ã„ã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€ã¾ãšã¯ã€ä¸‹ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«è½ä¸‹é€Ÿåº¦ãŒä¸ŠãŒã‚‹ã“ã¨ã¨ã€ã·ã‚ˆãŒä¸‹ã«ç§»å‹•ã§ãã‚‹ã‹ã©ã†ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/PlayerTest.csï¼ˆç¶šãï¼‰
[Fact]
public void ä¸‹ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ã¨è½ä¸‹é€Ÿåº¦ãŒä¸ŠãŒã‚‹()
{
    // Arrange
    _player.SetInputDown(true);

    // Act
    var dropSpeed = _player.GetDropSpeed();

    // Assert
    Assert.True(dropSpeed > 1);
}

[Fact]
public void ä¸‹ã«ç§»å‹•ã§ãã‚‹å ´åˆä¸‹ã«ç§»å‹•ã™ã‚‹()
{
    // Arrange
    _player.CreateNewPuyo();
    var initialY = _player.PuyoY;

    // Act
    var canMove = _player.MoveDown();

    // Assert
    Assert.True(canMove);
    Assert.Equal(initialY + 1, _player.PuyoY);
}

[Fact]
public void ä¸‹ã«éšœå®³ç‰©ãŒã‚ã‚‹å ´åˆä¸‹ã«ç§»å‹•ã§ããªã„()
{
    // Arrange
    _player.CreateNewPuyo();
    _player.SetPuyoY(_config.StageRows - 1);

    // Act
    var canMove = _player.MoveDown();

    // Assert
    Assert.False(canMove);
    Assert.Equal(_config.StageRows - 1, _player.PuyoY);
}
```

### å®Ÿè£…: é«˜é€Ÿè½ä¸‹

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‚‰ã€å®Ÿè£…ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼ã€ãã†ã§ã™ã­ã€‚ã§ã¯ã€é«˜é€Ÿè½ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Player.csï¼ˆç¶šãï¼‰
public void SetPuyoY(int y)
{
    _puyoY = y;
}

public int GetDropSpeed()
{
    return InputKeyDown ? 10 : 1;
}

public bool MoveDown()
{
    if (_puyoY < _config.StageRows - 1)
    {
        _puyoY++;
        return true;
    }
    return false;
}
```

### è§£èª¬: é«˜é€Ÿè½ä¸‹

ã€Œã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ï¼ã€ãã†ã§ã™ã­ã€‚é«˜é€Ÿè½ä¸‹ã®å‡¦ç†è‡ªä½“ã¯ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚`GetDropSpeed`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€ä¸‹ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã€æŠ¼ã•ã‚Œã¦ã„ã‚Œã°é€šå¸¸ã®10å€ã®é€Ÿåº¦ã§è½ä¸‹ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã€Œãªãœ`MoveDown`ãƒ¡ã‚½ãƒƒãƒ‰ã¯`bool`ã‚’è¿”ã™ã‚“ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ã­ï¼`MoveDown`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã·ã‚ˆãŒå®Ÿéš›ã«ä¸‹ã«ç§»å‹•ã§ããŸã‹ã©ã†ã‹ã‚’è¿”ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã·ã‚ˆãŒç€åœ°ã—ãŸã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ãŸã‚ã«ä½¿ã‚ã‚Œã¾ã™ã€‚

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³5: ã·ã‚ˆã®æ¶ˆå»ã®å®Ÿè£…

ã€Œã·ã‚ˆãŒè½ã¡ã¦ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‘ã©ã€ã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã¯ã·ã‚ˆã‚’æ¶ˆã™ã“ã¨ã§ã™ã‚ˆã­ï¼Ÿã€ãã†ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã®æœ€ã‚‚é‡è¦ãªè¦ç´ ã®ä¸€ã¤ã¯ã€åŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆå»ã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚ä»Šå›ã¯ã€ãã®ã€Œã·ã‚ˆã®æ¶ˆå»ã€æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€åŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆå»ã§ãã‚‹

ã€Œã“ã‚ŒãŒã·ã‚ˆã·ã‚ˆã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«ã§ã™ã­ï¼ã€ãã†ã§ã™ï¼åŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆå»ã§ãã‚‹ã¨ã„ã†ã®ãŒã€ã·ã‚ˆã·ã‚ˆã®åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ã§ã™ã€‚

### TODOãƒªã‚¹ãƒˆ

ã€Œã©ã‚“ãªä½œæ¥­ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã‹ï¼Ÿã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã€Œã·ã‚ˆã‚’æ¶ˆå»ã™ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- ã·ã‚ˆã®æ¥ç¶šåˆ¤å®šã‚’å®Ÿè£…ã™ã‚‹ï¼ˆéš£æ¥ã™ã‚‹åŒã˜è‰²ã®ã·ã‚ˆã‚’æ¤œå‡ºã™ã‚‹ï¼‰
- 4ã¤ä»¥ä¸Šã¤ãªãŒã£ãŸã·ã‚ˆã®æ¤œå‡ºã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ¶ˆå»å¯¾è±¡ã¨ãªã‚‹ã·ã‚ˆã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç‰¹å®šã™ã‚‹ï¼‰
- ã·ã‚ˆã®æ¶ˆå»å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ¶ˆå»å¯¾è±¡ã®ã·ã‚ˆã‚’å®Ÿéš›ã«æ¶ˆã™ï¼‰
- æ¶ˆå»å¾Œã®è½ä¸‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ¶ˆå»ã•ã‚ŒãŸå¾Œã®ç©ºãã‚¹ãƒšãƒ¼ã‚¹ã«ã·ã‚ˆãŒè½ã¡ã¦ãã‚‹ï¼‰

### ãƒ†ã‚¹ãƒˆ: ã·ã‚ˆã®æ¥ç¶šåˆ¤å®š

ã€Œæœ€åˆã«ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚Œã°ã„ã„ã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€ã¾ãšã¯ã€ã·ã‚ˆã®æ¥ç¶šåˆ¤å®šã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚åŒã˜è‰²ã®ã·ã‚ˆãŒ4ã¤ä»¥ä¸Šã¤ãªãŒã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹æ©Ÿèƒ½ãŒå¿…è¦ã§ã™ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/StageTest.cs
using Xunit;
using PuyoPuyoTDD.Models;

namespace PuyoPuyoTDD.Tests.Models;

public class StageTest
{
    private readonly Config _config;
    private readonly Stage _stage;

    public StageTest()
    {
        _config = new Config();
        _stage = new Stage(_config);
    }

    [Fact]
    public void åŒã˜è‰²ã®ã·ã‚ˆãŒ4ã¤ã¤ãªãŒã£ã¦ã„ã‚‹ã¨æ¶ˆå»å¯¾è±¡ã«ãªã‚‹()
    {
        // Arrange
        _stage.Initialize();
        _stage.SetPuyo(1, 10, 1);
        _stage.SetPuyo(2, 10, 1);
        _stage.SetPuyo(1, 11, 1);
        _stage.SetPuyo(2, 11, 1);

        // Act
        var eraseInfo = _stage.CheckErase();

        // Assert
        Assert.Equal(4, eraseInfo.ErasePuyoCount);
        Assert.NotEmpty(eraseInfo.EraseList);
    }

    [Fact]
    public void ç•°ãªã‚‹è‰²ã®ã·ã‚ˆã¯æ¶ˆå»å¯¾è±¡ã«ãªã‚‰ãªã„()
    {
        // Arrange
        _stage.Initialize();
        _stage.SetPuyo(1, 10, 1);
        _stage.SetPuyo(2, 10, 2);
        _stage.SetPuyo(1, 11, 2);
        _stage.SetPuyo(2, 11, 1);

        // Act
        var eraseInfo = _stage.CheckErase();

        // Assert
        Assert.Equal(0, eraseInfo.ErasePuyoCount);
        Assert.Empty(eraseInfo.EraseList);
    }
}
```

### å®Ÿè£…: ã·ã‚ˆã®æ¥ç¶šåˆ¤å®š

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‚‰ã€å®Ÿè£…ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼ã€ãã†ã§ã™ã­ã€‚ã§ã¯ã€ã·ã‚ˆã®æ¥ç¶šåˆ¤å®šã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Stage.cs
namespace PuyoPuyoTDD.Models;

public record EraseInfo(int ErasePuyoCount, List<(int X, int Y, int Type)> EraseList);

public class Stage
{
    private readonly Config _config;
    private int[,] _board = null!;

    public Stage(Config config)
    {
        _config = config;
        Initialize();
    }

    public void Initialize()
    {
        _board = new int[_config.StageRows, _config.StageCols];
    }

    public void SetPuyo(int x, int y, int type)
    {
        _board[y, x] = type;
    }

    public int GetPuyo(int x, int y)
    {
        if (x < 0 || x >= _config.StageCols || y < 0 || y >= _config.StageRows)
        {
            return 0;
        }
        return _board[y, x];
    }

    public EraseInfo CheckErase()
    {
        var eraseList = new List<(int X, int Y, int Type)>();
        var checked = new bool[_config.StageRows, _config.StageCols];

        for (int y = 0; y < _config.StageRows; y++)
        {
            for (int x = 0; x < _config.StageCols; x++)
            {
                if (_board[y, x] != 0 && !checked[y, x])
                {
                    var puyoType = _board[y, x];
                    var connected = new List<(int X, int Y)>();
                    SearchConnectedPuyo(x, y, puyoType, checked, connected);

                    if (connected.Count >= 4)
                    {
                        foreach (var (connX, connY) in connected)
                        {
                            eraseList.Add((connX, connY, puyoType));
                        }
                    }
                }
            }
        }

        return new EraseInfo(eraseList.Count, eraseList);
    }

    private void SearchConnectedPuyo(int startX, int startY, int puyoType, 
        bool[,] checked, List<(int X, int Y)> connected)
    {
        checked[startY, startX] = true;
        connected.Add((startX, startY));

        // 4æ–¹å‘ã‚’æ¢ç´¢
        var directions = new[] { (1, 0), (-1, 0), (0, 1), (0, -1) };

        foreach (var (dx, dy) in directions)
        {
            int nextX = startX + dx;
            int nextY = startY + dy;

            if (nextX >= 0 && nextX < _config.StageCols &&
                nextY >= 0 && nextY < _config.StageRows &&
                _board[nextY, nextX] == puyoType &&
                !checked[nextY, nextX])
            {
                SearchConnectedPuyo(nextX, nextY, puyoType, checked, connected);
            }
        }
    }

    public void EraseBoards(List<(int X, int Y, int Type)> eraseList)
    {
        foreach (var (x, y, _) in eraseList)
        {
            _board[y, x] = 0;
        }
    }

    public void Fall()
    {
        for (int y = _config.StageRows - 2; y >= 0; y--)
        {
            for (int x = 0; x < _config.StageCols; x++)
            {
                if (_board[y, x] != 0)
                {
                    int fallY = y;
                    while (fallY + 1 < _config.StageRows && _board[fallY + 1, x] == 0)
                    {
                        _board[fallY + 1, x] = _board[fallY, x];
                        _board[fallY, x] = 0;
                        fallY++;
                    }
                }
            }
        }
    }
}
```

### è§£èª¬: ã·ã‚ˆã®æ¥ç¶šåˆ¤å®š

ã·ã‚ˆã®æ¥ç¶šåˆ¤å®šã§ã¯ã€æ·±ã•å„ªå…ˆæ¢ç´¢ï¼ˆDFSï¼‰ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã¯ã€ã‚ã‚‹ã·ã‚ˆã‹ã‚‰å§‹ã‚ã¦ã€ä¸Šä¸‹å·¦å³ã«éš£æ¥ã™ã‚‹åŒã˜è‰²ã®ã·ã‚ˆã‚’å†å¸°çš„ã«æ¢ç´¢ã—ã¦ã„ãã¾ã™ã€‚

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³6: é€£é–åå¿œã¨ã‚¹ã‚³ã‚¢è¨ˆç®—ã®å®Ÿè£…

ã€Œã·ã‚ˆã‚’æ¶ˆã›ã‚‹ã‚ˆã†ã«ãªã£ãŸã‘ã©ã€ã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã¯é€£é–ã˜ã‚ƒãªã„ã§ã™ã‹ï¼Ÿã€ãã†ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã®æœ€ã‚‚é­…åŠ›çš„ãªè¦ç´ ã®ä¸€ã¤ã¯ã€é€£é–åå¿œã§ã™ã€‚ã·ã‚ˆãŒæ¶ˆãˆã¦è½ä¸‹ã—ãŸçµæœã€æ–°ãŸãªæ¶ˆå»ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç”Ÿã¾ã‚Œã€é€£ç¶šã—ã¦æ¶ˆå»ãŒç™ºç”Ÿã™ã‚‹ã€Œé€£é–ã€ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€é€£é–åå¿œã‚’èµ·ã“ã—ã¦ã‚ˆã‚Šé«˜ã„ã‚¹ã‚³ã‚¢ã‚’ç²å¾—ã§ãã‚‹

ã€Œã‚Œã€œã‚“ã•ã€œã‚“ï¼ã€ã¨å«ã³ãŸããªã‚‹ã‚ˆã†ãªé€£é–åå¿œã‚’å®Ÿè£…ã—ã¦ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ˆã‚Šé«˜ã„ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

### TODOãƒªã‚¹ãƒˆ

ã€Œã©ã‚“ãªä½œæ¥­ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã‹ï¼Ÿã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã€Œé€£é–åå¿œã‚’å®Ÿè£…ã™ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- é€£é–ã‚«ã‚¦ãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ï¼ˆä½•é€£é–ç›®ã‹ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ï¼‰
- é€£é–ãƒœãƒ¼ãƒŠã‚¹ã®è¨ˆç®—ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆé€£é–æ•°ã«å¿œã˜ãŸãƒœãƒ¼ãƒŠã‚¹ç‚¹ã‚’è¨ˆç®—ã™ã‚‹ï¼‰
- ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’å®Ÿè£…ã™ã‚‹ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤ºã™ã‚‹ï¼‰

### ãƒ†ã‚¹ãƒˆ: ã‚¹ã‚³ã‚¢è¨ˆç®—

ã€Œæœ€åˆã«ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚Œã°ã„ã„ã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€ã¾ãšã¯ã€é€£é–ãƒœãƒ¼ãƒŠã‚¹ã‚’å«ã‚€ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/ScoreTest.cs
using Xunit;
using PuyoPuyoTDD.Models;

namespace PuyoPuyoTDD.Tests.Models;

public class ScoreTest
{
    [Fact]
    public void ã·ã‚ˆã‚’æ¶ˆå»ã™ã‚‹ã¨ã‚¹ã‚³ã‚¢ãŒåŠ ç®—ã•ã‚Œã‚‹()
    {
        // Arrange
        var score = new Score();

        // Act
        score.AddScore(4, 1);

        // Assert
        Assert.True(score.GetScore() > 0);
    }

    [Fact]
    public void é€£é–æ•°ãŒå¢—ãˆã‚‹ã¨ãƒœãƒ¼ãƒŠã‚¹ãŒåŠ ç®—ã•ã‚Œã‚‹()
    {
        // Arrange
        var score1 = new Score();
        var score2 = new Score();

        // Act
        score1.AddScore(4, 1);
        score2.AddScore(4, 2);

        // Assert
        Assert.True(score2.GetScore() > score1.GetScore());
    }

    [Theory]
    [InlineData(1, 1)]
    [InlineData(2, 8)]
    [InlineData(3, 16)]
    [InlineData(4, 32)]
    [InlineData(5, 64)]
    public void é€£é–ãƒœãƒ¼ãƒŠã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹(int chainCount, int expectedBonus)
    {
        // Arrange
        var score = new Score();

        // Act
        var bonus = score.GetChainBonus(chainCount);

        // Assert
        Assert.Equal(expectedBonus, bonus);
    }
}
```

### å®Ÿè£…: ã‚¹ã‚³ã‚¢è¨ˆç®—

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‚‰ã€å®Ÿè£…ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼ã€ãã†ã§ã™ã­ã€‚ã§ã¯ã€ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Score.cs
namespace PuyoPuyoTDD.Models;

public class Score
{
    private int _score;
    private readonly int[] _chainBonusTable = { 0, 1, 8, 16, 32, 64, 96, 128, 160, 192, 224, 256 };

    public void AddScore(int erasePuyoCount, int chainCount)
    {
        var baseScore = erasePuyoCount * 10;
        var chainBonus = GetChainBonus(chainCount);
        var additionalScore = baseScore * chainBonus;
        _score += additionalScore;
    }

    public int GetScore()
    {
        return _score;
    }

    public int GetChainBonus(int chainCount)
    {
        if (chainCount <= 0) return 0;
        if (chainCount >= _chainBonusTable.Length)
        {
            return _chainBonusTable[^1];
        }
        return _chainBonusTable[chainCount];
    }

    public void Reset()
    {
        _score = 0;
    }
}
```

### è§£èª¬: ã‚¹ã‚³ã‚¢è¨ˆç®—

ã‚¹ã‚³ã‚¢è¨ˆç®—ã§ã¯ã€ä»¥ä¸‹ã®è¨ˆç®—å¼ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼š

```
æœ€çµ‚ã‚¹ã‚³ã‚¢ = åŸºæœ¬ç‚¹ï¼ˆæ¶ˆå»ã—ãŸã·ã‚ˆã®æ•° Ã— 10ï¼‰Ã— é€£é–ãƒœãƒ¼ãƒŠã‚¹
```

é€£é–ãƒœãƒ¼ãƒŠã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€é€£é–æ•°ãŒå¢—ãˆã‚‹ã»ã©å¤§ãããªã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯é€£é–ã‚’ç‹™ã†ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒé«˜ã¾ã‚Šã¾ã™ã€‚

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³7: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®å®Ÿè£…

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³6ã§ã‚¹ã‚³ã‚¢è¨ˆç®—ã¨é€£é–æ•°ã®ã‚«ã‚¦ãƒ³ãƒˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚æ¬¡ã¯ã€ã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã®ä¸€ã¤ã§ã‚ã‚‹ã€Œå…¨æ¶ˆã—ï¼ˆãœã‚“ã‘ã—ï¼‰ã€ãƒœãƒ¼ãƒŠã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

> ã‚²ãƒ¼ãƒ ãƒãƒ©ãƒ³ã‚¹
>
> ã‚²ãƒ¼ãƒ ã®é¢ç™½ã•ã¯ã€æŒ‘æˆ¦ã¨å ±é…¬ã®ãƒãƒ©ãƒ³ã‚¹ã‹ã‚‰ç”Ÿã¾ã‚Œã¾ã™ã€‚å›°é›£ãªç›®æ¨™ã‚’é”æˆã—ãŸã¨ãã®å¤§ããªå ±é…¬ã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é”æˆæ„Ÿã‚’é«˜ã‚ã¾ã™ã€‚
>
> â€” Mihaly Csikszentmihalyi ã€ãƒ•ãƒ­ãƒ¼ä½“é¨“ã€

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’ç²å¾—ã§ãã‚‹

ã€Œå…¨æ¶ˆã—ã£ã¦ä½•ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼å…¨æ¶ˆã—ã¨ã¯ã€ç›¤é¢ä¸Šã®ã·ã‚ˆã‚’ã™ã¹ã¦æ¶ˆå»ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã¯éå¸¸ã«é›£ã—ã„æŠ€è¡“ã§ã€é”æˆã™ã‚‹ã¨å¤§ããªãƒœãƒ¼ãƒŠã‚¹ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

### TODOãƒªã‚¹ãƒˆ

ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- å…¨æ¶ˆã—åˆ¤å®šã‚’å®Ÿè£…ã™ã‚‹ï¼ˆç›¤é¢ä¸Šã«ã·ã‚ˆãŒæ®‹ã£ã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ï¼‰
- å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®è¨ˆç®—ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆå›ºå®šãƒœãƒ¼ãƒŠã‚¹3600ç‚¹ï¼‰
- å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®ã‚¹ã‚³ã‚¢åŠ ç®—ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ¶ˆå»å¾Œã«å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ï¼‰
- å…¨æ¶ˆã—æ¼”å‡ºã‚’å®Ÿè£…ã™ã‚‹ï¼ˆå…¨æ¶ˆã—é”æˆæ™‚ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰

ã€Œé †ç•ªã«å®Ÿè£…ã—ã¦ã„ãã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æµã‚Œã«æ²¿ã£ã¦ã€ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### ãƒ†ã‚¹ãƒˆ: å…¨æ¶ˆã—åˆ¤å®š

ã¾ãšã€ç›¤é¢ä¸Šã«ã·ã‚ˆãŒæ®‹ã£ã¦ã„ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/StageTest.csï¼ˆç¶šãï¼‰
[Fact]
public void ç›¤é¢ãŒç©ºã®å ´åˆã¯å…¨æ¶ˆã—åˆ¤å®šãŒtrueã«ãªã‚‹()
{
    // Arrange
    stage.Initialize();

    // Act
    var isAllClear = stage.IsAllClear();

    // Assert
    Assert.True(isAllClear);
}

[Fact]
public void ç›¤é¢ã«ã·ã‚ˆãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆã¯å…¨æ¶ˆã—åˆ¤å®šãŒfalseã«ãªã‚‹()
{
    // Arrange
    stage.Initialize();
    stage.SetPuyo(2, 10, 1); // 1ã¤ã§ã‚‚ã·ã‚ˆãŒã‚ã‚Œã°å…¨æ¶ˆã—ã§ã¯ãªã„

    // Act
    var isAllClear = stage.IsAllClear();

    // Assert
    Assert.False(isAllClear);
}

[Fact]
public void ã™ã¹ã¦ã®ã·ã‚ˆã‚’æ¶ˆå»ã™ã‚‹ã¨å…¨æ¶ˆã—åˆ¤å®šãŒtrueã«ãªã‚‹()
{
    // Arrange
    stage.Initialize();
    // ã·ã‚ˆã‚’é…ç½®
    stage.SetPuyo(1, 11, 1);
    stage.SetPuyo(2, 11, 1);
    stage.SetPuyo(3, 11, 1);
    stage.SetPuyo(4, 11, 1);

    // æ¶ˆå»
    var eraseInfo = stage.CheckErase();
    stage.EraseBoards(eraseInfo.EraseList);

    // Act
    var isAllClear = stage.IsAllClear();

    // Assert
    Assert.True(isAllClear);
}
```

ã€Œã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ä½•ã‚’ç¢ºèªã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ã€ä»¥ä¸‹ã®3ã¤ã®ã‚±ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ï¼š

1. ç›¤é¢ãŒç©ºã®å ´åˆã€å…¨æ¶ˆã—ã¨åˆ¤å®šã•ã‚Œã‚‹
2. ç›¤é¢ã«ã·ã‚ˆãŒ1ã¤ã§ã‚‚æ®‹ã£ã¦ã„ã‚‹å ´åˆã€å…¨æ¶ˆã—ã§ã¯ãªã„
3. ã·ã‚ˆã‚’ã™ã¹ã¦æ¶ˆå»ã—ãŸå ´åˆã€å…¨æ¶ˆã—ã¨åˆ¤å®šã•ã‚Œã‚‹

### å®Ÿè£…: å…¨æ¶ˆã—åˆ¤å®š

ã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Stage.csï¼ˆç¶šãï¼‰
public bool IsAllClear()
{
    // ç›¤é¢ä¸Šã®ã™ã¹ã¦ã®ãƒã‚¹ã‚’ãƒã‚§ãƒƒã‚¯
    for (int y = 0; y < config.StageHeight; y++)
    {
        for (int x = 0; x < config.StageWidth; x++)
        {
            // ã·ã‚ˆãŒ1ã¤ã§ã‚‚ã‚ã‚Œã°å…¨æ¶ˆã—ã§ã¯ãªã„
            if (board[y, x] != 0)
            {
                return false;
            }
        }
    }

    // ã™ã¹ã¦ã®ãƒã‚¹ãŒç©ºãªã‚‰å…¨æ¶ˆã—
    return true;
}
```

ã€Œã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ï¼ã€ãã†ã§ã™ã­ã€‚å…¨æ¶ˆã—åˆ¤å®šã®å®Ÿè£…è‡ªä½“ã¯ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚ç›¤é¢ä¸Šã®ã™ã¹ã¦ã®ãƒã‚¹ã‚’é †ç•ªã«ãƒã‚§ãƒƒã‚¯ã—ã€ã·ã‚ˆãŒã‚ã‚‹ï¼ˆå€¤ãŒ0ã§ãªã„ï¼‰ãƒã‚¹ãŒè¦‹ã¤ã‹ã£ãŸæ™‚ç‚¹ã§`false`ã‚’è¿”ã—ã¾ã™ã€‚ã™ã¹ã¦ã®ãƒã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€ã·ã‚ˆãŒè¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã°`true`ã‚’è¿”ã—ã¾ã™ã€‚

ã€ŒäºŒé‡ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ã£ã¦ã€ã™ã¹ã¦ã®ãƒã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼å¤–å´ã®ãƒ«ãƒ¼ãƒ—ã§è¡Œï¼ˆyåº§æ¨™ï¼‰ã‚’ã€å†…å´ã®ãƒ«ãƒ¼ãƒ—ã§åˆ—ï¼ˆxåº§æ¨™ï¼‰ã‚’é †ç•ªã«ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç›¤é¢ä¸Šã®ã™ã¹ã¦ã®ãƒã‚¹ã‚’åŠ¹ç‡çš„ã«ãƒã‚§ãƒƒã‚¯ã§ãã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: å…¨æ¶ˆã—åˆ¤å®šã‚’å®Ÿè£…'
```

### ãƒ†ã‚¹ãƒˆ: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹

æ¬¡ã«ã€å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®è¨ˆç®—ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/ScoreTest.csï¼ˆç¶šãï¼‰
[Fact]
public void å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’è¿½åŠ ã™ã‚‹ã¨3600ç‚¹åŠ ç®—ã•ã‚Œã‚‹()
{
    // Arrange
    var score = new Score();
    score.AddScore(100); // æ—¢å­˜ã®ã‚¹ã‚³ã‚¢
    var initialScore = score.CurrentScore;

    // Act
    score.AddZenkeshiBonus();

    // Assert
    Assert.Equal(initialScore + 3600, score.CurrentScore);
}

[Fact]
public void å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯ä½•åº¦ã§ã‚‚åŠ ç®—ã§ãã‚‹()
{
    // Arrange
    var score = new Score();

    // Act
    score.AddZenkeshiBonus();
    score.AddZenkeshiBonus();

    // Assert
    Assert.Equal(7200, score.CurrentScore); // 3600 Ã— 2
}
```

ã€Œå…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯3600ç‚¹ãªã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚ã“ã‚Œã¯ã·ã‚ˆã·ã‚ˆã®æ¨™æº–çš„ãªå…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã§ã™ã€‚ã‹ãªã‚Šå¤§ããªãƒœãƒ¼ãƒŠã‚¹ãªã®ã§ã€å…¨æ¶ˆã—ã‚’ç‹™ã†æˆ¦ç•¥çš„ãªãƒ—ãƒ¬ã‚¤ãŒé‡è¦ã«ãªã‚Šã¾ã™ã€‚

### å®Ÿè£…: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹

ã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Score.csï¼ˆç¶šãï¼‰
public void AddZenkeshiBonus()
{
    // å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ï¼ˆå›ºå®šå€¤3600ç‚¹ï¼‰
    const int ZenkeshiBonus = 3600;
    CurrentScore += ZenkeshiBonus;
}
```

ã€Œã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯å›ºå®šå€¤ãªã®ã§ã€å®Ÿè£…ã‚‚éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®è¨ˆç®—ã‚’å®Ÿè£…'
```

### ãƒ†ã‚¹ãƒˆ: ã‚²ãƒ¼ãƒ ã¸ã®çµ±åˆ

æ¬¡ã«ã€å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ãŒã‚²ãƒ¼ãƒ ã«çµ±åˆã•ã‚Œã‚‹ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/GameTest.csï¼ˆç¶šãï¼‰
[Fact]
public void å…¨æ¶ˆã—ã™ã‚‹ã¨å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ãŒåŠ ç®—ã•ã‚Œã‚‹()
{
    // Arrange
    var game = new Game();
    game.Initialize();
    
    // ã·ã‚ˆã‚’4ã¤é…ç½®ï¼ˆå…¨æ¶ˆã—å¯èƒ½ãªçŠ¶æ…‹ï¼‰
    game.Stage!.SetPuyo(1, 11, 1);
    game.Stage.SetPuyo(2, 11, 1);
    game.Stage.SetPuyo(3, 11, 1);
    game.Stage.SetPuyo(4, 11, 1);
    
    game.Mode = GameMode.CheckErase;
    var initialScore = game.Score!.CurrentScore;

    // Act
    game.Update(); // æ¶ˆå»ãƒã‚§ãƒƒã‚¯ â†’ æ¶ˆå»å®Ÿè¡Œ

    // Assert
    // é€šå¸¸ã‚¹ã‚³ã‚¢ï¼ˆ10 Ã— 4 Ã— 1 = 40ï¼‰+ å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ï¼ˆ3600ï¼‰
    Assert.Equal(initialScore + 40 + 3600, game.Score.CurrentScore);
}

[Fact]
public void ã·ã‚ˆãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆã¯å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ãŒåŠ ç®—ã•ã‚Œãªã„()
{
    // Arrange
    var game = new Game();
    game.Initialize();
    
    // ã·ã‚ˆã‚’é…ç½®ï¼ˆæ¶ˆå»å¾Œã‚‚ã·ã‚ˆãŒæ®‹ã‚‹çŠ¶æ…‹ï¼‰
    game.Stage!.SetPuyo(1, 11, 1);
    game.Stage.SetPuyo(2, 11, 1);
    game.Stage.SetPuyo(3, 11, 1);
    game.Stage.SetPuyo(4, 11, 1);
    game.Stage.SetPuyo(1, 10, 2); // æ¶ˆãˆãªã„ã·ã‚ˆ
    
    game.Mode = GameMode.CheckErase;
    var initialScore = game.Score!.CurrentScore;

    // Act
    game.Update(); // æ¶ˆå»ãƒã‚§ãƒƒã‚¯ â†’ æ¶ˆå»å®Ÿè¡Œ

    // Assert
    // é€šå¸¸ã‚¹ã‚³ã‚¢ã®ã¿ï¼ˆ10 Ã— 4 Ã— 1 = 40ï¼‰
    Assert.Equal(initialScore + 40, game.Score.CurrentScore);
}
```

### å®Ÿè£…: ã‚²ãƒ¼ãƒ ã¸ã®çµ±åˆ

ã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Game.csï¼ˆæ›´æ–°ï¼‰
private void UpdateErasing()
{
    if (Stage == null || Score == null || currentEraseInfo == null) return;

    eraseFrameCount++;

    // ä¸€å®šãƒ•ãƒ¬ãƒ¼ãƒ å¾Œã«æ¶ˆå»å®Ÿè¡Œ
    if (eraseFrameCount >= 30) // ç´„0.5ç§’
    {
        Stage.EraseBoards(currentEraseInfo.EraseList);
        
        // å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯
        if (Stage.IsAllClear())
        {
            Score.AddZenkeshiBonus();
        }
        
        currentEraseInfo = null;
        Mode = GameMode.CheckFall;
    }
}
```

ã€Œæ¶ˆå»å‡¦ç†ã®å¾Œã«å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ã—ãŸã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚ã·ã‚ˆã‚’æ¶ˆå»ã—ãŸå¾Œã€ç›¤é¢ãŒç©ºã«ãªã£ãŸã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€å…¨æ¶ˆã—ã§ã‚ã‚Œã°å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’åŠ ç®—ã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’ã‚²ãƒ¼ãƒ ã«çµ±åˆ'
```

### Blazorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ›´æ–°

å…¨æ¶ˆã—æ™‚ã®æ¼”å‡ºã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Pages/GamePage.razorï¼ˆæ›´æ–°ï¼‰
@page "/game"
@using PuyoPuyoTDD.Models
@using Microsoft.JSInterop
@implements IDisposable

<h3>ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ </h3>

@if (!gameStarted)
{
    <button @onclick="StartGame" class="btn btn-primary">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
}
else
{
    <div class="game-area" tabindex="0" 
         @onkeydown="HandleKeyDown" 
         @onkeyup="HandleKeyUp"
         @ref="gameAreaRef">
        <canvas @ref="gameCanvas" 
                width="@game!.Config!.CanvasWidth" 
                height="@game!.Config!.CanvasHeight"
                style="border: 1px solid black;">
        </canvas>
        <div class="info-area">
            <div class="score-display">
                <h4>ã‚¹ã‚³ã‚¢</h4>
                <p class="score-value @(scoreAnimating ? "score-pulse" : "")">
                    @game!.Score!.CurrentScore
                </p>
            </div>
            @if (game!.CombinationCount > 0)
            {
                <div class="chain-display">
                    <p class="chain-value">@game!.CombinationCount é€£é–ï¼</p>
                </div>
            }
            @if (showZenkeshi)
            {
                <div class="zenkeshi-display">
                    <p class="zenkeshi-text">å…¨æ¶ˆã—ï¼</p>
                    <p class="zenkeshi-bonus">+3600</p>
                </div>
            }
        </div>
        <div class="debug-area">
            <p>ãƒ•ãƒ¬ãƒ¼ãƒ : @game!.Frame</p>
            <p>ã·ã‚ˆä½ç½®: (@game!.Player!.PuyoX, @game!.Player!.PuyoY)</p>
            <p>å›è»¢: @game!.Player!.Rotation</p>
            <p>ãƒ¢ãƒ¼ãƒ‰: @game!.Mode</p>
            <p>é€£é–æ•°: @game!.CombinationCount</p>
        </div>
    </div>
}

<style>
    /* ... æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ« ... */

    .zenkeshi-display {
        animation: zenkeshiPop 1s ease;
        margin-top: 10px;
    }

    .zenkeshi-text {
        font-size: 2.5rem;
        font-weight: bold;
        color: #FFD700;
        margin: 0;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        animation: zenkeshiGlow 1s infinite alternate;
    }

    .zenkeshi-bonus {
        font-size: 1.8rem;
        font-weight: bold;
        color: #FFA500;
        margin: 5px 0 0 0;
    }

    @@keyframes zenkeshiPop {
        0% { 
            opacity: 0; 
            transform: scale(0.5) rotate(-5deg); 
        }
        50% { 
            transform: scale(1.2) rotate(5deg); 
        }
        100% { 
            opacity: 1; 
            transform: scale(1) rotate(0deg); 
        }
    }

    @@keyframes zenkeshiGlow {
        from { text-shadow: 3px 3px 6px rgba(255,215,0,0.8); }
        to { text-shadow: 3px 3px 12px rgba(255,215,0,1); }
    }
</style>

@code {
    private Game? game;
    private ElementReference gameCanvas;
    private ElementReference gameAreaRef;
    private bool gameStarted = false;
    private System.Threading.Timer? gameTimer;
    private IJSObjectReference? canvasModule;
    private bool scoreAnimating = false;
    private int lastScore = 0;
    private bool showZenkeshi = false;

    [Inject]
    public IJSRuntime JSRuntime { get; set; } = default!;

    // ... ãã®ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ ...

    private async Task GameLoop()
    {
        if (game == null) return;

        var previousScore = lastScore;
        var wasAllClear = game.Stage?.IsAllClear() ?? false;

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°
        game.Update();

        // å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ï¼ˆæ¶ˆå»å¾Œã«ç›¤é¢ãŒç©ºã«ãªã£ãŸï¼‰
        if (!wasAllClear && (game.Stage?.IsAllClear() ?? false))
        {
            showZenkeshi = true;
            
            // 2ç§’å¾Œã«éè¡¨ç¤º
            _ = Task.Delay(2000).ContinueWith(_ =>
            {
                showZenkeshi = false;
                InvokeAsync(StateHasChanged);
            });
        }

        // ã‚¹ã‚³ã‚¢ãŒå¤‰åŒ–ã—ãŸã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        if (game.Score!.CurrentScore != previousScore)
        {
            scoreAnimating = true;
            lastScore = game.Score.CurrentScore;
            
            _ = Task.Delay(300).ContinueWith(_ =>
            {
                scoreAnimating = false;
                InvokeAsync(StateHasChanged);
            });
        }

        // canvasæç”»
        if (canvasModule != null)
        {
            await DrawGame();
        }

        // ç”»é¢ã‚’æ›´æ–°
        await InvokeAsync(StateHasChanged);
    }

    // ... ãã®ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ ...
}
```

ã€Œå…¨æ¶ˆã—æ™‚ã«ç‰¹åˆ¥ãªæ¼”å‡ºãŒè¿½åŠ ã•ã‚ŒãŸã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚é‡‘è‰²ã®ã€Œå…¨æ¶ˆã—ï¼ã€ãƒ†ã‚­ã‚¹ãƒˆã¨ã€Œ+3600ã€ãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤ºãŒã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¨ã‚‚ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

### ç”»é¢ã®ç¢ºèª

å®Ÿè£…ã—ãŸæ©Ÿèƒ½ã‚’å®Ÿéš›ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

```bash
cd PuyoPuyoTDD
dotnet run
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:5000/game` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

#### å…¨æ¶ˆã—ã®ç¢ºèª

ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã—ã¦ã€å…¨æ¶ˆã—ã‚’å®Ÿç¾ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **ã‚·ãƒ³ãƒ—ãƒ«ãªå…¨æ¶ˆã—**: æœ€åˆã®4ã¤ã®ã·ã‚ˆã‚’æƒãˆã¦æ¶ˆã™ã ã‘ã§å…¨æ¶ˆã—
   - ç›¤é¢ãŒç©ºã«ãªã‚‹
   - é‡‘è‰²ã®ã€Œå…¨æ¶ˆã—ï¼ã€ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - ã€Œ+3600ã€ãƒœãƒ¼ãƒŠã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - ã‚¹ã‚³ã‚¢ãŒå¤§ããå¢—åŠ ã™ã‚‹

2. **é€£é–ã‹ã‚‰ã®å…¨æ¶ˆã—**: è¤‡æ•°å›ã®é€£é–ã‚’çµŒã¦å…¨æ¶ˆã—
   - é€£é–ãƒœãƒ¼ãƒŠã‚¹ + å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã§é«˜å¾—ç‚¹
   - é€£é–è¡¨ç¤ºã®å¾Œã«å…¨æ¶ˆã—è¡¨ç¤ºãŒå‡ºã‚‹

ã€Œå…¨æ¶ˆã—ã™ã‚‹ã¨ç”»é¢ãŒè¯ã‚„ã‹ã«ãªã‚Šã¾ã™ã­ï¼ã€ãã†ãªã‚“ã§ã™ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤§ããªé”æˆã«å¯¾ã—ã¦ã€ã—ã£ã‹ã‚Šã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¿”ã™ã“ã¨ãŒé‡è¦ã§ã™ã€‚

#### å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®ç¢ºèª

ã‚¹ã‚³ã‚¢ã®å¤‰åŒ–ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **é€šå¸¸æ¶ˆå»**: 4å€‹æ¶ˆå»ã€1é€£é–
   - ã‚¹ã‚³ã‚¢: 10 Ã— 4 Ã— 1 = 40ç‚¹

2. **å…¨æ¶ˆã—**: 4å€‹æ¶ˆå»ã€1é€£é–ã€å…¨æ¶ˆã—
   - ã‚¹ã‚³ã‚¢: 10 Ã— 4 Ã— 1 + 3600 = 3640ç‚¹

3. **é€£é–å…¨æ¶ˆã—**: 4å€‹æ¶ˆå»ã€2é€£é–ã€å…¨æ¶ˆã—
   - 1é€£é–ç›®: 10 Ã— 4 Ã— 1 = 40ç‚¹
   - 2é€£é–ç›®: 10 Ã— 4 Ã— 8 = 320ç‚¹
   - å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹: 3600ç‚¹
   - åˆè¨ˆ: 3960ç‚¹

ã€Œå…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®å¨åŠ›ãŒã™ã”ã„ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼å…¨æ¶ˆã—ã¯é›£ã—ã„ã§ã™ãŒã€é”æˆã™ã‚‹ã¨å¤§ããªãƒœãƒ¼ãƒŠã‚¹ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

ç¢ºèªãŒçµ‚ã‚ã£ãŸã‚‰ã€Ctrl+Cã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢ã—ã¾ã—ã‚‡ã†ã€‚

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³7ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³7ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã“ã¾ã§ã§ã€ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼š

1. **å…¨æ¶ˆã—åˆ¤å®š**: ç›¤é¢ä¸Šã«ã·ã‚ˆãŒæ®‹ã£ã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯
2. **å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹**: å›ºå®šå€¤3600ç‚¹ã®ãƒœãƒ¼ãƒŠã‚¹
3. **ã‚²ãƒ¼ãƒ ã¸ã®çµ±åˆ**: æ¶ˆå»å¾Œã®å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ã¨ãƒœãƒ¼ãƒŠã‚¹åŠ ç®—
4. **å…¨æ¶ˆã—æ¼”å‡º**: é‡‘è‰²ã®ã€Œå…¨æ¶ˆã—ï¼ã€è¡¨ç¤ºã¨ã€Œ+3600ã€ãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤º
5. **è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨è¼ãã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

ã€Œã‚²ãƒ¼ãƒ ãŒã•ã‚‰ã«é¢ç™½ããªã‚Šã¾ã—ãŸï¼ã€ãã®é€šã‚Šã§ã™ï¼å…¨æ¶ˆã—ã¨ã„ã†ç›®æ¨™ãŒã§ãã‚‹ã“ã¨ã§ã€æˆ¦ç•¥çš„ãªãƒ—ãƒ¬ã‚¤ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚

> ã‚²ãƒ¼ãƒ è¨­è¨ˆã®å¦™
>
> å›°é›£ã ãŒé”æˆå¯èƒ½ãªç›®æ¨™ã¨ã€ãã‚Œã«è¦‹åˆã£ãŸå ±é…¬ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å¤¢ä¸­ã«ãªã£ã¦ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã—ã¾ã™ã€‚å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯ã€ã¾ã•ã«ãã®å¥½ä¾‹ã§ã™ã€‚
>
> â€” Sid Meier ã€Game Designã€

æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³8ã§ã¯ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®šã¨ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚ã“ã‚Œã§ã€ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã¨ã—ã¦ã®åŸºæœ¬æ©Ÿèƒ½ãŒå®Œæˆã—ã¾ã™ã‚ˆï¼æ¥½ã—ã¿ã«ã—ã¦ã„ã¦ãã ã•ã„ã€‚

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³8: ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã¨ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã®å®Ÿè£…

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³7ã§å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚ã„ã‚ˆã„ã‚ˆæœ€å¾Œã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ï¼ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®šã¨ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã€ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Œæˆã•ã›ã¾ã—ã‚‡ã†ã€‚

> ã‚²ãƒ¼ãƒ ã®çµ‚ã‚ã‚Š
>
> ã‚²ãƒ¼ãƒ ã«ã¯æ˜ç¢ºãªå§‹ã¾ã‚Šã¨çµ‚ã‚ã‚ŠãŒå¿…è¦ã§ã™ã€‚çµ‚ã‚ã‚ŠãŒã‚ã‚‹ã‹ã‚‰ã“ãã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯æ¬¡ã®ãƒ—ãƒ¬ã‚¤ã¸ã®æ„æ¬²ã‚’æŒã¡ã¾ã™ã€‚
>
> â€” Jane McGonigal ã€Reality is Brokenã€

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã«ãªã‚‹ã¨ã‚²ãƒ¼ãƒ çµ‚äº†ã®æ¼”å‡ºã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼å¾Œã«æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹

ã€Œã‚²ãƒ¼ãƒ ãŒçµ‚ã‚ã£ãŸã“ã¨ãŒæ˜ç¢ºã«åˆ†ã‹ã‚Šã€ã¾ãŸæ–°ã—ãå§‹ã‚ã‚‰ã‚Œã‚‹ã¨ã„ã„ã§ã™ã­ï¼ã€ãã†ã§ã™ã­ã€‚ã‚²ãƒ¼ãƒ ã®çµ‚ã‚ã‚ŠãŒæ˜ç¢ºã§ãªã„ã¨ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã—ãŸæ°—æŒã¡ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

### TODOãƒªã‚¹ãƒˆ

ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®šã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ããªã„çŠ¶æ…‹ã‚’æ¤œå‡ºï¼‰
- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ¼”å‡ºã‚’å®Ÿè£…ã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®è¡¨ç¤ºï¼‰
- ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã‚’æœ€åˆã‹ã‚‰å§‹ã‚ã‚‹ï¼‰
- ãƒªã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’å®Ÿè£…ã™ã‚‹ï¼ˆUIï¼‰

ã€Œé †ç•ªã«å®Ÿè£…ã—ã¦ã„ãã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æµã‚Œã«æ²¿ã£ã¦ã€ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### ãƒ†ã‚¹ãƒˆ: ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š

ã¾ãšã€æ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ããªã„çŠ¶æ…‹ãŒã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã¨åˆ¤å®šã•ã‚Œã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/PlayerTest.csï¼ˆç¶šãï¼‰
[Fact]
public void æ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ããªã„å ´åˆã¯ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®šãŒtrueã«ãªã‚‹()
{
    // Arrange
    // ã‚¹ãƒ†ãƒ¼ã‚¸ã®ä¸Šéƒ¨ï¼ˆæ–°ã—ã„ã·ã‚ˆã®é…ç½®ä½ç½®ï¼‰ã«ã·ã‚ˆã‚’é…ç½®
    stage.SetPuyo(2, 0, 1); // ä¸­å¤®ä¸Šéƒ¨
    player.CreateNewPuyo();

    // Act
    var isGameOver = player.CheckGameOver();

    // Assert
    Assert.True(isGameOver);
}

[Fact]
public void æ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ãã‚‹å ´åˆã¯ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®šãŒfalseã«ãªã‚‹()
{
    // Arrange
    player.CreateNewPuyo();

    // Act
    var isGameOver = player.CheckGameOver();

    // Assert
    Assert.False(isGameOver);
}

[Fact]
public void å›è»¢ã‚’è€ƒæ…®ã—ãŸ2ã¤ç›®ã®ã·ã‚ˆã®ä½ç½®ã‚‚åˆ¤å®šã«å«ã¾ã‚Œã‚‹()
{
    // Arrange
    // 2ã¤ç›®ã®ã·ã‚ˆã®ä½ç½®ï¼ˆä¸Šï¼‰ã«ã·ã‚ˆã‚’é…ç½®
    stage.SetPuyo(2, -1, 1); // ç”»é¢å¤–ã ãŒåˆ¤å®šã«ã¯å½±éŸ¿
    player.CreateNewPuyo();
    player.SetRotation(0); // ä¸Šå‘ã

    // Act
    var isGameOver = player.CheckGameOver();

    // Assert
    // 2ã¤ç›®ã®ã·ã‚ˆã®ä½ç½®ãŒç”»é¢å¤–ã®å ´åˆã¯ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã¯ãªã„
    Assert.False(isGameOver);
}
```

ã€Œã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ä½•ã‚’ç¢ºèªã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ï¼š

1. æ–°ã—ã„ã·ã‚ˆã®é…ç½®ä½ç½®ã«ã™ã§ã«ã·ã‚ˆãŒã‚ã‚‹å ´åˆã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã¨åˆ¤å®šã•ã‚Œã‚‹
2. é…ç½®ä½ç½®ãŒç©ºã„ã¦ã„ã‚‹å ´åˆã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã¯ãªã„
3. 2ã¤ç›®ã®ã·ã‚ˆã®ä½ç½®ã‚‚è€ƒæ…®ã•ã‚Œã‚‹

### å®Ÿè£…: ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š

ã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Player.csï¼ˆç¶šãï¼‰
public bool CheckGameOver()
{
    // æ–°ã—ã„ã·ã‚ˆã®é…ç½®ä½ç½®ï¼ˆä¸­å¤®ä¸Šéƒ¨ï¼‰ã«ã™ã§ã«ã·ã‚ˆãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    if (stage.GetPuyo(PuyoX, PuyoY) != 0)
    {
        return true;
    }

    // 2ã¤ç›®ã®ã·ã‚ˆã®ä½ç½®ã‚‚ãƒã‚§ãƒƒã‚¯
    var (secondX, secondY) = GetSecondPuyoPosition();
    
    // 2ã¤ç›®ã®ã·ã‚ˆãŒç”»é¢å†…ã§ã€ãã®ä½ç½®ã«ã™ã§ã«ã·ã‚ˆãŒã‚ã‚‹å ´åˆ
    if (secondY >= 0 && secondY < config.StageHeight &&
        secondX >= 0 && secondX < config.StageWidth)
    {
        if (stage.GetPuyo(secondX, secondY) != 0)
        {
            return true;
        }
    }

    return false;
}
```

ã€Œé…ç½®ä½ç½®ã«ã·ã‚ˆãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚1ã¤ç›®ã¨2ã¤ç›®ã®ã·ã‚ˆã€ä¸¡æ–¹ã®é…ç½®ä½ç½®ã«ã·ã‚ˆãŒãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®šã‚’å®Ÿè£…'
```

### ãƒ†ã‚¹ãƒˆ: ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰é·ç§»

æ¬¡ã«ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰é·ç§»ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/GameTest.csï¼ˆç¶šãï¼‰
[Fact]
public void æ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ããªã„å ´åˆã¯GameOverãƒ¢ãƒ¼ãƒ‰ã«é·ç§»ã™ã‚‹()
{
    // Arrange
    var game = new Game();
    game.Initialize();
    
    // ã‚¹ãƒ†ãƒ¼ã‚¸ã®ä¸Šéƒ¨ã«ã·ã‚ˆã‚’é…ç½®
    game.Stage!.SetPuyo(2, 0, 1);
    game.Mode = GameMode.NewPuyo;

    // Act
    game.Update();

    // Assert
    Assert.Equal(GameMode.GameOver, game.Mode);
}

[Fact]
public void GameOverãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚²ãƒ¼ãƒ ã®å‡¦ç†ãŒåœæ­¢ã™ã‚‹()
{
    // Arrange
    var game = new Game();
    game.Initialize();
    game.Mode = GameMode.GameOver;
    var initialFrame = game.Frame;

    // Act
    game.Update();

    // Assert
    // ãƒ•ãƒ¬ãƒ¼ãƒ ã¯é€²ã‚€ãŒã€ã‚²ãƒ¼ãƒ å‡¦ç†ã¯è¡Œã‚ã‚Œãªã„
    Assert.Equal(initialFrame + 1, game.Frame);
}
```

### å®Ÿè£…: ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰é·ç§»

ã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Game.csï¼ˆæ›´æ–°ï¼‰
private void UpdateNewPuyo()
{
    if (Player == null) return;

    // é€£é–æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ
    CombinationCount = 0;

    // æ–°ã—ã„ã·ã‚ˆã‚’ç”Ÿæˆ
    Player.CreateNewPuyo();

    // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š
    if (Player.CheckGameOver())
    {
        Mode = GameMode.GameOver;
        return;
    }

    // Playingãƒ¢ãƒ¼ãƒ‰ã«é·ç§»
    Mode = GameMode.Playing;
}

public void Update()
{
    Frame++;

    switch (Mode)
    {
        case GameMode.Start:
            Mode = GameMode.NewPuyo;
            break;

        case GameMode.NewPuyo:
            UpdateNewPuyo();
            break;

        case GameMode.Playing:
            UpdatePlaying();
            break;

        case GameMode.CheckErase:
            UpdateCheckErase();
            break;

        case GameMode.Erasing:
            UpdateErasing();
            break;

        case GameMode.CheckFall:
            UpdateCheckFall();
            break;

        case GameMode.Fall:
            UpdateFall();
            break;

        case GameMode.GameOver:
            // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã¯ä½•ã‚‚ã—ãªã„
            break;
    }
}
```

ã€Œæ–°ã—ã„ã·ã‚ˆç”Ÿæˆæ™‚ã«ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®šã‚’è¿½åŠ ã—ãŸã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚æ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ããªã„å ´åˆã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«é·ç§»ã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®ãƒ¢ãƒ¼ãƒ‰é·ç§»ã‚’å®Ÿè£…'
```

### ãƒ†ã‚¹ãƒˆ: ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½

æ¬¡ã«ã€ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD.Tests/Models/GameTest.csï¼ˆç¶šãï¼‰
[Fact]
public void ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãŒåˆæœŸçŠ¶æ…‹ã«æˆ»ã‚‹()
{
    // Arrange
    var game = new Game();
    game.Initialize();
    
    // ã‚²ãƒ¼ãƒ ã‚’é€²ã‚ã‚‹
    game.Score!.AddScore(1000);
    game.Stage!.SetPuyo(2, 10, 1);
    game.Mode = GameMode.GameOver;

    // Act
    game.Restart();

    // Assert
    Assert.Equal(0, game.Score.CurrentScore); // ã‚¹ã‚³ã‚¢ãŒãƒªã‚»ãƒƒãƒˆ
    Assert.Equal(0, game.Stage.GetPuyo(2, 10)); // ã‚¹ãƒ†ãƒ¼ã‚¸ãŒã‚¯ãƒªã‚¢
    Assert.Equal(GameMode.Start, game.Mode); // ãƒ¢ãƒ¼ãƒ‰ãŒStartã«æˆ»ã‚‹
    Assert.Equal(0, game.Frame); // ãƒ•ãƒ¬ãƒ¼ãƒ ãŒãƒªã‚»ãƒƒãƒˆ
}

[Fact]
public void ãƒªã‚¹ã‚¿ãƒ¼ãƒˆå¾Œã«ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹()
{
    // Arrange
    var game = new Game();
    game.Initialize();
    game.Mode = GameMode.GameOver;
    game.Restart();

    // Act
    game.Update(); // Start â†’ NewPuyo
    game.Update(); // NewPuyo â†’ Playing

    // Assert
    Assert.Equal(GameMode.Playing, game.Mode);
    Assert.NotNull(game.Player);
}
```

### å®Ÿè£…: ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½

ã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Models/Game.csï¼ˆæ›´æ–°ï¼‰
public void Restart()
{
    // ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–
    Initialize();
}
```

ã€Œã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã¯ã€ã‚²ãƒ¼ãƒ ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™ã ã‘ãªã®ã§ã€`Initialize()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã ã‘ã§å®Ÿç¾ã§ãã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…'
```

### Blazorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ›´æ–°

ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ¼”å‡ºã¨ãƒªã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```csharp
// PuyoPuyoTDD/Pages/GamePage.razorï¼ˆæ›´æ–°ï¼‰
@page "/game"
@using PuyoPuyoTDD.Models
@using Microsoft.JSInterop
@implements IDisposable

<h3>ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ </h3>

@if (!gameStarted)
{
    <button @onclick="StartGame" class="btn btn-primary">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
}
else
{
    <div class="game-container">
        <div class="game-area" tabindex="0" 
             @onkeydown="HandleKeyDown" 
             @onkeyup="HandleKeyUp"
             @ref="gameAreaRef">
            <canvas @ref="gameCanvas" 
                    width="@game!.Config!.CanvasWidth" 
                    height="@game!.Config!.CanvasHeight"
                    style="border: 1px solid black;">
            </canvas>
            
            @if (game!.Mode == GameMode.GameOver)
            {
                <div class="game-over-overlay">
                    <div class="game-over-content">
                        <h1 class="game-over-text">GAME OVER</h1>
                        <p class="final-score">æœ€çµ‚ã‚¹ã‚³ã‚¢: @game!.Score!.CurrentScore</p>
                        <button @onclick="RestartGame" class="btn btn-success btn-lg">
                            ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤
                        </button>
                    </div>
                </div>
            }

            <div class="info-area">
                <div class="score-display">
                    <h4>ã‚¹ã‚³ã‚¢</h4>
                    <p class="score-value @(scoreAnimating ? "score-pulse" : "")">
                        @game!.Score!.CurrentScore
                    </p>
                </div>
                @if (game!.CombinationCount > 0 && game!.Mode != GameMode.GameOver)
                {
                    <div class="chain-display">
                        <p class="chain-value">@game!.CombinationCount é€£é–ï¼</p>
                    </div>
                }
                @if (showZenkeshi && game!.Mode != GameMode.GameOver)
                {
                    <div class="zenkeshi-display">
                        <p class="zenkeshi-text">å…¨æ¶ˆã—ï¼</p>
                        <p class="zenkeshi-bonus">+3600</p>
                    </div>
                }
            </div>
            <div class="debug-area">
                <p>ãƒ•ãƒ¬ãƒ¼ãƒ : @game!.Frame</p>
                <p>ã·ã‚ˆä½ç½®: (@game!.Player!.PuyoX, @game!.Player!.PuyoY)</p>
                <p>å›è»¢: @game!.Player!.Rotation</p>
                <p>ãƒ¢ãƒ¼ãƒ‰: @game!.Mode</p>
                <p>é€£é–æ•°: @game!.CombinationCount</p>
            </div>
        </div>
    </div>
}

<style>
    .game-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 600px;
    }

    .game-area {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        padding: 20px;
    }

    .game-over-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.5s ease;
    }

    .game-over-content {
        text-align: center;
        padding: 40px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        backdrop-filter: blur(10px);
    }

    .game-over-text {
        color: #FF4444;
        font-size: 4rem;
        font-weight: bold;
        margin: 0 0 20px 0;
        text-shadow: 4px 4px 8px rgba(0,0,0,0.8);
        animation: gameOverPulse 1s infinite alternate;
    }

    @@keyframes gameOverPulse {
        from { 
            transform: scale(1); 
            text-shadow: 4px 4px 8px rgba(255,68,68,0.8);
        }
        to { 
            transform: scale(1.05); 
            text-shadow: 4px 4px 16px rgba(255,68,68,1);
        }
    }

    .final-score {
        color: #FFFFFF;
        font-size: 1.5rem;
        margin: 20px 0 30px 0;
    }

    .btn-lg {
        padding: 15px 40px;
        font-size: 1.2rem;
        font-weight: bold;
        border-radius: 10px;
        transition: all 0.3s ease;
    }

    .btn-lg:hover {
        transform: scale(1.1);
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .info-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        min-height: 100px;
    }

    .score-display h4 {
        margin: 0;
        font-size: 1.2rem;
        color: #333;
    }

    .score-value {
        font-size: 2rem;
        font-weight: bold;
        color: #2196F3;
        margin: 5px 0;
        transition: all 0.3s ease;
    }

    .score-pulse {
        animation: pulse 0.3s ease;
        color: #FF9800;
    }

    @@keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.2); }
    }

    .chain-display {
        animation: fadeIn 0.3s ease;
    }

    .chain-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #F44336;
        margin: 0;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    @@keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .zenkeshi-display {
        animation: zenkeshiPop 1s ease;
        margin-top: 10px;
    }

    .zenkeshi-text {
        font-size: 2.5rem;
        font-weight: bold;
        color: #FFD700;
        margin: 0;
        text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        animation: zenkeshiGlow 1s infinite alternate;
    }

    .zenkeshi-bonus {
        font-size: 1.8rem;
        font-weight: bold;
        color: #FFA500;
        margin: 5px 0 0 0;
    }

    @@keyframes zenkeshiPop {
        0% { 
            opacity: 0; 
            transform: scale(0.5) rotate(-5deg); 
        }
        50% { 
            transform: scale(1.2) rotate(5deg); 
        }
        100% { 
            opacity: 1; 
            transform: scale(1) rotate(0deg); 
        }
    }

    @@keyframes zenkeshiGlow {
        from { text-shadow: 3px 3px 6px rgba(255,215,0,0.8); }
        to { text-shadow: 3px 3px 12px rgba(255,215,0,1); }
    }

    .debug-area {
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
        background-color: #f9f9f9;
        font-family: monospace;
    }

    .debug-area p {
        margin: 5px 0;
    }
</style>

@code {
    private Game? game;
    private ElementReference gameCanvas;
    private ElementReference gameAreaRef;
    private bool gameStarted = false;
    private System.Threading.Timer? gameTimer;
    private IJSObjectReference? canvasModule;
    private bool scoreAnimating = false;
    private int lastScore = 0;
    private bool showZenkeshi = false;

    [Inject]
    public IJSRuntime JSRuntime { get; set; } = default!;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && gameStarted && canvasModule == null)
        {
            canvasModule = await JSRuntime.InvokeAsync<IJSObjectReference>(
                "import", "./js/canvas.js");
        }
    }

    private async Task StartGame()
    {
        game = new Game();
        game.Initialize();
        game.Player!.CreateNewPuyo();
        game.Mode = GameMode.Playing;
        gameStarted = true;

        StateHasChanged();

        await Task.Delay(100);
        await gameAreaRef.FocusAsync();

        gameTimer = new System.Threading.Timer(
            async _ => await GameLoop(),
            null,
            TimeSpan.Zero,
            TimeSpan.FromMilliseconds(16.6));
    }

    private async Task RestartGame()
    {
        if (game == null) return;

        game.Restart();
        game.Player!.CreateNewPuyo();
        game.Mode = GameMode.Playing;
        showZenkeshi = false;
        scoreAnimating = false;
        lastScore = 0;

        await Task.Delay(100);
        await gameAreaRef.FocusAsync();
    }

    private async Task GameLoop()
    {
        if (game == null) return;

        var previousScore = lastScore;
        var wasAllClear = game.Stage?.IsAllClear() ?? false;

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°
        game.Update();

        // å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯
        if (!wasAllClear && (game.Stage?.IsAllClear() ?? false))
        {
            showZenkeshi = true;
            _ = Task.Delay(2000).ContinueWith(_ =>
            {
                showZenkeshi = false;
                InvokeAsync(StateHasChanged);
            });
        }

        // ã‚¹ã‚³ã‚¢ãŒå¤‰åŒ–ã—ãŸã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        if (game.Score!.CurrentScore != previousScore)
        {
            scoreAnimating = true;
            lastScore = game.Score.CurrentScore;
            _ = Task.Delay(300).ContinueWith(_ =>
            {
                scoreAnimating = false;
                InvokeAsync(StateHasChanged);
            });
        }

        // canvasæç”»
        if (canvasModule != null)
        {
            await DrawGame();
        }

        await InvokeAsync(StateHasChanged);
    }

    private async Task DrawGame()
    {
        if (game == null || canvasModule == null) return;

        await canvasModule.InvokeVoidAsync("clearCanvas", gameCanvas);

        var board = game.Stage!.GetBoard();
        for (int y = 0; y < game.Config!.StageHeight; y++)
        {
            for (int x = 0; x < game.Config.StageWidth; x++)
            {
                var puyoType = board[y, x];
                if (puyoType > 0)
                {
                    await canvasModule.InvokeVoidAsync(
                        "drawPuyo",
                        gameCanvas,
                        x * game.Config.PuyoSize,
                        y * game.Config.PuyoSize,
                        game.Config.PuyoSize,
                        puyoType);
                }
            }
        }

        if (game.Mode == GameMode.Playing && game.Player != null)
        {
            await canvasModule.InvokeVoidAsync(
                "drawPuyo",
                gameCanvas,
                game.Player.PuyoX * game.Config.PuyoSize,
                game.Player.PuyoY * game.Config.PuyoSize,
                game.Config.PuyoSize,
                game.Player.PuyoType);

            var (secondX, secondY) = GetSecondPuyoPosition(game.Player);
            if (secondY >= 0 && secondY < game.Config.StageHeight &&
                secondX >= 0 && secondX < game.Config.StageWidth)
            {
                await canvasModule.InvokeVoidAsync(
                    "drawPuyo",
                    gameCanvas,
                    secondX * game.Config.PuyoSize,
                    secondY * game.Config.PuyoSize,
                    game.Config.PuyoSize,
                    game.Player.NextPuyoType);
            }
        }
    }

    private (int x, int y) GetSecondPuyoPosition(Player player)
    {
        return player.Rotation switch
        {
            0 => (player.PuyoX, player.PuyoY - 1),
            1 => (player.PuyoX + 1, player.PuyoY),
            2 => (player.PuyoX, player.PuyoY + 1),
            3 => (player.PuyoX - 1, player.PuyoY),
            _ => (player.PuyoX, player.PuyoY)
        };
    }

    private void HandleKeyDown(KeyboardEventArgs e)
    {
        if (game?.Mode != GameMode.Playing) return;

        game?.Player?.HandleKeyDown(e.Key);

        switch (e.Key)
        {
            case "ArrowLeft":
                game?.Player?.MoveLeft();
                break;
            case "ArrowRight":
                game?.Player?.MoveRight();
                break;
            case "ArrowUp":
                game?.Player?.RotateRight();
                break;
        }
    }

    private void HandleKeyUp(KeyboardEventArgs e)
    {
        game?.Player?.HandleKeyUp(e.Key);
    }

    public void Dispose()
    {
        gameTimer?.Dispose();
        canvasModule?.DisposeAsync();
    }
}
```

ã€Œã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚åŠé€æ˜ã®é»’ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ä¸Šã«ã€èµ¤ã„ã€ŒGAME OVERã€ãƒ†ã‚­ã‚¹ãƒˆã¨æœ€çµ‚ã‚¹ã‚³ã‚¢ã€ãƒªã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

### ç”»é¢ã®ç¢ºèª

å®Ÿè£…ã—ãŸæ©Ÿèƒ½ã‚’å®Ÿéš›ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

```bash
cd PuyoPuyoTDD
dotnet run
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:5000/game` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

#### ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã®ç¢ºèª

ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã«ãªã‚‹ã¾ã§ãƒ—ãƒ¬ã‚¤ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **è‡ªç„¶ãªã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼**: ã·ã‚ˆã‚’ç©ã¿é‡ã­ã¦ã€ä¸Šéƒ¨ã¾ã§åˆ°é”ã•ã›ã‚‹
   - æ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ããªããªã‚‹
   - ç”»é¢ãŒæš—ããªã‚‹
   - èµ¤ã„ã€ŒGAME OVERã€ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - æœ€çµ‚ã‚¹ã‚³ã‚¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹

2. **ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ¼”å‡º**: 
   - åŠé€æ˜ã®é»’ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
   - ã€ŒGAME OVERã€ãƒ†ã‚­ã‚¹ãƒˆãŒè„ˆå‹•ã™ã‚‹
   - ã€Œã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹

ã€Œã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã®æ¼”å‡ºãŒã‹ã£ã“ã„ã„ã§ã™ã­ï¼ã€ãã†ãªã‚“ã§ã™ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æ˜ç¢ºã«ã‚²ãƒ¼ãƒ ãŒçµ‚äº†ã—ãŸã“ã¨ã‚’ä¼ãˆã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

#### ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½ã®ç¢ºèª

ã€Œã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **ã‚²ãƒ¼ãƒ ã®ãƒªã‚»ãƒƒãƒˆ**:
   - ã‚¹ã‚³ã‚¢ãŒ0ã«æˆ»ã‚‹
   - ã‚¹ãƒ†ãƒ¼ã‚¸ãŒã‚¯ãƒªã‚¢ã•ã‚Œã‚‹
   - æ–°ã—ã„ã·ã‚ˆãŒç™»å ´ã™ã‚‹

2. **å³åº§ã«ãƒ—ãƒ¬ã‚¤é–‹å§‹**:
   - ã™ãã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œãŒã§ãã‚‹
   - ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ãŒç¶™ç¶šã—ã¦ã„ã‚‹
   - ã‚¹ãƒ ãƒ¼ã‚ºã«æ¬¡ã®ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã‚‹

ã€Œä½•åº¦ã§ã‚‚ãƒ—ãƒ¬ã‚¤ã§ãã¾ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½ã«ã‚ˆã‚Šã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯æ°—è»½ã«ä½•åº¦ã§ã‚‚æŒ‘æˆ¦ã§ãã¾ã™ã€‚

#### ã‚¹ã‚³ã‚¢ã‚¢ã‚¿ãƒƒã‚¯

ä½•åº¦ã‹ãƒ—ãƒ¬ã‚¤ã—ã¦ã€ä»¥ä¸‹ã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **é€£é–ã‚’ç‹™ã†**: é«˜å¾—ç‚¹ã‚’ç›®æŒ‡ã—ã¦é€£é–ã‚’çµ„ã¿ç«‹ã¦ã‚‹
2. **å…¨æ¶ˆã—ã‚’ç‹™ã†**: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹3600ç‚¹ã‚’ç²å¾—ã™ã‚‹
3. **é«˜å¾—ç‚¹ã‚’è¨˜éŒ²**: è‡ªåˆ†ã®ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢ã‚’æ›´æ–°ã™ã‚‹

ã€Œã‚²ãƒ¼ãƒ ã¨ã—ã¦å®Œæˆã—ã¦ã„ã¾ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼åŸºæœ¬çš„ãªã‚²ãƒ¼ãƒ æ©Ÿèƒ½ãŒã™ã¹ã¦æƒã„ã¾ã—ãŸã€‚

ç¢ºèªãŒçµ‚ã‚ã£ãŸã‚‰ã€Ctrl+Cã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢ã—ã¾ã—ã‚‡ã†ã€‚

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³8ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³8ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã“ã¾ã§ã§ã€ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼š

1. **ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š**: æ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ããªã„çŠ¶æ…‹ã‚’æ¤œå‡º
2. **ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰é·ç§»**: NewPuyo â†’ GameOver
3. **ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ¼”å‡º**: åŠé€æ˜ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¨ã€ŒGAME OVERã€è¡¨ç¤º
4. **æœ€çµ‚ã‚¹ã‚³ã‚¢è¡¨ç¤º**: ãƒ—ãƒ¬ã‚¤çµæœã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
5. **ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½**: ã‚²ãƒ¼ãƒ ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
6. **ãƒªã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³**: UIã‹ã‚‰ã®å†ãƒ—ãƒ¬ã‚¤é–‹å§‹

ã€Œã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ãŒå®Œæˆã—ã¾ã—ãŸï¼ã€ãã®é€šã‚Šã§ã™ï¼Red-Green-Refactorã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ã§ã€å®Œå…¨ã«å‹•ä½œã™ã‚‹ã‚²ãƒ¼ãƒ ãŒå®Ÿè£…ã§ãã¾ã—ãŸã­ã€‚

> å®Œæˆã¸ã®é“
>
> ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯æ±ºã—ã¦å®Œæˆã—ãªã„ã€‚ãŸã ã€ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã ã‘ã ã€‚ã—ã‹ã—ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã«ã‚ˆã‚Šã€å¸¸ã«å‹•ä½œã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ç¶­æŒã§ãã‚‹ã€‚
>
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

## ãµã‚Šã‹ãˆã‚Š

ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®å®Ÿè£…ã‚’å®Œäº†ã™ã‚‹ã“ã¨ãŒã§ããŸã®ã§ã€ã“ã‚Œã¾ã§ã®ãµã‚Šã‹ãˆã‚Šã‚’ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

### Keepï¼ˆç¶šã‘ã‚‹ã“ã¨ï¼‰

ã¾ãš **TODOãƒªã‚¹ãƒˆ** ã‚’ä½œæˆã—ã¦ **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ** ã§ï¼‘ã¤ãšã¤å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§é–‹ç™ºã‚’é€²ã‚ã¦ã„ãã¾ã—ãŸã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã€ŒRed-Green-Refactorã€ã‚µã‚¤ã‚¯ãƒ«ã«å¾“ã†ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’ä¿ã¡ãªãŒã‚‰ã€æ®µéšçš„ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ãã“ã¨ãŒã§ãã¾ã—ãŸã€‚

å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã«åŸºã¥ã„ãŸæ©Ÿèƒ½ã‚’ã€ãƒ†ã‚¹ãƒˆã€å®Ÿè£…ã€è§£èª¬ã®é †ã«é€²ã‚ã¦ã„ãã¾ã—ãŸã€‚ã“ã®æµã‚Œã¯éå¸¸ã«åŠ¹æœçš„ã§ã€å®Ÿè£…ã®æ–¹é‡ãŒæ˜ç¢ºã«ãªã‚Šã€å¿…è¦æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã§æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ç‰¹ã«ä»¥ä¸‹ã®ç‚¹ã¯ä»Šå¾Œã‚‚ç¶šã‘ã¦ã„ããŸã„ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ï¼š

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‹ã‚‰TODOãƒªã‚¹ãƒˆã¸ã®åˆ†è§£**: å¤§ããªæ©Ÿèƒ½ã‚’å°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã™ã‚‹ã“ã¨ã§ã€å®Ÿè£…ã®è¦‹é€šã—ãŒç«‹ã¡ã‚„ã™ããªã‚Šã¾ã—ãŸ
2. **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®åŸå‰‡ã«å¾“ã£ãŸå®Ÿè£…**: å…ˆã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã§ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¨­è¨ˆãŒæ˜ç¢ºã«ãªã‚Šã€å®Ÿè£…ãŒã‚¹ãƒ ãƒ¼ã‚ºã«é€²ã¿ã¾ã—ãŸ
3. **å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã®é–‹ç™º**: ä¸€åº¦ã«å¤šãã®ã“ã¨ã‚’ã—ã‚ˆã†ã¨ã›ãšã€å°ã•ãç¢ºå®Ÿã«é€²ã‚ã‚‹ã“ã¨ã§ã€ãƒã‚°ã®æ··å…¥ã‚’é˜²ã’ã¾ã—ãŸ
4. **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ã®ç¶™ç¶šçš„ãªæ”¹å–„**: æ©Ÿèƒ½è¿½åŠ å¾Œã«ã‚³ãƒ¼ãƒ‰ã‚’æ•´ç†ã™ã‚‹ã“ã¨ã§ã€ä¿å®ˆæ€§ã®é«˜ã„ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ç¶­æŒã§ãã¾ã—ãŸ
5. **C#ã®è¨€èªæ©Ÿèƒ½ã®æ´»ç”¨**: ã‚¿ãƒ—ãƒ«ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã€Nullè¨±å®¹å‚ç…§å‹ãªã©ã‚’é©åˆ‡ã«ä½¿ç”¨ã§ãã¾ã—ãŸ
6. **Blazorã®ç‰¹æ€§ã‚’æ´»ã‹ã—ãŸå®Ÿè£…**: JSInteropã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã€CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åŠ¹æœçš„ã«æ´»ç”¨ã§ãã¾ã—ãŸ

### Problemï¼ˆèª²é¡Œï¼‰

é–‹ç™ºã‚’é€²ã‚ã‚‹ä¸­ã§ã€ã„ãã¤ã‹ã®èª²é¡Œã‚‚è¦‹ãˆã¦ãã¾ã—ãŸã€‚

1. **ãƒ†ã‚¹ãƒˆã®ç²’åº¦**: ãƒ†ã‚¹ãƒˆã‚’ã©ã®ç¨‹åº¦ç´°ã‹ãæ›¸ãã¹ãã‹ã€åˆ¤æ–­ãŒé›£ã—ã„å ´é¢ãŒã‚ã‚Šã¾ã—ãŸã€‚ç´°ã‹ã™ãã‚‹ã¨å†—é•·ã«ãªã‚Šã€ç²—ã™ãã‚‹ã¨å•é¡Œã®ç‰¹å®šãŒé›£ã—ããªã‚Šã¾ã™ã€‚

2. **éåŒæœŸå‡¦ç†ã®ãƒ†ã‚¹ãƒˆ**: Blazorã®JSInteropã‚„éåŒæœŸå‡¦ç†ã®ãƒ†ã‚¹ãƒˆã¯ã€TypeScriptã¨ç•°ãªã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¿…è¦ã§ã—ãŸã€‚

3. **ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®å®Ÿè£…**: JavaScriptã®requestAnimationFrameã®ä»£ã‚ã‚Šã«ã€C#ã®Timerã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€é•ã„ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

4. **çŠ¶æ…‹ç®¡ç†ã®è¤‡é›‘ã•**: ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã®é·ç§»ãŒè¤‡é›‘ã«ãªã‚‹ã«ã¤ã‚Œã¦ã€çŠ¶æ…‹ç®¡ç†ã®é›£ã—ã•ã‚’å®Ÿæ„Ÿã—ã¾ã—ãŸã€‚

5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è€ƒæ…®**: 60FPSã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã€æç”»å‡¦ç†ã®æœ€é©åŒ–ãŒå¿…è¦ã§ã—ãŸã€‚

### Tryï¼ˆæŒ‘æˆ¦ï¼‰

ä»Šå¾Œã¯ä»¥ä¸‹ã®ã“ã¨ã«æŒ‘æˆ¦ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ï¼š

1. **ã‚ˆã‚ŠåŠ¹ç‡çš„ãªãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã®æ¨¡ç´¢**: 
   - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã®ãƒãƒ©ãƒ³ã‚¹
   - E2Eãƒ†ã‚¹ãƒˆã®å°å…¥ï¼ˆPlaywrightãªã©ï¼‰

2. **è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é«˜ã‚ã‚‹å·¥å¤«**:
   - ã‚ˆã‚Šå¤šãã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’ã‚«ãƒãƒ¼ã™ã‚‹
   - Property-based testingã®å°å…¥

3. **ã‚ˆã‚Šè¤‡é›‘ãªã‚²ãƒ¼ãƒ æ©Ÿèƒ½ã¸ã®æŒ‘æˆ¦**:
   - ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯¾å¿œ
   - ãƒªãƒ—ãƒ¬ã‚¤æ©Ÿèƒ½
   - ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã¨ãã®ãƒ†ã‚¹ãƒˆæ‰‹æ³•ã®ç¿’å¾—**:
   - ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã®æ´»ç”¨
   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–

5. **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š**:
   - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®æ”¹å–„
   - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ

6. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰**:
   - GitHub Actionsã§ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
   - è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã®å®Ÿç¾

ã“ã‚Œã‚‰ã®çŸ¥è­˜ã¨çµŒé¨“ã¯ã€ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚å¿œç”¨ã§ãã‚‹ã‚‚ã®ã§ã™ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã¯ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’é«˜ã‚ã€ä¿å®ˆæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®å¼·åŠ›ãªæ‰‹æ³•ã§ã™ã€‚ãœã²ã€è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚å–ã‚Šå…¥ã‚Œã¦ã¿ã¦ãã ã•ã„ã€‚

## ãŠã‚ã‚Šã«

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼C# Blazorã‚’ä½¿ã£ãŸã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®å®Ÿè£…ã‚’ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§å®Œæˆã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é€šã˜ã¦ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å­¦ã³ã¾ã—ãŸï¼š

- **ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®åŸºæœ¬ã‚µã‚¤ã‚¯ãƒ«**: Red-Green-Refactor
- **C# 8.0ã®è¨€èªæ©Ÿèƒ½**: Nullableå‚ç…§å‹ã€ã‚¿ãƒ—ãƒ«ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ¼”ç®—å­
- **Blazor WebAssembly**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€JSInteropã€çŠ¶æ…‹ç®¡ç†
- **ã‚²ãƒ¼ãƒ ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°**: ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã€çŠ¶æ…‹é·ç§»ã€è¡çªåˆ¤å®šã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆDFSï¼‰
- **å“è³ªç®¡ç†**: é™çš„è§£æã€Linterã€ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã€è‡ªå‹•åŒ–ï¼ˆCakeï¼‰

> ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®çœŸä¾¡
>
> ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã¯ã€å˜ã«ãƒã‚°ã‚’æ¸›ã‚‰ã™ãŸã‚ã®æŠ€è¡“ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¨­è¨ˆã‚’æ”¹å–„ã—ã€è‡ªä¿¡ã‚’æŒã£ã¦ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€é–‹ç™ºè€…ã®å¼·åŠ›ãªå‘³æ–¹ãªã®ã§ã™ã€‚
>
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§å­¦ã‚“ã ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æ‰‹æ³•ã¯ã€ã‚²ãƒ¼ãƒ é–‹ç™ºã ã‘ã§ãªãã€ã‚ã‚‰ã‚†ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã«å¿œç”¨ã§ãã¾ã™ã€‚å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§ç¢ºå®Ÿã«é€²ã¿ã€å¸¸ã«å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç¶­æŒã™ã‚‹â€”â€”ã“ã®åŸå‰‡ã‚’å¿˜ã‚Œãšã«ã€ã“ã‚Œã‹ã‚‰ã‚‚ç´ æ™´ã‚‰ã—ã„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä½œã‚Šç¶šã‘ã¦ãã ã•ã„ã€‚

Happy Coding! ğŸ®âœ¨

## å‚è€ƒè³‡æ–™

### æ›¸ç±

- Kent Beckã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€ï¼ˆã‚ªãƒ¼ãƒ ç¤¾ï¼‰
- Robert C. Martinã€Clean Code ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é”äººã®æŠ€ã€ï¼ˆKADOKAWAï¼‰
- Martin Fowlerã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å®‰å…¨ã«æ”¹å–„ã™ã‚‹ã€ï¼ˆã‚ªãƒ¼ãƒ ç¤¾ï¼‰
- Andrew Hunt, David Thomasã€é”äººãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã€ï¼ˆã‚ªãƒ¼ãƒ ç¤¾ï¼‰

### ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒªã‚½ãƒ¼ã‚¹

- [Microsoft .NET Documentation](https://docs.microsoft.com/dotnet/)
- [Blazor Documentation](https://docs.microsoft.com/aspnet/core/blazor/)
- [xUnit Documentation](https://xunit.net/)
- [bUnit Documentation](https://bunit.dev/)
- [Cake Build Documentation](https://cakebuild.net/)

### ã‚²ãƒ¼ãƒ é–‹ç™ºãƒªã‚½ãƒ¼ã‚¹

- [ã·ã‚ˆã·ã‚ˆãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°](https://puyo.sega.jp/program/)
- [Game Programming Patterns](https://gameprogrammingpatterns.com/)

### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£

- [.NET Community](https://dotnet.microsoft.com/platform/community)
- [Blazor Community](https://blazor.net/)

ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼




