---
title: ã·ã‚ˆã·ã‚ˆã‹ã‚‰å§‹ã‚ã‚‹ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º C# WPFç‰ˆ
description: ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æ‰‹æ³•ã‚’ç”¨ã„ã¦C# WPFã§ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã™ã‚‹éç¨‹ã‚’è§£èª¬
published: true
date: 2025-10-10T00:00:00.000Z
tags: tdd, csharp, wpf, ã·ã‚ˆã·ã‚ˆ, dotnet
editor: markdown
dateCreated: 2025-10-10T00:00:00.000Z
---

# ã·ã‚ˆã·ã‚ˆã‹ã‚‰å§‹ã‚ã‚‹ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º C# WPFç‰ˆ

## ã¯ã˜ã‚ã«

ã¿ãªã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼ä»Šæ—¥ã¯ç§ã¨ä¸€ç·’ã«ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ã‚’ä½¿ã£ã¦ã€C# WPFï¼ˆWindows Presentation Foundationï¼‰ã§ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã•ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ—…ã«å‡ºã‚‹å‰ã«ã€çš†ã•ã‚“ã¯ã€Œãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€ã«ã¤ã„ã¦èã„ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿã‚‚ã—ã‹ã—ãŸã‚‰ã€Œãƒ†ã‚¹ãƒˆã£ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ãŸå¾Œã«ã™ã‚‹ã‚‚ã®ã˜ã‚ƒãªã„ã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚

> ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã¨ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ‰‹æ³•ã®ä¸€ç¨®ã§ã€ã€Œãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã€ã®åŸå‰‡ã«å¾“ã„ã€å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’é«˜ã‚ã€è¨­è¨ˆã‚’æ”¹å–„ã—ã¦ã„ãé–‹ç™ºæ‰‹æ³•ã§ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã“ã®è¨˜äº‹ã§ã¯ã€ç§ãŸã¡ãŒä¸€ç·’ã«ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ãªãŒã‚‰ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®åŸºæœ¬çš„ãªæµã‚Œã¨è€ƒãˆæ–¹ã‚’å­¦ã‚“ã§ã„ãã¾ã™ã€‚ã¾ã‚‹ã§ãƒ¢ãƒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚ˆã†ã«ã€ã‚ãªãŸã¨ç§ãŒä¸€ç·’ã«è€ƒãˆã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€æ”¹å–„ã—ã¦ã„ãéç¨‹ã‚’ä½“é¨“ã—ã¾ã—ã‚‡ã†ã€‚ã€Œã§ã‚‚ã€ã·ã‚ˆã·ã‚ˆã£ã¦çµæ§‹è¤‡é›‘ãªã‚²ãƒ¼ãƒ ã˜ã‚ƒãªã„ã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¿ƒé…ã„ã‚Šã¾ã›ã‚“ã€‚å„ç« ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã«åŸºã¥ã„ãŸæ©Ÿèƒ½ã‚’ã€ãƒ†ã‚¹ãƒˆã€å®Ÿè£…ã€è§£èª¬ã®é †ã«å°‘ã—ãšã¤é€²ã‚ã¦ã„ãã¾ã™ã‚ˆã€‚ä¸€æ­©ä¸€æ­©ã€ç€å®Ÿã«é€²ã‚“ã§ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚µã‚¤ã‚¯ãƒ«

ã•ã¦ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€ã©ã®ã‚ˆã†ã«é€²ã‚ã¦ã„ã‘ã°ã„ã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿã€Œãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã‹ã‚‰å®Ÿè£…ã™ã‚‹ã€ã¨ã„ã†ã®ã¯åˆ†ã‹ã‚Šã¾ã—ãŸãŒã€å…·ä½“çš„ã«ã¯ã©ã‚“ãªæ‰‹é †ã§é€²ã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ç§ãŒã„ã¤ã‚‚å®Ÿè·µã—ã¦ã„ã‚‹ã®ã¯ã€ä»¥ä¸‹ã®3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¹°ã‚Šè¿”ã™ã‚µã‚¤ã‚¯ãƒ«ã§ã™ã€‚çš†ã•ã‚“ã‚‚ä¸€ç·’ã«ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **Redï¼ˆèµ¤ï¼‰**: ã¾ãšå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¾ã™ã€‚ã€Œãˆï¼Ÿã‚ã–ã¨å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã‚Œã«ã¯é‡è¦ãªæ„å‘³ãŒã‚ã‚‹ã‚“ã§ã™ã€‚ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½ãŒä½•ã‚’ã™ã¹ãã‹ã‚’æ˜ç¢ºã«ã™ã‚‹ãŸã‚ãªã‚“ã§ã™ã‚ˆã€‚
2. **Greenï¼ˆç·‘ï¼‰**: æ¬¡ã«ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ã€æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã®æ®µéšã§ã¯ã€ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šã‚‚ã€Œã¨ã«ã‹ãå‹•ãã“ã¨ã€ã‚’å„ªå…ˆã—ã¾ã™ã€‚ã€Œæœ€å°é™ã€ã¨ã„ã†ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚å¿…è¦ä»¥ä¸Šã®ã“ã¨ã¯ã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚
3. **Refactorï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰**: æœ€å¾Œã«ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’æ”¹å–„ã—ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªã—ãªãŒã‚‰ã€é‡è¤‡ã‚’å–ã‚Šé™¤ã„ãŸã‚Šã€ã‚ã‹ã‚Šã‚„ã™ã„åå‰ã‚’ã¤ã‘ãŸã‚Šã—ã¾ã™ã€‚ã€Œå‹•ãã‘ã©æ±šã„ã‚³ãƒ¼ãƒ‰ã€ã‹ã‚‰ã€Œå‹•ã„ã¦ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰ã€ã¸ã¨é€²åŒ–ã•ã›ã‚‹ã‚“ã§ã™ã€‚

> ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ãƒªã‚ºãƒ ï¼šèµ¤ã€ç·‘ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€‚ã¾ãšå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆèµ¤ï¼‰ã€æ¬¡ã«ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆç·‘ï¼‰ã€ãã—ã¦é‡è¤‡ã‚’é™¤å»ã™ã‚‹ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ã€ŒRed-Green-Refactorã€ã‚µã‚¤ã‚¯ãƒ«ã¨å‘¼ã³ã¾ã™ã€‚ã€Œèµ¤ãƒ»ç·‘ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€ã®ãƒªã‚ºãƒ ã‚’åˆ»ã‚€ã‚ˆã†ã«ã€ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãã‚“ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€å°‘ã—ãšã¤æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’é«˜ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚çš†ã•ã‚“ã‚‚ä¸€ç·’ã«ã“ã®ãƒªã‚ºãƒ ã‚’ä½“æ„Ÿã—ã¦ã¿ã¦ãã ã•ã„ï¼

```plantuml
@startuml
[*] --> ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ
ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ --> TODO : TODOãƒªã‚¹ãƒˆã‚’ä½œæˆ
TODO --> Red : ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
Red --> Green : æœ€å°é™ã®å®Ÿè£…
Green --> Refactor : ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
Refactor --> Red : æ¬¡ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
Red : ãƒ†ã‚¹ãƒˆã«å¤±æ•—
Green : ãƒ†ã‚¹ãƒˆã«é€šã‚‹æœ€å°é™ã®å®Ÿè£…
Refactor : ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’é™¤å»ã—ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
Refactor --> TODO : ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒå®Œäº†ã—ãŸã‚‰TODOãƒªã‚¹ãƒˆã«æˆ»ã‚‹
TODO --> ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ : TODOãƒªã‚¹ãƒˆãŒç©ºã«ãªã‚‹ã¾ã§ç¹°ã‚Šè¿”ã™
ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒ†ã‚¹ãƒˆ --> ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ“ãƒ¥ãƒ¼
@enduml
```

### é–‹ç™ºç’°å¢ƒ

ã•ã¦ã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã«ã€ç§ãŸã¡ãŒä½¿ç”¨ã™ã‚‹é–‹ç™ºç’°å¢ƒã«ã¤ã„ã¦å°‘ã—ãŠè©±ã—ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚çš†ã•ã‚“ã¯ã€Œé“å…·é¸ã³ã¯ä»•äº‹ã®åŠåˆ†ã€ã¨ã„ã†è¨€è‘‰ã‚’èã„ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã‚‚åŒã˜ã“ã¨ãŒè¨€ãˆã‚‹ã‚“ã§ã™ã€‚

> è‰¯ã„ãƒ„ãƒ¼ãƒ«ã¯è‰¯ã„ä»•äº‹ã®ç¬¬ä¸€æ­©ã§ã™ã€‚é©åˆ‡ãªé“å…·ã‚’é¸ã¶ã“ã¨ã§ã€é–‹ç™ºã®åŠ¹ç‡ã¨å“è³ªãŒå¤§ããå‘ä¸Šã—ã¾ã™ã€‚
> 
> â€” Andrew Hunt & David Thomas ã€é”äººãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã€

ã€Œã©ã‚“ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ãˆã°ã„ã„ã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ãã¾ã™ï¼š

- **è¨€èª**: C# â€” ã€Œ.NETã£ã¦é›£ã—ãã†...ã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€C#ã¯å¼·åŠ›ãªå‹ã‚·ã‚¹ãƒ†ãƒ ã¨è±Šå¯Œãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚Šã€å¤§è¦æ¨¡ãªé–‹ç™ºã§ã‚‚ãƒã‚°ã‚’æ¸›ã‚‰ã—ã‚„ã™ããªã‚‹ã‚“ã§ã™ã€‚
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: WPFï¼ˆWindows Presentation Foundationï¼‰â€” ã€Œãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã£ã¦ä»Šæ›´ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€WPFã¯å¼·åŠ›ãªãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¨XAMLã«ã‚ˆã‚‹å®£è¨€çš„UIå®šç¾©ã«ã‚ˆã‚Šã€ä¿å®ˆæ€§ã®é«˜ã„ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã§ãã¾ã™ã€‚
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³**: MVVMï¼ˆModel-View-ViewModelï¼‰â€” WPFã®å¼·åŠ›ãªãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æ©Ÿèƒ½ã‚’æœ€å¤§é™ã«æ´»ç”¨ã™ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚
- **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: xUnit â€” .NETã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã§åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹ä¿¡é ¼æ€§ã®é«˜ã„ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã«ã¯æ¬ ã‹ã›ãªã„ãƒ„ãƒ¼ãƒ«ã§ã™ã­ã€‚
- **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: Coverlet â€” ãƒ†ã‚¹ãƒˆãŒã©ã‚Œã ã‘ã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã‹ã‚’å¯è¦–åŒ–ã—ã¦ãã‚Œã¾ã™ã€‚ã€Œã©ã“ã‚’ãƒ†ã‚¹ãƒˆã™ã¹ãï¼Ÿã€ã¨ã„ã†ç–‘å•ã«ç­”ãˆã¦ãã‚Œã¾ã™ã‚ˆã€‚
- **é™çš„ã‚³ãƒ¼ãƒ‰è§£æ**: Microsoft.CodeAnalysis.Analyzers â€” ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ã—ã€æ½œåœ¨çš„ãªå•é¡Œã‚’æ—©æœŸã«ç™ºè¦‹ã—ã¦ãã‚Œã¾ã™ã€‚
- **ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿**: dotnet format â€” ã€Œãƒãƒ¼ãƒ å†…ã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„...ã€ãã‚“ãªæ‚©ã¿ã‚’è§£æ±ºã—ã¦ãã‚Œã¾ã™ã€‚
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Git â€” ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´å±¥æ­´ã‚’è¿½è·¡ã—ã€ã€Œã‚ã‚Œï¼Ÿæ˜¨æ—¥ã¾ã§ã¡ã‚ƒã‚“ã¨å‹•ã„ã¦ãŸã®ã«...ã€ã¨ã„ã†ã¨ãã«éå»ã®çŠ¶æ…‹ã«æˆ»ã‚Œã‚‹é­”æ³•ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æµã‚Œã«æ²¿ã£ã¦ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã€Œç’°å¢ƒæ§‹ç¯‰ã£ã¦é›£ã—ãã†...ã€ã¨å¿ƒé…ã•ã‚Œã‚‹æ–¹ã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä»Šå›ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0ã§ã¯ã€ãã®ç’°å¢ƒæ§‹ç¯‰ã«ã¤ã„ã¦ã—ã£ã‹ã‚Šè§£èª¬ã—ã¦ã„ãã¾ã™ã­ï¼

## è¦ä»¶

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã•ã¦ã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã‚‹å‰ã«ã€å°‘ã—ç«‹ã¡æ­¢ã¾ã£ã¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã€Œä½•ã‚’ä½œã‚‹ã®ã‹ï¼Ÿã€ã¨ã„ã†åŸºæœ¬çš„ãªå•ã„ã‹ã‘ã§ã™ã€‚ç§ãŸã¡ãŒä½œã‚‹ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã¯ã€ã©ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’æŒã¤ã¹ãã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™ºã§ã¯ã€ã“ã®ã€Œä½•ã‚’ä½œã‚‹ã®ã‹ï¼Ÿã€ã¨ã„ã†å•ã„ã«å¯¾ã—ã¦ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€ã¨ã„ã†å½¢ã§ç­”ãˆã‚’å‡ºã—ã¾ã™ã€‚çš†ã•ã‚“ã¯ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€ã¨ã„ã†è¨€è‘‰ã‚’èã„ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ

> ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¨ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ©Ÿèƒ½ã‚’ã€Œèª°ãŒã€ã€Œä½•ã‚’ã€ã€Œãªãœã€ã—ãŸã„ã®ã‹ã¨ã„ã†å½¢å¼ã§è¡¨ç¾ã—ãŸã‚‚ã®ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºãƒãƒ¼ãƒ ã¯å¸¸ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦–ç‚¹ã‚’å¿˜ã‚Œãšã«é–‹ç™ºã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
> 
> â€” Mike Cohn ã€User Stories Appliedã€

ã¤ã¾ã‚Šã€ã€Œãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã€‡ã€‡ãŒã§ãã‚‹ï¼ˆã€‡ã€‡ã—ãŸã„ã‹ã‚‰ï¼‰ã€ã¨ã„ã†å½¢å¼ã§æ©Ÿèƒ½ã‚’è¡¨ç¾ã™ã‚‹ã‚“ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€ã€Œèª°ã®ãŸã‚ã€ã®ã€Œã©ã‚“ãªæ©Ÿèƒ½ã€ã‚’ã€Œãªãœã€ä½œã‚‹ã®ã‹ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚ç´ æ™´ã‚‰ã—ã„ã§ã™ã‚ˆã­ï¼

ã§ã¯ã€ç§ãŸã¡ã®ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã§ã¯ã€ã©ã‚“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿä¸€ç·’ã«è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã®åŸºæœ¬æ©Ÿèƒ½ã¨ã—ã¦å¿…è¦ã§ã™ã‚ˆã­ï¼ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã§ãã‚‹ï¼ˆã·ã‚ˆã‚’é©åˆ‡ãªä½ç½®ã«é…ç½®ã—ãŸã„ã§ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å›è»¢ã§ãã‚‹ï¼ˆæˆ¦ç•¥çš„ã«ã·ã‚ˆã‚’é…ç½®ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ˆã€Œæ—©ãæ¬¡ã®ã·ã‚ˆã‚’è½ã¨ã—ãŸã„ï¼ã€ã¨ã„ã†ã¨ãã®ãŸã‚ã«ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€åŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆå»ã§ãã‚‹ï¼ˆã“ã‚ŒãŒã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã§ã™ã‚ˆã­ï¼ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€é€£é–åå¿œã‚’èµ·ã“ã—ã¦ã‚ˆã‚Šé«˜ã„ã‚¹ã‚³ã‚¢ã‚’ç²å¾—ã§ãã‚‹ï¼ˆã€Œã‚Œã€œã‚“ã•ã€œã‚“ï¼ã€ã¨å«ã³ãŸããªã‚Šã¾ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€å…¨æ¶ˆã—ï¼ˆãœã‚“ã‘ã—ï¼‰ãƒœãƒ¼ãƒŠã‚¹ã‚’ç²å¾—ã§ãã‚‹ï¼ˆã€Œã‚„ã£ãŸï¼å…¨éƒ¨æ¶ˆãˆãŸï¼ã€ã¨ã„ã†é”æˆæ„Ÿã‚’å‘³ã‚ã„ãŸã„ã§ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã«ãªã‚‹ã¨ã‚²ãƒ¼ãƒ çµ‚äº†ã®æ¼”å‡ºã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ˆçµ‚ã‚ã‚ŠãŒæ˜ç¢ºã§ãªã„ã¨ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã—ã¾ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ã‚’ç¢ºèªã§ãã‚‹ï¼ˆã€Œä»Šã©ã‚Œãã‚‰ã„ç‚¹æ•°å–ã‚Œã¦ã‚‹ã‹ãªï¼Ÿã€ã¨æ°—ã«ãªã‚Šã¾ã™ã‚ˆã­ï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ã·ã‚ˆã‚’æ“ä½œã§ãã‚‹ï¼ˆPCã§ãƒ—ãƒ¬ã‚¤ã™ã‚‹ãªã‚‰å¿…é ˆã§ã™ã‚ˆã­ï¼‰

ã€Œã†ã‚ã€çµæ§‹ãŸãã•ã‚“ã‚ã‚‹ãª...ã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¿ƒé…ã„ã‚Šã¾ã›ã‚“ï¼ã“ã‚Œã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ä¸€ã¤ãšã¤å®Ÿè£…ã—ã¦ã„ãã“ã¨ã§ã€å¾ã€…ã«ã‚²ãƒ¼ãƒ ã‚’å®Œæˆã•ã›ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ç´ æ™´ã‚‰ã—ã„ã¨ã“ã‚ã¯ã€å„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã—ã€ãƒ†ã‚¹ãƒˆâ†’å®Ÿè£…â†’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚¯ãƒ«ã§å°‘ã—ãšã¤é€²ã‚ã‚‰ã‚Œã‚‹ã“ã¨ãªã‚“ã§ã™ã€‚ä¸€æ­©ä¸€æ­©ã€ç€å®Ÿã«é€²ã‚“ã§ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’æ•´ç†ã—ãŸã¨ã“ã‚ã§ã€ã€Œã“ã‚Œã‚‰ã®æ©Ÿèƒ½ãŒã©ã®ã‚ˆã†ã«é–¢é€£ã—ã¦ã„ã‚‹ã®ã‹ã€å…¨ä½“åƒãŒè¦‹ãˆã‚‹ã¨ã„ã„ãªã€ã¨æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿãã‚“ãªã¨ãã«å½¹ç«‹ã¤ã®ãŒã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã€ã§ã™ã€‚

ã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã£ã¦ä½•ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã¨å¤–éƒ¨ã‚¢ã‚¯ã‚¿ãƒ¼ï¼ˆã“ã“ã§ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚·ã‚¹ãƒ†ãƒ è‡ªä½“ï¼‰ã®ç›¸äº’ä½œç”¨ã‚’è¦–è¦šçš„ã«è¡¨ç¾ã™ã‚‹ãŸã‚ã®å›³ã§ã™ã€‚ã€Œçµµã«æã„ã¦æ•´ç†ã™ã‚‹ã¨åˆ†ã‹ã‚Šã‚„ã™ã„ã€ã¨ã„ã†ã‚„ã¤ã§ã™ã­ã€‚

> ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ãŒå¤–éƒ¨ã«æä¾›ã™ã‚‹æ©Ÿèƒ½ã¨ã€ãã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã‚¢ã‚¯ã‚¿ãƒ¼ã¨ã®é–¢ä¿‚ã‚’è¡¨ç¾ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ã®å¢ƒç•Œã¨è²¬ä»»ç¯„å›²ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚
> 
> â€” Martin Fowler ã€UMLãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã®ã‚¨ãƒƒã‚»ãƒ³ã‚¹ã€

ã€Œç™¾èã¯ä¸€è¦‹ã«ã—ã‹ãšã€ã¨ã„ã†ã‚ˆã†ã«ã€å®Ÿéš›ã«è¦‹ã¦ã¿ã‚‹ã®ãŒä¸€ç•ªåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã‚ˆã­ã€‚ã§ã¯ã€ç§ãŸã¡ã®ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```plantuml
@startuml "ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³"
left to right direction
skinparam packageStyle rectangle
skinparam linetype ortho

' ã‚¢ã‚¯ã‚¿ãƒ¼ã®å®šç¾©
actor "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" as Player
actor "ã‚·ã‚¹ãƒ†ãƒ " as System

rectangle "ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã‚·ã‚¹ãƒ†ãƒ " {
  together {
    ' ã‚²ãƒ¼ãƒ ç®¡ç†é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹" as StartNewGame
    usecase "ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ" as RestartGame
  }

  together {
    ' ã·ã‚ˆæ“ä½œé–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•" as MovePuyo
    usecase "ã·ã‚ˆã‚’å›è»¢" as RotatePuyo
    usecase "ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹" as QuickDropPuyo
  }

  together {
    ' ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã·ã‚ˆã‚’æ¶ˆå»" as ErasePuyo
    usecase "é€£é–åå¿œã‚’ç™ºç”Ÿ" as ChainReaction
    usecase "å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’ç²å¾—" as ZenkeshiBonus
    usecase "ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º" as DisplayScore
  }

  together {
    ' å…¥åŠ›é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§æ“ä½œ" as KeyboardControl
  }

  together {
    ' ã‚·ã‚¹ãƒ†ãƒ é–¢é€£ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
    usecase "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š" as GameOverCheck
    usecase "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ¼”å‡º" as GameOverAnimation
  }
}

' ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é–¢é€£
Player --> StartNewGame
Player --> RestartGame
Player --> MovePuyo
Player --> RotatePuyo
Player --> QuickDropPuyo
Player --> KeyboardControl

' ã‚·ã‚¹ãƒ†ãƒ ã®é–¢é€£
ErasePuyo <-- System
ChainReaction <-- System
ZenkeshiBonus <-- System
DisplayScore <-- System
GameOverCheck <-- System
GameOverAnimation <-- System

' åŒ…å«é–¢ä¿‚
MovePuyo ..> KeyboardControl : <<extend>>
RotatePuyo ..> KeyboardControl : <<extend>>
QuickDropPuyo ..> KeyboardControl : <<extend>>

' ãã®ä»–ã®é–¢ä¿‚
ErasePuyo ..> ChainReaction : <<include>>
ChainReaction ..> DisplayScore : <<include>>
ZenkeshiBonus ..> DisplayScore : <<include>>
GameOverCheck ..> GameOverAnimation : <<include>>

@enduml
```

ã“ã®å›³ã‚’è¦‹ã‚‹ã¨ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚·ã‚¹ãƒ†ãƒ ã®å½¹å‰²åˆ†æ‹…ãŒã‚ˆãã‚ã‹ã‚Šã¾ã™ã­ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚²ãƒ¼ãƒ ã®é–‹å§‹ã‚„æ“ä½œã‚’æ‹…å½“ã—ã€ã‚·ã‚¹ãƒ†ãƒ ã¯ã·ã‚ˆã®æ¶ˆå»åˆ¤å®šã‚„ã‚¹ã‚³ã‚¢è¨ˆç®—ãªã©ã®å†…éƒ¨å‡¦ç†ã‚’æ‹…å½“ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã¯ã€Œæ‹¡å¼µï¼ˆextendï¼‰ã€é–¢ä¿‚ã«ã‚ã‚Šã€ã·ã‚ˆã®ç§»å‹•ã‚„å›è»¢ãªã©ã®åŸºæœ¬æ“ä½œã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“åƒã‚’æŠŠæ¡ã—ã€å®Ÿè£…ã™ã¹ãæ©Ÿèƒ½ã®é–¢é€£æ€§ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã‚Œã§ã¯ã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã«é€²ã‚“ã§ã„ãã¾ã—ã‚‡ã†ï¼

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0: é–‹ç™ºç’°å¢ƒã®æº–å‚™

ã€Œã„ããªã‚Šã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã‚‹å‰ã«ã€ã¾ãšç’°å¢ƒã‚’æ•´ãˆã¾ã—ã‚‡ã†ï¼ã€å®Ÿã¯ã€ã“ã®æº–å‚™ãŒã¨ã¦ã‚‚é‡è¦ãªã‚“ã§ã™ã€‚è‰¯ã„é“å…·ã‚’æƒãˆã¦ãŠãã“ã¨ã§ã€å¾Œã®ä½œæ¥­ãŒã¨ã¦ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã‚ˆã€‚

### è‡ªå‹•åŒ–ã‹ã‚‰å§‹ã‚ã‚‹ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º

ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰1ã§ã¯ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚´ãƒ¼ãƒ«ãŒ **å‹•ä½œã™ã‚‹ãã‚Œã„ãªã‚³ãƒ¼ãƒ‰** ã§ã‚ã‚‹ã“ã¨ã‚’å­¦ã³ã¾ã—ãŸã€‚ã§ã¯ã€è‰¯ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãç¶šã‘ã‚‹ãŸã‚ã«ã¯ä½•ãŒå¿…è¦ã«ãªã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿãã‚Œã¯[ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã®ä¸‰ç¨®ã®ç¥å™¨](https://t-wada.hatenablog.jp/entry/clean-code-that-works)ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚

> ä»Šæ—¥ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã®ä¸–ç•Œã«ãŠã„ã¦çµ¶å¯¾ã«ãªã‘ã‚Œã°ãªã‚‰ãªã„3ã¤ã®æŠ€è¡“çš„ãªæŸ±ãŒã‚ã‚Šã¾ã™ã€‚
> ä¸‰æœ¬æŸ±ã¨è¨€ã£ãŸã‚Šã€ä¸‰ç¨®ã®ç¥å™¨ã¨è¨€ã£ãŸã‚Šã—ã¦ã„ã¾ã™ãŒã€ãã‚Œã‚‰ã¯
> 
>   - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
> 
>   - ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°
> 
>   - è‡ªå‹•åŒ–
> 
> ã®3ã¤ã§ã™ã€‚
> 
> â€”  https://t-wada.hatenablog.jp/entry/clean-code-that-works 

ã“ã‚Œã‹ã‚‰ã€ã“ã‚Œã‚‰3ã¤ã®ç¥å™¨ã‚’ä¸€ã¤ãšã¤æº–å‚™ã—ã¦ã„ãã¾ã™ã€‚ã€Œãªã‚“ã ã‹å¤§å¤‰ãã†...ã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä¸€åº¦æº–å‚™ã—ã¦ã—ã¾ãˆã°ã€å¾Œã¯è‡ªå‹•ã§å‹•ã„ã¦ãã‚Œã‚‹ã®ã§æ¥½ã«ãªã‚Šã¾ã™ã‚ˆï¼

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ã¾ãšã¯ã€WPFãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚ã€Œã©ã†ã‚„ã£ã¦ä½œã‚‹ã®ï¼Ÿã€ã¨ã„ã†ã¨ã€.NET CLIã‚’ä½¿ã„ã¾ã™ã€‚ã‚³ãƒãƒ³ãƒ‰ä¸€ã¤ã§ç°¡å˜ã«ä½œã‚Œã‚‹ã‚“ã§ã™ã‚ˆï¼

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd /workspaces/case-study-game-dev/app/csharp

# WPFãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
dotnet new wpf -n PuyoPuyoWPF -o PuyoPuyoWPF

# ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
dotnet new xunit -n PuyoPuyoWPF.Tests -o PuyoPuyoWPF.Tests

# ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
dotnet new sln -n PuyoPuyoWPF

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ 
dotnet sln add PuyoPuyoWPF/PuyoPuyoWPF.csproj
dotnet sln add PuyoPuyoWPF.Tests/PuyoPuyoWPF.Tests.csproj

# ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å‚ç…§ã‚’è¿½åŠ 
cd PuyoPuyoWPF.Tests
dotnet add reference ../PuyoPuyoWPF/PuyoPuyoWPF.csproj
cd ..
```

ã€ŒãŸãã•ã‚“ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚‹ãªã...ã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä¸€ã¤ãšã¤è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼š

1. `dotnet new wpf` - WPFã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™
2. `dotnet new xunit` - xUnitã®ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™
3. `dotnet new sln` - ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼ˆè¤‡æ•°ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã™ã‚‹ãŸã‚ï¼‰
4. `dotnet sln add` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ ã—ã¾ã™
5. `dotnet add reference` - ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™

ã“ã‚Œã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åŸºæœ¬æ§‹é€ ãŒã§ãã¾ã—ãŸï¼

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

#### Gitãƒªãƒã‚¸ãƒˆãƒªã®åˆæœŸåŒ–

æ¬¡ã«ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®æº–å‚™ã‚’ã—ã¾ã—ã‚‡ã†ã€‚ã€Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã£ã¦ä½•ï¼Ÿã€ã¨ã„ã†æ–¹ã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ç°¡å˜ã«è¨€ã†ã¨ã€ã€Œã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´å±¥æ­´ã‚’è¨˜éŒ²ã—ã¦ã€ã„ã¤ã§ã‚‚éå»ã®çŠ¶æ…‹ã«æˆ»ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ä»•çµ„ã¿ã€ãªã‚“ã§ã™ã€‚

```bash
# Gitãƒªãƒã‚¸ãƒˆãƒªã‚’åˆæœŸåŒ–ï¼ˆã¾ã ã®å ´åˆï¼‰
# æ—¢ã«ãƒªãƒã‚¸ãƒˆãƒªãŒã‚ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—

# .gitignoreãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > .gitignore << 'EOF'
## Ignore Visual Studio temporary files, build results, and
## files generated by popular Visual Studio add-ons.

# User-specific files
*.suo
*.user
*.userosscache
*.sln.docstates

# Build results
[Dd]ebug/
[Dd]ebugPublic/
[Rr]elease/
[Rr]eleases/
x64/
x86/
[Bb]in/
[Oo]bj/

# Visual Studio cache/options directory
.vs/

# Test results
[Tt]est[Rr]esult*/
[Bb]uild[Ll]og.*

# Coverage reports
coverage/
TestResults/

# NuGet Packages
*.nupkg
.nuget/
EOF
```

`.gitignore`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã€Œã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯Gitã§ç®¡ç†ã—ãªãã¦ã„ã„ã‚ˆã€ã¨æŒ‡å®šã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ãƒ“ãƒ«ãƒ‰çµæœã‚„ãƒ†ã‚¹ãƒˆçµæœãªã©ã€è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç®¡ç†ã™ã‚‹å¿…è¦ãŒãªã„ã§ã™ã‹ã‚‰ã­ã€‚

#### ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¦ç´„

Gitã§ã‚³ãƒ¼ãƒ‰ã‚’è¨˜éŒ²ã™ã‚‹ã¨ãã€ã€Œã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã¨ã„ã†ã‚‚ã®ã‚’æ›¸ãã¾ã™ã€‚ã€Œã©ã‚“ãªãµã†ã«æ›¸ã‘ã°ã„ã„ã®ï¼Ÿã€ã¨ã„ã†ç–‘å•ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚å®Ÿã¯ã€ã‚ã‹ã‚Šã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›¸ããŸã‚ã®è¦ç´„ãŒã‚ã‚‹ã‚“ã§ã™ã€‚

ã“ã‚Œã¾ã§ä½œæ¥­ã®åŒºåˆ‡ã‚Šã”ã¨ã«ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ã„ã¾ã—ãŸãŒã€ãã®éš›ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ›¸å¼ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›¸ã„ã¦ã„ãã¾ã™ï¼š

```bash
git commit -m 'feat: æ–°æ©Ÿèƒ½ã‚’è¿½åŠ '
git commit -m 'fix: ãƒã‚°ã‚’ä¿®æ­£'
git commit -m 'refactor: ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°'
git commit -m 'test: ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
git commit -m 'chore: ãƒ“ãƒ«ãƒ‰è¨­å®šã‚’å¤‰æ›´'
```

ã“ã®æ›¸å¼ã¯ [Angularãƒ«ãƒ¼ãƒ«](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#type)ã«å¾“ã£ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€ãã‚Œãã‚Œã®ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãƒ˜ãƒƒãƒ€ã€ãƒœãƒ‡ã‚£ã€ãƒ•ãƒƒã‚¿ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ˜ãƒƒãƒ€ã¯ã‚¿ã‚¤ãƒ—ã€ã‚¹ã‚³ãƒ¼ãƒ—ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨ã„ã†ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```
<ã‚¿ã‚¤ãƒ—>(<ã‚¹ã‚³ãƒ¼ãƒ—>): <ã‚¿ã‚¤ãƒˆãƒ«>
<ç©ºè¡Œ>
<ãƒœãƒ‡ã‚£>
<ç©ºè¡Œ>
<ãƒ•ãƒƒã‚¿>
```

ãƒ˜ãƒƒãƒ€ã¯å¿…é ˆã§ã™ã€‚ãƒ˜ãƒƒãƒ€ã®ã‚¹ã‚³ãƒ¼ãƒ—ã¯ä»»æ„ã§ã™ã€‚ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é•·ã•ã¯50æ–‡å­—ã¾ã§ã«ã—ã¦ãã ã•ã„ï¼ˆãã†ã™ã‚‹ã“ã¨ã§ãã®ä»–ã®Gitãƒ„ãƒ¼ãƒ«ã¨åŒæ§˜ã«GitHubä¸Šã§èª­ã¿ã‚„ã™ããªã‚Šã¾ã™ï¼‰ã€‚

ã‚³ãƒŸãƒƒãƒˆã®ã‚¿ã‚¤ãƒ—ã¯æ¬¡ã‚’ç”¨ã„ã¦ä¸‹ã•ã„ï¼š

- **feat**: æ–°ã—ã„æ©Ÿèƒ½ã®è¿½åŠ 
- **fix**: ãƒã‚°ä¿®æ­£
- **docs**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¤‰æ›´ã®ã¿
- **style**: ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ã‚’ä¸ãˆãªã„å¤‰æ›´ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ã‚»ãƒŸã‚³ãƒ­ãƒ³ã®æ¬ è½ãªã©ï¼‰
- **refactor**: æ©Ÿèƒ½è¿½åŠ ã§ã‚‚ãƒã‚°ä¿®æ­£ã§ã‚‚ãªã„ã‚³ãƒ¼ãƒ‰å¤‰æ›´
- **perf**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ”¹å–„ã™ã‚‹ã‚³ãƒ¼ãƒ‰å¤‰æ›´
- **test**: å­˜åœ¨ã—ãªã„ãƒ†ã‚¹ãƒˆã®è¿½åŠ ã€ã¾ãŸã¯æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆã®ä¿®æ­£
- **chore**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆã®ã‚ˆã†ãªã€è£œåŠ©ãƒ„ãƒ¼ãƒ«ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã®å¤‰æ›´

ã€Œãªã‚‹ã»ã©ã€ã“ã†ã‚„ã£ã¦æ›¸ã‘ã°ã€å¾Œã‹ã‚‰è¦‹ãŸã¨ãã«ä½•ã‚’ã—ãŸã‹ãŒã™ãã‚ã‹ã‚Šã¾ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼

ã§ã¯ã€æœ€åˆã®ã‚³ãƒŸãƒƒãƒˆã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
cd PuyoPuyoWPF
git add .
git commit -m 'chore: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸè¨­å®š'
```

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£

ã§ã¯ **è‡ªå‹•åŒ–** ã®æº–å‚™ã«å…¥ã‚ŠãŸã„ã®ã§ã™ãŒã€ãã®ãŸã‚ã«ã¯ã„ãã¤ã‹ã®å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚.NETã§ã¯ **NuGet** ãŒãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã¨ã—ã¦ã®å½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚

> NuGetã¨ã¯ã€.NETç”¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã™ã€‚é–‹ç™ºè€…ãŒä½œæˆãƒ»å…±æœ‰ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ãƒ„ãƒ¼ãƒ«ã‚’ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã¨ã—ã¦é…å¸ƒãƒ»åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**NuGet**ã‚’ä½¿ã£ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã¯ç°¡å˜ã§ã™ï¼š

```bash
# WPFãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ 
cd PuyoPuyoWPF
# MVVMãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆCommunityToolkit.Mvvmï¼‰ã‚’è¿½åŠ 
dotnet add package CommunityToolkit.Mvvm
cd ..

# ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ 
cd PuyoPuyoWPF.Tests
dotnet add package Microsoft.NET.Test.Sdk
dotnet add package xunit
dotnet add package xunit.runner.visualstudio
dotnet add package Moq  # ãƒ¢ãƒƒã‚¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
cd ..
```

ã€ŒCommunityToolkit.Mvvmã£ã¦ä½•ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ã“ã‚Œã¯Microsoftå…¬å¼ã®MVVMãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€WPFã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’å¼·åŠ›ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ãã‚Œã¾ã™ã€‚ã€ŒWPFã§MVVMã‚„ã‚‹ãªã‚‰CommunityToolkit.Mvvmã€ã¨è¦šãˆã¦ãŠãã¨ã„ã„ã§ã™ã‚ˆï¼

C#/.NETãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`.csproj`ï¼‰ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾å­˜é–¢ä¿‚ãŒè¨˜è¿°ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸéš›ã« `dotnet restore` ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚ä¾¿åˆ©ã§ã™ã‚ˆã­ï¼

å®Ÿéš›ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
cat PuyoPuyoWPF.Tests/PuyoPuyoWPF.Tests.csproj
```

```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <IsPackable>false</IsPackable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.8.0" />
    <PackageReference Include="Moq" Version="4.20.70" />
    <PackageReference Include="xunit" Version="2.6.2" />
    <PackageReference Include="xunit.runner.visualstudio" Version="2.5.4">
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\PuyoPuyoWPF\PuyoPuyoWPF.csproj" />
  </ItemGroup>

</Project>
```

ã€Œã“ã†ã‚„ã£ã¦è¦‹ã‚‹ã¨ã€ã©ã‚“ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ãŒä¸€ç›®ç­ç„¶ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼

```bash
git add .
git commit -m 'chore: ãƒ†ã‚¹ãƒˆç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¿½åŠ '
```

### é™çš„ã‚³ãƒ¼ãƒ‰è§£æ

è‰¯ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãç¶šã‘ã‚‹ãŸã‚ã«ã¯ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’ç¶­æŒã—ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º**ã«ã‚ˆã‚Šãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å‹•ã‹ã—ãªãŒã‚‰å“è³ªã‚’æ”¹å–„ã—ã¦ã„ãã¾ã™ãŒã€å‡ºæ¥ä¸ŠãŒã£ãŸã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹å“è³ªãƒã‚§ãƒƒã‚¯ã®æ–¹æ³•ã¨ã—ã¦**é™çš„ã‚³ãƒ¼ãƒ‰è§£æ**ãŒã‚ã‚Šã¾ã™ã€‚

C#/.NETç”¨ã®**é™çš„ã‚³ãƒ¼ãƒ‰è§£æ**ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦[Microsoft.CodeAnalysis.Analyzers](https://github.com/dotnet/roslyn-analyzers)ã‚’ä½¿ã£ã¦ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
# ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd PuyoPuyoWPF
dotnet add package Microsoft.CodeAnalysis.Analyzers
cd ..
```

æ¬¡ã«ã€ã‚³ãƒ¼ãƒ‰åˆ†æã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚`.editorconfig`ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å®šç¾©ã§ãã¾ã™ï¼š

```bash
# PuyoPuyoWPFãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«.editorconfigã‚’ä½œæˆ
cat > .editorconfig << 'EOF'
root = true

[*]
indent_style = space
indent_size = 4
end_of_line = crlf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.cs]
# C# coding conventions
dotnet_sort_using_directives = true
dotnet_separate_import_directive_groups = false

# Language rules
csharp_prefer_var = false:suggestion
csharp_prefer_braces = true:warning

# Code quality rules
dotnet_diagnostic.CA1502.severity = warning
# CA1502: ãƒ¡ã‚½ãƒƒãƒ‰ã®å¾ªç’°çš„è¤‡é›‘åº¦ã‚’7ä»¥ä¸‹ã«åˆ¶é™
dotnet_code_quality.CA1502.cyclomatic_complexity = 7

# Naming conventions
dotnet_naming_rule.interface_should_be_begins_with_i.severity = warning
dotnet_naming_rule.interface_should_be_begins_with_i.symbols = interface
dotnet_naming_rule.interface_should_be_begins_with_i.style = begins_with_i

dotnet_naming_rule.types_should_be_pascal_case.severity = warning
dotnet_naming_rule.types_should_be_pascal_case.symbols = types
dotnet_naming_rule.types_should_be_pascal_case.style = pascal_case

dotnet_naming_symbols.interface.applicable_kinds = interface
dotnet_naming_symbols.interface.applicable_accessibilities = public, internal, private, protected, protected_internal, private_protected

dotnet_naming_symbols.types.applicable_kinds = class, struct, interface, enum
dotnet_naming_symbols.types.applicable_accessibilities = public, internal, private, protected, protected_internal, private_protected

dotnet_naming_style.begins_with_i.required_prefix = I
dotnet_naming_style.begins_with_i.capitalization = pascal_case

dotnet_naming_style.pascal_case.capitalization = pascal_case
EOF
```

ã€Œ.editorconfigã£ã¦ä½•ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ã“ã‚Œã¯ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã®å¹…ã‚„å‘½åè¦å‰‡ãªã©ï¼‰ã‚’å®šç¾©ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ãƒãƒ¼ãƒ å…¨ä½“ã§åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å…±æœ‰ã§ãã‚‹ã®ã§ã€ã€Œã“ã®äººã®ã‚³ãƒ¼ãƒ‰ã¯èª­ã¿ã«ãã„ãª...ã€ã¨ã„ã†å•é¡ŒãŒæ¸›ã‚Šã¾ã™ã‚ˆï¼

**å¾ªç’°è¤‡é›‘åº¦ã«ã¤ã„ã¦**

ã“ã“ã§è¨­å®šã—ã¦ã„ã‚‹`cyclomatic_complexity = 7`ã«ã¤ã„ã¦å°‘ã—èª¬æ˜ã—ã¾ã—ã‚‡ã†ã€‚å¾ªç’°è¤‡é›‘åº¦ï¼ˆCyclomatic Complexityï¼‰ã¨ã¯ã€ã‚³ãƒ¼ãƒ‰ã®è¤‡é›‘ã•ã‚’æ¸¬ã‚‹æŒ‡æ¨™ã®ä¸€ã¤ã§ã™ã€‚

> å¾ªç’°è¤‡é›‘åº¦ã¨ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã®è¤‡é›‘ã•ã‚’æ¸¬ã‚‹æŒ‡æ¨™ã§ã™ã€‚ifæ–‡ã€foræ–‡ã€whileæ–‡ãªã©ã®åˆ†å²ã‚„ç¹°ã‚Šè¿”ã—ãŒå¢—ãˆã‚‹ã»ã©ã€ã“ã®å€¤ã¯å¤§ãããªã‚Šã¾ã™ã€‚å€¤ãŒé«˜ã„ã»ã©ã‚³ãƒ¼ãƒ‰ã®ç†è§£ãŒé›£ã—ãã€ãƒã‚°ãŒæ··å…¥ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚
> 
> â€” Thomas J. McCabe ã€A Complexity Measureã€

ä¸€èˆ¬çš„ãªç›®å®‰ã¨ã—ã¦ï¼š
- **1-7**: ã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„ï¼ˆæ¨å¥¨ï¼‰
- **8-10**: ã‚„ã‚„è¤‡é›‘ã€æ³¨æ„ãŒå¿…è¦
- **11ä»¥ä¸Š**: è¤‡é›‘ã™ãã‚‹ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ¨å¥¨

ã€Œãªãœ7ãªã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚ã“ã‚Œã¯ã€äººé–“ãŒä¸€åº¦ã«ç†è§£ã§ãã‚‹æƒ…å ±ã®é‡ï¼ˆãƒã‚¸ã‚«ãƒ«ãƒŠãƒ³ãƒãƒ¼7Â±2ï¼‰ã«åŸºã¥ã„ãŸçµŒé¨“å‰‡ã§ã™ã€‚ãƒ¡ã‚½ãƒƒãƒ‰ã®å¾ªç’°è¤‡é›‘åº¦ã‚’7ä»¥ä¸‹ã«ä¿ã¤ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®ç†è§£ã—ã‚„ã™ã•ã¨ãƒ†ã‚¹ãƒˆã®ã—ã‚„ã™ã•ã‚’ç¶­æŒã§ãã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰åˆ†æã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet build
```

ã€Œãƒ“ãƒ«ãƒ‰ã™ã‚‹ã ã‘ã§é™çš„ã‚³ãƒ¼ãƒ‰è§£æã‚‚ã—ã¦ãã‚Œã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚ãã—ã¦ã€ã‚‚ã—ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¤‡é›‘ã™ãã‚‹å ´åˆï¼ˆå¾ªç’°è¤‡é›‘åº¦ãŒ7ã‚’è¶…ãˆã‚‹å ´åˆï¼‰ã€è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã‚ˆï¼

```bash
git add .
git commit -m 'chore: é™çš„ã‚³ãƒ¼ãƒ‰è§£æã®è¨­å®š'
```

### Lintãƒ„ãƒ¼ãƒ«

**Lintãƒ„ãƒ¼ãƒ«**ã¯ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’ã•ã‚‰ã«é«˜ã‚ã‚‹ãŸã‚ã®é™çš„è§£æãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã€Œ.editorconfigã®è¨­å®šã ã‘ã˜ã‚ƒä¸ååˆ†ãªã®ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€Lintãƒ„ãƒ¼ãƒ«ã¯ã‚ˆã‚Šè©³ç´°ãªãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ã‚„ã€C#å›ºæœ‰ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’æ¤œè¨¼ã—ã¦ãã‚Œã¾ã™ã€‚

C#/.NETã§ã¯**StyleCop Analyzers**ãŒäººæ°—ã§ã™ã€‚StyleCopã¯ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„é•åã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œå‡ºã—ã€è­¦å‘Šã‚„ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦é€šçŸ¥ã—ã¦ãã‚Œã¾ã™ã€‚

```bash
cd PuyoPuyoWPF
dotnet add package StyleCop.Analyzers
dotnet add package Microsoft.CodeAnalysis.NetAnalyzers
cd ..
```

ã€ŒMicrosoft.CodeAnalysis.NetAnalyzersã£ã¦ä½•ã§ã™ã‹?ã€ ã“ã‚Œã¯.NETã®å…¬å¼ã‚³ãƒ¼ãƒ‰ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã§ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æ‡¸å¿µã€APIä½¿ç”¨æ–¹æ³•ã®èª¤ã‚Šãªã©ã‚’æ¤œå‡ºã—ã¦ãã‚Œã¾ã™ã€‚StyleCopã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€åŒ…æ‹¬çš„ãªã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

æ¬¡ã«ã€StyleCopã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«`stylecop.json`ã‚’ä½œæˆã—ã¾ã™ï¼š

```bash
cat > PuyoPuyoWPF/stylecop.json << 'EOF'
{
  "$schema": "https://raw.githubusercontent.com/DotNetAnalyzers/StyleCopAnalyzers/master/StyleCop.Analyzers/StyleCop.Analyzers/Settings/stylecop.schema.json",
  "settings": {
    "documentationRules": {
      "companyName": "PuyoPuyo",
      "copyrightText": "Copyright (c) {companyName}. All rights reserved.",
      "xmlHeader": false,
      "fileNamingConvention": "stylecop"
    },
    "namingRules": {
      "allowCommonHungarianPrefixes": false,
      "allowedHungarianPrefixes": []
    },
    "orderingRules": {
      "systemUsingDirectivesFirst": true,
      "usingDirectivesPlacement": "outsideNamespace",
      "blankLinesBetweenUsingGroups": "require"
    },
    "layoutRules": {
      "newlineAtEndOfFile": "require"
    },
    "maintainabilityRules": {
      "topLevelTypes": []
    }
  }
}
EOF
```

ã€Œã“ã‚Œã¯ä½•ã‚’è¨­å®šã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼š

- **documentationRules**: XMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ¡ãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒ«
  - `companyName`: ä¼šç¤¾åã‚’è¨­å®šï¼ˆè‘—ä½œæ¨©è¡¨ç¤ºã§ä½¿ç”¨ï¼‰
  - `xmlHeader`: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®XMLã‚³ãƒ¡ãƒ³ãƒˆã‚’è¦æ±‚ã™ã‚‹ã‹ã©ã†ã‹
- **namingRules**: å‘½åè¦å‰‡
  - `allowCommonHungarianPrefixes`: ãƒãƒ³ã‚¬ãƒªã‚¢ãƒ³è¨˜æ³•ã‚’è¨±å¯ã™ã‚‹ã‹
- **orderingRules**: usingæ–‡ã®é †åºã«é–¢ã™ã‚‹ãƒ«ãƒ¼ãƒ«
  - `systemUsingDirectivesFirst`: System.*ã®usingæ–‡ã‚’æœ€åˆã«é…ç½®
  - `usingDirectivesPlacement`: usingæ–‡ã‚’namespaceã®å¤–å´ã«é…ç½®
- **layoutRules**: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ãƒ«ãƒ¼ãƒ«
  - `newlineAtEndOfFile`: ãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ã«æ”¹è¡Œã‚’è¦æ±‚

ã•ã‚‰ã«ã€`.editorconfig`ã«ã‚‚StyleCopå›ºæœ‰ã®ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat >> .editorconfig << 'EOF'

# StyleCop Analyzers ã®è¨­å®š

# SA1600: è¦ç´ ã«XMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ¡ãƒ³ãƒˆãŒå¿…è¦
dotnet_diagnostic.SA1600.severity = none

# SA1633: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ãŒå¿…è¦
dotnet_diagnostic.SA1633.severity = none

# SA1101: ä¿®é£¾åã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
dotnet_diagnostic.SA1101.severity = none

# SA1309: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¯ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã§å§‹ã‚ã¦ã¯ã„ã‘ãªã„
dotnet_diagnostic.SA1309.severity = none

# SA1200: Using ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯åå‰ç©ºé–“å†…ã«é…ç½®ã™ã‚‹
dotnet_diagnostic.SA1200.severity = none

# SA1413: æœ«å°¾ã®ã‚³ãƒ³ãƒã‚’ä½¿ç”¨ã™ã‚‹
dotnet_diagnostic.SA1413.severity = suggestion

# SA1028: ã‚³ãƒ¼ãƒ‰ã®æœ«å°¾ã«ç©ºç™½ã‚’å«ã‚ãªã„
dotnet_diagnostic.SA1028.severity = warning
EOF
```

ã€Œã“ã‚Œã‚‰ã®ãƒ«ãƒ¼ãƒ«ã¯ä½•ã‚’æ„å‘³ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€é †ç•ªã«èª¬æ˜ã—ã¾ã—ã‚‡ã†ï¼š

- **SA1600 (none)**: ã™ã¹ã¦ã®è¦ç´ ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ¡ãƒ³ãƒˆã‚’è¦æ±‚ã—ãªã„ï¼ˆå­¦ç¿’ç”¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãŸã‚ç·©å’Œï¼‰
- **SA1633 (none)**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¦æ±‚ã—ãªã„
- **SA1101 (none)**: `this.`ä¿®é£¾å­ã‚’å¼·åˆ¶ã—ãªã„ï¼ˆãƒ¢ãƒ€ãƒ³ãªC#ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
- **SA1309 (none)**: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«`_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è¨±å¯ï¼ˆãƒ¢ãƒ€ãƒ³ãªC#ã®æ…£ç¿’ï¼‰
- **SA1200 (none)**: usingæ–‡ã‚’namespaceã®å¤–å´ã«é…ç½®ã™ã‚‹ã“ã¨ã‚’è¨±å¯ï¼ˆ.NET 6+ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
- **SA1413 (suggestion)**: é…åˆ—ã‚„ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®æœ«å°¾ã«ã‚«ãƒ³ãƒã‚’ä½¿ã†ã“ã¨ã‚’æ¨å¥¨
- **SA1028 (warning)**: è¡Œæœ«ã®ç©ºç™½ã‚’è­¦å‘Š

ã“ã‚Œã‚‰ã®è¨­å®šã«ã‚ˆã‚Šã€ãƒ¢ãƒ€ãƒ³ãªC#ã®è¨˜è¿°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒã—ã¤ã¤ã€é‡è¦ãªã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ã¯æœ‰åŠ¹ã«ã—ã¦ã„ã¾ã™ã€‚

Lintãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
# ãƒ“ãƒ«ãƒ‰æ™‚ã«Lintãƒã‚§ãƒƒã‚¯ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™
dotnet build

# è­¦å‘Šã‚’ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã†å ´åˆ
dotnet build /p:TreatWarningsAsErrors=true
```

ã€Œè­¦å‘Šã‚’ã‚¨ãƒ©ãƒ¼ã«ã™ã‚‹ã¨ã©ã†ãªã‚‹ã®ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼é€šå¸¸ã€è­¦å‘ŠãŒã‚ã£ã¦ã‚‚ãƒ“ãƒ«ãƒ‰ã¯æˆåŠŸã—ã¾ã™ãŒã€`TreatWarningsAsErrors=true`ã‚’æŒ‡å®šã™ã‚‹ã¨ã€è­¦å‘ŠãŒã‚ã‚‹ã¨ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒãƒ¼ãƒ å…¨ä½“ã§ã‚³ãƒ¼ãƒ‰å“è³ªåŸºæº–ã‚’å³æ ¼ã«å®ˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚CI/CDç’°å¢ƒã§ç‰¹ã«æœ‰åŠ¹ã§ã™ã‚ˆï¼

```bash
git add .
git commit -m 'chore: Lintãƒ„ãƒ¼ãƒ«ã®è¨­å®š'
```

### ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿

**ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿**ã¯é–‹ç™ºãƒãƒ¼ãƒ å†…ã§ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’çµ±ä¸€ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚C#/.NETã§ã¯`dotnet format`ã‚³ãƒãƒ³ãƒ‰ãŒæ¨™æº–ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚ã€Œã‚ã–ã‚ã–ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãªãã¦ã„ã„ã‚“ã§ã™ã‹ï¼Ÿã€ã¯ã„ã€æœ€åˆã‹ã‚‰ä½¿ãˆã‚‹ã‚“ã§ã™ï¼

ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet format
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ã™ã¹ã¦ã®C#ãƒ•ã‚¡ã‚¤ãƒ«ãŒ`.editorconfig`ã§å®šç¾©ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¾ã™ã€‚ã€Œè‡ªå‹•ã§æ•´å½¢ã—ã¦ãã‚Œã‚‹ãªã‚“ã¦æ¥½ã¡ã‚“ã§ã™ã­ï¼ã€

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ç¢ºèªã®ã¿ã‚’è¡Œã„ãŸã„å ´åˆã¯ï¼š

```bash
dotnet format --verify-no-changes
```

ã€Œã“ã‚Œã£ã¦ä½•ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ã‚³ãƒ¼ãƒ‰ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã ã‘ã—ã¦ã€å®Ÿéš›ã«ã¯å¤‰æ›´ã—ã¾ã›ã‚“ã€‚CI/CDç’°å¢ƒã§ä½¿ã†ã¨ä¾¿åˆ©ã§ã™ã‚ˆï¼

```bash
git add .
git commit -m 'chore: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã®è¨­å®š'
```

### ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸

**ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**ã¯ãƒ†ã‚¹ãƒˆãŒãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ã©ã®ãã‚‰ã„ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã‹ã‚’æ¸¬ã‚‹æŒ‡æ¨™ã§ã™ã€‚ã€Œãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ãŸã¤ã‚‚ã‚Šã ã‘ã©ã€å®Ÿã¯é‡è¦ãªéƒ¨åˆ†ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ãªã‹ã£ãŸ...ã€ãã‚“ãªã“ã¨ã‚’é˜²ããŸã‚ã«å½¹ç«‹ã¡ã¾ã™ã€‚

C#/.NETã§ã¯`coverlet`ãŒã‚ˆãä½¿ã‚ã‚Œã¾ã™ï¼š

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd PuyoPuyoWPF.Tests
dotnet add package coverlet.collector
dotnet add package coverlet.msbuild
cd ..

# ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
dotnet tool install -g dotnet-reportgenerator-globaltool
```

ã€Œdotnet toolã£ã¦ä½•ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼dotnet toolã¯ã€.NET CLIç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ„ãƒ¼ãƒ«ã‚’ç®¡ç†ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚ä¸€åº¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚Œã°ã€ã©ã“ã‹ã‚‰ã§ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã‚ˆã€‚

ãƒ†ã‚¹ãƒˆã‚’ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’åé›†ã—ãªãŒã‚‰ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
dotnet test --collect:"XPlat Code Coverage" --results-directory ./TestResults

# HTMLå½¢å¼ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
reportgenerator -reports:"./TestResults/**/coverage.cobertura.xml" -targetdir:"coverage" -reporttypes:Html
```

ã€Œç”Ÿæˆã•ã‚ŒãŸ`coverage/index.html`ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèªã§ãã¾ã™ï¼ã€ã‚«ãƒ©ãƒ•ãƒ«ãªãƒ¬ãƒãƒ¼ãƒˆã§ã©ã“ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ä¸€ç›®ç­ç„¶ã§ã™ã‚ˆã€‚

ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ã§ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š

```bash
# PuyoPuyoWPFãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«coverage.shã‚’ä½œæˆ
cat > coverage.sh << 'EOF'
#!/bin/bash
# coverage.sh - ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

echo "ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨ã‚«ãƒãƒ¬ãƒƒã‚¸åé›†ä¸­..."
dotnet test --collect:"XPlat Code Coverage" --results-directory ./TestResults

echo "ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­..."
reportgenerator -reports:"./TestResults/**/coverage.cobertura.xml" -targetdir:"coverage" -reporttypes:Html

echo "âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒ coverage/index.html ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸ"
echo ""
echo "ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:"
echo "  \$BROWSER coverage/index.html"
EOF

chmod +x coverage.sh
```

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
./coverage.sh
```

ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒ–ã™ã‚‹ã¨ã€æ¯å›é•·ã„ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ãŸãªãã¦æ¸ˆã‚€ã‹ã‚‰ä¾¿åˆ©ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼

```bash
git add .
git commit -m 'chore: ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¨­å®š'
```

### ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼

è‰¯ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãç¶šã‘ã‚‹ãŸã‚ã«ä»Šã¾ã§è‰²ã€…ãªãƒ„ãƒ¼ãƒ«ã‚’å°å…¥ã—ã¦ãã¾ã—ãŸãŒã€æ¯å›å€‹åˆ¥ã«å®Ÿè¡Œã™ã‚‹ã®ã¯é¢å€’ã§ã™ã€‚ã€Œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ã€ãƒ“ãƒ«ãƒ‰ã—ã¦ã€ãƒ†ã‚¹ãƒˆã—ã¦ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚‚ç¢ºèªã—ã¦...ã€ã†ã‚“ã–ã‚Šã—ã¡ã‚ƒã„ã¾ã™ã‚ˆã­ï¼Ÿ

ãã“ã§**ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼**ã®å‡ºç•ªã§ã™ï¼C#/.NETãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€**Cake**ã¨ã„ã†å¼·åŠ›ãªãƒ“ãƒ«ãƒ‰è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

> Cakeã¨ã¯ã€C#ã‚’DSLï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ç‰¹åŒ–è¨€èªï¼‰ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ“ãƒ«ãƒ‰ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Makeã€Rakeã€PSakeã¨åŒæ§˜ã®æ¦‚å¿µã§ã™ãŒã€C#ã®æ§‹æ–‡ã‚’æ´»ç”¨ã§ãã‚‹ãŸã‚ã€.NETé–‹ç™ºè€…ã«ã¨ã£ã¦è¦ªã—ã¿ã‚„ã™ã„ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ã¾ãšã€Cakeã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ï¼š

```bash
# Cakeãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
dotnet tool install -g Cake.Tool
```

æ¬¡ã«ã€`build.cake`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ã‚ˆãä½¿ã†ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat > build.cake << 'EOF'
///////////////////////////////////////////////////////////////////////////////
// ARGUMENTS
///////////////////////////////////////////////////////////////////////////////

var target = Argument("target", "Default");
var configuration = Argument("configuration", "Release");

///////////////////////////////////////////////////////////////////////////////
// SETUP / TEARDOWN
///////////////////////////////////////////////////////////////////////////////

Setup(ctx =>
{
   Information("Running tasks...");
   Information("Target: {0}", target);
});

Teardown(ctx =>
{
   Information("Finished running tasks.");
});

///////////////////////////////////////////////////////////////////////////////
// TASKS
///////////////////////////////////////////////////////////////////////////////

Task("Clean")
    .Description("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—")
    .Does(() =>
{
    Information("ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œä¸­...");
    DotNetClean("./PuyoPuyoWPF.sln");
    CleanDirectory("./coverage");
    CleanDirectory("./TestResults");
});

Task("Restore")
    .Description("NuGetãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å¾©å…ƒ")
    .IsDependentOn("Clean")
    .Does(() =>
{
    Information("ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¾©å…ƒä¸­...");
    DotNetRestore("./PuyoPuyoWPF.sln");
});

Task("Format")
    .Description("ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å®Ÿè¡Œ")
    .Does(() =>
{
    Information("ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸­...");
    DotNetFormat("./PuyoPuyoWPF.sln");
});

Task("Build")
    .Description("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰")
    .IsDependentOn("Restore")
    .Does(() =>
{
    Information("ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œä¸­...");
    DotNetBuild("./PuyoPuyoWPF.sln", new DotNetBuildSettings
    {
        Configuration = configuration,
        NoRestore = true
    });
});

Task("Lint")
    .Description("ã‚³ãƒ¼ãƒ‰ã®Lintãƒã‚§ãƒƒã‚¯")
    .IsDependentOn("Build")
    .Does(() =>
{
    Information("Lintãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­...");
    
    // è­¦å‘Šã‚’ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã£ã¦ãƒ“ãƒ«ãƒ‰
    var lintSettings = new DotNetBuildSettings
    {
        Configuration = configuration,
        NoRestore = true,
        MSBuildSettings = new DotNetMSBuildSettings()
    };
    lintSettings.MSBuildSettings.TreatAllWarningsAs = MSBuildTreatAllWarningsAs.Error;
    
    try
    {
        DotNetBuild("./PuyoPuyoWPF.sln", lintSettings);
        Information("âœ… Lintãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã—ã¾ã—ãŸ");
    }
    catch
    {
        Warning("âš ï¸ Lintãƒã‚§ãƒƒã‚¯ã§è­¦å‘Šã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ");
        throw;
    }
});

Task("Test")
    .Description("ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ")
    .IsDependentOn("Build")
    .Does(() =>
{
    Information("ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...");
    DotNetTest("./PuyoPuyoWPF.Tests/PuyoPuyoWPF.Tests.csproj", new DotNetTestSettings
    {
        Configuration = configuration,
        NoBuild = true,
        NoRestore = true
    });
});

Task("Coverage")
    .Description("ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¸¬å®š")
    .IsDependentOn("Build")
    .Does(() =>
{
    Information("ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šä¸­...");
    
    // ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    DotNetTest("./PuyoPuyoWPF.Tests/PuyoPuyoWPF.Tests.csproj", new DotNetTestSettings
    {
        Configuration = configuration,
        NoBuild = true,
        NoRestore = true,
        ArgumentCustomization = args => args
            .Append("--collect:\"XPlat Code Coverage\"")
            .Append("--results-directory ./TestResults")
    });
    
    // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    Information("ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...");
    StartProcess("reportgenerator", new ProcessSettings
    {
        Arguments = new ProcessArgumentBuilder()
            .Append("-reports:./TestResults/**/coverage.cobertura.xml")
            .Append("-targetdir:./coverage")
            .Append("-reporttypes:Html")
    });
    
    Information("âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒ coverage/index.html ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸ");
});

Task("Quality")
    .Description("ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ")
    .IsDependentOn("Format")
    .IsDependentOn("Lint")
    .IsDependentOn("Build")
    .IsDependentOn("Test")
    .IsDependentOn("Coverage")
    .Does(() =>
{
    Information("âœ… ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
});

Task("Watch")
    .Description("ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã¨è‡ªå‹•ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆ")
    .Does(() =>
{
    Information("ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã‚’é–‹å§‹ã—ã¾ã™...");
    Information("çµ‚äº†ã™ã‚‹ã«ã¯ Ctrl+C ã‚’æŠ¼ã—ã¦ãã ã•ã„");
    
    var settings = new DotNetWatchSettings
    {
        Project = "./PuyoPuyoWPF.Tests/PuyoPuyoWPF.Tests.csproj"
    };
    
    DotNetWatch("test", settings);
});

Task("Default")
    .Description("ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¹ã‚¯ï¼ˆQualityï¼‰")
    .IsDependentOn("Quality");

///////////////////////////////////////////////////////////////////////////////
// EXECUTION
///////////////////////////////////////////////////////////////////////////////

RunTarget(target);
EOF
```

ã€Œã“ã®Cakeãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½•ã‚’ã—ã¦ãã‚Œã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼ã“ã®Cakeãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã€ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ï¼š

- **Clean**: ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã¨ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **Restore**: NuGetãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¾©å…ƒ
- **Format**: ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- **Build**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰
- **Lint**: ã‚³ãƒ¼ãƒ‰ã®Lintãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã‚’ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã†ï¼‰
- **Test**: ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
- **Coverage**: ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã—ã¦ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- **Quality**: ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- **Watch**: ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã¨è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¹ã‚¯ï¼ˆQualityï¼‰ã‚’å®Ÿè¡Œ
dotnet cake

# ç‰¹å®šã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
dotnet cake --target=Clean
dotnet cake --target=Format
dotnet cake --target=Build
dotnet cake --target=Lint
dotnet cake --target=Test
dotnet cake --target=Coverage

# ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
dotnet cake --target=Quality
```

ã€ŒCakeã‚’ä½¿ã†ã¨ã€C#ã®æ§‹æ–‡ã§ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ›¸ã‘ã‚‹ã®ã§ã€.NETé–‹ç™ºè€…ã«ã¨ã£ã¦ã¨ã¦ã‚‚è‡ªç„¶ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼

Cakeã®è‰¯ã„ã¨ã“ã‚ã¯ï¼š

1. **C#ã§æ›¸ã‘ã‚‹**: .NETé–‹ç™ºè€…ã«ã¨ã£ã¦è¦ªã—ã¿ã‚„ã™ã„
2. **ä¾å­˜é–¢ä¿‚ç®¡ç†**: ã‚¿ã‚¹ã‚¯é–“ã®ä¾å­˜é–¢ä¿‚ã‚’è‡ªå‹•ã§è§£æ±º
3. **ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Windowsã€Linuxã€macOSã§å‹•ä½œ
4. **è±Šå¯Œãªã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ **: å¤šãã®ã‚¢ãƒ‰ã‚¤ãƒ³ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼ãŒåˆ©ç”¨å¯èƒ½

```bash
git add .
git commit -m 'chore: Cakeã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã®è¨­å®š'
```

### ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•åŒ–

**Cake**ã«ã‚ˆã‚Šå“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚¿ã‚¹ã‚¯ã¯ç”¨æ„ã•ã‚Œã¾ã—ãŸãŒã€ã¾ã æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãŸã³ã«è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãŒèµ°ã£ãŸã‚‰ä¾¿åˆ©ãªã®ã«ãª...ã€ã¨æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿ

å®Ÿã¯ã€Cakeã«ã¯**Watch**ã‚¿ã‚¹ã‚¯ã‚’ä½¿ã£ã¦è‡ªå‹•å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ãŒæ—¢ã«å«ã¾ã‚Œã¦ã„ã¾ã™ï¼

#### Cakeã®çµ„ã¿è¾¼ã¿Watchã‚¿ã‚¹ã‚¯ã‚’ä½¿ç”¨

æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹æ³•ã¯ã€`build.cake`ã§å®šç¾©ã—ãŸ`Watch`ã‚¿ã‚¹ã‚¯ã‚’ä½¿ã†ã“ã¨ã§ã™ï¼š

```bash
# Cakeã®watchã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
dotnet cake --target=Watch
```

ã€Œã“ã‚Œã ã‘ã§è‡ªå‹•ãƒ†ã‚¹ãƒˆãŒå‹•ãã‚“ã§ã™ã­ï¼ã€ãã†ãªã‚“ã§ã™ã€‚.NET CLIã®`dotnet watch`ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã‚ˆã€‚

åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦ã€ä½•ã‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚å¤‰æ›´ãŒæ¤œå‡ºã•ã‚Œã¦è‡ªå‹•çš„ã«ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã¯ãšã§ã™ã€‚

ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒç¢ºèªã§ããŸã‚‰ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚ã“ã®ã¨ãã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã¯`Watch`ãŒå‹•ã„ã¦ã„ã‚‹ã®ã§ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦ã‚³ãƒŸãƒƒãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

```bash
git add .
git commit -m 'chore: ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•åŒ–'
```

### å‹•ä½œç¢ºèª

ã•ã¦ã€ã“ã“ã¾ã§ã§ç’°å¢ƒæ§‹ç¯‰ã¯å®Œäº†ã§ã™ï¼ã€Œæœ¬å½“ã«å‹•ãã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã€ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€ã™ã¹ã¦ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ï¼š

```bash
# ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
cat > PuyoPuyoWPF.Tests/SampleTest.cs << 'EOF'
using Xunit;

namespace PuyoPuyoWPF.Tests;

public class SampleTest
{
    [Fact]
    public void åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆãŒå‹•ä½œã™ã‚‹()
    {
        // Arrangeï¼ˆæº–å‚™ï¼‰
        int a = 1;
        int b = 2;

        // Actï¼ˆå®Ÿè¡Œï¼‰
        int result = a + b;

        // Assertï¼ˆæ¤œè¨¼ï¼‰
        Assert.Equal(3, result);
    }

    [Theory]
    [InlineData(1, 2, 3)]
    [InlineData(0, 0, 0)]
    [InlineData(-1, 1, 0)]
    public void è¤‡æ•°ã®ã‚±ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹(int a, int b, int expected)
    {
        // Act
        int result = a + b;

        // Assert
        Assert.Equal(expected, result);
    }
}
EOF
```

ã€Œã“ã®ãƒ†ã‚¹ãƒˆã¯ä½•ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼ã“ã‚Œã¯å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆã§ã¯ãªãã€ç’°å¢ƒãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚ã€Œ1+2=3ã€ã¨ã„ã†ç°¡å˜ãªè¨ˆç®—ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
# ã¾ãŸã¯ã€Cakeã‚’ä½¿ã£ã¦
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼ã§ã¯ã€ã‚ã–ã¨å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
cat >> PuyoPuyoWPF.Tests/SampleTest.cs << 'EOF'

    [Fact]
    public void ã‚ã–ã¨å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆ()
    {
        // ã‚ã–ã¨é–“é•ã£ãŸæœŸå¾…å€¤ã‚’è¨­å®š
        Assert.Equal(5, 1 + 2);
    }
}
EOF
```

ã‚‚ã†ä¸€åº¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
# ã¾ãŸã¯ã€Cakeã‚’ä½¿ã£ã¦
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã­ï¼ã€ãã†ã§ã™ã€‚ã“ã‚Œã¯æœŸå¾…é€šã‚Šã®å‹•ä½œã§ã™ã€‚ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚‚æ­£ã—ãæ¤œå‡ºã§ãã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

ã§ã¯ã€å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å‰Šé™¤ã—ã¦ã€ã‚‚ã†ä¸€åº¦ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```bash
# å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å‰Šé™¤ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«æˆ»ã™ï¼‰
cat > PuyoPuyoWPF.Tests/SampleTest.cs << 'EOF'
using Xunit;

namespace PuyoPuyoWPF.Tests;

public class SampleTest
{
    [Fact]
    public void åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆãŒå‹•ä½œã™ã‚‹()
    {
        // Arrangeï¼ˆæº–å‚™ï¼‰
        int a = 1;
        int b = 2;

        // Actï¼ˆå®Ÿè¡Œï¼‰
        int result = a + b;

        // Assertï¼ˆæ¤œè¨¼ï¼‰
        Assert.Equal(3, result);
    }

    [Theory]
    [InlineData(1, 2, 3)]
    [InlineData(0, 0, 0)]
    [InlineData(-1, 1, 0)]
    public void è¤‡æ•°ã®ã‚±ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹(int a, int b, int expected)
    {
        // Act
        int result = a + b;

        // Assert
        Assert.Equal(expected, result);
    }
}
EOF

dotnet test
# ã¾ãŸã¯ã€Cakeã‚’ä½¿ã£ã¦
dotnet cake --target=Test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€å®Œç’§ã§ã™ï¼

æœ€å¾Œã«ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚‚ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
# Cakeã‚’ä½¿ã£ã¦ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®š
dotnet cake --target=Coverage
```

ã€Œcoverage/index.htmlãŒã§ãã¾ã—ãŸã­ï¼ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
$BROWSER coverage/index.html
```

ã€Œã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã‚Œã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼ã“ã‚Œã§ã€ã©ã®ã‚³ãƒ¼ãƒ‰ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹è¦–è¦šçš„ã«ç¢ºèªã§ãã¾ã™ã­ã€‚

Cakeã®ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’ä¸€åº¦ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

```bash
# ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
dotnet cake --target=Quality
# ã¾ãŸã¯
dotnet cake  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§Qualityã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹
```

ã€ŒFormatâ†’Buildâ†’Testâ†’CoverageãŒé †ç•ªã«å®Ÿè¡Œã•ã‚Œã¾ã—ãŸã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚Cakeã®ã‚¿ã‚¹ã‚¯ä¾å­˜é–¢ä¿‚ãŒè‡ªå‹•çš„ã«è§£æ±ºã•ã‚Œã¦ã€å¿…è¦ãªã‚¿ã‚¹ã‚¯ãŒé †ç•ªã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã™ã¹ã¦ã®ç¢ºèªãŒçµ‚ã‚ã£ãŸã‚‰ã€ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'test: ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆã®è¿½åŠ '
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³0ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã“ã¾ã§ã§ã€ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼š

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ**: WPFãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
2. **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Gitãƒªãƒã‚¸ãƒˆãƒªã®åˆæœŸåŒ–ã¨ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¦ç´„
3. **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†**: NuGetã‚’ä½¿ã£ãŸä¾å­˜é–¢ä¿‚ã®ç®¡ç†ï¼ˆCommunityToolkit.Mvvmã€Moqãªã©ï¼‰
4. **é™çš„ã‚³ãƒ¼ãƒ‰è§£æ**: Microsoft.CodeAnalysis.Analyzersã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰å“è³ªã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯
5. **ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿**: dotnet formatã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã®çµ±ä¸€
6. **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: Coverlet + ReportGeneratorã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¸¬å®šã¨å¯è¦–åŒ–
7. **ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼**: Cakeã«ã‚ˆã‚‹C#ãƒ™ãƒ¼ã‚¹ã®ãƒ“ãƒ«ãƒ‰è‡ªå‹•åŒ–
8. **ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•åŒ–**: dotnet watchã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã¨è‡ªå‹•å®Ÿè¡Œ

ã“ã‚Œã§[ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã®ä¸‰ç¨®ã®ç¥å™¨](https://t-wada.hatenablog.jp/entry/clean-code-that-works)ãŒæƒã„ã¾ã—ãŸï¼š

- âœ… **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Git + Angularãƒ«ãƒ¼ãƒ«ã®ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- âœ… **ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: xUnit + Moq + Coverlet
- âœ… **è‡ªå‹•åŒ–**: Cake + dotnet watch

**Cakeã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ**:
- C#ã§æ›¸ã‘ã‚‹ã®ã§.NETé–‹ç™ºè€…ã«ã¨ã£ã¦è‡ªç„¶
- ã‚¿ã‚¹ã‚¯ã®ä¾å­˜é–¢ä¿‚ã‚’å®£è¨€çš„ã«å®šç¾©ã§ãã‚‹
- ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å‹•ä½œ
- è±Šå¯Œãªã‚¢ãƒ‰ã‚¤ãƒ³ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼æ©Ÿèƒ½
- IDEçµ±åˆã¨ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒ¼ãƒˆ

ã€Œã“ã‚Œã§ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã‚’å§‹ã‚ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã¯ã€å®Ÿéš›ã«ã·ã‚ˆã·ã‚ˆã‚²ãƒ¼ãƒ ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã‚ˆã€‚

é–‹ç™ºã‚’å§‹ã‚ã‚‹ã¨ãã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãŠã‘ã°ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãŸã³ã«è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ãƒªã‚ºãƒ ï¼ˆRed-Green-Refactorï¼‰ã«é›†ä¸­ã§ãã¾ã™ã­ï¼

```bash
# Cakeã®çµ„ã¿è¾¼ã¿Watchã‚’ä½¿ã†
dotnet cake --target=Watch

# åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†
# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãŸã³ã«è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼
```

**ã‚ˆãä½¿ã†Cakeã‚³ãƒãƒ³ãƒ‰**:
```bash
dotnet cake                      # ã™ã¹ã¦ã®å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
dotnet cake --target=Clean       # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
dotnet cake --target=Format      # ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
dotnet cake --target=Build       # ãƒ“ãƒ«ãƒ‰
dotnet cake --target=Test        # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
dotnet cake --target=Coverage    # ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
dotnet cake --target=Watch       # è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```

ãã‚Œã§ã¯ã€æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1ã§å®Ÿéš›ã®ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ã®å®Ÿè£…ã«å–ã‚Šçµ„ã‚“ã§ã„ãã¾ã—ã‚‡ã†ï¼

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1: ã‚²ãƒ¼ãƒ é–‹å§‹ã®å®Ÿè£…

ã•ã‚ã€ã„ã‚ˆã„ã‚ˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã¾ã—ã‚‡ã†ï¼ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€å°ã•ãªã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåå¾©ï¼‰ã§æ©Ÿèƒ½ã‚’å°‘ã—ãšã¤è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚æœ€åˆã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€æœ€ã‚‚åŸºæœ¬çš„ãªæ©Ÿèƒ½ã§ã‚ã‚‹ã€Œã‚²ãƒ¼ãƒ ã®é–‹å§‹ã€ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

> ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¨ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’å°ã•ãªæ©Ÿèƒ½å˜ä½ã§ç¹°ã‚Šè¿”ã—é–‹ç™ºã—ã¦ã„ãæ‰‹æ³•ã§ã™ã€‚å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§è¨ˆç”»ã€è¨­è¨ˆã€å®Ÿè£…ã€ãƒ†ã‚¹ãƒˆã€è©•ä¾¡ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å›ã™ã“ã¨ã§ã€ãƒªã‚¹ã‚¯ã‚’æ—©æœŸã«ç™ºè¦‹ã—ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å¾—ãªãŒã‚‰é–‹ç™ºã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
> 
> â€” Craig Larman ã€ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™ºã¨ã‚¹ã‚¯ãƒ©ãƒ ã€

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹

ã“ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã§ã€ã‚²ãƒ¼ãƒ ã®åŸºæœ¬çš„ãªæ§‹é€ ã‚’ä½œã‚Šã€å¾Œç¶šã®æ©Ÿèƒ½è¿½åŠ ã®åœŸå°ã‚’ç¯‰ãã“ã¨ãŒã§ãã¾ã™ã€‚ã§ã¯ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ã‚µã‚¤ã‚¯ãƒ«ã«å¾“ã£ã¦ã€ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### TODOãƒªã‚¹ãƒˆ

ã•ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã€ã¾ãšã¯TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚TODOãƒªã‚¹ãƒˆã¯ã€å¤§ããªæ©Ÿèƒ½ã‚’å°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®é‡è¦ãªãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®ä¸€ã¤ã§ã™ã€‚å®Ÿè£…å‰ã«å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºã®æ–¹å‘æ€§ã‚’ä¿ã¡ã€ä½•ã‚‚è¦‹è½ã¨ã•ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ç§ãŸã¡ã®ã€Œæ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã‚‹ã€ã¨ã„ã†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ã©ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ã§ã—ã‚‡ã†ã‹ï¼Ÿè€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚„å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹ï¼‰
- ViewModelã‚’ä½œæˆã™ã‚‹ï¼ˆWPFã®MVVMãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã£ã¦ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‚’å®Ÿè£…ã™ã‚‹ï¼‰
- æ–°ã—ã„ã·ã‚ˆã‚’ç”Ÿæˆã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã«æœ€åˆã®ã·ã‚ˆã‚’ä½œæˆã™ã‚‹ï¼‰
- ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹ã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã®ç¶™ç¶šçš„ãªæ›´æ–°ã¨æç”»ã‚’è¡Œã†ï¼‰

ã“ã‚Œã‚‰ã®ã‚¿ã‚¹ã‚¯ã‚’ä¸€ã¤ãšã¤å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€å„ã‚¿ã‚¹ã‚¯ã«å¯¾ã—ã¦ãƒ†ã‚¹ãƒˆâ†’å®Ÿè£…â†’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å›ã—ã¾ã™ã€‚ã¾ãšã¯ã€Œã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã€ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼

### ãƒ†ã‚¹ãƒˆ: ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–

ã•ã¦ã€TODOãƒªã‚¹ãƒˆã®æœ€åˆã®ã‚¿ã‚¹ã‚¯ã€Œã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€ã«å–ã‚Šæ›ã‹ã‚Šã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€ã¾ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚

> ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
> 
> ã„ã¤ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¹ãã ã‚ã†ã‹â€”â€”ãã‚Œã¯ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã§ã¯ã€ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã¹ãã§ã—ã‚‡ã†ã‹ï¼Ÿã‚²ãƒ¼ãƒ ãŒåˆæœŸåŒ–ã•ã‚ŒãŸã¨ãã€å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãä½œæˆã•ã‚Œã€ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã­ã€‚

```bash
mkdir -p PuyoPuyoWPF.Tests/Models
cat > PuyoPuyoWPF.Tests/Models/GameTest.cs << 'EOF'
using Xunit;
using PuyoPuyoWPF.Models;

namespace PuyoPuyoWPF.Tests.Models;

public class GameTest
{
    [Fact]
    public void ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã™ã‚‹ã¨å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½œæˆã•ã‚Œã‚‹()
    {
        // Arrange & Act
        var game = new Game();
        game.Initialize();

        // Assert
        Assert.NotNull(game.Config);
        Assert.NotNull(game.Stage);
        Assert.NotNull(game.Player);
        Assert.NotNull(game.Score);
    }

    [Fact]
    public void ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ãŒStartã«ãªã‚‹()
    {
        // Arrange
        var game = new Game();

        // Act
        game.Initialize();

        // Assert
        Assert.Equal(GameMode.Start, game.Mode);
    }
}
EOF
```

ã€Œã‚ã‚Œï¼Ÿã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã­ã€ãã†ã§ã™ã€ãã‚ŒãŒæ­£ã—ã„çŠ¶æ…‹ã§ã™ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§ã¯ã€ã¾ã å­˜åœ¨ã—ãªã„ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¿…è¦ãªAPIã®å½¢ãŒè‡ªç„¶ã¨è¦‹ãˆã¦ãã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œå½“ç„¶ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã­ã€ãã®é€šã‚Šã§ã™ï¼ä»Šã¯ã¾ã `Game`ã‚¯ãƒ©ã‚¹ã‚‚`GameMode`åˆ—æŒ™å‹ã‚‚å­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚ŒãŒTDDã®ã€Œãƒ¬ãƒƒãƒ‰ï¼ˆå¤±æ•—ï¼‰ã€ã®æ®µéšã§ã™ã€‚æ¬¡ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«æœ€å°é™ã®å®Ÿè£…ã‚’è¡Œã†ã€Œã‚°ãƒªãƒ¼ãƒ³ï¼ˆæˆåŠŸï¼‰ã€ã®æ®µéšã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚

### å®Ÿè£…: ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–

ãã‚Œã§ã¯ã€ãƒ†ã‚¹ãƒˆã‚’é€šã™ãŸã‚ã®æœ€å°é™ã®å®Ÿè£…ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚ã¾ãšã¯ã€å¿…è¦ãªãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹ã¨ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã®åˆ—æŒ™å‹ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
# Modelsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
mkdir -p PuyoPuyoWPF/Models

# GameModeåˆ—æŒ™å‹ã‚’ä½œæˆ
cat > PuyoPuyoWPF/Models/GameMode.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public enum GameMode
{
    Start,
    Playing,
    GameOver
}
EOF

# Configã‚¯ãƒ©ã‚¹ã‚’ä½œæˆï¼ˆã‚²ãƒ¼ãƒ è¨­å®šã‚’ä¿æŒï¼‰
cat > PuyoPuyoWPF/Models/Config.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Config
{
    public int StageWidth { get; set; } = 6;
    public int StageHeight { get; set; } = 12;
    public int FallSpeed { get; set; } = 500; // ãƒŸãƒªç§’
}
EOF

# Stageã‚¯ãƒ©ã‚¹ã‚’ä½œæˆï¼ˆã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¡¨ç¾ï¼‰
cat > PuyoPuyoWPF/Models/Stage.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Stage
{
    private readonly int _width;
    private readonly int _height;
    private readonly int[,] _grid;

    public Stage(int width, int height)
    {
        _width = width;
        _height = height;
        _grid = new int[height, width];
    }

    public int Width => _width;
    public int Height => _height;
    
    public int GetCell(int x, int y)
    {
        if (x < 0 || x >= _width || y < 0 || y >= _height)
            return -1;
        return _grid[y, x];
    }

    public void SetCell(int x, int y, int value)
    {
        if (x >= 0 && x < _width && y >= 0 && y < _height)
            _grid[y, x] = value;
    }

    public void Clear()
    {
        for (int y = 0; y < _height; y++)
        {
            for (int x = 0; x < _width; x++)
            {
                _grid[y, x] = 0;
            }
        }
    }
}
EOF

# Playerã‚¯ãƒ©ã‚¹ã‚’ä½œæˆï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ“ä½œã‚’ç®¡ç†ï¼‰
cat > PuyoPuyoWPF/Models/Player.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Player
{
    public int CurrentX { get; set; }
    public int CurrentY { get; set; }
    
    public Player()
    {
        CurrentX = 2; // åˆæœŸä½ç½®ï¼ˆä¸­å¤®ï¼‰
        CurrentY = 0; // åˆæœŸä½ç½®ï¼ˆä¸Šç«¯ï¼‰
    }

    public void Reset()
    {
        CurrentX = 2;
        CurrentY = 0;
    }
}
EOF

# Scoreã‚¯ãƒ©ã‚¹ã‚’ä½œæˆï¼ˆã‚¹ã‚³ã‚¢ã‚’ç®¡ç†ï¼‰
cat > PuyoPuyoWPF/Models/Score.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Score
{
    public int CurrentScore { get; private set; }
    public int ChainCount { get; private set; }

    public void Reset()
    {
        CurrentScore = 0;
        ChainCount = 0;
    }

    public void AddScore(int points)
    {
        CurrentScore += points;
    }

    public void IncrementChain()
    {
        ChainCount++;
    }

    public void ResetChain()
    {
        ChainCount = 0;
    }
}
EOF

# Gameã‚¯ãƒ©ã‚¹ã‚’ä½œæˆï¼ˆã‚²ãƒ¼ãƒ å…¨ä½“ã‚’çµ±åˆï¼‰
cat > PuyoPuyoWPF/Models/Game.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Game
{
    public Config? Config { get; private set; }
    public Stage? Stage { get; private set; }
    public Player? Player { get; private set; }
    public Score? Score { get; private set; }
    public GameMode Mode { get; private set; }

    public void Initialize()
    {
        Config = new Config();
        Stage = new Stage(Config.StageWidth, Config.StageHeight);
        Player = new Player();
        Score = new Score();
        Mode = GameMode.Start;
        
        Stage.Clear();
        Player.Reset();
        Score.Reset();
    }

    public void Start()
    {
        if (Mode == GameMode.Start)
        {
            Mode = GameMode.Playing;
        }
    }

    public void GameOver()
    {
        Mode = GameMode.GameOver;
    }
}
EOF
```

ã€ŒãŸãã•ã‚“ã®ã‚¯ãƒ©ã‚¹ãŒã§ãã¾ã—ãŸã­ï¼ã€ãã†ã§ã™ã­ã€‚ãã‚Œãã‚Œã®ã‚¯ãƒ©ã‚¹ãŒå˜ä¸€ã®è²¬ä»»ã‚’æŒã£ã¦ã„ã¾ã™ï¼š

- **GameMode**: ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’è¡¨ç¾
- **Config**: ã‚²ãƒ¼ãƒ è¨­å®šã‚’ä¿æŒ
- **Stage**: ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç®¡ç†
- **Player**: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½ç½®ã‚’ç®¡ç†
- **Score**: ã‚¹ã‚³ã‚¢ã¨ãƒã‚§ãƒ¼ãƒ³ã‚’ç®¡ç†
- **Game**: ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ±åˆ

ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã¯ã€[å˜ä¸€è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰](https://ja.wikipedia.org/wiki/%E5%8D%98%E4%B8%80%E8%B2%AC%E4%BB%BB%E3%81%AE%E5%8E%9F%E5%89%87)ã«å¾“ã£ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

ã•ã¦ã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼ã“ã‚ŒãŒTDDã®ã€Œã‚°ãƒªãƒ¼ãƒ³ï¼ˆæˆåŠŸï¼‰ã€ã®æ®µéšã§ã™ã€‚ãƒ†ã‚¹ãƒˆãŒé€šã£ãŸã“ã¨ã§ã€ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã—ãŸã€‚

```bash
git add .
git commit -m 'feat: ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†ã‚’å®Ÿè£…'
```

### ViewModelã®ä½œæˆ

æ¬¡ã«ã€WPFã®MVVMãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã£ã¦ã€ViewModelã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚ViewModelã¯ã€ãƒ“ãƒ¥ãƒ¼ã¨ãƒ¢ãƒ‡ãƒ«ã®é–“ã®æ¶ã‘æ©‹ã¨ãªã‚Šã€ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…å½“ã—ã¾ã™ã€‚

ã¾ãšã€ViewModelã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¾ã—ã‚‡ã†ï¼š

```bash
mkdir -p PuyoPuyoWPF.Tests/ViewModels
cat > PuyoPuyoWPF.Tests/ViewModels/GameViewModelTest.cs << 'EOF'
using Xunit;
using PuyoPuyoWPF.ViewModels;
using PuyoPuyoWPF.Models;

namespace PuyoPuyoWPF.Tests.ViewModels;

public class GameViewModelTest
{
    [Fact]
    public void ViewModelã‚’åˆæœŸåŒ–ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹()
    {
        // Arrange & Act
        var viewModel = new GameViewModel();

        // Assert
        Assert.NotNull(viewModel.Game);
        Assert.Equal(GameMode.Start, viewModel.Game.Mode);
    }

    [Fact]
    public void Startã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();

        // Act
        viewModel.StartCommand.Execute(null);

        // Assert
        Assert.Equal(GameMode.Playing, viewModel.Game.Mode);
    }

    [Fact]
    public void ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å¤‰æ›´é€šçŸ¥ãŒæ­£ã—ãç™ºç«ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        bool propertyChanged = false;
        viewModel.PropertyChanged += (sender, e) =>
        {
            if (e.PropertyName == nameof(GameViewModel.Game))
                propertyChanged = true;
        };

        // Act
        viewModel.InitializeGame();

        // Assert
        Assert.True(propertyChanged);
    }
}
EOF
```

æ¬¡ã«ã€ViewModelã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ï¼š

```bash
mkdir -p PuyoPuyoWPF/ViewModels
cat > PuyoPuyoWPF/ViewModels/GameViewModel.cs << 'EOF'
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using PuyoPuyoWPF.Models;

namespace PuyoPuyoWPF.ViewModels;

public partial class GameViewModel : ObservableObject
{
    [ObservableProperty]
    private Game _game;

    public GameViewModel()
    {
        _game = new Game();
        InitializeGame();
    }

    public void InitializeGame()
    {
        Game.Initialize();
        OnPropertyChanged(nameof(Game));
    }

    [RelayCommand]
    private void Start()
    {
        Game.Start();
        OnPropertyChanged(nameof(Game));
    }

    [RelayCommand]
    private void Reset()
    {
        InitializeGame();
    }
}
EOF
```

ã€ŒCommunityToolkit.Mvvmã®Source Generatorã‚’ä½¿ã£ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ï¼`[ObservableProperty]`å±æ€§ã‚’ä½¿ã†ã¨ã€è‡ªå‹•çš„ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å¤‰æ›´é€šçŸ¥ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚`[RelayCommand]`å±æ€§ã¯ã€è‡ªå‹•çš„ã«ICommandã®å®Ÿè£…ã‚’ç”Ÿæˆã—ã¦ãã‚Œã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€å®Œç’§ã§ã™ï¼ã“ã‚Œã§ViewModelã®åŸºæœ¬æ©Ÿèƒ½ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚

```bash
git add .
git commit -m 'feat: GameViewModelã‚’å®Ÿè£…'
```

### Viewã¨ViewModelã®çµ±åˆ

æœ€å¾Œã«ã€ViewModelã‚’Viewã«çµ±åˆã—ã¾ã—ã‚‡ã†ã€‚MainWindow.xamlã‚’æ›´æ–°ã—ã¾ã™ï¼š

```bash
cat > PuyoPuyoWPF/MainWindow.xaml << 'EOF'
<Window x:Class="PuyoPuyoWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewmodels="clr-namespace:PuyoPuyoWPF.ViewModels"
        mc:Ignorable="d"
        Title="ã·ã‚ˆã·ã‚ˆ TDD" Height="600" Width="400">
    <Window.DataContext>
        <viewmodels:GameViewModel />
    </Window.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
        <StackPanel Grid.Row="0" Margin="10">
            <TextBlock Text="{Binding Game.Score.CurrentScore, StringFormat='ã‚¹ã‚³ã‚¢: {0}'}" 
                       FontSize="20" FontWeight="Bold"/>
            <TextBlock Text="{Binding Game.Score.ChainCount, StringFormat='ãƒã‚§ãƒ¼ãƒ³: {0}'}" 
                       FontSize="16"/>
        </StackPanel>
        
        <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ï¼ˆä»®ï¼‰ -->
        <Border Grid.Row="1" BorderBrush="Black" BorderThickness="2" Margin="10">
            <Canvas Background="White">
                <TextBlock Canvas.Left="100" Canvas.Top="200" 
                           FontSize="24" Text="ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢"/>
            </Canvas>
        </Border>
        
        <!-- ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" 
                    HorizontalAlignment="Center" Margin="10">
            <Button Content="ã‚¹ã‚¿ãƒ¼ãƒˆ" Command="{Binding StartCommand}" 
                    Width="100" Height="40" Margin="5"/>
            <Button Content="ãƒªã‚»ãƒƒãƒˆ" Command="{Binding ResetCommand}" 
                    Width="100" Height="40" Margin="5"/>
        </StackPanel>
    </Grid>
</Window>
EOF
```

MainWindow.xaml.csã‚‚æ›´æ–°ã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat > PuyoPuyoWPF/MainWindow.xaml.cs << 'EOF'
using System.Windows;

namespace PuyoPuyoWPF;

public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();
    }
}
EOF
```

ã€ŒWPFã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã§ãã¾ã—ãŸã­ï¼ã€ã¯ã„ã€å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet run --project PuyoPuyoWPF
```

ã€Œã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒè¡¨ç¤ºã•ã‚Œã¦ã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã¨ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ãŒã‚ã‚Šã¾ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚ã¾ã ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ã¯ç©ºã§ã™ãŒã€åŸºæœ¬çš„ãªæ§‹é€ ã¯ã§ãã¾ã—ãŸã€‚

æœ€å¾Œã«ã€ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Quality
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã£ã¦ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚‚ç”Ÿæˆã•ã‚Œã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

```bash
git add .
git commit -m 'feat: Viewã¨ViewModelã‚’çµ±åˆã—ã¦ã‚²ãƒ¼ãƒ é–‹å§‹ç”»é¢ã‚’ä½œæˆ'
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å®Ÿç¾ã—ã¾ã—ãŸï¼š

1. **ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–**: å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆConfigã€Stageã€Playerã€Scoreï¼‰ã®ä½œæˆ
2. **ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ç®¡ç†**: ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ï¼ˆStartã€Playingã€GameOverï¼‰ã®ç®¡ç†
3. **MVVMãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…**: ViewModelã«ã‚ˆã‚‹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢
4. **WPF UIçµ±åˆ**: XAMLã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¨ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…

**å­¦ã‚“ã ã“ã¨**:
- ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹
- å˜ä¸€è²¬ä»»ã®åŸå‰‡ã«åŸºã¥ã„ãŸã‚¯ãƒ©ã‚¹è¨­è¨ˆ
- WPFã®MVVMãƒ‘ã‚¿ãƒ¼ãƒ³
- CommunityToolkit.Mvvmã®Source Generatoræ´»ç”¨
- XAMLãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€å®Ÿéš›ã«ã·ã‚ˆã‚’ç”»é¢ã«è¡¨ç¤ºã—ã€æ“ä½œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã™ã‚ˆï¼

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2: ã·ã‚ˆã®ç§»å‹•ã®å®Ÿè£…

ã•ã¦ã€å‰å›ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚²ãƒ¼ãƒ ã®åŸºæœ¬çš„ãªæ§‹é€ ãŒã§ãã¾ã—ãŸã­ã€‚ã€Œã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã£ãŸã‘ã©ã€ã·ã‚ˆãŒå‹•ã‹ãªã„ã¨é¢ç™½ããªã„ã‚ˆã­ï¼Ÿã€ã¨æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿãã“ã§æ¬¡ã¯ã€ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã§ãã‚‹

ã€Œã·ã‚ˆã·ã‚ˆã£ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å·¦å³ã«å‹•ã‹ã—ã¦ã€ã†ã¾ãç©ã¿ä¸Šã’ã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã‚ˆã­ï¼Ÿã€ãã†ã§ã™ï¼ä»Šå›ã¯ãã®åŸºæœ¬æ“ä½œã§ã‚ã‚‹ã€Œå·¦å³ã®ç§»å‹•ã€ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

### TODOãƒªã‚¹ãƒˆ

ã•ã¦ã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€ã©ã‚“ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ã§ã—ã‚‡ã†ã‹ï¼Ÿä¸€ç·’ã«è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€å¤§ããªå•é¡Œã‚’å°ã•ãªå•é¡Œã«åˆ†å‰²ã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚è¤‡é›‘ãªå•é¡Œã«ç›´é¢ã—ãŸã¨ãã€ãã‚Œã‚’ç®¡ç†å¯èƒ½ãªå°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†è§£ã™ã‚‹ã“ã¨ã§ã€ä¸€æ­©ä¸€æ­©ç¢ºå®Ÿã«å‰é€²ã§ãã¾ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã€Œã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã™ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›ã‚’æ¤œå‡ºã™ã‚‹ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å·¦å³ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹ï¼‰
- ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆå®Ÿéš›ã«ã·ã‚ˆã®ä½ç½®ã‚’å¤‰æ›´ã™ã‚‹ï¼‰
- ç§»å‹•å¯èƒ½ã‹ã©ã†ã‹ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆç”»é¢ã®ç«¯ã‚„ä»–ã®ã·ã‚ˆã«ã¶ã¤ã‹ã‚‹å ´åˆã¯ç§»å‹•ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰
- ç§»å‹•å¾Œã®è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹ï¼ˆç”»é¢ä¸Šã§ã·ã‚ˆã®ä½ç½®ãŒå¤‰ã‚ã£ãŸã“ã¨ã‚’è¡¨ç¤ºã™ã‚‹ï¼‰

ã€Œãªã‚‹ã»ã©ã€é †ç•ªã«å®Ÿè£…ã—ã¦ã„ã‘ã°ã„ã„ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€ä¸€ã¤ãšã¤é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æµã‚Œã«æ²¿ã£ã¦ã€ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã™ã‚ˆã€‚

### ãƒ†ã‚¹ãƒˆ: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›æ¤œå‡º

ã€Œæœ€åˆã«ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚Œã°ã„ã„ã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€ã¾ãšã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›ã‚’æ¤œå‡ºã™ã‚‹éƒ¨åˆ†ã‹ã‚‰ãƒ†ã‚¹ãƒˆã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å·¦å³ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«ã€ãã‚Œã‚’æ­£ã—ãæ¤œçŸ¥ã§ãã‚‹ã‹ã©ã†ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

> ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
> 
> ã„ã¤ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¹ãã ã‚ã†ã‹â€”â€”ãã‚Œã¯ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

```bash
cat > PuyoPuyoWPF.Tests/Models/PlayerTest.cs << 'EOF'
using Xunit;
using PuyoPuyoWPF.Models;

namespace PuyoPuyoWPF.Tests.Models;

public class PlayerTest
{
    private readonly Config _config;
    private readonly Stage _stage;
    private readonly Player _player;

    public PlayerTest()
    {
        _config = new Config();
        _stage = new Stage(_config.StageWidth, _config.StageHeight);
        _player = new Player();
    }

    [Fact]
    public void å·¦ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã‚‹ã¨å·¦å‘ãã®ç§»å‹•ãƒ•ãƒ©ã‚°ãŒç«‹ã¤()
    {
        // Act
        _player.SetInputLeft(true);

        // Assert
        Assert.True(_player.InputKeyLeft);
    }

    [Fact]
    public void å³ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã‚‹ã¨å³å‘ãã®ç§»å‹•ãƒ•ãƒ©ã‚°ãŒç«‹ã¤()
    {
        // Act
        _player.SetInputRight(true);

        // Assert
        Assert.True(_player.InputKeyRight);
    }

    [Fact]
    public void ã‚­ãƒ¼ãŒé›¢ã•ã‚Œã‚‹ã¨å¯¾å¿œã™ã‚‹ç§»å‹•ãƒ•ãƒ©ã‚°ãŒä¸‹ãŒã‚‹()
    {
        // Arrange
        _player.SetInputLeft(true);
        Assert.True(_player.InputKeyLeft);

        // Act
        _player.SetInputLeft(false);

        // Assert
        Assert.False(_player.InputKeyLeft);
    }
}
EOF
```

ã€Œã“ã®ãƒ†ã‚¹ãƒˆã¯ä½•ã‚’ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å·¦å³ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã¨é›¢ã•ã‚ŒãŸã¨ãã«ã€`Player`ã‚¯ãƒ©ã‚¹ã®ä¸­ã®å¯¾å¿œã™ã‚‹ãƒ•ãƒ©ã‚°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã­ã€ãã†ã§ã™ã€ã¾ã å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚ã“ã‚ŒãŒTDDã®ã€Œãƒ¬ãƒƒãƒ‰ï¼ˆå¤±æ•—ï¼‰ã€ã®çŠ¶æ…‹ã§ã™ã€‚

### å®Ÿè£…: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›æ¤œå‡º

ã€Œå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆãŒã§ããŸã®ã§ã€æ¬¡ã¯å®Ÿè£…ã§ã™ã­ï¼ã€ãã†ã§ã™ï¼ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ã€æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

> æœ€å°é™ã®å®Ÿè£…
> 
> ãƒ†ã‚¹ãƒˆã‚’é€šã™ãŸã‚ã«ã€ã©ã‚Œã ã‘ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‘ã°ã‚ˆã„ã ã‚ã†ã‹â€”â€”ãƒ†ã‚¹ãƒˆãŒé€šã‚‹æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã ã‘ã‚’æ›¸ã“ã†ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

```bash
cat > PuyoPuyoWPF/Models/Player.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Player
{
    public int CurrentX { get; set; }
    public int CurrentY { get; set; }
    public bool InputKeyLeft { get; private set; }
    public bool InputKeyRight { get; private set; }
    
    public Player()
    {
        CurrentX = 2; // åˆæœŸä½ç½®ï¼ˆä¸­å¤®ï¼‰
        CurrentY = 0; // åˆæœŸä½ç½®ï¼ˆä¸Šç«¯ï¼‰
    }

    public void Reset()
    {
        CurrentX = 2;
        CurrentY = 0;
        InputKeyLeft = false;
        InputKeyRight = false;
    }

    public void SetInputLeft(bool isPressed)
    {
        InputKeyLeft = isPressed;
    }

    public void SetInputRight(bool isPressed)
    {
        InputKeyRight = isPressed;
    }

    public void MoveLeft(Stage stage)
    {
        if (CanMove(CurrentX - 1, CurrentY, stage))
        {
            CurrentX--;
        }
    }

    public void MoveRight(Stage stage)
    {
        if (CanMove(CurrentX + 1, CurrentY, stage))
        {
            CurrentX++;
        }
    }

    private bool CanMove(int x, int y, Stage stage)
    {
        // ç”»é¢ã®ç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯
        if (x < 0 || x >= stage.Width || y < 0 || y >= stage.Height)
        {
            return false;
        }

        // ãã®ä½ç½®ã«ã™ã§ã«ã·ã‚ˆãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        return stage.GetCell(x, y) == 0;
    }
}
EOF
```

ã€Œå…¥åŠ›ãƒ•ãƒ©ã‚°ã®ç®¡ç†ã«åŠ ãˆã¦ã€ç§»å‹•å‡¦ç†ã‚‚å®Ÿè£…ã—ãŸã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚ãƒ†ã‚¹ãƒˆã‚’é€šã™ã ã‘ã§ãªãã€æ¬¡ã®ãƒ†ã‚¹ãƒˆã§å¿…è¦ã«ãªã‚‹æ©Ÿèƒ½ã‚‚å…ˆèª­ã¿ã—ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼ã“ã‚Œã§å…¥åŠ›æ¤œå‡ºã®æ©Ÿèƒ½ãŒå®Œæˆã—ã¾ã—ãŸã€‚

```bash
git add .
git commit -m 'feat: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›æ¤œå‡ºã‚’å®Ÿè£…'
```

### ãƒ†ã‚¹ãƒˆ: ã·ã‚ˆã®ç§»å‹•å‡¦ç†

æ¬¡ã«ã€å®Ÿéš›ã«ã·ã‚ˆã‚’ç§»å‹•ã•ã›ã‚‹å‡¦ç†ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¾ã—ã‚‡ã†ã€‚å·¦å³ã«ç§»å‹•ã§ãã‚‹ã“ã¨ã¨ã€ç”»é¢ã®ç«¯ã§ã¯ç§»å‹•ã§ããªã„ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```bash
cat >> PuyoPuyoWPF.Tests/Models/PlayerTest.cs << 'EOF'

    [Fact]
    public void å·¦ã«ç§»å‹•ã§ãã‚‹()
    {
        // Arrange
        int initialX = _player.CurrentX;

        // Act
        _player.MoveLeft(_stage);

        // Assert
        Assert.Equal(initialX - 1, _player.CurrentX);
    }

    [Fact]
    public void å³ã«ç§»å‹•ã§ãã‚‹()
    {
        // Arrange
        int initialX = _player.CurrentX;

        // Act
        _player.MoveRight(_stage);

        // Assert
        Assert.Equal(initialX + 1, _player.CurrentX);
    }

    [Fact]
    public void å·¦ç«¯ã§ã¯å·¦ã«ç§»å‹•ã§ããªã„()
    {
        // Arrange
        _player.CurrentX = 0;

        // Act
        _player.MoveLeft(_stage);

        // Assert
        Assert.Equal(0, _player.CurrentX);
    }

    [Fact]
    public void å³ç«¯ã§ã¯å³ã«ç§»å‹•ã§ããªã„()
    {
        // Arrange
        _player.CurrentX = _config.StageWidth - 1;

        // Act
        _player.MoveRight(_stage);

        // Assert
        Assert.Equal(_config.StageWidth - 1, _player.CurrentX);
    }

    [Fact]
    public void ã·ã‚ˆãŒã‚ã‚‹ä½ç½®ã«ã¯ç§»å‹•ã§ããªã„()
    {
        // Arrange
        int initialX = _player.CurrentX;
        _stage.SetCell(initialX + 1, _player.CurrentY, 1); // å³ã«ã·ã‚ˆã‚’é…ç½®

        // Act
        _player.MoveRight(_stage);

        // Assert
        Assert.Equal(initialX, _player.CurrentX); // ç§»å‹•ã—ã¦ã„ãªã„
    }
}
EOF
```

ã€Œã“ã®ãƒ†ã‚¹ãƒˆã¯ä½•ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‚“ã§ã™ã‹ï¼Ÿã€ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ä»¥ä¸‹ã®ã“ã¨ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ï¼š

1. **åŸºæœ¬çš„ãªç§»å‹•**: å·¦å³ã«æ­£ã—ãç§»å‹•ã§ãã‚‹ã‹
2. **å¢ƒç•Œãƒã‚§ãƒƒã‚¯**: ç”»é¢ã®ç«¯ã§ã¯ç§»å‹•ã§ããªã„ã‹
3. **è¡çªåˆ¤å®š**: ã™ã§ã«ã·ã‚ˆãŒã‚ã‚‹å ´æ‰€ã«ã¯ç§»å‹•ã§ããªã„ã‹

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€å®Œç’§ã§ã™ï¼ç§»å‹•å‡¦ç†ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

```bash
git add .
git commit -m 'test: ã·ã‚ˆã®ç§»å‹•å‡¦ç†ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
```

### ViewModelã¸ã®ã‚­ãƒ¼å…¥åŠ›å‡¦ç†ã®çµ±åˆ

æ¬¡ã«ã€WPFã®ViewModelã«ã‚­ãƒ¼å…¥åŠ›å‡¦ç†ã‚’çµ±åˆã—ã¾ã—ã‚‡ã†ã€‚WPFã§ã¯ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’ViewModelã§å‡¦ç†ã—ã¾ã™ã€‚

```bash
cat > PuyoPuyoWPF/ViewModels/GameViewModel.cs << 'EOF'
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using PuyoPuyoWPF.Models;
using System.Windows.Input;

namespace PuyoPuyoWPF.ViewModels;

public partial class GameViewModel : ObservableObject
{
    [ObservableProperty]
    private Game _game;

    public GameViewModel()
    {
        _game = new Game();
        InitializeGame();
    }

    public void InitializeGame()
    {
        Game.Initialize();
        OnPropertyChanged(nameof(Game));
    }

    [RelayCommand]
    private void Start()
    {
        Game.Start();
        OnPropertyChanged(nameof(Game));
    }

    [RelayCommand]
    private void Reset()
    {
        InitializeGame();
    }

    public void HandleKeyDown(Key key)
    {
        if (Game.Mode != GameMode.Playing)
            return;

        switch (key)
        {
            case Key.Left:
                Game.Player?.SetInputLeft(true);
                Game.Player?.MoveLeft(Game.Stage!);
                break;
            case Key.Right:
                Game.Player?.SetInputRight(true);
                Game.Player?.MoveRight(Game.Stage!);
                break;
        }

        OnPropertyChanged(nameof(Game));
    }

    public void HandleKeyUp(Key key)
    {
        switch (key)
        {
            case Key.Left:
                Game.Player?.SetInputLeft(false);
                break;
            case Key.Right:
                Game.Player?.SetInputRight(false);
                break;
        }
    }
}
EOF
```

ã€ŒHandleKeyDownã¨HandleKeyUpãƒ¡ã‚½ãƒƒãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€Viewå´ã‹ã‚‰ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã£ã¦ã€ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã«åæ˜ ã—ã¾ã™ã€‚

### ViewModelã®ãƒ†ã‚¹ãƒˆ

ViewModelã®ã‚­ãƒ¼å…¥åŠ›å‡¦ç†ã‚‚ãƒ†ã‚¹ãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
cat > PuyoPuyoWPF.Tests/ViewModels/GameViewModelTest.cs << 'EOF'
using Xunit;
using PuyoPuyoWPF.ViewModels;
using PuyoPuyoWPF.Models;
using System.Windows.Input;

namespace PuyoPuyoWPF.Tests.ViewModels;

public class GameViewModelTest
{
    [Fact]
    public void ViewModelã‚’åˆæœŸåŒ–ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹()
    {
        // Arrange & Act
        var viewModel = new GameViewModel();

        // Assert
        Assert.NotNull(viewModel.Game);
        Assert.Equal(GameMode.Start, viewModel.Game.Mode);
    }

    [Fact]
    public void Startã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();

        // Act
        viewModel.StartCommand.Execute(null);

        // Assert
        Assert.Equal(GameMode.Playing, viewModel.Game.Mode);
    }

    [Fact]
    public void å·¦ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒå·¦ã«ç§»å‹•ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        int initialX = viewModel.Game.Player!.CurrentX;

        // Act
        viewModel.HandleKeyDown(Key.Left);

        // Assert
        Assert.Equal(initialX - 1, viewModel.Game.Player.CurrentX);
    }

    [Fact]
    public void å³ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒå³ã«ç§»å‹•ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        int initialX = viewModel.Game.Player!.CurrentX;

        // Act
        viewModel.HandleKeyDown(Key.Right);

        // Assert
        Assert.Equal(initialX + 1, viewModel.Game.Player.CurrentX);
    }

    [Fact]
    public void ã‚²ãƒ¼ãƒ ãŒPlayingçŠ¶æ…‹ã§ãªã„ã¨ãã¯ã‚­ãƒ¼å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ãªã„()
    {
        // Arrange
        var viewModel = new GameViewModel();
        // StartçŠ¶æ…‹ã®ã¾ã¾ï¼ˆPlayingçŠ¶æ…‹ã«ã—ãªã„ï¼‰
        int initialX = viewModel.Game.Player!.CurrentX;

        // Act
        viewModel.HandleKeyDown(Key.Left);

        // Assert
        Assert.Equal(initialX, viewModel.Game.Player.CurrentX); // ç§»å‹•ã—ã¦ã„ãªã„
    }
}
EOF
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€å®Œç’§ã§ã™ï¼

```bash
git add .
git commit -m 'feat: ViewModelã«ã‚­ãƒ¼å…¥åŠ›å‡¦ç†ã‚’çµ±åˆ'
```

### Viewã¸ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®è¿½åŠ 

æœ€å¾Œã«ã€MainWindow.xamlã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat > PuyoPuyoWPF/MainWindow.xaml << 'EOF'
<Window x:Class="PuyoPuyoWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewmodels="clr-namespace:PuyoPuyoWPF.ViewModels"
        mc:Ignorable="d"
        Title="ã·ã‚ˆã·ã‚ˆ TDD" Height="600" Width="400"
        KeyDown="Window_KeyDown"
        KeyUp="Window_KeyUp"
        Focusable="True">
    <Window.DataContext>
        <viewmodels:GameViewModel />
    </Window.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
        <StackPanel Grid.Row="0" Margin="10">
            <TextBlock Text="{Binding Game.Score.CurrentScore, StringFormat='ã‚¹ã‚³ã‚¢: {0}'}" 
                       FontSize="20" FontWeight="Bold"/>
            <TextBlock Text="{Binding Game.Score.ChainCount, StringFormat='ãƒã‚§ãƒ¼ãƒ³: {0}'}" 
                       FontSize="16"/>
            <TextBlock Text="{Binding Game.Mode, StringFormat='ãƒ¢ãƒ¼ãƒ‰: {0}'}" 
                       FontSize="14" Foreground="Gray"/>
        </StackPanel>
        
        <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
        <Border Grid.Row="1" BorderBrush="Black" BorderThickness="2" Margin="10">
            <Canvas Background="White">
                <TextBlock Canvas.Left="80" Canvas.Top="200" 
                           FontSize="24" Text="ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢"/>
                <TextBlock Canvas.Left="60" Canvas.Top="240" 
                           FontSize="14" Text="â† â†’ ã‚­ãƒ¼ã§ç§»å‹•ã§ãã¾ã™"/>
            </Canvas>
        </Border>
        
        <!-- ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" 
                    HorizontalAlignment="Center" Margin="10">
            <Button Content="ã‚¹ã‚¿ãƒ¼ãƒˆ" Command="{Binding StartCommand}" 
                    Width="100" Height="40" Margin="5"/>
            <Button Content="ãƒªã‚»ãƒƒãƒˆ" Command="{Binding ResetCommand}" 
                    Width="100" Height="40" Margin="5"/>
        </StackPanel>
    </Grid>
</Window>
EOF
```

æ¬¡ã«ã€ã‚³ãƒ¼ãƒ‰ãƒ“ãƒã‚¤ãƒ³ãƒ‰ã‚’æ›´æ–°ã—ã¾ã™ï¼š

```bash
cat > PuyoPuyoWPF/MainWindow.xaml.cs << 'EOF'
using System.Windows;
using System.Windows.Input;
using PuyoPuyoWPF.ViewModels;

namespace PuyoPuyoWPF;

public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();
    }

    private void Window_KeyDown(object sender, KeyEventArgs e)
    {
        if (DataContext is GameViewModel viewModel)
        {
            viewModel.HandleKeyDown(e.Key);
        }
    }

    private void Window_KeyUp(object sender, KeyEventArgs e)
    {
        if (DataContext is GameViewModel viewModel)
        {
            viewModel.HandleKeyUp(e.Key);
        }
    }
}
EOF
```

ã€ŒKeyDownã¨KeyUpã‚¤ãƒ™ãƒ³ãƒˆã‚’ViewModelã«è»¢é€ã—ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚WPFã§ã¯ã€Viewå´ã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã‚Šã€ViewModelã«å‡¦ç†ã‚’å§”è­²ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Quality
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã£ã¦ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚‚è‰¯å¥½ã§ã™ã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

```bash
git add .
git commit -m 'feat: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã«ã‚ˆã‚‹ã·ã‚ˆã®ç§»å‹•ã‚’å®Ÿè£…'
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å®Ÿç¾ã—ã¾ã—ãŸï¼š

1. **å…¥åŠ›æ¤œå‡º**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å·¦å³ã‚­ãƒ¼ã®å…¥åŠ›æ¤œå‡º
2. **ç§»å‹•å‡¦ç†**: ã·ã‚ˆã‚’å·¦å³ã«ç§»å‹•ã™ã‚‹æ©Ÿèƒ½
3. **å¢ƒç•Œãƒã‚§ãƒƒã‚¯**: ç”»é¢ã®ç«¯ã§ã®ç§»å‹•åˆ¶é™
4. **è¡çªåˆ¤å®š**: ä»–ã®ã·ã‚ˆã¨ã®è¡çªæ¤œå‡º
5. **MVVMçµ±åˆ**: ViewModelã¨Viewã¸ã®ã‚­ãƒ¼å…¥åŠ›å‡¦ç†ã®çµ±åˆ

**å­¦ã‚“ã ã“ã¨**:
- ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã«ã‚ˆã‚‹æ®µéšçš„ãªæ©Ÿèƒ½å®Ÿè£…
- å¢ƒç•Œå€¤ã®ãƒ†ã‚¹ãƒˆï¼ˆç”»é¢ã®ç«¯ã®å‡¦ç†ï¼‰
- WPFã§ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
- Viewã¨ViewModelã®é€£æºãƒ‘ã‚¿ãƒ¼ãƒ³

**ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒã‚°ã®æ—©æœŸç™ºè¦‹ï¼šç§»å‹•ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒã‚°ã‚’ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã«ç™ºè¦‹ãƒ»ä¿®æ­£
- å®‰å¿ƒã—ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼šãƒ†ã‚¹ãƒˆãŒã‚ã‚‹ã®ã§ã€å¾Œã‹ã‚‰å®‰å…¨ã«ã‚³ãƒ¼ãƒ‰æ”¹å–„å¯èƒ½
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä»£ã‚ã‚Šï¼šãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒä»•æ§˜æ›¸ã®å½¹å‰²ã‚’æœãŸã™

æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ã·ã‚ˆã®å›è»¢æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã‚ˆï¼

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3: ã·ã‚ˆã®å›è»¢ã®å®Ÿè£…

ã€Œå·¦å³ã«ç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‘ã©ã€ã·ã‚ˆã·ã‚ˆã£ã¦å›è»¢ã‚‚ã§ãã¾ã™ã‚ˆã­ï¼Ÿã€ãã†ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã®ä¸€ã¤ã¯ã€ã·ã‚ˆã‚’å›è»¢ã•ã›ã¦æ€ã„é€šã‚Šã®å ´æ‰€ã«é…ç½®ã™ã‚‹ã“ã¨ã§ã™ã€‚ä»Šå›ã¯ã€ã·ã‚ˆã‚’å›è»¢ã•ã›ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€è½ã¡ã¦ãã‚‹ã·ã‚ˆã‚’å›è»¢ã§ãã‚‹

ã€Œå›è»¢ã£ã¦å…·ä½“çš„ã«ã©ã†ã„ã†å‹•ãã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã§ã¯ã€2ã¤ã®ã·ã‚ˆãŒé€£ãªã£ãŸçŠ¶æ…‹ã§è½ã¡ã¦ãã¾ã™ã€‚å›è»¢ã¨ã¯ã€ã“ã®2ã¤ã®ã·ã‚ˆã®ç›¸å¯¾çš„ãªä½ç½®é–¢ä¿‚ã‚’å¤‰ãˆã‚‹ã“ã¨ã§ã™ã€‚

### TODOãƒªã‚¹ãƒˆ

ã€Œã©ã‚“ãªä½œæ¥­ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã‹ï¼Ÿã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€å®Ÿè£…å‰ã«å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºã®æ–¹å‘æ€§ã‚’ä¿ã¡ã€ä½•ã‚‚è¦‹è½ã¨ã•ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã€Œã·ã‚ˆã‚’å›è»¢ã•ã›ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- ã·ã‚ˆã®å›è»¢å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ™‚è¨ˆå›ã‚Šãƒ»åæ™‚è¨ˆå›ã‚Šã®å›è»¢ï¼‰
- å›è»¢å¯èƒ½ã‹ã©ã†ã‹ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆä»–ã®ã·ã‚ˆã‚„å£ã«ã¶ã¤ã‹ã‚‹å ´åˆã¯å›è»¢ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰
- å£ã‚­ãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆå£éš›ã§ã®å›è»¢ã‚’å¯èƒ½ã«ã™ã‚‹ç‰¹æ®Šå‡¦ç†ï¼‰

### ãƒ†ã‚¹ãƒˆ: ã·ã‚ˆã®å›è»¢

ã€Œã¾ãšã¯ä½•ã‹ã‚‰ãƒ†ã‚¹ãƒˆã—ã¾ã™ã‹ï¼Ÿã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®æµã‚Œã«æ²¿ã£ã¦ã€ã¾ãšã¯åŸºæœ¬çš„ãªå›è»¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```bash
cat >> PuyoPuyoWPF.Tests/Models/PlayerTest.cs << 'EOF'

    [Fact]
    public void æ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹ã¨å›è»¢çŠ¶æ…‹ãŒ1å¢—ãˆã‚‹()
    {
        // Arrange
        var initialRotation = _player.Rotation;

        // Act
        _player.RotateRight(_stage);

        // Assert
        Assert.Equal((initialRotation + 1) % 4, _player.Rotation);
    }

    [Fact]
    public void åæ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹ã¨å›è»¢çŠ¶æ…‹ãŒ1æ¸›ã‚‹()
    {
        // Arrange
        _player.Rotation = 1;

        // Act
        _player.RotateLeft(_stage);

        // Assert
        Assert.Equal(0, _player.Rotation);
    }

    [Fact]
    public void å›è»¢çŠ¶æ…‹ã¯0ã‹ã‚‰3ã®ç¯„å›²ã§å¾ªç’°ã™ã‚‹()
    {
        // Arrange
        _player.Rotation = 3;

        // Act
        _player.RotateRight(_stage);

        // Assert
        Assert.Equal(0, _player.Rotation);
    }

    [Fact]
    public void å›è»¢çŠ¶æ…‹ãŒ0ã‹ã‚‰åæ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹ã¨3ã«ãªã‚‹()
    {
        // Arrange
        _player.Rotation = 0;

        // Act
        _player.RotateLeft(_stage);

        // Assert
        Assert.Equal(3, _player.Rotation);
    }
}
EOF
```

ã€Œå›è»¢çŠ¶æ…‹ãŒ0ã‹ã‚‰3ã¾ã§ã‚ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚ã·ã‚ˆã®å›è»¢çŠ¶æ…‹ã¯ä»¥ä¸‹ã®4ã¤ã§ã™ï¼š

- **0**: ä¸Šï¼ˆåˆæœŸçŠ¶æ…‹ï¼‰
- **1**: å³
- **2**: ä¸‹
- **3**: å·¦

ã€Œãªã‚‹ã»ã©ã€90åº¦ãšã¤å›è»¢ã™ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚æ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹ã¨çŠ¶æ…‹ãŒ1å¢—ãˆã€åæ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹ã¨1æ¸›ã‚Šã¾ã™ã€‚ãã—ã¦ã€3ã‹ã‚‰1å¢—ãˆã‚‹ã¨0ã«æˆ»ã‚Šï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ­æ¼”ç®—ï¼‰ã€0ã‹ã‚‰1æ¸›ã‚‹ã¨3ã«ãªã‚Šã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã­ã€ãã†ã§ã™ã€ã¾ã å›è»¢ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚ã“ã‚ŒãŒTDDã®ã€Œãƒ¬ãƒƒãƒ‰ï¼ˆå¤±æ•—ï¼‰ã€ã®çŠ¶æ…‹ã§ã™ã€‚

### å®Ÿè£…: ã·ã‚ˆã®å›è»¢

ãã‚Œã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å›è»¢æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚ã¾ãšã€`Player`ã‚¯ãƒ©ã‚¹ã«å›è»¢çŠ¶æ…‹ã¨å›è»¢ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
cat > PuyoPuyoWPF/Models/Player.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Player
{
    public int CurrentX { get; set; }
    public int CurrentY { get; set; }
    public int Rotation { get; set; }
    public bool InputKeyLeft { get; private set; }
    public bool InputKeyRight { get; private set; }
    public bool InputKeyRotateLeft { get; private set; }
    public bool InputKeyRotateRight { get; private set; }
    
    public Player()
    {
        CurrentX = 2; // åˆæœŸä½ç½®ï¼ˆä¸­å¤®ï¼‰
        CurrentY = 0; // åˆæœŸä½ç½®ï¼ˆä¸Šç«¯ï¼‰
        Rotation = 0; // åˆæœŸå›è»¢çŠ¶æ…‹ï¼ˆä¸Šï¼‰
    }

    public void Reset()
    {
        CurrentX = 2;
        CurrentY = 0;
        Rotation = 0;
        InputKeyLeft = false;
        InputKeyRight = false;
        InputKeyRotateLeft = false;
        InputKeyRotateRight = false;
    }

    public void SetInputLeft(bool isPressed)
    {
        InputKeyLeft = isPressed;
    }

    public void SetInputRight(bool isPressed)
    {
        InputKeyRight = isPressed;
    }

    public void SetInputRotateLeft(bool isPressed)
    {
        InputKeyRotateLeft = isPressed;
    }

    public void SetInputRotateRight(bool isPressed)
    {
        InputKeyRotateRight = isPressed;
    }

    public void MoveLeft(Stage stage)
    {
        if (CanMove(CurrentX - 1, CurrentY, stage))
        {
            CurrentX--;
        }
    }

    public void MoveRight(Stage stage)
    {
        if (CanMove(CurrentX + 1, CurrentY, stage))
        {
            CurrentX++;
        }
    }

    public void RotateRight(Stage stage)
    {
        int newRotation = (Rotation + 1) % 4;
        
        if (CanRotate(CurrentX, CurrentY, newRotation, stage))
        {
            Rotation = newRotation;
        }
        else if (TryWallKick(newRotation, stage))
        {
            // å£ã‚­ãƒƒã‚¯ãŒæˆåŠŸã—ãŸå ´åˆã€ä½ç½®ã¨å›è»¢ãŒèª¿æ•´ã•ã‚Œã‚‹
        }
    }

    public void RotateLeft(Stage stage)
    {
        int newRotation = (Rotation - 1 + 4) % 4;
        
        if (CanRotate(CurrentX, CurrentY, newRotation, stage))
        {
            Rotation = newRotation;
        }
        else if (TryWallKick(newRotation, stage))
        {
            // å£ã‚­ãƒƒã‚¯ãŒæˆåŠŸã—ãŸå ´åˆã€ä½ç½®ã¨å›è»¢ãŒèª¿æ•´ã•ã‚Œã‚‹
        }
    }

    private bool CanMove(int x, int y, Stage stage)
    {
        // ç”»é¢ã®ç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯
        if (x < 0 || x >= stage.Width || y < 0 || y >= stage.Height)
        {
            return false;
        }

        // ãã®ä½ç½®ã«ã™ã§ã«ã·ã‚ˆãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        return stage.GetCell(x, y) == 0;
    }

    private bool CanRotate(int x, int y, int rotation, Stage stage)
    {
        // è»¸ã·ã‚ˆã®ä½ç½®ã‚’ãƒã‚§ãƒƒã‚¯
        if (!CanMove(x, y, stage))
        {
            return false;
        }

        // å­ã·ã‚ˆã®ä½ç½®ã‚’ãƒã‚§ãƒƒã‚¯
        var (childX, childY) = GetChildPosition(x, y, rotation);
        
        if (childX < 0 || childX >= stage.Width || childY < 0 || childY >= stage.Height)
        {
            return false;
        }

        return stage.GetCell(childX, childY) == 0;
    }

    private bool TryWallKick(int newRotation, Stage stage)
    {
        // å£ã‚­ãƒƒã‚¯: å·¦ã«1ãƒã‚¹
        if (CanRotate(CurrentX - 1, CurrentY, newRotation, stage))
        {
            CurrentX--;
            Rotation = newRotation;
            return true;
        }

        // å£ã‚­ãƒƒã‚¯: å³ã«1ãƒã‚¹
        if (CanRotate(CurrentX + 1, CurrentY, newRotation, stage))
        {
            CurrentX++;
            Rotation = newRotation;
            return true;
        }

        return false;
    }

    private (int x, int y) GetChildPosition(int parentX, int parentY, int rotation)
    {
        return rotation switch
        {
            0 => (parentX, parentY - 1), // ä¸Š
            1 => (parentX + 1, parentY), // å³
            2 => (parentX, parentY + 1), // ä¸‹
            3 => (parentX - 1, parentY), // å·¦
            _ => (parentX, parentY)
        };
    }

    public (int x, int y) GetChildPosition()
    {
        return GetChildPosition(CurrentX, CurrentY, Rotation);
    }
}
EOF
```

ã€ŒãŸãã•ã‚“ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã­ï¼ã€ãã†ã§ã™ã­ã€‚ãã‚Œãã‚Œã®å½¹å‰²ã‚’èª¬æ˜ã—ã¾ã—ã‚‡ã†ï¼š

- **RotateRight/RotateLeft**: å›è»¢ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
- **CanRotate**: æŒ‡å®šã—ãŸä½ç½®ã¨å›è»¢ã§å›è»¢å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
- **TryWallKick**: å£ã‚­ãƒƒã‚¯å‡¦ç†ï¼ˆå£éš›ã§ã®å›è»¢è£œæ­£ï¼‰
- **GetChildPosition**: å›è»¢çŠ¶æ…‹ã«å¿œã˜ãŸå­ã·ã‚ˆã®ä½ç½®ã‚’è¨ˆç®—

ã€Œå£ã‚­ãƒƒã‚¯ã£ã¦ä½•ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼å£ã‚­ãƒƒã‚¯ã¯ã€å£éš›ã§ã·ã‚ˆã‚’å›è»¢ã•ã›ã‚ˆã†ã¨ã—ãŸã¨ãã«ã€å°‘ã—æ¨ªã«ãšã‚‰ã™ã“ã¨ã§å›è»¢ã‚’å¯èƒ½ã«ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚ã“ã‚ŒãŒã‚ã‚‹ã¨ã€ãƒ—ãƒ¬ã‚¤ã®è‡ªç”±åº¦ãŒå¤§ããå‘ä¸Šã—ã¾ã™ã‚ˆï¼

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼å›è»¢æ©Ÿèƒ½ã®åŸºæœ¬ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚

```bash
git add .
git commit -m 'feat: ã·ã‚ˆã®å›è»¢æ©Ÿèƒ½ã‚’å®Ÿè£…'
```

### ãƒ†ã‚¹ãƒˆ: å›è»¢ã®åˆ¶ç´„

æ¬¡ã«ã€å›è»¢ã«é–¢ã™ã‚‹åˆ¶ç´„ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚å£ã‚„ä»–ã®ã·ã‚ˆãŒã‚ã‚‹å ´åˆã®å›è»¢å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
cat > PuyoPuyoWPF.Tests/Models/PlayerRotationTest.cs << 'EOF'
using Xunit;
using PuyoPuyoWPF.Models;

namespace PuyoPuyoWPF.Tests.Models;

public class PlayerRotationTest
{
    private readonly Config _config;
    private readonly Stage _stage;
    private readonly Player _player;

    public PlayerRotationTest()
    {
        _config = new Config();
        _stage = new Stage(_config.StageWidth, _config.StageHeight);
        _player = new Player();
    }

    [Fact]
    public void å›è»¢å…ˆã«éšœå®³ç‰©ãŒã‚ã‚‹å ´åˆã¯å›è»¢ã§ããªã„()
    {
        // Arrange
        _player.CurrentX = 2;
        _player.CurrentY = 1;
        _player.Rotation = 0; // ä¸Š
        _stage.SetCell(3, 1, 1); // å³å´ã«ã·ã‚ˆã‚’é…ç½®

        // Act
        _player.RotateRight(_stage); // å³ã«å›è»¢ã—ã‚ˆã†ã¨ã™ã‚‹

        // Assert
        Assert.Equal(0, _player.Rotation); // å›è»¢ã—ã¦ã„ãªã„
    }

    [Fact]
    public void å·¦ç«¯ã§å›è»¢ã™ã‚‹ã¨å£ã‚­ãƒƒã‚¯ã§å³ã«ãšã‚Œã‚‹()
    {
        // Arrange
        _player.CurrentX = 0;
        _player.CurrentY = 1;
        _player.Rotation = 0; // ä¸Š

        // Act
        _player.RotateLeft(_stage); // å·¦ã«å›è»¢ï¼ˆå­ã·ã‚ˆãŒç”»é¢å¤–ã«å‡ºã‚‹ï¼‰

        // Assert
        Assert.Equal(3, _player.Rotation); // å·¦å‘ãã«å›è»¢
        Assert.Equal(1, _player.CurrentX); // å£ã‚­ãƒƒã‚¯ã§å³ã«1ãƒã‚¹ç§»å‹•
    }

    [Fact]
    public void å³ç«¯ã§å›è»¢ã™ã‚‹ã¨å£ã‚­ãƒƒã‚¯ã§å·¦ã«ãšã‚Œã‚‹()
    {
        // Arrange
        _player.CurrentX = _config.StageWidth - 1;
        _player.CurrentY = 1;
        _player.Rotation = 0; // ä¸Š

        // Act
        _player.RotateRight(_stage); // å³ã«å›è»¢ï¼ˆå­ã·ã‚ˆãŒç”»é¢å¤–ã«å‡ºã‚‹ï¼‰

        // Assert
        Assert.Equal(1, _player.Rotation); // å³å‘ãã«å›è»¢
        Assert.Equal(_config.StageWidth - 2, _player.CurrentX); // å£ã‚­ãƒƒã‚¯ã§å·¦ã«1ãƒã‚¹ç§»å‹•
    }

    [Fact]
    public void å£ã‚­ãƒƒã‚¯ã‚‚ã§ããªã„å ´åˆã¯å›è»¢ã—ãªã„()
    {
        // Arrange
        _player.CurrentX = 0;
        _player.CurrentY = 1;
        _player.Rotation = 0;
        _stage.SetCell(1, 1, 1); // å³å´ã«ã·ã‚ˆã‚’é…ç½®ï¼ˆå£ã‚­ãƒƒã‚¯å…ˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ï¼‰

        // Act
        _player.RotateLeft(_stage);

        // Assert
        Assert.Equal(0, _player.Rotation); // å›è»¢ã—ã¦ã„ãªã„
        Assert.Equal(0, _player.CurrentX); // ç§»å‹•ã—ã¦ã„ãªã„
    }

    [Fact]
    public void å­ã·ã‚ˆã®ä½ç½®ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹()
    {
        // Arrange & Act
        _player.CurrentX = 3;
        _player.CurrentY = 5;
        
        // å„å›è»¢çŠ¶æ…‹ã§å­ã·ã‚ˆã®ä½ç½®ã‚’ç¢ºèª
        _player.Rotation = 0;
        var (x0, y0) = _player.GetChildPosition();
        Assert.Equal((3, 4), (x0, y0)); // ä¸Š
        
        _player.Rotation = 1;
        var (x1, y1) = _player.GetChildPosition();
        Assert.Equal((4, 5), (x1, y1)); // å³
        
        _player.Rotation = 2;
        var (x2, y2) = _player.GetChildPosition();
        Assert.Equal((3, 6), (x2, y2)); // ä¸‹
        
        _player.Rotation = 3;
        var (x3, y3) = _player.GetChildPosition();
        Assert.Equal((2, 5), (x3, y3)); // å·¦
    }
}
EOF
```

ã€Œå£ã‚­ãƒƒã‚¯ã®å‹•ä½œã‚’ç´°ã‹ããƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚ç‰¹ã«é‡è¦ãªã®ã¯ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã§ã™ï¼š

1. **éšœå®³ç‰©ãŒã‚ã‚‹å ´åˆ**: å›è»¢ã§ããªã„
2. **å·¦ç«¯ã§ã®å›è»¢**: å³ã«ãšã‚Œã¦å›è»¢ï¼ˆå£ã‚­ãƒƒã‚¯ï¼‰
3. **å³ç«¯ã§ã®å›è»¢**: å·¦ã«ãšã‚Œã¦å›è»¢ï¼ˆå£ã‚­ãƒƒã‚¯ï¼‰
4. **å£ã‚­ãƒƒã‚¯ã‚‚ã§ããªã„å ´åˆ**: å›è»¢ã—ãªã„

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€å®Œç’§ã§ã™ï¼

```bash
git add .
git commit -m 'test: å›è»¢ã®åˆ¶ç´„ã¨å£ã‚­ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
```

### ViewModelã¸ã®å›è»¢å‡¦ç†ã®çµ±åˆ

æ¬¡ã«ã€ViewModelã«å›è»¢å‡¦ç†ã‚’çµ±åˆã—ã¾ã—ã‚‡ã†ã€‚

```bash
cat > PuyoPuyoWPF/ViewModels/GameViewModel.cs << 'EOF'
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using PuyoPuyoWPF.Models;
using System.Windows.Input;

namespace PuyoPuyoWPF.ViewModels;

public partial class GameViewModel : ObservableObject
{
    [ObservableProperty]
    private Game _game;

    public GameViewModel()
    {
        _game = new Game();
        InitializeGame();
    }

    public void InitializeGame()
    {
        Game.Initialize();
        OnPropertyChanged(nameof(Game));
    }

    [RelayCommand]
    private void Start()
    {
        Game.Start();
        OnPropertyChanged(nameof(Game));
    }

    [RelayCommand]
    private void Reset()
    {
        InitializeGame();
    }

    public void HandleKeyDown(Key key)
    {
        if (Game.Mode != GameMode.Playing)
            return;

        switch (key)
        {
            case Key.Left:
                Game.Player?.SetInputLeft(true);
                Game.Player?.MoveLeft(Game.Stage!);
                break;
            case Key.Right:
                Game.Player?.SetInputRight(true);
                Game.Player?.MoveRight(Game.Stage!);
                break;
            case Key.Up:
            case Key.Z:
                Game.Player?.SetInputRotateLeft(true);
                Game.Player?.RotateLeft(Game.Stage!);
                break;
            case Key.X:
            case Key.Space:
                Game.Player?.SetInputRotateRight(true);
                Game.Player?.RotateRight(Game.Stage!);
                break;
        }

        OnPropertyChanged(nameof(Game));
    }

    public void HandleKeyUp(Key key)
    {
        switch (key)
        {
            case Key.Left:
                Game.Player?.SetInputLeft(false);
                break;
            case Key.Right:
                Game.Player?.SetInputRight(false);
                break;
            case Key.Up:
            case Key.Z:
                Game.Player?.SetInputRotateLeft(false);
                break;
            case Key.X:
            case Key.Space:
                Game.Player?.SetInputRotateRight(false);
                break;
        }
    }
}
EOF
```

ã€Œå›è»¢ã®ã‚­ãƒ¼ãŒè¤‡æ•°ã‚ã‚Šã¾ã™ã­ï¼ã€ãã†ã§ã™ã€‚ã‚ˆã‚ŠæŸ”è»Ÿãªæ“ä½œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚­ãƒ¼ã§å›è»¢ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸï¼š

- **åæ™‚è¨ˆå›ã‚Š**: â†‘ã‚­ãƒ¼ ã¾ãŸã¯ Zã‚­ãƒ¼
- **æ™‚è¨ˆå›ã‚Š**: Xã‚­ãƒ¼ ã¾ãŸã¯ ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼

### ViewModelã®ãƒ†ã‚¹ãƒˆæ›´æ–°

ViewModelã®ãƒ†ã‚¹ãƒˆã‚‚æ›´æ–°ã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat > PuyoPuyoWPF.Tests/ViewModels/GameViewModelTest.cs << 'EOF'
using Xunit;
using PuyoPuyoWPF.ViewModels;
using PuyoPuyoWPF.Models;
using System.Windows.Input;

namespace PuyoPuyoWPF.Tests.ViewModels;

public class GameViewModelTest
{
    [Fact]
    public void ViewModelã‚’åˆæœŸåŒ–ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹()
    {
        // Arrange & Act
        var viewModel = new GameViewModel();

        // Assert
        Assert.NotNull(viewModel.Game);
        Assert.Equal(GameMode.Start, viewModel.Game.Mode);
    }

    [Fact]
    public void Startã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();

        // Act
        viewModel.StartCommand.Execute(null);

        // Assert
        Assert.Equal(GameMode.Playing, viewModel.Game.Mode);
    }

    [Fact]
    public void å·¦ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒå·¦ã«ç§»å‹•ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        int initialX = viewModel.Game.Player!.CurrentX;

        // Act
        viewModel.HandleKeyDown(Key.Left);

        // Assert
        Assert.Equal(initialX - 1, viewModel.Game.Player.CurrentX);
    }

    [Fact]
    public void å³ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒå³ã«ç§»å‹•ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        int initialX = viewModel.Game.Player!.CurrentX;

        // Act
        viewModel.HandleKeyDown(Key.Right);

        // Assert
        Assert.Equal(initialX + 1, viewModel.Game.Player.CurrentX);
    }

    [Fact]
    public void Zã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒåæ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        viewModel.Game.Player!.Rotation = 1;

        // Act
        viewModel.HandleKeyDown(Key.Z);

        // Assert
        Assert.Equal(0, viewModel.Game.Player.Rotation);
    }

    [Fact]
    public void Xã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒæ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        int initialRotation = viewModel.Game.Player!.Rotation;

        // Act
        viewModel.HandleKeyDown(Key.X);

        // Assert
        Assert.Equal((initialRotation + 1) % 4, viewModel.Game.Player.Rotation);
    }

    [Fact]
    public void ã‚²ãƒ¼ãƒ ãŒPlayingçŠ¶æ…‹ã§ãªã„ã¨ãã¯ã‚­ãƒ¼å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ãªã„()
    {
        // Arrange
        var viewModel = new GameViewModel();
        // StartçŠ¶æ…‹ã®ã¾ã¾ï¼ˆPlayingçŠ¶æ…‹ã«ã—ãªã„ï¼‰
        int initialX = viewModel.Game.Player!.CurrentX;
        int initialRotation = viewModel.Game.Player.Rotation;

        // Act
        viewModel.HandleKeyDown(Key.Left);
        viewModel.HandleKeyDown(Key.Z);

        // Assert
        Assert.Equal(initialX, viewModel.Game.Player.CurrentX); // ç§»å‹•ã—ã¦ã„ãªã„
        Assert.Equal(initialRotation, viewModel.Game.Player.Rotation); // å›è»¢ã—ã¦ã„ãªã„
    }
}
EOF
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

```bash
git add .
git commit -m 'feat: ViewModelã«å›è»¢å‡¦ç†ã‚’çµ±åˆ'
```

### Viewã®æ›´æ–°

æœ€å¾Œã«ã€MainWindow.xamlã‚’æ›´æ–°ã—ã¦ã€æ“ä½œæ–¹æ³•ã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat > PuyoPuyoWPF/MainWindow.xaml << 'EOF'
<Window x:Class="PuyoPuyoWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewmodels="clr-namespace:PuyoPuyoWPF.ViewModels"
        mc:Ignorable="d"
        Title="ã·ã‚ˆã·ã‚ˆ TDD" Height="650" Width="400"
        KeyDown="Window_KeyDown"
        KeyUp="Window_KeyUp"
        Focusable="True">
    <Window.DataContext>
        <viewmodels:GameViewModel />
    </Window.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
        <StackPanel Grid.Row="0" Margin="10">
            <TextBlock Text="{Binding Game.Score.CurrentScore, StringFormat='ã‚¹ã‚³ã‚¢: {0}'}" 
                       FontSize="20" FontWeight="Bold"/>
            <TextBlock Text="{Binding Game.Score.ChainCount, StringFormat='ãƒã‚§ãƒ¼ãƒ³: {0}'}" 
                       FontSize="16"/>
            <TextBlock Text="{Binding Game.Mode, StringFormat='ãƒ¢ãƒ¼ãƒ‰: {0}'}" 
                       FontSize="14" Foreground="Gray"/>
        </StackPanel>
        
        <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
        <Border Grid.Row="1" BorderBrush="Black" BorderThickness="2" Margin="10">
            <Canvas Background="White">
                <TextBlock Canvas.Left="80" Canvas.Top="180" 
                           FontSize="24" Text="ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢"/>
                <TextBlock Canvas.Left="50" Canvas.Top="220" 
                           FontSize="12" Text="â† â†’ : ç§»å‹•"/>
                <TextBlock Canvas.Left="50" Canvas.Top="240" 
                           FontSize="12" Text="Z / â†‘ : åæ™‚è¨ˆå›ã‚Šå›è»¢"/>
                <TextBlock Canvas.Left="50" Canvas.Top="260" 
                           FontSize="12" Text="X / Space : æ™‚è¨ˆå›ã‚Šå›è»¢"/>
            </Canvas>
        </Border>
        
        <!-- ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" 
                    HorizontalAlignment="Center" Margin="10">
            <Button Content="ã‚¹ã‚¿ãƒ¼ãƒˆ" Command="{Binding StartCommand}" 
                    Width="100" Height="40" Margin="5"/>
            <Button Content="ãƒªã‚»ãƒƒãƒˆ" Command="{Binding ResetCommand}" 
                    Width="100" Height="40" Margin="5"/>
        </StackPanel>
        
        <!-- æ“ä½œèª¬æ˜ -->
        <Border Grid.Row="3" Background="LightGray" Padding="10" Margin="10,0,10,10">
            <TextBlock TextWrapping="Wrap" FontSize="11">
                <Run Text="æ“ä½œæ–¹æ³•: "/>
                <Run Text="â† â†’ ã§ç§»å‹•ã€"/>
                <Run Text="Z / â†‘ ã§åæ™‚è¨ˆå›ã‚Šå›è»¢ã€"/>
                <Run Text="X / Space ã§æ™‚è¨ˆå›ã‚Šå›è»¢"/>
            </TextBlock>
        </Border>
    </Grid>
</Window>
EOF
```

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Quality
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã£ã¦ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚‚è‰¯å¥½ã§ã™ã­ï¼ã€å®Œç’§ã§ã™ï¼

```bash
git add .
git commit -m 'feat: å›è»¢æ©Ÿèƒ½ã®æ“ä½œèª¬æ˜ã‚’UIã«è¿½åŠ '
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³3ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å®Ÿç¾ã—ã¾ã—ãŸï¼š

1. **å›è»¢å‡¦ç†**: æ™‚è¨ˆå›ã‚Šãƒ»åæ™‚è¨ˆå›ã‚Šã®å›è»¢æ©Ÿèƒ½
2. **å›è»¢åˆ¶ç´„**: éšœå®³ç‰©ã‚„å£ã«ã‚ˆã‚‹å›è»¢åˆ¶é™
3. **å£ã‚­ãƒƒã‚¯**: å£éš›ã§ã®å›è»¢è£œæ­£æ©Ÿèƒ½
4. **å­ã·ã‚ˆã®ä½ç½®è¨ˆç®—**: å›è»¢çŠ¶æ…‹ã«å¿œã˜ãŸç›¸å¯¾ä½ç½®ã®è¨ˆç®—
5. **è¤‡æ•°ã‚­ãƒ¼å¯¾å¿œ**: ã‚ˆã‚ŠæŸ”è»Ÿãªæ“ä½œæ€§ã®å®Ÿç¾

**å­¦ã‚“ã ã“ã¨**:
- å›è»¢ã®æ•°å­¦çš„ãªå®Ÿè£…ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ­æ¼”ç®—ï¼‰
- å£ã‚­ãƒƒã‚¯ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- å¢ƒç•Œæ¡ä»¶ã®è¤‡é›‘ãªãƒ†ã‚¹ãƒˆ
- ã‚²ãƒ¼ãƒ ç‰¹æœ‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

**å£ã‚­ãƒƒã‚¯ã®é‡è¦æ€§**:
å£ã‚­ãƒƒã‚¯ã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ„å›³ã‚’æ±²ã¿å–ã‚‹é‡è¦ãªæ©Ÿèƒ½ã§ã™ã€‚ã€Œå£éš›ã§å›è»¢ã—ã‚ˆã†ã¨ã—ãŸâ†’ã§ããªã‹ã£ãŸã€ã§ã¯ãªãã€ã€Œå°‘ã—ãšã‚‰ã›ã°å›è»¢ã§ãã‚‹â†’è‡ªå‹•çš„ã«ãšã‚‰ã—ã¦å›è»¢ã™ã‚‹ã€ã¨ã„ã†å‹•ä½œã«ã‚ˆã‚Šã€ãƒ—ãƒ¬ã‚¤ã®å¿«é©ã•ãŒå¤§ããå‘ä¸Šã—ã¾ã™ã€‚

æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ã·ã‚ˆã®è½ä¸‹ã¨é«˜é€Ÿè½ä¸‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã‚ˆï¼

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³4: ã·ã‚ˆã®é«˜é€Ÿè½ä¸‹ã®å®Ÿè£…

ã€Œå›è»¢ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‘ã©ã€ã·ã‚ˆã·ã‚ˆã£ã¦ã‚‚ã£ã¨æ—©ãè½ã¨ã›ãŸã‚ˆã­ï¼Ÿã€ãã†ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã§ã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒä¸‹ã‚­ãƒ¼ã‚’æŠ¼ã™ã“ã¨ã§ã€ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»Šå›ã¯ã€ãã®ã€Œé«˜é€Ÿè½ä¸‹ã€ã¨åŸºæœ¬çš„ãªã€Œè‡ªå‹•è½ä¸‹ã€æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹

ã€Œæ—©ãæ¬¡ã®ã·ã‚ˆã‚’è½ã¨ã—ãŸã„ï¼ã€ã¨ã„ã†ã¨ãã«ã€ä¸‹ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹æ©Ÿèƒ½ã¯ã€ã‚²ãƒ¼ãƒ ã®ãƒ†ãƒ³ãƒã‚’è‰¯ãã™ã‚‹ãŸã‚ã«é‡è¦ã§ã™ã­ã€‚

### TODOãƒªã‚¹ãƒˆ

ã€Œã©ã‚“ãªä½œæ¥­ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã‹ï¼Ÿã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€å®Ÿè£…å‰ã«å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºã®æ–¹å‘æ€§ã‚’ä¿ã¡ã€ä½•ã‚‚è¦‹è½ã¨ã•ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã€Œã·ã‚ˆã‚’ç´ æ—©ãè½ä¸‹ã•ã›ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- ä¸‹ã‚­ãƒ¼å…¥åŠ›ã®æ¤œå‡ºã‚’å®Ÿè£…ã™ã‚‹ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ä¸‹ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹ï¼‰
- é«˜é€Ÿè½ä¸‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆä¸‹ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ã¨ãã¯è½ä¸‹é€Ÿåº¦ã‚’ä¸Šã’ã‚‹ï¼‰
- è½ä¸‹å¯èƒ½ã‹ã©ã†ã‹ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆä¸‹ã«éšœå®³ç‰©ãŒã‚ã‚‹å ´åˆã¯è½ä¸‹ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰
- è‡ªå‹•è½ä¸‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ™‚é–“çµŒéã§è‡ªå‹•çš„ã«ä¸‹ã«ç§»å‹•ã™ã‚‹ï¼‰

### ãƒ†ã‚¹ãƒˆ: è½ä¸‹å‡¦ç†

ã€Œæœ€åˆã«ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚Œã°ã„ã„ã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€ã¾ãšã¯ã€ã·ã‚ˆãŒä¸‹ã«ç§»å‹•ã§ãã‚‹ã‹ã©ã†ã‹ã€ãã—ã¦éšœå®³ç‰©ãŒã‚ã‚‹å ´åˆã¯ç§»å‹•ã§ããªã„ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```bash
cat >> PuyoPuyoWPF.Tests/Models/PlayerTest.cs << 'EOF'

    [Fact]
    public void ä¸‹ã‚­ãƒ¼ã®å…¥åŠ›ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã§ãã‚‹()
    {
        // Act
        _player.SetInputDown(true);

        // Assert
        Assert.True(_player.InputKeyDown);
    }

    [Fact]
    public void ä¸‹ã«ç§»å‹•ã§ãã‚‹å ´åˆä¸‹ã«ç§»å‹•ã™ã‚‹()
    {
        // Arrange
        int initialY = _player.CurrentY;

        // Act
        bool moved = _player.MoveDown(_stage);

        // Assert
        Assert.True(moved);
        Assert.Equal(initialY + 1, _player.CurrentY);
    }

    [Fact]
    public void ä¸‹ç«¯ã§ã¯ä¸‹ã«ç§»å‹•ã§ããªã„()
    {
        // Arrange
        _player.CurrentY = _config.StageHeight - 1;

        // Act
        bool moved = _player.MoveDown(_stage);

        // Assert
        Assert.False(moved);
        Assert.Equal(_config.StageHeight - 1, _player.CurrentY);
    }

    [Fact]
    public void ä¸‹ã«ã·ã‚ˆãŒã‚ã‚‹å ´åˆä¸‹ã«ç§»å‹•ã§ããªã„()
    {
        // Arrange
        _player.CurrentY = 5;
        _stage.SetCell(_player.CurrentX, _player.CurrentY + 1, 1);

        // Act
        bool moved = _player.MoveDown(_stage);

        // Assert
        Assert.False(moved);
        Assert.Equal(5, _player.CurrentY);
    }

    [Fact]
    public void é«˜é€Ÿè½ä¸‹ãƒ•ãƒ©ã‚°ã‚’å–å¾—ã§ãã‚‹()
    {
        // Arrange
        _player.SetInputDown(false);
        bool normalSpeed = _player.IsFastDrop;
        
        _player.SetInputDown(true);
        bool fastSpeed = _player.IsFastDrop;

        // Assert
        Assert.False(normalSpeed);
        Assert.True(fastSpeed);
    }
}
EOF
```

ã€Œè½ä¸‹å‡¦ç†ã‚’ç´°ã‹ããƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚ç‰¹ã«é‡è¦ãªã®ã¯ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã§ã™ï¼š

1. **åŸºæœ¬çš„ãªè½ä¸‹**: ä¸‹ã«ç§»å‹•ã§ãã‚‹
2. **ä¸‹ç«¯ãƒã‚§ãƒƒã‚¯**: ç”»é¢ã®ä¸‹ç«¯ã§ã¯ç§»å‹•ã§ããªã„
3. **è¡çªåˆ¤å®š**: ä¸‹ã«ã·ã‚ˆãŒã‚ã‚‹å ´åˆã¯ç§»å‹•ã§ããªã„
4. **é«˜é€Ÿè½ä¸‹ãƒ•ãƒ©ã‚°**: ä¸‹ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’åˆ¤å®š

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã­ã€ãã†ã§ã™ã€ã¾ã å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚

### å®Ÿè£…: è½ä¸‹å‡¦ç†

ãã‚Œã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«è½ä¸‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚

```bash
cat > PuyoPuyoWPF/Models/Player.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Player
{
    public int CurrentX { get; set; }
    public int CurrentY { get; set; }
    public int Rotation { get; set; }
    public bool InputKeyLeft { get; private set; }
    public bool InputKeyRight { get; private set; }
    public bool InputKeyRotateLeft { get; private set; }
    public bool InputKeyRotateRight { get; private set; }
    public bool InputKeyDown { get; private set; }
    
    public bool IsFastDrop => InputKeyDown;
    
    public Player()
    {
        CurrentX = 2; // åˆæœŸä½ç½®ï¼ˆä¸­å¤®ï¼‰
        CurrentY = 0; // åˆæœŸä½ç½®ï¼ˆä¸Šç«¯ï¼‰
        Rotation = 0; // åˆæœŸå›è»¢çŠ¶æ…‹ï¼ˆä¸Šï¼‰
    }

    public void Reset()
    {
        CurrentX = 2;
        CurrentY = 0;
        Rotation = 0;
        InputKeyLeft = false;
        InputKeyRight = false;
        InputKeyRotateLeft = false;
        InputKeyRotateRight = false;
        InputKeyDown = false;
    }

    public void SetInputLeft(bool isPressed)
    {
        InputKeyLeft = isPressed;
    }

    public void SetInputRight(bool isPressed)
    {
        InputKeyRight = isPressed;
    }

    public void SetInputRotateLeft(bool isPressed)
    {
        InputKeyRotateLeft = isPressed;
    }

    public void SetInputRotateRight(bool isPressed)
    {
        InputKeyRotateRight = isPressed;
    }

    public void SetInputDown(bool isPressed)
    {
        InputKeyDown = isPressed;
    }

    public void MoveLeft(Stage stage)
    {
        if (CanMove(CurrentX - 1, CurrentY, stage))
        {
            CurrentX--;
        }
    }

    public void MoveRight(Stage stage)
    {
        if (CanMove(CurrentX + 1, CurrentY, stage))
        {
            CurrentX++;
        }
    }

    public bool MoveDown(Stage stage)
    {
        if (CanMove(CurrentX, CurrentY + 1, stage))
        {
            CurrentY++;
            return true;
        }
        return false;
    }

    public void RotateRight(Stage stage)
    {
        int newRotation = (Rotation + 1) % 4;
        
        if (CanRotate(CurrentX, CurrentY, newRotation, stage))
        {
            Rotation = newRotation;
        }
        else if (TryWallKick(newRotation, stage))
        {
            // å£ã‚­ãƒƒã‚¯ãŒæˆåŠŸã—ãŸå ´åˆã€ä½ç½®ã¨å›è»¢ãŒèª¿æ•´ã•ã‚Œã‚‹
        }
    }

    public void RotateLeft(Stage stage)
    {
        int newRotation = (Rotation - 1 + 4) % 4;
        
        if (CanRotate(CurrentX, CurrentY, newRotation, stage))
        {
            Rotation = newRotation;
        }
        else if (TryWallKick(newRotation, stage))
        {
            // å£ã‚­ãƒƒã‚¯ãŒæˆåŠŸã—ãŸå ´åˆã€ä½ç½®ã¨å›è»¢ãŒèª¿æ•´ã•ã‚Œã‚‹
        }
    }

    private bool CanMove(int x, int y, Stage stage)
    {
        // ç”»é¢ã®ç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯
        if (x < 0 || x >= stage.Width || y < 0 || y >= stage.Height)
        {
            return false;
        }

        // ãã®ä½ç½®ã«ã™ã§ã«ã·ã‚ˆãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        return stage.GetCell(x, y) == 0;
    }

    private bool CanRotate(int x, int y, int rotation, Stage stage)
    {
        // è»¸ã·ã‚ˆã®ä½ç½®ã‚’ãƒã‚§ãƒƒã‚¯
        if (!CanMove(x, y, stage))
        {
            return false;
        }

        // å­ã·ã‚ˆã®ä½ç½®ã‚’ãƒã‚§ãƒƒã‚¯
        var (childX, childY) = GetChildPosition(x, y, rotation);
        
        if (childX < 0 || childX >= stage.Width || childY < 0 || childY >= stage.Height)
        {
            return false;
        }

        return stage.GetCell(childX, childY) == 0;
    }

    private bool TryWallKick(int newRotation, Stage stage)
    {
        // å£ã‚­ãƒƒã‚¯: å·¦ã«1ãƒã‚¹
        if (CanRotate(CurrentX - 1, CurrentY, newRotation, stage))
        {
            CurrentX--;
            Rotation = newRotation;
            return true;
        }

        // å£ã‚­ãƒƒã‚¯: å³ã«1ãƒã‚¹
        if (CanRotate(CurrentX + 1, CurrentY, newRotation, stage))
        {
            CurrentX++;
            Rotation = newRotation;
            return true;
        }

        return false;
    }

    private (int x, int y) GetChildPosition(int parentX, int parentY, int rotation)
    {
        return rotation switch
        {
            0 => (parentX, parentY - 1), // ä¸Š
            1 => (parentX + 1, parentY), // å³
            2 => (parentX, parentY + 1), // ä¸‹
            3 => (parentX - 1, parentY), // å·¦
            _ => (parentX, parentY)
        };
    }

    public (int x, int y) GetChildPosition()
    {
        return GetChildPosition(CurrentX, CurrentY, Rotation);
    }
}
EOF
```

ã€Œ`MoveDown`ãƒ¡ã‚½ãƒƒãƒ‰ãŒ`bool`ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã­ï¼ã€ãã†ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã·ã‚ˆãŒå®Ÿéš›ã«ä¸‹ã«ç§»å‹•ã§ããŸã‹ã©ã†ã‹ã‚’åˆ¤å®šã§ãã¾ã™ã€‚ç§»å‹•ã§ããªã‹ã£ãŸå ´åˆï¼ˆä¸‹ç«¯ã‚„éšœå®³ç‰©ãŒã‚ã‚‹å ´åˆï¼‰ã¯`false`ã‚’è¿”ã™ã®ã§ã€ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã·ã‚ˆã‚’å›ºå®šã™ã‚‹å‡¦ç†ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

```bash
git add .
git commit -m 'feat: ã·ã‚ˆã®è½ä¸‹å‡¦ç†ã‚’å®Ÿè£…'
```

### ViewModelã¸ã®è½ä¸‹å‡¦ç†ã®çµ±åˆ

æ¬¡ã«ã€ViewModelã«ä¸‹ã‚­ãƒ¼å…¥åŠ›ã¨è½ä¸‹å‡¦ç†ã‚’çµ±åˆã—ã¾ã—ã‚‡ã†ã€‚

```bash
cat > PuyoPuyoWPF/ViewModels/GameViewModel.cs << 'EOF'
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using PuyoPuyoWPF.Models;
using System.Windows.Input;

namespace PuyoPuyoWPF.ViewModels;

public partial class GameViewModel : ObservableObject
{
    [ObservableProperty]
    private Game _game;

    public GameViewModel()
    {
        _game = new Game();
        InitializeGame();
    }

    public void InitializeGame()
    {
        Game.Initialize();
        OnPropertyChanged(nameof(Game));
    }

    [RelayCommand]
    private void Start()
    {
        Game.Start();
        OnPropertyChanged(nameof(Game));
    }

    [RelayCommand]
    private void Reset()
    {
        InitializeGame();
    }

    public void HandleKeyDown(Key key)
    {
        if (Game.Mode != GameMode.Playing)
            return;

        switch (key)
        {
            case Key.Left:
                Game.Player?.SetInputLeft(true);
                Game.Player?.MoveLeft(Game.Stage!);
                break;
            case Key.Right:
                Game.Player?.SetInputRight(true);
                Game.Player?.MoveRight(Game.Stage!);
                break;
            case Key.Up:
            case Key.Z:
                Game.Player?.SetInputRotateLeft(true);
                Game.Player?.RotateLeft(Game.Stage!);
                break;
            case Key.X:
            case Key.Space:
                Game.Player?.SetInputRotateRight(true);
                Game.Player?.RotateRight(Game.Stage!);
                break;
            case Key.Down:
                Game.Player?.SetInputDown(true);
                // é«˜é€Ÿè½ä¸‹ã®å ´åˆã¯é€£ç¶šã§è½ä¸‹
                while (Game.Player?.MoveDown(Game.Stage!) == true)
                {
                    // è½ä¸‹ã§ãã‚‹é™ã‚Šè½ä¸‹ã—ç¶šã‘ã‚‹
                }
                break;
        }

        OnPropertyChanged(nameof(Game));
    }

    public void HandleKeyUp(Key key)
    {
        switch (key)
        {
            case Key.Left:
                Game.Player?.SetInputLeft(false);
                break;
            case Key.Right:
                Game.Player?.SetInputRight(false);
                break;
            case Key.Up:
            case Key.Z:
                Game.Player?.SetInputRotateLeft(false);
                break;
            case Key.X:
            case Key.Space:
                Game.Player?.SetInputRotateRight(false);
                break;
            case Key.Down:
                Game.Player?.SetInputDown(false);
                break;
        }
    }
}
EOF
```

ã€Œä¸‹ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ä¸€æ°—ã«è½ä¸‹ã™ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚`while`ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ã£ã¦ã€ç§»å‹•ã§ããªããªã‚‹ã¾ã§ï¼ˆç€åœ°ã™ã‚‹ã¾ã§ï¼‰é€£ç¶šã§ä¸‹ã«ç§»å‹•ã•ã›ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã„ã‚ã‚†ã‚‹ã€Œãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã€ã®æ©Ÿèƒ½ãŒå®Ÿç¾ã§ãã¾ã™ã€‚

### ViewModelã®ãƒ†ã‚¹ãƒˆæ›´æ–°

ViewModelã®ãƒ†ã‚¹ãƒˆã‚‚æ›´æ–°ã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat > PuyoPuyoWPF.Tests/ViewModels/GameViewModelTest.cs << 'EOF'
using Xunit;
using PuyoPuyoWPF.ViewModels;
using PuyoPuyoWPF.Models;
using System.Windows.Input;

namespace PuyoPuyoWPF.Tests.ViewModels;

public class GameViewModelTest
{
    [Fact]
    public void ViewModelã‚’åˆæœŸåŒ–ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹()
    {
        // Arrange & Act
        var viewModel = new GameViewModel();

        // Assert
        Assert.NotNull(viewModel.Game);
        Assert.Equal(GameMode.Start, viewModel.Game.Mode);
    }

    [Fact]
    public void Startã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();

        // Act
        viewModel.StartCommand.Execute(null);

        // Assert
        Assert.Equal(GameMode.Playing, viewModel.Game.Mode);
    }

    [Fact]
    public void å·¦ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒå·¦ã«ç§»å‹•ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        int initialX = viewModel.Game.Player!.CurrentX;

        // Act
        viewModel.HandleKeyDown(Key.Left);

        // Assert
        Assert.Equal(initialX - 1, viewModel.Game.Player.CurrentX);
    }

    [Fact]
    public void å³ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒå³ã«ç§»å‹•ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        int initialX = viewModel.Game.Player!.CurrentX;

        // Act
        viewModel.HandleKeyDown(Key.Right);

        // Assert
        Assert.Equal(initialX + 1, viewModel.Game.Player.CurrentX);
    }

    [Fact]
    public void Zã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒåæ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        viewModel.Game.Player!.Rotation = 1;

        // Act
        viewModel.HandleKeyDown(Key.Z);

        // Assert
        Assert.Equal(0, viewModel.Game.Player.Rotation);
    }

    [Fact]
    public void Xã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒæ™‚è¨ˆå›ã‚Šã«å›è»¢ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        int initialRotation = viewModel.Game.Player!.Rotation;

        // Act
        viewModel.HandleKeyDown(Key.X);

        // Assert
        Assert.Equal((initialRotation + 1) % 4, viewModel.Game.Player.Rotation);
    }

    [Fact]
    public void ä¸‹ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã·ã‚ˆãŒæœ€ä¸‹ç«¯ã¾ã§è½ä¸‹ã™ã‚‹()
    {
        // Arrange
        var viewModel = new GameViewModel();
        viewModel.Start();
        var config = viewModel.Game.Config!;

        // Act
        viewModel.HandleKeyDown(Key.Down);

        // Assert
        // æœ€ä¸‹ç«¯ï¼ˆã¾ãŸã¯ãã‚Œã«è¿‘ã„ä½ç½®ï¼‰ã«åˆ°é”ã—ã¦ã„ã‚‹
        Assert.True(viewModel.Game.Player!.CurrentY >= config.StageHeight - 2);
    }

    [Fact]
    public void ã‚²ãƒ¼ãƒ ãŒPlayingçŠ¶æ…‹ã§ãªã„ã¨ãã¯ã‚­ãƒ¼å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ãªã„()
    {
        // Arrange
        var viewModel = new GameViewModel();
        // StartçŠ¶æ…‹ã®ã¾ã¾ï¼ˆPlayingçŠ¶æ…‹ã«ã—ãªã„ï¼‰
        int initialX = viewModel.Game.Player!.CurrentX;
        int initialY = viewModel.Game.Player.CurrentY;
        int initialRotation = viewModel.Game.Player.Rotation;

        // Act
        viewModel.HandleKeyDown(Key.Left);
        viewModel.HandleKeyDown(Key.Down);
        viewModel.HandleKeyDown(Key.Z);

        // Assert
        Assert.Equal(initialX, viewModel.Game.Player.CurrentX); // ç§»å‹•ã—ã¦ã„ãªã„
        Assert.Equal(initialY, viewModel.Game.Player.CurrentY); // è½ä¸‹ã—ã¦ã„ãªã„
        Assert.Equal(initialRotation, viewModel.Game.Player.Rotation); // å›è»¢ã—ã¦ã„ãªã„
    }
}
EOF
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€å®Œç’§ã§ã™ï¼

```bash
git add .
git commit -m 'feat: ViewModelã«é«˜é€Ÿè½ä¸‹å‡¦ç†ã‚’çµ±åˆ'
```

### Viewã®æ›´æ–°

æœ€å¾Œã«ã€MainWindow.xamlã‚’æ›´æ–°ã—ã¦ã€ä¸‹ã‚­ãƒ¼ã®æ“ä½œæ–¹æ³•ã‚’è¡¨ç¤ºã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat > PuyoPuyoWPF/MainWindow.xaml << 'EOF'
<Window x:Class="PuyoPuyoWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewmodels="clr-namespace:PuyoPuyoWPF.ViewModels"
        mc:Ignorable="d"
        Title="ã·ã‚ˆã·ã‚ˆ TDD" Height="650" Width="400"
        KeyDown="Window_KeyDown"
        KeyUp="Window_KeyUp"
        Focusable="True">
    <Window.DataContext>
        <viewmodels:GameViewModel />
    </Window.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
        <StackPanel Grid.Row="0" Margin="10">
            <TextBlock Text="{Binding Game.Score.CurrentScore, StringFormat='ã‚¹ã‚³ã‚¢: {0}'}" 
                       FontSize="20" FontWeight="Bold"/>
            <TextBlock Text="{Binding Game.Score.ChainCount, StringFormat='ãƒã‚§ãƒ¼ãƒ³: {0}'}" 
                       FontSize="16"/>
            <TextBlock Text="{Binding Game.Mode, StringFormat='ãƒ¢ãƒ¼ãƒ‰: {0}'}" 
                       FontSize="14" Foreground="Gray"/>
        </StackPanel>
        
        <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
        <Border Grid.Row="1" BorderBrush="Black" BorderThickness="2" Margin="10">
            <Canvas Background="White">
                <TextBlock Canvas.Left="80" Canvas.Top="160" 
                           FontSize="24" Text="ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢"/>
                <TextBlock Canvas.Left="50" Canvas.Top="200" 
                           FontSize="12" Text="â† â†’ : ç§»å‹•"/>
                <TextBlock Canvas.Left="50" Canvas.Top="220" 
                           FontSize="12" Text="Z / â†‘ : åæ™‚è¨ˆå›ã‚Šå›è»¢"/>
                <TextBlock Canvas.Left="50" Canvas.Top="240" 
                           FontSize="12" Text="X / Space : æ™‚è¨ˆå›ã‚Šå›è»¢"/>
                <TextBlock Canvas.Left="50" Canvas.Top="260" 
                           FontSize="12" Text="â†“ : é«˜é€Ÿè½ä¸‹"/>
            </Canvas>
        </Border>
        
        <!-- ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" 
                    HorizontalAlignment="Center" Margin="10">
            <Button Content="ã‚¹ã‚¿ãƒ¼ãƒˆ" Command="{Binding StartCommand}" 
                    Width="100" Height="40" Margin="5"/>
            <Button Content="ãƒªã‚»ãƒƒãƒˆ" Command="{Binding ResetCommand}" 
                    Width="100" Height="40" Margin="5"/>
        </StackPanel>
        
        <!-- æ“ä½œèª¬æ˜ -->
        <Border Grid.Row="3" Background="LightGray" Padding="10" Margin="10,0,10,10">
            <TextBlock TextWrapping="Wrap" FontSize="11">
                <Run Text="æ“ä½œæ–¹æ³•: "/>
                <Run Text="â† â†’ ã§ç§»å‹•ã€"/>
                <Run Text="Z / â†‘ ã§åæ™‚è¨ˆå›ã‚Šå›è»¢ã€"/>
                <Run Text="X / Space ã§æ™‚è¨ˆå›ã‚Šå›è»¢ã€"/>
                <Run Text="â†“ ã§é«˜é€Ÿè½ä¸‹"/>
            </TextBlock>
        </Border>
    </Grid>
</Window>
EOF
```

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Quality
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã£ã¦ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚‚è‰¯å¥½ã§ã™ã­ï¼ã€å®Œç’§ã§ã™ï¼

```bash
git add .
git commit -m 'feat: é«˜é€Ÿè½ä¸‹æ©Ÿèƒ½ã®æ“ä½œèª¬æ˜ã‚’UIã«è¿½åŠ '
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³4ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³4ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å®Ÿç¾ã—ã¾ã—ãŸï¼š

1. **ä¸‹ã‚­ãƒ¼å…¥åŠ›**: ä¸‹ã‚­ãƒ¼ã®å…¥åŠ›æ¤œå‡º
2. **è½ä¸‹å‡¦ç†**: `MoveDown`ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹1ãƒã‚¹ã®è½ä¸‹
3. **è½ä¸‹å¯èƒ½åˆ¤å®š**: ä¸‹ç«¯ã‚„éšœå®³ç‰©ã®ãƒã‚§ãƒƒã‚¯
4. **é«˜é€Ÿè½ä¸‹**: ä¸‹ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ç€åœ°ã¾ã§ä¸€æ°—ã«è½ä¸‹ï¼ˆãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰
5. **æˆ»ã‚Šå€¤ã«ã‚ˆã‚‹çŠ¶æ…‹é€šçŸ¥**: `bool`ã‚’è¿”ã™ã“ã¨ã§ç§»å‹•å¯å¦ã‚’é€šçŸ¥

**å­¦ã‚“ã ã“ã¨**:
- æˆ»ã‚Šå€¤ã‚’ä½¿ã£ãŸçŠ¶æ…‹ã®ä¼é”æ–¹æ³•
- `while`ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ã£ãŸé€£ç¶šå‡¦ç†
- ã‚²ãƒ¼ãƒ ã®ã€Œæ°—æŒã¡ã‚ˆã•ã€ã‚’å®Ÿç¾ã™ã‚‹é«˜é€Ÿè½ä¸‹
- å¢ƒç•Œæ¡ä»¶ã®é‡è¦æ€§ï¼ˆä¸‹ç«¯ãƒã‚§ãƒƒã‚¯ï¼‰

**é«˜é€Ÿè½ä¸‹ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**:
ä»Šå›å®Ÿè£…ã—ãŸé«˜é€Ÿè½ä¸‹ã¯ã€Œãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¨å‘¼ã°ã‚Œã€ç¬æ™‚ã«ç€åœ°ã™ã‚‹æ–¹å¼ã§ã™ã€‚ä»–ã«ã‚‚ã€Œã‚½ãƒ•ãƒˆãƒ‰ãƒ­ãƒƒãƒ—ã€ï¼ˆä¸‹ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã„ã‚‹é–“ã ã‘é€Ÿãè½ã¡ã‚‹ï¼‰ã¨ã„ã†æ–¹å¼ã‚‚ã‚ã‚Šã¾ã™ã€‚ã‚²ãƒ¼ãƒ ã®æ€§è³ªã«å¿œã˜ã¦é¸æŠã§ãã¾ã™ãŒã€ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§çˆ½å¿«æ„Ÿã®ã‚ã‚‹ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
ç¾åœ¨ã€ã·ã‚ˆã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸãŒã€ã¾ã ã·ã‚ˆã‚’æ¶ˆã™æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ã·ã‚ˆã·ã‚ˆã®æ ¸ã¨ãªã‚‹ã€ŒåŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆãˆã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã‚ˆï¼

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³5: ã·ã‚ˆã®æ¶ˆå»ã®å®Ÿè£…

ã€Œã·ã‚ˆãŒè½ã¡ã¦ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‘ã©ã€ã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã¯ã·ã‚ˆã‚’æ¶ˆã™ã“ã¨ã§ã™ã‚ˆã­ï¼Ÿã€ãã†ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã®æœ€ã‚‚é‡è¦ãªè¦ç´ ã®ä¸€ã¤ã¯ã€åŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆå»ã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚ä»Šå›ã¯ã€ãã®ã€Œã·ã‚ˆã®æ¶ˆå»ã€æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€åŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆå»ã§ãã‚‹

ã€Œã“ã‚ŒãŒã·ã‚ˆã·ã‚ˆã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«ã§ã™ã­ï¼ã€ãã†ã§ã™ï¼åŒã˜è‰²ã®ã·ã‚ˆã‚’4ã¤ä»¥ä¸Šã¤ãªã’ã‚‹ã¨æ¶ˆå»ã§ãã‚‹ã¨ã„ã†ã®ãŒã€ã·ã‚ˆã·ã‚ˆã®åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ã§ã™ã€‚

### TODOãƒªã‚¹ãƒˆ

ã€Œã©ã‚“ãªä½œæ¥­ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã‹ï¼Ÿã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€å®Ÿè£…å‰ã«å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºã®æ–¹å‘æ€§ã‚’ä¿ã¡ã€ä½•ã‚‚è¦‹è½ã¨ã•ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã€Œã·ã‚ˆã‚’æ¶ˆå»ã™ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- ã·ã‚ˆã®æ¥ç¶šåˆ¤å®šã‚’å®Ÿè£…ã™ã‚‹ï¼ˆéš£æ¥ã™ã‚‹åŒã˜è‰²ã®ã·ã‚ˆã‚’æ¤œå‡ºã™ã‚‹ï¼‰
- 4ã¤ä»¥ä¸Šã¤ãªãŒã£ãŸã·ã‚ˆã®æ¤œå‡ºã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ¶ˆå»å¯¾è±¡ã¨ãªã‚‹ã·ã‚ˆã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç‰¹å®šã™ã‚‹ï¼‰
- ã·ã‚ˆã®æ¶ˆå»å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ¶ˆå»å¯¾è±¡ã®ã·ã‚ˆã‚’å®Ÿéš›ã«æ¶ˆã™ï¼‰
- æ¶ˆå»å¾Œã®è½ä¸‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆæ¶ˆå»ã•ã‚ŒãŸå¾Œã®ç©ºãã‚¹ãƒšãƒ¼ã‚¹ã«ã·ã‚ˆãŒè½ã¡ã¦ãã‚‹ï¼‰

### ãƒ†ã‚¹ãƒˆ: ã·ã‚ˆã®æ¥ç¶šåˆ¤å®š

ã€Œæœ€åˆã«ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚Œã°ã„ã„ã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€ã¾ãšã¯ã€ã·ã‚ˆã®æ¥ç¶šåˆ¤å®šã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚åŒã˜è‰²ã®ã·ã‚ˆãŒ4ã¤ä»¥ä¸Šã¤ãªãŒã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹æ©Ÿèƒ½ãŒå¿…è¦ã§ã™ã€‚

```bash
mkdir -p PuyoPuyoWPF.Tests/Models
cat > PuyoPuyoWPF.Tests/Models/StageTest.cs << 'EOF'
using Xunit;
using PuyoPuyoWPF.Models;

namespace PuyoPuyoWPF.Tests.Models;

public class StageTest
{
    private readonly Config _config;
    private readonly Stage _stage;

    public StageTest()
    {
        _config = new Config();
        _stage = new Stage(_config.StageWidth, _config.StageHeight);
    }

    [Fact]
    public void åŒã˜è‰²ã®ã·ã‚ˆãŒ4ã¤ã¤ãªãŒã£ã¦ã„ã‚‹ã¨æ¶ˆå»å¯¾è±¡ã«ãªã‚‹()
    {
        // Arrange
        _stage.Clear();
        _stage.SetCell(1, 10, 1);
        _stage.SetCell(2, 10, 1);
        _stage.SetCell(1, 11, 1);
        _stage.SetCell(2, 11, 1);

        // Act
        var eraseInfo = _stage.CheckErase();

        // Assert
        Assert.Equal(4, eraseInfo.ErasePuyoCount);
        Assert.NotEmpty(eraseInfo.EraseList);
    }

    [Fact]
    public void åŒã˜è‰²ã®ã·ã‚ˆãŒ3ã¤ã§ã¯æ¶ˆå»å¯¾è±¡ã«ãªã‚‰ãªã„()
    {
        // Arrange
        _stage.Clear();
        _stage.SetCell(1, 10, 1);
        _stage.SetCell(2, 10, 1);
        _stage.SetCell(1, 11, 1);

        // Act
        var eraseInfo = _stage.CheckErase();

        // Assert
        Assert.Equal(0, eraseInfo.ErasePuyoCount);
        Assert.Empty(eraseInfo.EraseList);
    }

    [Fact]
    public void ç•°ãªã‚‹è‰²ã®ã·ã‚ˆã¯æ¶ˆå»å¯¾è±¡ã«ãªã‚‰ãªã„()
    {
        // Arrange
        _stage.Clear();
        _stage.SetCell(1, 10, 1);
        _stage.SetCell(2, 10, 2);
        _stage.SetCell(1, 11, 2);
        _stage.SetCell(2, 11, 1);

        // Act
        var eraseInfo = _stage.CheckErase();

        // Assert
        Assert.Equal(0, eraseInfo.ErasePuyoCount);
        Assert.Empty(eraseInfo.EraseList);
    }

    [Fact]
    public void ç¸¦ã«5ã¤ã¤ãªãŒã£ã¦ã„ã¦ã‚‚æ¶ˆå»ã§ãã‚‹()
    {
        // Arrange
        _stage.Clear();
        _stage.SetCell(2, 7, 1);
        _stage.SetCell(2, 8, 1);
        _stage.SetCell(2, 9, 1);
        _stage.SetCell(2, 10, 1);
        _stage.SetCell(2, 11, 1);

        // Act
        var eraseInfo = _stage.CheckErase();

        // Assert
        Assert.Equal(5, eraseInfo.ErasePuyoCount);
    }

    [Fact]
    public void Lå­—å‹ã«ã¤ãªãŒã£ã¦ã„ã¦ã‚‚æ¶ˆå»ã§ãã‚‹()
    {
        // Arrange
        _stage.Clear();
        _stage.SetCell(1, 10, 1);
        _stage.SetCell(1, 11, 1);
        _stage.SetCell(2, 11, 1);
        _stage.SetCell(3, 11, 1);

        // Act
        var eraseInfo = _stage.CheckErase();

        // Assert
        Assert.Equal(4, eraseInfo.ErasePuyoCount);
    }
}
EOF
```

ã€Œã„ã‚ã‚“ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚ã·ã‚ˆã®æ¥ç¶šã¯ã€æ¨ªã€ç¸¦ã€Lå­—ãªã©æ§˜ã€…ãªå½¢ãŒã‚ã‚Šå¾—ã¾ã™ã€‚ãã‚Œã‚‰ã‚’ç¶²ç¾…çš„ã«ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ã§ã€ã©ã‚“ãªå½¢ã§ã‚‚æ­£ã—ãåˆ¤å®šã§ãã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã­ã€ãã†ã§ã™ã€ã¾ã `CheckErase`ãƒ¡ã‚½ãƒƒãƒ‰ã‚„`EraseInfo`ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚

### å®Ÿè£…: ã·ã‚ˆã®æ¥ç¶šåˆ¤å®š

ãã‚Œã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«æ¥ç¶šåˆ¤å®šã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã¾ãšã€æ¶ˆå»æƒ…å ±ã‚’è¡¨ã™ãƒ¬ã‚³ãƒ¼ãƒ‰å‹ã¨ã€`Stage`ã‚¯ãƒ©ã‚¹ã®æ‹¡å¼µã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```bash
cat > PuyoPuyoWPF/Models/EraseInfo.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public record EraseInfo(int ErasePuyoCount, List<(int X, int Y, int Type)> EraseList);
EOF
```

æ¬¡ã«ã€`Stage`ã‚¯ãƒ©ã‚¹ã«æ¶ˆå»åˆ¤å®šã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```bash
cat > PuyoPuyoWPF/Models/Stage.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Stage
{
    private readonly int _width;
    private readonly int _height;
    private readonly int[,] _grid;

    public Stage(int width, int height)
    {
        _width = width;
        _height = height;
        _grid = new int[height, width];
    }

    public int Width => _width;
    public int Height => _height;
    
    public int GetCell(int x, int y)
    {
        if (x < 0 || x >= _width || y < 0 || y >= _height)
            return -1;
        return _grid[y, x];
    }

    public void SetCell(int x, int y, int value)
    {
        if (x >= 0 && x < _width && y >= 0 && y < _height)
            _grid[y, x] = value;
    }

    public void Clear()
    {
        for (int y = 0; y < _height; y++)
        {
            for (int x = 0; x < _width; x++)
            {
                _grid[y, x] = 0;
            }
        }
    }

    public EraseInfo CheckErase()
    {
        var eraseList = new List<(int X, int Y, int Type)>();
        var visited = new bool[_height, _width];

        for (int y = 0; y < _height; y++)
        {
            for (int x = 0; x < _width; x++)
            {
                if (_grid[y, x] != 0 && !visited[y, x])
                {
                    var puyoType = _grid[y, x];
                    var connected = new List<(int X, int Y)>();
                    SearchConnectedPuyo(x, y, puyoType, visited, connected);

                    if (connected.Count >= 4)
                    {
                        foreach (var (connX, connY) in connected)
                        {
                            eraseList.Add((connX, connY, puyoType));
                        }
                    }
                }
            }
        }

        return new EraseInfo(eraseList.Count, eraseList);
    }

    private void SearchConnectedPuyo(int startX, int startY, int puyoType, 
        bool[,] visited, List<(int X, int Y)> connected)
    {
        visited[startY, startX] = true;
        connected.Add((startX, startY));

        // 4æ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³ï¼‰ã‚’æ¢ç´¢
        var directions = new[] { (1, 0), (-1, 0), (0, 1), (0, -1) };

        foreach (var (dx, dy) in directions)
        {
            int nextX = startX + dx;
            int nextY = startY + dy;

            if (nextX >= 0 && nextX < _width &&
                nextY >= 0 && nextY < _height &&
                _grid[nextY, nextX] == puyoType &&
                !visited[nextY, nextX])
            {
                SearchConnectedPuyo(nextX, nextY, puyoType, visited, connected);
            }
        }
    }

    public void EraseBoards(List<(int X, int Y, int Type)> eraseList)
    {
        foreach (var (x, y, _) in eraseList)
        {
            if (x >= 0 && x < _width && y >= 0 && y < _height)
            {
                _grid[y, x] = 0;
            }
        }
    }

    public void Fall()
    {
        for (int y = _height - 2; y >= 0; y--)
        {
            for (int x = 0; x < _width; x++)
            {
                if (_grid[y, x] != 0)
                {
                    int fallY = y;
                    while (fallY + 1 < _height && _grid[fallY + 1, x] == 0)
                    {
                        _grid[fallY + 1, x] = _grid[fallY, x];
                        _grid[fallY, x] = 0;
                        fallY++;
                    }
                }
            }
        }
    }
}
EOF
```

ã€Œ`SearchConnectedPuyo`ãƒ¡ã‚½ãƒƒãƒ‰ã¯å†å¸°ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚ã“ã‚Œã¯**æ·±ã•å„ªå…ˆæ¢ç´¢ï¼ˆDFSï¼šDepth-First Searchï¼‰**ã¨ã„ã†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚ã‚ã‚‹ã·ã‚ˆã‹ã‚‰å§‹ã‚ã¦ã€ä¸Šä¸‹å·¦å³ã«éš£æ¥ã™ã‚‹åŒã˜è‰²ã®ã·ã‚ˆã‚’å†å¸°çš„ã«æ¢ç´¢ã—ã¦ã„ãã¾ã™ã€‚

> æ·±ã•å„ªå…ˆæ¢ç´¢ï¼ˆDFSï¼‰
> 
> ã‚°ãƒ©ãƒ•ã‚„æœ¨æ§‹é€ ã‚’æ¢ç´¢ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä¸€ã¤ã€‚ã‚ã‚‹é ‚ç‚¹ã‹ã‚‰å¯èƒ½ãªé™ã‚Šæ·±ãæ¢ç´¢ã‚’é€²ã‚ã€ãã‚Œä»¥ä¸Šé€²ã‚ãªããªã£ãŸã‚‰ä¸€ã¤å‰ã®åˆ†å²ç‚¹ã«æˆ»ã£ã¦æ¢ç´¢ã‚’ç¶šã‘ã‚‹ã€‚
> 
> â€” Thomas H. Cormen ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã€

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼æ¥ç¶šåˆ¤å®šãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

```bash
git add .
git commit -m 'feat: ã·ã‚ˆã®æ¥ç¶šåˆ¤å®šã¨æ¶ˆå»å‡¦ç†ã‚’å®Ÿè£…'
```

### ãƒ†ã‚¹ãƒˆ: æ¶ˆå»å¾Œã®è½ä¸‹å‡¦ç†

æ¬¡ã«ã€æ¶ˆå»å¾Œã®è½ä¸‹å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚ã·ã‚ˆãŒæ¶ˆãˆãŸå¾Œã€ä¸Šã«ã‚ã‚‹ã·ã‚ˆãŒé‡åŠ›ã§è½ã¡ã¦ãã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bash
cat >> PuyoPuyoWPF.Tests/Models/StageTest.cs << 'EOF'

    [Fact]
    public void ã·ã‚ˆã‚’æ¶ˆå»ã™ã‚‹ã¨ä¸Šã®ã·ã‚ˆãŒè½ã¡ã¦ãã‚‹()
    {
        // Arrange
        _stage.Clear();
        _stage.SetCell(2, 8, 1);
        _stage.SetCell(2, 9, 2);
        _stage.SetCell(2, 10, 1);
        _stage.SetCell(2, 11, 1);
        
        // æœ€ä¸‹æ®µã®ã·ã‚ˆ3ã¤ã‚’æ¶ˆå»
        var eraseList = new List<(int X, int Y, int Type)>
        {
            (2, 9, 2),
            (2, 10, 1),
            (2, 11, 1)
        };

        // Act
        _stage.EraseBoards(eraseList);
        _stage.Fall();

        // Assert
        Assert.Equal(1, _stage.GetCell(2, 11)); // ä¸Šã«ã‚ã£ãŸã·ã‚ˆãŒè½ã¡ã¦ããŸ
        Assert.Equal(0, _stage.GetCell(2, 8)); // å…ƒã®ä½ç½®ã¯ç©º
    }

    [Fact]
    public void è¤‡æ•°åˆ—ã®ã·ã‚ˆãŒåŒæ™‚ã«è½ä¸‹ã™ã‚‹()
    {
        // Arrange
        _stage.Clear();
        _stage.SetCell(1, 10, 1);
        _stage.SetCell(2, 10, 1);
        _stage.SetCell(1, 11, 1);
        _stage.SetCell(2, 11, 1);
        
        _stage.SetCell(1, 8, 2);
        _stage.SetCell(2, 8, 2);

        // æœ€ä¸‹æ®µã®4ã¤ã‚’æ¶ˆå»
        var eraseList = new List<(int X, int Y, int Type)>
        {
            (1, 10, 1),
            (2, 10, 1),
            (1, 11, 1),
            (2, 11, 1)
        };

        // Act
        _stage.EraseBoards(eraseList);
        _stage.Fall();

        // Assert
        Assert.Equal(2, _stage.GetCell(1, 11)); // å·¦ä¸Šã®ã·ã‚ˆãŒè½ä¸‹
        Assert.Equal(2, _stage.GetCell(2, 11)); // å³ä¸Šã®ã·ã‚ˆãŒè½ä¸‹
        Assert.Equal(0, _stage.GetCell(1, 8)); // å…ƒã®ä½ç½®ã¯ç©º
        Assert.Equal(0, _stage.GetCell(2, 8)); // å…ƒã®ä½ç½®ã¯ç©º
    }
}
EOF
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œè½ä¸‹å‡¦ç†ã®ãƒ†ã‚¹ãƒˆã‚‚é€šã‚Šã¾ã—ãŸã­ï¼ã€å®Œç’§ã§ã™ï¼

```bash
git add .
git commit -m 'test: æ¶ˆå»å¾Œã®è½ä¸‹å‡¦ç†ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
```

### Gameã‚¯ãƒ©ã‚¹ã¸ã®çµ±åˆ

æ¬¡ã«ã€æ¶ˆå»å‡¦ç†ã‚’`Game`ã‚¯ãƒ©ã‚¹ã«çµ±åˆã—ã¾ã—ã‚‡ã†ã€‚ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã€æ¶ˆå»ã®ãƒ•ãƒ­ãƒ¼ã‚’ç®¡ç†ã—ã¾ã™ã€‚

```bash
cat > PuyoPuyoWPF/Models/GameMode.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public enum GameMode
{
    Start,
    Playing,
    CheckErase,
    Erasing,
    GameOver
}
EOF
```

`Game`ã‚¯ãƒ©ã‚¹ã‚’æ›´æ–°ã—ã¾ã™ï¼š

```bash
cat > PuyoPuyoWPF/Models/Game.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Game
{
    public Config? Config { get; private set; }
    public Stage? Stage { get; private set; }
    public Player? Player { get; private set; }
    public Score? Score { get; private set; }
    public GameMode Mode { get; private set; }

    public void Initialize()
    {
        Config = new Config();
        Stage = new Stage(Config.StageWidth, Config.StageHeight);
        Player = new Player();
        Score = new Score();
        Mode = GameMode.Start;
        
        Stage.Clear();
        Player.Reset();
        Score.Reset();
    }

    public void Start()
    {
        if (Mode == GameMode.Start)
        {
            Mode = GameMode.Playing;
        }
    }

    public void CheckAndErase()
    {
        if (Stage == null) return;

        var eraseInfo = Stage.CheckErase();
        
        if (eraseInfo.ErasePuyoCount > 0)
        {
            Mode = GameMode.Erasing;
            Stage.EraseBoards(eraseInfo.EraseList);
            Score?.AddScore(eraseInfo.ErasePuyoCount);
            
            // è½ä¸‹å‡¦ç†
            Stage.Fall();
            
            // å†åº¦æ¶ˆå»ãƒã‚§ãƒƒã‚¯ï¼ˆé€£é–ã®å¯èƒ½æ€§ï¼‰
            Mode = GameMode.CheckErase;
        }
        else
        {
            Mode = GameMode.Playing;
        }
    }

    public void GameOver()
    {
        Mode = GameMode.GameOver;
    }
}
EOF
```

`Score`ã‚¯ãƒ©ã‚¹ã‚‚æ›´æ–°ã—ã¾ã™ï¼š

```bash
cat > PuyoPuyoWPF/Models/Score.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Score
{
    public int CurrentScore { get; private set; }
    public int ChainCount { get; private set; }

    public void Reset()
    {
        CurrentScore = 0;
        ChainCount = 0;
    }

    public void AddScore(int erasePuyoCount)
    {
        // åŸºæœ¬ã‚¹ã‚³ã‚¢: æ¶ˆã—ãŸã·ã‚ˆã®æ•° Ã— 10
        int baseScore = erasePuyoCount * 10;
        CurrentScore += baseScore;
    }

    public void IncrementChain()
    {
        ChainCount++;
    }

    public void ResetChain()
    {
        ChainCount = 0;
    }
}
EOF
```

### ã‚²ãƒ¼ãƒ ã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ

`Game`ã‚¯ãƒ©ã‚¹ã®æ¶ˆå»å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat >> PuyoPuyoWPF.Tests/Models/GameTest.cs << 'EOF'

    [Fact]
    public void ã·ã‚ˆã‚’æ¶ˆå»ã™ã‚‹ã¨ã‚¹ã‚³ã‚¢ãŒåŠ ç®—ã•ã‚Œã‚‹()
    {
        // Arrange
        var game = new Game();
        game.Initialize();
        game.Start();
        
        // 4ã¤ã®ã·ã‚ˆã‚’é…ç½®
        game.Stage!.SetCell(1, 10, 1);
        game.Stage.SetCell(2, 10, 1);
        game.Stage.SetCell(1, 11, 1);
        game.Stage.SetCell(2, 11, 1);

        // Act
        game.CheckAndErase();

        // Assert
        Assert.True(game.Score!.CurrentScore > 0);
        Assert.Equal(0, game.Stage.GetCell(1, 10)); // ã·ã‚ˆãŒæ¶ˆãˆã¦ã„ã‚‹
    }

    [Fact]
    public void æ¶ˆå»å¾Œã«ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ãŒæ›´æ–°ã•ã‚Œã‚‹()
    {
        // Arrange
        var game = new Game();
        game.Initialize();
        game.Start();
        
        game.Stage!.SetCell(1, 10, 1);
        game.Stage.SetCell(2, 10, 1);
        game.Stage.SetCell(1, 11, 1);
        game.Stage.SetCell(2, 11, 1);

        // Act
        game.CheckAndErase();

        // Assert
        Assert.Equal(GameMode.CheckErase, game.Mode);
    }
}
EOF
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

```bash
git add .
git commit -m 'feat: Gameã‚¯ãƒ©ã‚¹ã«æ¶ˆå»å‡¦ç†ã‚’çµ±åˆ'
```

### ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèª

æœ€å¾Œã«ã€ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Quality
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã£ã¦ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚‚è‰¯å¥½ã§ã™ã­ï¼ã€å®Œç’§ã§ã™ï¼

```bash
git add .
git commit -m 'feat: ã·ã‚ˆã®æ¶ˆå»æ©Ÿèƒ½ã‚’å®Œæˆ'
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³5ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³5ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å®Ÿç¾ã—ã¾ã—ãŸï¼š

1. **æ¥ç¶šåˆ¤å®š**: æ·±ã•å„ªå…ˆæ¢ç´¢ï¼ˆDFSï¼‰ã«ã‚ˆã‚‹åŒè‰²ã·ã‚ˆã®æ¤œå‡º
2. **æ¶ˆå»åˆ¤å®š**: 4ã¤ä»¥ä¸Šã¤ãªãŒã£ãŸã·ã‚ˆã®æ¤œå‡º
3. **æ¶ˆå»å‡¦ç†**: `EraseBoards`ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹ã·ã‚ˆã®å‰Šé™¤
4. **è½ä¸‹å‡¦ç†**: `Fall`ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹é‡åŠ›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
5. **ã‚¹ã‚³ã‚¢è¨ˆç®—**: æ¶ˆã—ãŸã·ã‚ˆã®æ•°ã«å¿œã˜ãŸã‚¹ã‚³ã‚¢åŠ ç®—
6. **ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼**: æ¶ˆå»ãƒã‚§ãƒƒã‚¯â†’æ¶ˆå»â†’è½ä¸‹ã®ã‚µã‚¤ã‚¯ãƒ«

**å­¦ã‚“ã ã“ã¨**:
- **æ·±ã•å„ªå…ˆæ¢ç´¢ï¼ˆDFSï¼‰**: å†å¸°ã‚’ä½¿ã£ãŸæ¢ç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- **visitedé…åˆ—**: åŒã˜ã‚»ãƒ«ã‚’äºŒé‡ã«æ¢ç´¢ã—ãªã„å·¥å¤«
- **ãƒ¬ã‚³ãƒ¼ãƒ‰å‹**: ä¸å¤‰ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¾ã«ä¾¿åˆ©ãª`record`
- **è¤‡é›‘ãªçŠ¶æ…‹é·ç§»**: ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹å‡¦ç†ã®åˆ¶å¾¡

**æ·±ã•å„ªå…ˆæ¢ç´¢ã®é‡è¦æ€§**:
ã·ã‚ˆã®æ¥ç¶šåˆ¤å®šã«ã¯ã€ã‚°ãƒ©ãƒ•æ¢ç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä¸€ã¤ã§ã‚ã‚‹æ·±ã•å„ªå…ˆæ¢ç´¢ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚ã“ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã€è¿·è·¯ã®æ¢ç´¢ã€æœ¨æ§‹é€ ã®èµ°æŸ»ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è§£æãªã©ã€æ§˜ã€…ãªå ´é¢ã§æ´»ç”¨ã•ã‚Œã‚‹åŸºæœ¬çš„ã‹ã¤å¼·åŠ›ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚

**å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ**:
- `visited`é…åˆ—ã§æ¢ç´¢æ¸ˆã¿ã®ã‚»ãƒ«ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã§ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é˜²æ­¢
- 4æ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³ï¼‰ã®æ¢ç´¢ã«ã‚ˆã‚Šã€ã©ã‚“ãªå½¢ã§ã¤ãªãŒã£ã¦ã„ã¦ã‚‚æ¤œå‡ºå¯èƒ½
- å†å¸°ã®çµ‚äº†æ¡ä»¶ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’å›é¿

æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€é€£é–åå¿œã‚’å®Ÿè£…ã—ã¦ã€ã‚ˆã‚Šæˆ¦ç•¥çš„ãªã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚’å¯èƒ½ã«ã—ã¦ã„ãã¾ã™ã‚ˆï¼

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³6: é€£é–åå¿œã¨ã‚¹ã‚³ã‚¢è¨ˆç®—ã®å®Ÿè£…

ã€Œã·ã‚ˆã‚’æ¶ˆã›ã‚‹ã‚ˆã†ã«ãªã£ãŸã‘ã©ã€ã·ã‚ˆã·ã‚ˆã®é†é†å‘³ã¯é€£é–ã˜ã‚ƒãªã„ã§ã™ã‹ï¼Ÿã€ãã†ã§ã™ã­ï¼ã·ã‚ˆã·ã‚ˆã®æœ€ã‚‚é­…åŠ›çš„ãªè¦ç´ ã®ä¸€ã¤ã¯ã€é€£é–åå¿œã§ã™ã€‚ã·ã‚ˆãŒæ¶ˆãˆã¦è½ä¸‹ã—ãŸçµæœã€æ–°ãŸãªæ¶ˆå»ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç”Ÿã¾ã‚Œã€é€£ç¶šã—ã¦æ¶ˆå»ãŒç™ºç”Ÿã™ã‚‹ã€Œé€£é–ã€ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€é€£é–åå¿œã‚’èµ·ã“ã—ã¦ã‚ˆã‚Šé«˜ã„ã‚¹ã‚³ã‚¢ã‚’ç²å¾—ã§ãã‚‹

ã€Œã‚Œã€œã‚“ã•ã€œã‚“ï¼ã€ã¨å«ã³ãŸããªã‚‹ã‚ˆã†ãªé€£é–åå¿œã‚’å®Ÿè£…ã—ã¦ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ˆã‚Šé«˜ã„ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

### TODOãƒªã‚¹ãƒˆ

ã€Œã©ã‚“ãªä½œæ¥­ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã‹ï¼Ÿã€ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> TODOãƒªã‚¹ãƒˆã¯ã€å®Ÿè£…å‰ã«å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºã®æ–¹å‘æ€§ã‚’ä¿ã¡ã€ä½•ã‚‚è¦‹è½ã¨ã•ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
> 
> â€” Kent Beck ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€

ã€Œé€£é–åå¿œã‚’å®Ÿè£…ã™ã‚‹ã€ã¨ã„ã†æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒå¿…è¦ãã†ã§ã™ã­ï¼š

- é€£é–ã‚«ã‚¦ãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹ï¼ˆä½•é€£é–ç›®ã‹ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ï¼‰
- é€£é–ãƒœãƒ¼ãƒŠã‚¹ã®è¨ˆç®—ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆé€£é–æ•°ã«å¿œã˜ãŸãƒœãƒ¼ãƒŠã‚¹ç‚¹ã‚’è¨ˆç®—ã™ã‚‹ï¼‰
- é€£é–ãƒ«ãƒ¼ãƒ—ã®å®Ÿè£…ï¼ˆæ¶ˆå»â†’è½ä¸‹â†’å†ãƒã‚§ãƒƒã‚¯ã®ã‚µã‚¤ã‚¯ãƒ«ï¼‰
- ã‚¹ã‚³ã‚¢è¡¨ç¤ºã®æ›´æ–°ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«é€£é–æ•°ã¨ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤ºã™ã‚‹ï¼‰

### ãƒ†ã‚¹ãƒˆ: é€£é–ã‚«ã‚¦ãƒ³ãƒˆ

ã€Œæœ€åˆã«ä½•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚Œã°ã„ã„ã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿã€ã¾ãšã¯ã€é€£é–ã‚«ã‚¦ãƒ³ãƒˆã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```bash
cat > PuyoPuyoWPF.Tests/Models/ScoreTest.cs << 'EOF'
using Xunit;
using PuyoPuyoWPF.Models;

namespace PuyoPuyoWPF.Tests.Models;

public class ScoreTest
{
    [Fact]
    public void ã‚¹ã‚³ã‚¢ã‚’åˆæœŸåŒ–ã™ã‚‹ã¨0ã«ãªã‚‹()
    {
        // Arrange & Act
        var score = new Score();
        score.Reset();

        // Assert
        Assert.Equal(0, score.CurrentScore);
        Assert.Equal(0, score.ChainCount);
    }

    [Fact]
    public void ã·ã‚ˆã‚’æ¶ˆå»ã™ã‚‹ã¨ã‚¹ã‚³ã‚¢ãŒåŠ ç®—ã•ã‚Œã‚‹()
    {
        // Arrange
        var score = new Score();
        score.Reset();

        // Act
        score.AddScore(4); // 4ã¤æ¶ˆå»

        // Assert
        Assert.Equal(40, score.CurrentScore); // 4 Ã— 10 = 40
    }

    [Fact]
    public void é€£é–ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—ã‚„ã›ã‚‹()
    {
        // Arrange
        var score = new Score();
        score.Reset();

        // Act
        score.IncrementChain();
        score.IncrementChain();

        // Assert
        Assert.Equal(2, score.ChainCount);
    }

    [Fact]
    public void é€£é–ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆã§ãã‚‹()
    {
        // Arrange
        var score = new Score();
        score.IncrementChain();
        score.IncrementChain();

        // Act
        score.ResetChain();

        // Assert
        Assert.Equal(0, score.ChainCount);
    }

    [Fact]
    public void é€£é–æ•°ã«å¿œã˜ã¦ãƒœãƒ¼ãƒŠã‚¹ãŒåŠ ç®—ã•ã‚Œã‚‹()
    {
        // Arrange
        var score = new Score();
        score.Reset();

        // Act - 1é€£é–ç›®
        score.IncrementChain();
        score.AddScoreWithChain(4, score.ChainCount);
        int score1 = score.CurrentScore;

        // 2é€£é–ç›®
        score.IncrementChain();
        score.AddScoreWithChain(4, score.ChainCount);
        int score2 = score.CurrentScore;

        // Assert
        // 2é€£é–ç›®ã®æ–¹ãŒãƒœãƒ¼ãƒŠã‚¹ãŒå¤§ãã„ã®ã§ã‚¹ã‚³ã‚¢å¢—åŠ é‡ãŒå¤§ãã„
        Assert.True(score2 - score1 > 40); // åŸºæœ¬ã‚¹ã‚³ã‚¢40ã‚ˆã‚Šå¤§ãã„å¢—åŠ 
    }

    [Theory]
    [InlineData(1, 0)]
    [InlineData(2, 8)]
    [InlineData(3, 16)]
    [InlineData(4, 32)]
    [InlineData(5, 64)]
    [InlineData(6, 96)]
    [InlineData(7, 128)]
    public void é€£é–ãƒœãƒ¼ãƒŠã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹(int chainCount, int expectedBonus)
    {
        // Arrange
        var score = new Score();

        // Act
        var bonus = score.GetChainBonus(chainCount);

        // Assert
        Assert.Equal(expectedBonus, bonus);
    }
}
EOF
```

ã€Œé€£é–ãƒœãƒ¼ãƒŠã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã£ã¦ä½•ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ï¼é€£é–ãƒœãƒ¼ãƒŠã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€é€£é–æ•°ã«å¿œã˜ãŸãƒœãƒ¼ãƒŠã‚¹å€ç‡ã‚’å®šç¾©ã—ãŸã‚‚ã®ã§ã™ã€‚é€£é–æ•°ãŒå¢—ãˆã‚‹ã»ã©ã€ãƒœãƒ¼ãƒŠã‚¹ãŒå¤§ãããªã‚Šã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã­ã€ãã†ã§ã™ã€ã¾ã å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚

### å®Ÿè£…: é€£é–ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒœãƒ¼ãƒŠã‚¹è¨ˆç®—

ãã‚Œã§ã¯ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```bash
cat > PuyoPuyoWPF/Models/Score.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Score
{
    private readonly int[] _chainBonusTable = { 0, 0, 8, 16, 32, 64, 96, 128, 160, 192, 224, 256 };
    
    public int CurrentScore { get; private set; }
    public int ChainCount { get; private set; }

    public void Reset()
    {
        CurrentScore = 0;
        ChainCount = 0;
    }

    public void AddScore(int erasePuyoCount)
    {
        // åŸºæœ¬ã‚¹ã‚³ã‚¢: æ¶ˆã—ãŸã·ã‚ˆã®æ•° Ã— 10
        int baseScore = erasePuyoCount * 10;
        CurrentScore += baseScore;
    }

    public void AddScoreWithChain(int erasePuyoCount, int chainCount)
    {
        // åŸºæœ¬ã‚¹ã‚³ã‚¢
        int baseScore = erasePuyoCount * 10;
        
        // é€£é–ãƒœãƒ¼ãƒŠã‚¹ã‚’é©ç”¨
        int chainBonus = GetChainBonus(chainCount);
        int totalScore = baseScore * Math.Max(1, chainBonus);
        
        CurrentScore += totalScore;
    }

    public int GetChainBonus(int chainCount)
    {
        if (chainCount <= 0 || chainCount >= _chainBonusTable.Length)
        {
            return _chainBonusTable[^1]; // æœ€å¤§å€¤ã‚’è¿”ã™
        }
        return _chainBonusTable[chainCount];
    }

    public void IncrementChain()
    {
        ChainCount++;
    }

    public void ResetChain()
    {
        ChainCount = 0;
    }
}
EOF
```

ã€Œé€£é–ãƒœãƒ¼ãƒŠã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒé…åˆ—ã«ãªã£ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚é€£é–æ•°ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦ã€å¯¾å¿œã™ã‚‹ãƒœãƒ¼ãƒŠã‚¹å€¤ã‚’å–å¾—ã§ãã¾ã™ã€‚

**é€£é–ãƒœãƒ¼ãƒŠã‚¹ã®è¨ˆç®—å¼**:
```
æœ€çµ‚ã‚¹ã‚³ã‚¢ = åŸºæœ¬ã‚¹ã‚³ã‚¢ï¼ˆæ¶ˆå»æ•° Ã— 10ï¼‰Ã— é€£é–ãƒœãƒ¼ãƒŠã‚¹
```

ä¾‹ãˆã°ã€4ã¤ã®ã·ã‚ˆã‚’2é€£é–ã§æ¶ˆã—ãŸå ´åˆï¼š
- åŸºæœ¬ã‚¹ã‚³ã‚¢: 4 Ã— 10 = 40
- é€£é–ãƒœãƒ¼ãƒŠã‚¹: 8ï¼ˆ2é€£é–ï¼‰
- æœ€çµ‚ã‚¹ã‚³ã‚¢: 40 Ã— 8 = 320

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼

```bash
git add .
git commit -m 'feat: é€£é–ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒœãƒ¼ãƒŠã‚¹è¨ˆç®—ã‚’å®Ÿè£…'
```

### ãƒ†ã‚¹ãƒˆ: é€£é–ãƒ«ãƒ¼ãƒ—ã®å®Ÿè£…

æ¬¡ã«ã€é€£é–ãŒå®Ÿéš›ã«ç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚æ¶ˆå»â†’è½ä¸‹â†’å†æ¶ˆå»ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
cat >> PuyoPuyoWPF.Tests/Models/StageTest.cs << 'EOF'

    [Fact]
    public void æ¶ˆå»å¾Œã®è½ä¸‹ã§é€£é–ãŒç™ºç”Ÿã™ã‚‹()
    {
        // Arrange - é€£é–ãŒç™ºç”Ÿã™ã‚‹é…ç½®
        _stage.Clear();
        
        // ä¸‹æ®µ: èµ¤4ã¤ï¼ˆæ¨ªä¸¦ã³ï¼‰
        _stage.SetCell(1, 11, 1);
        _stage.SetCell(2, 11, 1);
        _stage.SetCell(3, 11, 1);
        _stage.SetCell(4, 11, 1);
        
        // ä¸Šæ®µ: é’3ã¤ + 1ã¤é›¢ã‚ŒãŸå ´æ‰€ã«é’1ã¤ï¼ˆè½ä¸‹å¾Œã«4ã¤ã«ãªã‚‹ï¼‰
        _stage.SetCell(2, 9, 2);
        _stage.SetCell(3, 9, 2);
        _stage.SetCell(4, 9, 2);
        _stage.SetCell(2, 10, 2); // ã“ã‚ŒãŒè½ã¡ã¦4ã¤ã«ãªã‚‹

        // Act - 1å›ç›®ã®æ¶ˆå»
        var eraseInfo1 = _stage.CheckErase();
        _stage.EraseBoards(eraseInfo1.EraseList);
        _stage.Fall();
        
        // 2å›ç›®ã®ãƒã‚§ãƒƒã‚¯ï¼ˆé€£é–ï¼‰
        var eraseInfo2 = _stage.CheckErase();

        // Assert
        Assert.Equal(4, eraseInfo1.ErasePuyoCount); // 1å›ç›®: èµ¤4ã¤æ¶ˆå»
        Assert.Equal(4, eraseInfo2.ErasePuyoCount); // 2å›ç›®: é’4ã¤æ¶ˆå»ï¼ˆé€£é–ï¼‰
    }

    [Fact]
    public void é€£é–ãŒç™ºç”Ÿã—ãªã„å ´åˆã¯æ¶ˆå»ã•ã‚Œãªã„()
    {
        // Arrange
        _stage.Clear();
        
        // 4ã¤æ¨ªä¸¦ã³
        _stage.SetCell(1, 11, 1);
        _stage.SetCell(2, 11, 1);
        _stage.SetCell(3, 11, 1);
        _stage.SetCell(4, 11, 1);
        
        // ä¸Šã«åˆ¥ã®è‰²ã®ã·ã‚ˆãŒ2ã¤ã ã‘
        _stage.SetCell(2, 10, 2);
        _stage.SetCell(3, 10, 2);

        // Act
        var eraseInfo1 = _stage.CheckErase();
        _stage.EraseBoards(eraseInfo1.EraseList);
        _stage.Fall();
        
        var eraseInfo2 = _stage.CheckErase();

        // Assert
        Assert.Equal(4, eraseInfo1.ErasePuyoCount); // 1å›ç›®: 4ã¤æ¶ˆå»
        Assert.Equal(0, eraseInfo2.ErasePuyoCount); // 2å›ç›®: æ¶ˆå»ãªã—
    }
}
EOF
```

ã€Œé€£é–ã®ãƒ†ã‚¹ãƒˆã¯è¤‡é›‘ã§ã™ã­ï¼ã€ãã†ã§ã™ã­ã€‚é€£é–ãŒç™ºç”Ÿã™ã‚‹ã«ã¯ã€æ­£ç¢ºãªé…ç½®ãŒå¿…è¦ã§ã™ã€‚ãƒ†ã‚¹ãƒˆã§ã¯ã€æ¶ˆå»â†’è½ä¸‹â†’å†æ¶ˆå»ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€æ—¢å­˜ã®å®Ÿè£…ã§é€£é–ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

```bash
git add .
git commit -m 'test: é€£é–ãƒ«ãƒ¼ãƒ—ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
```

### Gameã‚¯ãƒ©ã‚¹ã¸ã®é€£é–çµ±åˆ

æ¬¡ã«ã€`Game`ã‚¯ãƒ©ã‚¹ã«é€£é–ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ±åˆã—ã¾ã—ã‚‡ã†ã€‚

```bash
cat > PuyoPuyoWPF/Models/Game.cs << 'EOF'
namespace PuyoPuyoWPF.Models;

public class Game
{
    public Config? Config { get; private set; }
    public Stage? Stage { get; private set; }
    public Player? Player { get; private set; }
    public Score? Score { get; private set; }
    public GameMode Mode { get; private set; }

    public void Initialize()
    {
        Config = new Config();
        Stage = new Stage(Config.StageWidth, Config.StageHeight);
        Player = new Player();
        Score = new Score();
        Mode = GameMode.Start;
        
        Stage.Clear();
        Player.Reset();
        Score.Reset();
    }

    public void Start()
    {
        if (Mode == GameMode.Start)
        {
            Mode = GameMode.Playing;
        }
    }

    public void CheckAndEraseWithChain()
    {
        if (Stage == null || Score == null) return;

        Score.ResetChain(); // é€£é–ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
        
        // é€£é–ãƒ«ãƒ¼ãƒ—
        while (true)
        {
            var eraseInfo = Stage.CheckErase();
            
            if (eraseInfo.ErasePuyoCount > 0)
            {
                Mode = GameMode.Erasing;
                Score.IncrementChain(); // é€£é–ã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ 
                
                // æ¶ˆå»å‡¦ç†
                Stage.EraseBoards(eraseInfo.EraseList);
                
                // ã‚¹ã‚³ã‚¢åŠ ç®—ï¼ˆé€£é–ãƒœãƒ¼ãƒŠã‚¹ä»˜ãï¼‰
                Score.AddScoreWithChain(eraseInfo.ErasePuyoCount, Score.ChainCount);
                
                // è½ä¸‹å‡¦ç†
                Stage.Fall();
                
                // æ¬¡ã®ãƒ«ãƒ¼ãƒ—ã§å†åº¦ãƒã‚§ãƒƒã‚¯ï¼ˆé€£é–ã®å¯èƒ½æ€§ï¼‰
            }
            else
            {
                // æ¶ˆå»ãªã— â†’ é€£é–çµ‚äº†
                Mode = GameMode.Playing;
                break;
            }
        }
    }

    public void GameOver()
    {
        Mode = GameMode.GameOver;
    }
}
EOF
```

ã€Œ`while`ãƒ«ãƒ¼ãƒ—ã§é€£é–ã‚’å‡¦ç†ã—ã¦ã„ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚æ¶ˆå»å¯èƒ½ãªã·ã‚ˆãŒã‚ã‚‹é™ã‚Šã€æ¶ˆå»â†’è½ä¸‹â†’å†ãƒã‚§ãƒƒã‚¯ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é€£é–åå¿œãŒè‡ªå‹•çš„ã«å‡¦ç†ã•ã‚Œã¾ã™ã€‚

### Gameã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ

`Game`ã‚¯ãƒ©ã‚¹ã®é€£é–å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ï¼š

```bash
cat >> PuyoPuyoWPF.Tests/Models/GameTest.cs << 'EOF'

    [Fact]
    public void é€£é–ãŒç™ºç”Ÿã™ã‚‹ã¨ã‚¹ã‚³ã‚¢ã«ãƒœãƒ¼ãƒŠã‚¹ãŒåŠ ç®—ã•ã‚Œã‚‹()
    {
        // Arrange
        var game = new Game();
        game.Initialize();
        game.Start();
        
        // é€£é–ãŒç™ºç”Ÿã™ã‚‹é…ç½®
        // ä¸‹æ®µ: èµ¤4ã¤
        game.Stage!.SetCell(1, 11, 1);
        game.Stage.SetCell(2, 11, 1);
        game.Stage.SetCell(3, 11, 1);
        game.Stage.SetCell(4, 11, 1);
        
        // ä¸Šæ®µ: é’4ã¤ï¼ˆè½ä¸‹å¾Œã«4ã¤ã«ãªã‚‹ï¼‰
        game.Stage.SetCell(2, 9, 2);
        game.Stage.SetCell(3, 9, 2);
        game.Stage.SetCell(4, 9, 2);
        game.Stage.SetCell(2, 10, 2);

        // Act
        game.CheckAndEraseWithChain();

        // Assert
        // 1é€£é–: 4 Ã— 10 Ã— 0 = 0ï¼ˆãƒœãƒ¼ãƒŠã‚¹0ï¼‰â†’ 40ï¼ˆæœ€å°å€¤1ã‚’ä½¿ç”¨ï¼‰
        // 2é€£é–: 4 Ã— 10 Ã— 8 = 320
        // åˆè¨ˆ: 40 + 320 = 360
        Assert.True(game.Score!.CurrentScore >= 360);
        Assert.Equal(2, game.Score.ChainCount);
    }

    [Fact]
    public void é€£é–ãŒç™ºç”Ÿã—ãªã„å ´åˆã¯é€£é–ã‚«ã‚¦ãƒ³ãƒˆãŒ1ã«ãªã‚‹()
    {
        // Arrange
        var game = new Game();
        game.Initialize();
        game.Start();
        
        // 4ã¤æ¨ªä¸¦ã³ï¼ˆé€£é–ãªã—ï¼‰
        game.Stage!.SetCell(1, 11, 1);
        game.Stage.SetCell(2, 11, 1);
        game.Stage.SetCell(3, 11, 1);
        game.Stage.SetCell(4, 11, 1);

        // Act
        game.CheckAndEraseWithChain();

        // Assert
        Assert.Equal(1, game.Score!.ChainCount);
    }
}
EOF
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet test
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ï¼ã€å®Œç’§ã§ã™ï¼

```bash
git add .
git commit -m 'feat: é€£é–å‡¦ç†ã‚’Gameã‚¯ãƒ©ã‚¹ã«çµ±åˆ'
```

### ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèª

æœ€å¾Œã«ã€ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Quality
```

ã€Œã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã£ã¦ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚‚è‰¯å¥½ã§ã™ã­ï¼ã€å®Œç’§ã§ã™ï¼

```bash
git add .
git commit -m 'feat: é€£é–åå¿œã¨ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚’å®Œæˆ'
```

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³6ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³6ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å®Ÿç¾ã—ã¾ã—ãŸï¼š

1. **é€£é–ã‚«ã‚¦ãƒ³ãƒˆ**: `IncrementChain()`ã¨`ResetChain()`ã«ã‚ˆã‚‹é€£é–æ•°ã®ç®¡ç†
2. **é€£é–ãƒœãƒ¼ãƒŠã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«**: é€£é–æ•°ã«å¿œã˜ãŸãƒœãƒ¼ãƒŠã‚¹å€ç‡ã®å®šç¾©
3. **ãƒœãƒ¼ãƒŠã‚¹è¨ˆç®—**: `GetChainBonus()`ã«ã‚ˆã‚‹é€£é–ãƒœãƒ¼ãƒŠã‚¹ã®å–å¾—
4. **ã‚¹ã‚³ã‚¢è¨ˆç®—**: `AddScoreWithChain()`ã«ã‚ˆã‚‹é€£é–ãƒœãƒ¼ãƒŠã‚¹ä»˜ãã‚¹ã‚³ã‚¢åŠ ç®—
5. **é€£é–ãƒ«ãƒ¼ãƒ—**: `CheckAndEraseWithChain()`ã«ã‚ˆã‚‹é€£é–åå¿œã®è‡ªå‹•å‡¦ç†

**å­¦ã‚“ã ã“ã¨**:
- **é€£é–ãƒœãƒ¼ãƒŠã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«**: é…åˆ—ã«ã‚ˆã‚‹ãƒœãƒ¼ãƒŠã‚¹å€¤ã®ç®¡ç†
- **whileãƒ«ãƒ¼ãƒ—ã«ã‚ˆã‚‹é€£é–å‡¦ç†**: æ¶ˆå»å¯èƒ½ãªé™ã‚Šç¹°ã‚Šè¿”ã™
- **æ®µéšçš„ãªã‚¹ã‚³ã‚¢è¨ˆç®—**: åŸºæœ¬ã‚¹ã‚³ã‚¢ â†’ ãƒœãƒ¼ãƒŠã‚¹é©ç”¨ â†’ åŠ ç®—
- **ã‚²ãƒ¼ãƒ ãƒãƒ©ãƒ³ã‚¹**: é€£é–æ•°ã«ã‚ˆã‚‹å ±é…¬ã®å¢—åŠ 

**é€£é–ãƒœãƒ¼ãƒŠã‚¹ã®æ„ç¾©**:
é€£é–ãƒœãƒ¼ãƒŠã‚¹ã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æˆ¦ç•¥çš„ãªãƒ—ãƒ¬ã‚¤ã‚’ä¿ƒã™é‡è¦ãªè¦ç´ ã§ã™ã€‚ãŸã ã·ã‚ˆã‚’æ¶ˆã™ã®ã§ã¯ãªãã€ã€Œæ¬¡ã®é€£é–ã‚’è€ƒãˆã¦é…ç½®ã™ã‚‹ã€ã¨ã„ã†æ·±ã„æ€è€ƒãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚²ãƒ¼ãƒ ã®é¢ç™½ã•ã¨å¥¥æ·±ã•ãŒå¤§ããå‘ä¸Šã—ã¾ã™ã€‚

> ã‚²ãƒ¼ãƒ ãƒãƒ©ãƒ³ã‚¹
>
> ã‚²ãƒ¼ãƒ ã®é¢ç™½ã•ã¯ã€æŒ‘æˆ¦ã¨å ±é…¬ã®ãƒãƒ©ãƒ³ã‚¹ã‹ã‚‰ç”Ÿã¾ã‚Œã¾ã™ã€‚å›°é›£ãªç›®æ¨™ï¼ˆé€£é–ï¼‰ã‚’é”æˆã—ãŸã¨ãã®å¤§ããªå ±é…¬ï¼ˆãƒœãƒ¼ãƒŠã‚¹ã‚¹ã‚³ã‚¢ï¼‰ã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é”æˆæ„Ÿã‚’é«˜ã‚ã¾ã™ã€‚
>
> â€” Mihaly Csikszentmihalyi ã€ãƒ•ãƒ­ãƒ¼ä½“é¨“ã€

**å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ**:
- é€£é–ãƒœãƒ¼ãƒŠã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é…åˆ—ã§ç®¡ç†ã™ã‚‹ã“ã¨ã§ã€æŸ”è»Ÿãªèª¿æ•´ãŒå¯èƒ½
- `while`ãƒ«ãƒ¼ãƒ—ã§é€£é–ã‚’è‡ªå‹•å‡¦ç†ã™ã‚‹ã“ã¨ã§ã€ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã‚’å®Ÿç¾
- `Math.Max(1, chainBonus)`ã§ã€ãƒœãƒ¼ãƒŠã‚¹ãŒ0ã§ã‚‚æœ€ä½1å€ã®ã‚¹ã‚³ã‚¢ã‚’ä¿è¨¼

ã“ã‚Œã§ã·ã‚ˆã·ã‚ˆã®åŸºæœ¬çš„ãªã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ãŒå®Œæˆã—ã¾ã—ãŸï¼æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€UIã®å®Ÿè£…ã‚„ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®šãªã©ã€ã‚ˆã‚Šå®Œæˆåº¦ã®é«˜ã„ã‚²ãƒ¼ãƒ ã«ä»•ä¸Šã’ã¦ã„ãã¾ã™ã€‚

## ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³7: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®å®Ÿè£…

ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³6ã§é€£é–ãƒœãƒ¼ãƒŠã‚¹ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚æ¬¡ã¯ã€ã·ã‚ˆã·ã‚ˆã®éš ã‚ŒãŸé†é†å‘³ã§ã‚ã‚‹ã€Œå…¨æ¶ˆã—ã€ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ï¼

> ã‚²ãƒ¼ãƒ ã®éš ã—è¦ç´ 
>
> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè‡ªã‚‰ç™ºè¦‹ã™ã‚‹éš ã‚ŒãŸãƒœãƒ¼ãƒŠã‚¹ã¯ã€ã‚²ãƒ¼ãƒ ã«æ·±ã¿ã‚’ä¸ãˆã¾ã™ã€‚å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯ã€é”æˆãŒé›£ã—ã„ãŒå¤§ããªå ±é…¬ã‚’å¾—ã‚‰ã‚Œã‚‹ã€å…¸å‹çš„ãªéš ã—è¦ç´ ã§ã™ã€‚
>
> â€” Sid Meier ã€Game Designã€

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

ã¾ãšã¯ã€ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ç›¤é¢ä¸Šã®ã·ã‚ˆã‚’ã™ã¹ã¦æ¶ˆã™ã¨ã€å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’ç²å¾—ã§ãã‚‹

ã€Œå…¨æ¶ˆã—ã£ã¦ä½•ã§ã™ã‹ï¼Ÿã€è‰¯ã„è³ªå•ã§ã™ã­ï¼å…¨æ¶ˆã—ã¨ã¯ã€ç›¤é¢ä¸Šã«ã·ã‚ˆãŒ1ã¤ã‚‚æ®‹ã£ã¦ã„ãªã„çŠ¶æ…‹ã®ã“ã¨ã§ã™ã€‚ã“ã‚Œã‚’é”æˆã™ã‚‹ã¨ã€å¤§ããªãƒœãƒ¼ãƒŠã‚¹ã‚¹ã‚³ã‚¢ãŒã‚‚ã‚‰ãˆã¾ã™ã€‚

### TODOãƒªã‚¹ãƒˆ

ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€TODOãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- å…¨æ¶ˆã—åˆ¤å®šã‚’å®Ÿè£…ã™ã‚‹ï¼ˆç›¤é¢ãŒç©ºã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ï¼‰
- å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆå›ºå®šå€¤3600ç‚¹ã‚’åŠ ç®—ï¼‰
- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã«å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ã‚’çµ±åˆã™ã‚‹

ã€Œ3600ç‚¹ã£ã¦ã™ã”ã„ã§ã™ã­ï¼ã€ãã†ãªã‚“ã§ã™ã€‚å…¨æ¶ˆã—ã¯é›£ã—ã„ã§ã™ãŒã€é”æˆã™ã‚‹ã¨å¤§ããªãƒœãƒ¼ãƒŠã‚¹ãŒã‚‚ã‚‰ãˆã¾ã™ã€‚ã“ã‚ŒãŒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã«ãªã‚Šã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—7-1: å…¨æ¶ˆã—åˆ¤å®šã®å®Ÿè£…

ã¾ãšã¯ã€ç›¤é¢ãŒç©ºã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚

#### ãƒ†ã‚¹ãƒˆã®ä½œæˆ

ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§é€²ã‚ã¾ã™ï¼š

```csharp
// PuyoPuyoTDD.Tests/Models/StageTests.csï¼ˆè¿½åŠ ï¼‰
[Fact]
public void IsAllClear_ç©ºã®ç›¤é¢_Trueã‚’è¿”ã™()
{
    // Arrange
    var stage = new Stage();
    stage.InitBoards();

    // Act
    var result = stage.IsAllClear();

    // Assert
    Assert.True(result);
}

[Fact]
public void IsAllClear_ã·ã‚ˆãŒ1ã¤ã§ã‚‚ã‚ã‚‹_Falseã‚’è¿”ã™()
{
    // Arrange
    var stage = new Stage();
    stage.InitBoards();
    stage.Boards[5, 12] = 1; // ç›¤é¢ã®çœŸã‚“ä¸­ã«èµ¤ã·ã‚ˆã‚’é…ç½®

    // Act
    var result = stage.IsAllClear();

    // Assert
    Assert.False(result);
}

[Fact]
public void IsAllClear_å£ã¨ã‚´ãƒŸã·ã‚ˆã®ã¿_Trueã‚’è¿”ã™()
{
    // Arrange
    var stage = new Stage();
    stage.InitBoards();
    // å£(9)ã¨ã‚´ãƒŸã·ã‚ˆ(99)ã¯å…¨æ¶ˆã—åˆ¤å®šã«å½±éŸ¿ã—ãªã„

    // Act
    var result = stage.IsAllClear();

    // Assert
    Assert.True(result);
}

[Fact]
public void IsAllClear_ç›¤é¢å…¨ä½“ã«ã·ã‚ˆãŒã‚ã‚‹_Falseã‚’è¿”ã™()
{
    // Arrange
    var stage = new Stage();
    stage.InitBoards();
    
    // ç›¤é¢å…¨ä½“ã«ã·ã‚ˆã‚’é…ç½®
    for (int x = 1; x <= 6; x++)
    {
        for (int y = 1; y <= 13; y++)
        {
            stage.Boards[x, y] = 1;
        }
    }

    // Act
    var result = stage.IsAllClear();

    // Assert
    Assert.False(result);
}
```

ã€Œå£ã‚„ã‚´ãƒŸã·ã‚ˆã¯å…¨æ¶ˆã—åˆ¤å®šã«é–¢ä¿‚ãªã„ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚å£ï¼ˆ9ï¼‰ã‚„ã‚´ãƒŸã·ã‚ˆï¼ˆ99ï¼‰ã¯å›ºå®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ã€æ¶ˆãˆã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å…¨æ¶ˆã—åˆ¤å®šã§ã¯ç„¡è¦–ã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œå½“ç„¶ã§ã™ãŒã€ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã™ã­ã€‚ã€ãã†ã§ã™ã€‚`IsAllClear`ãƒ¡ã‚½ãƒƒãƒ‰ãŒã¾ã å­˜åœ¨ã—ãªã„ã‹ã‚‰ã§ã™ã€‚

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'test: å…¨æ¶ˆã—åˆ¤å®šã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
```

#### å®Ÿè£…

æ¬¡ã«ã€`IsAllClear`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

```csharp
// PuyoPuyoTDD/Models/Stage.csï¼ˆè¿½åŠ ï¼‰
/// <summary>
/// ç›¤é¢ãŒç©ºï¼ˆå…¨æ¶ˆã—ï¼‰ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™
/// </summary>
/// <returns>ç›¤é¢ä¸Šã«æ¶ˆã›ã‚‹ã·ã‚ˆãŒå­˜åœ¨ã—ãªã„å ´åˆã¯true</returns>
public bool IsAllClear()
{
    for (int x = 1; x <= 6; x++)
    {
        for (int y = 1; y <= 13; y++)
        {
            // å£(9)ã€ã‚´ãƒŸã·ã‚ˆ(99)ã€ç©º(0)ä»¥å¤–ãŒã‚ã‚Œã°false
            if (Boards[x, y] != 0 && Boards[x, y] != 9 && Boards[x, y] != 99)
            {
                return false;
            }
        }
    }
    return true;
}
```

ã€ŒäºŒé‡ãƒ«ãƒ¼ãƒ—ã§å…¨ãƒã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚ç›¤é¢å…¨ä½“ã‚’èµ°æŸ»ã—ã¦ã€æ¶ˆã›ã‚‹ã·ã‚ˆï¼ˆ1ï½4ï¼‰ãŒ1ã¤ã§ã‚‚ã‚ã‚Œã°`false`ã‚’è¿”ã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼å…¨æ¶ˆã—åˆ¤å®šãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: å…¨æ¶ˆã—åˆ¤å®šã‚’å®Ÿè£…'
```

### ã‚¹ãƒ†ãƒƒãƒ—7-2: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®å®Ÿè£…

æ¬¡ã«ã€å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’ã‚¹ã‚³ã‚¢ã«åŠ ç®—ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚

#### ãƒ†ã‚¹ãƒˆã®ä½œæˆ

```csharp
// PuyoPuyoTDD.Tests/Models/ScoreTests.csï¼ˆè¿½åŠ ï¼‰
[Fact]
public void AddZenkeshiBonus_å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹_3600ç‚¹åŠ ç®—ã•ã‚Œã‚‹()
{
    // Arrange
    var score = new Score();
    score.InitScore();

    // Act
    score.AddZenkeshiBonus();

    // Assert
    Assert.Equal(3600, score.CurrentScore);
}

[Fact]
public void AddZenkeshiBonus_æ—¢å­˜ã‚¹ã‚³ã‚¢ã«åŠ ç®—_æ­£ã—ãåŠ ç®—ã•ã‚Œã‚‹()
{
    // Arrange
    var score = new Score();
    score.InitScore();
    score.AddScore(400); // æ—¢å­˜ã‚¹ã‚³ã‚¢ã‚’è¨­å®š

    // Act
    score.AddZenkeshiBonus();

    // Assert
    Assert.Equal(4000, score.CurrentScore);
}

[Fact]
public void AddZenkeshiBonus_è¤‡æ•°å›å‘¼ã³å‡ºã—_æ¯å›3600ç‚¹åŠ ç®—ã•ã‚Œã‚‹()
{
    // Arrange
    var score = new Score();
    score.InitScore();

    // Act
    score.AddZenkeshiBonus();
    score.AddZenkeshiBonus();

    // Assert
    Assert.Equal(7200, score.CurrentScore);
}
```

ã€Œå…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯å›ºå®šã§3600ç‚¹ãªã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚é€£é–ãƒœãƒ¼ãƒŠã‚¹ã¨é•ã£ã¦ã€å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯å›ºå®šå€¤ã§ã™ã€‚ã“ã‚Œã¯ã·ã‚ˆã·ã‚ˆã®ä¼çµ±çš„ãªè¨­å®šã§ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚ã€ã¯ã„ã€`AddZenkeshiBonus`ãƒ¡ã‚½ãƒƒãƒ‰ãŒã¾ã å­˜åœ¨ã—ãªã„ã‹ã‚‰ã§ã™ã€‚

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'test: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
```

#### å®Ÿè£…

`AddZenkeshiBonus`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

```csharp
// PuyoPuyoTDD/Models/Score.csï¼ˆè¿½åŠ ï¼‰
/// <summary>
/// å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’åŠ ç®—ã—ã¾ã™
/// </summary>
public void AddZenkeshiBonus()
{
    const int zenkeshiBonus = 3600;
    CurrentScore += zenkeshiBonus;
}
```

ã€Œã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ï¼ã€ãã†ãªã‚“ã§ã™ã€‚å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯å›ºå®šå€¤ãªã®ã§ã€å®Ÿè£…ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ãŒæ­£ã—ãåŠ ç®—ã•ã‚Œã¦ã„ã¾ã™ã€‚

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’å®Ÿè£…'
```

### ã‚¹ãƒ†ãƒƒãƒ—7-3: ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã¸ã®çµ±åˆ

æœ€å¾Œã«ã€å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ã‚’ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã«çµ±åˆã—ã¾ã—ã‚‡ã†ã€‚æ¶ˆå»å‡¦ç†ã®å¾Œã«å…¨æ¶ˆã—åˆ¤å®šã‚’è¡Œã„ã€å…¨æ¶ˆã—ã®å ´åˆã¯ãƒœãƒ¼ãƒŠã‚¹ã‚’åŠ ç®—ã—ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆã®ä½œæˆ

```csharp
// PuyoPuyoTDD.Tests/Models/GameTests.csï¼ˆè¿½åŠ ï¼‰
[Fact]
public void Update_å…¨æ¶ˆã—_å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ãŒåŠ ç®—ã•ã‚Œã‚‹()
{
    // Arrange
    var game = new Game();
    game.InitGame();
    
    // å…¨æ¶ˆã—ã«ãªã‚‹ã‚ˆã†ã«ç›¤é¢ã‚’è¨­å®šï¼ˆ4ã¤ã®èµ¤ã·ã‚ˆã‚’ç¸¦ã«ä¸¦ã¹ã‚‹ï¼‰
    game.Stage!.Boards[3, 13] = 1;
    game.Stage.Boards[3, 12] = 1;
    game.Stage.Boards[3, 11] = 1;
    game.Stage.Boards[3, 10] = 1;
    
    game.Mode = GameMode.CheckErase;

    // Act
    // æ¶ˆå»ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    game.Update();
    
    // æ¶ˆå»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ30ãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰ã‚’ã‚¹ã‚­ãƒƒãƒ—
    game.Mode = GameMode.Erase;
    for (int i = 0; i < 30; i++)
    {
        game.Update();
    }

    // Assert
    // é€šå¸¸ã‚¹ã‚³ã‚¢(10 Ã— 4 Ã— 1) + å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹(3600) = 3640ç‚¹
    Assert.Equal(3640, game.Score!.CurrentScore);
}

[Fact]
public void Update_ä¸€éƒ¨æ®‹ã‚‹_å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ãŒåŠ ç®—ã•ã‚Œãªã„()
{
    // Arrange
    var game = new Game();
    game.InitGame();
    
    // ä¸€éƒ¨æ®‹ã‚‹ã‚ˆã†ã«ç›¤é¢ã‚’è¨­å®š
    game.Stage!.Boards[3, 13] = 1;
    game.Stage.Boards[3, 12] = 1;
    game.Stage.Boards[3, 11] = 1;
    game.Stage.Boards[3, 10] = 1;
    game.Stage.Boards[4, 13] = 2; // ã“ã®ã·ã‚ˆã¯æ®‹ã‚‹
    
    game.Mode = GameMode.CheckErase;

    // Act
    game.Update();
    game.Mode = GameMode.Erase;
    for (int i = 0; i < 30; i++)
    {
        game.Update();
    }

    // Assert
    // é€šå¸¸ã‚¹ã‚³ã‚¢ã®ã¿(10 Ã— 4 Ã— 1) = 40ç‚¹
    Assert.Equal(40, game.Score!.CurrentScore);
}

[Fact]
public void Update_é€£é–ã‹ã‚‰ã®å…¨æ¶ˆã—_é€£é–ãƒœãƒ¼ãƒŠã‚¹ã¨å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®ä¸¡æ–¹ãŒåŠ ç®—ã•ã‚Œã‚‹()
{
    // Arrange
    var game = new Game();
    game.InitGame();
    
    // 2é€£é–ã§å…¨æ¶ˆã—ã«ãªã‚‹ã‚ˆã†ã«è¨­å®š
    // 1æ®µç›®: èµ¤ã·ã‚ˆ4ã¤ï¼ˆã™ãæ¶ˆãˆã‚‹ï¼‰
    game.Stage!.Boards[3, 13] = 1;
    game.Stage.Boards[3, 12] = 1;
    game.Stage.Boards[3, 11] = 1;
    game.Stage.Boards[3, 10] = 1;
    
    // 2æ®µç›®: é’ã·ã‚ˆ4ã¤ï¼ˆè½ã¡ã¦æ¶ˆãˆã‚‹ï¼‰
    game.Stage.Boards[3, 9] = 2;
    game.Stage.Boards[3, 8] = 2;
    game.Stage.Boards[3, 7] = 2;
    game.Stage.Boards[3, 6] = 2;
    
    game.Mode = GameMode.CheckErase;

    // Act
    game.CheckAndEraseWithChain();

    // Assert
    // 1é€£é–ç›®: 10 Ã— 4 Ã— 1 = 40ç‚¹
    // 2é€£é–ç›®: 10 Ã— 4 Ã— 8 = 320ç‚¹
    // å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹: 3600ç‚¹
    // åˆè¨ˆ: 3960ç‚¹
    Assert.Equal(3960, game.Score!.CurrentScore);
}
```

ã€Œå…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ã¯æ¶ˆå»å‡¦ç†ã®å¾Œã«è¡Œã†ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚ã·ã‚ˆã‚’æ¶ˆã—ãŸå¾Œã€ç›¤é¢ãŒç©ºã«ãªã£ãŸã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚ã€ã¯ã„ã€ã¾ã ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã«å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ã‚’çµ±åˆã—ã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'test: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®çµ±åˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
```

#### å®Ÿè£…

`CheckAndEraseWithChain`ãƒ¡ã‚½ãƒƒãƒ‰ã«å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```csharp
// PuyoPuyoTDD/Models/Game.csï¼ˆæ›´æ–°ï¼‰
/// <summary>
/// æ¶ˆå»å¯èƒ½ãªã·ã‚ˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã€é€£é–ãŒç¶šãé™ã‚Šæ¶ˆå»ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™
/// </summary>
public void CheckAndEraseWithChain()
{
    while (true)
    {
        // æ¶ˆå»ãƒã‚§ãƒƒã‚¯
        var eraseInfo = Stage!.CheckEraseBoards();
        
        if (eraseInfo.EraseCount == 0)
        {
            // ã“ã‚Œä»¥ä¸Šæ¶ˆã›ã‚‹ã·ã‚ˆãŒãªã„å ´åˆ
            Score!.ResetChain();
            Mode = GameMode.CheckFall;
            break;
        }

        // é€£é–ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—ã‚„ã™
        Score!.IncrementChain();

        // ã·ã‚ˆã‚’æ¶ˆå»
        Stage.EraseBoards(eraseInfo.EraseList);

        // å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯
        if (Stage.IsAllClear())
        {
            Score.AddZenkeshiBonus();
        }

        // ã‚¹ã‚³ã‚¢ã‚’åŠ ç®—
        Score.AddScoreWithChain(eraseInfo.EraseCount);

        // ã·ã‚ˆã‚’è½ä¸‹ã•ã›ã‚‹
        Stage.FallBoards();
    }
}
```

ã€Œæ¶ˆå»ã®å¾Œã™ãã«å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚`Stage.EraseBoards`ã§ã·ã‚ˆã‚’æ¶ˆã—ãŸç›´å¾Œã«`IsAllClear`ã§ç›¤é¢ãŒç©ºã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€å…¨æ¶ˆã—ã®å ´åˆã¯`AddZenkeshiBonus`ã§ãƒœãƒ¼ãƒŠã‚¹ã‚’åŠ ç®—ã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ãŒã‚²ãƒ¼ãƒ ã«æ­£ã—ãçµ±åˆã•ã‚Œã¾ã—ãŸã€‚

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã‚’ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã«çµ±åˆ'
```

### ã‚¹ãƒ†ãƒƒãƒ—7-4: ViewModelã®æ›´æ–°

å…¨æ¶ˆã—æ™‚ã®æ¼”å‡ºã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã€ViewModelã«å…¨æ¶ˆã—ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

#### ãƒ†ã‚¹ãƒˆã®ä½œæˆ

ã¾ãšã€ViewModelã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¾ã™ï¼š

```csharp
// PuyoPuyoTDD.Tests/ViewModels/GameViewModelTests.csï¼ˆè¿½åŠ ï¼‰
[Fact]
public void ShowZenkeshi_å…¨æ¶ˆã—ç™ºç”Ÿ_Trueã«ãªã‚‹()
{
    // Arrange
    var viewModel = new GameViewModel();
    viewModel.StartGame();
    
    // å…¨æ¶ˆã—ã«ãªã‚‹ã‚ˆã†ã«ç›¤é¢ã‚’è¨­å®š
    viewModel.Game!.Stage!.Boards[3, 13] = 1;
    viewModel.Game.Stage.Boards[3, 12] = 1;
    viewModel.Game.Stage.Boards[3, 11] = 1;
    viewModel.Game.Stage.Boards[3, 10] = 1;
    viewModel.Game.Mode = GameMode.CheckErase;

    // Act
    viewModel.Game.CheckAndEraseWithChain();

    // Assert
    Assert.True(viewModel.ShowZenkeshi);
}

[Fact]
public void ShowZenkeshi_ä¸€éƒ¨æ®‹ã‚‹_Falseã®ã¾ã¾()
{
    // Arrange
    var viewModel = new GameViewModel();
    viewModel.StartGame();
    
    // ä¸€éƒ¨æ®‹ã‚‹ã‚ˆã†ã«è¨­å®š
    viewModel.Game!.Stage!.Boards[3, 13] = 1;
    viewModel.Game.Stage.Boards[3, 12] = 1;
    viewModel.Game.Stage.Boards[3, 11] = 1;
    viewModel.Game.Stage.Boards[3, 10] = 1;
    viewModel.Game.Stage.Boards[4, 13] = 2;
    viewModel.Game.Mode = GameMode.CheckErase;

    // Act
    viewModel.Game.CheckAndEraseWithChain();

    // Assert
    Assert.False(viewModel.ShowZenkeshi);
}
```

ã€ŒViewModelã§å…¨æ¶ˆã—ãƒ•ãƒ©ã‚°ã‚’ç®¡ç†ã™ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã†ã§ã™ã€‚UIãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ãŸã‚ã«ã€ViewModelã«å…¨æ¶ˆã—è¡¨ç¤ºç”¨ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚ã€ã¯ã„ã€`ShowZenkeshi`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã¾ã å­˜åœ¨ã—ãªã„ã‹ã‚‰ã§ã™ã€‚

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'test: å…¨æ¶ˆã—ãƒ•ãƒ©ã‚°ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ '
```

#### å®Ÿè£…

ViewModelã«å…¨æ¶ˆã—ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```csharp
// PuyoPuyoTDD/ViewModels/GameViewModel.csï¼ˆè¿½åŠ ï¼‰
[ObservableProperty]
private bool showZenkeshi;

/// <summary>
/// ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°ã—ã¾ã™
/// </summary>
private void GameLoop()
{
    if (Game == null) return;

    // å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ï¼ˆæ¶ˆå»å‰ã®çŠ¶æ…‹ã‚’ä¿å­˜ï¼‰
    bool wasAllClear = Game.Stage?.IsAllClear() ?? false;

    // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°
    Game.Update();

    // å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ï¼ˆæ¶ˆå»å¾Œã«ç›¤é¢ãŒç©ºã«ãªã£ãŸï¼‰
    if (!wasAllClear && (Game.Stage?.IsAllClear() ?? false))
    {
        ShowZenkeshi = true;
        
        // 2ç§’å¾Œã«éè¡¨ç¤º
        Task.Delay(2000).ContinueWith(_ =>
        {
            ShowZenkeshi = false;
        });
    }
}
```

ã€Œæ¶ˆå»å‰å¾Œã®çŠ¶æ…‹ã‚’æ¯”è¼ƒã—ã¦ã€å…¨æ¶ˆã—ã‚’æ¤œå‡ºã™ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚æ¶ˆå»å‰ã«ç›¤é¢ãŒç©ºã§ãªãã€æ¶ˆå»å¾Œã«ç©ºã«ãªã£ãŸå ´åˆã«å…¨æ¶ˆã—ã¨åˆ¤å®šã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash
dotnet cake --target=Test
```

ã€Œãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸï¼ã€ç´ æ™´ã‚‰ã—ã„ï¼ViewModelã«å…¨æ¶ˆã—ãƒ•ãƒ©ã‚°ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚

å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼š

```bash
git add .
git commit -m 'feat: ViewModelã«å…¨æ¶ˆã—ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ '
```

### ã‚¹ãƒ†ãƒƒãƒ—7-5: XAMLã®æ›´æ–°

æœ€å¾Œã«ã€å…¨æ¶ˆã—æ™‚ã®è¡¨ç¤ºã‚’XAMLã«è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```xml
<!-- PuyoPuyoTDD/MainWindow.xamlï¼ˆæ›´æ–°ï¼‰ -->
<Window x:Class="PuyoPuyoTDD.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PuyoPuyoTDD"
        mc:Ignorable="d"
        Title="ã·ã‚ˆã·ã‚ˆ TDD" Height="600" Width="800"
        KeyDown="Window_KeyDown"
        KeyUp="Window_KeyUp"
        Focusable="True">
    <Window.Resources>
        <!-- å…¨æ¶ˆã—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <Storyboard x:Key="ZenkeshiAnimation">
            <DoubleAnimation Storyboard.TargetName="ZenkeshiPanel"
                           Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.5" />
            <DoubleAnimation Storyboard.TargetName="ZenkeshiText"
                           Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleX)"
                           From="0.5" To="1.2" Duration="0:0:0.3"
                           AutoReverse="True" />
            <DoubleAnimation Storyboard.TargetName="ZenkeshiText"
                           Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleY)"
                           From="0.5" To="1.2" Duration="0:0:0.3"
                           AutoReverse="True" />
        </Storyboard>

        <!-- ã‚¹ã‚³ã‚¢ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <Storyboard x:Key="ScorePulseAnimation">
            <DoubleAnimation Storyboard.TargetName="ScoreValue"
                           Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleX)"
                           From="1" To="1.3" Duration="0:0:0.15"
                           AutoReverse="True" />
            <DoubleAnimation Storyboard.TargetName="ScoreValue"
                           Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleY)"
                           From="1" To="1.3" Duration="0:0:0.15"
                           AutoReverse="True" />
        </Storyboard>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="400"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ã‚²ãƒ¼ãƒ é ˜åŸŸ -->
        <Border Grid.Column="0" BorderBrush="Black" BorderThickness="1" Margin="10">
            <Grid>
                <Canvas x:Name="GameCanvas" 
                        Width="240" 
                        Height="520"
                        Background="WhiteSmoke"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"/>
                
                <!-- å…¨æ¶ˆã—è¡¨ç¤º -->
                <StackPanel x:Name="ZenkeshiPanel"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Opacity="0"
                          Visibility="{Binding ShowZenkeshi, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock x:Name="ZenkeshiText"
                             Text="å…¨æ¶ˆã—ï¼"
                             FontSize="60"
                             FontWeight="Bold"
                             Foreground="Gold"
                             HorizontalAlignment="Center"
                             RenderTransformOrigin="0.5,0.5">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="3" Opacity="0.5"/>
                        </TextBlock.Effect>
                        <TextBlock.RenderTransform>
                            <ScaleTransform/>
                        </TextBlock.RenderTransform>
                    </TextBlock>
                    <TextBlock Text="+3600"
                             FontSize="40"
                             FontWeight="Bold"
                             Foreground="Orange"
                             HorizontalAlignment="Center"
                             Margin="0,10,0,0">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="Black" BlurRadius="5" ShadowDepth="2" Opacity="0.5"/>
                        </TextBlock.Effect>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>

        <!-- æƒ…å ±ãƒ‘ãƒãƒ« -->
        <StackPanel Grid.Column="1" Margin="10">
            <Button Content="ã‚²ãƒ¼ãƒ é–‹å§‹" 
                    Command="{Binding StartGameCommand}"
                    Width="150" 
                    Height="40"
                    FontSize="16"
                    Margin="0,0,0,20"/>

            <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
            <Border BorderBrush="DarkGray" 
                    BorderThickness="2" 
                    CornerRadius="5" 
                    Padding="15"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="ã‚¹ã‚³ã‚¢" 
                             FontSize="18" 
                             FontWeight="Bold"
                             HorizontalAlignment="Center"/>
                    <TextBlock x:Name="ScoreValue"
                             Text="{Binding CurrentScore}" 
                             FontSize="36" 
                             FontWeight="Bold"
                             Foreground="DarkBlue"
                             HorizontalAlignment="Center"
                             RenderTransformOrigin="0.5,0.5">
                        <TextBlock.RenderTransform>
                            <ScaleTransform/>
                        </TextBlock.RenderTransform>
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- é€£é–è¡¨ç¤º -->
            <Border BorderBrush="OrangeRed" 
                    BorderThickness="2" 
                    CornerRadius="5" 
                    Padding="10"
                    Margin="0,0,0,20"
                    Visibility="{Binding ShowChain, Converter={StaticResource BoolToVisibilityConverter}}">
                <TextBlock Text="{Binding ChainText}" 
                         FontSize="24" 
                         FontWeight="Bold"
                         Foreground="OrangeRed"
                         HorizontalAlignment="Center"/>
            </Border>

            <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
            <Border BorderBrush="Gray" 
                    BorderThickness="1" 
                    CornerRadius="5" 
                    Padding="10">
                <StackPanel>
                    <TextBlock Text="ãƒ‡ãƒãƒƒã‚°æƒ…å ±" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBlock Text="{Binding DebugInfo}" 
                             FontFamily="Consolas"
                             FontSize="12"/>
                </StackPanel>
            </Border>
        </StackPanel>
    </Grid>
</Window>
```

ã€Œå…¨æ¶ˆã—è¡¨ç¤ºã«ç‰¹åˆ¥ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ãŸã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚é‡‘è‰²ã®ã€Œå…¨æ¶ˆã—ï¼ã€ãƒ†ã‚­ã‚¹ãƒˆãŒãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã—ã€ã€Œ+3600ã€ãƒœãƒ¼ãƒŠã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ãƒ“ãƒã‚¤ãƒ³ãƒ‰ã‚‚æ›´æ–°ã—ã¦ã€å…¨æ¶ˆã—æ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ï¼š

```csharp
// PuyoPuyoTDD/MainWindow.xaml.csï¼ˆæ›´æ–°ï¼‰
using System.Windows;
using System.Windows.Input;
using System.Windows.Media.Animation;
using PuyoPuyoTDD.ViewModels;

namespace PuyoPuyoTDD
{
    public partial class MainWindow : Window
    {
        private GameViewModel ViewModel => (GameViewModel)DataContext;
        private bool _lastShowZenkeshi = false;

        public MainWindow()
        {
            InitializeComponent();
            DataContext = new GameViewModel();
            
            // ViewModelã®å¤‰æ›´ã‚’ç›£è¦–
            ViewModel.PropertyChanged += (s, e) =>
            {
                if (e.PropertyName == nameof(GameViewModel.ShowZenkeshi))
                {
                    // å…¨æ¶ˆã—ãƒ•ãƒ©ã‚°ãŒtrueã«ãªã£ãŸã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ
                    if (ViewModel.ShowZenkeshi && !_lastShowZenkeshi)
                    {
                        var animation = (Storyboard)FindResource("ZenkeshiAnimation");
                        animation.Begin();
                    }
                    _lastShowZenkeshi = ViewModel.ShowZenkeshi;
                }
                else if (e.PropertyName == nameof(GameViewModel.CurrentScore))
                {
                    // ã‚¹ã‚³ã‚¢ãŒå¤‰åŒ–ã—ãŸã‚‰ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    var animation = (Storyboard)FindResource("ScorePulseAnimation");
                    animation.Begin();
                }
            };
        }

        private void Window_KeyDown(object sender, KeyEventArgs e)
        {
            ViewModel.HandleKeyDown(e.Key);
        }

        private void Window_KeyUp(object sender, KeyEventArgs e)
        {
            ViewModel.HandleKeyUp(e.Key);
        }
    }
}
```

ã€ŒViewModelã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿã™ã‚‹ã‚“ã§ã™ã­ï¼ã€ãã®é€šã‚Šã§ã™ã€‚`PropertyChanged`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½¿ã£ã¦ã€å…¨æ¶ˆã—ãƒ•ãƒ©ã‚°ã‚„ã‚¹ã‚³ã‚¢ã®å¤‰åŒ–ã‚’æ¤œçŸ¥ã—ã€å¯¾å¿œã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿã—ã¾ã™ã€‚

BoolToVisibilityConverterã‚‚è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```csharp
// PuyoPuyoTDD/Converters/BoolToVisibilityConverter.csï¼ˆæ–°è¦ä½œæˆï¼‰
using System;
using System.Globalization;
using System.Windows;
using System.Windows.Data;

namespace PuyoPuyoTDD.Converters
{
    public class BoolToVisibilityConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value is bool boolValue)
            {
                return boolValue ? Visibility.Visible : Visibility.Collapsed;
            }
            return Visibility.Collapsed;
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            throw new NotImplementedException();
        }
    }
}
```

ãã—ã¦ã€XAMLã§Converterã‚’ç™»éŒ²ã—ã¾ã™ï¼š

```xml
<!-- PuyoPuyoTDD/MainWindow.xamlï¼ˆæ›´æ–°ï¼‰ -->
<Window x:Class="PuyoPuyoTDD.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PuyoPuyoTDD"
        xmlns:converters="clr-namespace:PuyoPuyoTDD.Converters"
        mc:Ignorable="d"
        Title="ã·ã‚ˆã·ã‚ˆ TDD" Height="600" Width="800"
        KeyDown="Window_KeyDown"
        KeyUp="Window_KeyUp"
        Focusable="True">
    <Window.Resources>
        <!-- ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ç™»éŒ² -->
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <!-- ... ãã®ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ ... -->
    </Window.Resources>
    
    <!-- ... æ®‹ã‚Šã®XAML ... -->
</Window>
```

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ

å®Ÿè£…ã—ãŸæ©Ÿèƒ½ã‚’å®Ÿéš›ã«ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

```bash
cd PuyoPuyoTDD
dotnet run
```

#### å…¨æ¶ˆã—ã®ç¢ºèª

ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã—ã¦ã€å…¨æ¶ˆã—ã‚’å®Ÿç¾ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. **ã‚·ãƒ³ãƒ—ãƒ«ãªå…¨æ¶ˆã—**: æœ€åˆã®4ã¤ã®ã·ã‚ˆã‚’æƒãˆã¦æ¶ˆã™ã ã‘ã§å…¨æ¶ˆã—
   - ç›¤é¢ãŒç©ºã«ãªã‚‹
   - é‡‘è‰²ã®ã€Œå…¨æ¶ˆã—ï¼ã€ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - ã€Œ+3600ã€ãƒœãƒ¼ãƒŠã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - ã‚¹ã‚³ã‚¢ãŒå¤§ããå¢—åŠ ã™ã‚‹ï¼ˆ40 + 3600 = 3640ç‚¹ï¼‰

2. **é€£é–ã‹ã‚‰ã®å…¨æ¶ˆã—**: è¤‡æ•°å›ã®é€£é–ã‚’çµŒã¦å…¨æ¶ˆã—
   - é€£é–è¡¨ç¤ºã®å¾Œã«å…¨æ¶ˆã—è¡¨ç¤ºãŒå‡ºã‚‹
   - é€£é–ãƒœãƒ¼ãƒŠã‚¹ + å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã§é«˜å¾—ç‚¹
   - ä¾‹: 2é€£é–å…¨æ¶ˆã—ã§ 40 + 320 + 3600 = 3960ç‚¹

ã€Œå…¨æ¶ˆã—ã™ã‚‹ã¨ç”»é¢ãŒè¯ã‚„ã‹ã«ãªã‚Šã¾ã™ã­ï¼ã€ãã†ãªã‚“ã§ã™ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤§ããªé”æˆã«å¯¾ã—ã¦ã€ã—ã£ã‹ã‚Šã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¿”ã™ã“ã¨ãŒé‡è¦ã§ã™ã€‚

### ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³7ã®ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³7ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å®Ÿç¾ã—ã¾ã—ãŸï¼š

1. **å…¨æ¶ˆã—åˆ¤å®š**: `IsAllClear()`ã«ã‚ˆã‚‹ç›¤é¢ãŒç©ºã‹ã©ã†ã‹ã®åˆ¤å®š
2. **å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹**: `AddZenkeshiBonus()`ã«ã‚ˆã‚‹å›ºå®š3600ç‚¹ã®ãƒœãƒ¼ãƒŠã‚¹
3. **ã‚²ãƒ¼ãƒ ã¸ã®çµ±åˆ**: æ¶ˆå»å¾Œã®å…¨æ¶ˆã—ãƒã‚§ãƒƒã‚¯ã¨ãƒœãƒ¼ãƒŠã‚¹åŠ ç®—
4. **å…¨æ¶ˆã—æ¼”å‡º**: é‡‘è‰²ã®ã€Œå…¨æ¶ˆã—ï¼ã€è¡¨ç¤ºã¨ã€Œ+3600ã€ãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤º
5. **è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ‰ãƒ­ãƒƒãƒ—ã‚·ãƒ£ãƒ‰ã‚¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

**å­¦ã‚“ã ã“ã¨**:
- **å…¨æ¶ˆã—åˆ¤å®š**: äºŒé‡ãƒ«ãƒ¼ãƒ—ã§ç›¤é¢å…¨ä½“ã‚’ãƒã‚§ãƒƒã‚¯
- **å›ºå®šãƒœãƒ¼ãƒŠã‚¹**: é€£é–ãƒœãƒ¼ãƒŠã‚¹ã¨ã¯ç•°ãªã‚‹å›ºå®šå€¤ã®å ±é…¬
- **æ¶ˆå»å¾Œã®å‡¦ç†**: æ¶ˆå»ç›´å¾Œã«å…¨æ¶ˆã—åˆ¤å®šã‚’è¡Œã†
- **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: WPFã®Storyboardã«ã‚ˆã‚‹æ¼”å‡ºåŠ¹æœ
- **PropertyChanged**: ViewModelã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¦UIã‚’æ›´æ–°

**å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã®æ„ç¾©**:
å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã€Œå®Œç’§ãªãƒ—ãƒ¬ã‚¤ã€ã‚’ç›®æŒ‡ã™å‹•æ©Ÿã‚’ä¸ãˆã¾ã™ã€‚é€£é–ã‚’çµ„ã‚€ã ã‘ã§ãªãã€ã€Œãã‚Œã„ã«å…¨éƒ¨æ¶ˆã™ã€ã¨ã„ã†æ–°ãŸãªç›®æ¨™ãŒç”Ÿã¾ã‚Œã‚‹ã“ã¨ã§ã€ã‚²ãƒ¼ãƒ ã®æˆ¦ç•¥æ€§ãŒã•ã‚‰ã«æ·±ã¾ã‚Šã¾ã™ã€‚

> ã‚²ãƒ¼ãƒ è¨­è¨ˆã®å¦™
>
> å›°é›£ã ãŒé”æˆå¯èƒ½ãªç›®æ¨™ã¨ã€ãã‚Œã«è¦‹åˆã£ãŸå ±é…¬ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å¤¢ä¸­ã«ãªã£ã¦ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã—ã¾ã™ã€‚å…¨æ¶ˆã—ãƒœãƒ¼ãƒŠã‚¹ã¯ã€ã¾ã•ã«ãã®å¥½ä¾‹ã§ã™ã€‚
>
> â€” Sid Meier ã€Game Designã€

**å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ**:
- å…¨æ¶ˆã—åˆ¤å®šã¯æ¶ˆå»ç›´å¾Œã«è¡Œã„ã€ç›¤é¢ã®çŠ¶æ…‹ã‚’æ­£ç¢ºã«æŠŠæ¡
- å…¨æ¶ˆã—ãƒ•ãƒ©ã‚°ã‚’ViewModelã§ç®¡ç†ã—ã€UIãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ´»ç”¨
- `PropertyChanged`ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼
- ãƒ‰ãƒ­ãƒƒãƒ—ã‚·ãƒ£ãƒ‰ã‚¦ã¨ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§è¦–è¦šçš„ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’ä¸ãˆã‚‹

ã“ã‚Œã§ã·ã‚ˆã·ã‚ˆã®ä¸»è¦ãªã‚²ãƒ¼ãƒ è¦ç´ ãŒå®Œæˆã—ã¾ã—ãŸï¼æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³8ã§ã¯ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®šã¨ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã€ã‚²ãƒ¼ãƒ ã¨ã—ã¦å®Œçµã•ã›ã¾ã™ã€‚æ¥½ã—ã¿ã«ã—ã¦ã„ã¦ãã ã•ã„ï¼












